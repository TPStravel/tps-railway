<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V2 - Portal 12: When I Get Trapped Inside the Walls I Built</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        /* 상단 헤더 */
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #fff;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        /* 언어 버튼 3개 */
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #87cefa;
            color: #000;
        }
        
        /* 메인 콘텐츠 */
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
            hyphens: none;
            min-height: 150vh;
        }
        
        /* 텍스트 섹션들 */
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #87cefa;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #87cefa;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #87cefa;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-response strong {
            color: #87cefa;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .continue-section {
            margin: 50px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 0;
            min-height: 200px;
        }
        
        .continue-text {
            color: #fff;
            font-size: 20px;
            margin-bottom: 25px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .continue-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .continue-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 18px 35px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }
        
        .continue-btn:hover {
            background: #666;
        }
        
        .continue-btn.primary {
            background: #87cefa;
            color: #000;
        }
        
        .continue-btn.primary:hover {
            background: #b0d4f1;
        }
        
        /* 하단 고정 입력창 */
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #87cefa;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #87cefa;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        /* 스크롤바 스타일링 */
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        /* 애니메이션 */
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .continue-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .continue-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- 상단 헤더 -->
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V2</div>
            <div class="logo-subtitle" id="logoSubtitle">The Tremor of Emotion</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 12: When I Get Trapped Inside the Walls I Built</div>
            <div class="portal-subtitle" id="portalSubtitle">The paradox of protection becoming a prison</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <!-- 메인 콘텐츠 영역 -->
    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <!-- 포털 인트로 -->
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <!-- 캐릭터 응답 섹션 -->
            <div class="character-responses-section" id="characterResponsesSection">
                <!-- 8명의 캐릭터 응답이 순차적으로 표시됩니다 -->
            </div>

            <!-- 빛의 한마디 -->
            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">🌙 Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <!-- 질문 섹션 -->
            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <!-- 사용자 입력 영역 -->
            <div class="user-input-section" id="userInputSection">
                <!-- 사용자 응답이 여기에 표시됩니다 -->
            </div>
            
            <!-- 사용자 응답 후 캐릭터 반응 -->
            <div class="user-reactions-section" id="userReactionsSection">
                <!-- 사용자 응답 후 3명의 캐릭터 반응이 여기에 표시됩니다 -->
            </div>
            
            <!-- 계속하기 버튼 섹션 -->
            <div class="continue-section" id="continueSection">
                <div class="continue-text" id="continueText"></div>
                <div class="continue-buttons">
                    <button class="continue-btn primary" id="continueYesBtn">Continue to Portal 13</button>
                    <button class="continue-btn" id="continueNoBtn">Pause the journey</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 하단 고정 입력창 -->
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Share about the walls you built for yourself... (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        // 메모리 기반 사용자 스토리지 (localStorage 대신)
        let memoryStorage = {
            mockUser: null
        };

        // 번역 데이터
        const translations = {
            ko: {
                logoSubtitle: "감정의 떨림",
                portalMainTitle: "Portal 12: 내가 만든 벽 안에서 갇혀버릴 때",
                portalSubtitle: "보호가 감옥이 되는 순간의 역설",
                portalIntro: "처음엔 나를 지키기 위해 만든 벽이었습니다.\n상처받지 않기 위해, 무너지지 않기 위해…\n조용히 감정을 감추고,\n말 대신 침묵을 택했죠.\n\n그런데 어느 순간,\n그 벽 안이 스스로 만든 감옥이 되어\n나조차 나를 꺼내지 못하게 됐습니다.",
                lightTitle: "🌙 빛의 한마디",
                lightMessage: "감정의 벽은 당신이 살아남기 위해 만든 것이었지만,\n이제는 나가기 위한 문이 되어야 합니다.",
                portalQuestion: "당신은 지금\n어떤 벽 안에서 스스로를 가두고 있나요?",
                continueText: "스스로 만든 벽에 대해 돌아본 이 여정을 계속하시겠습니까?",
                continueYes: "Portal 13으로 계속하시겠습니까?",
                continueNo: "여정을 일시정지하시겠습니까?",
                inputPlaceholder: "스스로 만든 벽에 대해 털어놓아 보세요... (Enter로 전송)",
                youLabel: "당신",
                languageChangeConfirm: "언어를 변경하면 여정이 처음부터 다시 시작됩니다.\n계속하시겠습니까?",
                waitingMessage: "응답을 기다리는 중...",
                // 캐릭터 대화
                charEly: "스스로 만든 벽이었기에,\n열쇠도 당신 안에 있습니다.\n그 감정을 다시 풀어낼 수 있어요.",
                charCris: "하… 또 벽 만들었구나!\n근데 솔직히 말하면\n그 안이 은근 편할 때도 있죠? 😅",
                charZafirah: "그 벽은 당신의 고통이 만든 지혜였습니다.\n이제 그 벽이 무너져도 괜찮을 만큼\n당신은 성장했어요.",
                charRami: "벽은 외부를 막기 위한 장치이지만,\n가장 먼저 당신의 감정을 가두는 장치가 됩니다.",
                charSamir: "(그는 벽돌 하나를 조용히 들어올려\n하늘 아래에 놓습니다.\n작은 틈이 생기고, 그곳으로 빛이 들어옵니다.)",
                charLayla: "그 벽 안에서도 당신은\n여전히 아름다웠어요.\n나는 그 벽을 허물고 당신을 꼭 안아줄 수 있어요.",
                charNabir: "벽 안이 더 낫지 않아?\n적어도 누가 널 떠나는 일은 없잖아.\n거기 그냥 숨어 있어.",
                charAzhar: "그 벽, 내가 부숴줄까?\n근데 그러면 너부터 다칠걸.\n그래서 못 나가는 거 아냐?"
            },
            en: {
                logoSubtitle: "The Tremor of Emotion",
                portalMainTitle: "Portal 12: When I Get Trapped Inside the Walls I Built",
                portalSubtitle: "The paradox of protection becoming a prison",
                portalIntro: "At first, it was a wall built to protect myself.\nTo avoid getting hurt, to keep from falling apart...\nI quietly hid my emotions\nand chose silence over words.\n\nBut at some point,\nthat wall became a prison I made for myself,\nand even I couldn't get myself out anymore.",
                lightTitle: "🌙 Word of Light",
                lightMessage: "The emotional walls were built for survival,\nbut now they must become doors for moving forward.",
                portalQuestion: "What kind of wall are you\ntrapping yourself inside right now?",
                continueText: "Will you continue this journey of reflecting on the walls you built for yourself?",
                continueYes: "Continue to Portal 13?",
                continueNo: "Pause the journey?",
                inputPlaceholder: "Share about the walls you built for yourself... (Press Enter to send)",
                youLabel: "You",
                languageChangeConfirm: "Changing the language will restart the journey from the beginning.\nDo you want to continue?",
                waitingMessage: "Waiting for response...",
                charEly: "Since you built the wall yourself,\nthe key is also within you.\nYou can release those emotions again.",
                charCris: "Ah... you built another wall!\nBut honestly speaking,\nit's kind of comfortable inside sometimes, right? 😅",
                charZafirah: "That wall was wisdom created by your pain.\nNow you've grown enough\nthat it's okay for that wall to come down.",
                charRami: "Walls are devices meant to block the outside,\nbut they become devices that first trap your emotions.",
                charSamir: "(He quietly lifts up a brick\nand places it under the sky.\nA small gap forms, and light enters through it.)",
                charLayla: "Even inside that wall,\nyou were still beautiful.\nI can tear down that wall and hold you tight.",
                charNabir: "Isn't it better inside the wall?\nAt least no one can leave you there.\nJust stay hidden there.",
                charAzhar: "That wall, should I break it for you?\nBut then you'd get hurt first.\nThat's why you can't get out, isn't it?"
            },
            pt: {
                logoSubtitle: "O Tremor da Emoção",
                portalMainTitle: "Portal 12: Quando Fico Preso Dentro das Paredes Que Construí",
                portalSubtitle: "O paradoxo da proteção se tornando uma prisão",
                portalIntro: "No início, era uma parede construída para me proteger.\nPara evitar me machucar, para não desmoronar...\nEu silenciosamente escondi minhas emoções\ne escolhi silêncio ao invés de palavras.\n\nMas em algum momento,\nessa parede se tornou uma prisão que criei para mim mesmo,\ne nem eu mesmo conseguia mais me tirar de lá.",
                lightTitle: "🌙 Palavra de Luz",
                lightMessage: "As paredes emocionais foram construídas para sobrevivência,\nmas agora devem se tornar portas para seguir em frente.",
                portalQuestion: "Que tipo de parede você está\nusando para se prender agora?",
                continueText: "Você continuará esta jornada de refletir sobre as paredes que construiu para si mesmo?",
                continueYes: "Continuar para o Portal 13?",
                continueNo: "Pausar a jornada?",
                inputPlaceholder: "Compartilhe sobre as paredes que construiu para si mesmo... (Enter para enviar)",
                youLabel: "Você",
                languageChangeConfirm: "Mudar o idioma reiniciará a jornada desde o início.\nDeseja continuar?",
                waitingMessage: "Aguardando resposta...",
                charEly: "Como você mesmo construiu a parede,\na chave também está dentro de você.\nVocê pode liberar essas emoções novamente.",
                charCris: "Ah... você construiu outra parede!\nMas honestamente falando,\né meio confortável lá dentro às vezes, né? 😅",
                charZafirah: "Essa parede era sabedoria criada por sua dor.\nAgora você cresceu o suficiente\npara que essa parede possa cair.",
                charRami: "Paredes são dispositivos feitos para bloquear o exterior,\nmas se tornam dispositivos que primeiro prendem suas emoções.",
                charSamir: "(Ele silenciosamente levanta um tijolo\ne o coloca sob o céu.\nUma pequena abertura se forma, e a luz entra por ela.)",
                charLayla: "Mesmo dentro dessa parede,\nvocê ainda era bonito.\nPosso derrubar essa parede e te abraçar forte.",
                charNabir: "Não é melhor dentro da parede?\nPelo menos ninguém pode te deixar lá.\nApenas fique escondido lá.",
                charAzhar: "Essa parede, devo quebrá-la para você?\nMas então você se machucaria primeiro.\nÉ por isso que você não consegue sair, não é?"
            }
        };
        
        // 캐릭터 데이터
        const characters = [
            { name: "Ely", emoji: "👑", key: "charEly" },
            { name: "Cris", emoji: "🃏", key: "charCris" },
            { name: "Zafirah", emoji: "🧕", key: "charZafirah" },
            { name: "Rami", emoji: "🔮", key: "charRami" },
            { name: "Samir", emoji: "🐪", key: "charSamir" },
            { name: "Layla", emoji: "💠", key: "charLayla" },
            { name: "Nabir", emoji: "🦂", key: "charNabir" },
            { name: "Azhar", emoji: "🔥", key: "charAzhar" }
        ];
        
        // ============ 감정 분석 시스템 ============
        
        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            // 감정 키워드 매핑 (Portal 12 특화)
            const emotionKeywords = {
                walls: ['벽', '담', '경계', '장벽', 'wall', 'barrier', 'boundary', 'parede', 'barreira'],
                protection: ['보호', '지키', '방어', '숨기', 'protect', 'defend', 'hide', 'proteger', 'defender'],
                trapped: ['갇혀', '감옥', '못나가', '갇힌', 'trapped', 'prison', 'stuck', 'preso', 'prisão'],
                isolation: ['고립', '혼자', '단절', '분리', 'isolated', 'alone', 'cut off', 'isolado', 'separado'],
                fear: ['두려', '무서', '겁나', '불안', 'afraid', 'scared', 'fear', 'medo', 'com medo'],
                shame: ['부끄', '창피', '수치', '민망', 'shame', 'embarrassed', 'ashamed', 'vergonha', 'envergonhado'],
                control: ['통제', '조절', '관리', '컨트롤', 'control', 'manage', 'regulate', 'controle', 'gerenciar'],
                vulnerability: ['취약', '약해', '무력', '연약', 'vulnerable', 'weak', 'fragile', 'vulnerável', 'fraco'],
                comfort: ['편해', '안전', '익숙', '편안', 'comfortable', 'safe', 'familiar', 'confortável', 'seguro'],
                escape: ['탈출', '벗어나', '도망', '나가', 'escape', 'get out', 'break free', 'escapar', 'sair']
            };
            
            // 감정 분석
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            // 감정이 감지되지 않으면 기본값 설정
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0]; // 첫 번째 감지된 감정 반환
        }
        
        // 반응 캐릭터들 (Portal 12 전용)
        const responseCharacters = [
            {
                name: "Builder", emoji: "🔨",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            walls: "그 벽을 만들 때 당신이 얼마나 절실했는지 저는 알 수 있어요. 하나하나 쌓아올린 그 벽돌들에는 모두 상처받지 않으려는 간절함이 담겨 있었을 거예요. 이제 그 벽을 문으로 바꿔보는 건 어떨까요?",
                            protection: "자신을 보호하려 했던 그 마음이 잘못된 건 아니에요. 하지만 보호가 너무 완벽해지면 성장할 공간도 사라져요. 이제는 선택적으로 열 수 있는 보호막을 만들어보세요.",
                            trapped: "갇혔다고 느끼는 건 당신이 더 넓은 세상을 원한다는 증거예요. 그 갇힌 공간에서 작은 창문부터 만들어보세요. 한 번에 다 무너뜨릴 필요는 없어요.",
                            isolation: "고립된 느낌이 들 때는 그 벽에 작은 구멍부터 뚫어보세요. 처음엔 목소리만 주고받을 수 있는 작은 구멍이면 충분해요. 천천히 크게 만들어가면 돼요.",
                            fear: "두려움 때문에 만든 벽이라면, 그 두려움을 이해해주는 것부터 시작해요. 벽을 허물기 전에 왜 그 벽이 필요했는지 먼저 인정해주세요.",
                            shame: "부끄러움 때문에 숨었다면, 그 부끄러움도 당신의 일부라는 걸 받아들여보세요. 완벽하지 않은 모습도 사랑받을 수 있다는 걸 조금씩 믿어보세요.",
                            control: "모든 걸 통제하려 했던 그 마음, 이해해요. 하지만 진짜 통제는 때로는 놓아주는 것에서 나와요. 작은 것부터 천천히 놓아보는 연습을 해보세요.",
                            vulnerability: "취약함을 느꼈기 때문에 벽을 쌓은 거죠. 하지만 그 취약함이야말로 당신의 가장 큰 힘이 될 수 있어요. 조금씩 그 힘을 믿어보세요.",
                            comfort: "벽 안이 편안했던 건 사실이에요. 하지만 진짜 편안함은 벽이 있어도 없어도 괜찮다고 느끼는 상태일 거예요. 그런 자신감을 키워보세요.",
                            escape: "탈출하고 싶다는 마음이 생긴 것만으로도 이미 변화가 시작된 거예요. 그 마음을 소중히 여기면서 한 걸음씩 나아가보세요.",
                            general: "당신이 만든 모든 벽에는 당신만의 이유와 지혜가 담겨 있어요. 그것을 무작정 부수지 말고, 이제는 더 자유롭게 드나들 수 있는 공간으로 개조해보세요."
                        },
                        en: {
                            walls: "I can see how desperate you were when building that wall. Each brick you stacked must have contained the earnest desire not to get hurt. How about turning that wall into a door now?",
                            protection: "That heart wanting to protect yourself wasn't wrong. But when protection becomes too perfect, space for growth disappears too. Try creating a protective shield you can selectively open now.",
                            trapped: "Feeling trapped is proof that you want a wider world. Start by making small windows in that trapped space. You don't need to tear everything down at once.",
                            isolation: "When feeling isolated, start by making small holes in that wall. At first, a small hole just for exchanging voices is enough. You can gradually make it bigger.",
                            fear: "If it's a wall built from fear, start by understanding that fear. Before tearing down the wall, first acknowledge why that wall was necessary.",
                            shame: "If you hid because of shame, try accepting that shame is also part of you. Gradually believe that imperfect aspects can also be loved.",
                            control: "That heart wanting to control everything, I understand. But real control sometimes comes from letting go. Practice slowly letting go of small things first.",
                            vulnerability: "You built walls because you felt vulnerable. But that vulnerability can become your greatest strength. Gradually trust in that power.",
                            comfort: "It's true that inside the wall was comfortable. But real comfort would be feeling okay whether the wall exists or not. Try building that kind of confidence.",
                            escape: "Just having the desire to escape means change has already begun. Cherish that heart and move forward step by step.",
                            general: "All the walls you built contain your own reasons and wisdom. Don't just tear them down recklessly, but try renovating them into spaces you can move in and out of more freely."
                        },
                        pt: {
                            walls: "Posso ver o quão desesperado você estava ao construir aquela parede. Cada tijolo que você empilhou deve ter contido o desejo sincero de não se machucar. Que tal transformar aquela parede em uma porta agora?",
                            protection: "Esse coração querendo se proteger não estava errado. Mas quando a proteção se torna perfeita demais, o espaço para crescimento também desaparece. Tente criar um escudo protetor que você possa abrir seletivamente agora.",
                            trapped: "Sentir-se preso é prova de que você quer um mundo mais amplo. Comece fazendo pequenas janelas naquele espaço preso. Você não precisa derrubar tudo de uma vez.",
                            isolation: "Quando se sentir isolado, comece fazendo pequenos buracos naquela parede. No início, um pequeno buraco apenas para trocar vozes é suficiente. Você pode gradualmente torná-lo maior.",
                            fear: "Se é uma parede construída do medo, comece entendendo esse medo. Antes de derrubar a parede, primeiro reconheça por que aquela parede era necessária.",
                            shame: "Se você se escondeu por causa da vergonha, tente aceitar que a vergonha também é parte de você. Gradualmente acredite que aspectos imperfeitos também podem ser amados.",
                            control: "Esse coração querendo controlar tudo, eu entendo. Mas controle real às vezes vem de deixar ir. Pratique lentamente deixar ir coisas pequenas primeiro.",
                            vulnerability: "Você construiu paredes porque se sentia vulnerável. Mas essa vulnerabilidade pode se tornar sua maior força. Gradualmente confie nesse poder.",
                            comfort: "É verdade que dentro da parede era confortável. Mas conforto real seria se sentir bem com a parede existindo ou não. Tente construir esse tipo de confiança.",
                            escape: "Apenas ter o desejo de escapar significa que a mudança já começou. Valorize esse coração e siga em frente passo a passo.",
                            general: "Todas as paredes que você construiu contêm suas próprias razões e sabedoria. Não as derrube imprudentemente, mas tente renová-las em espaços onde você pode entrar e sair mais livremente."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Key", emoji: "🗝️",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            walls: "그 벽을 여는 열쇠는 당신이 벽을 만들 때 사용했던 바로 그 감정이에요. 벽을 쌓게 만든 상처를 이해하고 받아들일 때, 그 벽은 스스로 문이 됩니다.",
                            protection: "보호하려 했던 바로 그 마음이 이제는 보호를 벗어날 수 있는 힘이 되어 줄 거예요. 자신을 사랑했기에 보호했듯이, 이제는 자신을 사랑하기에 자유롭게 해주세요.",
                            trapped: "갇혀있다고 느낄 때 가장 필요한 열쇠는 '용서'예요. 벽을 만든 자신을, 그 벽에 갇힌 자신을 용서할 때 비로소 문이 열립니다.",
                            isolation: "고립에서 벗어나는 열쇠는 '연결에 대한 작은 시도'예요. 한 사람에게, 한 마디로, 한 번의 눈맞춤으로 시작하면 돼요. 작은 연결이 큰 변화를 만들어냅니다.",
                            fear: "두려움의 벽을 여는 열쇠는 '용기'가 아니라 '자비'예요. 두려워하는 자신을 다그치지 말고 따뜻하게 안아주세요. 자비가 두려움을 녹여줄 거예요.",
                            shame: "부끄러움의 벽을 여는 열쇠는 '불완전함의 수용'이에요. 완벽하지 않아도 괜찮다는 것을, 그런 모습도 사랑받을 수 있다는 것을 믿어보세요.",
                            control: "통제의 벽을 여는 열쇠는 '신뢰'예요. 자신에 대한 신뢰, 다른 사람에 대한 신뢰, 삶에 대한 신뢰. 조금씩 믿음을 회복해 나가세요.",
                            vulnerability: "취약함의 벽을 여는 열쇠는 '취약함 그 자체'예요. 약한 모습을 보이는 것이 진짜 강함이라는 걸 깨달을 때, 벽은 사라집니다.",
                            comfort: "편안함의 벽을 여는 열쇠는 '성장에 대한 욕구'예요. 지금보다 더 나은 자신이 되고 싶다는 마음이 당신을 벽 밖으로 이끌어낼 거예요.",
                            escape: "탈출의 열쇠는 이미 당신 손에 있어요. 그것은 '탈출하고 싶다는 마음' 그 자체입니다. 그 마음을 믿고 따라가세요.",
                            general: "모든 감정의 벽을 여는 만능 열쇠는 '자기 이해'예요. 왜 그 벽을 만들었는지, 지금 무엇이 필요한지 이해할 때 자연스럽게 길이 보일 거예요."
                        },
                        en: {
                            walls: "The key to opening that wall is the very emotion you used when building it. When you understand and accept the wounds that made you build the wall, that wall becomes a door on its own.",
                            protection: "That very heart that wanted to protect will now become the strength to move beyond protection. Just as you protected because you loved yourself, now set yourself free because you love yourself.",
                            trapped: "The key most needed when feeling trapped is 'forgiveness'. Only when you forgive yourself for building the wall and yourself for being trapped in it does the door finally open.",
                            isolation: "The key to escaping isolation is 'small attempts at connection'. Start with one person, one word, one moment of eye contact. Small connections create big changes.",
                            fear: "The key to opening fear's wall isn't 'courage' but 'compassion'. Don't scold yourself for being afraid, but warmly embrace yourself. Compassion will melt the fear.",
                            shame: "The key to opening shame's wall is 'acceptance of imperfection'. Believe that it's okay not to be perfect, that such aspects can also be loved.",
                            control: "The key to opening control's wall is 'trust'. Trust in yourself, trust in others, trust in life. Gradually restore your faith.",
                            vulnerability: "The key to opening vulnerability's wall is 'vulnerability itself'. When you realize that showing weakness is true strength, the wall disappears.",
                            comfort: "The key to opening comfort's wall is 'desire for growth'. The heart wanting to become a better version of yourself will lead you outside the wall.",
                            escape: "The key to escape is already in your hands. It is the very 'heart wanting to escape'. Trust and follow that heart.",
                            general: "The master key to opening all emotional walls is 'self-understanding'. When you understand why you built that wall and what you need now, the path will naturally become visible."
                        },
                        pt: {
                            walls: "A chave para abrir aquela parede é a própria emoção que você usou ao construí-la. Quando você entende e aceita as feridas que fizeram você construir a parede, aquela parede se torna uma porta por si só.",
                            protection: "Esse próprio coração que queria proteger agora se tornará a força para ir além da proteção. Assim como você protegeu porque se amava, agora se liberte porque se ama.",
                            trapped: "A chave mais necessária quando se sente preso é 'perdão'. Apenas quando você perdoa a si mesmo por construir a parede e a si mesmo por estar preso nela é que a porta finalmente se abre.",
                            isolation: "A chave para escapar do isolamento é 'pequenas tentativas de conexão'. Comece com uma pessoa, uma palavra, um momento de contato visual. Pequenas conexões criam grandes mudanças.",
                            fear: "A chave para abrir a parede do medo não é 'coragem' mas 'compaixão'. Não se repreenda por ter medo, mas se abrace com carinho. A compaixão derreterá o medo.",
                            shame: "A chave para abrir a parede da vergonha é 'aceitação da imperfeição'. Acredite que está tudo bem não ser perfeito, que tais aspectos também podem ser amados.",
                            control: "A chave para abrir a parede do controle é 'confiança'. Confiança em si mesmo, confiança nos outros, confiança na vida. Gradualmente restaure sua fé.",
                            vulnerability: "A chave para abrir a parede da vulnerabilidade é a 'própria vulnerabilidade'. Quando você percebe que mostrar fraqueza é verdadeira força, a parede desaparece.",
                            comfort: "A chave para abrir a parede do conforto é 'desejo de crescimento'. O coração querendo se tornar uma versão melhor de si mesmo te levará para fora da parede.",
                            escape: "A chave para escapar já está em suas mãos. É o próprio 'coração querendo escapar'. Confie e siga esse coração.",
                            general: "A chave mestra para abrir todas as paredes emocionais é 'autocompreensão'. Quando você entende por que construiu aquela parede e o que precisa agora, o caminho naturalmente se tornará visível."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Freedom", emoji: "🕊️",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            walls: "진정한 자유는 벽이 없는 상태가 아니라 벽이 있어도 없어도 괜찮다고 느끼는 상태예요. 벽을 허물 때도, 다시 세울 때도 자신의 선택으로 할 수 있을 때 그것이 진짜 자유입니다.",
                            protection: "보호받고 싶다는 욕구는 자연스러워요. 하지만 가장 좋은 보호는 스스로를 믿는 것에서 나와요. 어떤 상황이 와도 자신을 지킬 수 있다는 믿음이 진짜 보호입니다.",
                            trapped: "갇혔다고 느끼는 순간이 실은 가장 자유로워질 수 있는 순간이에요. 왜냐하면 그때야 비로소 자유가 얼마나 소중한지 깨닫게 되니까요. 그 깨달음이 당신을 자유롭게 할 거예요.",
                            isolation: "진정한 연결은 고립을 경험해본 사람만이 만들 수 있어요. 혼자였던 시간이 당신에게 진짜 연결의 의미를 가르쳐줬을 거예요. 이제 그 지혜로 새로운 관계를 만들어가세요.",
                            fear: "두려움을 없애려 하지 마세요. 두려움과 함께 살아가는 법을 배우세요. 두려워하면서도 앞으로 나아갈 수 있을 때, 그것이 진정한 용기이고 자유입니다.",
                            shame: "부끄러움도 당신의 일부예요. 그것을 숨기려 하지 말고 받아들이세요. 불완전한 자신을 사랑할 수 있을 때 비로소 완전한 자유를 경험하게 될 거예요.",
                            control: "모든 것을 통제하려는 욕구를 놓아주세요. 통제할 수 없는 것들에 대해서는 받아들이고, 통제할 수 있는 것들에 집중하세요. 그 구분이 진정한 자유의 시작입니다.",
                            vulnerability: "취약함을 받아들이는 것이 가장 강한 모습이에요. 약한 모습을 보여도 괜찮다고 느낄 때, 당신은 가장 자유로운 상태가 될 거예요.",
                            comfort: "편안함도 좋지만 성장도 필요해요. 편안함과 성장 사이에서 균형을 찾으세요. 둘 다 선택할 수 있는 자유가 당신에게 있습니다.",
                            escape: "탈출하고 싶다는 마음 자체가 이미 자유의 시작이에요. 그 마음을 따라가면서 천천히, 하지만 확실하게 자신만의 자유를 찾아가세요.",
                            general: "진정한 자유는 외부 조건에 달려있지 않아요. 마음의 자유가 진짜 자유입니다. 어떤 상황에서도 선택할 수 있는 내적 자유를 키워나가세요."
                        },
                        en: {
                            walls: "True freedom isn't a state without walls, but feeling okay whether walls exist or not. When you can choose to tear down walls or build them again, that's real freedom.",
                            protection: "The desire to be protected is natural. But the best protection comes from believing in yourself. The belief that you can protect yourself in any situation is true protection.",
                            trapped: "The moment you feel trapped is actually when you can become most free. Because that's when you finally realize how precious freedom is. That realization will set you free.",
                            isolation: "True connection can only be created by those who've experienced isolation. The time you were alone taught you the meaning of real connection. Now create new relationships with that wisdom.",
                            fear: "Don't try to eliminate fear. Learn to live with fear. When you can move forward while being afraid, that's true courage and freedom.",
                            shame: "Shame is also part of you. Don't try to hide it, but accept it. When you can love your imperfect self, you'll finally experience complete freedom.",
                            control: "Let go of the desire to control everything. Accept what you can't control and focus on what you can. That distinction is the beginning of true freedom.",
                            vulnerability: "Accepting vulnerability is the strongest form. When you feel okay showing weakness, you'll be in your most free state.",
                            comfort: "Comfort is good but growth is also necessary. Find balance between comfort and growth. You have the freedom to choose both.",
                            escape: "The very heart wanting to escape is already the beginning of freedom. Follow that heart and slowly but surely find your own freedom.",
                            general: "True freedom doesn't depend on external conditions. Mental freedom is real freedom. Cultivate the internal freedom to choose in any situation."
                        },
                        pt: {
                            walls: "Verdadeira liberdade não é um estado sem paredes, mas se sentir bem com paredes existindo ou não. Quando você pode escolher derrubar paredes ou construí-las novamente, essa é a liberdade real.",
                            protection: "O desejo de ser protegido é natural. Mas a melhor proteção vem de acreditar em si mesmo. A crença de que você pode se proteger em qualquer situação é proteção verdadeira.",
                            trapped: "O momento que você se sente preso é na verdade quando você pode se tornar mais livre. Porque é quando você finalmente percebe quão preciosa é a liberdade. Essa percepção te libertará.",
                            isolation: "Verdadeira conexão só pode ser criada por aqueles que experimentaram isolamento. O tempo que você esteve sozinho te ensinou o significado de conexão real. Agora crie novos relacionamentos com essa sabedoria.",
                            fear: "Não tente eliminar o medo. Aprenda a viver com o medo. Quando você pode seguir em frente mesmo com medo, essa é verdadeira coragem e liberdade.",
                            shame: "Vergonha também é parte de você. Não tente escondê-la, mas aceite-a. Quando você pode amar seu eu imperfeito, finalmente experimentará liberdade completa.",
                            control: "Deixe ir o desejo de controlar tudo. Aceite o que você não pode controlar e foque no que pode. Essa distinção é o começo da verdadeira liberdade.",
                            vulnerability: "Aceitar vulnerabilidade é a forma mais forte. Quando você se sente bem mostrando fraqueza, estará em seu estado mais livre.",
                            comfort: "Conforto é bom mas crescimento também é necessário. Encontre equilíbrio entre conforto e crescimento. Você tem a liberdade de escolher ambos.",
                            escape: "O próprio coração querendo escapar já é o começo da liberdade. Siga esse coração e lenta mas certamente encontre sua própria liberdade.",
                            general: "Verdadeira liberdade não depende de condições externas. Liberdade mental é liberdade real. Cultive a liberdade interna para escolher em qualquer situação."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en'; // 기본 언어를 영어로 설정
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        // ============ 여정 초기화 함수 ============
        
        function resetJourney() {
            console.log('=== 여정 초기화 시작 ===');
            
            // 1. 모든 타이핑 효과 완전 정리
            clearAllTypingEffects();
            
            // 추가 안전장치 - 모든 timer 정리
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            // 2. 모든 콘텐츠 섹션 완전 초기화
            const sectionsToReset = [
                'portalIntroSection',
                'characterResponsesSection', 
                'lightMessageSection',
                'portalQuestionSection',
                'userInputSection',
                'userReactionsSection',
                'continueSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    } else {
                        const textElements = section.querySelectorAll('.portal-intro, .light-message, .portal-question, .continue-text');
                        textElements.forEach(el => {
                            el.innerHTML = '';
                            el.textContent = '';
                        });
                    }
                }
            });
            
            // 3. 특정 요소들 개별 초기화
            const portalIntro = document.getElementById('portalIntro');
            const lightMessage = document.getElementById('lightMessage');
            const portalQuestion = document.getElementById('portalQuestion');
            const continueText = document.getElementById('continueText');
            
            if (portalIntro) portalIntro.innerHTML = '';
            if (lightMessage) lightMessage.innerHTML = '';
            if (portalQuestion) portalQuestion.innerHTML = '';
            if (continueText) continueText.innerHTML = '';
            
            // 4. 텍스트영역 완전 초기화
            const userTextarea = document.getElementById('userTextarea');
            if (userTextarea) {
                userTextarea.disabled = false;
                userTextarea.value = '';
                userTextarea.style.height = 'auto';
                userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            }
            
            // 5. 스크롤 위치 초기화
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.scrollTop = 0;
            }
            
            // 6. 상태 변수 완전 초기화
            userResponse = '';
            currentTypingElement = null;
            
            console.log('=== 여정 초기화 완료 ===');
        }
        
        // ============ 개선된 언어 변경 함수 ============
        
        function changeLanguage(lang) {
            if (!translations[lang]) {
                console.error('지원하지 않는 언어:', lang);
                return;
            }
            
            if (currentLanguage === lang) {
                return;
            }
            
            if (journeyStarted) {
                const confirmMessage = translations[currentLanguage].languageChangeConfirm;
                const shouldRestart = confirm(confirmMessage);
                
                if (!shouldRestart) {
                    return;
                }
            }
            
            const previousLanguage = currentLanguage;
            currentLanguage = lang;
            
            console.log(`언어 변경: ${previousLanguage} → ${currentLanguage}`);
            
            if (journeyStarted) {
                resetJourney();
            }
            
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                setTimeout(() => {
                    console.log(`새로운 언어(${currentLanguage})로 여정 재시작`);
                    startPortalSequence();
                }, 1000);
            }
        }
        
        // ============ UI 업데이트 함수들 ============
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            // 개별 요소 업데이트
            const elements = [
                'logoSubtitle',
                'portalMainTitle', 
                'portalSubtitle',
                'lightTitle',
                'continueYesBtn',
                'continueNoBtn'
            ];
            
            elements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element && translations[lang]) {
                    const key = elementId.replace('Btn', 'Button').replace('Subtitle', 'Subtitle');
                    let translationKey = key;
                    
                    const keyMapping = {
                        'logoSubtitle': 'logoSubtitle',
                        'portalMainTitle': 'portalMainTitle',
                        'portalSubtitle': 'portalSubtitle',
                        'lightTitle': 'lightTitle',
                        'continueYesButton': 'continueYes',
                        'continueNoButton': 'continueNo'
                    };
                    
                    translationKey = keyMapping[key] || key;
                    
                    if (translations[lang][translationKey]) {
                        element.textContent = translations[lang][translationKey];
                    }
                }
            });
            
            // placeholder 업데이트
            const textarea = document.getElementById('userTextarea');
            if (textarea) textarea.placeholder = translations[lang].inputPlaceholder;
        }
        
        // ============ 개선된 타이핑 효과 + 스크롤 추적 시스템 ============
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        
                        setTimeout(() => {
                            if (document.contains(element)) {
                                scrollToFollowTyping(element);
                            }
                        }, 200);
                        
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        // ============ 스마트 스크롤 시스템 ============
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        // ============ 언어 버튼 이벤트 설정 ============
        
        function setupLanguageButtons() {
            const langButtons = document.querySelectorAll('.lang-btn');
            
            langButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const newLang = this.dataset.lang;
                    changeLanguage(newLang);
                });
            });
        }
        
        // ============ 메인 여정 시스템 ============
        
        function initializeTemarix() {
            console.log('=== Temarix Portal 12 초기화 시작 ===');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        // ============ 여정 단계들 ============
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            const introText = translations[currentLanguage].portalIntro;
            await typewriterEffect(introElement, introText, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = `${char.emoji} ${char.name}`;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const dialogueText = translations[currentLanguage][char.key];
                await typewriterEffect(dialogueDiv, dialogueText, 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            const lightText = translations[currentLanguage].lightMessage;
            await typewriterEffect(lightMessageEl, lightText, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            const questionText = translations[currentLanguage].portalQuestion;
            await typewriterEffect(questionEl, questionText, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        // ============ 사용자 입력 시스템 ============
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', handleTextareaKeydown);
            
            document.getElementById('continueYesBtn').addEventListener('click', function() {
                processContinue('Y');
            });
            
            document.getElementById('continueNoBtn').addEventListener('click', function() {
                processContinue('N');
            });
        }
        
        function handleTextareaKeydown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                const inputValue = this.value.trim();
                
                if (inputValue) {
                    processUserInput(inputValue);
                }
            }
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = `<strong>${youLabel}:</strong> "${text}"`;
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = `${char.emoji} ${char.name}`;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showContinueOption();
            }, 2000);
        }
        
        async function showContinueOption() {
            const continueSection = document.getElementById('continueSection');
            const continueText = document.getElementById('continueText');
            
            continueSection.classList.add('show');
            
            const questionText = translations[currentLanguage].continueText;
            await typewriterEffect(continueText, questionText, 50);
            
            setTimeout(() => {
                scrollToElement(continueSection);
            }, 500);
        }
        
        function processContinue(input) {
            if (input === 'Y') {
                const message = currentLanguage === 'ko' ? 
                    'Portal 13이 곧 준비됩니다. 계속해서 더 깊은 감정의 여정이 이어집니다.' :
                    currentLanguage === 'en' ? 
                    'Portal 13 will be ready soon. The journey into deeper emotions continues.' :
                    'Portal 13 estará pronto em breve. A jornada para emoções mais profundas continua.';
                alert(message);
            } else if (input === 'N') {
                const message = currentLanguage === 'ko' ? 
                    '여정이 일시 중지되었습니다. 언제든 다시 돌아와 계속하세요.' :
                    currentLanguage === 'en' ? 
                    'The journey has been paused. Come back and continue anytime.' :
                    'A jornada foi pausada. Volte e continue a qualquer momento.';
                alert(message);
            }
        }
        
        // ============ 초기화 ============
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V2 Portal 12 DOM 로드 완료');
            
            // 자동 로그인 처리 (로그인 모달 제거)
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>