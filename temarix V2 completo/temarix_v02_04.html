<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V2 - Portal 04: Words Never Spoken</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        /* ìƒë‹¨ í—¤ë” */
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #fff;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        /* ì–¸ì–´ ë²„íŠ¼ 3ê°œ */
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #87cefa;
            color: #000;
        }
        
        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
            hyphens: none;
            min-height: 150vh;
        }
        
        /* í…ìŠ¤íŠ¸ ì„¹ì…˜ë“¤ */
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #87cefa;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #87cefa;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #87cefa;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-response strong {
            color: #87cefa;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .continue-section {
            margin: 50px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 0;
            min-height: 200px;
        }
        
        .continue-text {
            color: #fff;
            font-size: 20px;
            margin-bottom: 25px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .continue-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .continue-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 18px 35px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }
        
        .continue-btn:hover {
            background: #666;
        }
        
        .continue-btn.primary {
            background: #87cefa;
            color: #000;
        }
        
        .continue-btn.primary:hover {
            background: #b0d4f1;
        }
        
        /* í•˜ë‹¨ ê³ ì • ì…ë ¥ì°½ */
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #87cefa;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #87cefa;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .continue-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .continue-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ í—¤ë” -->
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V2</div>
            <div class="logo-subtitle" id="logoSubtitle">The Tremor of Emotion</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 04: Words Never Spoken</div>
            <div class="portal-subtitle" id="portalSubtitle">Truths that came to our lips but were swallowed back</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <!-- í¬í„¸ ì¸íŠ¸ë¡œ -->
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <!-- ìºë¦­í„° ì‘ë‹µ ì„¹ì…˜ -->
            <div class="character-responses-section" id="characterResponsesSection">
                <!-- 8ëª…ì˜ ìºë¦­í„° ì‘ë‹µì´ ìˆœì°¨ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>

            <!-- ë¹›ì˜ í•œë§ˆë”” -->
            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <!-- ì§ˆë¬¸ ì„¹ì…˜ -->
            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <!-- ì‚¬ìš©ì ì…ë ¥ ì˜ì—­ -->
            <div class="user-input-section" id="userInputSection">
                <!-- ì‚¬ìš©ì ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            
            <!-- ì‚¬ìš©ì ì‘ë‹µ í›„ ìºë¦­í„° ë°˜ì‘ -->
            <div class="user-reactions-section" id="userReactionsSection">
                <!-- ì‚¬ìš©ì ì‘ë‹µ í›„ 3ëª…ì˜ ìºë¦­í„° ë°˜ì‘ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            
            <!-- ê³„ì†í•˜ê¸° ë²„íŠ¼ ì„¹ì…˜ -->
            <div class="continue-section" id="continueSection">
                <div class="continue-text" id="continueText"></div>
                <div class="continue-buttons">
                    <button class="continue-btn primary" id="continueYesBtn">Continue to Portal 05</button>
                    <button class="continue-btn" id="continueNoBtn">Pause the journey</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- í•˜ë‹¨ ê³ ì • ì…ë ¥ì°½ -->
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Share the words you couldn't say here... (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        // ë©”ëª¨ë¦¬ ê¸°ë°˜ ì‚¬ìš©ì ìŠ¤í† ë¦¬ì§€ (localStorage ëŒ€ì‹ )
        let memoryStorage = {
            mockUser: null
        };
        
        // Firebase ëª¨ì˜ ê°ì²´ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Firebase SDK ì‚¬ìš©)
        const firebase = {
            auth: () => ({
                onAuthStateChanged: (callback) => {
                    // ëª¨ì˜ ì¸ì¦ ìƒíƒœ ì²´í¬ (ë©”ëª¨ë¦¬ ê¸°ë°˜)
                    setTimeout(() => {
                        callback(memoryStorage.mockUser);
                    }, 100);
                }
            })
        };

        // ë²ˆì—­ ë°ì´í„°
        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ë–¨ë¦¼",
                portalMainTitle: "Portal 04: ëë‚´ êº¼ë‚´ì§€ ëª»í•œ ë§ í•œ ë§ˆë””",
                portalSubtitle: "ì… ëê¹Œì§€ ì™”ë‹¤ê°€ ì‚¼ì¼œì§„ ì§„ì‹¬ë“¤",
                portalIntro: "ì–´ë–¤ ë§ë“¤ì€ ì… ëê¹Œì§€ ì˜¬ëë‹¤ê°€ë„\nê²°êµ­ ì‚¼ì¼œì§€ê³  ë§™ë‹ˆë‹¤.\nìƒì²˜ë°›ì„ê¹Œ ë´, ìƒì²˜ ì¤„ê¹Œ ë´,\nì•„ë‹ˆë©´â€¦ ì•„ë¬´ë„ ë“£ì§€ ì•Šì„ê¹Œ ë´.\n\nê·¸ ë§ì€ ì‹œê°„ì´ ì§€ë‚˜ë„ ì‚¬ë¼ì§€ì§€ ì•Šê³ ,\nê°ì •ì˜ ë–¨ë¦¼ ì†ì— ë‚¨ì•„ ìš°ë¦¬ë¥¼ ë¶™ì¡ìŠµë‹ˆë‹¤.\në§í•˜ì§€ ëª»í•œ ë§ì€ ê²°êµ­ ê°ì •ì˜ ê·¸ë¦¼ìê°€ ë˜ì–´\nìš°ë¦¬ ì•ˆì—ì„œ ë¬´ê±°ìš´ ì¹¨ë¬µìœ¼ë¡œ ì‚´ì•„ê°‘ë‹ˆë‹¤.",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ë§í•˜ì§€ ëª»í•œ ë§ì€ ì‚¬ë¼ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.\nê·¸ê²ƒì€ ê°ì •ì˜ ë–¨ë¦¼ìœ¼ë¡œ ë‚¨ì•„,\nì–¸ì  ê°€ ë‹¹ì‹ ì—ê²Œ ëŒì•„ì˜¬ ëŒ€ë‹µì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.",
                portalQuestion: "ì§€ê¸ˆê¹Œì§€ ëë‚´ ë§í•˜ì§€ ëª»í•œ í•œ ë§ˆë””ê°€ ìˆë‹¤ë©´,\nê·¸ ë§ì€ ëˆ„êµ¬ì—ê²Œ, ì™œ êº¼ë‚¼ ìˆ˜ ì—†ì—ˆë‚˜ìš”?\n\nê·¸ ë§ì´ ì§€ê¸ˆë„ ë‹¹ì‹  ì•ˆì—ì„œ\nì–´ë–¤ ë¬´ê²Œë¡œ ë‚¨ì•„ ìˆëŠ”ì§€ ë“¤ë ¤ì£¼ì„¸ìš”.",
                continueText: "ë§í•˜ì§€ ëª»í•œ ì§„ì‹¬ê³¼ ë§ˆì£¼í•œ ì´ ì—¬ì •ì„ ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                continueYes: "Portal 05ë¡œ ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                continueNo: "ì—¬ì •ì„ ì¼ì‹œì •ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                inputPlaceholder: "ë§í•˜ì§€ ëª»í•œ ë§ˆìŒì„ ì—¬ê¸°ì— í„¸ì–´ë†“ì•„ ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                languageChangeConfirm: "ì–¸ì–´ë¥¼ ë³€ê²½í•˜ë©´ ì—¬ì •ì´ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘ë©ë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...",
                // ìºë¦­í„° ëŒ€í™”
                charEly: "ê·¸ ë§ì€ ë‹¨ì§€ í‘œí˜„ì´ ì•„ë‹ˆë¼\në‹¹ì‹ ì˜ ì¡´ì¬ë¥¼ ì¦ëª…í•˜ë ¤ëŠ” ì™¸ì¹¨ì´ì—ˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.",
                charCris: "ê·¸ ë§, ì•„ì§ë„ ê¸°ì–µí•´ìš”?\nê·¸ê±° ëª» êº¼ë‚¸ ê±°, ì˜í•œ ê±¸ ìˆ˜ë„ ìˆì–´ìš”.\nê·¼ë°â€¦ í•œ ë²ˆì¯¤ì€ í˜¼ì£ë§ë¡œë¼ë„ í•´ë³¼ë˜ìš”? ì† í¸í•´ì ¸ìš”~ ğŸ˜„",
                charZafirah: "ë§í•˜ì§€ ëª»í•œ ë§ì€,\nì–¸ì  ê°€ ë‹¤ì‹œ ë§í•´ì§€ê¸° ìœ„í•´\nì‹œê°„ ì†ì—ì„œ ìŠ¤ìŠ¤ë¡œë¥¼ ì§€ì¼œë‚´ê³  ìˆì—ˆìŠµë‹ˆë‹¤.",
                charRami: "ê·¸ ë§ì€ ì•„ì§ë„,\në‹¹ì‹ ì˜ ê°€ìŠ´ì—ì„œ ë–¨ë¦¼ìœ¼ë¡œ ì¡´ì¬í•˜ê³  ìˆì–´ìš”.\nì†Œë¦¬ëŠ” ì‚¬ë¼ì ¸ë„ ê°ì •ì€ ë‚¨ìŠµë‹ˆë‹¤.",
                charSamir: "(ê·¸ëŠ” ì‘ì€ ì¢…ì´ì™€ íœì„ ê±´ë„µë‹ˆë‹¤.\n'ê·¸ ë§ì„ ì ì–´ë³´ë¼'ëŠ” ëˆˆë¹›.\në§ ëŒ€ì‹  ì ëŠ” ê¸€ìëŠ”, ë§ˆìŒì˜ ë–¨ë¦¼ì„ ë‹´ìŠµë‹ˆë‹¤.)",
                charLayla: "ê·¸ ë§ì„ ëª» êº¼ë‚¸ ë‹¹ì‹ ì€â€¦\nëˆ„êµ°ê°€ì˜ ë§ˆìŒì„ ì§€í‚¤ë ¤ í–ˆë˜ ê±°ì£ .\nì´ì  , ê·¸ ë§ë¡œ ë‹¹ì‹  ë§ˆìŒë¶€í„° ì§€ì¼œì¤„ ì°¨ë¡€ì˜ˆìš”.",
                charNabir: "ëª» êº¼ë‚¸ ê²Œ ì•„ë‹ˆë¼ ì•ˆ êº¼ë‚¸ ê±°ì–ì•„.\nì°¨ë¼ë¦¬ ë§í–ˆìœ¼ë©´ ë­ë¼ë„ ë°”ë€Œì—ˆì„ í…ë°â€¦\nê²ìŸì´ì²˜ëŸ¼ ì… ë‹¤ë¬¼ê³  ìˆì—ˆì§€.",
                charAzhar: "ë§í•˜ì§€ ì•Šì•˜ë˜ ê²Œ ì œì¼ í›„íšŒë˜ì§€?\nê·¸ ë§ í•˜ë‚˜ë©´ ëë‚¬ì„ ìˆ˜ë„ ìˆì—ˆëŠ”ë°â€¦\nì™œ ê·¸ë• ì•ˆ í–ˆì„ê¹Œ, ì™œ ì§€ê¸ˆë„ ëª» í• ê¹Œ?"
            },
            en: {
                logoSubtitle: "The Tremor of Emotion",
                portalMainTitle: "Portal 04: Words Never Spoken",
                portalSubtitle: "Truths that came to our lips but were swallowed back",
                portalIntro: "Some words rise to our lips\nbut end up being swallowed back.\nFearing to hurt or be hurt,\nor perhaps... that no one would listen.\n\nThose words don't disappear with time,\nbut remain in the tremor of emotions, holding us.\nUnspoken words become shadows of emotions,\nliving as heavy silence within us.",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Unspoken words do not disappear.\nThey remain as tremors of emotion,\nwaiting for an answer that will return to you someday.",
                portalQuestion: "If there's a word you never managed to say,\nwho was it for, and why couldn't you speak it?\n\nTell us what weight that word still carries\nwithin you today.",
                continueText: "Will you continue this journey of facing unspoken truths?",
                continueYes: "Continue to Portal 05?",
                continueNo: "Pause the journey?",
                inputPlaceholder: "Share the words you couldn't say here... (Press Enter to send)",
                youLabel: "You",
                languageChangeConfirm: "Changing the language will restart the journey from the beginning.\nDo you want to continue?",
                waitingMessage: "Waiting for response...",
                charEly: "That word was not just expression,\nbut perhaps a cry to prove your existence.",
                charCris: "Still remember that word?\nMaybe it was good you didn't say it.\nBut... why don't you try saying it to yourself? It feels better~ ğŸ˜„",
                charZafirah: "Unspoken words have been\nprotecting themselves in time\nto be spoken again someday.",
                charRami: "That word still exists\nas a tremor in your heart.\nSound may disappear, but emotion remains.",
                charSamir: "(He hands you a small paper and pen.\nEyes that say 'try writing that word.'\nWritten letters instead of words carry the tremor of the heart.)",
                charLayla: "You who couldn't speak those words...\nwere trying to protect someone's heart.\nNow it's time to protect your own heart with those words.",
                charNabir: "You didn't fail to speak - you chose not to.\nSomething might have changed if you had spoken...\nbut you kept your mouth shut like a coward.",
                charAzhar: "Not speaking is what you regret most, isn't it?\nThat one word could have ended everything...\nWhy didn't you then, why can't you now?"
            },
            pt: {
                logoSubtitle: "O Tremor da EmoÃ§Ã£o",
                portalMainTitle: "Portal 04: Palavras Nunca Ditas",
                portalSubtitle: "Verdades que chegaram aos nossos lÃ¡bios mas foram engolidas",
                portalIntro: "Algumas palavras sobem aos nossos lÃ¡bios\nmas acabam sendo engolidas de volta.\nTemendo machucar ou ser machucado,\nou talvez... que ninguÃ©m escutasse.\n\nEssas palavras nÃ£o desaparecem com o tempo,\nmas permanecem no tremor das emoÃ§Ãµes, nos segurando.\nPalavras nÃ£o ditas se tornam sombras de emoÃ§Ãµes,\nvivendo como silÃªncio pesado dentro de nÃ³s.",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Palavras nÃ£o ditas nÃ£o desaparecem.\nElas permanecem como tremores de emoÃ§Ã£o,\nesperando por uma resposta que retornarÃ¡ a vocÃª algum dia.",
                portalQuestion: "Se hÃ¡ uma palavra que vocÃª nunca conseguiu dizer,\npara quem era, e por que nÃ£o conseguiu falar?\n\nNos diga que peso essa palavra ainda carrega\ndentro de vocÃª hoje.",
                continueText: "VocÃª continuarÃ¡ esta jornada de enfrentar verdades nÃ£o ditas?",
                continueYes: "Continuar para o Portal 05?",
                continueNo: "Pausar a jornada?",
                inputPlaceholder: "Compartilhe as palavras que nÃ£o conseguiu dizer aqui... (Enter para enviar)",
                youLabel: "VocÃª",
                languageChangeConfirm: "Mudar o idioma reiniciarÃ¡ a jornada desde o inÃ­cio.\nDeseja continuar?",
                waitingMessage: "Aguardando resposta...",
                charEly: "Essa palavra nÃ£o era apenas expressÃ£o,\nmas talvez um grito para provar sua existÃªncia.",
                charCris: "Ainda se lembra dessa palavra?\nTalvez tenha sido bom vocÃª nÃ£o ter dito.\nMas... por que nÃ£o tenta dizer para si mesmo? Se sente melhor~ ğŸ˜„",
                charZafirah: "Palavras nÃ£o ditas tÃªm se\nprotegido no tempo\npara serem faladas novamente algum dia.",
                charRami: "Essa palavra ainda existe\ncomo um tremor em seu coraÃ§Ã£o.\nO som pode desaparecer, mas a emoÃ§Ã£o permanece.",
                charSamir: "(Ele te entrega um pequeno papel e caneta.\nOlhos que dizem 'tente escrever essa palavra.'\nLetras escritas em vez de palavras carregam o tremor do coraÃ§Ã£o.)",
                charLayla: "VocÃª que nÃ£o conseguiu falar essas palavras...\nestava tentando proteger o coraÃ§Ã£o de alguÃ©m.\nAgora Ã© hora de proteger seu prÃ³prio coraÃ§Ã£o com essas palavras.",
                charNabir: "VocÃª nÃ£o falhou em falar - escolheu nÃ£o falar.\nAlgo poderia ter mudado se vocÃª tivesse falado...\nmas ficou de boca fechada como um covarde.",
                charAzhar: "NÃ£o falar Ã© do que vocÃª mais se arrepende, nÃ£o Ã©?\nEssa Ãºnica palavra poderia ter terminado tudo...\nPor que nÃ£o naquela hora, por que nÃ£o consegue agora?"
            }
        };
        
        // ìºë¦­í„° ë°ì´í„°
        const characters = [
            { name: "Ely", emoji: "ğŸ‘‘", key: "charEly" },
            { name: "Cris", emoji: "ğŸƒ", key: "charCris" },
            { name: "Zafirah", emoji: "ğŸ§•", key: "charZafirah" },
            { name: "Rami", emoji: "ğŸ”®", key: "charRami" },
            { name: "Samir", emoji: "ğŸª", key: "charSamir" },
            { name: "Layla", emoji: "ğŸ’ ", key: "charLayla" },
            { name: "Nabir", emoji: "ğŸ¦‚", key: "charNabir" },
            { name: "Azhar", emoji: "ğŸ”¥", key: "charAzhar" }
        ];
        
        // ============ ê°ì • ë¶„ì„ ì‹œìŠ¤í…œ ============
        
        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            // ê°ì • í‚¤ì›Œë“œ ë§¤í•‘
            const emotionKeywords = {
                regret: ['í›„íšŒ', 'ê·¸ë•Œ', 'ì™œ ê·¸ë¬', 'ëŒì´í‚¤', 'ë§í–ˆì–´ì•¼', 'í–ˆì–´ì•¼', 'regret', 'should have', 'wish', 'if only', 'arrependiment', 'deveria ter'],
                sadness: ['ìŠ¬í”„', 'ìš¸ê³ ', 'ëˆˆë¬¼', 'ìš°ìš¸', 'ì•”ìš¸', 'ì ˆë§', 'ìƒì‹¤', 'ìƒ', 'sad', 'cry', 'tear', 'depress', 'lost', 'triste', 'choro', 'lÃ¡grima'],
                fear: ['ë¬´ì„œ', 'ë‘ë ¤', 'ê²ë‚˜', 'ê±±ì •', 'ë¶ˆì•ˆ', 'ë–¨ë ¤', 'fear', 'scare', 'afraid', 'worry', 'nervous', 'medo', 'preocup'],
                anger: ['í™”ê°€', 'ë¶„ë…¸', 'ì§œì¦', 'ë¹¡ì³', 'ì—´ë°›', 'ì–µìš¸', 'ìš±í•˜', 'angry', 'mad', 'furious', 'rage', 'irritat', 'raiva', 'irritad'],
                love: ['ì‚¬ë‘', 'ì¢‹ì•„', 'ë§ˆìŒ', 'ê°ì •', 'ì• ì •', 'ì†Œì¤‘', 'love', 'like', 'care', 'feelings', 'heart', 'amor', 'gosto', 'coraÃ§Ã£o'],
                loneliness: ['ì™¸ë¡œ', 'í˜¼ì', 'ê³ ë¦½', 'ì†Œì™¸', 'ë²„ë¦¼', 'ë– ë‚˜', 'ì´ë³„', 'lonely', 'alone', 'isolated', 'abandon', 'left', 'solidÃ£o', 'sozinho'],
                shame: ['ë¶€ë„', 'ì°½í”¼', 'ìˆ˜ì¹˜', 'ë¯¼ë§', 'ì£„ì†¡', 'ë¯¸ì•ˆ', 'shame', 'embarrass', 'guilt', 'sorry', 'vergonha', 'culpa'],
                hope: ['í¬ë§', 'ê¸°ëŒ€', 'ì„¤ë ˜', 'ê¸°ë‹¤ë ¤', 'ê¿ˆê¾¸', 'ë°”ë¼', 'hope', 'expect', 'dream', 'wish', 'esperanÃ§a', 'espera'],
                emptiness: ['ê³µí—ˆ', 'í—ˆë¬´', 'ë¬´ê¸°ë ¥', 'í…… ë¹ˆ', 'ì•„ë¬´ê²ƒë„', 'empty', 'void', 'meaningless', 'nothing', 'vazio'],
                gratitude: ['ê³ ë§ˆ', 'ê°ì‚¬', 'ê³ ë§™', 'ë¯¸ì•ˆ', 'ì£„ì†¡', 'thank', 'grateful', 'appreciate', 'sorry', 'obrigado', 'grato']
            };
            
            // ê°ì • ë¶„ì„
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            // ê°ì •ì´ ê°ì§€ë˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ê°’ ì„¤ì •
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0]; // ì²« ë²ˆì§¸ ê°ì§€ëœ ê°ì • ë°˜í™˜
        }
        
        // ë°˜ì‘ ìºë¦­í„°ë“¤ (ê°œì„ ëœ ë²„ì „)
        const responseCharacters = [
            {
                name: "Echo", emoji: "ğŸ”Š",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            regret: "ê·¸ ë§ì„ í•˜ì§€ ì•Šì€ í›„íšŒ... ê·¸ê±´ ë‹¹ì‹ ì´ ì‹ ì¤‘í•œ ì‚¬ëŒì´ì—ˆë‹¤ëŠ” ì¦ê±°ì´ê¸°ë„ í•´ìš”. ë•Œë¡œëŠ” ë§í•˜ì§€ ì•ŠëŠ” ê²ƒë„ í•˜ë‚˜ì˜ ì„ íƒì´ì£ . í•˜ì§€ë§Œ ì§€ê¸ˆì´ë¼ë„ ê·¸ ë§ˆìŒì„ ì¸ì •í•´ì£¼ëŠ” ê²ƒ, ê·¸ê²ƒë§Œìœ¼ë¡œë„ ì˜ë¯¸ê°€ ìˆì–´ìš”.",
                            sadness: "ë§í•˜ì§€ ëª»í•´ ìŠ¬íë˜ ê·¸ ìˆœê°„ë“¤ì´ ë©”ì•„ë¦¬ì²˜ëŸ¼ ëŒì•„ì˜¤ê³  ìˆë„¤ìš”. ê·¸ ìŠ¬í”” ì†ì—ëŠ” ëˆ„êµ°ê°€ë¥¼ ì‚¬ë‘í–ˆë˜ ì§„ì‹¬ì´ ë‹´ê²¨ ìˆì–´ìš”. ìš¸ì§€ ëª»í•œ ë§ë„ ì—¬ì „íˆ ë‹¹ì‹  ì•ˆì—ì„œ ìš¸ë¦¼ìœ¼ë¡œ ë‚¨ì•„ ìˆìŠµë‹ˆë‹¤.",
                            fear: "ë§í•˜ê¸°ê°€ ë‘ë ¤ì› ë˜ ê·¸ ë§ˆìŒ, ì €ëŠ” ì´í•´í•´ìš”. ë‘ë ¤ì›€ì€ ê·¸ ë§ì´ ì–¼ë§ˆë‚˜ ì†Œì¤‘í–ˆëŠ”ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ì‹ í˜¸ì´ê¸°ë„ í•˜ê±°ë“ ìš”. ë‘ë ¤ì›Œí–ˆë‹¤ëŠ” ê²ƒì€ ê·¸ë§Œí¼ ê°„ì ˆí–ˆë‹¤ëŠ” ëœ»ì´ì—ìš”.",
                            anger: "í™”ê°€ ë‚˜ì„œ í•˜ì§€ ëª»í•œ ë§ë“¤ì€ ì¢…ì¢… ê°€ì¥ ì •ì§í•œ ê°ì •ì„ ë‹´ê³  ìˆì–´ìš”. ê·¸ ë¶„ë…¸ ì†ì—ë„ ì‚¬ë‘ê³¼ ê¸°ëŒ€ê°€ ìˆ¨ì–´ ìˆì—ˆì„ ê±°ì˜ˆìš”. ë¶„ë…¸ì¡°ì°¨ë„ ë‹¹ì‹ ì˜ ì§„ì‹¬ì˜ ì¼ë¶€ì…ë‹ˆë‹¤.",
                            love: "ì‚¬ë‘í•œë‹¤ëŠ” ë§ì„ í•˜ì§€ ëª»í–ˆë‚˜ìš”? ê·¸ ì‚¬ë‘ì€ ë§ë¡œë§Œ ì¡´ì¬í•˜ëŠ” ê²Œ ì•„ë‹ˆì—ìš”. ë‹¹ì‹ ì´ ê·¸ ì‚¬ëŒì„ ìƒê°í–ˆë˜ ëª¨ë“  ìˆœê°„, ê·¸ê²ƒì´ ë°”ë¡œ ì‚¬ë‘ì˜ ë©”ì•„ë¦¬ì˜€ì–´ìš”.",
                            loneliness: "í˜¼ì ì‚¼ì¼œì•¼ í–ˆë˜ ê·¸ ë§ë“¤... ì™¸ë¡œì› ê² ì–´ìš”. í•˜ì§€ë§Œ ê·¸ ì™¸ë¡œì›€ ì†ì—ì„œë„ ë‹¹ì‹ ì€ ëˆ„êµ°ê°€ë¥¼ í–¥í•œ ë§ˆìŒì„ ìƒì§€ ì•Šì•˜ì–´ìš”. ê·¸ê²ƒì´ ë‹¹ì‹ ì˜ í˜ì´ì—ìš”.",
                            shame: "ë¶€ë„ëŸ¬ì›Œì„œ ëª»í•œ ë§ë“¤ì€ ì˜¤íˆë ¤ ë‹¹ì‹ ì˜ ê²¸ì†í•¨ì„ ë³´ì—¬ì¤˜ìš”. ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„ìš”. ë¶€ë„ëŸ¬ì›€ì„ ëŠë‚„ ì¤„ ì•„ëŠ” ë§ˆìŒì´ ë” ì•„ë¦„ë‹¤ìš´ ê±°ì˜ˆìš”.",
                            hope: "í¬ë§ì„ ë‹´ì€ ë§ì„ í•˜ì§€ ëª»í–ˆë‹¤ë©´, ê·¸ í¬ë§ì€ ì§€ê¸ˆë„ ë‹¹ì‹  ì•ˆì—ì„œ ë¹›ë‚˜ê³  ìˆì–´ìš”. ë§í•˜ì§€ ì•Šì•˜ë‹¤ê³  í•´ì„œ ê·¸ ë¹›ì´ ì‚¬ë¼ì§€ëŠ” ê±´ ì•„ë‹ˆì—ìš”.",
                            emptiness: "ê³µí—ˆí•¨ ì†ì—ì„œ ì‚¬ë¼ì§„ ë§ë“¤... ê·¸ ë¹ˆ ê³µê°„ë„ ì˜ë¯¸ê°€ ìˆì–´ìš”. ë•Œë¡œëŠ” ì¹¨ë¬µì´ ê°€ì¥ ê¹Šì€ í‘œí˜„ì´ ë˜ê¸°ë„ í•˜ê±°ë“ ìš”.",
                            gratitude: "ê³ ë§ˆì›€ì„ ì „í•˜ì§€ ëª»í•œ ë§ˆìŒ, ë¯¸ì•ˆí•¨ì„ í‘œí˜„í•˜ì§€ ëª»í•œ ë§ˆìŒ... ê·¸ ì§„ì‹¬ì€ ì•„ì§ë„ ì‚´ì•„ ìˆì–´ìš”. ì§€ê¸ˆì´ë¼ë„ ê·¸ ë§ˆìŒì„ ì¸ì •í•´ì£¼ì„¸ìš”.",
                            general: "ë§í•˜ì§€ ëª»í•œ ë‹¹ì‹ ì˜ ëª¨ë“  ê°ì •ë“¤ì´ ë©”ì•„ë¦¬ê°€ ë˜ì–´ ëŒì•„ì˜¤ê³  ìˆì–´ìš”. ê·¸ ë©”ì•„ë¦¬ë¥¼ ë“£ëŠ” ê²ƒë§Œìœ¼ë¡œë„, ë‹¹ì‹ ì€ ì´ë¯¸ ê·¸ ë§ì„ í•˜ê¸° ì‹œì‘í•œ ê±°ì˜ˆìš”."
                        },
                        en: {
                            regret: "The regret of not saying those words... it's also proof that you were a thoughtful person. Sometimes not speaking is also a choice. But acknowledging that feeling now, that alone has meaning.",
                            sadness: "Those moments when you were sad for not being able to speak are echoing back. Within that sadness lies the sincerity of loving someone. Words you couldn't cry out still remain as echoes within you.",
                            fear: "That heart that was afraid to speak, I understand. Fear is also a signal showing how precious those words were. Being afraid means you were that desperate.",
                            anger: "Words you couldn't say out of anger often contain the most honest emotions. Within that anger, love and expectations were hidden. Even anger is part of your sincerity.",
                            love: "Couldn't say you loved them? That love doesn't exist only in words. Every moment you thought of that person, that was the echo of love.",
                            loneliness: "Those words you had to swallow alone... it must have been lonely. But even in that loneliness, you didn't lose your heart toward someone. That's your strength.",
                            shame: "Words you couldn't say out of shame actually show your humility. It's okay not to be perfect. A heart that knows shame is more beautiful.",
                            hope: "If you couldn't say words filled with hope, that hope is still shining within you. Just because you didn't speak doesn't mean that light disappears.",
                            emptiness: "Words that disappeared in emptiness... even that empty space has meaning. Sometimes silence becomes the deepest expression.",
                            gratitude: "Gratitude you couldn't convey, apologies you couldn't express... that sincerity is still alive. Please acknowledge that feeling even now.",
                            general: "All your unspoken emotions are returning as echoes. Just by hearing those echoes, you've already begun to speak those words."
                        },
                        pt: {
                            regret: "O arrependimento de nÃ£o ter dito essas palavras... Ã© tambÃ©m prova de que vocÃª era uma pessoa cuidadosa. Ã€s vezes nÃ£o falar tambÃ©m Ã© uma escolha. Mas reconhecer esse sentimento agora, sÃ³ isso jÃ¡ tem significado.",
                            sadness: "Aqueles momentos em que vocÃª estava triste por nÃ£o conseguir falar estÃ£o ecoando de volta. Dentro dessa tristeza estÃ¡ a sinceridade de amar alguÃ©m. Palavras que vocÃª nÃ£o conseguiu chorar ainda permanecem como ecos dentro de vocÃª.",
                            fear: "Esse coraÃ§Ã£o que tinha medo de falar, eu entendo. O medo tambÃ©m Ã© um sinal mostrando o quÃ£o preciosas eram essas palavras. Ter medo significa que vocÃª estava desesperado.",
                            anger: "Palavras que vocÃª nÃ£o conseguiu dizer por raiva frequentemente contÃªm as emoÃ§Ãµes mais honestas. Dentro dessa raiva, amor e expectativas estavam escondidos. Mesmo a raiva Ã© parte da sua sinceridade.",
                            love: "NÃ£o conseguiu dizer que os amava? Esse amor nÃ£o existe apenas em palavras. Cada momento que vocÃª pensou nessa pessoa, isso foi o eco do amor.",
                            loneliness: "Essas palavras que vocÃª teve que engolir sozinho... deve ter sido solitÃ¡rio. Mas mesmo nessa solidÃ£o, vocÃª nÃ£o perdeu seu coraÃ§Ã£o por alguÃ©m. Essa Ã© sua forÃ§a.",
                            shame: "Palavras que vocÃª nÃ£o conseguiu dizer por vergonha na verdade mostram sua humildade. Tudo bem nÃ£o ser perfeito. Um coraÃ§Ã£o que conhece vergonha Ã© mais bonito.",
                            hope: "Se vocÃª nÃ£o conseguiu dizer palavras cheias de esperanÃ§a, essa esperanÃ§a ainda estÃ¡ brilhando dentro de vocÃª. SÃ³ porque vocÃª nÃ£o falou nÃ£o significa que essa luz desaparece.",
                            emptiness: "Palavras que desapareceram no vazio... mesmo esse espaÃ§o vazio tem significado. Ã€s vezes o silÃªncio se torna a expressÃ£o mais profunda.",
                            gratitude: "GratidÃ£o que vocÃª nÃ£o conseguiu transmitir, desculpas que vocÃª nÃ£o conseguiu expressar... essa sinceridade ainda estÃ¡ viva. Por favor, reconheÃ§a esse sentimento mesmo agora.",
                            general: "Todas as suas emoÃ§Ãµes nÃ£o ditas estÃ£o retornando como ecos. Apenas ouvindo esses ecos, vocÃª jÃ¡ comeÃ§ou a falar essas palavras."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Whisper", emoji: "ğŸ’­",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            regret: "ì†ì‚­ì…ë‹ˆë‹¤... í›„íšŒëŠ” ì‹œê°„ì„ ë˜ëŒë¦¬ë ¤ëŠ” ë§ˆìŒì˜ ëª¸ë¶€ë¦¼ì´ì—ìš”. í•˜ì§€ë§Œ ê·¸ í›„íšŒ ì†ì—ëŠ” 'ë” ë‚˜ì€ ì„ íƒì„ í•  ìˆ˜ ìˆì—ˆë‹¤'ëŠ” ì„±ì¥ì˜ ì‹ í˜¸ê°€ ìˆ¨ì–´ ìˆì–´ìš”. ê³¼ê±°ë¥¼ ë°”ê¿€ ìˆ˜ëŠ” ì—†ì§€ë§Œ, ì§€ê¸ˆì˜ ë‹¹ì‹ ì€ ê·¸ë•Œì™€ ë‹¬ë¼ì¡Œì–´ìš”.",
                            sadness: "ìŠ¬í””ì´ ì†ì‚­ì´ê³  ìˆì–´ìš”... 'ê·¸ë•Œ ë§í–ˆë”ë¼ë©´'ì´ë¼ëŠ” ë§ˆìŒì´ ì§€ê¸ˆë„ ì•„í”„ì£ . í•˜ì§€ë§Œ ê·¸ ìŠ¬í””ì€ ë‹¹ì‹ ì´ ì§„ì‹¬ìœ¼ë¡œ ì‚¬ë‘í–ˆë‹¤ëŠ” ì¦ê±°ì˜ˆìš”. ë§í•˜ì§€ ëª»í•œ ì‚¬ë‘ë„ ì‚¬ë‘ì´ì—ìš”.",
                            fear: "ë‘ë ¤ì›€ì´ ì‘ê²Œ ì†ì‚­ì—¬ìš”... 'ê±°ì ˆë‹¹í• ê¹Œë´', 'ìƒì²˜ë°›ì„ê¹Œë´' ë§ì„ ì‚¼ì¼°ì£ . í•˜ì§€ë§Œ ê·¸ ë‘ë ¤ì›€ ë’¤ì—ëŠ” 'ë°›ì•„ë“¤ì—¬ì§€ê³  ì‹¶ë‹¤'ëŠ” ê°„ì ˆí•¨ì´ ìˆì—ˆì–´ìš”. ë‘ë ¤ì›Œí–ˆë‹¤ëŠ” ê²ƒì€ ìš©ê¸°ë¥¼ ë‚´ë ¤ í–ˆë‹¤ëŠ” ëœ»ì´ì—ìš”.",
                            anger: "ë¶„ë…¸ê°€ ì¡°ìš©íˆ ì†ì‚­ì…ë‹ˆë‹¤... í™”ê°€ ë‚˜ì„œ ë§ì„ ëª»í–ˆë˜ ê·¸ ìˆœê°„, ì‚¬ì‹¤ì€ ì‹¤ë§ì´ ë” ì»¸ì„ ê±°ì˜ˆìš”. ê¸°ëŒ€í–ˆê¸° ë•Œë¬¸ì— í™”ê°€ ë‚¬ê³ , ì‚¬ë‘í–ˆê¸° ë•Œë¬¸ì— ë§ì„ ìƒì—ˆì–´ìš”.",
                            love: "ì‚¬ë‘ì´ ì†ì‚­ì—¬ìš”... 'ì‚¬ë‘í•œë‹¤'ëŠ” ë§ì„ í•˜ì§€ ëª»í–ˆë‹¤ê³  í•´ì„œ ê·¸ ì‚¬ë‘ì´ ê±°ì§“ì´ ë˜ëŠ” ê±´ ì•„ë‹ˆì—ìš”. ë§ˆìŒìœ¼ë¡œë§Œ ì‚¬ë‘í•œ ì‹œê°„ë“¤ë„ ëª¨ë‘ ì§„ì§œì˜€ì–´ìš”.",
                            loneliness: "ì™¸ë¡œì›€ì´ ì†ì‚­ì…ë‹ˆë‹¤... ì•„ë¬´ì—ê²Œë„ ë§í•˜ì§€ ëª»í•œ ê·¸ ê°ì •ë“¤, í˜¼ì ê²¬ëŒë‚¸ ì‹œê°„ë“¤. ê·¸ ì†ì—ì„œë„ ë‹¹ì‹ ì€ í¬ê¸°í•˜ì§€ ì•Šì•˜ì–´ìš”. ê·¸ê²ƒì´ ë‹¹ì‹ ì˜ í˜ì´ì—ˆì–´ìš”.",
                            shame: "ë¶€ë„ëŸ¬ì›€ì´ ì‘ê²Œ ì†ì‚­ì—¬ìš”... ì™„ë²½í•˜ì§€ ì•Šì€ ëª¨ìŠµì„ ë³´ì´ê¸° ì‹«ì–´ì„œ ë§ì„ ëª»í–ˆì£ . í•˜ì§€ë§Œ ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ì‚¬ë‘ë°›ì„ ìê²©ì´ ìˆì–´ìš”. ë¶€ì¡±í•¨ë„ ë‹¹ì‹ ì˜ ì¼ë¶€ì˜ˆìš”.",
                            hope: "í¬ë§ì´ ì†ì‚­ì´ê³  ìˆì–´ìš”... ì–¸ì  ê°€ëŠ” ê·¸ ë§ì„ í•  ìˆ˜ ìˆì„ ê±°ë¼ëŠ” ì‘ì€ ë°”ëŒ. ê·¸ í¬ë§ì„ ë†“ì§€ ë§ˆì„¸ìš”. ë§í•˜ì§€ ì•Šì•˜ë‹¤ê³  í•´ì„œ ê·¸ ê¿ˆì´ ì‚¬ë¼ì§€ëŠ” ê±´ ì•„ë‹ˆì—ìš”.",
                            emptiness: "ê³µí—ˆí•¨ì´ ì†ì‚­ì—¬ìš”... í…… ë¹ˆ ë§ˆìŒì—ì„œ ë‚˜ì˜¬ ë§ì´ ì—†ì—ˆì£ . í•˜ì§€ë§Œ ê·¸ ë¹ˆ ê³µê°„ì€ ìƒˆë¡œìš´ ê°ì •ì„ ë‹´ì„ ì¤€ë¹„ê°€ ëœ ìƒíƒœì¼ ìˆ˜ë„ ìˆì–´ìš”.",
                            gratitude: "ê°ì‚¬í•¨ì´ ì†ì‚­ì…ë‹ˆë‹¤... ê³ ë§ˆì›€ì„ ì „í•˜ì§€ ëª»í•œ ë§ˆìŒ, ë¯¸ì•ˆí•¨ì„ í‘œí˜„í•˜ì§€ ëª»í•œ ë§ˆìŒ. ê·¸ ì§„ì‹¬ì€ ì•„ì§ë„ ë”°ëœ»í•˜ê²Œ ì‚´ì•„ ìˆì–´ìš”.",
                            general: "ë§ˆìŒì´ ì¡°ìš©íˆ ì†ì‚­ì´ê³  ìˆì–´ìš”... ë§í•˜ì§€ ëª»í•œ ëª¨ë“  ê°ì •ë“¤ì´ ì—¬ì „íˆ ë‹¹ì‹  ì•ˆì—ì„œ ì‚´ì•„ ìˆ¨ì‰¬ê³  ìˆë‹¤ê³ . ë“¤ì–´ì£¼ì„¸ìš”, ê·¸ ì‘ì€ ì†ì‚­ì„ì„."
                        },
                        en: {
                            regret: "Whispering... regret is the heart's struggle to turn back time. But within that regret lies a signal of growth - 'I could have made a better choice.' You can't change the past, but you now are different from then.",
                            sadness: "Sadness whispers... 'If only I had spoken then' still hurts now. But that sadness is proof you truly loved. Love that wasn't spoken is still love.",
                            fear: "Fear whispers softly... you swallowed words afraid of rejection, of being hurt. But behind that fear was the desperation to 'be accepted.' Being afraid means you tried to be brave.",
                            anger: "Anger whispers quietly... in that moment when you couldn't speak out of anger, disappointment was probably greater. You were angry because you expected, you lost words because you loved.",
                            love: "Love whispers... just because you couldn't say 'I love you' doesn't make that love false. All the times you loved only in your heart were real too.",
                            loneliness: "Loneliness whispers... those emotions you couldn't tell anyone, times you endured alone. Even in that, you didn't give up. That was your strength.",
                            shame: "Shame whispers softly... you couldn't speak because you didn't want to show imperfection. But you deserve love even when imperfect. Your flaws are part of you too.",
                            hope: "Hope whispers... a small wish that someday you could say those words. Don't let go of that hope. Just because you didn't speak doesn't mean that dream disappears.",
                            emptiness: "Emptiness whispers... there were no words from an empty heart. But that empty space might be ready to hold new emotions.",
                            gratitude: "Gratitude whispers... the heart that couldn't convey thanks, couldn't express apologies. That sincerity is still warmly alive.",
                            general: "Your heart whispers quietly... that all the emotions you couldn't speak are still alive and breathing within you. Listen to that small whisper."
                        },
                        pt: {
                            regret: "Sussurrando... arrependimento Ã© a luta do coraÃ§Ã£o para voltar no tempo. Mas dentro desse arrependimento estÃ¡ um sinal de crescimento - 'eu poderia ter feito uma escolha melhor.' VocÃª nÃ£o pode mudar o passado, mas agora vocÃª Ã© diferente de entÃ£o.",
                            sadness: "A tristeza sussurra... 'Se ao menos eu tivesse falado entÃ£o' ainda dÃ³i agora. Mas essa tristeza Ã© prova de que vocÃª realmente amou. Amor que nÃ£o foi falado ainda Ã© amor.",
                            fear: "O medo sussurra suavemente... vocÃª engoliu palavras com medo de rejeiÃ§Ã£o, de ser ferido. Mas por trÃ¡s desse medo estava o desespero para 'ser aceito.' Ter medo significa que vocÃª tentou ser corajoso.",
                            anger: "A raiva sussurra silenciosamente... naquele momento quando vocÃª nÃ£o conseguiu falar por raiva, a decepÃ§Ã£o provavelmente era maior. VocÃª estava com raiva porque esperava, perdeu palavras porque amava.",
                            love: "O amor sussurra... sÃ³ porque vocÃª nÃ£o conseguiu dizer 'eu te amo' nÃ£o torna esse amor falso. Todos os momentos que vocÃª amou apenas em seu coraÃ§Ã£o tambÃ©m eram reais.",
                            loneliness: "A solidÃ£o sussurra... essas emoÃ§Ãµes que vocÃª nÃ£o conseguiu contar para ninguÃ©m, tempos que vocÃª suportou sozinho. Mesmo nisso, vocÃª nÃ£o desistiu. Essa era sua forÃ§a.",
                            shame: "A vergonha sussurra suavemente... vocÃª nÃ£o conseguiu falar porque nÃ£o queria mostrar imperfeiÃ§Ã£o. Mas vocÃª merece amor mesmo quando imperfeito. Suas falhas tambÃ©m sÃ£o parte de vocÃª.",
                            hope: "A esperanÃ§a sussurra... um pequeno desejo de que algum dia vocÃª pudesse dizer essas palavras. NÃ£o deixe ir essa esperanÃ§a. SÃ³ porque vocÃª nÃ£o falou nÃ£o significa que esse sonho desaparece.",
                            emptiness: "O vazio sussurra... nÃ£o havia palavras de um coraÃ§Ã£o vazio. Mas esse espaÃ§o vazio pode estar pronto para guardar novas emoÃ§Ãµes.",
                            gratitude: "A gratidÃ£o sussurra... o coraÃ§Ã£o que nÃ£o conseguiu transmitir agradecimento, nÃ£o conseguiu expressar desculpas. Essa sinceridade ainda estÃ¡ calorosamente viva.",
                            general: "Seu coraÃ§Ã£o sussurra silenciosamente... que todas as emoÃ§Ãµes que vocÃª nÃ£o conseguiu falar ainda estÃ£o vivas e respirando dentro de vocÃª. Escute esse pequeno sussurro."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Mirror", emoji: "ğŸª",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            regret: "ê±°ìš¸ì´ ë¹„ì¶°ì¤ë‹ˆë‹¤... í›„íšŒí•˜ëŠ” ë‹¹ì‹ ì˜ ëª¨ìŠµ ì†ì—ëŠ” 'ë” ë‚˜ì€ ì‚¬ëŒì´ ë˜ê³  ì‹¶ë‹¤'ëŠ” ë°”ëŒì´ ë³´ì—¬ìš”. ê·¸ ë§ì„ í•˜ì§€ ì•Šì€ ê³¼ê±°ì˜ ë‹¹ì‹ ë„, ì§€ê¸ˆ í›„íšŒí•˜ëŠ” ë‹¹ì‹ ë„ ëª¨ë‘ ì„±ì¥í•˜ëŠ” ëª¨ìŠµì´ì—ìš”.",
                            sadness: "ê±°ìš¸ ì†ì— ìŠ¬í”ˆ ë‹¹ì‹ ì´ ë³´ì…ë‹ˆë‹¤... ë§í•˜ì§€ ëª»í•´ ìš¸ê³  ìˆëŠ” ëª¨ìŠµ. í•˜ì§€ë§Œ ê·¸ ëˆˆë¬¼ ì†ì—ëŠ” ì‚¬ë‘í–ˆë˜ ë§ˆìŒì´ ë°˜ì§ì´ê³  ìˆì–´ìš”. ìŠ¬í””ë„ ë‹¹ì‹ ì˜ ì•„ë¦„ë‹¤ìš´ ì¼ë¶€ì˜ˆìš”.",
                            fear: "ê±°ìš¸ì´ ë³´ì—¬ì¤ë‹ˆë‹¤... ë‘ë ¤ì›Œí•˜ëŠ” ë‹¹ì‹ ì˜ ëª¨ìŠµ. í•˜ì§€ë§Œ ê·¸ ë‘ë ¤ì›€ ë’¤ì—ëŠ” ìš©ê°í•´ì§€ê³  ì‹¶ì–´í•˜ëŠ” ë§ˆìŒì´ ìˆ¨ì–´ ìˆì–´ìš”. ë‘ë ¤ì›Œí•œë‹¤ëŠ” ê²ƒ ìì²´ê°€ ìš©ê¸°ì˜ ì‹œì‘ì´ì—ìš”.",
                            anger: "ê±°ìš¸ ì† í™”ë‚œ ë‹¹ì‹ ì„ ë´…ë‹ˆë‹¤... í•˜ì§€ë§Œ ê·¸ ë¶„ë…¸ ë’¤ì—ëŠ” ìƒì²˜ë°›ì€ ë§ˆìŒì´ ë³´ì—¬ìš”. í™”ë¥¼ ë‚¸ë‹¤ëŠ” ê²ƒì€ ì•„ì§ í¬ê¸°í•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ëœ»ì´ì—ìš”. ê·¸ê²ƒë„ ì‚¬ë‘ì˜ í‘œí˜„ì´ì—ˆì–´ìš”.",
                            love: "ê±°ìš¸ì´ ë¹„ì¶¥ë‹ˆë‹¤... ì‚¬ë‘í•˜ì§€ë§Œ ë§í•˜ì§€ ëª»í•œ ë‹¹ì‹ ì˜ ëª¨ìŠµ. ê·¸ ì…ìˆ ì— ë¨¸ë¬¸ ë§ë“¤ì´ ì•„ì§ë„ ë¹›ë‚˜ê³  ìˆì–´ìš”. í‘œí˜„í•˜ì§€ ì•Šì€ ì‚¬ë‘ë„ ì¶©ë¶„íˆ ì•„ë¦„ë‹¤ì›Œìš”.",
                            loneliness: "ê±°ìš¸ ì†ì— ì™¸ë¡œìš´ ë‹¹ì‹ ì´ ìˆì–´ìš”... í˜¼ì ë§ì„ ì‚¼í‚¤ê³  ìˆëŠ” ëª¨ìŠµ. í•˜ì§€ë§Œ ê·¸ ì™¸ë¡œì›€ ì†ì—ì„œë„ ëˆ„êµ°ê°€ë¥¼ í–¥í•œ ë§ˆìŒì„ ìƒì§€ ì•Šì•˜ì–´ìš”. ê·¸ê²ƒì´ ë‹¹ì‹ ì˜ í˜ì´ì—ìš”.",
                            shame: "ê±°ìš¸ì´ ë³´ì—¬ì¤ë‹ˆë‹¤... ë¶€ë„ëŸ¬ì›Œí•˜ëŠ” ë‹¹ì‹ ì˜ ëª¨ìŠµ. í•˜ì§€ë§Œ ë¶€ë„ëŸ¬ì›€ì„ ëŠë‚„ ì¤„ ì•„ëŠ” ë§ˆìŒì´ ë” ì†Œì¤‘í•´ìš”. ì™„ë²½í•˜ì§€ ì•Šì€ ë‹¹ì‹ ë„ ì‚¬ë‘ë°›ì„ ìê²©ì´ ìˆì–´ìš”.",
                            hope: "ê±°ìš¸ ì†ì— í¬ë§ì„ í’ˆì€ ë‹¹ì‹ ì´ ë³´ì…ë‹ˆë‹¤... ì–¸ì  ê°€ëŠ” ë§í•  ìˆ˜ ìˆì„ ê±°ë¼ëŠ” ì‘ì€ ë¹›ì´ ëˆˆì—ì„œ ë°˜ì§ì´ê³  ìˆì–´ìš”. ê·¸ í¬ë§ì„ ë†“ì§€ ë§ˆì„¸ìš”.",
                            emptiness: "ê±°ìš¸ì´ ë¹„ì¶¥ë‹ˆë‹¤... ê³µí—ˆí•œ í‘œì •ì˜ ë‹¹ì‹ . í•˜ì§€ë§Œ ê·¸ ë¹ˆ ê³µê°„ë„ ì˜ë¯¸ê°€ ìˆì–´ìš”. ë¹„ì›Œì§„ ë§ˆìŒì€ ìƒˆë¡œìš´ ê°ì •ì„ ë‹´ì„ ì¤€ë¹„ê°€ ëœ ìƒíƒœì˜ˆìš”.",
                            gratitude: "ê±°ìš¸ ì†ì— ê°ì‚¬í•˜ì§€ë§Œ í‘œí˜„í•˜ì§€ ëª»í•œ ë‹¹ì‹ ì´ ë³´ì—¬ìš”... ê·¸ ë§ˆìŒì€ ì•„ì§ë„ ë”°ëœ»í•˜ê²Œ ë¹›ë‚˜ê³  ìˆì–´ìš”. í‘œí˜„í•˜ì§€ ì•Šì•˜ë‹¤ê³  í•´ì„œ ê·¸ ì§„ì‹¬ì´ ì‚¬ë¼ì§€ëŠ” ê±´ ì•„ë‹ˆì—ìš”.",
                            general: "ê±°ìš¸ì´ ë‹¹ì‹ ì„ ë¹„ì¶°ì¤ë‹ˆë‹¤... ë§í•˜ì§€ ëª»í•œ ëª¨ë“  ê°ì •ë“¤ì„ í’ˆê³  ìˆëŠ” ë‹¹ì‹ ì˜ ëª¨ìŠµ. ê·¸ ëª¨ë“  ì¹¨ë¬µ ì†ì—ë„ ì•„ë¦„ë‹¤ì›€ì´ ìˆì–´ìš”."
                        },
                        en: {
                            regret: "The mirror reflects... in your regretful appearance, I see the wish to 'become a better person.' Both the past you who didn't speak and the present you who regrets are both growing.",
                            sadness: "I see sad you in the mirror... crying for not being able to speak. But in those tears, the heart that loved sparkles. Sadness is also your beautiful part.",
                            fear: "The mirror shows... your fearful appearance. But behind that fear hides a heart wanting to be brave. Being afraid is itself the beginning of courage.",
                            anger: "I see angry you in the mirror... but behind that anger, I see a hurt heart. Getting angry means you haven't given up yet. That was also an expression of love.",
                            love: "The mirror reflects... you who loved but couldn't speak. The words that stayed on your lips still shine. Unexpressed love is beautiful enough.",
                            loneliness: "There's lonely you in the mirror... swallowing words alone. But even in that loneliness, you didn't lose your heart toward someone. That's your strength.",
                            shame: "The mirror shows... your ashamed appearance. But a heart that knows shame is more precious. Even imperfect you deserves love.",
                            hope: "I see you holding hope in the mirror... a small light sparkles in your eyes, believing you could speak someday. Don't let go of that hope.",
                            emptiness: "The mirror reflects... you with an empty expression. But even that empty space has meaning. An emptied heart is ready to hold new emotions.",
                            gratitude: "I see you in the mirror who's grateful but couldn't express it... that heart still shines warmly. Just because you didn't express doesn't mean that sincerity disappears.",
                            general: "The mirror reflects you... holding all the emotions you couldn't speak. Even in all that silence, there's beauty."
                        },
                        pt: {
                            regret: "O espelho reflete... em sua aparÃªncia arrependida, vejo o desejo de 'se tornar uma pessoa melhor.' Tanto o vocÃª do passado que nÃ£o falou quanto o vocÃª presente que se arrepende estÃ£o crescendo.",
                            sadness: "Vejo vocÃª triste no espelho... chorando por nÃ£o conseguir falar. Mas nessas lÃ¡grimas, o coraÃ§Ã£o que amou brilha. A tristeza tambÃ©m Ã© sua parte bonita.",
                            fear: "O espelho mostra... sua aparÃªncia temerosa. Mas por trÃ¡s desse medo se esconde um coraÃ§Ã£o querendo ser corajoso. Ter medo Ã© em si o inÃ­cio da coragem.",
                            anger: "Vejo vocÃª com raiva no espelho... mas por trÃ¡s dessa raiva, vejo um coraÃ§Ã£o ferido. Ficar com raiva significa que vocÃª ainda nÃ£o desistiu. Isso tambÃ©m era uma expressÃ£o de amor.",
                            love: "O espelho reflete... vocÃª que amou mas nÃ£o conseguiu falar. As palavras que ficaram em seus lÃ¡bios ainda brilham. Amor nÃ£o expresso Ã© bonito o suficiente.",
                            loneliness: "HÃ¡ vocÃª solitÃ¡rio no espelho... engolindo palavras sozinho. Mas mesmo nessa solidÃ£o, vocÃª nÃ£o perdeu seu coraÃ§Ã£o por alguÃ©m. Essa Ã© sua forÃ§a.",
                            shame: "O espelho mostra... sua aparÃªncia envergonhada. Mas um coraÃ§Ã£o que conhece vergonha Ã© mais precioso. Mesmo vocÃª imperfeito merece amor.",
                            hope: "Vejo vocÃª mantendo esperanÃ§a no espelho... uma pequena luz brilha em seus olhos, acreditando que poderia falar algum dia. NÃ£o deixe ir essa esperanÃ§a.",
                            emptiness: "O espelho reflete... vocÃª com uma expressÃ£o vazia. Mas mesmo esse espaÃ§o vazio tem significado. Um coraÃ§Ã£o esvaziado estÃ¡ pronto para guardar novas emoÃ§Ãµes.",
                            gratitude: "Vejo vocÃª no espelho que Ã© grato mas nÃ£o conseguiu expressar... esse coraÃ§Ã£o ainda brilha calorosamente. SÃ³ porque vocÃª nÃ£o expressou nÃ£o significa que essa sinceridade desaparece.",
                            general: "O espelho reflete vocÃª... segurando todas as emoÃ§Ãµes que vocÃª nÃ£o conseguiu falar. Mesmo em todo esse silÃªncio, hÃ¡ beleza."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en'; // ê¸°ë³¸ ì–¸ì–´ë¥¼ ì˜ì–´ë¡œ ì„¤ì •
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        // ============ ì—¬ì • ì´ˆê¸°í™” í•¨ìˆ˜ ============
        
        function resetJourney() {
            console.log('=== ì—¬ì • ì´ˆê¸°í™” ì‹œì‘ ===');
            
            // 1. ëª¨ë“  íƒ€ì´í•‘ íš¨ê³¼ ì™„ì „ ì •ë¦¬
            clearAllTypingEffects();
            
            // ì¶”ê°€ ì•ˆì „ì¥ì¹˜ - ëª¨ë“  timer ì •ë¦¬
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            // 2. ëª¨ë“  ì½˜í…ì¸  ì„¹ì…˜ ì™„ì „ ì´ˆê¸°í™”
            const sectionsToReset = [
                'portalIntroSection',
                'characterResponsesSection', 
                'lightMessageSection',
                'portalQuestionSection',
                'userInputSection',
                'userReactionsSection',
                'continueSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    } else {
                        const textElements = section.querySelectorAll('.portal-intro, .light-message, .portal-question, .continue-text');
                        textElements.forEach(el => {
                            el.innerHTML = '';
                            el.textContent = '';
                        });
                    }
                }
            });
            
            // 3. íŠ¹ì • ìš”ì†Œë“¤ ê°œë³„ ì´ˆê¸°í™”
            const portalIntro = document.getElementById('portalIntro');
            const lightMessage = document.getElementById('lightMessage');
            const portalQuestion = document.getElementById('portalQuestion');
            const continueText = document.getElementById('continueText');
            
            if (portalIntro) portalIntro.innerHTML = '';
            if (lightMessage) lightMessage.innerHTML = '';
            if (portalQuestion) portalQuestion.innerHTML = '';
            if (continueText) continueText.innerHTML = '';
            
            // 4. í…ìŠ¤íŠ¸ì˜ì—­ ì™„ì „ ì´ˆê¸°í™”
            const userTextarea = document.getElementById('userTextarea');
            if (userTextarea) {
                userTextarea.disabled = false;
                userTextarea.value = '';
                userTextarea.style.height = 'auto';
                userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            }
            
            // 5. ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì´ˆê¸°í™”
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.scrollTop = 0;
            }
            
            // 6. ìƒíƒœ ë³€ìˆ˜ ì™„ì „ ì´ˆê¸°í™”
            userResponse = '';
            currentTypingElement = null;
            
            console.log('=== ì—¬ì • ì´ˆê¸°í™” ì™„ë£Œ ===');
        }
        
        // ============ ê°œì„ ëœ ì–¸ì–´ ë³€ê²½ í•¨ìˆ˜ ============
        
        function changeLanguage(lang) {
            if (!translations[lang]) {
                console.error('ì§€ì›í•˜ì§€ ì•ŠëŠ” ì–¸ì–´:', lang);
                return;
            }
            
            if (currentLanguage === lang) {
                return;
            }
            
            if (journeyStarted) {
                const confirmMessage = translations[currentLanguage].languageChangeConfirm;
                const shouldRestart = confirm(confirmMessage);
                
                if (!shouldRestart) {
                    return;
                }
            }
            
            const previousLanguage = currentLanguage;
            currentLanguage = lang;
            
            console.log(`ì–¸ì–´ ë³€ê²½: ${previousLanguage} â†’ ${currentLanguage}`);
            
            if (journeyStarted) {
                resetJourney();
            }
            
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                setTimeout(() => {
                    console.log(`ìƒˆë¡œìš´ ì–¸ì–´(${currentLanguage})ë¡œ ì—¬ì • ì¬ì‹œì‘`);
                    startPortalSequence();
                }, 1000);
            }
        }
        
        // ============ UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤ ============
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            // ê°œë³„ ìš”ì†Œ ì—…ë°ì´íŠ¸
            const elements = [
                'logoSubtitle',
                'portalMainTitle', 
                'portalSubtitle',
                'lightTitle',
                'continueYesBtn',
                'continueNoBtn'
            ];
            
            elements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element && translations[lang]) {
                    const key = elementId.replace('Btn', 'Button').replace('Subtitle', 'Subtitle');
                    let translationKey = key;
                    
                    const keyMapping = {
                        'logoSubtitle': 'logoSubtitle',
                        'portalMainTitle': 'portalMainTitle',
                        'portalSubtitle': 'portalSubtitle',
                        'lightTitle': 'lightTitle',
                        'continueYesButton': 'continueYes',
                        'continueNoButton': 'continueNo'
                    };
                    
                    translationKey = keyMapping[key] || key;
                    
                    if (translations[lang][translationKey]) {
                        element.textContent = translations[lang][translationKey];
                    }
                }
            });
            
            // placeholder ì—…ë°ì´íŠ¸
            const textarea = document.getElementById('userTextarea');
            if (textarea) textarea.placeholder = translations[lang].inputPlaceholder;
        }
        
        // ============ ê°œì„ ëœ íƒ€ì´í•‘ íš¨ê³¼ + ìŠ¤í¬ë¡¤ ì¶”ì  ì‹œìŠ¤í…œ ============
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        
                        setTimeout(() => {
                            if (document.contains(element)) {
                                scrollToFollowTyping(element);
                            }
                        }, 200);
                        
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        // ============ ìŠ¤ë§ˆíŠ¸ ìŠ¤í¬ë¡¤ ì‹œìŠ¤í…œ ============
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        // ============ ì–¸ì–´ ë²„íŠ¼ ì´ë²¤íŠ¸ ì„¤ì • ============
        
        function setupLanguageButtons() {
            const langButtons = document.querySelectorAll('.lang-btn');
            
            langButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const newLang = this.dataset.lang;
                    changeLanguage(newLang);
                });
            });
        }
        
        // ============ ë©”ì¸ ì—¬ì • ì‹œìŠ¤í…œ ============
        
        function initializeTemarix() {
            console.log('=== Temarix Portal 04 ì´ˆê¸°í™” ì‹œì‘ ===');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        // ============ ì—¬ì • ë‹¨ê³„ë“¤ ============
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            const introText = translations[currentLanguage].portalIntro;
            await typewriterEffect(introElement, introText, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = `${char.emoji} ${char.name}`;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const dialogueText = translations[currentLanguage][char.key];
                await typewriterEffect(dialogueDiv, dialogueText, 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            const lightText = translations[currentLanguage].lightMessage;
            await typewriterEffect(lightMessageEl, lightText, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            const questionText = translations[currentLanguage].portalQuestion;
            await typewriterEffect(questionEl, questionText, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        // ============ ì‚¬ìš©ì ì…ë ¥ ì‹œìŠ¤í…œ ============
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', handleTextareaKeydown);
            
            document.getElementById('continueYesBtn').addEventListener('click', function() {
                processContinue('Y');
            });
            
            document.getElementById('continueNoBtn').addEventListener('click', function() {
                processContinue('N');
            });
        }
        
        function handleTextareaKeydown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                const inputValue = this.value.trim();
                
                if (inputValue) {
                    processUserInput(inputValue);
                }
            }
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = `<strong>${youLabel}:</strong> "${text}"`;
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = `${char.emoji} ${char.name}`;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showContinueOption();
            }, 2000);
        }
        
        async function showContinueOption() {
            const continueSection = document.getElementById('continueSection');
            const continueText = document.getElementById('continueText');
            
            continueSection.classList.add('show');
            
            const questionText = translations[currentLanguage].continueText;
            await typewriterEffect(continueText, questionText, 50);
            
            setTimeout(() => {
                scrollToElement(continueSection);
            }, 500);
        }
        
        function processContinue(input) {
            if (input === 'Y') {
                const message = currentLanguage === 'ko' ? 
                    'Portal 05ê°€ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤. ê³„ì†í•´ì„œ ë” ê¹Šì€ ê°ì •ì˜ ì—¬ì •ì´ ì´ì–´ì§‘ë‹ˆë‹¤.' :
                    currentLanguage === 'en' ? 
                    'Portal 05 will be ready soon. The journey into deeper emotions continues.' :
                    'Portal 05 estarÃ¡ pronto em breve. A jornada para emoÃ§Ãµes mais profundas continua.';
                alert(message);
            } else if (input === 'N') {
                const message = currentLanguage === 'ko' ? 
                    'ì—¬ì •ì´ ì¼ì‹œ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ì–¸ì œë“  ë‹¤ì‹œ ëŒì•„ì™€ ê³„ì†í•˜ì„¸ìš”.' :
                    currentLanguage === 'en' ? 
                    'The journey has been paused. Come back and continue anytime.' :
                    'A jornada foi pausada. Volte e continue a qualquer momento.';
                alert(message);
            }
        }
        
        // ============ ì´ˆê¸°í™” ============
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V2 Portal 04 DOM ë¡œë“œ ì™„ë£Œ');
            
            // ìë™ ë¡œê·¸ì¸ ì²˜ë¦¬ (ë¡œê·¸ì¸ ëª¨ë‹¬ ì œê±°)
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>