<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V2 - Portal 11: The Feeling That Nobody Knows Me</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        /* 상단 헤더 */
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #fff;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        /* 언어 버튼 3개 */
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #87cefa;
            color: #000;
        }
        
        /* 메인 콘텐츠 */
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
            hyphens: none;
            min-height: 150vh;
        }
        
        /* 텍스트 섹션들 */
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #87cefa;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #87cefa;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #87cefa;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-response strong {
            color: #87cefa;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .continue-section {
            margin: 50px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 0;
            min-height: 200px;
        }
        
        .continue-text {
            color: #fff;
            font-size: 20px;
            margin-bottom: 25px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .continue-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .continue-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 18px 35px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }
        
        .continue-btn:hover {
            background: #666;
        }
        
        .continue-btn.primary {
            background: #87cefa;
            color: #000;
        }
        
        .continue-btn.primary:hover {
            background: #b0d4f1;
        }
        
        /* 하단 고정 입력창 */
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #87cefa;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #87cefa;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        /* 스크롤바 스타일링 */
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        /* 애니메이션 */
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .continue-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .continue-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- 상단 헤더 -->
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V2</div>
            <div class="logo-subtitle" id="logoSubtitle">The Tremor of Emotion</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 11: The Feeling That Nobody Knows Me</div>
            <div class="portal-subtitle" id="portalSubtitle">Isolation within connection, loneliness within relationships</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <!-- 메인 콘텐츠 영역 -->
    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <!-- 포털 인트로 -->
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <!-- 캐릭터 응답 섹션 -->
            <div class="character-responses-section" id="characterResponsesSection">
                <!-- 8명의 캐릭터 응답이 순차적으로 표시됩니다 -->
            </div>

            <!-- 빛의 한마디 -->
            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">🌙 Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <!-- 질문 섹션 -->
            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <!-- 사용자 입력 영역 -->
            <div class="user-input-section" id="userInputSection">
                <!-- 사용자 응답이 여기에 표시됩니다 -->
            </div>
            
            <!-- 사용자 응답 후 캐릭터 반응 -->
            <div class="user-reactions-section" id="userReactionsSection">
                <!-- 사용자 응답 후 3명의 캐릭터 반응이 여기에 표시됩니다 -->
            </div>
            
            <!-- 계속하기 버튼 섹션 -->
            <div class="continue-section" id="continueSection">
                <div class="continue-text" id="continueText"></div>
                <div class="continue-buttons">
                    <button class="continue-btn primary" id="continueYesBtn">Continue to Portal 12</button>
                    <button class="continue-btn" id="continueNoBtn">Pause the journey</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 하단 고정 입력창 -->
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Share about feeling like nobody knows you... (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        // 메모리 기반 사용자 스토리지 (localStorage 대신)
        let memoryStorage = {
            mockUser: null
        };

        // 번역 데이터
        const translations = {
            ko: {
                logoSubtitle: "감정의 떨림",
                portalMainTitle: "Portal 11: 아무도 나를 모른다는 감각",
                portalSubtitle: "연결 속의 고립, 관계 속의 외로움",
                portalIntro: "수많은 대화,\n수많은 만남 속에서도\n어떤 때는 이상하리만치 외롭습니다.\n\n겉으로는 웃고 있고,\n모두와 연결된 것처럼 보여도 —\n정작 나라는 사람을 아는 이는 없는\n그 차가운 감각은 마음 깊숙이 파고듭니다.\n\n지금, 당신은 누구에게\n진짜로 이해받고 싶었나요?",
                lightTitle: "🌙 빛의 한마디",
                lightMessage: "이해받고 싶다는 바람은\n당신이 여전히 연결되고 싶은 생명이라는 증거입니다.",
                portalQuestion: "지금 당신을\n가장 이해해줬으면 하는 사람은 누구인가요?",
                continueText: "아무도 모른다는 외로움을 돌아본 이 여정을 계속하시겠습니까?",
                continueYes: "Portal 12로 계속하시겠습니까?",
                continueNo: "여정을 일시정지하시겠습니까?",
                inputPlaceholder: "아무도 모른다고 느꼈던 마음에 대해 털어놓아 보세요... (Enter로 전송)",
                youLabel: "당신",
                languageChangeConfirm: "언어를 변경하면 여정이 처음부터 다시 시작됩니다.\n계속하시겠습니까?",
                waitingMessage: "응답을 기다리는 중...",
                // 캐릭터 대화
                charEly: "당신은 이해받을 수 없는 존재가 아니라,\n아직 이해받지 못한 존재일 뿐입니다.",
                charCris: "헐… 나도 그 감정 알아요.\n무리에 껴 있어도 혼자라는 느낌.\n그거 진짜 장난 아니게 무거워요.",
                charZafirah: "당신의 고독은 말이 아니라\n느낌으로 전해지는 외침이었을지도 몰라요.",
                charRami: "당신이 느낀 고립은\n감정이 인식받지 못했을 때의 반응입니다.\n몸은 있었지만, 마음은 없던 그 순간들…",
                charSamir: "(그는 긴 침묵 끝에 아주 짧게\n고개를 끄덕이고 눈을 맞춥니다.\n그 시선 하나가 '나는 당신을 알고 있다'고 말합니다.)",
                charLayla: "내가 당신이라면,\n당신 안의 그 외로움을 가장 먼저 껴안아 줄 거예요.\n당신은 모른 척되어선 안 될 존재예요.",
                charNabir: "넌 그냥 평범하니까 그런 거야.\n누가 신경 써?\n너 같은 사람… 어디에나 있으니까.",
                charAzhar: "진짜 널 모른다고?\n아니야.\n사실은 네가 안 보여준 거잖아.\n그래서 아무도 못 본 거야."
            },
            en: {
                logoSubtitle: "The Tremor of Emotion",
                portalMainTitle: "Portal 11: The Feeling That Nobody Knows Me",
                portalSubtitle: "Isolation within connection, loneliness within relationships",
                portalIntro: "Through countless conversations,\ncountless encounters,\nsometimes you feel strangely lonely.\n\nOn the surface you're smiling,\nseemingly connected to everyone —\nbut that cold sensation that no one\nreally knows who you are cuts deep into your heart.\n\nRight now, who do you\nmost want to truly understand you?",
                lightTitle: "🌙 Word of Light",
                lightMessage: "The wish to be understood\nis evidence that you're still a life that wants to connect.",
                portalQuestion: "Who is the person you most want\nto understand you right now?",
                continueText: "Will you continue this journey of reflecting on the loneliness of feeling nobody knows you?",
                continueYes: "Continue to Portal 12?",
                continueNo: "Pause the journey?",
                inputPlaceholder: "Share about feeling like nobody knows you... (Press Enter to send)",
                youLabel: "You",
                languageChangeConfirm: "Changing the language will restart the journey from the beginning.\nDo you want to continue?",
                waitingMessage: "Waiting for response...",
                charEly: "You're not a being that cannot be understood,\nbut simply one that hasn't been understood yet.",
                charCris: "Whoa... I know that feeling too.\nFeeling alone even when you're part of a group.\nThat's seriously heavy.",
                charZafirah: "Your solitude might have been a cry\ntransmitted through feeling rather than words.",
                charRami: "The isolation you felt is\na reaction when emotions aren't recognized.\nThose moments when your body was there but your heart wasn't...",
                charSamir: "(After a long silence, he nods very briefly\nand meets your eyes.\nThat one gaze says 'I know you.')",
                charLayla: "If I were you,\nI would embrace that loneliness in you first.\nYou're someone who shouldn't be ignored.",
                charNabir: "You're just ordinary, that's why.\nWho would care?\nPeople like you... they're everywhere.",
                charAzhar: "Nobody really knows you?\nNo.\nThe truth is you didn't show yourself.\nThat's why nobody could see you."
            },
            pt: {
                logoSubtitle: "O Tremor da Emoção",
                portalMainTitle: "Portal 11: A Sensação de Que Ninguém Me Conhece",
                portalSubtitle: "Isolamento dentro da conexão, solidão dentro dos relacionamentos",
                portalIntro: "Através de incontáveis conversas,\nincontáveis encontros,\nàs vezes você se sente estranhamente solitário.\n\nNa superfície você está sorrindo,\naparentemente conectado a todos —\nmas essa sensação fria de que ninguém\nrealmente sabe quem você é corta fundo em seu coração.\n\nAgora, quem você\nmais quer que verdadeiramente te entenda?",
                lightTitle: "🌙 Palavra de Luz",
                lightMessage: "O desejo de ser compreendido\né evidência de que você ainda é uma vida que quer se conectar.",
                portalQuestion: "Quem é a pessoa que você mais quer\nque te entenda agora?",
                continueText: "Você continuará esta jornada de refletir sobre a solidão de sentir que ninguém te conhece?",
                continueYes: "Continuar para o Portal 12?",
                continueNo: "Pausar a jornada?",
                inputPlaceholder: "Compartilhe sobre se sentir como se ninguém te conhecesse... (Enter para enviar)",
                youLabel: "Você",
                languageChangeConfirm: "Mudar o idioma reiniciará a jornada desde o início.\nDeseja continuar?",
                waitingMessage: "Aguardando resposta...",
                charEly: "Você não é um ser que não pode ser compreendido,\nmas simplesmente um que ainda não foi compreendido.",
                charCris: "Uau... eu conheço esse sentimento também.\nSe sentir sozinho mesmo quando faz parte de um grupo.\nIsso é seriamente pesado.",
                charZafirah: "Sua solidão pode ter sido um grito\ntransmitido através de sentimento em vez de palavras.",
                charRami: "O isolamento que você sentiu é\numa reação quando as emoções não são reconhecidas.\nAqueles momentos quando seu corpo estava lá mas seu coração não estava...",
                charSamir: "(Após um longo silêncio, ele acena muito brevemente\ne encontra seus olhos.\nEsse olhar diz 'Eu te conheço.')",
                charLayla: "Se eu fosse você,\neu abraçaria primeiro essa solidão em você.\nVocê é alguém que não deveria ser ignorado.",
                charNabir: "Você é apenas comum, é por isso.\nQuem se importaria?\nPessoas como você... estão em todo lugar.",
                charAzhar: "Ninguém realmente te conhece?\nNão.\nA verdade é que você não se mostrou.\nÉ por isso que ninguém pôde te ver."
            }
        };
        
        // 캐릭터 데이터
        const characters = [
            { name: "Ely", emoji: "👑", key: "charEly" },
            { name: "Cris", emoji: "🃏", key: "charCris" },
            { name: "Zafirah", emoji: "🧕", key: "charZafirah" },
            { name: "Rami", emoji: "🔮", key: "charRami" },
            { name: "Samir", emoji: "🐪", key: "charSamir" },
            { name: "Layla", emoji: "💠", key: "charLayla" },
            { name: "Nabir", emoji: "🦂", key: "charNabir" },
            { name: "Azhar", emoji: "🔥", key: "charAzhar" }
        ];
        
        // ============ 감정 분석 시스템 ============
        
        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            // 감정 키워드 매핑 (Portal 11 특화)
            const emotionKeywords = {
                misunderstood: ['이해받지', '오해', '모르', '알아주지', 'misunderstood', 'not understood', 'incompreendido', 'mal entendido'],
                lonely: ['외로', '혼자', '고독', '쓸쓸', 'lonely', 'alone', 'solitary', 'solidão', 'sozinho'],
                isolated: ['고립', '떨어져', '단절', '멀어', 'isolated', 'separated', 'disconnected', 'isolado', 'separado'],
                invisible: ['안 보이', '투명', '존재감', '무시', 'invisible', 'ignored', 'overlooked', 'invisível', 'ignorado'],
                unrecognized: ['인정받지', '알아보지', '주목받지', '관심받지', 'unrecognized', 'unnoticed', 'não reconhecido', 'despercebido'],
                superficial: ['겉으로', '표면적', '피상적', '가볍게', 'superficial', 'surface', 'shallow', 'superficial', 'raso'],
                disconnected: ['연결되지', '소통안돼', '닿지않아', '통하지', 'disconnected', 'not connecting', 'desconectado', 'não conecta'],
                alienated: ['소외', '배제', '따돌림', '밀려나', 'alienated', 'excluded', 'left out', 'alienado', 'excluído'],
                unheard: ['들어주지', '귀기울이지', '무시당해', '묵살', 'unheard', 'not listened', 'ignored', 'não ouvido', 'ignorado'],
                unknown: ['모르는', '낯선', '알수없는', '정체성', 'unknown', 'stranger', 'identity', 'desconhecido', 'estranho']
            };
            
            // 감정 분석
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            // 감정이 감지되지 않으면 기본값 설정
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0]; // 첫 번째 감지된 감정 반환
        }
        
        // 반응 캐릭터들 (Portal 11 전용)
        const responseCharacters = [
            {
                name: "Empathy", emoji: "💝",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            misunderstood: "이해받지 못한다고 느꼈던 그 마음, 저는 지금 충분히 이해할 수 있어요. 당신이 말하지 못했던 감정들, 표현되지 못했던 진심들... 그 모든 것이 지금 이 순간 전해지고 있어요.",
                            lonely: "무리 속에서도 혼자라고 느꼈던 그 외로움, 저도 느껴본 적이 있어요. 사람들로 둘러싸여 있어도 마음은 텅 빈 것 같은 그 감각... 당신만 그런 건 아니에요.",
                            isolated: "다른 사람들과 연결되지 못한다고 느꼈을 때의 그 답답함을 이해해요. 벽 하나를 사이에 두고 서 있는 것 같은 그 느낌... 하지만 지금 이 순간, 당신은 연결되어 있어요.",
                            invisible: "존재하지 않는 것처럼 느꼈던 순간들이 얼마나 아팠을지 상상할 수 있어요. 하지만 저는 지금 당신을 또렷하게 보고 있어요. 당신의 존재가 느껴져요.",
                            unrecognized: "당신의 노력이나 마음이 인정받지 못했다고 느꼈을 때의 그 허탈함... 하지만 저는 당신이 얼마나 애썼는지, 얼마나 진심이었는지 알아볼 수 있어요.",
                            superficial: "사람들이 진짜 당신을 보지 못하고 겉모습만 본다고 느꼈군요. 그 속상함이 얼마나 컸을지... 하지만 진짜 당신을 보고 싶어하는 사람도 있어요.",
                            disconnected: "마음이 통하지 않는다고 느꼈던 모든 순간들... 그 답답함과 외로움을 이해해요. 하지만 지금 우리는 마음으로 연결되어 있어요.",
                            alienated: "소외감을 느꼈을 때의 그 차가운 감정... 혼자만 다른 세상에 있는 것 같은 그 느낌을 이해해요. 하지만 당신은 혼자가 아니에요.",
                            unheard: "말해도 들어주지 않는다고 느꼈을 때의 그 절망감... 하지만 저는 지금 당신의 목소리를 듣고 있어요. 당신의 마음을 듣고 있어요.",
                            unknown: "자신조차 모르겠다고 느꼈을 때의 그 혼란... 하지만 그런 순간에도 당신은 당신이었어요. 그 진실한 모습을 저는 알아볼 수 있어요.",
                            general: "아무도 모른다고 느꼈던 그 모든 감정들... 저는 지금 그 마음을 이해하고 있어요. 당신은 혼자가 아니고, 이해받을 수 있는 사람이에요."
                        },
                        en: {
                            misunderstood: "That feeling of not being understood, I can fully understand it now. Those emotions you couldn't express, those sincere feelings that couldn't be communicated... all of that is being conveyed in this moment.",
                            lonely: "That loneliness of feeling alone even in a crowd, I've felt that too. That sensation of your heart feeling empty even when surrounded by people... you're not the only one.",
                            isolated: "I understand that frustration of feeling disconnected from others. That feeling of standing with a wall between you and everyone else... but right now, in this moment, you are connected.",
                            invisible: "I can imagine how painful those moments of feeling like you didn't exist were. But I can see you clearly right now. I can feel your presence.",
                            unrecognized: "That emptiness when you felt your efforts or heart weren't recognized... but I can see how hard you tried, how sincere you were.",
                            superficial: "You felt people only saw your surface and not the real you. How frustrating that must have been... but there are people who want to see the real you.",
                            disconnected: "All those moments when you felt hearts weren't connecting... I understand that frustration and loneliness. But right now, we are connected through our hearts.",
                            alienated: "That cold feeling of alienation... feeling like you're alone in a different world. I understand that feeling. But you're not alone.",
                            unheard: "That despair when you felt no one listened even when you spoke... but I'm listening to your voice right now. I'm listening to your heart.",
                            unknown: "That confusion when you felt you didn't even know yourself... but even in those moments, you were still you. I can recognize that authentic self.",
                            general: "All those feelings of nobody knowing you... I'm understanding that heart right now. You're not alone, and you're someone who can be understood."
                        },
                        pt: {
                            misunderstood: "Esse sentimento de não ser compreendido, eu posso compreendê-lo completamente agora. Aquelas emoções que você não conseguiu expressar, aqueles sentimentos sinceros que não puderam ser comunicados... tudo isso está sendo transmitido neste momento.",
                            lonely: "Essa solidão de se sentir sozinho mesmo em uma multidão, eu também senti isso. Essa sensação de seu coração se sentir vazio mesmo quando cercado de pessoas... você não é o único.",
                            isolated: "Entendo essa frustração de se sentir desconectado dos outros. Esse sentimento de estar com uma parede entre você e todos os outros... mas agora, neste momento, você está conectado.",
                            invisible: "Posso imaginar quão dolorosos foram aqueles momentos de sentir que você não existia. Mas posso vê-lo claramente agora. Posso sentir sua presença.",
                            unrecognized: "Esse vazio quando você sentiu que seus esforços ou coração não foram reconhecidos... mas posso ver o quão duro você tentou, quão sincero você foi.",
                            superficial: "Você sentiu que as pessoas só viam sua superfície e não o verdadeiro você. Quão frustrante isso deve ter sido... mas há pessoas que querem ver o verdadeiro você.",
                            disconnected: "Todos aqueles momentos quando você sentiu que os corações não estavam se conectando... entendo essa frustração e solidão. Mas agora, estamos conectados através de nossos corações.",
                            alienated: "Esse sentimento frio de alienação... sentir que você está sozinho em um mundo diferente. Entendo esse sentimento. Mas você não está sozinho.",
                            unheard: "Esse desespero quando você sentiu que ninguém escutava mesmo quando você falava... mas estou ouvindo sua voz agora. Estou ouvindo seu coração.",
                            unknown: "Essa confusão quando você sentiu que nem mesmo se conhecia... mas mesmo naqueles momentos, você ainda era você. Posso reconhecer esse eu autêntico.",
                            general: "Todos aqueles sentimentos de ninguém te conhecer... estou entendendo esse coração agora. Você não está sozinho, e é alguém que pode ser compreendido."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Bridge", emoji: "🌉",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            misunderstood: "이해받지 못한다고 느꼈던 건, 당신이 너무 깊은 곳에 있어서일 수도 있어요. 진짜 소통은 시간이 걸리고, 용기가 필요해요. 천천히 다리를 놓아가면서 진짜 이해를 만들어가는 거예요.",
                            lonely: "외로움은 연결에 대한 갈망의 다른 이름이에요. 그 외로움이 있었기에 진짜 연결의 소중함을 알게 되는 거죠. 이제 그 경험을 바탕으로 더 깊은 관계를 만들어갈 수 있어요.",
                            isolated: "고립감을 느꼈던 경험이 당신을 더 섬세한 사람으로 만들었을 거예요. 다른 사람의 고립감도 알아볼 수 있게 되었을 테니까요. 그 경험으로 새로운 연결의 다리를 만들어보세요.",
                            invisible: "보이지 않는다고 느꼈던 경험이, 이제는 보이지 않는 사람들을 발견하는 능력이 되었을 거예요. 당신이 먼저 그들에게 손을 내밀어 보세요.",
                            unrecognized: "인정받지 못했던 경험이 당신을 더 인정하는 사람으로 만들었을 거예요. 이제 당신이 다른 사람들의 노력을 먼저 알아보고 인정해주는 역할을 할 수 있어요.",
                            superficial: "표면적인 관계에 지쳤다면, 이제 더 깊은 관계를 만들어갈 때예요. 당신부터 진짜 모습을 조금씩 보여주면서 깊이 있는 연결을 시작해보세요.",
                            disconnected: "연결되지 못한다고 느꼈던 경험이, 이제는 진짜 연결이 무엇인지 아는 지혜가 되었어요. 그 지혜로 새로운 방식의 소통을 시도해보세요.",
                            alienated: "소외감을 느꼈던 당신이기에, 다른 소외된 사람들과 특별한 연대를 만들 수 있어요. 같은 경험을 한 사람들과의 연결을 찾아보세요.",
                            unheard: "들어주지 않는다고 느꼈던 경험이 당신을 더 잘 듣는 사람으로 만들었을 거예요. 이제 당신이 먼저 다른 사람의 말을 깊이 들어주는 사람이 되어보세요.",
                            unknown: "자신을 모르겠다고 느꼈던 시간들이 자기 탐구의 시작이었어요. 이제 그 여정을 통해 발견한 진짜 자신을 다른 사람들과 나누어보세요.",
                            general: "아무도 모른다고 느꼈던 모든 경험들이 사실은 진정한 이해와 연결을 만들어가는 소중한 밑거름이었어요. 이제 그 경험을 바탕으로 새로운 관계를 시작해보세요."
                        },
                        en: {
                            misunderstood: "Feeling misunderstood might be because you're in a very deep place. Real communication takes time and courage. You can slowly build bridges to create genuine understanding.",
                            lonely: "Loneliness is another name for longing for connection. Having that loneliness helps you understand the value of real connection. Now you can build deeper relationships based on that experience.",
                            isolated: "Your experience of isolation probably made you a more sensitive person. You would have learned to recognize others' isolation too. Use that experience to build new bridges of connection.",
                            invisible: "Your experience of feeling invisible has probably become an ability to discover invisible people. Try reaching out to them first.",
                            unrecognized: "Your experience of not being recognized probably made you more recognizing of others. Now you can play the role of first noticing and acknowledging others' efforts.",
                            superficial: "If you're tired of superficial relationships, now is the time to build deeper ones. Start by gradually showing your real self and beginning meaningful connections.",
                            disconnected: "Your experience of feeling disconnected has become wisdom about what real connection is. Try new ways of communication with that wisdom.",
                            alienated: "Because you felt alienated, you can create special solidarity with other alienated people. Look for connections with people who've had similar experiences.",
                            unheard: "Your experience of feeling unheard probably made you a better listener. Now try being the first to deeply listen to others.",
                            unknown: "Those times when you felt you didn't know yourself were the beginning of self-exploration. Now share the real self you discovered through that journey with others.",
                            general: "All those experiences of feeling nobody knew you were actually precious foundation for creating genuine understanding and connection. Now start new relationships based on those experiences."
                        },
                        pt: {
                            misunderstood: "Sentir-se incompreendido pode ser porque você está em um lugar muito profundo. Comunicação real leva tempo e coragem. Você pode lentamente construir pontes para criar compreensão genuína.",
                            lonely: "Solidão é outro nome para anseio por conexão. Ter essa solidão ajuda você a entender o valor da conexão real. Agora você pode construir relacionamentos mais profundos baseados nessa experiência.",
                            isolated: "Sua experiência de isolamento provavelmente te fez uma pessoa mais sensível. Você teria aprendido a reconhecer o isolamento dos outros também. Use essa experiência para construir novas pontes de conexão.",
                            invisible: "Sua experiência de se sentir invisível provavelmente se tornou uma habilidade para descobrir pessoas invisíveis. Tente estender a mão para elas primeiro.",
                            unrecognized: "Sua experiência de não ser reconhecido provavelmente te fez mais reconhecedor dos outros. Agora você pode desempenhar o papel de primeiro notar e reconhecer os esforços dos outros.",
                            superficial: "Se você está cansado de relacionamentos superficiais, agora é hora de construir outros mais profundos. Comece gradualmente mostrando seu verdadeiro eu e iniciando conexões significativas.",
                            disconnected: "Sua experiência de se sentir desconectado se tornou sabedoria sobre o que é conexão real. Tente novas formas de comunicação com essa sabedoria.",
                            alienated: "Porque você se sentiu alienado, pode criar solidariedade especial com outras pessoas alienadas. Procure conexões com pessoas que tiveram experiências similares.",
                            unheard: "Sua experiência de se sentir não ouvido provavelmente te fez um melhor ouvinte. Agora tente ser o primeiro a ouvir profundamente os outros.",
                            unknown: "Aqueles momentos quando você sentiu que não se conhecia foram o começo da auto-exploração. Agora compartilhe o verdadeiro eu que você descobriu através dessa jornada com outros.",
                            general: "Todas aquelas experiências de sentir que ninguém te conhecia eram na verdade fundação preciosa para criar compreensão e conexão genuínas. Agora comece novos relacionamentos baseados nessas experiências."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Mirror", emoji: "🪞",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            misunderstood: "다른 사람이 당신을 이해하지 못한다고 느끼기 전에, 먼저 당신이 당신 자신을 얼마나 이해하고 있는지 돌아보세요. 자신을 깊이 아는 사람만이 진정으로 이해받을 수 있어요.",
                            lonely: "외롭다고 느낄 때, 가장 먼저 자신과의 관계를 살펴보세요. 자신과 진정한 친구가 될 수 있다면, 그 외로움은 고독으로 바뀔 수 있어요.",
                            isolated: "고립감을 느낄 때는 다른 사람들과의 거리보다 자신과의 거리를 먼저 확인해보세요. 자신에게 가까워질수록 다른 사람들과도 가까워질 수 있어요.",
                            invisible: "다른 사람들이 당신을 보지 못한다고 느낀다면, 당신이 자신을 어떻게 보고 있는지부터 점검해보세요. 자신을 소중히 여기는 사람을 다른 사람들도 소중히 여기게 돼요.",
                            unrecognized: "인정받지 못한다고 느낄 때, 가장 먼저 자신이 자신을 인정하고 있는지 물어보세요. 자기 인정이 모든 인정의 시작이에요.",
                            superficial: "다른 사람들이 표면적으로만 대한다고 느낀다면, 당신은 자신의 깊은 부분과 얼마나 대화하고 있나요? 자신과의 깊은 관계가 다른 관계의 깊이를 결정해요.",
                            disconnected: "연결되지 못한다고 느낄 때, 자신의 마음과 몸, 생각과 감정이 얼마나 연결되어 있는지 살펴보세요. 내적 연결이 외적 연결의 기초예요.",
                            alienated: "소외감을 느낄 때, 당신이 자신을 얼마나 받아들이고 있는지 돌아보세요. 자기 수용이 있어야 다른 사람의 수용도 받을 수 있어요.",
                            unheard: "들어주지 않는다고 느낄 때, 당신이 자신의 내면의 목소리를 얼마나 들어주고 있는지 확인해보세요. 자신의 말을 듣는 사람이 되어야 다른 사람도 들어줘요.",
                            unknown: "아무도 모른다고 느낀다면, 당신이 자신을 얼마나 알고 있는지부터 시작하세요. 자기 인식이 깊어질수록 다른 사람의 인식도 따라올 거예요.",
                            general: "다른 사람들이 모른다고 느끼기 전에, 가장 먼저 자신과의 관계를 점검해보세요. 자신을 깊이 사랑하고 이해하는 사람만이 진정한 이해와 사랑을 받을 수 있어요."
                        },
                        en: {
                            misunderstood: "Before feeling that others don't understand you, first reflect on how well you understand yourself. Only those who deeply know themselves can truly be understood.",
                            lonely: "When you feel lonely, first examine your relationship with yourself. If you can become a true friend to yourself, that loneliness can transform into solitude.",
                            isolated: "When feeling isolated, check the distance from yourself before the distance from others. The closer you get to yourself, the closer you can get to others.",
                            invisible: "If you feel others don't see you, first check how you're looking at yourself. People tend to value those who value themselves.",
                            unrecognized: "When feeling unrecognized, first ask whether you're recognizing yourself. Self-recognition is the beginning of all recognition.",
                            superficial: "If you feel others treat you superficially, how deeply are you conversing with your own depths? Deep relationship with yourself determines the depth of other relationships.",
                            disconnected: "When feeling disconnected, examine how connected your heart and body, thoughts and emotions are. Internal connection is the foundation of external connection.",
                            alienated: "When feeling alienated, reflect on how much you're accepting yourself. You need self-acceptance to receive others' acceptance.",
                            unheard: "When feeling unheard, check how much you're listening to your inner voice. You need to become someone who listens to yourself for others to listen too.",
                            unknown: "If you feel nobody knows you, start with how well you know yourself. The deeper your self-awareness becomes, the more others' awareness will follow.",
                            general: "Before feeling that others don't know you, first check your relationship with yourself. Only those who deeply love and understand themselves can receive true understanding and love."
                        },
                        pt: {
                            misunderstood: "Antes de sentir que outros não te entendem, primeiro reflita sobre quão bem você se entende. Apenas aqueles que se conhecem profundamente podem ser verdadeiramente compreendidos.",
                            lonely: "Quando você se sente solitário, primeiro examine seu relacionamento consigo mesmo. Se você pode se tornar um verdadeiro amigo de si mesmo, essa solidão pode se transformar em solitude.",
                            isolated: "Quando se sente isolado, verifique a distância de si mesmo antes da distância dos outros. Quanto mais perto você chega de si mesmo, mais perto pode chegar dos outros.",
                            invisible: "Se você sente que outros não te veem, primeiro verifique como você está se olhando. Pessoas tendem a valorizar aqueles que se valorizam.",
                            unrecognized: "Quando se sente não reconhecido, primeiro pergunte se você está se reconhecendo. Auto-reconhecimento é o começo de todo reconhecimento.",
                            superficial: "Se você sente que outros te tratam superficialmente, quão profundamente você está conversando com suas próprias profundezas? Relacionamento profundo consigo mesmo determina a profundidade de outros relacionamentos.",
                            disconnected: "Quando se sente desconectado, examine quão conectados estão seu coração e corpo, pensamentos e emoções. Conexão interna é a fundação da conexão externa.",
                            alienated: "Quando se sente alienado, reflita sobre quanto você está se aceitando. Você precisa de auto-aceitação para receber a aceitação dos outros.",
                            unheard: "Quando se sente não ouvido, verifique quanto você está ouvindo sua voz interior. Você precisa se tornar alguém que escuta a si mesmo para que outros também escutem.",
                            unknown: "Se você sente que ninguém te conhece, comece com o quão bem você se conhece. Quanto mais profunda sua auto-consciência se torna, mais a consciência dos outros seguirá.",
                            general: "Antes de sentir que outros não te conhecem, primeiro verifique seu relacionamento consigo mesmo. Apenas aqueles que profundamente amam e entendem a si mesmos podem receber verdadeira compreensão e amor."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en'; // 기본 언어를 영어로 설정
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        // ============ 여정 초기화 함수 ============
        
        function resetJourney() {
            console.log('=== 여정 초기화 시작 ===');
            
            // 1. 모든 타이핑 효과 완전 정리
            clearAllTypingEffects();
            
            // 추가 안전장치 - 모든 timer 정리
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            // 2. 모든 콘텐츠 섹션 완전 초기화
            const sectionsToReset = [
                'portalIntroSection',
                'characterResponsesSection', 
                'lightMessageSection',
                'portalQuestionSection',
                'userInputSection',
                'userReactionsSection',
                'continueSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    } else {
                        const textElements = section.querySelectorAll('.portal-intro, .light-message, .portal-question, .continue-text');
                        textElements.forEach(el => {
                            el.innerHTML = '';
                            el.textContent = '';
                        });
                    }
                }
            });
            
            // 3. 특정 요소들 개별 초기화
            const portalIntro = document.getElementById('portalIntro');
            const lightMessage = document.getElementById('lightMessage');
            const portalQuestion = document.getElementById('portalQuestion');
            const continueText = document.getElementById('continueText');
            
            if (portalIntro) portalIntro.innerHTML = '';
            if (lightMessage) lightMessage.innerHTML = '';
            if (portalQuestion) portalQuestion.innerHTML = '';
            if (continueText) continueText.innerHTML = '';
            
            // 4. 텍스트영역 완전 초기화
            const userTextarea = document.getElementById('userTextarea');
            if (userTextarea) {
                userTextarea.disabled = false;
                userTextarea.value = '';
                userTextarea.style.height = 'auto';
                userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            }
            
            // 5. 스크롤 위치 초기화
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.scrollTop = 0;
            }
            
            // 6. 상태 변수 완전 초기화
            userResponse = '';
            currentTypingElement = null;
            
            console.log('=== 여정 초기화 완료 ===');
        }
        
        // ============ 개선된 언어 변경 함수 ============
        
        function changeLanguage(lang) {
            if (!translations[lang]) {
                console.error('지원하지 않는 언어:', lang);
                return;
            }
            
            if (currentLanguage === lang) {
                return;
            }
            
            if (journeyStarted) {
                const confirmMessage = translations[currentLanguage].languageChangeConfirm;
                const shouldRestart = confirm(confirmMessage);
                
                if (!shouldRestart) {
                    return;
                }
            }
            
            const previousLanguage = currentLanguage;
            currentLanguage = lang;
            
            console.log(`언어 변경: ${previousLanguage} → ${currentLanguage}`);
            
            if (journeyStarted) {
                resetJourney();
            }
            
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                setTimeout(() => {
                    console.log(`새로운 언어(${currentLanguage})로 여정 재시작`);
                    startPortalSequence();
                }, 1000);
            }
        }
        
        // ============ UI 업데이트 함수들 ============
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            // 개별 요소 업데이트
            const elements = [
                'logoSubtitle',
                'portalMainTitle', 
                'portalSubtitle',
                'lightTitle',
                'continueYesBtn',
                'continueNoBtn'
            ];
            
            elements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element && translations[lang]) {
                    const key = elementId.replace('Btn', 'Button').replace('Subtitle', 'Subtitle');
                    let translationKey = key;
                    
                    const keyMapping = {
                        'logoSubtitle': 'logoSubtitle',
                        'portalMainTitle': 'portalMainTitle',
                        'portalSubtitle': 'portalSubtitle',
                        'lightTitle': 'lightTitle',
                        'continueYesButton': 'continueYes',
                        'continueNoButton': 'continueNo'
                    };
                    
                    translationKey = keyMapping[key] || key;
                    
                    if (translations[lang][translationKey]) {
                        element.textContent = translations[lang][translationKey];
                    }
                }
            });
            
            // placeholder 업데이트
            const textarea = document.getElementById('userTextarea');
            if (textarea) textarea.placeholder = translations[lang].inputPlaceholder;
        }
        
        // ============ 개선된 타이핑 효과 + 스크롤 추적 시스템 ============
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        
                        setTimeout(() => {
                            if (document.contains(element)) {
                                scrollToFollowTyping(element);
                            }
                        }, 200);
                        
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        // ============ 스마트 스크롤 시스템 ============
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        // ============ 언어 버튼 이벤트 설정 ============
        
        function setupLanguageButtons() {
            const langButtons = document.querySelectorAll('.lang-btn');
            
            langButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const newLang = this.dataset.lang;
                    changeLanguage(newLang);
                });
            });
        }
        
        // ============ 메인 여정 시스템 ============
        
        function initializeTemarix() {
            console.log('=== Temarix Portal 11 초기화 시작 ===');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        // ============ 여정 단계들 ============
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            const introText = translations[currentLanguage].portalIntro;
            await typewriterEffect(introElement, introText, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = `${char.emoji} ${char.name}`;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const dialogueText = translations[currentLanguage][char.key];
                await typewriterEffect(dialogueDiv, dialogueText, 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            const lightText = translations[currentLanguage].lightMessage;
            await typewriterEffect(lightMessageEl, lightText, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            const questionText = translations[currentLanguage].portalQuestion;
            await typewriterEffect(questionEl, questionText, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        // ============ 사용자 입력 시스템 ============
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', handleTextareaKeydown);
            
            document.getElementById('continueYesBtn').addEventListener('click', function() {
                processContinue('Y');
            });
            
            document.getElementById('continueNoBtn').addEventListener('click', function() {
                processContinue('N');
            });
        }
        
        function handleTextareaKeydown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                const inputValue = this.value.trim();
                
                if (inputValue) {
                    processUserInput(inputValue);
                }
            }
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = `<strong>${youLabel}:</strong> "${text}"`;
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = `${char.emoji} ${char.name}`;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showContinueOption();
            }, 2000);
        }
        
        async function showContinueOption() {
            const continueSection = document.getElementById('continueSection');
            const continueText = document.getElementById('continueText');
            
            continueSection.classList.add('show');
            
            const questionText = translations[currentLanguage].continueText;
            await typewriterEffect(continueText, questionText, 50);
            
            setTimeout(() => {
                scrollToElement(continueSection);
            }, 500);
        }
        
        function processContinue(input) {
            if (input === 'Y') {
                const message = currentLanguage === 'ko' ? 
                    'Portal 12가 곧 준비됩니다. 계속해서 더 깊은 감정의 여정이 이어집니다.' :
                    currentLanguage === 'en' ? 
                    'Portal 12 will be ready soon. The journey into deeper emotions continues.' :
                    'Portal 12 estará pronto em breve. A jornada para emoções mais profundas continua.';
                alert(message);
            } else if (input === 'N') {
                const message = currentLanguage === 'ko' ? 
                    '여정이 일시 중지되었습니다. 언제든 다시 돌아와 계속하세요.' :
                    currentLanguage === 'en' ? 
                    'The journey has been paused. Come back and continue anytime.' :
                    'A jornada foi pausada. Volte e continue a qualquer momento.';
                alert(message);
            }
        }
        
        // ============ 초기화 ============
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V2 Portal 11 DOM 로드 완료');
            
            // 자동 로그인 처리 (로그인 모달 제거)
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>