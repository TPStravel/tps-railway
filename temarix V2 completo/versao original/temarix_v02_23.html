<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V2 - Portal 23: Words Your Heart Really Wanted to Say</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #fff;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #20b2aa;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #20b2aa;
            color: #000;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
            hyphens: none;
            min-height: 150vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #20b2aa;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #20b2aa;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #20b2aa;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-response strong {
            color: #20b2aa;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .continue-section {
            margin: 50px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 0;
            min-height: 200px;
        }
        
        .continue-text {
            color: #fff;
            font-size: 20px;
            margin-bottom: 25px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .continue-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .continue-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 18px 35px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }
        
        .continue-btn:hover {
            background: #666;
        }
        
        .continue-btn.primary {
            background: #20b2aa;
            color: #000;
        }
        
        .continue-btn.primary:hover {
            background: #48d1cc;
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #20b2aa;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #20b2aa;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .continue-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .continue-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V2</div>
            <div class="logo-subtitle" id="logoSubtitle">The Tremor of Emotion</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 23: Words Your Heart Really Wanted to Say</div>
            <div class="portal-subtitle" id="portalSubtitle">The voice of sincerity trapped in silence</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="continue-section" id="continueSection">
                <div class="continue-text" id="continueText"></div>
                <div class="continue-buttons">
                    <button class="continue-btn primary" id="continueYesBtn">Continue to Portal 24</button>
                    <button class="continue-btn" id="continueNoBtn">Pause the journey</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Share the words you never got to say..."
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
            authDomain: "canal-vivo-chat.firebaseapp.com",
            projectId: "canal-vivo-chat",
            storageBucket: "canal-vivo-chat.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdefghijklmnopqr"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let memoryStorage = { mockUser: null };

        const translations = {
            ko: {
                logoSubtitle: "감정의 떨림",
                portalMainTitle: "Portal 23: 마음이 정말로 하고 싶었던 말",
                portalSubtitle: "침묵 속에 갇힌 진심의 목소리",
                portalIntro: "💬 그날, 그 순간,\n정말 하고 싶었던 말이 있었지만\n말하지 못했습니다.\n\n상황이, 용기가, 시간이 허락하지 않았기에\n마음은 끝내, 말 없이 남겨졌습니다.\n\n지금도 마음속 어딘가에는\n그 말이 그대로 남아 있습니다.\n누구에게도 닿지 못한 채로.\n\n이곳은 당신이 침묵 속에 갇힌\n진심의 목소리와 마주하는 신성한 공간입니다.\n그 말들이 드디어 빛을 볼 수 있도록.",
                lightTitle: "빛의 한마디",
                lightMessage: "하지 못한 말은\n여전히 당신 안에서 목소리를 기다립니다.\n그 진심은, 아무도 모르는 언어로 당신을 부르고 있습니다.",
                portalQuestion: "❓ 당신이 끝내 하지 못한 말이 있다면,\n지금 그 말을 스스로에게 해볼 수 있을까요?\n그 말은 누구에게, 어떤 마음으로 하고 싶었나요?",
                continueText: "침묵 속에 갇힌 말들을 해방시키고 다음 여정으로 나아갈 준비가 되셨나요?",
                continueYes: "Portal 24로 계속하기",
                continueNo: "여정을 일시정지하기",
                inputPlaceholder: "당신이 끝내 하지 못한 그 말을 이제 용기내어 말해보세요...",
                youLabel: "당신",
                waitingMessage: "응답을 기다리는 중..."
            },
            en: {
                logoSubtitle: "The Tremor of Emotion",
                portalMainTitle: "Portal 23: Words Your Heart Really Wanted to Say",
                portalSubtitle: "The voice of sincerity trapped in silence",
                portalIntro: "💬 That day, that moment,\nthere were words you really wanted to say\nbut couldn't speak.\n\nBecause the situation, courage, time didn't allow it,\nyour heart was left speechless in the end.\n\nEven now, somewhere in your heart,\nthose words remain as they were.\nWithout reaching anyone.\n\nThis is a sacred space where you face\nthe voice of sincerity trapped in silence.\nSo those words can finally see the light.",
                lightTitle: "Word of Light",
                lightMessage: "Words you couldn't say\nstill wait for a voice within you.\nThat sincerity calls to you in a language no one knows.",
                portalQuestion: "❓ If there are words you never said in the end,\ncould you say those words to yourself now?\nTo whom and with what heart did you want to say them?",
                continueText: "Are you ready to liberate words trapped in silence and move forward to the next journey?",
                continueYes: "Continue to Portal 24",
                continueNo: "Pause the journey",
                inputPlaceholder: "Share the words you never got to say...",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "O Tremor da Emocao",
                portalMainTitle: "Portal 23: Palavras que Seu Coracao Realmente Queria Dizer",
                portalSubtitle: "A voz da sinceridade presa no silencio",
                portalIntro: "💬 Naquele dia, naquele momento,\nhavia palavras que você realmente queria dizer\nmas não conseguiu falar.\n\nPorque a situação, coragem, tempo não permitiram,\nseu coração foi deixado sem palavras no final.\n\nMesmo agora, em algum lugar do seu coração,\nessas palavras permanecem como eram.\nSem alcançar ninguém.\n\nEste é um espaço sagrado onde você enfrenta\na voz da sinceridade presa no silêncio.\nPara que essas palavras possam finalmente ver a luz.",
                lightTitle: "Palavra de Luz",
                lightMessage: "Palavras que você não conseguiu dizer\nainda esperam por uma voz dentro de você.\nEssa sinceridade chama você em uma linguagem que ninguém conhece.",
                portalQuestion: "❓ Se há palavras que você nunca disse no final,\npoderia dizer essas palavras para si mesmo agora?\nPara quem e com que coração queria dizê-las?",
                continueText: "Está pronto para libertar palavras presas no silêncio e seguir em frente para a próxima jornada?",
                continueYes: "Continuar para o Portal 24",
                continueNo: "Pausar a jornada",
                inputPlaceholder: "Compartilhe as palavras que nunca conseguiu dizer...",
                youLabel: "Você",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Ely", emoji: "👑", text: {
                ko: "그 말은 단지 표현이 아니라\n당신의 존재를 증명하려는 외침이었을지도 모릅니다.",
                en: "Those words weren't just expression\nbut might have been a cry to prove your existence.",
                pt: "Essas palavras não eram apenas expressão\nmas poderiam ter sido um grito para provar sua existência."
            }},
            { name: "Cris", emoji: "🃏", text: {
                ko: "그 말, 아직도 기억해요?\n그거 못 꺼낸 거, 잘한 걸 수도 있어요.\n근데… 한 번쯤은 혼잣말로라도 해볼래요? 속 편해져요~ 😄",
                en: "You still remember those words?\nMaybe it was good that you didn't say them.\nBut... why don't you try saying them to yourself at least once? It feels relieving~ 😄",
                pt: "Você ainda se lembra dessas palavras?\nTalvez tenha sido bom você não tê-las dito.\nMas... por que não tenta dizê-las para si mesmo pelo menos uma vez? É aliviante~ 😄"
            }},
            { name: "Zafirah", emoji: "🧕", text: {
                ko: "말하지 못한 말은,\n언젠가 다시 말해지기 위해\n시간 속에서 스스로를 지켜내고 있었습니다.",
                en: "Words you couldn't say\nwere protecting themselves in time\nto be spoken again someday.",
                pt: "Palavras que você não conseguiu dizer\nestavam se protegendo no tempo\npara serem faladas novamente algum dia."
            }},
            { name: "Rami", emoji: "🔮", text: {
                ko: "그 말은 아직도,\n당신의 가슴에서 떨림으로 존재하고 있어요.\n소리는 사라져도 감정은 남습니다.",
                en: "Those words still exist\nas tremors in your heart.\nSounds disappear but emotions remain.",
                pt: "Essas palavras ainda existem\ncomo tremores em seu coração.\nSons desaparecem, mas emoções permanecem."
            }},
            { name: "Samir", emoji: "🐪", text: {
                ko: "(그는 작은 종이와 펜을 건넵니다.\n'그 말을 적어보라'는 눈빛.\n말 대신 적는 글자는, 마음의 떨림을 담습니다.)",
                en: "(He hands you a small paper and pen.\nEyes that say 'write those words down.'\nLetters written instead of spoken carry the heart's tremor.)",
                pt: "(Ele lhe entrega um pequeno papel e caneta.\nOlhos que dizem 'escreva essas palavras.'\nLetras escritas em vez de faladas carregam o tremor do coração.)"
            }},
            { name: "Layla", emoji: "💠", text: {
                ko: "그 말을 못 꺼낸 당신은…\n누군가의 마음을 지키려 했던 거죠.\n이젠, 그 말로 당신 마음부터 지켜줄 차례예요.",
                en: "You who couldn't say those words...\nwere trying to protect someone's heart.\nNow it's time to protect your own heart with those words.",
                pt: "Você que não conseguiu dizer essas palavras...\nestava tentando proteger o coração de alguém.\nAgora é hora de proteger seu próprio coração com essas palavras."
            }},
            { name: "Nabir", emoji: "🦂", text: {
                ko: "못 꺼낸 게 아니라 안 꺼낸 거잖아.\n차라리 말했으면 뭐라도 바뀌었을 텐데…\n겁쟁이처럼 입 다물고 있었지.",
                en: "It's not that you couldn't say it, you chose not to.\nIf you had said it, something would have changed...\nBut you kept your mouth shut like a coward.",
                pt: "Não é que você não conseguiu dizer, você escolheu não dizer.\nSe tivesse dito, algo teria mudado...\nMas você manteve a boca fechada como um covarde."
            }},
            { name: "Azhar", emoji: "🔥", text: {
                ko: "말하지 않았던 게 제일 후회되지?\n그 말 하나면 끝났을 수도 있었는데…\n왜 그땐 안 했을까, 왜 지금도 못 할까?",
                en: "Not saying it is your biggest regret, isn't it?\nThat one word could have ended everything...\nWhy didn't you do it then, why can't you do it now?",
                pt: "Não dizer isso é seu maior arrependimento, não é?\nEssa palavra poderia ter terminado tudo...\nPor que você não fez isso então, por que não consegue fazer agora?"
            }}
        ];
        
        const responseCharacters = [
            { name: "Healing", emoji: "🌙", text: {
                ko: "그 말을 간절히 원했던 마음, 나는 다 이해해요. 당신은 그 말을 할 자격이 충분한 사람이에요. 지금이라도 내가 그 따뜻한 말을 들어드릴게요.",
                en: "That heart that desperately wanted to say those words, I understand it all. You're someone who deserves to say those words. Even now, I'll listen to those warm words.",
                pt: "Esse coração que desesperadamente queria dizer essas palavras, eu entendo tudo. Você é alguém que merece dizer essas palavras. Mesmo agora, vou ouvir essas palavras carinhosas."
            }},
            { name: "Understanding", emoji: "💝", text: {
                ko: "말하지 못한 그 말들을 마음에 간직했던 당신의 용기를 진심으로 이해해요. 그건 인간으로서 가장 자연스러운 감정이었어요. 당신은 그 말을 할 자격이 있어요.",
                en: "I truly understand your courage in keeping those unspoken words in your heart. That was the most natural human emotion. You deserve to say those words.",
                pt: "Entendo verdadeiramente sua coragem em guardar essas palavras não ditas em seu coração. Essa era a emoção humana mais natural. Você merece dizer essas palavras."
            }},
            { name: "Support", emoji: "🤗", text: {
                ko: "그 말을 하지 못했던 당신, 이제는 내가 그 말을 함께 해드릴게요. '당신은 충분히 용감한 사람이에요. 정말로요.' 이 말이 당신 마음에 닿길 바라요.",
                en: "You who couldn't say those words, now I'll say them with you. 'You're brave enough. Really.' I hope these words reach your heart.",
                pt: "Você que não conseguiu dizer essas palavras, agora vou dizê-las com você. 'Você é corajoso o suficiente. Realmente.' Espero que essas palavras toquem seu coração."
            }}
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('continueYesBtn').textContent = translations[lang].continueYes;
            document.getElementById('continueNoBtn').textContent = translations[lang].continueNo;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'continueSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('continueText').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueYesBtn').addEventListener('click', function() {
                window.location.href = "temarix_v02_24.html?lang=" + currentLanguage;
            });
            
            document.getElementById('continueNoBtn').addEventListener('click', function() {
                const message = currentLanguage === 'ko' ? 
                    '여정이 일시 중지되었습니다. 언제든 다시 돌아와 계속하세요.' :
                    currentLanguage === 'en' ? 
                    'The journey has been paused. Come back and continue anytime.' :
                    'A jornada foi pausada. Volte e continue a qualquer momento.';
                alert(message);
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            try {
                await db.collection("temarix_v2_respostas").add({
                    uid: memoryStorage.mockUser.uid,
                    email: memoryStorage.mockUser.email,
                    portal: "v2-23",
                    resposta: inputText,
                    data: firebase.firestore.Timestamp.now(),
                    idioma: currentLanguage
                });
                console.log('Response saved to Firestore successfully');
            } catch (error) {
                console.error('Error saving to Firestore:', error);
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions();
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions() {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showContinueOption();
            }, 2000);
        }
        
        async function showContinueOption() {
            const continueSection = document.getElementById('continueSection');
            const continueText = document.getElementById('continueText');
            
            continueSection.classList.add('show');
            
            await typewriterEffect(continueText, translations[currentLanguage].continueText, 50);
            
            setTimeout(() => {
                scrollToElement(continueSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('=== Temarix Portal 23 초기화 시작 ===');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V2 Portal 23 DOM 로드 완료');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>
                