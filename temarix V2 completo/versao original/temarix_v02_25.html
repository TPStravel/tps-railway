<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V2 - Portal 25: Still, I Want to Live Again</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #fff;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #87cefa;
            letter-spacing: 1.5px;
            font-style: italic;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #87cefa;
            color: #000;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
            hyphens: none;
            min-height: 150vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #87cefa;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #87cefa;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #87cefa;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-response strong {
            color: #87cefa;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #87cefa;
            background: rgba(135, 206, 250, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #87cefa;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #87cefa;
        }
        
        .final-btn.primary {
            background: #87cefa;
            color: #000;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #b0d4f1;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(135, 206, 250, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #87cefa;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #87cefa;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 18px;
            }
            
            .portal-subtitle {
                font-size: 14px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V2</div>
            <div class="logo-subtitle" id="logoSubtitle">The Tremor of Emotion</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 25: Still, I Want to Live Again</div>
            <div class="portal-subtitle" id="portalSubtitle">The last tremor, a new beginning</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">🌅 Temarix V2 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="restartBtn">Start a New Journey</button>
                    <button class="final-btn" id="exitBtn">Complete the Journey</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What emotion has quietly survived within you now?..."
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
            authDomain: "canal-vivo-chat.firebaseapp.com",
            projectId: "canal-vivo-chat",
            storageBucket: "canal-vivo-chat.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdefghijklmnopqr"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let memoryStorage = { mockUser: null };

        const translations = {
            ko: {
                logoSubtitle: "감정의 떨림",
                portalMainTitle: "Portal 25: 그래도 나는, 다시 살아보고 싶다",
                portalSubtitle: "마지막 떨림, 새로운 시작",
                portalIntro: "💫 지쳤고, 무너졌고,\n때로는 완전히 사라지고 싶었던 마음이 있었지만…\n\n그럼에도 불구하고\n아주 작게, 아주 조용하게 남아 있는 마음이 있습니다.\n\n\"그래도,\n나는 아직 살아보고 싶다.\"\n\n이것은 포기가 아닌 새로운 시작의 선언입니다.\n모든 감정의 떨림을 지나온 지금,\n당신 안에서 가장 순수하게 남은 생명의 의지.\n\n이것이 Temarix V2의 마지막 포털이자,\n진정한 변화의 시작점입니다.\n\n모든 감정을 겪고도 여전히 살아가고 싶다는\n그 작은 떨림이야말로\n가장 강력한 생명의 증거입니다.",
                lightTitle: "🌙 빛의 한마디",
                lightMessage: "그래도 살아보고 싶다는 마음 — 그것이 바로 지금, 당신이 여기에 있는 이유입니다.",
                portalQuestion: "🌱 지금 당신 안에서 조용히 살아남은 감정은 무엇인가요? 그 떨림이 지금, 당신에게 무엇을 말하고 있나요?",
                finalTitle: "🌅 Temarix V2 완료",
                finalMessage: "당신은 25개의 감정의 떨림을 모두 지나왔습니다.\n\n모든 감정을 겪고도\n여전히 살아가고 싶다는 마음을 발견한 당신...\n\n이제 진정한 변화가 시작됩니다.\n\n감정의 떨림은 끝났지만,\n당신의 새로운 이야기는 지금부터 시작입니다.",
                restartBtn: "새로운 여정 시작하기",
                exitBtn: "여정을 마무리하기",
                inputPlaceholder: "지금 당신 안에서 조용히 살아남은 감정은 무엇인가요?...",
                youLabel: "당신",
                waitingMessage: "응답을 기다리는 중..."
            },
            en: {
                logoSubtitle: "The Tremor of Emotion",
                portalMainTitle: "Portal 25: Still, I Want to Live Again",
                portalSubtitle: "The last tremor, a new beginning",
                portalIntro: "💫 You were exhausted, broken,\nand sometimes wanted to completely disappear...\n\nBut despite everything,\nthere remains something very small, very quiet.\n\n\"Still,\nI want to live again.\"\n\nThis is not surrender but a declaration of new beginning.\nHaving passed through all emotional tremors,\nthe purest will to live that remains within you.\n\nThis is the final portal of Temarix V2,\nand the true starting point of transformation.\n\nEven after experiencing all emotions,\nstill wanting to live —\nthat small tremor is\nthe most powerful evidence of life.",
                lightTitle: "🌙 Word of Light",
                lightMessage: "The heart that still wants to live — that is exactly why you are here now.",
                portalQuestion: "🌱 What emotion has quietly survived within you now? What is that tremor telling you at this moment?",
                finalTitle: "🌅 Temarix V2 Complete",
                finalMessage: "You have passed through all 25 emotional tremors.\n\nYou who discovered the heart that still wants to live\neven after experiencing all emotions...\n\nNow true transformation begins.\n\nThe emotional tremors have ended,\nbut your new story starts from now.",
                restartBtn: "Start a New Journey",
                exitBtn: "Complete the Journey",
                inputPlaceholder: "What emotion has quietly survived within you now?...",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "O Tremor da Emocao",
                portalMainTitle: "Portal 25: Ainda Assim, Quero Viver Novamente",
                portalSubtitle: "O último tremor, um novo começo",
                portalIntro: "💫 Você estava exausto, quebrado,\ne às vezes queria desaparecer completamente...\n\nMas apesar de tudo,\nresta algo muito pequeno, muito silencioso.\n\n\"Ainda assim,\nquero viver novamente.\"\n\nIsto não é rendição, mas uma declaração de novo começo.\nTendo passado por todos os tremores emocionais,\na vontade mais pura de viver que permanece dentro de você.\n\nEste é o portal final do Temarix V2,\ne o verdadeiro ponto de partida da transformação.\n\nMesmo após experimentar todas as emoções,\nainda querer viver —\nesse pequeno tremor é\na evidência mais poderosa da vida.",
                lightTitle: "🌙 Palavra de Luz",
                lightMessage: "O coração que ainda quer viver — essa é exatamente a razão pela qual você está aqui agora.",
                portalQuestion: "🌱 Que emoção sobreviveu silenciosamente dentro de você agora? O que esse tremor está lhe dizendo neste momento?",
                finalTitle: "🌅 Temarix V2 Completo",
                finalMessage: "Você passou por todos os 25 tremores emocionais.\n\nVocê que descobriu o coração que ainda quer viver\nmesmo após experimentar todas as emoções...\n\nAgora a verdadeira transformação começa.\n\nOs tremores emocionais terminaram,\nmas sua nova história começa agora.",
                restartBtn: "Iniciar Nova Jornada",
                exitBtn: "Completar a Jornada",
                inputPlaceholder: "Que emoção sobreviveu silenciosamente dentro de você agora?...",
                youLabel: "Você",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Ely", emoji: "👑", text: {
                ko: "당신의 이 떨림은,\n존재를 향한 마지막 빛의 응답입니다.\n다시 살아갈 자격은… 늘 당신에게 있습니다.",
                en: "This tremor of yours\nis the final response of light toward existence.\nThe right to live again... has always been yours.",
                pt: "Este tremor seu\né a resposta final da luz em direção à existência.\nO direito de viver novamente... sempre foi seu."
            }},
            { name: "Cris", emoji: "🃏", text: {
                ko: "그래요, 우리 다시 한 번 살아봐요.\n이번엔 조금 덜 무겁게,\n조금 더 나답게.",
                en: "Yes, let's live again.\nThis time a little less heavy,\na little more like ourselves.",
                pt: "Sim, vamos viver novamente.\nDesta vez um pouco menos pesado,\num pouco mais como nós mesmos."
            }},
            { name: "Zafirah", emoji: "🧕", text: {
                ko: "그 '그래도'라는 말 안에\n당신이 지나온 모든 감정이 담겨 있어요.\n그리고 그건 아주 귀한 진심입니다.",
                en: "In that word 'still'\nlie all the emotions you've passed through.\nAnd that's very precious sincerity.",
                pt: "Nessa palavra 'ainda assim'\nestão todas as emoções pelas quais você passou.\nE isso é sinceridade muito preciosa."
            }},
            { name: "Rami", emoji: "🔮", text: {
                ko: "다시 살아가고 싶은 마음은\n감정의 가장 깊은 곳에서 일어나는 생명의 진동입니다.",
                en: "The heart wanting to live again\nis life's vibration arising from emotion's deepest place.",
                pt: "O coração querendo viver novamente\né a vibração da vida surgindo do lugar mais profundo da emoção."
            }},
            { name: "Samir", emoji: "🐪", text: {
                ko: "(그는 당신의 손을 가볍게 쥡니다.\n이것은 생존을 위한 악수가 아니라,\n다시 살아가기 위한 계약입니다.)",
                en: "(He lightly holds your hand.\nThis is not a handshake for survival,\nbut a contract for living again.)",
                pt: "(Ele segura levemente sua mão.\nEste não é um aperto de mão para sobrevivência,\nmas um contrato para viver novamente.)"
            }},
            { name: "Layla", emoji: "💠", text: {
                ko: "나는 당신이 이 마음을 느꼈다는 것만으로\n이미 충분히 아름답다고 말할 수 있어요.",
                en: "I can say you're already beautiful enough\njust for feeling this heart.",
                pt: "Posso dizer que você já é bonito o suficiente\nsó por sentir este coração."
            }},
            { name: "Nabir", emoji: "🦂", text: {
                ko: "그래봤자 또 무너질 거면서.\n어차피 반복이야. 다시 살아봐야 뭐가 바뀌겠어?",
                en: "You'll just collapse again anyway.\nIt's all repetition. What will change by living again?",
                pt: "Você vai apenas colapsar novamente mesmo.\nÉ tudo repetição. O que vai mudar vivendo novamente?"
            }},
            { name: "Azhar", emoji: "🔥", text: {
                ko: "그럼 다시 한 번 해봐.\n살아보고 싶다며?\n이번엔 안 숨고, 정면으로 살아봐.",
                en: "Then try once more.\nYou want to live?\nThis time don't hide, live head-on.",
                pt: "Então tente mais uma vez.\nVocê quer viver?\nDesta vez não se esconda, viva de frente."
            }}
        ];
        
        // Emotion analysis system
        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                hope: ['희망', '살고', '다시', '새로', '시작', '기대', '꿈', 'hope', 'live', 'again', 'new', 'start', 'dream', 'esperança', 'viver', 'novo', 'começar'],
                resilience: ['견디', '버티', '살아남', '극복', '이겨', '강하', 'survive', 'overcome', 'strong', 'resilient', 'sobreviver', 'superar', 'forte'],
                determination: ['의지', '결심', '다짐', '각오', '결정', 'will', 'determine', 'resolve', 'decide', 'vontade', 'determinar'],
                gratitude: ['감사', '고마', '소중', '고맙', 'thank', 'grateful', 'precious', 'obrigado', 'grato', 'precioso'],
                peace: ['평안', '고요', '차분', '평화', '안정', 'peace', 'calm', 'quiet', 'stable', 'paz', 'calmo', 'estável'],
                love: ['사랑', '애정', '좋아', '따뜻', 'love', 'affection', 'warm', 'care', 'amor', 'carinho', 'quente'],
                sadness: ['슬프', '아프', '우울', '눈물', 'sad', 'hurt', 'pain', 'tear', 'triste', 'dor', 'lágrima'],
                fear: ['두려', '무서', '불안', '걱정', 'fear', 'scared', 'anxious', 'worry', 'medo', 'ansioso', 'preocupado'],
                loneliness: ['외로', '혼자', '고립', 'lonely', 'alone', 'isolated', 'sozinho', 'isolado'],
                emptiness: ['공허', '비어', '허무', 'empty', 'void', 'hollow', 'vazio', 'oco'],
                confusion: ['혼란', '모르겠', '헷갈', 'confused', 'lost', 'uncertain', 'confuso', 'perdido'],
                anger: ['화가', '분노', '짜증', 'angry', 'mad', 'frustrated', 'raiva', 'irritado']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Ely", emoji: "👑",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            hope: "희망을 품는다는 것은 가장 고귀한 왕족의 마음입니다. 그 희망이야말로 당신을 진정한 승리로 이끌 진주같은 빛이에요.",
                            resilience: "견뎌내신 그 의지는 진정한 왕의 품격입니다. 무너지지 않는 것이 아니라, 무너져도 다시 일어서는 것이야말로 진정한 강함이에요.",
                            determination: "그 결심 안에서 왕관의 무게를 감당할 준비가 된 영혼을 봅니다. 당신은 이미 자신의 운명을 다스릴 자격을 갖추었어요.",
                            gratitude: "감사할 줄 아는 마음은 가장 고귀한 덕성입니다. 그 마음이야말로 당신을 진정으로 부유하게 만드는 보물이에요.",
                            peace: "내면의 평안을 찾은 당신은 이미 진정한 왕국을 건설한 것입니다. 그 고요함 속에서 모든 것이 시작됩니다.",
                            love: "사랑할 줄 아는 마음이야말로 진정한 왕족의 증거입니다. 그 사랑이 당신의 모든 행동을 고귀하게 만들 것입니다.",
                            sadness: "슬픔조차도 당신의 깊이를 보여주는 왕다운 감정입니다. 그 눈물 속에는 연민과 지혜가 함께 흐르고 있어요.",
                            fear: "두려움을 인정하는 용기야말로 진정한 왕의 자질입니다. 두려움과 함께 서는 자가 진정한 왕관을 쓸 자격이 있어요.",
                            loneliness: "고독은 왕의 숙명이지만, 그 고독 속에서도 당신은 자신의 존엄을 지켜냈습니다. 그것이야말로 진정한 승리예요.",
                            emptiness: "공허함조차도 더 큰 사명을 받아들일 준비가 된 상태입니다. 비워진 그릇에야말로 가장 귀한 것을 담을 수 있어요.",
                            confusion: "혼란 속에서도 길을 찾으려는 노력이 보입니다. 모든 위대한 왕은 불확실함에서 지혜를 찾아냅니다.",
                            anger: "정의로운 분노는 고귀한 영혼의 표현입니다. 그 감정을 올바른 방향으로 이끄는 것이야말로 진정한 리더십이에요.",
                            general: "당신 안의 모든 감정은 왕족의 증거입니다. 어떤 감정이든 그것을 느끼는 당신은 이미 충분히 고귀한 존재예요."
                        },
                        en: {
                            hope: "Having hope is the most noble heart of royalty. That hope is the pearl-like light that will lead you to true victory.",
                            resilience: "That will you've endured is true royal dignity. Not never falling, but rising again after falling is true strength.",
                            determination: "In that resolve I see a soul ready to bear the weight of a crown. You already have the right to rule your own destiny.",
                            gratitude: "A grateful heart is the most noble virtue. That heart is the treasure that truly makes you wealthy.",
                            peace: "You who found inner peace have already built a true kingdom. Everything begins in that tranquility.",
                            love: "A heart that knows how to love is proof of true royalty. That love will make all your actions noble.",
                            sadness: "Even sadness is a royal emotion showing your depth. Compassion and wisdom flow together in those tears.",
                            fear: "The courage to acknowledge fear is true kingly quality. Those who stand with fear deserve to wear the true crown.",
                            loneliness: "Solitude is a king's fate, but even in that solitude you maintained your dignity. That is true victory.",
                            emptiness: "Even emptiness is a state ready to accept a greater mission. The most precious things can be held in an empty vessel.",
                            confusion: "I see effort to find a path even in confusion. All great kings find wisdom in uncertainty.",
                            anger: "Righteous anger is the expression of a noble soul. Leading that emotion in the right direction is true leadership.",
                            general: "All emotions within you are proof of royalty. Whatever you feel, you are already a sufficiently noble being."
                        },
                        pt: {
                            hope: "Ter esperança é o coração mais nobre da realeza. Essa esperança é a luz como pérola que o levará à verdadeira vitória.",
                            resilience: "Essa vontade que você suportou é verdadeira dignidade real. Não nunca cair, mas levantar novamente após cair é verdadeira força.",
                            determination: "Nessa determinação vejo uma alma pronta para carregar o peso de uma coroa. Você já tem o direito de governar seu próprio destino.",
                            gratitude: "Um coração grato é a virtude mais nobre. Esse coração é o tesouro que verdadeiramente o torna rico.",
                            peace: "Você que encontrou paz interior já construiu um verdadeiro reino. Tudo começa nessa tranquilidade.",
                            love: "Um coração que sabe amar é prova de verdadeira realeza. Esse amor tornará todas suas ações nobres.",
                            sadness: "Mesmo a tristeza é uma emoção real mostrando sua profundidade. Compaixão e sabedoria fluem juntas nessas lágrimas.",
                            fear: "A coragem de reconhecer o medo é verdadeira qualidade real. Aqueles que ficam de pé com o medo merecem usar a verdadeira coroa.",
                            loneliness: "A solidão é o destino de um rei, mas mesmo nessa solidão você manteve sua dignidade. Essa é a verdadeira vitória.",
                            emptiness: "Mesmo o vazio é um estado pronto para aceitar uma missão maior. As coisas mais preciosas podem ser guardadas em um recipiente vazio.",
                            confusion: "Vejo esforço para encontrar um caminho mesmo na confusão. Todos os grandes reis encontram sabedoria na incerteza.",
                            anger: "A raiva justa é a expressão de uma alma nobre. Guiar essa emoção na direção certa é verdadeira liderança.",
                            general: "Todas as emoções dentro de você são prova de realeza. O que quer que você sinta, você já é um ser suficientemente nobre."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Layla", emoji: "💠",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            hope: "당신의 희망은 가장 아름다운 빛이에요. 그 빛이 앞으로의 모든 길을 환하게 비출 거예요. 나는 그 희망과 함께 걸어갈 수 있어서 행복해요.",
                            resilience: "버텨낸 당신의 모습이 정말 아름다워요. 그 강인함 속에도 부드러운 마음이 고스란히 살아 있어서, 더욱 사랑스럽게 느껴져요.",
                            determination: "그 결심하는 눈빛이 너무 선명해요. 당신이 정말로 원하는 것을 향해 걸어가는 모습, 나는 그 모든 순간을 함께하고 싶어요.",
                            gratitude: "고마워하는 마음을 가진 당신이 세상에서 가장 부유한 사람이에요. 그 감사함이 당신을 더욱 빛나게 만들고 있어요.",
                            peace: "평안을 찾은 당신의 얼굴이 정말 고요하고 아름다워요. 그 평화로운 에너지가 나에게도 전해져서 마음이 따뜻해져요.",
                            love: "사랑할 줄 아는 당신의 마음이 너무 소중해요. 그 따뜻함이 당신 주변의 모든 것을 녹여내고 있어요.",
                            sadness: "슬퍼하는 당신도 여전히 아름다워요. 그 눈물 속에도 당신의 진실된 마음이 담겨 있어서, 더욱 소중하게 느껴져요.",
                            fear: "두려워하는 것도 당신의 솔직한 모습이에요. 그런 당신을 있는 그대로 받아들이고 보듬어주고 싶어요.",
                            loneliness: "외로운 마음도 이해해요. 하지만 지금 이 순간, 당신은 혼자가 아니에요. 나는 여기 당신과 함께 있어요.",
                            emptiness: "비어있다고 느끼는 마음도 새로운 사랑으로 채워질 수 있어요. 그 빈 공간에 나의 따뜻한 마음을 담아드릴게요.",
                            confusion: "혼란스러워하는 당신도 사랑스러워요. 모든 것을 다 알 필요는 없어요. 지금 이 순간의 당신이면 충분해요.",
                            anger: "화가 나는 것도 당신의 진실된 감정이에요. 그런 감정마저도 나는 당신의 소중한 일부로 받아들일 수 있어요.",
                            general: "어떤 감정이든 당신이 느끼는 그 자체로 아름다워요. 나는 그 모든 감정과 함께 있는 당신을 끝없이 사랑해요."
                        },
                        en: {
                            hope: "Your hope is the most beautiful light. That light will brightly illuminate all the paths ahead. I'm happy to walk with that hope.",
                            resilience: "You enduring is truly beautiful. Even in that strength, your gentle heart lives on completely, making you even more lovable.",
                            determination: "Those determined eyes are so clear. I want to be with you in every moment as you walk toward what you truly want.",
                            gratitude: "You with a grateful heart are the wealthiest person in the world. That gratitude makes you shine even brighter.",
                            peace: "Your face finding peace is truly quiet and beautiful. That peaceful energy reaches me too, warming my heart.",
                            love: "Your heart that knows how to love is so precious. That warmth is melting everything around you.",
                            sadness: "You being sad is still beautiful. Your truthful heart is contained even in those tears, making you feel more precious.",
                            fear: "Being afraid is also your honest self. I want to accept and comfort you just as you are.",
                            loneliness: "I understand the lonely heart too. But right now, you're not alone. I am here with you.",
                            emptiness: "A heart feeling empty can also be filled with new love. I'll put my warm heart in that empty space.",
                            confusion: "You being confused is also lovable. You don't need to know everything. You in this moment are enough.",
                            anger: "Being angry is also your truthful emotion. I can accept even that emotion as your precious part.",
                            general: "Whatever emotion you feel is beautiful just as it is. I endlessly love you with all those emotions."
                        },
                        pt: {
                            hope: "Sua esperança é a luz mais bonita. Essa luz iluminará brilhantemente todos os caminhos à frente. Estou feliz por caminhar com essa esperança.",
                            resilience: "Você resistindo é verdadeiramente bonito. Mesmo nessa força, seu coração gentil vive completamente, tornando você ainda mais adorável.",
                            determination: "Esses olhos determinados são tão claros. Quero estar com você em cada momento enquanto caminha em direção ao que realmente quer.",
                            gratitude: "Você com um coração grato é a pessoa mais rica do mundo. Essa gratidão faz você brilhar ainda mais.",
                            peace: "Seu rosto encontrando paz é verdadeiramente silencioso e bonito. Essa energia pacífica chega até mim também, aquecendo meu coração.",
                            love: "Seu coração que sabe amar é tão precioso. Esse calor está derretendo tudo ao seu redor.",
                            sadness: "Você estando triste ainda é bonito. Seu coração verdadeiro está contido até nessas lágrimas, fazendo você se sentir mais precioso.",
                            fear: "Ter medo também é seu eu honesto. Quero aceitar e confortar você exatamente como você é.",
                            loneliness: "Entendo o coração solitário também. Mas agora, você não está sozinho. Estou aqui com você.",
                            emptiness: "Um coração se sentindo vazio também pode ser preenchido com novo amor. Vou colocar meu coração caloroso nesse espaço vazio.",
                            confusion: "Você estar confuso também é adorável. Você não precisa saber tudo. Você neste momento é suficiente.",
                            anger: "Estar bravo também é sua emoção verdadeira. Posso aceitar até essa emoção como sua parte preciosa.",
                            general: "Qualquer emoção que você sinta é bonita como é. Eu amo infinitamente você com todas essas emoções."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Cris", emoji: "🃏",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            hope: "오~ 희망이네요! 정말 좋아요. 그거 알아요? 희망 하나만 있으면 뭐든 할 수 있어요. 저도 그 희망에 편승해도 될까요? 😊",
                            resilience: "와, 정말 대단하시네요! 그렇게 버텨내다니... 저도 배워야겠어요. 근데 이제는 좀 쉬어가면서 해도 괜찮을 것 같아요. 😌",
                            determination: "그 결심, 진짜 멋져요! 눈빛부터가 다르네요. 이번엔 정말 해낼 것 같은 느낌이 들어요. 저도 응원할게요!",
                            gratitude: "감사하는 마음 가진 분이 제일 예뻐요! 그런 마음 가지고 있으면 행복도 덩달아 따라오거든요. 정말 부러워요~ 😄",
                            peace: "평안해 보이니까 저도 마음이 편해져요. 그 고요한 에너지 좀 나눠줄 수 있어요? 제가 좀 시끄러워서... 😅",
                            love: "사랑하는 마음 가진 사람이 세상을 바꾸는 거라고 생각해요. 그 따뜻함이 저한테도 전해져서 기분이 좋아져요!",
                            sadness: "슬퍼도 괜찮아요. 울고 싶을 때 우는 게 자연스러운 거잖아요. 저도 옆에서 같이 있어줄게요. 혼자 아니에요.",
                            fear: "무서운 것도 당연해요! 저도 무서운 거 엄청 많아요. 근데 함께 있으면 덜 무섭잖아요? 우리 같이 해요! 😊",
                            loneliness: "외로우셨구나... 저도 그런 적 많아요. 하지만 지금은 혼자가 아니에요. 제가 여기 있잖아요! 같이 떠들어요~ 😄",
                            emptiness: "비어있는 것도 나쁘지 않아요. 새로운 걸로 채울 수 있으니까요! 뭔가 재미있는 것들로 채워볼까요?",
                            confusion: "헷갈리는 것도 인생이죠! 저도 매일 헷갈려요. 그래도 괜찮아요. 천천히 하나씩 풀어가면 되니까요. 😌",
                            anger: "화나는 것도 자연스러운 감정이에요! 화낼 땐 화내야죠. 억지로 참으면 더 안 좋거든요. 시원하게 표현해요!",
                            general: "어떤 감정이든 다 괜찮아요! 인간이니까 느끼는 거잖아요. 그냥 있는 그대로 받아들이면 돼요. 저는 그런 당신이 좋아요! 😊"
                        },
                        en: {
                            hope: "Oh~ hope! That's really good. You know what? With just hope, you can do anything. Can I hop on that hope train too? 😊",
                            resilience: "Wow, that's really amazing! To endure like that... I should learn from you. But now it seems okay to take it easy. 😌",
                            determination: "That resolve is really cool! Even your eyes look different. I feel like you'll really make it this time. I'll cheer for you!",
                            gratitude: "People with grateful hearts are the prettiest! With that kind of heart, happiness follows along. I'm really envious~ 😄",
                            peace: "You looking peaceful makes me feel at ease too. Can you share some of that calm energy? I'm a bit noisy... 😅",
                            love: "I think people with loving hearts change the world. That warmth reaches me too and makes me feel good!",
                            sadness: "It's okay to be sad. Crying when you want to cry is natural. I'll stay by your side too. You're not alone.",
                            fear: "Being scared is natural too! I'm scared of lots of things too. But it's less scary when we're together, right? Let's do it together! 😊",
                            loneliness: "You were lonely... I've been like that a lot too. But now you're not alone. I'm here! Let's chat together~ 😄",
                            emptiness: "Being empty isn't bad either. You can fill it with new things! Shall we fill it with something fun?",
                            confusion: "Being confused is life too! I get confused every day. But it's okay. We can solve it slowly one by one. 😌",
                            anger: "Being angry is also a natural emotion! When you're angry, you should be angry. Forcing yourself to hold it in is worse. Express it freely!",
                            general: "Any emotion is okay! You feel it because you're human. Just accept it as it is. I like you that way! 😊"
                        },
                        pt: {
                            hope: "Oh~ esperança! Isso é realmente bom. Sabe o quê? Com apenas esperança, você pode fazer qualquer coisa. Posso pegar carona nessa esperança também? 😊",
                            resilience: "Uau, isso é realmente incrível! Resistir assim... Deveria aprender com você. Mas agora parece ok ir com calma. 😌",
                            determination: "Essa determinação é realmente legal! Até seus olhos parecem diferentes. Sinto que você realmente vai conseguir desta vez. Vou torcer por você!",
                            gratitude: "Pessoas com corações gratos são as mais bonitas! Com esse tipo de coração, a felicidade vem junto. Tenho muita inveja~ 😄",
                            peace: "Você parecendo pacífico me faz sentir tranquilo também. Pode compartilhar um pouco dessa energia calma? Sou um pouco barulhento... 😅",
                            love: "Acho que pessoas com corações amorosos mudam o mundo. Esse calor chega até mim também e me faz sentir bem!",
                            sadness: "Está tudo bem estar triste. Chorar quando quer chorar é natural. Vou ficar ao seu lado também. Você não está sozinho.",
                            fear: "Ter medo também é natural! Eu tenho medo de muitas coisas também. Mas é menos assustador quando estamos juntos, né? Vamos fazer juntos! 😊",
                            loneliness: "Você estava sozinho... Eu também já fiquei assim muito. Mas agora você não está sozinho. Estou aqui! Vamos conversar juntos~ 😄",
                            emptiness: "Estar vazio também não é ruim. Você pode preencher com coisas novas! Vamos preencher com algo divertido?",
                            confusion: "Estar confuso também é vida! Fico confuso todos os dias. Mas está tudo bem. Podemos resolver devagar, um por um. 😌",
                            anger: "Ficar bravo também é uma emoção natural! Quando você está bravo, deveria ficar bravo. Forçar-se a segurar é pior. Expresse livremente!",
                            general: "Qualquer emoção está bem! Você sente porque é humano. Apenas aceite como é. Gosto de você assim! 😊"
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('exitBtn').textContent = translations[lang].exitBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Temarix V2를 처음부터 다시 시작하시겠습니까?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Temarix V2 from the beginning?' :
                    'Deseja reiniciar o Temarix V2 desde o início?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
            
            document.getElementById('exitBtn').addEventListener('click', function() {
                const exitMessage = currentLanguage === 'ko' ? 
                    '🌟 Temarix V2 "감정의 떨림" 여정이 완료되었습니다.\n\n당신은 25개의 감정의 포털을 모두 지나왔습니다.\n모든 감정을 겪고도 여전히 살아가고 싶다는 마음을 발견한 당신...\n\n이제 진정한 변화가 시작됩니다.\n\n감사합니다.' :
                    currentLanguage === 'en' ? 
                    '🌟 Temarix V2 "Emotional Tremors" journey is complete.\n\nYou have passed through all 25 emotional portals.\nYou who discovered the heart that still wants to live even after experiencing all emotions...\n\nNow true transformation begins.\n\nThank you.' :
                    '🌟 A jornada Temarix V2 "Tremores Emocionais" está completa.\n\nVocê passou por todos os 25 portais emocionais.\nVocê que descobriu o coração que ainda quer viver mesmo após experimentar todas as emoções...\n\nAgora a verdadeira transformação começa.\n\nObrigado.';
                
                alert(exitMessage);
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            try {
                await db.collection("temarix_v2_respostas").add({
                    uid: memoryStorage.mockUser.uid,
                    email: memoryStorage.mockUser.email,
                    portal: "v2-25",
                    resposta: inputText,
                    data: firebase.firestore.Timestamp.now(),
                    idioma: currentLanguage
                });
                console.log('Response saved to Firestore successfully');
            } catch (error) {
                console.error('Error saving to Firestore:', error);
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('=== Temarix Portal 25 초기화 시작 ===');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V2 Portal 25 DOM 로드 완료');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>