<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V2 - Portal 02: Fragments of Emotion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        /* ë¡œê·¸ì¸ ëª¨ë‹¬ */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .login-container {
            background: #111;
            border: 1px solid #444;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        .login-title {
            font-size: 28px;
            color: #87cefa;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        
        .login-subtitle {
            font-size: 16px;
            color: #ccc;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .login-input {
            width: 100%;
            background: transparent;
            border: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            padding: 15px;
            margin: 10px 0;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .login-input:focus {
            border-color: #87cefa;
        }
        
        .login-input::placeholder {
            color: #777;
        }
        
        .login-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 15px 30px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            transition: background 0.3s;
            min-width: 120px;
        }
        
        .login-btn:hover {
            background: #666;
        }
        
        .login-btn.primary {
            background: #87cefa;
            color: #000;
        }
        
        .login-btn.primary:hover {
            background: #b0d4f1;
        }
        
        .login-btn.gmail {
            background: #db4437;
            color: #fff;
            width: 100%;
            margin: 15px 0 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .login-btn.gmail:hover {
            background: #c23321;
        }
        
        .login-divider {
            margin: 20px 0;
            color: #666;
            font-size: 14px;
            position: relative;
        }
        
        .login-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #444;
            z-index: 1;
        }
        
        .login-divider span {
            background: #111;
            padding: 0 15px;
            position: relative;
            z-index: 2;
        }
        
        .login-error {
            color: #ff6666;
            font-size: 14px;
            margin-top: 15px;
            min-height: 20px;
        }
        
        /* ìƒë‹¨ í—¤ë” */
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #fff;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        /* ì–¸ì–´ ë²„íŠ¼ 3ê°œ */
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #87cefa;
            color: #000;
        }
        
        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
            hyphens: none;
            min-height: 150vh;
        }
        
        /* í…ìŠ¤íŠ¸ ì„¹ì…˜ë“¤ */
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #87cefa;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #87cefa;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #87cefa;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-response strong {
            color: #87cefa;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .continue-section {
            margin: 50px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 0;
            min-height: 200px;
        }
        
        .continue-text {
            color: #fff;
            font-size: 20px;
            margin-bottom: 25px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .continue-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .continue-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 18px 35px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }
        
        .continue-btn:hover {
            background: #666;
        }
        
        .continue-btn.primary {
            background: #87cefa;
            color: #000;
        }
        
        .continue-btn.primary:hover {
            background: #b0d4f1;
        }
        
        /* í•˜ë‹¨ ê³ ì • ì…ë ¥ì°½ */
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #87cefa;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #87cefa;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .continue-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .continue-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
    <div class="login-modal" id="loginModal">
        <div class="login-container">
            <div class="login-title">TEMARIX V2</div>
            <div class="login-subtitle" id="loginSubtitle">Emotional Fragments - Login Required</div>
            
            <!-- Gmail ë¡œê·¸ì¸ ë²„íŠ¼ -->
            <button type="button" class="login-btn gmail" id="gmailLoginBtn">
                <span>ğŸ“§</span>
                <span>Continue with Gmail</span>
            </button>
            
            <div class="login-divider">
                <span>or</span>
            </div>
            
            <form id="loginForm">
                <input type="email" class="login-input" id="loginEmail" placeholder="Email Address" required>
                <input type="password" class="login-input" id="loginPassword" placeholder="Password" required>
                
                <button type="submit" class="login-btn primary" id="loginButton">Login</button>
                <button type="button" class="login-btn" id="signupBtn">Sign Up</button>
            </form>
            
            <div class="login-error" id="loginError"></div>
        </div>
    </div>

    <!-- ìƒë‹¨ í—¤ë” -->
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V2</div>
            <div class="logo-subtitle" id="logoSubtitle">The Tremor of Emotion</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 02: Fragments of Emotion</div>
            <div class="portal-subtitle" id="portalSubtitle">When forgotten scenes begin to stir again</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <!-- í¬í„¸ ì¸íŠ¸ë¡œ -->
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <!-- ìºë¦­í„° ì‘ë‹µ ì„¹ì…˜ -->
            <div class="character-responses-section" id="characterResponsesSection">
                <!-- 8ëª…ì˜ ìºë¦­í„° ì‘ë‹µì´ ìˆœì°¨ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>

            <!-- ë¹›ì˜ í•œë§ˆë”” -->
            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <!-- ì§ˆë¬¸ ì„¹ì…˜ -->
            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <!-- ì‚¬ìš©ì ì…ë ¥ ì˜ì—­ -->
            <div class="user-input-section" id="userInputSection">
                <!-- ì‚¬ìš©ì ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            
            <!-- ì‚¬ìš©ì ì‘ë‹µ í›„ ìºë¦­í„° ë°˜ì‘ -->
            <div class="user-reactions-section" id="userReactionsSection">
                <!-- ì‚¬ìš©ì ì‘ë‹µ í›„ 3ëª…ì˜ ìºë¦­í„° ë°˜ì‘ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            
            <!-- ê³„ì†í•˜ê¸° ë²„íŠ¼ ì„¹ì…˜ -->
            <div class="continue-section" id="continueSection">
                <div class="continue-text" id="continueText"></div>
                <div class="continue-buttons">
                    <button class="continue-btn primary" id="continueYesBtn">Continue to Portal 03</button>
                    <button class="continue-btn" id="continueNoBtn">Pause the journey</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- í•˜ë‹¨ ê³ ì • ì…ë ¥ì°½ -->
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Express your emotions freely... (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <!-- âœ… Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- âœ… Firebase ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDReBGhb2gZNv7KA86HJXTeiLimWTrurp8",
            authDomain: "canal-vivo-chat.firebaseapp.com",
            projectId: "canal-vivo-chat",
        };

        firebase.initializeApp(firebaseConfig);
        
        // âœ… í•µì‹¬ ìˆ˜ì •: ë¡œê·¸ì¸ ì„¸ì…˜ ì§€ì†ì„± ì„¤ì •
        firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);
    </script>

    <script>
                        
        // ë²ˆì—­ ë°ì´í„°
        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ë–¨ë¦¼",
                portalMainTitle: "Portal 02: ê°ì •ì˜ íŒŒí¸",
                portalSubtitle: "ìŠì—ˆë‹¤ê³  ë¯¿ì—ˆë˜ ì¥ë©´ë“¤ì´ ë‹¤ì‹œ í”ë“¤ë¦´ ë•Œ",
                loginSubtitle: "ê°ì •ì˜ íŒŒí¸ - ë¡œê·¸ì¸ í•„ìš”",
                loginEmailPlaceholder: "ì´ë©”ì¼ ì£¼ì†Œ",
                loginPasswordPlaceholder: "ë¹„ë°€ë²ˆí˜¸",
                loginButton: "ë¡œê·¸ì¸",
                signupButton: "íšŒì›ê°€ì…",
                gmailLogin: "Gmailë¡œ ê³„ì†í•˜ê¸°",
                portalIntro: "ì–´ë–¤ ê°ì •ì€ ì™„ì „íˆ ì§€ë‚˜ê°”ë‹¤ê³  ë¯¿ì—ˆì§€ë§Œ,\nê·¸ ì¡°ê°ë“¤ì´ ë‹¤ì‹œ ë– ì˜¤ë¥¼ ë•Œê°€ ìˆì–´ìš”.\n\nìŠíŒ ì¤„ ì•Œì•˜ë˜ ì¥ë©´ì´ ë‹¤ì‹œ í”ë“¤ë¦¬ê³ ,\në¬´ëŒì§„ ì¤„ ì•Œì•˜ë˜ ìƒì²˜ê°€ ë‹¤ì‹œ ë”°ë”í•˜ê²Œ ë§ì„ ê±¸ì–´ìš”.\n\nì˜¤ëŠ˜ ë‹¹ì‹ ì˜ ë‚´ë©´ì—ì„œ 'ë‹¤ì‹œ ë– ì˜¤ë¥¸ ì¡°ê°'ì€ ë¬´ì—‡ì¸ê°€ìš”?\n\nê°ì •ì€ ì‹œê°„ ì†ì—ì„œ ì‚¬ë¼ì§€ëŠ” ê²ƒì´ ì•„ë‹ˆë¼,\nì¡°ìš©íˆ ìˆ¨ì–´ ìˆë‹¤ê°€ ì˜ˆìƒì¹˜ ëª»í•œ ìˆœê°„ì— ëŒì•„ì™€\nìš°ë¦¬ì—ê²Œ ì•„ì§ ëë‚˜ì§€ ì•Šì€ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì¤ë‹ˆë‹¤.",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ê°ì •ì€ ì§€ë‚˜ê°€ì§€ ì•ŠìŠµë‹ˆë‹¤.\nê°ì •ì€, ìˆ¨ì—ˆë‹¤ê°€ ëŒì•„ì˜¤ëŠ” ë°©ì‹ìœ¼ë¡œ ì™„ì„±ë©ë‹ˆë‹¤.",
                portalQuestion: "ìµœê·¼ì— ì˜ˆìƒì¹˜ ëª»í•˜ê²Œ ë– ì˜¤ë¥¸ ê°ì •ì˜ ì¥ë©´ì´ ìˆë‹¤ë©´,\nê·¸ ìˆœê°„ì„ ì„¤ëª…í•´ ì£¼ì„¸ìš”.\n\në¬´ì—‡ì´ ê·¸ ê¸°ì–µì„ ë‹¤ì‹œ ë¶ˆëŸ¬ì™”ê³ ,\nê·¸ ê°ì •ì€ ì§€ê¸ˆ ì–´ë–¤ ì–¸ì–´ë¥¼ ê°–ê³  ìˆë‚˜ìš”?",
                continueText: "ê°ì •ì˜ íŒŒí¸ë“¤ê³¼ ë§ˆì£¼í•œ ì´ ì—¬ì •ì„ ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                continueYes: "Portal 03ìœ¼ë¡œ ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                continueNo: "ì—¬ì •ì„ ì¼ì‹œì •ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                inputPlaceholder: "ë‹¹ì‹ ì˜ ê°ì •ì„ ììœ ë¡­ê²Œ í‘œí˜„í•´ ì£¼ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                languageChangeConfirm: "ì–¸ì–´ë¥¼ ë³€ê²½í•˜ë©´ ì—¬ì •ì´ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘ë©ë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...",
                // ìºë¦­í„° ëŒ€í™”
                charEly: "íŒŒí¸ì´ ëœ ê°ì •ë“¤ë„ ì—¬ì „íˆ ë‹¹ì‹  ì•ˆì—ì„œ ì†Œì¤‘í•œ ì—­í• ì„ í•˜ê³  ìˆì–´ìš”.\n\nê·¸ê²ƒë“¤ì€ ë¬´ë„ˆì§„ ì¡°ê°ì´ ì•„ë‹ˆë¼, ë‹¹ì‹ ì´ë¼ëŠ” ì¡´ì¬ë¥¼ ì´ë£¨ëŠ” ëª¨ìì´í¬ì˜ í•œ ë¶€ë¶„ì…ë‹ˆë‹¤.",
                charCris: "í—¤ì´! ê·¸ ê°ì • ë˜ ë‚˜íƒ€ë‚¬ë„¤ìš”?\nì§„ì§œ ì§‘ì°© ì©ŒëŠ” ì¹œêµ¬êµ°ìš”~ ğŸ˜\n\nê·¼ë° ì†”ì§íˆ ë§í•˜ë©´, ê·¸ ê°ì •ì´ ëŒì•„ì˜¨ ê±´... ì•„ì§ í•  ë§ì´ ìˆì–´ì„œ ê·¸ëŸ° ê±° ì•„ë‹ê¹Œìš”?",
                charZafirah: "ì‹œê°„ì´ ë¬»ì–´ë‘” ê°ì •ì˜ ì¡°ê°ë“¤ì´ ë‹¤ì‹œ ë°˜ì§ì´ê¸° ì‹œì‘í–ˆêµ°ìš”.\n\nê·¸ ì¡°ê°ë“¤ì€ ìŠí˜€ì§„ ê²ƒì´ ì•„ë‹ˆë¼, ë‹¹ì‹ ì´ ë°›ì•„ë“¤ì¼ ì¤€ë¹„ê°€ ë  ë•Œê¹Œì§€ ì¡°ìš©íˆ ê¸°ë‹¤ë¦¬ê³  ìˆì—ˆì–´ìš”.",
                charRami: "ê°ì •ì€ ì§ì„ ìœ¼ë¡œ íë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‚˜ì„ í˜•ìœ¼ë¡œ ëŒì•„ì™€ìš”.\n\nê°™ì€ ê°ì •ì´ë¼ê³  ìƒê°í–ˆì§€ë§Œ, ì‚¬ì‹¤ì€ ë” ê¹Šì€ ì¸µì—ì„œ ìƒˆë¡­ê²Œ ë§ì„ ê±°ëŠ” ì¤‘ì…ë‹ˆë‹¤.",
                charSamir: "(ê·¸ëŠ” ë¶€ì„œì§„ ë„ìê¸° ì¡°ê°ë“¤ì„ ëª¨ìœ¼ë”ë‹ˆ, ê·¸ê²ƒë“¤ì´ ì—¬ì „íˆ ì•„ë¦„ë‹¤ìš´ íŒ¨í„´ì„ ì´ë£¨ê³  ìˆìŒì„ ë³´ì—¬ì¤ë‹ˆë‹¤.\nê°ì •ì˜ íŒŒí¸ë„ ë§ˆì°¬ê°€ì§€ì…ë‹ˆë‹¤.)",
                charLayla: "ëŒì•„ì˜¨ ê°ì •ì€ ë‹¹ì‹ ì„ ê´´ë¡­íˆë ¤ëŠ” ê²Œ ì•„ë‹ˆë¼,\nì‚¬ë‘ë°›ì§€ ëª»í–ˆë˜ ê·¸ ì‹œì ˆì˜ ìì‹ ì„ ìœ„ë¡œë°›ê³  ì‹¶ì–´ì„œ ì˜¨ ê±°ì˜ˆìš”.\n\në‚˜ëŠ” ê·¸ ê°ì •ë„ í•¨ê»˜ ì•ˆì•„ì¤„ ìˆ˜ ìˆì–´ìš”.",
                charNabir: "ë˜ ê·¸ ì˜›ë‚  ì–˜ê¸°ì•¼?\níŒŒí¸ì´ë¼ê³  í¬ì¥í•˜ê³  ìˆì§€ë§Œ, ê·¸ëƒ¥ ë„¤ê°€ ë†“ì§€ ëª»í•˜ëŠ” ê±°ì–ì•„.\n\nì–¸ì œê¹Œì§€ ê·¸ ì¡°ê°ë“¤ ë¶™ë“¤ê³  ì‚´ ê±°ì•¼?",
                charAzhar: "ê°ì •ì˜ íŒŒí¸? ê·¸ëŸ° ê±° ì—†ì–´.\në„¤ê°€ ìŠ¤ìŠ¤ë¡œ ìƒì²˜ë¥¼ ë§ë‚´ê³  ìˆëŠ” ê±°ì•¼.\n\nê·¸ ê¸°ì–µë“¤, ì§„ì§œë¡œ íƒœì›Œë²„ë ¤. ì•„ë‹ˆë©´ í‰ìƒ ê·¸ë ‡ê²Œ ì‚´ì•„."
            },
            en: {
                logoSubtitle: "The Tremor of Emotion",
                portalMainTitle: "Portal 02: Fragments of Emotion",
                portalSubtitle: "When forgotten scenes begin to stir again",
                loginSubtitle: "Emotional Fragments - Login Required",
                loginEmailPlaceholder: "Email Address",
                loginPasswordPlaceholder: "Password",
                loginButton: "Login",
                signupButton: "Sign Up",
                gmailLogin: "Continue with Gmail",
                portalIntro: "Some emotions we believed had completely passed,\nbut their fragments resurface from time to time.\n\nForgotten scenes start to tremble again,\nand wounds we thought had dulled begin to sting and speak to us once more.\n\nWhat is the 'resurfaced fragment' within you today?\n\nEmotions don't disappear through time,\nbut quietly hide and return at unexpected moments\nto tell us stories that are not yet finished.",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Emotions don't pass away.\nEmotions complete themselves by hiding and returning.",
                portalQuestion: "If there's an emotional scene that unexpectedly surfaced recently,\nplease describe that moment.\n\nWhat brought that memory back,\nand what language does that emotion carry now?",
                continueText: "Will you continue this journey of facing emotional fragments?",
                continueYes: "Continue to Portal 03?",
                continueNo: "Pause the journey?",
                inputPlaceholder: "Express your emotions freely... (Press Enter to send)",
                youLabel: "You",
                languageChangeConfirm: "Changing the language will restart the journey from the beginning.\nDo you want to continue?",
                waitingMessage: "Waiting for response...",
                charEly: "Even fragmented emotions still play a precious role within you.\n\nThey are not broken pieces, but parts of the mosaic that forms your being.",
                charCris: "Hey! That emotion showed up again?\nWhat a persistent friend~ ğŸ˜\n\nBut honestly, maybe it came back because... it still has something to say?",
                charZafirah: "The fragments of emotions buried by time have begun to sparkle again.\n\nThose pieces weren't forgotten, but quietly waited until you were ready to accept them.",
                charRami: "Emotions don't flow in straight lines. They return in spirals.\n\nWhat you thought was the same emotion is actually speaking anew from a deeper layer.",
                charSamir: "(He gathers broken pottery pieces and shows that they still form a beautiful pattern.\nEmotional fragments are the same.)",
                charLayla: "The returned emotion isn't here to torment you,\nbut because that part of yourself from back then wants comfort and love.\n\nI can embrace that emotion together with you.",
                charNabir: "That old story again?\nYou're packaging it as 'fragments,' but you're just not letting go.\n\nHow long will you live holding onto those pieces?",
                charAzhar: "Emotional fragments? No such thing.\nYou're just reopening wounds yourself.\n\nBurn those memories for real. Or live like that forever."
            },
            pt: {
                logoSubtitle: "O Tremor da EmoÃ§Ã£o",
                portalMainTitle: "Portal 02: Fragmentos de EmoÃ§Ã£o",
                portalSubtitle: "Quando cenas esquecidas comeÃ§am a se agitar novamente",
                loginSubtitle: "Fragmentos Emocionais - Login Necessario",
                loginEmailPlaceholder: "Endereco de Email",
                loginPasswordPlaceholder: "Senha",
                loginButton: "Entrar",
                signupButton: "Cadastrar",
                gmailLogin: "Continuar com Gmail",
                portalIntro: "Algumas emoÃ§Ãµes que acreditÃ¡vamos ter passado completamente,\nmas seus fragmentos ressurgem de tempos em tempos.\n\nCenas esquecidas comeÃ§am a tremer novamente,\ne feridas que pensÃ¡vamos ter entorpecido comeÃ§am a arder e falar conosco mais uma vez.\n\nQual Ã© o 'fragmento ressurgido' dentro de vocÃª hoje?\n\nAs emoÃ§Ãµes nÃ£o desaparecem atravÃ©s do tempo,\nmas se escondem silenciosamente e retornam em momentos inesperados\npara nos contar histÃ³rias que ainda nÃ£o terminaram.",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "As emoÃ§Ãµes nÃ£o passam.\nAs emoÃ§Ãµes se completam escondendo-se e retornando.",
                portalQuestion: "Se hÃ¡ uma cena emocional que ressurgiu inesperadamente recentemente,\npor favor descreva esse momento.\n\nO que trouxe essa memÃ³ria de volta,\ne que linguagem essa emoÃ§Ã£o carrega agora?",
                continueText: "VocÃª continuarÃ¡ esta jornada de enfrentar fragmentos emocionais?",
                continueYes: "Continuar para o Portal 03?",
                continueNo: "Pausar a jornada?",
                inputPlaceholder: "Expresse suas emoÃ§Ãµes livremente... (Enter para enviar)",
                youLabel: "VocÃª",
                languageChangeConfirm: "Mudar o idioma reiniciarÃ¡ a jornada desde o inÃ­cio.\nDeseja continuar?",
                waitingMessage: "Aguardando resposta...",
                charEly: "Mesmo as emoÃ§Ãµes fragmentadas ainda desempenham um papel precioso dentro de vocÃª.\n\nElas nÃ£o sÃ£o pedaÃ§os quebrados, mas partes do mosaico que forma seu ser.",
                charCris: "Ei! Essa emoÃ§Ã£o apareceu de novo?\nQue amigo persistente~ ğŸ˜\n\nMas honestamente, talvez ela tenha voltado porque... ainda tem algo a dizer?",
                charZafirah: "Os fragmentos de emoÃ§Ãµes enterrados pelo tempo comeÃ§aram a brilhar novamente.\n\nEssas peÃ§as nÃ£o foram esquecidas, mas esperaram silenciosamente atÃ© vocÃª estar pronto para aceitÃ¡-las.",
                charRami: "As emoÃ§Ãµes nÃ£o fluem em linhas retas. Elas retornam em espirais.\n\nO que vocÃª pensou ser a mesma emoÃ§Ã£o estÃ¡ na verdade falando novamente de uma camada mais profunda.",
                charSamir: "(Ele reÃºne pedaÃ§os de cerÃ¢mica quebrada e mostra que eles ainda formam um padrÃ£o bonito.\nFragmentos emocionais sÃ£o iguais.)",
                charLayla: "A emoÃ§Ã£o que retornou nÃ£o estÃ¡ aqui para atormentÃ¡-lo,\nmas porque aquela parte de si mesmo daquela Ã©poca quer conforto e amor.\n\nEu posso abraÃ§ar essa emoÃ§Ã£o junto com vocÃª.",
                charNabir: "Essa velha histÃ³ria de novo?\nVocÃª estÃ¡ embalando como 'fragmentos', mas sÃ³ nÃ£o estÃ¡ deixando ir.\n\nPor quanto tempo vocÃª vai viver segurando essas peÃ§as?",
                charAzhar: "Fragmentos emocionais? NÃ£o existe isso.\nVocÃª sÃ³ estÃ¡ reabrindo feridas sozinho.\n\nQueime essas memÃ³rias de verdade. Ou viva assim para sempre."
            }
        };
        
        // ìºë¦­í„° ë°ì´í„°
        const characters = [
            { name: "Ely", emoji: "ğŸ‘‘", key: "charEly" },
            { name: "Cris", emoji: "ğŸƒ", key: "charCris" },
            { name: "Zafirah", emoji: "ğŸ§•", key: "charZafirah" },
            { name: "Rami", emoji: "ğŸ”®", key: "charRami" },
            { name: "Samir", emoji: "ğŸª", key: "charSamir" },
            { name: "Layla", emoji: "ğŸ’ ", key: "charLayla" },
            { name: "Nabir", emoji: "ğŸ¦‚", key: "charNabir" },
            { name: "Azhar", emoji: "ğŸ”¥", key: "charAzhar" }
        ];
        
        // ============ ê°ì • ë¶„ì„ ì‹œìŠ¤í…œ ============
        
        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            // ê°ì • í‚¤ì›Œë“œ ë§¤í•‘
            const emotionKeywords = {
                sadness: ['ìŠ¬í”„', 'ìš¸ê³ ', 'ëˆˆë¬¼', 'ìš°ìš¸', 'ì•”ìš¸', 'ì ˆë§', 'ìƒì‹¤', 'ìƒ', 'sad', 'cry', 'tear', 'depress', 'lost', 'triste', 'choro', 'lÃ¡grima'],
                anger: ['í™”ê°€', 'ë¶„ë…¸', 'ì§œì¦', 'ë¹¡ì³', 'ì—´ë°›', 'ì–µìš¸', 'ìš±í•˜', 'angry', 'mad', 'furious', 'rage', 'irritat', 'raiva', 'irritad'],
                anxiety: ['ë¶ˆì•ˆ', 'ê±±ì •', 'ì´ˆì¡°', 'ë‘ë ¤', 'ë¬´ì„œ', 'ë–¨ë ¤', 'ê¸´ì¥', 'anxious', 'worry', 'nervous', 'fear', 'scare', 'ansioso', 'medo', 'preocup'],
                loneliness: ['ì™¸ë¡œ', 'í˜¼ì', 'ê³ ë¦½', 'ì†Œì™¸', 'ë²„ë¦¼', 'ë– ë‚˜', 'ì´ë³„', 'lonely', 'alone', 'isolated', 'abandon', 'left', 'solidÃ£o', 'sozinho', 'abandon'],
                shame: ['ë¶€ë„', 'ì°½í”¼', 'ìˆ˜ì¹˜', 'ë¯¼ë§', 'ì£„ì†¡', 'ë¯¸ì•ˆ', 'shame', 'embarrass', 'guilt', 'sorry', 'vergonha', 'culpa'],
                confusion: ['í˜¼ë€', 'ëª¨ë¥´ê² ', 'í—·ê°ˆ', 'ë³µì¡', 'ì–´ì§€ëŸ¬', 'confus', 'lost', 'mixed', 'complicated', 'confuso', 'complicado'],
                hope: ['í¬ë§', 'ê¸°ëŒ€', 'ì„¤ë ˜', 'ê¸°ë‹¤ë ¤', 'ê¿ˆê¾¸', 'ë°”ë¼', 'hope', 'expect', 'dream', 'wish', 'esperanÃ§a', 'espera', 'sonho'],
                relief: ['í›„ë ¨', 'ê°œìš´', 'ì‹œì›', 'í•´ë°©', 'ììœ ', 'relief', 'free', 'liberat', 'alÃ­vio', 'liberdade'],
                regret: ['í›„íšŒ', 'ì•„ì‰¬', 'ê·¸ë•Œ', 'ì™œ ê·¸ë¬', 'ëŒì´í‚¤', 'regret', 'wish', 'should have', 'arrependiment'],
                emptiness: ['ê³µí—ˆ', 'í—ˆë¬´', 'ë¬´ê¸°ë ¥', 'í…… ë¹ˆ', 'ì•„ë¬´ê²ƒë„', 'empty', 'void', 'meaningless', 'nothing', 'vazio', 'inÃºtil']
            };
            
            // ê°ì • ë¶„ì„
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            // ê°ì •ì´ ê°ì§€ë˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ê°’ ì„¤ì •
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0]; // ì²« ë²ˆì§¸ ê°ì§€ëœ ê°ì • ë°˜í™˜
        }
        
        // ë°˜ì‘ ìºë¦­í„°ë“¤ (ê°œì„ ëœ ë²„ì „)
        const responseCharacters = [
            {
                name: "Luna", emoji: "ğŸŒ™",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            sadness: "ìŠ¬í””ì€ ë§ˆì¹˜ ê³ ìš”í•œ ë°¤ë°”ë‹¤ì²˜ëŸ¼ ê¹Šê³  ì¡°ìš©í•˜ì£ . ë‹¹ì‹ ì€ ê·¸ ì–´ë‘  ì†ì—ì„œë„ ìì‹ ì˜ ëª©ì†Œë¦¬ë¥¼ ëƒˆì–´ìš”. ê·¸ ìš©ê¸°ê°€ ë‹¬ë¹›ì²˜ëŸ¼ ì€ì€í•˜ê²Œ ë¹›ë‚˜ê³  ìˆìŠµë‹ˆë‹¤.",
                            anger: "ë¶„ë…¸ëŠ” ê°€ìŠ´ ì† ë¶‰ì€ ë‹¬ì´ ë– ì˜¤ë¥´ëŠ” ê²ƒê³¼ ê°™ì•„ìš”. ê·¸ ì—´ê¸° ì†ì—ë„ ë‹¹ì‹ ë§Œì˜ ì •ì˜ê°€ ìˆ¨ì–´ ìˆì—ˆìŠµë‹ˆë‹¤. ë‹¬ì´ ì°¨ì˜¤ë¥´ë“¯, ê·¸ ê°ì •ë„ ì–¸ì  ê°€ ê³ ìš”í•´ì§ˆ ê±°ì˜ˆìš”.",
                            anxiety: "ë¶ˆì•ˆì€ ìˆ˜ë©´ ì•„ë˜ ê¹Šì€ ì¡°ë¥˜ì²˜ëŸ¼ ë§ˆìŒì„ í”ë“¤ì£ . í•˜ì§€ë§Œ ë‹¹ì‹ ì€ ê·¸ íŒŒë„ ìœ„ì—ì„œë„ ìˆ¨ ì‰¬ê³  ìˆì–´ìš”. ê·¸ê²ƒë§Œìœ¼ë¡œë„ ì¶©ë¶„íˆ ëŒ€ë‹¨í•œ ì¼ì…ë‹ˆë‹¤.",
                            loneliness: "ì™¸ë¡œì›€ì€ ì–´ë‘ìš´ ë°”ë‹¤ í•œê°€ìš´ë° ë–  ìˆëŠ” ê²ƒ ê°™ì£ . í•˜ì§€ë§Œ ê·¸ ê³ ìš”í•¨ ì†ì—ì„œ ë‹¹ì‹ ì€ ê°€ì¥ ì§„ì‹¤í•œ ìì‹ ê³¼ ë§Œë‚¬ì„ ê±°ì˜ˆìš”. ê·¸ ë§Œë‚¨ì´ ì†Œì¤‘í•´ìš”.",
                            shame: "ìˆ˜ì¹˜ì‹¬ì€ ë‹¬ì´ êµ¬ë¦„ì— ê°€ë ¤ì§„ ê²ƒê³¼ ê°™ì•„ìš”. í•˜ì§€ë§Œ êµ¬ë¦„ì´ ì§€ë‚˜ê°€ë©´ ë‹¬ì€ ì—¬ì „íˆ ê·¸ ìë¦¬ì—ì„œ ë¹›ë‚˜ê³  ìˆì£ . ë‹¹ì‹ ë„ ê·¸ë˜ìš”.",
                            confusion: "í˜¼ë€ì€ ì•ˆê°œ ë‚€ ë°¤ê¸¸ì„ ê±·ëŠ” ê²ƒ ê°™ì£ . í•˜ì§€ë§Œ ê·¸ ì•ˆê°œë„ ìƒˆë²½ì´ ì˜¤ë©´ ê±·í˜€ìš”. ë‹¹ì‹ ì˜ ë§ˆìŒì—ë„ ê³§ ë§‘ì€ ìˆœê°„ì´ ì˜¬ ê±°ì˜ˆìš”.",
                            hope: "í¬ë§ì€ ìƒˆë²½ë…˜ í•˜ëŠ˜ì— ë– ì˜¤ë¥´ëŠ” ì´ˆìŠ¹ë‹¬ ê°™ì•„ìš”. ì‘ì§€ë§Œ í™•ì‹¤í•œ ë¹›ì´ì£ . ë‹¹ì‹ ì˜ ê·¸ ë¹›ì´ ì ì  ì°¨ì˜¤ë¥¼ ê±°ì˜ˆìš”.",
                            relief: "í•´ë°©ê°ì€ ê¸´ ë°¤ì´ ëë‚˜ê³  ì°¾ì•„ì˜¤ëŠ” ìƒˆë²½ ê°™ì•„ìš”. ë‹¹ì‹ ì€ ë“œë””ì–´ ìì‹ ë§Œì˜ í‰ì•ˆì„ ì°¾ì€ ê±°ì˜ˆìš”. ê·¸ ê³ ìš”í•¨ì„ ë§Œë½í•˜ì„¸ìš”.",
                            regret: "í›„íšŒëŠ” ë‹¬ë¬´ë¦¬ì²˜ëŸ¼ ë§ˆìŒì„ ë‘˜ëŸ¬ì‹¸ì£ . í•˜ì§€ë§Œ ê·¸ ë¬´ë¦¬ ë„ˆë¨¸ë¡œë„ ë‹¬ë¹›ì€ ì—¬ì „íˆ í˜ëŸ¬ë‚´ë ¤ìš”. ê³¼ê±°ì˜ ê·¸ë¦¼ìê°€ ì§€ê¸ˆì˜ ë¹›ì„ ê°€ë¦´ ìˆ˜ëŠ” ì—†ì–´ìš”.",
                            emptiness: "ê³µí—ˆí•¨ì€ ì‹ ì›” ê°™ì•„ìš”. ë³´ì´ì§€ ì•Šì§€ë§Œ ë¶„ëª…íˆ ì¡´ì¬í•˜ëŠ” ë‹¬ì²˜ëŸ¼. ë‹¹ì‹  ì•ˆì˜ ë¹ˆ ê³µê°„ë„ ìƒˆë¡œìš´ ê²ƒì„ ë‹´ì„ ì¤€ë¹„ë¥¼ í•˜ê³  ìˆëŠ” ê±°ì˜ˆìš”.",
                            general: "ë‹¹ì‹ ì˜ ê°ì •ì€ ë‹¬ì˜ ìœ„ìƒì²˜ëŸ¼ ê³„ì† ë³€í•´ê°€ê³  ìˆì–´ìš”. ê·¸ ë³€í™” ìì²´ê°€ ë‹¹ì‹ ì´ ì‚´ì•„ ìˆë‹¤ëŠ” ì•„ë¦„ë‹¤ìš´ ì¦ê±°ì…ë‹ˆë‹¤."
                        },
                        en: {
                            sadness: "Sadness flows like a quiet night ocean, deep and silent. Even in that darkness, you found your voice. That courage glows softly like moonlight.",
                            anger: "Anger is like a red moon rising in your chest. Within that heat, your own sense of justice was hidden. Like the moon's phases, that emotion will find peace.",
                            anxiety: "Anxiety moves like deep currents beneath the surface, stirring the heart. But you're still breathing above those waves. That alone is remarkable.",
                            loneliness: "Loneliness feels like floating in the middle of a dark ocean. But in that stillness, you met your most truthful self. That meeting is precious.",
                            shame: "Shame is like the moon hidden behind clouds. But when the clouds pass, the moon still shines in its place. So do you.",
                            confusion: "Confusion is like walking a foggy night path. But fog lifts when dawn comes. Clear moments will come to your heart too.",
                            hope: "Hope is like a crescent moon rising in the dawn sky. Small but certain light. Your light will grow fuller.",
                            relief: "Relief is like dawn after a long night. You've finally found your own peace. Savor that tranquility.",
                            regret: "Regret surrounds the heart like a moon halo. But beyond that halo, moonlight still flows down. Past shadows cannot block present light.",
                            emptiness: "Emptiness is like a new moon. Invisible but surely there, like the moon. The empty space within you is preparing to hold something new.",
                            general: "Your emotion keeps changing like lunar phases. That change itself is beautiful proof you're alive."
                        },
                        pt: {
                            sadness: "A tristeza flui como um oceano noturno silencioso, profundo e quieto. Mesmo nessa escuridÃ£o, vocÃª encontrou sua voz. Essa coragem brilha suavemente como o luar.",
                            anger: "A raiva Ã© como uma lua vermelha nascendo em seu peito. Dentro desse calor, seu prÃ³prio senso de justiÃ§a estava escondido. Como as fases da lua, essa emoÃ§Ã£o encontrarÃ¡ paz.",
                            anxiety: "A ansiedade se move como correntes profundas sob a superfÃ­cie, agitando o coraÃ§Ã£o. Mas vocÃª ainda estÃ¡ respirando acima dessas ondas. SÃ³ isso jÃ¡ Ã© notÃ¡vel.",
                            loneliness: "A solidÃ£o parece flutuar no meio de um oceano escuro. Mas nessa quietude, vocÃª encontrou seu eu mais verdadeiro. Esse encontro Ã© precioso.",
                            shame: "A vergonha Ã© como a lua escondida atrÃ¡s das nuvens. Mas quando as nuvens passam, a lua ainda brilha em seu lugar. VocÃª tambÃ©m.",
                            confusion: "A confusÃ£o Ã© como caminhar por um caminho nebuloso Ã  noite. Mas a nÃ©voa se levanta quando a aurora chega. Momentos claros virÃ£o ao seu coraÃ§Ã£o tambÃ©m.",
                            hope: "A esperanÃ§a Ã© como uma lua crescente nascendo no cÃ©u da aurora. Luz pequena mas certa. Sua luz crescerÃ¡ mais cheia.",
                            relief: "O alÃ­vio Ã© como a aurora apÃ³s uma longa noite. VocÃª finalmente encontrou sua prÃ³pria paz. Saboreie essa tranquilidade.",
                            regret: "O arrependimento envolve o coraÃ§Ã£o como um halo lunar. Mas alÃ©m desse halo, o luar ainda flui. Sombras do passado nÃ£o podem bloquear a luz presente.",
                            emptiness: "O vazio Ã© como uma lua nova. InvisÃ­vel mas certamente lÃ¡, como a lua. O espaÃ§o vazio dentro de vocÃª estÃ¡ se preparando para guardar algo novo.",
                            general: "Sua emoÃ§Ã£o continua mudando como fases lunares. Essa mudanÃ§a em si Ã© uma bela prova de que vocÃª estÃ¡ vivo."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Maya", emoji: "ğŸ”®",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            sadness: "ë‹¹ì‹ ì˜ ìŠ¬í””ì—ì„œ ê¹Šì€ ë³´ë¼ë¹›ì´ ëŠê»´ì ¸ìš”. ê·¸ ìƒ‰ì€ ê³ í†µ ì†ì—ì„œë„ ìš°ì•„í•¨ì„ ìƒì§€ ì•ŠëŠ” ë‹¹ì‹ ì˜ ë§ˆìŒì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ë³´ë¼ìƒ‰ ëìë½ì—ëŠ” í¬ë§ì˜ ê¸ˆë¹›ì´ ìŠ¤ë©°ë“¤ì–´ ìˆì–´ìš”.",
                            anger: "ë¶„ë…¸ëŠ” íƒ€ì˜¤ë¥´ëŠ” ì£¼í™©ë¹›ìœ¼ë¡œ ë²ˆì ¸ë‚˜ê°€ê³  ìˆë„¤ìš”. í•˜ì§€ë§Œ ê·¸ ë¶ˆê½ƒ ì¤‘ì‹¬ì—ëŠ” ìˆœìˆ˜í•œ ë¶‰ì€ ì§„ì‹¤ì´ ë°•ë™í•˜ê³  ìˆì–´ìš”. ë‹¹ì‹ ì˜ ì •ì˜ê°ì´ ìƒ‰ê¹”ë¡œ ë§í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
                            anxiety: "ë¶ˆì•ˆì€ í”ë“¤ë¦¬ëŠ” íšŒìƒ‰ ì•ˆê°œì²˜ëŸ¼ ë§ˆìŒì„ ê°ìŒŒê² ì£ . í•˜ì§€ë§Œ ê·¸ ì•ˆê°œ ì‚¬ì´ë¡œ ì—°í•œ í•˜ëŠ˜ìƒ‰ ì‹¤ì´ í˜ëŸ¬ë‚˜ì™€ìš”. ê·¸ê²ƒì´ ë‹¹ì‹ ì˜ í‰ì•ˆì„ í–¥í•œ ê°ˆë§ì…ë‹ˆë‹¤.",
                            loneliness: "ì™¸ë¡œì›€ì˜ í‘¸ë¥¸ ê·¸ë¦¼ìê°€ ë§ˆìŒì„ ë®ì—ˆì§€ë§Œ, ê·¸ íŒŒë€ìƒ‰ ê¹Šì´ ì†ì—ì„œ ë‹¹ì‹ ë§Œì˜ ì€ë¹› ë³„ì´ ë°˜ì§ì´ê³  ìˆì–´ìš”. ê³ ë… ì†ì—ì„œë„ ë‹¹ì‹ ì€ ë¹›ë‚˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.",
                            shame: "ìˆ˜ì¹˜ì‹¬ì€ ì–´ë‘ìš´ ê°ˆìƒ‰ êµ¬ë¦„ì²˜ëŸ¼ ìŠ¤ë©°ë“¤ì—ˆê² ì£ . í•˜ì§€ë§Œ ê·¸ êµ¬ë¦„ ë„ˆë¨¸ë¡œ ë”°ëœ»í•œ í™©ê¸ˆë¹›ì´ ìŠ¤ë©°ë‚˜ì™€ìš”. ê·¸ê²ƒì´ ë‹¹ì‹ ì˜ ì§„ì •í•œ ê°€ì¹˜ì…ë‹ˆë‹¤.",
                            confusion: "í˜¼ë€ì€ ì—¬ëŸ¬ ìƒ‰ê¹”ì´ ë’¤ì„ì¸ ì†Œìš©ëŒì´ ê°™ì•„ìš”. í•˜ì§€ë§Œ ê·¸ ì¤‘ì‹¬ì—ëŠ” ë§‘ì€ í°ë¹›ì´ ê³ ìš”íˆ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”. ë‹µì€ ê·¸ ê³ ìš”í•¨ ì†ì— ìˆìŠµë‹ˆë‹¤.",
                            hope: "í¬ë§ì˜ ì—°í•œ í•‘í¬ë¹›ì´ ë§ˆìŒ ëìë½ì—ì„œ í”¼ì–´ì˜¤ë¥´ê³  ìˆì–´ìš”. ê·¸ ìƒ‰ì€ ì ì  ë”°ëœ»í•œ ë³µìˆ­ì•„ë¹›ìœ¼ë¡œ ë²ˆì ¸ë‚˜ê°ˆ ê±°ì˜ˆìš”. ë‹¹ì‹ ì˜ ê¿ˆì´ ìƒ‰ê¹”ì„ ì…ê³  ìˆì–´ìš”.",
                            relief: "í•´ë°©ê°ì€ ë§‘ì€ í•˜ëŠ˜ìƒ‰ ë°”ëŒì²˜ëŸ¼ ë¶ˆì–´ì™€ìš”. ê·¸ ì‹œì›í•œ ìƒ‰ê°ì´ ë‹µë‹µí–ˆë˜ ë§ˆìŒì˜ ëª¨ë“  íƒí•¨ì„ ì”»ì–´ë‚´ê³  ìˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ë‹¤ì‹œ ìˆ¨ ì‰´ ìˆ˜ ìˆì–´ìš”.",
                            regret: "í›„íšŒëŠ” ë°”ëœ ê°ˆìƒ‰ í†¤ìœ¼ë¡œ ë§ˆìŒì„ ë¬¼ë“¤ì˜€ì§€ë§Œ, ê·¸ ìœ„ì— ìƒˆë¡œìš´ ì´ˆë¡ë¹› ìƒˆì‹¹ì´ ë‹ì•„ë‚˜ê³  ìˆì–´ìš”. ê³¼ê±°ëŠ” ìƒˆë¡œìš´ ì„±ì¥ì˜ ê±°ë¦„ì´ ë˜ê³  ìˆìŠµë‹ˆë‹¤.",
                            emptiness: "ê³µí—ˆí•¨ì€ íˆ¬ëª…í•œ ìœ ë¦¬ìƒ‰ ê°™ì•„ìš”. ì•„ë¬´ê²ƒë„ ì—†ì–´ ë³´ì´ì§€ë§Œ, ê·¸ íˆ¬ëª…í•¨ ì†ì—ëŠ” ëª¨ë“  ìƒ‰ê¹”ì˜ ê°€ëŠ¥ì„±ì´ ìˆ¨ì–´ ìˆì–´ìš”. ìƒˆë¡œìš´ ìƒ‰ì¹ ì˜ ì‹œì‘ì…ë‹ˆë‹¤.",
                            general: "ë‹¹ì‹ ì˜ ê°ì •ì€ ë¬´ì§€ê°œì²˜ëŸ¼ ë‹¤ì±„ë¡œì›Œìš”. ì–´ë–¤ ìƒ‰ì´ë“  ë‹¹ì‹ ì˜ ë§ˆìŒ íŒ”ë ˆíŠ¸ì—ì„œëŠ” ì•„ë¦„ë‹¤ìš´ ì˜ë¯¸ë¥¼ ê°–ìŠµë‹ˆë‹¤."
                        },
                        en: {
                            sadness: "I sense deep purple from your sadness. That color shows your heart's grace even in pain. At the purple edges, hope's golden light seeps through.",
                            anger: "Anger spreads in burning orange. But at the flame's center, pure red truth pulses. Your sense of justice speaks in color.",
                            anxiety: "Anxiety wrapped your heart like trembling gray mist. But through that mist, pale blue threads flow out. That's your longing for peace.",
                            loneliness: "Loneliness cast blue shadows on your heart, but in those blue depths, your silver star sparkles. You were shining even in solitude.",
                            shame: "Shame seeped in like dark brown clouds. But beyond those clouds, warm golden light filters through. That's your true worth.",
                            confusion: "Confusion is like a whirlpool of mixed colors. But at its center, clear white light waits quietly. The answer lies in that stillness.",
                            hope: "Hope's pale pink is blooming at your heart's edge. That color will spread into warm peach tones. Your dreams are taking color.",
                            relief: "Relief blows in like clear sky-blue wind. That cool color washes away all the stuffiness in your heart. You can breathe again.",
                            regret: "Regret tinted your heart in faded brown, but new green sprouts are growing over it. The past becomes fertilizer for new growth.",
                            emptiness: "Emptiness is like transparent glass. Seems empty, but in that transparency, all color possibilities hide. It's the start of new coloring.",
                            general: "Your emotion is rainbow-like in its variety. Any color holds beautiful meaning on your heart's palette."
                        },
                        pt: {
                            sadness: "Sinto um roxo profundo da sua tristeza. Essa cor mostra a graÃ§a do seu coraÃ§Ã£o mesmo na dor. Nas bordas roxas, a luz dourada da esperanÃ§a se infiltra.",
                            anger: "A raiva se espalha em laranja ardente. Mas no centro da chama, a verdade vermelha pura pulsa. Seu senso de justiÃ§a fala em cor.",
                            anxiety: "A ansiedade envolveu seu coraÃ§Ã£o como nÃ©voa cinza tremula. Mas atravÃ©s dessa nÃ©voa, fios azul pÃ¡lido fluem. Essa Ã© sua saudade da paz.",
                            loneliness: "A solidÃ£o lanÃ§ou sombras azuis no seu coraÃ§Ã£o, mas nessas profundezas azuis, sua estrela prateada cintila. VocÃª estava brilhando mesmo na solidÃ£o.",
                            shame: "A vergonha se infiltrou como nuvens marrons escuras. Mas alÃ©m dessas nuvens, luz dourada quente se filtra. Esse Ã© seu valor verdadeiro.",
                            confusion: "A confusÃ£o Ã© como um redemoinho de cores misturadas. Mas em seu centro, luz branca clara espera silenciosamente. A resposta estÃ¡ nessa quietude.",
                            hope: "O rosa pÃ¡lido da esperanÃ§a estÃ¡ florescendo na borda do seu coraÃ§Ã£o. Essa cor se espalharÃ¡ em tons pÃªssego quentes. Seus sonhos estÃ£o ganhando cor.",
                            relief: "O alÃ­vio sopra como vento azul-cÃ©u claro. Essa cor fresca lava toda a sufocaÃ§Ã£o em seu coraÃ§Ã£o. VocÃª pode respirar novamente.",
                            regret: "O arrependimento tingiu seu coraÃ§Ã£o de marrom desbotado, mas novos brotos verdes estÃ£o crescendo sobre ele. O passado se torna fertilizante para novo crescimento.",
                            emptiness: "O vazio Ã© como vidro transparente. Parece vazio, mas nessa transparÃªncia, todas as possibilidades de cor se escondem. Ã‰ o inÃ­cio de nova coloraÃ§Ã£o.",
                            general: "Sua emoÃ§Ã£o Ã© como arco-Ã­ris em variedade. Qualquer cor tem significado bonito na paleta do seu coraÃ§Ã£o."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Ely", emoji: "ğŸ‘‘",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            sadness: "ìŠ¬í””ì„ ëŠë‚€ë‹¤ëŠ” ê²ƒì€ ë‹¹ì‹ ì´ ì‚¬ë‘í•  ì¤„ ì•„ëŠ” ì¡´ì¬ë¼ëŠ” ì¦ê±°ì…ë‹ˆë‹¤. ìƒì‹¤ì˜ ì•„í”” ì†ì—ì„œë„ ë‹¹ì‹ ì€ ì¡´ì—„ì„ ìƒì§€ ì•Šì•˜ì–´ìš”. ê·¸ ëˆˆë¬¼ì—ëŠ” ìš©ê¸°ê°€ ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤.",
                            anger: "ë¶„ë…¸ëŠ” ë¶ˆì˜ì— ë§ì„œëŠ” ì˜í˜¼ì˜ ì™¸ì¹¨ì´ì—ìš”. ë‹¹ì‹ ì˜ ê·¸ ê°ì •ì€ ì •ì˜ë¥¼ í–¥í•œ ìˆ­ê³ í•œ ëª¸ë¶€ë¦¼ì…ë‹ˆë‹¤. ë¶„ë…¸ë¥¼ ëŠë‚„ ì¤„ ì•„ëŠ” ê²ƒë„ ë•ì„±ì˜ í•˜ë‚˜ì˜ˆìš”.",
                            anxiety: "ë¶ˆì•ˆ ì†ì—ì„œë„ ë‹¹ì‹ ì€ ì•ìœ¼ë¡œ ë‚˜ì•„ê°€ë ¤ í–ˆì–´ìš”. ê·¸ ìì²´ê°€ ë†€ë¼ìš´ ìš©ê¸°ì…ë‹ˆë‹¤. ì™•ê´€ì€ ë‘ë ¤ì›€ì„ ëª¨ë¥´ëŠ” ìê°€ ì•„ë‹ˆë¼, ë‘ë ¤ì›€ê³¼ í•¨ê»˜ ì„œëŠ” ìì—ê²Œ ì–´ìš¸ë ¤ìš”.",
                            loneliness: "ê³ ë…ì€ ë•Œë¡œ ì˜í˜¼ì´ ìì‹ ê³¼ ë§Œë‚˜ëŠ” ì„±ìŠ¤ëŸ¬ìš´ ì‹œê°„ì´ì—ìš”. í˜¼ìì˜€ì§€ë§Œ ë‹¹ì‹ ì€ í¬ê¸°í•˜ì§€ ì•Šì•˜ì–´ìš”. ê·¸ ì˜ì§€ì•¼ë§ë¡œ ì§„ì •í•œ ì™•ì¡±ì˜ í’ˆê²©ì…ë‹ˆë‹¤.",
                            shame: "ìˆ˜ì¹˜ì‹¬ì„ ëŠë‚€ë‹¤ëŠ” ê²ƒì€ ë‹¹ì‹ ì—ê²Œ ì–‘ì‹¬ì´ ìˆë‹¤ëŠ” ëœ»ì´ì—ìš”. ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„ìš”. ì§„ì •í•œ ê³ ê·€í•¨ì€ ì‹¤ìˆ˜ë¥¼ ì¸ì •í•˜ëŠ” ìš©ê¸°ì—ì„œ ë‚˜ì˜µë‹ˆë‹¤.",
                            confusion: "í˜¼ë€ ì†ì—ì„œë„ ê¸¸ì„ ì°¾ìœ¼ë ¤ëŠ” ë‹¹ì‹ ì˜ ë…¸ë ¥ì´ ë³´ì—¬ìš”. ëª¨ë“  ìœ„ëŒ€í•œ ì—¬ì •ì€ ë¶ˆí™•ì‹¤í•¨ì—ì„œ ì‹œì‘ë©ë‹ˆë‹¤. ë‹¹ì‹ ì€ ì´ë¯¸ ìš©ê°í•œ ì²«ê±¸ìŒì„ ë‚´ë”›ì—ˆì–´ìš”.",
                            hope: "í¬ë§ì„ í’ˆëŠ”ë‹¤ëŠ” ê²ƒì€ ì–´ë‘  ì†ì—ì„œë„ ë¹›ì„ ë¯¿ëŠ” ì™•ìë‹¤ìš´ ë§ˆìŒì´ì—ìš”. ê·¸ í¬ë§ì´ ë‹¹ì‹ ì„ ì§„ì •í•œ ìŠ¹ë¦¬ë¡œ ì´ëŒ ê²ƒì…ë‹ˆë‹¤.",
                            relief: "í•´ë°©ê°ì„ ëŠê¼ˆë‹¤ëŠ” ê²ƒì€ ë‹¹ì‹ ì´ ë§ˆì¹¨ë‚´ ìì‹ ì„ ì–µì••ì—ì„œ êµ¬í•´ëƒˆë‹¤ëŠ” ëœ»ì´ì—ìš”. ê·¸ê²ƒì€ ìŠ¤ìŠ¤ë¡œì—ê²Œ ë² í‘¼ ê°€ì¥ í° ìë¹„ì´ì ìŠ¹ë¦¬ì…ë‹ˆë‹¤.",
                            regret: "í›„íšŒëŠ” ë” ë‚˜ì€ ì‚¬ëŒì´ ë˜ê³  ì‹¶ì€ ê°ˆë§ì˜ ë‹¤ë¥¸ ì´ë¦„ì´ì—ìš”. ê³¼ê±°ë¥¼ ëŒì•„ë³´ëŠ” ì§€í˜œì•¼ë§ë¡œ ì§„ì •í•œ ë¦¬ë”ì‹­ì˜ ì‹œì‘ì…ë‹ˆë‹¤.",
                            emptiness: "ê³µí—ˆí•¨ë§ˆì €ë„ ìƒˆë¡œìš´ ê²ƒì„ ë‹´ì„ ìˆ˜ ìˆëŠ” ê·¸ë¦‡ì´ ë˜ì—ˆì–´ìš”. ë¹„ì›Œì§„ ë§ˆìŒì€ ë” í° ì‚¬ëª…ì„ ë°›ì•„ë“¤ì¼ ì¤€ë¹„ê°€ ëœ ìƒíƒœì…ë‹ˆë‹¤.",
                            general: "ë‹¹ì‹ ì˜ ê°ì •ì€ ëª¨ë‘ ê³ ê·€í•œ ì˜í˜¼ì˜ ì¦ê±°ì…ë‹ˆë‹¤. ì–´ë–¤ ê°ì •ì´ë“  ê·¸ê²ƒì„ ëŠë¼ëŠ” ë‹¹ì‹ ì€ ì´ë¯¸ ì¶©ë¶„íˆ ì¡´ì—„í•œ ì¡´ì¬ì˜ˆìš”."
                        },
                        en: {
                            sadness: "Feeling sadness proves you're capable of love. Even in loss, you didn't lose your dignity. Those tears hold courage within them.",
                            anger: "Anger is the soul's cry against injustice. Your emotion is a noble struggle for justice. Knowing how to feel anger is also a virtue.",
                            anxiety: "Even in anxiety, you tried to move forward. That itself is remarkable courage. Crowns suit not those without fear, but those who stand with it.",
                            loneliness: "Solitude is sometimes a sacred time for the soul to meet itself. Though alone, you didn't give up. That will is true royal dignity.",
                            shame: "Feeling shame means you have conscience. It's okay not to be perfect. True nobility comes from courage to admit mistakes.",
                            confusion: "I see your effort to find a path even in confusion. All great journeys begin in uncertainty. You've already taken a brave first step.",
                            hope: "Having hope is a princely heart that believes in light even in darkness. That hope will lead you to true victory.",
                            relief: "Feeling relief means you finally freed yourself from oppression. That's the greatest mercy and victory you gave yourself.",
                            regret: "Regret is another name for the desire to become better. The wisdom to look back is the beginning of true leadership.",
                            emptiness: "Even emptiness became a vessel to hold something new. An emptied heart is ready to accept a greater mission.",
                            general: "All your emotions are proof of a noble soul. Whatever you feel, you are already a sufficiently dignified being."
                        },
                        pt: {
                            sadness: "Sentir tristeza prova que vocÃª Ã© capaz de amar. Mesmo na perda, vocÃª nÃ£o perdeu sua dignidade. Essas lÃ¡grimas tÃªm coragem dentro delas.",
                            anger: "A raiva Ã© o grito da alma contra a injustiÃ§a. Sua emoÃ§Ã£o Ã© uma luta nobre pela justiÃ§a. Saber sentir raiva tambÃ©m Ã© uma virtude.",
                            anxiety: "Mesmo na ansiedade, vocÃª tentou seguir em frente. Isso em si Ã© coragem notÃ¡vel. Coroas cabem nÃ£o aos sem medo, mas aos que ficam de pÃ© com ele.",
                            loneliness: "A solidÃ£o Ã s vezes Ã© um tempo sagrado para a alma se encontrar. Embora sozinho, vocÃª nÃ£o desistiu. Essa vontade Ã© verdadeira dignidade real.",
                            shame: "Sentir vergonha significa que vocÃª tem consciÃªncia. Tudo bem nÃ£o ser perfeito. A verdadeira nobreza vem da coragem de admitir erros.",
                            confusion: "Vejo seu esforÃ§o para encontrar um caminho mesmo na confusÃ£o. Todas as grandes jornadas comeÃ§am na incerteza. VocÃª jÃ¡ deu um primeiro passo corajoso.",
                            hope: "Ter esperanÃ§a Ã© um coraÃ§Ã£o principesco que acredita na luz mesmo na escuridÃ£o. Essa esperanÃ§a o levarÃ¡ Ã  verdadeira vitÃ³ria.",
                            relief: "Sentir alÃ­vio significa que vocÃª finalmente se libertou da opressÃ£o. Essa Ã© a maior misericÃ³rdia e vitÃ³ria que vocÃª deu a si mesmo.",
                            regret: "O arrependimento Ã© outro nome para o desejo de se tornar melhor. A sabedoria de olhar para trÃ¡s Ã© o inÃ­cio da verdadeira lideranÃ§a.",
                            emptiness: "Mesmo o vazio se tornou um recipiente para guardar algo novo. Um coraÃ§Ã£o esvaziado estÃ¡ pronto para aceitar uma missÃ£o maior.",
                            general: "Todas as suas emoÃ§Ãµes sÃ£o prova de uma alma nobre. O que quer que vocÃª sinta, vocÃª jÃ¡ Ã© um ser suficientemente digno."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en'; // ê¸°ë³¸ ì–¸ì–´ë¥¼ ì˜ì–´ë¡œ ì„¤ì •
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        // ============ ì—¬ì • ì´ˆê¸°í™” í•¨ìˆ˜ ============
        
        function resetJourney() {
            console.log('=== ì—¬ì • ì´ˆê¸°í™” ì‹œì‘ ===');
            
            // 1. ëª¨ë“  íƒ€ì´í•‘ íš¨ê³¼ ì™„ì „ ì •ë¦¬
            clearAllTypingEffects();
            
            // ì¶”ê°€ ì•ˆì „ì¥ì¹˜ - ëª¨ë“  timer ì •ë¦¬
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            // 2. ëª¨ë“  ì½˜í…ì¸  ì„¹ì…˜ ì™„ì „ ì´ˆê¸°í™”
            const sectionsToReset = [
                'portalIntroSection',
                'characterResponsesSection', 
                'lightMessageSection',
                'portalQuestionSection',
                'userInputSection',
                'userReactionsSection',
                'continueSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    } else {
                        const textElements = section.querySelectorAll('.portal-intro, .light-message, .portal-question, .continue-text');
                        textElements.forEach(el => {
                            el.innerHTML = '';
                            el.textContent = '';
                        });
                    }
                }
            });
            
            // 3. íŠ¹ì • ìš”ì†Œë“¤ ê°œë³„ ì´ˆê¸°í™”
            const portalIntro = document.getElementById('portalIntro');
            const lightMessage = document.getElementById('lightMessage');
            const portalQuestion = document.getElementById('portalQuestion');
            const continueText = document.getElementById('continueText');
            
            if (portalIntro) portalIntro.innerHTML = '';
            if (lightMessage) lightMessage.innerHTML = '';
            if (portalQuestion) portalQuestion.innerHTML = '';
            if (continueText) continueText.innerHTML = '';
            
            // 4. í…ìŠ¤íŠ¸ì˜ì—­ ì™„ì „ ì´ˆê¸°í™”
            const userTextarea = document.getElementById('userTextarea');
            if (userTextarea) {
                userTextarea.disabled = false;
                userTextarea.value = '';
                userTextarea.style.height = 'auto';
                userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            }
            
            // 5. ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì´ˆê¸°í™”
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.scrollTop = 0;
            }
            
            // 6. ìƒíƒœ ë³€ìˆ˜ ì™„ì „ ì´ˆê¸°í™”
            userResponse = '';
            currentTypingElement = null;
            
            console.log('=== ì—¬ì • ì´ˆê¸°í™” ì™„ë£Œ ===');
        }
        
        // ============ ê°œì„ ëœ ì–¸ì–´ ë³€ê²½ í•¨ìˆ˜ ============
        
        function changeLanguage(lang) {
            if (!translations[lang]) {
                console.error('ì§€ì›í•˜ì§€ ì•ŠëŠ” ì–¸ì–´:', lang);
                return;
            }
            
            if (currentLanguage === lang) {
                return;
            }
            
            if (journeyStarted) {
                const confirmMessage = translations[currentLanguage].languageChangeConfirm;
                const shouldRestart = confirm(confirmMessage);
                
                if (!shouldRestart) {
                    return;
                }
            }
            
            const previousLanguage = currentLanguage;
            currentLanguage = lang;
            
            console.log(`ì–¸ì–´ ë³€ê²½: ${previousLanguage} â†’ ${currentLanguage}`);
            
            if (journeyStarted) {
                resetJourney();
            }
            
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                setTimeout(() => {
                    console.log(`ìƒˆë¡œìš´ ì–¸ì–´(${currentLanguage})ë¡œ ì—¬ì • ì¬ì‹œì‘`);
                    startPortalSequence();
                }, 1000);
            }
        }
        
        // ============ UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤ ============
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            // ê°œë³„ ìš”ì†Œ ì—…ë°ì´íŠ¸
            const elements = [
                'logoSubtitle',
                'portalMainTitle', 
                'portalSubtitle',
                'loginSubtitle',
                'loginButton',
                'signupBtn',
                'gmailLoginBtn',
                'lightTitle',
                'continueYesBtn',
                'continueNoBtn'
            ];
            
            elements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element && translations[lang]) {
                    const key = elementId.replace('Btn', 'Button').replace('Subtitle', 'Subtitle');
                    let translationKey = key;
                    
                    const keyMapping = {
                        'logoSubtitle': 'logoSubtitle',
                        'portalMainTitle': 'portalMainTitle',
                        'portalSubtitle': 'portalSubtitle',
                        'loginSubtitle': 'loginSubtitle',
                        'loginButton': 'loginButton',
                        'signupButton': 'signupButton',
                        'gmailLoginButton': 'gmailLogin',
                        'lightTitle': 'lightTitle',
                        'continueYesButton': 'continueYes',
                        'continueNoButton': 'continueNo'
                    };
                    
                    translationKey = keyMapping[key] || key;
                    
                    if (translations[lang][translationKey]) {
                        if (elementId === 'gmailLoginBtn') {
                            element.innerHTML = `<span>ğŸ“§</span><span>${translations[lang][translationKey]}</span>`;
                        } else {
                            element.textContent = translations[lang][translationKey];
                        }
                    }
                }
            });
            
            // placeholder ì—…ë°ì´íŠ¸
            const emailInput = document.getElementById('loginEmail');
            const passwordInput = document.getElementById('loginPassword');
            const textarea = document.getElementById('userTextarea');
            
            if (emailInput) emailInput.placeholder = translations[lang].loginEmailPlaceholder;
            if (passwordInput) passwordInput.placeholder = translations[lang].loginPasswordPlaceholder;
            if (textarea) textarea.placeholder = translations[lang].inputPlaceholder;
        }
        
        // ============ ê°œì„ ëœ íƒ€ì´í•‘ íš¨ê³¼ + ìŠ¤í¬ë¡¤ ì¶”ì  ì‹œìŠ¤í…œ ============
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        
                        setTimeout(() => {
                            if (document.contains(element)) {
                                scrollToFollowTyping(element);
                            }
                        }, 200);
                        
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        // ============ ìŠ¤ë§ˆíŠ¸ ìŠ¤í¬ë¡¤ ì‹œìŠ¤í…œ ============
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        // ============ ì–¸ì–´ ë²„íŠ¼ ì´ë²¤íŠ¸ ì„¤ì • ============
        
        function setupLanguageButtons() {
            const langButtons = document.querySelectorAll('.lang-btn');
            
            langButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const newLang = this.dataset.lang;
                    changeLanguage(newLang);
                });
            });
        }
        
        // ============ ë¡œê·¸ì¸ ì‹œìŠ¤í…œ ============
        
        function showLoginModal() {
            const loginModal = document.getElementById('loginModal');
            if (loginModal) {
                loginModal.style.display = 'flex';
                console.log('âœ… Modal de login exibido');
            }
        }
        
        function hideLoginModal() {
            const loginModal = document.getElementById('loginModal');
            if (loginModal) {
                loginModal.style.display = 'none';
                console.log('âœ… Modal de login ocultado - pÃ¡gina deve permanecer visÃ­vel');
                
                // âœ… ADICIONADO: Garantir que o conteÃºdo principal seja visÃ­vel
                const mainContent = document.getElementById('mainContent');
                const headerBar = document.querySelector('.header-bar');
                const inputFixed = document.querySelector('.input-fixed-bottom');
                
                if (mainContent) mainContent.style.display = 'flex';
                if (headerBar) headerBar.style.display = 'flex';
                if (inputFixed) inputFixed.style.display = 'block';
            }
        }
        
        function showError(message) {
            document.getElementById('loginError').textContent = message;
        }
        
        function clearError() {
            document.getElementById('loginError').textContent = '';
        }
        
        function setupLoginEvents() {
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value.trim();
                
                if (email && password) {
                    clearError();
                    firebase.auth().signInWithEmailAndPassword(email, password)
                        .then(() => {
                            // ì„±ê³µí•˜ë©´ ìë™ìœ¼ë¡œ onAuthStateChangedê°€ ì‹¤í–‰ë¨
                        })
                        .catch((error) => {
                            showError('Login failed: ' + error.message);
                        });
                } else {
                    showError('Please fill in both email and password');
                }
            });
            
            document.getElementById('signupBtn').addEventListener('click', function() {
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value.trim();
                
                if (email && password) {
                    clearError();
                    firebase.auth().createUserWithEmailAndPassword(email, password)
                        .then(() => {
                            // ì„±ê³µí•˜ë©´ ìë™ìœ¼ë¡œ onAuthStateChangedê°€ ì‹¤í–‰ë¨
                        })
                        .catch((error) => {
                            showError('Sign up failed: ' + error.message);
                        });
                } else {
                    showError('Please fill in both email and password');
                }
            });
            
            // Gmail ë¡œê·¸ì¸ ë²„íŠ¼
            document.getElementById('gmailLoginBtn').addEventListener('click', async function() {
                clearError();

                const provider = new firebase.auth.GoogleAuthProvider();
                try {
                    await firebase.auth().signInWithPopup(provider);
                    // ì„±ê³µí•˜ë©´ ìë™ìœ¼ë¡œ onAuthStateChangedê°€ ì‹¤í–‰ë¨
                } catch (error) {
                    showError('Gmail ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message);
                }
            });
        }
        
        // ============ ë©”ì¸ ì—¬ì • ì‹œìŠ¤í…œ ============
        
        function initializeTemarix() {
            console.log('=== âœ… Temarix Portal 02 ì´ˆê¸°í™” ì‹œì‘ ===');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            // âœ… CORRIGIDO: Reduzido o delay para evitar "sumimento" da pÃ¡gina
            // O conteÃºdo deve aparecer rapidamente apÃ³s o login
            setTimeout(() => {
                startPortalSequence();
            }, 500); // Reduzido de 1000ms para 500ms
        }
        
        function startPortalSequence() {
            // âœ… CORRIGIDO: InÃ­cio mais rÃ¡pido da sequÃªncia
            setTimeout(() => {
                showIntro();
            }, 500); // Reduzido de 1000ms para 500ms
        }
        
        // ============ ì—¬ì • ë‹¨ê³„ë“¤ ============
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            const introText = translations[currentLanguage].portalIntro;
            await typewriterEffect(introElement, introText, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = `${char.emoji} ${char.name}`;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const dialogueText = translations[currentLanguage][char.key];
                await typewriterEffect(dialogueDiv, dialogueText, 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            const lightText = translations[currentLanguage].lightMessage;
            await typewriterEffect(lightMessageEl, lightText, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            const questionText = translations[currentLanguage].portalQuestion;
            await typewriterEffect(questionEl, questionText, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        // ============ ì‚¬ìš©ì ì…ë ¥ ì‹œìŠ¤í…œ ============
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', handleTextareaKeydown);
            
            document.getElementById('continueYesBtn').addEventListener('click', function() {
                processContinue('Y');
            });
            
            document.getElementById('continueNoBtn').addEventListener('click', function() {
                processContinue('N');
            });
        }
        
        function handleTextareaKeydown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                const inputValue = this.value.trim();
                
                if (inputValue) {
                    processUserInput(inputValue);
                }
            }
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = `<strong>${youLabel}:</strong> "${text}"`;
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = `${char.emoji} ${char.name}`;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showContinueOption();
            }, 2000);
        }
        
        async function showContinueOption() {
            const continueSection = document.getElementById('continueSection');
            const continueText = document.getElementById('continueText');
            
            continueSection.classList.add('show');
            
            const questionText = translations[currentLanguage].continueText;
            await typewriterEffect(continueText, questionText, 50);
            
            setTimeout(() => {
                scrollToElement(continueSection);
            }, 500);
        }
        
        function processContinue(input) {
            if (input === 'Y') {
                const message = currentLanguage === 'ko' ? 
                    'Portal 03ê°€ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤. ê³„ì†í•´ì„œ ë” ê¹Šì€ ê°ì •ì˜ ì—¬ì •ì´ ì´ì–´ì§‘ë‹ˆë‹¤.' :
                    currentLanguage === 'en' ? 
                    'Portal 03 will be ready soon. The journey into deeper emotions continues.' :
                    'Portal 03 estara pronto em breve. A jornada para emocoes mais profundas continua.';
                alert(message);
            } else if (input === 'N') {
                const message = currentLanguage === 'ko' ? 
                    'ì—¬ì •ì´ ì¼ì‹œ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ì–¸ì œë“  ë‹¤ì‹œ ëŒì•„ì™€ ê³„ì†í•˜ì„¸ìš”.' :
                    currentLanguage === 'en' ? 
                    'The journey has been paused. Come back and continue anytime.' :
                    'A jornada foi pausada. Volte e continue a qualquer momento.';
                alert(message);
            }
        }
        
        // ============ ì´ˆê¸°í™” ============
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V2 Portal 02 DOM ë¡œë“œ ì™„ë£Œ');
            
            // âœ… REMOVIDO: setTimeout que poderia estar causando delays desnecessÃ¡rios
            
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    console.log('âœ… ê¸°ì¡´ ë¡œê·¸ì¸ ì‚¬ìš©ì ê°ì§€ë¨:', user.email);
                    currentUser = user;
                    hideLoginModal();
                    updateStaticTranslations(currentLanguage);
                    
                    // âœ… CORRIGIDO: Inicia a jornada imediatamente apÃ³s detectar o login
                    // sem delays desnecessÃ¡rios que podem causar "sumimento" da pÃ¡gina
                    initializeTemarix();
                } else {
                    console.log('âŒ ë¡œê·¸ì¸ í•„ìš” - ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ');
                    setupLoginEvents();
                    updateStaticTranslations(currentLanguage);
                    showLoginModal();
                }
            });
        });
    </script>

    <!-- âœ… ë¡œê·¸ì¸ + í¬í„¸ ë³´í˜¸ ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘ -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
      import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDReBGhb2gZNv7KA86HJXTeiLimWTrurp8",
        authDomain: "canal-vivo-chat.firebaseapp.com",
        projectId: "canal-vivo-chat",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      onAuthStateChanged(auth, async (user) => {
        if (!user) {
          // NÃ£o redireciona imediatamente - deixa o sistema principal de login lidar com isso
          console.log("âŒ UsuÃ¡rio nÃ£o autenticado - aguardando sistema principal");
          return;
        }

        console.log("âœ… UsuÃ¡rio autenticado:", user.email);
        
        // âŒ REMOVIDO: VerificaÃ§Ã£o de currentPortal que estava causando redirecionamentos automÃ¡ticos
        // A pÃ¡gina deve funcionar normalmente sem redirecionamentos forÃ§ados
        
        try {
          const docRef = doc(db, "temarix_usuarios", user.uid);
          const snapshot = await getDoc(docRef);
          
          if (snapshot.exists()) {
            console.log("âœ… Dados do usuÃ¡rio encontrados no Firestore");
            // Apenas log - sem redirecionamentos automÃ¡ticos
          } else {
            console.log("âš ï¸ Dados do usuÃ¡rio nÃ£o encontrados no Firestore - continuando normalmente");
          }
        } catch (error) {
          console.error("âŒ Erro ao verificar Firestore:", error);
          // NÃ£o redireciona em caso de erro - deixa a pÃ¡gina funcionar
        }
      });
    </script>
    <!-- âœ… ë¡œê·¸ì¸ ë³´í˜¸ ìŠ¤í¬ë¦½íŠ¸ ë -->

</body>
</html>