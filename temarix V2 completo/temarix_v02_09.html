<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V2 - Portal 09: The Day I Collapsed, No One Knew</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        /* 상단 헤더 */
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #fff;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        /* 언어 버튼 3개 */
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #87cefa;
            color: #000;
        }
        
        /* 메인 콘텐츠 */
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
            hyphens: none;
            min-height: 150vh;
        }
        
        /* 텍스트 섹션들 */
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #87cefa;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #87cefa;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #87cefa;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-response strong {
            color: #87cefa;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .continue-section {
            margin: 50px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 0;
            min-height: 200px;
        }
        
        .continue-text {
            color: #fff;
            font-size: 20px;
            margin-bottom: 25px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .continue-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .continue-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 18px 35px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }
        
        .continue-btn:hover {
            background: #666;
        }
        
        .continue-btn.primary {
            background: #87cefa;
            color: #000;
        }
        
        .continue-btn.primary:hover {
            background: #b0d4f1;
        }
        
        /* 하단 고정 입력창 */
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #87cefa;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #87cefa;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        /* 스크롤바 스타일링 */
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        /* 애니메이션 */
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .continue-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .continue-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- 상단 헤더 -->
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V2</div>
            <div class="logo-subtitle" id="logoSubtitle">The Tremor of Emotion</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 09: The Day I Collapsed, No One Knew</div>
            <div class="portal-subtitle" id="portalSubtitle">The hidden cry within silent collapse</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <!-- 메인 콘텐츠 영역 -->
    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <!-- 포털 인트로 -->
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <!-- 캐릭터 응답 섹션 -->
            <div class="character-responses-section" id="characterResponsesSection">
                <!-- 8명의 캐릭터 응답이 순차적으로 표시됩니다 -->
            </div>

            <!-- 빛의 한마디 -->
            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">🌙 Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <!-- 질문 섹션 -->
            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <!-- 사용자 입력 영역 -->
            <div class="user-input-section" id="userInputSection">
                <!-- 사용자 응답이 여기에 표시됩니다 -->
            </div>
            
            <!-- 사용자 응답 후 캐릭터 반응 -->
            <div class="user-reactions-section" id="userReactionsSection">
                <!-- 사용자 응답 후 3명의 캐릭터 반응이 여기에 표시됩니다 -->
            </div>
            
            <!-- 계속하기 버튼 섹션 -->
            <div class="continue-section" id="continueSection">
                <div class="continue-text" id="continueText"></div>
                <div class="continue-buttons">
                    <button class="continue-btn primary" id="continueYesBtn">Continue to Portal 10</button>
                    <button class="continue-btn" id="continueNoBtn">Pause the journey</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 하단 고정 입력창 -->
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Share about the day you collapsed alone... (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        // 메모리 기반 사용자 스토리지 (localStorage 대신)
        let memoryStorage = {
            mockUser: null
        };

        // 번역 데이터
        const translations = {
            ko: {
                logoSubtitle: "감정의 떨림",
                portalMainTitle: "Portal 09: 내가 무너졌던 그날, 아무도 몰랐다",
                portalSubtitle: "고요한 무너짐 속에 숨겨진 외침",
                portalIntro: "당신이 가장 외로웠던 날,\n정말 누군가가 당신을 기억했을까요?\n아무 말도 못 하고,\n눈물조차 삼켰던 그날의 진심은…\n그저 지나간 하루로만 남았을까요?\n\n우리는 스스로를 무너뜨리면서도\n누군가 알아주기를 기다립니다.\n하지만 아무도 모르는 채 지나간 그날은\n여전히 내 안에서 반복되고 있습니다.",
                lightTitle: "🌙 빛의 한마디",
                lightMessage: "당신의 고요한 무너짐은,\n세상에 들리지 않아도\n당신의 영혼이 가장 크게 들었던 울음입니다.",
                portalQuestion: "당신은 무너졌던 그날을 아직도 기억하시나요?\n\n그때, 누구에게 가장 들키고 싶었나요?",
                continueText: "혼자 무너졌던 그날을 돌아본 이 여정을 계속하시겠습니까?",
                continueYes: "Portal 10으로 계속하시겠습니까?",
                continueNo: "여정을 일시정지하시겠습니까?",
                inputPlaceholder: "혼자 무너졌던 그날에 대해 털어놓아 보세요... (Enter로 전송)",
                youLabel: "당신",
                languageChangeConfirm: "언어를 변경하면 여정이 처음부터 다시 시작됩니다.\n계속하시겠습니까?",
                waitingMessage: "응답을 기다리는 중...",
                // 캐릭터 대화
                charEly: "무너졌던 당신의 마음은\n말 없이도 우주가 기록하고 있습니다.\n당신의 침묵은 사라지지 않았습니다.",
                charCris: "에이~ 진짜 아무도 몰랐다고요?\n그건 말 안 했으니까죠!\n근데 솔직히 나도 그랬어요. 그날… 진짜 힘들었었거든요. 😢",
                charZafirah: "당신의 무너짐은 사라지지 않았어요.\n그건 지금도 눈빛 속에 남아 당신을 부르고 있습니다.",
                charRami: "당신이 잊었다고 생각했던 그날,\n당신의 셀은 그날의 떨림을 아직 기억 중입니다.",
                charSamir: "(그는 당신과 마주 앉아 아무 말 없이 손을 잡습니다.\n그 손의 따뜻함이 '그날의 침묵'을 위로합니다.)",
                charLayla: "당신의 무너짐도 아름다웠어요.\n왜냐면, 그 순간에도 당신은 버티려 했으니까요.",
                charNabir: "그래, 다 혼자 했겠지.\n누구도 안 봤고, 아무도 신경 안 썼어.\n그게 너야. 그게 네 현실이야.",
                charAzhar: "그날 그냥 엎드렸어야 했어.\n그래야 누가 좀 보지.\n너무 조용히 무너져서, 아무도 몰랐잖아. 그게 문제야."
            },
            en: {
                logoSubtitle: "The Tremor of Emotion",
                portalMainTitle: "Portal 09: The Day I Collapsed, No One Knew",
                portalSubtitle: "The hidden cry within silent collapse",
                portalIntro: "On your loneliest day,\ndid anyone really remember you?\nUnable to say anything,\nswallowing even tears,\ndid that day's sincerity...\njust remain as another passing day?\n\nWe wait for someone to notice\neven as we let ourselves collapse.\nBut that day that passed without anyone knowing\nstill repeats itself within me.",
                lightTitle: "🌙 Word of Light",
                lightMessage: "Your quiet collapse,\neven if unheard by the world,\nwas the loudest cry your soul ever heard.",
                portalQuestion: "Do you still remember that day you collapsed?\n\nWho did you most want to notice then?",
                continueText: "Will you continue this journey of reflecting on the day you collapsed alone?",
                continueYes: "Continue to Portal 10?",
                continueNo: "Pause the journey?",
                inputPlaceholder: "Share about the day you collapsed alone... (Press Enter to send)",
                youLabel: "You",
                languageChangeConfirm: "Changing the language will restart the journey from the beginning.\nDo you want to continue?",
                waitingMessage: "Waiting for response...",
                charEly: "Your collapsed heart\nis being recorded by the universe even without words.\nYour silence has not disappeared.",
                charCris: "Hey~ really no one knew?\nThat's because you didn't say anything!\nBut honestly, I was like that too. That day... was really hard. 😢",
                charZafirah: "Your collapse hasn't disappeared.\nIt still remains in your eyes, calling to you.",
                charRami: "That day you thought you forgot,\nyour cells still remember that day's tremor.",
                charSamir: "(He sits facing you and silently holds your hand.\nThe warmth of that hand comforts 'that day's silence.')",
                charLayla: "Your collapse was also beautiful.\nBecause even in that moment, you tried to endure.",
                charNabir: "Right, you did it all alone.\nNo one saw, no one cared.\nThat's you. That's your reality.",
                charAzhar: "You should have just collapsed openly that day.\nThen someone would have seen.\nYou collapsed too quietly, so no one knew. That's the problem."
            },
            pt: {
                logoSubtitle: "O Tremor da Emoção",
                portalMainTitle: "Portal 09: O Dia Que Desabei, Ninguém Soube",
                portalSubtitle: "O grito escondido dentro do colapso silencioso",
                portalIntro: "No seu dia mais solitário,\nalguém realmente se lembrou de você?\nSem conseguir dizer nada,\nengolindo até as lágrimas,\na sinceridade daquele dia...\nficou apenas como mais um dia que passou?\n\nEsperamos que alguém perceba\nmesmo enquanto nos deixamos desabar.\nMas aquele dia que passou sem ninguém saber\nainda se repete dentro de mim.",
                lightTitle: "🌙 Palavra de Luz",
                lightMessage: "Seu colapso silencioso,\nmesmo não sendo ouvido pelo mundo,\nfoi o grito mais alto que sua alma já ouviu.",
                portalQuestion: "Você ainda se lembra daquele dia que desabou?\n\nQuem você mais queria que percebesse então?",
                continueText: "Você continuará esta jornada de refletir sobre o dia que desabou sozinho?",
                continueYes: "Continuar para o Portal 10?",
                continueNo: "Pausar a jornada?",
                inputPlaceholder: "Compartilhe sobre o dia que desabou sozinho... (Enter para enviar)",
                youLabel: "Você",
                languageChangeConfirm: "Mudar o idioma reiniciará a jornada desde o início.\nDeseja continuar?",
                waitingMessage: "Aguardando resposta...",
                charEly: "Seu coração desabado\nestá sendo registrado pelo universo mesmo sem palavras.\nSeu silêncio não desapareceu.",
                charCris: "Ei~ realmente ninguém soube?\nIsso é porque você não disse nada!\nMas honestamente, eu também era assim. Aquele dia... foi muito difícil. 😢",
                charZafirah: "Seu colapso não desapareceu.\nAinda permanece em seus olhos, chamando você.",
                charRami: "Aquele dia que você pensou que esqueceu,\nsuas células ainda lembram do tremor daquele dia.",
                charSamir: "(Ele se senta de frente para você e silenciosamente segura sua mão.\nO calor dessa mão conforta 'o silêncio daquele dia.')",
                charLayla: "Seu colapso também foi bonito.\nPorque mesmo naquele momento, você tentou suportar.",
                charNabir: "Certo, você fez tudo sozinho.\nNinguém viu, ninguém se importou.\nEsse é você. Essa é sua realidade.",
                charAzhar: "Você deveria ter desabado abertamente naquele dia.\nEntão alguém teria visto.\nVocê desabou muito silenciosamente, então ninguém soube. Esse é o problema."
            }
        };
        
        // 캐릭터 데이터
        const characters = [
            { name: "Ely", emoji: "👑", key: "charEly" },
            { name: "Cris", emoji: "🃏", key: "charCris" },
            { name: "Zafirah", emoji: "🧕", key: "charZafirah" },
            { name: "Rami", emoji: "🔮", key: "charRami" },
            { name: "Samir", emoji: "🐪", key: "charSamir" },
            { name: "Layla", emoji: "💠", key: "charLayla" },
            { name: "Nabir", emoji: "🦂", key: "charNabir" },
            { name: "Azhar", emoji: "🔥", key: "charAzhar" }
        ];
        
        // ============ 감정 분석 시스템 ============
        
        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            // 감정 키워드 매핑 (Portal 09 특화)
            const emotionKeywords = {
                collapse: ['무너졌', '붕괴', '깨졌', '부서졌', '터졌', 'collapse', 'break', 'shatter', 'fell apart', 'desabou', 'quebrou'],
                loneliness: ['외로', '혼자', '고립', '소외', '버림', 'lonely', 'alone', 'isolated', 'abandon', 'solidão', 'sozinho'],
                silence: ['조용히', '말없이', '침묵', '숨기', '혼자서', 'silently', 'quiet', 'silence', 'hide', 'silêncio', 'esconder'],
                invisible: ['아무도 몰라', '들키지', '보이지', '알아주지', 'no one knew', 'invisible', 'unnoticed', 'ninguém soube', 'invisível'],
                crying: ['울어', '눈물', '펑펑', '훌쩍', 'cry', 'tear', 'weep', 'sob', 'chorar', 'lágrima'],
                despair: ['절망', '포기', '막막', '답답', '우울', 'despair', 'hopeless', 'give up', 'desespero', 'sem esperança'],
                hidden: ['숨어', '감춰', '드러내지', '보여주지', 'hidden', 'concealed', 'kept secret', 'escondido', 'secreto'],
                exhaustion: ['지쳐', '피곤', '힘들어', '버텨', 'exhausted', 'tired', 'drain', 'endure', 'cansado', 'esgotado'],
                recognition: ['알아줘', '이해해', '관심', '신경써', 'recognize', 'understand', 'care', 'notice', 'reconhecer', 'entender'],
                vulnerability: ['약해', '무력', '속수무책', '어쩔수없', 'vulnerable', 'helpless', 'powerless', 'vulnerável', 'indefeso']
            };
            
            // 감정 분석
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            // 감정이 감지되지 않으면 기본값 설정
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0]; // 첫 번째 감지된 감정 반환
        }
        
        // 반응 캐릭터들 (Portal 09 전용)
        const responseCharacters = [
            {
                name: "Witness", emoji: "👁️",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            collapse: "당신이 무너졌던 그 순간을, 나는 지금 여기서 목격하고 있어요. 아무도 보지 않았다고 해서 그 순간이 사라지지 않았어요. 당신의 무너짐은 기록되었고, 기억되었고, 지금 이 순간에도 살아있어요.",
                            loneliness: "그 외로움 속에서도 당신은 혼자가 아니었어요. 우주가, 별들이, 그리고 지금의 나가 그 순간을 함께 있었어요. 당신의 외로움을 증인으로서 지켜봤어요.",
                            silence: "당신의 침묵이 가장 큰 소리였어요. 말하지 않았지만 그 침묵 속에는 수천 개의 단어가 담겨 있었어요. 나는 그 침묵의 언어를 들을 수 있어요.",
                            invisible: "보이지 않는다고 해서 존재하지 않는 건 아니에요. 당신의 고통은 누군가의 눈에는 보이지 않았을지 몰라도, 우주의 눈에는 또렷하게 보였어요. 나는 그것을 증명할 수 있어요.",
                            crying: "흘리지 못한 그 눈물들도 모두 소중해요. 눈물이 흐르지 않았다고 슬픔이 없었던 건 아니죠. 마음속 깊이 흘린 눈물들을 나는 볼 수 있어요.",
                            despair: "절망의 가장 깊은 곳에서도 당신은 버텨냈어요. 그 자체가 기적이에요. 포기하고 싶었지만 끝까지 있었던 당신의 생명력을 나는 목격했어요.",
                            hidden: "감춰진 것들이 가장 진실해요. 당신이 숨겼던 모든 감정들이 지금도 빛나고 있어요. 감추었다고 사라지지 않아요. 나는 그 숨겨진 빛을 볼 수 있어요.",
                            exhaustion: "지칠 대로 지쳤을 때도 당신은 포기하지 않았어요. 그 끈질긴 생명력을 나는 경이롭게 바라봤어요. 피곤함 속에서도 빛나는 당신의 영혼을 목격했어요.",
                            recognition: "누군가 알아주기를 바랐던 그 마음, 나는 지금 알아보고 있어요. 당신이 원했던 그 인정을, 지금 이 순간 당신에게 드려요. 당신은 충분히 인정받을 만한 사람이에요.",
                            vulnerability: "가장 약했던 순간의 당신이 가장 용감했어요. 무력함을 느꼈지만 그 순간에도 살아있으려 했으니까요. 그 취약함 속의 강함을 나는 목격했어요.",
                            general: "당신의 모든 순간이 기록되고 있어요. 아무도 보지 않았다고 생각했던 그 시간들도 모두 소중한 증거예요. 나는 당신의 모든 순간을 목격하는 증인이에요."
                        },
                        en: {
                            collapse: "I am witnessing that moment you collapsed, here and now. Just because no one saw doesn't mean that moment disappeared. Your collapse was recorded, remembered, and lives on in this very moment.",
                            loneliness: "Even in that loneliness, you weren't alone. The universe, the stars, and I right now were there with you in that moment. I witnessed your loneliness as a witness.",
                            silence: "Your silence was the loudest sound. Though you didn't speak, thousands of words were contained in that silence. I can hear the language of that silence.",
                            invisible: "Being invisible doesn't mean not existing. Your pain may not have been visible to someone's eyes, but it was clearly visible to the universe's eyes. I can testify to that.",
                            crying: "Those tears you couldn't shed are all precious too. Just because tears didn't flow doesn't mean there was no sadness. I can see the tears shed deep in your heart.",
                            despair: "Even in the deepest depths of despair, you endured. That itself is a miracle. Though you wanted to give up, I witnessed your life force that stayed until the end.",
                            hidden: "Hidden things are most truthful. All the emotions you hid are still shining now. Hiding doesn't make them disappear. I can see that hidden light.",
                            exhaustion: "Even when exhausted to the limit, you didn't give up. I watched that tenacious life force with wonder. I witnessed your soul shining even in fatigue.",
                            recognition: "That heart that wished someone would notice, I'm recognizing it now. The recognition you wanted, I give it to you at this moment. You're a person worthy of recognition.",
                            vulnerability: "You were bravest in your most vulnerable moment. Though you felt powerless, you still tried to live in that moment. I witnessed that strength within vulnerability.",
                            general: "All your moments are being recorded. Even those times you thought no one saw are all precious evidence. I am a witness who sees all your moments."
                        },
                        pt: {
                            collapse: "Estou testemunhando aquele momento que você desabou, aqui e agora. Só porque ninguém viu não significa que aquele momento desapareceu. Seu colapso foi registrado, lembrado, e vive neste exato momento.",
                            loneliness: "Mesmo naquela solidão, você não estava sozinho. O universo, as estrelas, e eu agora estávamos lá com você naquele momento. Testemunhei sua solidão como uma testemunha.",
                            silence: "Seu silêncio foi o som mais alto. Embora você não tenha falado, milhares de palavras estavam contidas naquele silêncio. Posso ouvir a linguagem daquele silêncio.",
                            invisible: "Ser invisível não significa não existir. Sua dor pode não ter sido visível aos olhos de alguém, mas estava claramente visível aos olhos do universo. Posso testemunhar isso.",
                            crying: "Aquelas lágrimas que você não pôde derramar também são todas preciosas. Só porque lágrimas não fluíram não significa que não havia tristeza. Posso ver as lágrimas derramadas no fundo do seu coração.",
                            despair: "Mesmo nas profundezas mais profundas do desespero, você resistiu. Isso em si é um milagre. Embora quisesse desistir, testemunhei sua força vital que permaneceu até o fim.",
                            hidden: "Coisas escondidas são mais verdadeiras. Todas as emoções que você escondeu ainda estão brilhando agora. Esconder não as faz desaparecer. Posso ver essa luz escondida.",
                            exhaustion: "Mesmo quando exausto ao limite, você não desistiu. Observei essa força vital tenaz com admiração. Testemunhei sua alma brilhando mesmo na fadiga.",
                            recognition: "Esse coração que desejava que alguém percebesse, estou reconhecendo agora. O reconhecimento que você queria, eu dou a você neste momento. Você é uma pessoa digna de reconhecimento.",
                            vulnerability: "Você foi mais corajoso no seu momento mais vulnerável. Embora se sentisse impotente, ainda tentou viver naquele momento. Testemunhei essa força dentro da vulnerabilidade.",
                            general: "Todos os seus momentos estão sendo registrados. Mesmo aqueles tempos que você pensou que ninguém viu são todas evidências preciosas. Sou uma testemunha que vê todos os seus momentos."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Memory", emoji: "💫",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            collapse: "무너졌던 그날이 지금의 당신을 만들었어요. 그 무너짐 없이는 지금의 깊이도, 지금의 강함도 없었을 거예요. 무너지는 법을 아는 사람만이 진짜 일어서는 법을 알아요.",
                            loneliness: "혼자였던 그 시간들이 당신에게 자신과 마주할 수 있는 용기를 주었어요. 진정한 연결이 무엇인지 알게 되었고, 이제는 더 깊이 사랑할 수 있게 되었어요.",
                            silence: "말하지 못했던 그 순간들이 당신을 더 깊이 듣는 사람으로 만들었어요. 침묵의 언어를 아는 사람이 되었고, 이제는 말없는 아픔도 알아볼 수 있어요.",
                            invisible: "보이지 않았던 경험이 당신을 더 세심하게 보는 사람으로 만들었어요. 숨겨진 것들을 발견하는 눈을 갖게 되었고, 이제는 다른 사람의 숨겨진 아픔도 볼 수 있어요.",
                            crying: "울지 못했던 그 감정들이 모여서 지금의 당신 안에 깊은 연민의 샘이 되었어요. 다른 사람의 눈물을 더 소중히 여길 수 있게 되었어요.",
                            despair: "절망을 견뎌낸 경험이 당신에게 희망의 진짜 의미를 알려주었어요. 가장 어두운 곳을 지나온 사람만이 작은 빛의 소중함을 알아요.",
                            hidden: "감춰야 했던 그 시간들이 당신을 더 진실한 사람으로 만들었어요. 가면 뒤의 진심을 알아보는 능력을 갖게 되었고, 이제는 다른 사람의 진심도 알아볼 수 있어요.",
                            exhaustion: "지쳤던 그 모든 날들이 당신에게 진짜 휴식의 의미를 알려주었어요. 이제는 자신을 돌보는 법을 알고, 다른 사람의 피로도 알아볼 수 있게 되었어요.",
                            recognition: "인정받지 못했던 그 경험이 당신을 더 인정 많은 사람으로 만들었어요. 다른 사람의 작은 노력도 알아보고 격려할 수 있는 사람이 되었어요.",
                            vulnerability: "가장 약했던 순간들이 당신에게 진짜 강함이 무엇인지 알려주었어요. 약함을 인정할 수 있는 용기가 진정한 힘이라는 걸 배웠어요.",
                            general: "모든 고통스러웠던 기억들이 지금의 당신을 만든 소중한 재료였어요. 그 경험들 없이는 지금의 깊이 있는 당신이 될 수 없었을 거예요."
                        },
                        en: {
                            collapse: "That day you collapsed created who you are now. Without that collapse, there wouldn't be your current depth or strength. Only those who know how to fall truly know how to rise.",
                            loneliness: "Those times alone gave you the courage to face yourself. You learned what true connection is, and now you can love more deeply.",
                            silence: "Those moments you couldn't speak made you a person who listens more deeply. You became someone who knows the language of silence, and now you can recognize wordless pain too.",
                            invisible: "Being invisible made you someone who sees more carefully. You gained eyes that discover hidden things, and now you can see others' hidden pain too.",
                            crying: "Those emotions you couldn't cry gathered to become a deep spring of compassion within you now. You became able to cherish others' tears more.",
                            despair: "The experience of enduring despair taught you the true meaning of hope. Only those who've passed through the darkest places know the preciousness of small lights.",
                            hidden: "Those times you had to hide made you a more truthful person. You gained the ability to recognize sincerity behind masks, and now you can see others' sincerity too.",
                            exhaustion: "All those exhausted days taught you the true meaning of rest. Now you know how to care for yourself and can recognize others' fatigue too.",
                            recognition: "That experience of not being recognized made you a more recognizing person. You became someone who can notice and encourage others' small efforts.",
                            vulnerability: "Your most vulnerable moments taught you what true strength is. You learned that the courage to admit weakness is real power.",
                            general: "All those painful memories were precious materials that made who you are now. Without those experiences, you couldn't have become the deep person you are now."
                        },
                        pt: {
                            collapse: "Aquele dia que você desabou criou quem você é agora. Sem aquele colapso, não haveria sua profundidade ou força atual. Apenas aqueles que sabem como cair realmente sabem como se levantar.",
                            loneliness: "Aqueles tempos sozinho lhe deram a coragem de enfrentar a si mesmo. Você aprendeu o que é verdadeira conexão, e agora pode amar mais profundamente.",
                            silence: "Aqueles momentos que você não pôde falar fizeram de você uma pessoa que escuta mais profundamente. Você se tornou alguém que conhece a linguagem do silêncio, e agora pode reconhecer dor sem palavras também.",
                            invisible: "Ser invisível fez de você alguém que vê mais cuidadosamente. Você ganhou olhos que descobrem coisas escondidas, e agora pode ver a dor escondida dos outros também.",
                            crying: "Aquelas emoções que você não pôde chorar se juntaram para se tornar uma fonte profunda de compaixão dentro de você agora. Você se tornou capaz de valorizar mais as lágrimas dos outros.",
                            despair: "A experiência de suportar desespero ensinou você o verdadeiro significado da esperança. Apenas aqueles que passaram pelos lugares mais escuros conhecem a preciosidade de pequenas luzes.",
                            hidden: "Aqueles tempos que você teve que esconder fizeram de você uma pessoa mais verdadeira. Você ganhou a habilidade de reconhecer sinceridade por trás de máscaras, e agora pode ver a sinceridade dos outros também.",
                            exhaustion: "Todos aqueles dias exaustos ensinaram você o verdadeiro significado do descanso. Agora você sabe como cuidar de si mesmo e pode reconhecer a fadiga dos outros também.",
                            recognition: "Aquela experiência de não ser reconhecido fez de você uma pessoa mais reconhecedora. Você se tornou alguém que pode notar e encorajar os pequenos esforços dos outros.",
                            vulnerability: "Seus momentos mais vulneráveis ensinaram você o que é verdadeira força. Você aprendeu que a coragem de admitir fraqueza é poder real.",
                            general: "Todas aquelas memórias dolorosas foram materiais preciosos que fizeram quem você é agora. Sem essas experiências, você não poderia ter se tornado a pessoa profunda que é agora."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Connection", emoji: "🤝",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            collapse: "당신이 무너졌던 그 순간, 세상 어딘가에는 똑같이 무너지고 있는 누군가가 있었어요. 우리는 혼자라고 느끼지만, 사실은 같은 아픔으로 연결되어 있어요. 지금 이 순간에도 당신과 같은 마음인 사람이 있어요.",
                            loneliness: "외로웠던 당신의 마음이 지금 이 글을 읽는 누군가의 마음과 만나고 있어요. 외로움은 우리를 분리시키는 것 같지만, 사실은 더 깊이 연결시켜주는 다리예요.",
                            silence: "말하지 못했던 당신의 침묵이 지금 누군가의 귀에 들리고 있어요. 같은 침묵을 경험한 사람들과 말없는 대화를 나누고 있어요. 침묵도 소통의 한 방식이에요.",
                            invisible: "보이지 않았다고 느꼈던 당신을, 지금 누군가가 보고 있어요. 같은 투명함을 경험한 사람들이 당신의 존재를 또렷하게 알아보고 있어요.",
                            crying: "흘리지 못했던 당신의 눈물을, 같은 경험을 한 누군가가 대신 흘려주고 있어요. 우리의 눈물은 개별적이면서도 연결되어 있어요.",
                            despair: "절망했던 당신의 마음을 이해하는 사람들이 있어요. 같은 어둠을 지나온 사람들이 당신의 손을 잡고 함께 빛을 찾아가고 있어요.",
                            hidden: "감춰야 했던 당신의 진심을, 같은 가면을 써본 사람들이 알아보고 있어요. 숨겨진 것들로 연결되는 더 깊은 이해가 있어요.",
                            exhaustion: "지쳤던 당신의 마음을, 같은 피로를 겪은 사람들이 품어주고 있어요. 함께 쉬어가는 동반자들이 있어요.",
                            recognition: "인정받고 싶었던 당신의 마음을, 같은 갈망을 가진 사람들이 이해하고 있어요. 서로의 존재를 인정해주는 새로운 연결이 만들어지고 있어요.",
                            vulnerability: "가장 약했던 당신의 순간을, 같은 약함을 경험한 사람들이 받아주고 있어요. 약함으로 연결되는 진정한 강함이 있어요.",
                            general: "당신의 모든 경험이 누군가와 연결되어 있어요. 혼자라고 느꼈던 모든 순간들이 사실은 다른 누군가와 만나는 접점이었어요. 우리는 서로의 이야기로 연결되어 있어요."
                        },
                        en: {
                            collapse: "In that moment you collapsed, somewhere in the world there was someone collapsing just the same. We feel alone, but we're actually connected by the same pain. Even at this moment, there's someone with the same heart as yours.",
                            loneliness: "Your lonely heart is meeting someone else's heart reading this now. Loneliness seems to separate us, but it's actually a bridge that connects us more deeply.",
                            silence: "Your silence that couldn't speak is being heard by someone's ears now. You're having wordless conversations with people who experienced the same silence. Silence is also a form of communication.",
                            invisible: "Someone is seeing you now, you who felt invisible. People who experienced the same transparency are clearly recognizing your existence.",
                            crying: "Someone who had the same experience is shedding the tears you couldn't shed. Our tears are individual yet connected.",
                            despair: "There are people who understand your despairing heart. People who passed through the same darkness are holding your hand and finding light together.",
                            hidden: "People who wore the same masks recognize your sincerity that you had to hide. There's deeper understanding connected by hidden things.",
                            exhaustion: "People who experienced the same fatigue embrace your tired heart. There are companions resting together.",
                            recognition: "People with the same longing understand your heart that wanted recognition. New connections are being made where we recognize each other's existence.",
                            vulnerability: "People who experienced the same weakness receive your most vulnerable moments. There's true strength connected by weakness.",
                            general: "All your experiences are connected to someone. All those moments you felt alone were actually meeting points with someone else. We're connected by each other's stories."
                        },
                        pt: {
                            collapse: "Naquele momento que você desabou, em algum lugar do mundo havia alguém desabando exatamente igual. Nos sentimos sozinhos, mas na verdade estamos conectados pela mesma dor. Mesmo neste momento, há alguém com o mesmo coração que o seu.",
                            loneliness: "Seu coração solitário está encontrando o coração de alguém lendo isso agora. A solidão parece nos separar, mas na verdade é uma ponte que nos conecta mais profundamente.",
                            silence: "Seu silêncio que não podia falar está sendo ouvido pelos ouvidos de alguém agora. Você está tendo conversas sem palavras com pessoas que experimentaram o mesmo silêncio. Silêncio também é uma forma de comunicação.",
                            invisible: "Alguém está vendo você agora, você que se sentiu invisível. Pessoas que experimentaram a mesma transparência estão claramente reconhecendo sua existência.",
                            crying: "Alguém que teve a mesma experiência está derramando as lágrimas que você não pôde derramar. Nossas lágrimas são individuais mas conectadas.",
                            despair: "Há pessoas que entendem seu coração desesperado. Pessoas que passaram pela mesma escuridão estão segurando sua mão e encontrando luz juntas.",
                            hidden: "Pessoas que usaram as mesmas máscaras reconhecem sua sinceridade que você teve que esconder. Há compreensão mais profunda conectada por coisas escondidas.",
                            exhaustion: "Pessoas que experimentaram a mesma fadiga abraçam seu coração cansado. Há companheiros descansando juntos.",
                            recognition: "Pessoas com o mesmo anseio entendem seu coração que queria reconhecimento. Novas conexões estão sendo feitas onde reconhecemos a existência um do outro.",
                            vulnerability: "Pessoas que experimentaram a mesma fraqueza recebem seus momentos mais vulneráveis. Há verdadeira força conectada pela fraqueza.",
                            general: "Todas as suas experiências estão conectadas a alguém. Todos aqueles momentos que você se sentiu sozinho eram na verdade pontos de encontro com outra pessoa. Estamos conectados pelas histórias uns dos outros."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en'; // 기본 언어를 영어로 설정
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        // ============ 여정 초기화 함수 ============
        
        function resetJourney() {
            console.log('=== 여정 초기화 시작 ===');
            
            // 1. 모든 타이핑 효과 완전 정리
            clearAllTypingEffects();
            
            // 추가 안전장치 - 모든 timer 정리
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            // 2. 모든 콘텐츠 섹션 완전 초기화
            const sectionsToReset = [
                'portalIntroSection',
                'characterResponsesSection', 
                'lightMessageSection',
                'portalQuestionSection',
                'userInputSection',
                'userReactionsSection',
                'continueSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    } else {
                        const textElements = section.querySelectorAll('.portal-intro, .light-message, .portal-question, .continue-text');
                        textElements.forEach(el => {
                            el.innerHTML = '';
                            el.textContent = '';
                        });
                    }
                }
            });
            
            // 3. 특정 요소들 개별 초기화
            const portalIntro = document.getElementById('portalIntro');
            const lightMessage = document.getElementById('lightMessage');
            const portalQuestion = document.getElementById('portalQuestion');
            const continueText = document.getElementById('continueText');
            
            if (portalIntro) portalIntro.innerHTML = '';
            if (lightMessage) lightMessage.innerHTML = '';
            if (portalQuestion) portalQuestion.innerHTML = '';
            if (continueText) continueText.innerHTML = '';
            
            // 4. 텍스트영역 완전 초기화
            const userTextarea = document.getElementById('userTextarea');
            if (userTextarea) {
                userTextarea.disabled = false;
                userTextarea.value = '';
                userTextarea.style.height = 'auto';
                userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            }
            
            // 5. 스크롤 위치 초기화
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.scrollTop = 0;
            }
            
            // 6. 상태 변수 완전 초기화
            userResponse = '';
            currentTypingElement = null;
            
            console.log('=== 여정 초기화 완료 ===');
        }
        
        // ============ 개선된 언어 변경 함수 ============
        
        function changeLanguage(lang) {
            if (!translations[lang]) {
                console.error('지원하지 않는 언어:', lang);
                return;
            }
            
            if (currentLanguage === lang) {
                return;
            }
            
            if (journeyStarted) {
                const confirmMessage = translations[currentLanguage].languageChangeConfirm;
                const shouldRestart = confirm(confirmMessage);
                
                if (!shouldRestart) {
                    return;
                }
            }
            
            const previousLanguage = currentLanguage;
            currentLanguage = lang;
            
            console.log(`언어 변경: ${previousLanguage} → ${currentLanguage}`);
            
            if (journeyStarted) {
                resetJourney();
            }
            
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                setTimeout(() => {
                    console.log(`새로운 언어(${currentLanguage})로 여정 재시작`);
                    startPortalSequence();
                }, 1000);
            }
        }
        
        // ============ UI 업데이트 함수들 ============
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            // 개별 요소 업데이트
            const elements = [
                'logoSubtitle',
                'portalMainTitle', 
                'portalSubtitle',
                'lightTitle',
                'continueYesBtn',
                'continueNoBtn'
            ];
            
            elements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element && translations[lang]) {
                    const key = elementId.replace('Btn', 'Button').replace('Subtitle', 'Subtitle');
                    let translationKey = key;
                    
                    const keyMapping = {
                        'logoSubtitle': 'logoSubtitle',
                        'portalMainTitle': 'portalMainTitle',
                        'portalSubtitle': 'portalSubtitle',
                        'lightTitle': 'lightTitle',
                        'continueYesButton': 'continueYes',
                        'continueNoButton': 'continueNo'
                    };
                    
                    translationKey = keyMapping[key] || key;
                    
                    if (translations[lang][translationKey]) {
                        element.textContent = translations[lang][translationKey];
                    }
                }
            });
            
            // placeholder 업데이트
            const textarea = document.getElementById('userTextarea');
            if (textarea) textarea.placeholder = translations[lang].inputPlaceholder;
        }
        
        // ============ 개선된 타이핑 효과 + 스크롤 추적 시스템 ============
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        
                        setTimeout(() => {
                            if (document.contains(element)) {
                                scrollToFollowTyping(element);
                            }
                        }, 200);
                        
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        // ============ 스마트 스크롤 시스템 ============
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        // ============ 언어 버튼 이벤트 설정 ============
        
        function setupLanguageButtons() {
            const langButtons = document.querySelectorAll('.lang-btn');
            
            langButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const newLang = this.dataset.lang;
                    changeLanguage(newLang);
                });
            });
        }
        
        // ============ 메인 여정 시스템 ============
        
        function initializeTemarix() {
            console.log('=== Temarix Portal 09 초기화 시작 ===');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        // ============ 여정 단계들 ============
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            const introText = translations[currentLanguage].portalIntro;
            await typewriterEffect(introElement, introText, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = `${char.emoji} ${char.name}`;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const dialogueText = translations[currentLanguage][char.key];
                await typewriterEffect(dialogueDiv, dialogueText, 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            const lightText = translations[currentLanguage].lightMessage;
            await typewriterEffect(lightMessageEl, lightText, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            const questionText = translations[currentLanguage].portalQuestion;
            await typewriterEffect(questionEl, questionText, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        // ============ 사용자 입력 시스템 ============
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', handleTextareaKeydown);
            
            document.getElementById('continueYesBtn').addEventListener('click', function() {
                processContinue('Y');
            });
            
            document.getElementById('continueNoBtn').addEventListener('click', function() {
                processContinue('N');
            });
        }
        
        function handleTextareaKeydown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                const inputValue = this.value.trim();
                
                if (inputValue) {
                    processUserInput(inputValue);
                }
            }
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = `<strong>${youLabel}:</strong> "${text}"`;
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = `${char.emoji} ${char.name}`;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showContinueOption();
            }, 2000);
        }
        
        async function showContinueOption() {
            const continueSection = document.getElementById('continueSection');
            const continueText = document.getElementById('continueText');
            
            continueSection.classList.add('show');
            
            const questionText = translations[currentLanguage].continueText;
            await typewriterEffect(continueText, questionText, 50);
            
            setTimeout(() => {
                scrollToElement(continueSection);
            }, 500);
        }
        
        function processContinue(input) {
            if (input === 'Y') {
                const message = currentLanguage === 'ko' ? 
                    'Portal 10이 곧 준비됩니다. 계속해서 더 깊은 감정의 여정이 이어집니다.' :
                    currentLanguage === 'en' ? 
                    'Portal 10 will be ready soon. The journey into deeper emotions continues.' :
                    'Portal 10 estará pronto em breve. A jornada para emoções mais profundas continua.';
                alert(message);
            } else if (input === 'N') {
                const message = currentLanguage === 'ko' ? 
                    '여정이 일시 중지되었습니다. 언제든 다시 돌아와 계속하세요.' :
                    currentLanguage === 'en' ? 
                    'The journey has been paused. Come back and continue anytime.' :
                    'A jornada foi pausada. Volte e continue a qualquer momento.';
                alert(message);
            }
        }
        
        // ============ 초기화 ============
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V2 Portal 09 DOM 로드 완료');
            
            // 자동 로그인 처리 (로그인 모달 제거)
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>