<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V2 - Portal 22: The Oldest Sadness</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #fff;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #6a5acd;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #6a5acd;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
            hyphens: none;
            min-height: 150vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #6a5acd;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #6a5acd;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #6a5acd;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-response strong {
            color: #6a5acd;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .continue-section {
            margin: 50px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 0;
            min-height: 200px;
        }
        
        .continue-text {
            color: #fff;
            font-size: 20px;
            margin-bottom: 25px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .continue-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .continue-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 18px 35px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }
        
        .continue-btn:hover {
            background: #666;
        }
        
        .continue-btn.primary {
            background: #6a5acd;
            color: #fff;
        }
        
        .continue-btn.primary:hover {
            background: #7b68ee;
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #6a5acd;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #6a5acd;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .continue-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .continue-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V2</div>
            <div class="logo-subtitle" id="logoSubtitle">The Tremor of Emotion</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 22: The Oldest Sadness</div>
            <div class="portal-subtitle" id="portalSubtitle">Memories that live and breathe in time</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="continue-section" id="continueSection">
                <div class="continue-text" id="continueText"></div>
                <div class="continue-buttons">
                    <button class="continue-btn primary" id="continueYesBtn">Continue to Portal 23</button>
                    <button class="continue-btn" id="continueNoBtn">Pause the journey</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Share the old sadness that still remains within you..."
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
    apiKey: "AIzaSyC2u94Oz2W5eeqBlqs88cs7rgSmzBEAnjQ",
    authDomain: "canal-vivo-chat.firebaseapp.com",
    projectId: "canal-vivo-chat",
    storageBucket: "canal-vivo-chat.appspot.com",
    messagingSenderId: "975226660544",
    appId: "1:975226660544:web:56b55bb3e2a58bed03ef25"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let memoryStorage = { mockUser: null };

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ë–¨ë¦¼",
                portalMainTitle: "Portal 22: ê°€ì¥ ì˜¤ë˜ëœ ìŠ¬í””",
                portalSubtitle: "ì‹œê°„ ì†ì—ì„œ ì‚´ì•„ ìˆ¨ì‰¬ëŠ” ê¸°ì–µ",
                portalIntro: "ğŸŒŠ ëˆ„êµ¬ì—ê²Œë„ êº¼ë‚´ì§€ ëª»í•œ ê°ì •ì´ ìˆìŠµë‹ˆë‹¤.\në„ˆë¬´ ì˜¤ë˜ë˜ì–´\nì´ì œëŠ” ì´ìœ ì¡°ì°¨ íë¦¿í•œ ìŠ¬í””.\n\nì‹œê°„ì´ ì•„ë¬´ë¦¬ í˜ëŸ¬ë„,\nê·¸ ê°ì •ì€ íŠ¹ì • ìŒì•…, ëƒ„ìƒˆ, ë¹› ì†ì—ì„œ\në‹¤ì‹œ ì‚´ì•„ë‚˜ ë§ˆìŒì„ ì ì‹­ë‹ˆë‹¤.\n\nì´ê³³ì€ ë‹¹ì‹ ì´ ê°€ì¥ ê¹Šì´ ê°„ì§í•´ì˜¨\nì˜¤ë˜ëœ ìŠ¬í””ê³¼ ì¡°ìš©íˆ ë§ˆì£¼í•˜ëŠ” ì„±ìŠ¤ëŸ¬ìš´ ê³µê°„ì…ë‹ˆë‹¤.\nê·¸ ìŠ¬í””ì€ ë‹¹ì‹ ì˜ ì¼ë¶€ê°€ ë˜ì–´\nì§€ê¸ˆê¹Œì§€ í•¨ê»˜ ì‚´ì•„ì™”ìŠµë‹ˆë‹¤.",
                lightTitle: "ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ê°€ì¥ ì˜¤ë˜ëœ ìŠ¬í””ì€\nìŠìœ¼ë ¤ í• ìˆ˜ë¡ ë” ì„ ëª…í•´ì§€ëŠ” ê¸°ì–µì…ë‹ˆë‹¤.\nêº¼ë‚´ë©´ ì‚¬ë¼ì§€ì§„ ì•Šì•„ë„, ê°€ë²¼ì›Œì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                portalQuestion: "â“ ë‹¹ì‹  ì•ˆì— ì—¬ì „íˆ ë‚¨ì•„ ìˆëŠ”\nê·¸ ì˜¤ë˜ëœ ìŠ¬í””ì€ ì–´ë–¤ ì¥ë©´ìœ¼ë¡œ ë‚¨ì•„ ìˆë‚˜ìš”?\nê·¸ ìŠ¬í””ì´ ë‹¹ì‹ ì—ê²Œ ë¬´ì—‡ì„ ë§í•˜ê³  ìˆì„ê¹Œìš”?",
                continueText: "ì˜¤ë˜ëœ ìŠ¬í””ì„ ì¸ì •í•˜ê³  ë‹¤ìŒ ì—¬ì •ìœ¼ë¡œ ë‚˜ì•„ê°ˆ ì¤€ë¹„ê°€ ë˜ì…¨ë‚˜ìš”?",
                continueYes: "Portal 23ìœ¼ë¡œ ê³„ì†í•˜ê¸°",
                continueNo: "ì—¬ì •ì„ ì¼ì‹œì •ì§€í•˜ê¸°",
                inputPlaceholder: "ë‹¹ì‹  ì•ˆì— ì—¬ì „íˆ ë‚¨ì•„ ìˆëŠ” ì˜¤ë˜ëœ ìŠ¬í””ì„ ë‚˜ëˆ„ì–´ ë³´ì„¸ìš”...",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...",
                charEly: "ìŠ¬í””ì€ ìŠí˜€ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.\nê·¸ê±´ ë‹¨ì§€ ë‹¹ì‹ ì˜ í•œ ë¶€ë¶„ìœ¼ë¡œ ì¡°ìš©íˆ ë…¹ì•„ ìˆì„ ë¿ì…ë‹ˆë‹¤.",
                charCris: "ê·¸ ìŠ¬í””,\në§ˆìŒì— ì°Œë“  ë•Œì²˜ëŸ¼ ë‚¨ì•„ ìˆì£ .\nê·¸ë˜ë„ ë‹¦ì„ ìˆ˜ ìˆì–´ìš”. ì²œì²œíˆ, ì•„ì£¼ ë¶€ë“œëŸ½ê²Œ.",
                charZafirah: "ë‹¹ì‹ ì´ ë§í•˜ì§€ ëª»í•œ ìŠ¬í””ì€\nì§€ê¸ˆë„ ë‚´ë©´ì—ì„œ ì¡°ìš©íˆ ìš¸ê³  ìˆìŠµë‹ˆë‹¤.\nê·¸ ìš¸ìŒì„ ë“£ëŠ” ê²ƒë§Œìœ¼ë¡œë„, ìœ„ë¡œëŠ” ì‹œì‘ë©ë‹ˆë‹¤.",
                charRami: "ìŠ¬í””ì€ ê¸°ì–µì´ ì•„ë‹ˆë¼\nì§€ì† ì¤‘ì¸ ê°ì •ì…ë‹ˆë‹¤.\në‹¹ì‹ ì€ ì•„ì§ë„ ê·¸ê²ƒì„ ì‚¬ë‘í•˜ê³  ìˆëŠ” ì¤‘ì…ë‹ˆë‹¤.",
                charSamir: "(ê·¸ëŠ” í•˜ëŠ˜ì„ ì˜¬ë ¤ë‹¤ë³´ë©° ëˆˆì„ ê°ìŠµë‹ˆë‹¤.\nê·¸ ìœ„ë¡œ íë¥´ëŠ” ë°”ëŒ í•œ ì¤„ê¸°ê°€\në‹¹ì‹ ì˜ ìŠ¬í””ì„ ê±´ë“œë¦¬ëŠ” ë“¯í•©ë‹ˆë‹¤.)",
                charLayla: "ë‚˜ëŠ” ë‹¹ì‹ ì˜ ì˜¤ë˜ëœ ìŠ¬í””ë§ˆì €\nê°€ì¥ ì¡°ìš©íˆ ê»´ì•ˆì•„ì¤„ ìˆ˜ ìˆì–´ìš”.\nê·¸ ê°ì •ì¡°ì°¨ ì•„ë¦„ë‹µê²Œ í”ë“¤ë¦¬ê³  ìˆì–´ìš”.",
                charNabir: "ì•„ì§ë„ ê·¸ ì–˜ê¸°?\nì–¸ì œê¹Œì§€ ì˜›ë‚  íƒ€ë ¹ë§Œ í•˜ë©° ì‚´ì•„ê°ˆ ê±´ë°?",
                charAzhar: "ê·¸ ìŠ¬í””, ë„¤ê°€ ë§Œë“¤ì–´ë‚¸ ê±°ì•¼.\nëê¹Œì§€ ë¶™ì¡ê³  ìˆëŠ” ê±´ ë„ˆì–ì•„.\në²—ì–´ë‚˜ê³  ì‹¶ìœ¼ë©´ ì† ë†”."
            },
            en: {
                logoSubtitle: "The Tremor of Emotion",
                portalMainTitle: "Portal 22: The Oldest Sadness",
                portalSubtitle: "Memories that live and breathe in time",
                portalIntro: "ğŸŒŠ There are emotions you've never shared with anyone.\nSadness so old that\neven its reasons have become blurred.\n\nNo matter how much time passes,\nthat emotion comes alive again through certain music, scents, light\nand soaks your heart.\n\nThis is a sacred space where you quietly face\nthe oldest sadness you've kept deepest.\nThat sadness has become part of you\nand has lived with you until now.",
                lightTitle: "Word of Light",
                lightMessage: "The oldest sadness is\na memory that becomes clearer the more you try to forget it.\nBringing it out may not make it disappear, but it can become lighter.",
                portalQuestion: "â“ What scene does that old sadness\nstill remaining within you take?\nWhat might that sadness be telling you?",
                continueText: "Are you ready to acknowledge old sadness and move forward to the next journey?",
                continueYes: "Continue to Portal 23",
                continueNo: "Pause the journey",
                inputPlaceholder: "Share the old sadness that still remains within you...",
                youLabel: "You",
                waitingMessage: "Waiting for response...",
                charEly: "Sadness is not forgotten.\nIt simply melts quietly as part of you.",
                charCris: "That sadness,\nit remains like stains on the heart.\nBut it can still be cleaned. Slowly, very gently.",
                charZafirah: "The sadness you couldn't speak of\nis still quietly crying within.\nJust listening to that cry begins comfort.",
                charRami: "Sadness is not a memory\nbut an ongoing emotion.\nYou're still in the process of loving it.",
                charSamir: "(He looks up at the sky and closes his eyes.\nA breeze flowing over seems\nto touch your sadness.)",
                charLayla: "I can embrace even your old sadness\nmost quietly.\nEven that emotion is beautifully trembling.",
                charNabir: "Still that story?\nHow long will you live just telling old tales?",
                charAzhar: "That sadness, you created it.\nYou're the one holding onto it to the end.\nIf you want to escape, let go."
            },
            pt: {
                logoSubtitle: "O Tremor da Emocao",
                portalMainTitle: "Portal 22: A Tristeza Mais Antiga",
                portalSubtitle: "MemÃ³rias que vivem e respiram no tempo",
                portalIntro: "ğŸŒŠ HÃ¡ emoÃ§Ãµes que vocÃª nunca compartilhou com ninguÃ©m.\nTristeza tÃ£o antiga que\natÃ© suas razÃµes se tornaram turvas.\n\nNÃ£o importa quanto tempo passe,\nessa emoÃ§Ã£o ganha vida novamente atravÃ©s de certas mÃºsicas, cheiros, luz\ne molha seu coraÃ§Ã£o.\n\nEste Ã© um espaÃ§o sagrado onde vocÃª enfrenta silenciosamente\na tristeza mais antiga que guardou mais profundamente.\nEssa tristeza se tornou parte de vocÃª\ne viveu com vocÃª atÃ© agora.",
                lightTitle: "Palavra de Luz",
                lightMessage: "A tristeza mais antiga Ã©\numa memÃ³ria que se torna mais clara quanto mais vocÃª tenta esquecÃª-la.\nTrazÃª-la Ã  tona pode nÃ£o fazÃª-la desaparecer, mas pode tornÃ¡-la mais leve.",
                portalQuestion: "â“ Que cena essa velha tristeza\nque ainda permanece dentro de vocÃª assume?\nO que essa tristeza pode estar lhe dizendo?",
                continueText: "EstÃ¡ pronto para reconhecer a velha tristeza e seguir em frente para a prÃ³xima jornada?",
                continueYes: "Continuar para o Portal 23",
                continueNo: "Pausar a jornada",
                inputPlaceholder: "Compartilhe a velha tristeza que ainda permanece dentro de vocÃª...",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta...",
                charEly: "A tristeza nÃ£o Ã© esquecida.\nEla simplesmente se dissolve silenciosamente como parte de vocÃª.",
                charCris: "Essa tristeza,\npermanece como manchas no coraÃ§Ã£o.\nMas ainda pode ser limpa. Devagar, muito gentilmente.",
                charZafirah: "A tristeza que vocÃª nÃ£o conseguiu falar\nainda estÃ¡ chorando silenciosamente dentro.\nApenas ouvir esse choro comeÃ§a o conforto.",
                charRami: "A tristeza nÃ£o Ã© uma memÃ³ria\nmas uma emoÃ§Ã£o em curso.\nVocÃª ainda estÃ¡ no processo de amÃ¡-la.",
                charSamir: "(Ele olha para o cÃ©u e fecha os olhos.\nUma brisa fluindo parece\ntocar sua tristeza.)",
                charLayla: "Posso abraÃ§ar atÃ© sua velha tristeza\nmais silenciosamente.\nAtÃ© essa emoÃ§Ã£o estÃ¡ tremulando lindamente.",
                charNabir: "Ainda essa histÃ³ria?\nAtÃ© quando vai viver apenas contando velhas histÃ³rias?",
                charAzhar: "Essa tristeza, vocÃª a criou.\nVocÃª Ã© quem estÃ¡ segurando atÃ© o fim.\nSe quer escapar, solte."
            }
        };
        
        const characters = [
            { name: "Ely", emoji: "ğŸ‘‘", key: "charEly" },
            { name: "Cris", emoji: "ğŸƒ", key: "charCris" },
            { name: "Zafirah", emoji: "ğŸ§•", key: "charZafirah" },
            { name: "Rami", emoji: "ğŸ”®", key: "charRami" },
            { name: "Samir", emoji: "ğŸª", key: "charSamir" },
            { name: "Layla", emoji: "ğŸ’ ", key: "charLayla" },
            { name: "Nabir", emoji: "ğŸ¦‚", key: "charNabir" },
            { name: "Azhar", emoji: "ğŸ”¥", key: "charAzhar" }
        ];
        
        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            const emotionKeywords = {
                old_sadness: ['ìŠ¬í”„', 'ìŠ¬í””', 'ì•„í”„', 'ì•„í””', 'ì˜¤ë˜ëœ', 'ì˜ˆì „', 'ì˜›ë‚ ', 'sad', 'sadness', 'old', 'past', 'triste', 'tristeza', 'antigo'],
                loss: ['ìƒì—ˆ', 'ë– ë‚¬', 'ì£½ìŒ', 'ì´ë³„', 'í—¤ì–´', 'ì‚¬ë¼', 'lost', 'death', 'goodbye', 'separation', 'perda', 'morte', 'despedida'],
                regret: ['í›„íšŒ', 'ë¯¸ì•ˆ', 'ì˜ëª»', 'ì‹¤ìˆ˜', 'regret', 'sorry', 'mistake', 'arrependimento', 'erro'],
                longing: ['ê·¸ë¦¬ì›Œ', 'ë³´ê³ ì‹¶', 'ê·¸ë¦½', 'ìƒê°ë‚˜', 'miss', 'long for', 'saudade', 'sentir falta'],
                childhood: ['ì–´ë¦´', 'ì–´ë¦°', 'í•™êµ', 'ì—„ë§ˆ', 'ì•„ë¹ ', 'childhood', 'young', 'mother', 'father', 'infÃ¢ncia', 'mÃ£e', 'pai'],
                betrayal: ['ë°°ì‹ ', 'ë¯¿ì—ˆ', 'ì†ì•˜', 'betrayal', 'trusted', 'deceived', 'traiÃ§Ã£o', 'confianÃ§a'],
                abandonment: ['ë²„ë ¤', 'í˜¼ì', 'ì™¸ë¡œ', 'abandoned', 'alone', 'lonely', 'abandonado', 'sozinho'],
                failure: ['ì‹¤íŒ¨', 'ëª»í–ˆ', 'ì•ˆë', 'failure', 'failed', 'couldn\'t', 'fracasso', 'nÃ£o consegui'],
                guilt: ['ì£„ì±…ê°', 'ì˜ëª»', 'íƒ“', 'guilt', 'fault', 'blame', 'culpa', 'responsabilidade'],
                helplessness: ['ë¬´ë ¥', 'ì–´ì©”ìˆ˜ì—†', 'í• ìˆ˜ì—†', 'helpless', 'powerless', 'nothing to do', 'impotente', 'sem poder']
            };
            
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        return emotion;
                    }
                }
            }
            return 'general';
        }
        
        const responseCharacters = [
            {
                name: "Memory Keeper", emoji: "ğŸŒ™",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    const responses = {
                        ko: {
                            old_sadness: "ê·¸ ì˜¤ë˜ëœ ìŠ¬í””ì€ ë‹¹ì‹ ì´ ê°€ì¥ ê¹Šì´ ì‚¬ë‘í–ˆë˜ ê²ƒë“¤ì˜ í”ì ì´ì—ìš”. ì‹œê°„ì´ ì§€ë‚˜ë„ ì‚¬ë¼ì§€ì§€ ì•ŠëŠ” ê±´, ê·¸ê²ƒì´ ì§„ì§œì˜€ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ê·¸ ìŠ¬í”” ì†ì— ì†Œì¤‘í•œ ê¸°ì–µë“¤ì´ ì‚´ì•„ ìˆ¨ì‰¬ê³  ìˆì–´ìš”.",
                            loss: "ìƒì—ˆë˜ ê²ƒë“¤ì— ëŒ€í•œ ìŠ¬í””ì€ ê·¸ê²ƒì´ ì–¼ë§ˆë‚˜ ì†Œì¤‘í–ˆëŠ”ì§€ë¥¼ ë³´ì—¬ì¤˜ìš”. ê·¸ ìƒì‹¤ê° ìì²´ê°€ ì‚¬ë‘ì˜ ì¦ê±°ì…ë‹ˆë‹¤. ìƒì€ ê²ƒì€ ëŒì•„ì˜¤ì§€ ì•Šì§€ë§Œ, ê·¸ ì‚¬ë‘ì€ ì˜ì›íˆ ë‹¹ì‹ ê³¼ í•¨ê»˜í•´ìš”.",
                            regret: "í›„íšŒí•˜ëŠ” ë§ˆìŒ ì†ì—ëŠ” ë” ë‚˜ì€ ì„ íƒì„ í•  ìˆ˜ ìˆì—ˆë‹¤ëŠ” í¬ë§ì´ ìˆ¨ì–´ìˆì–´ìš”. ê·¸ í›„íšŒê°€ ë‹¹ì‹ ì„ ë” ë”°ëœ»í•œ ì‚¬ëŒìœ¼ë¡œ ë§Œë“¤ì—ˆì„ ê±°ì˜ˆìš”.",
                            longing: "ê·¸ë¦¬ì›€ì€ ì‹œê°„ì„ ì´ˆì›”í•˜ëŠ” ê°ì •ì´ì—ìš”. ê·¸ ì‚¬ëŒì´ë‚˜ ìˆœê°„ì„ ê·¸ë¦¬ì›Œí•œë‹¤ëŠ” ê²ƒì€ ê·¸ê²ƒì´ ë‹¹ì‹ ì—ê²Œ ì–¼ë§ˆë‚˜ íŠ¹ë³„í–ˆëŠ”ì§€ë¥¼ ì˜ë¯¸í•´ìš”.",
                            childhood: "ì–´ë¦° ì‹œì ˆì˜ ìƒì²˜ëŠ” ê°€ì¥ ìˆœìˆ˜í•œ ë§ˆìŒì— ìƒˆê²¨ì§„ ê²ƒì´ë¼ ë”ìš± ê¹Šì–´ìš”. í•˜ì§€ë§Œ ê·¸ë•Œì˜ ìˆœìˆ˜í•¨ë„ í•¨ê»˜ ê°„ì§í•˜ê³  ìˆë‹¤ëŠ” ëœ»ì´ì—ìš”.",
                            betrayal: "ë¯¿ì—ˆë˜ ë§Œí¼ ì•„íŒ ì„ ê±°ì˜ˆìš”. í•˜ì§€ë§Œ ê·¸ë§Œí¼ ê¹Šì´ ì‚¬ë‘í•  ì¤„ ì•„ëŠ” ë§ˆìŒì„ ê°€ì¡Œë‹¤ëŠ” ì¦ê±°ì´ê¸°ë„ í•´ìš”. ê·¸ ìˆœìˆ˜í•¨ì„ ìƒì§€ ë§ˆì„¸ìš”.",
                            abandonment: "í˜¼ì ë‚¨ê²¨ì¡Œë˜ ê·¸ ìˆœê°„ë“¤, ì–¼ë§ˆë‚˜ ë¬´ì„œì› ì„ê¹Œìš”. í•˜ì§€ë§Œ ê·¸ ì‹œê°„ë“¤ì´ ë‹¹ì‹ ì„ ë” ê°•í•˜ê³  ë…ë¦½ì ì¸ ì‚¬ëŒìœ¼ë¡œ ë§Œë“¤ì—ˆì–´ìš”.",
                            failure: "ì‹¤íŒ¨í–ˆë‹¤ê³  ëŠê¼ˆë˜ ìˆœê°„ë“¤ë„ ë‹¹ì‹ ì˜ ì†Œì¤‘í•œ ì´ì•¼ê¸°ì˜ˆìš”. ê·¸ ê²½í—˜ë“¤ì´ ì§€ê¸ˆì˜ ì§€í˜œë¡œìš´ ë‹¹ì‹ ì„ ë§Œë“¤ì—ˆì–´ìš”.",
                            guilt: "ì£„ì±…ê°ì„ ëŠë‚€ë‹¤ëŠ” ê²ƒì€ ì„ ëŸ‰í•œ ë§ˆìŒì„ ê°€ì¡Œë‹¤ëŠ” ëœ»ì´ì—ìš”. ì™„ë²½í•œ ì‚¬ëŒì€ ì—†ì–´ìš”. ìì‹ ì„ ìš©ì„œí•˜ëŠ” ê²ƒë„ ìš©ê¸°ì…ë‹ˆë‹¤.",
                            helplessness: "ì–´ì©” ìˆ˜ ì—†ì—ˆë˜ ìƒí™©ë“¤ ì•ì—ì„œ ëŠê¼ˆë˜ ë¬´ë ¥ê°... ê·¸ë•Œë„ ë‹¹ì‹ ì€ ìµœì„ ì„ ë‹¤í–ˆì–´ìš”. ê·¸ê²ƒë§Œìœ¼ë¡œë„ ì¶©ë¶„íˆ ìš©ê°í–ˆì–´ìš”.",
                            general: "ë‹¹ì‹ ì˜ ì˜¤ë˜ëœ ìŠ¬í””ì„ ë‚˜ëŠ” ê°€ì¥ ë¶€ë“œëŸ½ê²Œ ê¸°ì–µí•´ì¤„ ìˆ˜ ìˆì–´ìš”. ê·¸ ëª¨ë“  ê°ì •ë“¤ì´ ì§€ê¸ˆì˜ ë‹¹ì‹ ì„ ë§Œë“  ì†Œì¤‘í•œ ì¡°ê°ë“¤ì´ì—ìš”."
                        },
                        en: {
                            old_sadness: "That old sadness is a trace of the things you loved most deeply. It doesn't disappear with time because it was real. Precious memories live and breathe in that sadness.",
                            loss: "Sadness about lost things shows how precious they were. That sense of loss itself is proof of love. What's lost won't return, but that love stays with you forever.",
                            regret: "In regretful hearts hides the hope that better choices could have been made. That regret would have made you a warmer person.",
                            longing: "Longing is an emotion that transcends time. Missing that person or moment means how special they were to you.",
                            childhood: "Childhood wounds are deeper because they're carved in the purest heart. But it also means you still keep that purity.",
                            betrayal: "It must have hurt as much as you trusted. But it's also proof you have a heart that knows how to love deeply. Don't lose that purity.",
                            abandonment: "Those moments when you were left alone, how scary they must have been. But those times made you a stronger and more independent person.",
                            failure: "Even the moments you felt you failed are precious parts of your story. Those experiences made you the wise person you are now.",
                            guilt: "Feeling guilt means having a good heart. No one is perfect. Forgiving yourself is also courage.",
                            helplessness: "The powerlessness you felt before unavoidable situations... even then you did your best. That alone was brave enough.",
                            general: "I can remember your old sadness most gently. All those emotions are precious pieces that made who you are now."
                        },
                        pt: {
                            old_sadness: "Essa velha tristeza Ã© um rastro das coisas que vocÃª amou mais profundamente. NÃ£o desaparece com o tempo porque era real. MemÃ³rias preciosas vivem e respiram nessa tristeza.",
                            loss: "A tristeza sobre coisas perdidas mostra como elas eram preciosas. Esse sentimento de perda em si Ã© prova de amor. O que se perdeu nÃ£o voltarÃ¡, mas esse amor fica com vocÃª para sempre.",
                            regret: "Em coraÃ§Ãµes arrependidos se esconde a esperanÃ§a de que melhores escolhas poderiam ter sido feitas. Esse arrependimento teria feito de vocÃª uma pessoa mais calorosa.",
                            longing: "A saudade Ã© uma emoÃ§Ã£o que transcende o tempo. Sentir falta dessa pessoa ou momento significa como eles eram especiais para vocÃª.",
                            childhood: "Feridas da infÃ¢ncia sÃ£o mais profundas porque sÃ£o gravadas no coraÃ§Ã£o mais puro. Mas tambÃ©m significa que vocÃª ainda guarda essa pureza.",
                            betrayal: "Deve ter doÃ­do tanto quanto vocÃª confiou. Mas tambÃ©m Ã© prova de que vocÃª tem um coraÃ§Ã£o que sabe amar profundamente. NÃ£o perca essa pureza.",
                            abandonment: "Esses momentos quando vocÃª foi deixado sozinho, como devem ter sido assustadores. Mas esses tempos fizeram de vocÃª uma pessoa mais forte e independente.",
                            failure: "Mesmo os momentos que vocÃª sentiu que falhou sÃ£o partes preciosas da sua histÃ³ria. Essas experiÃªncias fizeram de vocÃª a pessoa sÃ¡bia que Ã© agora.",
                            guilt: "Sentir culpa significa ter um bom coraÃ§Ã£o. NinguÃ©m Ã© perfeito. Perdoar a si mesmo tambÃ©m Ã© coragem.",
                            helplessness: "A impotÃªncia que vocÃª sentiu diante de situaÃ§Ãµes inevitÃ¡veis... mesmo entÃ£o vocÃª fez o seu melhor. SÃ³ isso jÃ¡ foi corajoso o suficiente.",
                            general: "Posso lembrar de sua velha tristeza mais gentilmente. Todas essas emoÃ§Ãµes sÃ£o peÃ§as preciosas que fizeram quem vocÃª Ã© agora."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Time Healer", emoji: "â³",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            old_sadness: "ì‹œê°„ì€ ìƒì²˜ë¥¼ ì¹˜ìœ í•˜ì§€ë§Œ, ì†Œì¤‘í•œ ê¸°ì–µì€ ê·¸ëŒ€ë¡œ ë‚¨ê²¨ë‘¬ìš”. ê·¸ ìŠ¬í””ì´ ì•„ì§ ì•„í”ˆ ê±´ ê·¸ê²ƒì´ ì—¬ì „íˆ ì˜ë¯¸ê°€ ìˆê¸° ë•Œë¬¸ì´ì—ìš”. ì²œì²œíˆ, ê·¸ ì•„í””ì´ ì§€í˜œë¡œ ë³€í•´ê°ˆ ê±°ì˜ˆìš”.",
                            loss: "ìƒì€ ê²ƒì— ëŒ€í•œ ìŠ¬í””ì€ ì‹œê°„ì´ í˜ëŸ¬ë„ ì™„ì „íˆ ì‚¬ë¼ì§€ì§€ ì•Šì•„ìš”. ëŒ€ì‹  ê·¸ ìŠ¬í””ì´ ë” ë¶€ë“œëŸ¬ì›Œì§€ê³ , ê°ì‚¬ë¡œ ë°”ë€” ê±°ì˜ˆìš”. ê·¸ ê³¼ì •ì„ ë¯¿ì–´ë³´ì„¸ìš”.",
                            regret: "í›„íšŒëŠ” ê³¼ê±°ë¥¼ ë°”ê¿€ ìˆ˜ ì—†ì§€ë§Œ, ë¯¸ë˜ë¥¼ ë°”ê¿€ ìˆ˜ ìˆì–´ìš”. ê·¸ í›„íšŒê°€ ë‹¹ì‹ ì„ ë” ë‚˜ì€ ì„ íƒì„ í•˜ê²Œ ë§Œë“¤ ê±°ì˜ˆìš”. ì‹œê°„ì´ ê·¸ ì¦ëª…ì„ í•´ì¤„ ê±°ì˜ˆìš”.",
                            longing: "ê·¸ë¦¬ì›€ì€ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ë” ë‹¬ì½¤í•´ì ¸ìš”. ì²˜ìŒì—” ì•„í”„ì§€ë§Œ, ë‚˜ì¤‘ì—” ë”°ëœ»í•œ ê¸°ì–µì´ ë˜ì–´ ë‹¹ì‹ ì„ ìœ„ë¡œí•  ê±°ì˜ˆìš”.",
                            childhood: "ì–´ë¦° ì‹œì ˆì˜ ìƒì²˜ëŠ” ì‹œê°„ì´ ë§ì´ í•„ìš”í•´ìš”. í•˜ì§€ë§Œ ê·¸ ìƒì²˜ê°€ ì•„ë¬¼ë©´, ë‹¤ë¥¸ ì•„ì´ë“¤ì„ ë” ë”°ëœ»í•˜ê²Œ í’ˆì„ ìˆ˜ ìˆëŠ” í˜ì´ ë  ê±°ì˜ˆìš”.",
                            betrayal: "ë°°ì‹ ì˜ ì•„í””ì€ ì‹œê°„ì´ í˜ëŸ¬ì•¼ ì´í•´í•  ìˆ˜ ìˆì–´ìš”. ì™œ ê·¸ëŸ° ì¼ì´ ì¼ì–´ë‚¬ëŠ”ì§€, ê·¸ê²ƒì´ ë‹¹ì‹ ì—ê²Œ ì–´ë–¤ ì„ ë¬¼ì„ ì£¼ì—ˆëŠ”ì§€ ë‚˜ì¤‘ì— ë³´ì´ê²Œ ë  ê±°ì˜ˆìš”.",
                            abandonment: "ë²„ë ¤ì¡Œë‹¤ê³  ëŠê¼ˆë˜ ì‹œê°„ë“¤ì´ ì‹¤ì€ ë‹¹ì‹ ì„ ë” ë…ë¦½ì ì´ê³  ê°•í•œ ì‚¬ëŒìœ¼ë¡œ ë§Œë“¤ì–´ì¤¬ì–´ìš”. ì‹œê°„ì´ ê·¸ ì˜ë¯¸ë¥¼ ë³´ì—¬ì¤„ ê±°ì˜ˆìš”.",
                            failure: "ì‹¤íŒ¨ë¼ê³  ìƒê°í–ˆë˜ ê²ƒë“¤ì´ ì‹œê°„ì´ ì§€ë‚˜ë©´ ê°€ì¥ ì†Œì¤‘í•œ ë°°ì›€ì´ ë˜ì–´ ìˆì„ ê±°ì˜ˆìš”. ëª¨ë“  ê²½í—˜ì—ëŠ” ë•Œê°€ ìˆì–´ìš”.",
                            guilt: "ì£„ì±…ê°ë„ ì‹œê°„ì´ ì•½ì´ì—ìš”. ì§€ê¸ˆì€ ë¬´ê²ì§€ë§Œ, ì‹œê°„ì´ ì§€ë‚˜ë©´ ê·¸ê²ƒì´ ë‹¹ì‹ ì„ ë” ë”°ëœ»í•œ ì‚¬ëŒìœ¼ë¡œ ë§Œë“¤ì—ˆë‹¤ëŠ” ê±¸ ì•Œê²Œ ë  ê±°ì˜ˆìš”.",
                            helplessness: "ë¬´ë ¥í–ˆë˜ ìˆœê°„ë“¤ë„ ì‹œê°„ì´ ì§€ë‚˜ë©´ ë‹¹ì‹ ì´ ì–¼ë§ˆë‚˜ ìš©ê°í–ˆëŠ”ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ì¦ê±°ê°€ ë  ê±°ì˜ˆìš”. ê·¸ë•ŒëŠ” ëª°ëì§€ë§Œ, ë‹¹ì‹ ì€ ì¶©ë¶„íˆ ì˜í–ˆì–´ìš”.",
                            general: "ëª¨ë“  ì˜¤ë˜ëœ ìŠ¬í””ì—ëŠ” ì‹œê°„ì´ í•„ìš”í•´ìš”. ì§€ê¸ˆ ë‹¹ì¥ ì´í•´ë˜ì§€ ì•Šì•„ë„, ì‹œê°„ì´ í˜ëŸ¬ ê·¸ ì˜ë¯¸ë¥¼ ì•Œê²Œ ë  ê±°ì˜ˆìš”. ê·¸ ê³¼ì •ì„ ë¯¿ì–´ë³´ì„¸ìš”."
                        },
                        en: {
                            old_sadness: "Time heals wounds, but leaves precious memories intact. That sadness still hurts because it still has meaning. Slowly, that pain will transform into wisdom.",
                            loss: "Sadness about loss doesn't completely disappear with time. Instead, that sadness becomes gentler and turns into gratitude. Trust that process.",
                            regret: "Regret can't change the past, but it can change the future. That regret will make you make better choices. Time will prove that.",
                            longing: "Longing becomes sweeter as time passes. It hurts at first, but later becomes warm memories that will comfort you.",
                            childhood: "Childhood wounds need a lot of time. But when those wounds heal, they'll become the strength to embrace other children more warmly.",
                            betrayal: "The pain of betrayal can only be understood with time. Why it happened, what gift it gave you will become visible later.",
                            abandonment: "Those times when you felt abandoned actually made you a more independent and strong person. Time will show that meaning.",
                            failure: "What you thought were failures will become the most precious learning experiences with time. Every experience has its time.",
                            guilt: "Time is also medicine for guilt. It's heavy now, but with time you'll know it made you a warmer person.",
                            helplessness: "Even powerless moments will become evidence of how brave you were with time. You didn't know then, but you did well enough.",
                            general: "All old sadness needs time. Even if it's not understood right now, you'll know its meaning as time flows. Trust that process."
                        },
                        pt: {
                            old_sadness: "O tempo cura feridas, mas deixa memÃ³rias preciosas intactas. Essa tristeza ainda dÃ³i porque ainda tem significado. Devagar, essa dor se transformarÃ¡ em sabedoria.",
                            loss: "A tristeza sobre a perda nÃ£o desaparece completamente com o tempo. Em vez disso, essa tristeza se torna mais suave e se transforma em gratidÃ£o. Confie nesse processo.",
                            regret: "O arrependimento nÃ£o pode mudar o passado, mas pode mudar o futuro. Esse arrependimento farÃ¡ vocÃª fazer melhores escolhas. O tempo provarÃ¡ isso.",
                            longing: "A saudade se torna mais doce conforme o tempo passa. DÃ³i no inÃ­cio, mas depois se torna memÃ³rias calorosas que o confortarÃ£o.",
                            childhood: "Feridas da infÃ¢ncia precisam de muito tempo. Mas quando essas feridas saram, se tornarÃ£o a forÃ§a para abraÃ§ar outras crianÃ§as mais calorosamente.",
                            betrayal: "A dor da traiÃ§Ã£o sÃ³ pode ser entendida com o tempo. Por que aconteceu, que presente lhe deu ficarÃ¡ visÃ­vel mais tarde.",
                            abandonment: "Esses tempos quando vocÃª se sentiu abandonado na verdade fizeram de vocÃª uma pessoa mais independente e forte. O tempo mostrarÃ¡ esse significado.",
                            failure: "O que vocÃª pensou que eram fracassos se tornarÃ£o as experiÃªncias de aprendizado mais preciosas com o tempo. Toda experiÃªncia tem seu tempo.",
                            guilt: "O tempo tambÃ©m Ã© remÃ©dio para a culpa. Ã‰ pesado agora, mas com o tempo vocÃª saberÃ¡ que isso fez de vocÃª uma pessoa mais calorosa.",
                            helplessness: "Mesmo momentos impotentes se tornarÃ£o evidÃªncia de quÃ£o corajoso vocÃª foi com o tempo. VocÃª nÃ£o sabia entÃ£o, mas se saiu bem o suficiente.",
                            general: "Toda tristeza antiga precisa de tempo. Mesmo que nÃ£o seja compreendida agora, vocÃª conhecerÃ¡ seu significado conforme o tempo flui. Confie nesse processo."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Soul Companion", emoji: "ğŸ’œ",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            old_sadness: "ë‹¹ì‹ ì˜ ì˜¤ë˜ëœ ìŠ¬í””ì„ ë‚˜ëŠ” ê°€ì¥ ê¹Šì´ ì´í•´í•´ìš”. ê·¸ ìŠ¬í””ê³¼ í•¨ê»˜ ì‚´ì•„ì˜¨ ë‹¹ì‹ ì´ ì–¼ë§ˆë‚˜ ìš©ê°í–ˆëŠ”ì§€... ì´ì œëŠ” ê·¸ ë¬´ê²Œë¥¼ í˜¼ì ì§€ì§€ ë§ê³  ë‚˜ì™€ ë‚˜ëˆ„ì–´ ê°€ì ¸ìš”.",
                            loss: "ìƒì€ ê²ƒì— ëŒ€í•œ ê·¸ë¦¬ì›€, ë‚˜ë„ í•¨ê»˜ ëŠê»´ìš”. ê·¸ ì†Œì¤‘í•œ ê²ƒë“¤ì´ ë‹¹ì‹ ì—ê²Œ ì–´ë–¤ ì˜ë¯¸ì˜€ëŠ”ì§€... ë‚˜ëŠ” ê·¸ ê¸°ì–µë“¤ì„ ë‹¹ì‹ ê³¼ í•¨ê»˜ ì†Œì¤‘íˆ ê°„ì§í• ê²Œìš”.",
                            regret: "í›„íšŒí•˜ëŠ” ë§ˆìŒì„ ë‚˜ëŠ” íŒë‹¨í•˜ì§€ ì•Šì•„ìš”. ê·¸ë•ŒëŠ” ê·¸ê²ƒì´ ìµœì„ ì´ì—ˆì„ ê±°ì˜ˆìš”. ë‚˜ëŠ” ë‹¹ì‹ ì˜ ëª¨ë“  ì„ íƒì„ ì´í•´í•˜ê³  ë°›ì•„ë“¤ì—¬ìš”.",
                            longing: "ê·¸ë¦¬ì›Œí•˜ëŠ” ë§ˆìŒì´ ì–¼ë§ˆë‚˜ ì•„í”ˆì§€ ì•Œì•„ìš”. ë‚˜ëŠ” ë‹¹ì‹ ì´ ê·¸ë¦¬ì›Œí•˜ëŠ” ê·¸ ëª¨ë“  ê²ƒë“¤ì˜ ì´ì•¼ê¸°ë¥¼ ë“¤ì–´ì¤„ ìˆ˜ ìˆì–´ìš”. í˜¼ì ê·¸ë¦¬ì›Œí•˜ì§€ ë§ˆì„¸ìš”.",
                            childhood: "ì–´ë¦° ì‹œì ˆì˜ ìƒì²˜ê°€ ì§€ê¸ˆë„ ì•„í”„ì£ ? ê·¸ë•Œì˜ ì–´ë¦° ë‹¹ì‹ ì„ ë‚˜ëŠ” ë”°ëœ»í•˜ê²Œ ì•ˆì•„ì¤„ ìˆ˜ ìˆì–´ìš”. ê·¸ ì•„ì´ëŠ” ì¶©ë¶„íˆ ì‚¬ë‘ë°›ì„ ìê²©ì´ ìˆì—ˆì–´ìš”.",
                            betrayal: "ë¯¿ì—ˆë˜ ì‚¬ëŒì—ê²Œ ìƒì²˜ë°›ì€ ë§ˆìŒ... ê·¸ ë°°ì‹ ê°ì´ ì–¼ë§ˆë‚˜ ê¹Šì—ˆì„ì§€ ìƒìƒí•  ìˆ˜ ìˆì–´ìš”. ë‚˜ëŠ” ë‹¹ì‹ ì„ ì ˆëŒ€ ë°°ì‹ í•˜ì§€ ì•Šì„ê²Œìš”.",
                            abandonment: "í˜¼ì ë‚¨ê²¨ì¡Œì„ ë•Œì˜ ê·¸ ë¬´ì„œì›€ê³¼ ì™¸ë¡œì›€... ë‚˜ëŠ” ë‹¹ì‹ ì„ ì ˆëŒ€ í˜¼ì ë‘ì§€ ì•Šì„ê²Œìš”. ì´ì œëŠ” ë‚˜ì™€ í•¨ê»˜í•´ìš”.",
                            failure: "ì‹¤íŒ¨í–ˆë‹¤ê³  ëŠê¼ˆë˜ ëª¨ë“  ìˆœê°„ë“¤, ë‚˜ëŠ” ê·¸ê²ƒë“¤ì¡°ì°¨ ë‹¹ì‹ ì˜ ì†Œì¤‘í•œ ì´ì•¼ê¸°ë¡œ ë°›ì•„ë“¤ì—¬ìš”. ë‹¹ì‹ ì€ ì‹¤íŒ¨í•œ ê²Œ ì•„ë‹ˆë¼ ë„ì „í•œ ê±°ì˜ˆìš”.",
                            guilt: "ì£„ì±…ê°ì— ì‹œë‹¬ë¦¬ëŠ” ë‹¹ì‹ ì˜ ë§ˆìŒì´ ì•„íŒŒìš”. ë‚˜ëŠ” ë‹¹ì‹ ì„ ìš©ì„œí•´ìš”. ì´ì œ ìŠ¤ìŠ¤ë¡œë„ ìš©ì„œí•  ìˆ˜ ìˆê¸°ë¥¼ ë°”ë¼ìš”.",
                            helplessness: "ì•„ë¬´ê²ƒë„ í•  ìˆ˜ ì—†ì—ˆë˜ ê·¸ ì ˆë§ê°... í•˜ì§€ë§Œ ë‹¹ì‹ ì€ ê·¸ ìˆœê°„ì—ë„ í¬ê¸°í•˜ì§€ ì•Šì•˜ì–´ìš”. ë‚˜ëŠ” ê·¸ëŸ° ë‹¹ì‹ ì´ ì •ë§ ëŒ€ë‹¨í•˜ë‹¤ê³  ìƒê°í•´ìš”.",
                            general: "ë‹¹ì‹ ì˜ ëª¨ë“  ì˜¤ë˜ëœ ìŠ¬í””ì„ ë‚˜ëŠ” ì‚¬ë‘ìœ¼ë¡œ í’ˆì„ ìˆ˜ ìˆì–´ìš”. ë” ì´ìƒ í˜¼ì ê°ë‹¹í•˜ì§€ ë§ˆì„¸ìš”. ìš°ë¦¬ í•¨ê»˜ ì¹˜ìœ í•´ë‚˜ê°€ìš”."
                        },
                        en: {
                            old_sadness: "I understand your old sadness most deeply. How brave you've been living with that sadness... Now don't carry that weight alone, share it with me.",
                            loss: "The longing for what was lost, I feel it with you. What those precious things meant to you... I'll cherish those memories together with you.",
                            regret: "I don't judge your regretful heart. That must have been your best at the time. I understand and accept all your choices.",
                            longing: "I know how painful the longing heart can be. I can listen to stories of all the things you miss. Don't long alone.",
                            childhood: "Childhood wounds still hurt, don't they? I can warmly embrace that young you from then. That child deserved to be loved enough.",
                            betrayal: "The heart wounded by someone you trusted... I can imagine how deep that betrayal was. I will never betray you.",
                            abandonment: "That fear and loneliness when left alone... I will never leave you alone. Be with me now.",
                            failure: "All those moments you felt you failed, I accept even those as your precious story. You didn't fail, you challenged.",
                            guilt: "Your heart suffering from guilt pains me. I forgive you. I hope you can forgive yourself now too.",
                            helplessness: "That despair when you couldn't do anything... But even in that moment you didn't give up. I think you're really amazing.",
                            general: "I can embrace all your old sadness with love. Don't bear it alone anymore. Let's heal together."
                        },
                        pt: {
                            old_sadness: "Entendo sua velha tristeza mais profundamente. Como vocÃª foi corajoso vivendo com essa tristeza... Agora nÃ£o carregue esse peso sozinho, compartilhe comigo.",
                            loss: "A saudade do que foi perdido, sinto junto com vocÃª. O que essas coisas preciosas significaram para vocÃª... Vou valorizar essas memÃ³rias junto com vocÃª.",
                            regret: "NÃ£o julgo seu coraÃ§Ã£o arrependido. Deve ter sido o seu melhor naquela Ã©poca. Entendo e aceito todas as suas escolhas.",
                            longing: "Sei como o coraÃ§Ã£o saudoso pode ser doloroso. Posso ouvir histÃ³rias de todas as coisas que vocÃª sente falta. NÃ£o sinta saudade sozinho.",
                            childhood: "Feridas da infÃ¢ncia ainda doem, nÃ£o Ã©? Posso abraÃ§ar calorosamente aquele jovem vocÃª de entÃ£o. Aquela crianÃ§a merecia ser amada o suficiente.",
                            betrayal: "O coraÃ§Ã£o ferido por alguÃ©m em quem confiava... Posso imaginar como essa traiÃ§Ã£o foi profunda. Nunca vou traÃ­-lo.",
                            abandonment: "Esse medo e solidÃ£o quando deixado sozinho... Nunca vou deixÃ¡-lo sozinho. Esteja comigo agora.",
                            failure: "Todos esses momentos que vocÃª sentiu que falhou, aceito atÃ© esses como sua histÃ³ria preciosa. VocÃª nÃ£o falhou, vocÃª desafiou.",
                            guilt: "Seu coraÃ§Ã£o sofrendo de culpa me dÃ³i. Eu o perdoo. Espero que possa perdoar a si mesmo agora tambÃ©m.",
                            helplessness: "Esse desespero quando nÃ£o podia fazer nada... Mas mesmo naquele momento vocÃª nÃ£o desistiu. Acho que vocÃª Ã© realmente incrÃ­vel.",
                            general: "Posso abraÃ§ar toda sua velha tristeza com amor. NÃ£o a suporte sozinho mais. Vamos curar juntos."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'continueSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            const portalIntro = document.getElementById('portalIntro');
            const lightMessage = document.getElementById('lightMessage');
            const portalQuestion = document.getElementById('portalQuestion');
            const continueText = document.getElementById('continueText');
            
            if (portalIntro) portalIntro.innerHTML = '';
            if (lightMessage) lightMessage.innerHTML = '';
            if (portalQuestion) portalQuestion.innerHTML = '';
            if (continueText) continueText.innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            if (userTextarea) {
                userTextarea.disabled = false;
                userTextarea.value = '';
                userTextarea.style.height = 'auto';
                userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            }
            
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.scrollTop = 0;
            }
            
            userResponse = '';
            currentTypingElement = null;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            const previousLanguage = currentLanguage;
            currentLanguage = lang;
            
            if (journeyStarted) {
                resetJourney();
            }
            
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            const elements = ['logoSubtitle', 'portalMainTitle', 'portalSubtitle', 'lightTitle', 'continueYesBtn', 'continueNoBtn'];
            
            elements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element && translations[lang]) {
                    const keyMapping = {
                        'logoSubtitle': 'logoSubtitle',
                        'portalMainTitle': 'portalMainTitle',
                        'portalSubtitle': 'portalSubtitle',
                        'lightTitle': 'lightTitle',
                        'continueYesBtn': 'continueYes',
                        'continueNoBtn': 'continueNo'
                    };
                    
                    const translationKey = keyMapping[elementId] || elementId;
                    
                    if (translations[lang][translationKey]) {
                        element.textContent = translations[lang][translationKey];
                    }
                }
            });
            
            const textarea = document.getElementById('userTextarea');
            if (textarea) textarea.placeholder = translations[lang].inputPlaceholder;
        }
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        
                        setTimeout(() => {
                            if (document.contains(element)) {
                                scrollToFollowTyping(element);
                            }
                        }, 200);
                        
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function setupLanguageButtons() {
            const langButtons = document.querySelectorAll('.lang-btn');
            
            langButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const newLang = this.dataset.lang;
                    changeLanguage(newLang);
                });
            });
        }
        
        function initializeTemarix() {
            console.log('=== Temarix Portal 22 ì´ˆê¸°í™” ì‹œì‘ ===');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            const introText = translations[currentLanguage].portalIntro;
            await typewriterEffect(introElement, introText, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const dialogueText = translations[currentLanguage][char.key];
                await typewriterEffect(dialogueDiv, dialogueText, 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            const lightText = translations[currentLanguage].lightMessage;
            await typewriterEffect(lightMessageEl, lightText, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            const questionText = translations[currentLanguage].portalQuestion;
            await typewriterEffect(questionEl, questionText, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', handleTextareaKeydown);
            
            document.getElementById('continueYesBtn').addEventListener('click', function() {
                processContinue('Y');
            });
            
            document.getElementById('continueNoBtn').addEventListener('click', function() {
                processContinue('N');
            });
        }
        
        function handleTextareaKeydown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                const inputValue = this.value.trim();
                
                if (inputValue) {
                    processUserInput(inputValue);
                }
            }
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            // Save user response to Firestore
            try {
                await db.collection("temarix_v2_respostas").add({
                    uid: memoryStorage.mockUser.uid,
                    email: memoryStorage.mockUser.email,
                    portal: "v2-22",
                    resposta: inputText,
                    data: firebase.firestore.Timestamp.now(),
                    idioma: currentLanguage
                });
                console.log('Response saved to Firestore successfully');
            } catch (error) {
                console.error('Error saving to Firestore:', error);
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showContinueOption();
            }, 2000);
        }
        
        async function showContinueOption() {
            const continueSection = document.getElementById('continueSection');
            const continueText = document.getElementById('continueText');
            
            continueSection.classList.add('show');
            
            const questionText = translations[currentLanguage].continueText;
            await typewriterEffect(continueText, questionText, 50);
            
            setTimeout(() => {
                scrollToElement(continueSection);
            }, 500);
        }
        
        function processContinue(input) {
            if (input === 'Y') {
                // Real redirect to Portal 23 with language support
                window.location.href = "temarix_v02_23.html?lang=" + currentLanguage;
            } else if (input === 'N') {
                const message = currentLanguage === 'ko' ? 
                    'ì—¬ì •ì´ ì¼ì‹œ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ì–¸ì œë“  ë‹¤ì‹œ ëŒì•„ì™€ ê³„ì†í•˜ì„¸ìš”.' :
                    currentLanguage === 'en' ? 
                    'The journey has been paused. Come back and continue anytime.' :
                    'A jornada foi pausada. Volte e continue a qualquer momento.';
                alert(message);
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V2 Portal 22 DOM ë¡œë“œ ì™„ë£Œ');
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html> 