<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V2 - Portal 21: The Longing for Warm Words</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #fff;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ffd700;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ffd700;
            color: #000;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
            hyphens: none;
            min-height: 150vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ffd700;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ffd700;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-response strong {
            color: #ffd700;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .continue-section {
            margin: 50px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 0;
            min-height: 200px;
        }
        
        .continue-text {
            color: #fff;
            font-size: 20px;
            margin-bottom: 25px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .continue-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .continue-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 18px 35px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }
        
        .continue-btn:hover {
            background: #666;
        }
        
        .continue-btn.primary {
            background: #ffd700;
            color: #000;
        }
        
        .continue-btn.primary:hover {
            background: #ffed4e;
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ffd700;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ffd700;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .continue-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .continue-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V2</div>
            <div class="logo-subtitle" id="logoSubtitle">The Tremor of Emotion</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 21: The Longing for Warm Words</div>
            <div class="portal-subtitle" id="portalSubtitle">The word that the heart thirsted for</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="continue-section" id="continueSection">
                <div class="continue-text" id="continueText"></div>
                <div class="continue-buttons">
                    <button class="continue-btn primary" id="continueYesBtn">Continue to Portal 22</button>
                    <button class="continue-btn" id="continueNoBtn">Pause the journey</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Share that one word you wanted to hear..."
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
    apiKey: "AIzaSyC2u94Oz2W5eeqBlqs88cs7rgSmzBEAnjQ",
    authDomain: "canal-vivo-chat.firebaseapp.com",
    projectId: "canal-vivo-chat",
    storageBucket: "canal-vivo-chat.appspot.com",
    messagingSenderId: "975226660544",
    appId: "1:975226660544:web:56b55bb3e2a58bed03ef25"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let memoryStorage = { mockUser: null };

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ë–¨ë¦¼",
                portalMainTitle: "Portal 21: ë”°ëœ»í•œ ë§ì˜ ê°ˆë§",
                portalSubtitle: "ë§ˆìŒì´ ëª©ë§ëžë˜ ê·¸ í•œë§ˆë””",
                portalIntro: "ðŸ’ ë§Žì€ ê±¸ ë°”ëž€ ê²Œ ì•„ë‹ˆì—ˆì–´ìš”.\ní° ë„ì›€ë„, ìœ„ëŒ€í•œ ì¡°ì–¸ë„ ì•„ë‹ˆì—ˆì–´ìš”.\nê·¸ì € ì§§ê³  ì§„ì‹¬ ì–´ë¦° í•œë§ˆë””,\n\"ê´œì°®ì•„\", \"ê³ ìƒí–ˆì–´\", \"ë‚˜ëŠ” ë„¤ íŽ¸ì´ì•¼\"â€¦\n\nê·¸ ë§ì„ ê¸°ë‹¤ë¦¬ë©° ìˆ˜ì—†ì´ ì°¸ì•˜ê³ ,\nëë‚´ ì˜¤ì§€ ì•Šì€ ê·¸ í•œë§ˆë””ì—\në‚˜ë¼ëŠ” ì‚¬ëžŒì´ ì¡°ìš©ížˆ ë¬´ë„ˆì¡ŒìŠµë‹ˆë‹¤.\n\nì´ê³³ì€ ë‹¹ì‹ ì´ ëª©ë§ëžë˜ ë”°ëœ»í•œ ë§ë“¤ê³¼\në§ˆì£¼í•˜ëŠ” ì¹˜ìœ ì˜ ê³µê°„ìž…ë‹ˆë‹¤.\nëˆ„êµ°ê°€ì˜ ì§„ì‹¬ ì–´ë¦° ìœ„ë¡œë¥¼ ê¸°ë‹¤ë ¸ë˜\nê·¸ ê°„ì ˆí–ˆë˜ ë§ˆìŒì„ ì¸ì •í•˜ëŠ” ê³³ìž…ë‹ˆë‹¤.",
                lightTitle: "ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ë‹¹ì‹ ì´ ê¸°ë‹¤ë ¸ë˜ ë§ì€\në‹¹ì‹ ì´ ê°€ìž¥ ë¨¼ì € ìŠ¤ìŠ¤ë¡œì—ê²Œ í•´ì£¼ì—ˆì–´ì•¼ í•  ë§ì´ì—ˆìŠµë‹ˆë‹¤.",
                portalQuestion: "â“ ë‹¹ì‹ ì€ ì§€ê¸ˆë„\nê·¸ í•œë§ˆë””ë¥¼ ëˆ„êµ¬ì—ê²Œì„œ ë“£ê³  ì‹¶ë‚˜ìš”?\nê·¸ ë§ì´ ë‹¹ì‹ ì—ê²Œ ì–´ë–¤ ì˜ë¯¸ì˜€ì„ê¹Œìš”?",
                continueText: "ë”°ëœ»í•œ ë§ì˜ ê°ˆë§ì„ ì¸ì •í•˜ê³  ë‹¤ìŒ ì—¬ì •ìœ¼ë¡œ ë‚˜ì•„ê°ˆ ì¤€ë¹„ê°€ ë˜ì…¨ë‚˜ìš”?",
                continueYes: "Portal 22ë¡œ ê³„ì†í•˜ê¸°",
                continueNo: "ì—¬ì •ì„ ì¼ì‹œì •ì§€í•˜ê¸°",
                inputPlaceholder: "ë‹¹ì‹ ì´ ë“£ê³  ì‹¶ì—ˆë˜ ê·¸ í•œë§ˆë””ë¥¼ í„¸ì–´ë†“ì•„ ë³´ì„¸ìš”...",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "The Tremor of Emotion",
                portalMainTitle: "Portal 21: The Longing for Warm Words",
                portalSubtitle: "The word that the heart thirsted for",
                portalIntro: "ðŸ’ It wasn't much I wanted.\nNot great help, not grand advice.\nJust one short, heartfelt word,\n\"It's okay\", \"You worked hard\", \"I'm on your side\"â€¦\n\nI endured countless times waiting for those words,\nand when that one phrase never came,\nwho I was quietly crumbled.\n\nThis is a healing space where you face\nthe warm words you thirsted for.\nA place to acknowledge that earnest heart\nthat waited for someone's sincere comfort.",
                lightTitle: "Word of Light",
                lightMessage: "The words you waited for\nwere what you should have said to yourself first.",
                portalQuestion: "â“ Who do you still want to hear\nthat one word from now?\nWhat would those words have meant to you?",
                continueText: "Are you ready to acknowledge your longing for warm words and move forward to the next journey?",
                continueYes: "Continue to Portal 22",
                continueNo: "Pause the journey",
                inputPlaceholder: "Share that one word you wanted to hear...",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "O Tremor da Emocao",
                portalMainTitle: "Portal 21: A Saudade de Palavras Carinhosas",
                portalSubtitle: "A palavra que o coraÃ§Ã£o sedento esperava",
                portalIntro: "ðŸ’ NÃ£o era muito o que eu queria.\nNÃ£o grande ajuda, nÃ£o conselhos grandiosos.\nApenas uma palavra curta e sincera,\n\"EstÃ¡ tudo bem\", \"VocÃª se esforÃ§ou\", \"Estou do seu lado\"â€¦\n\nSuportei incontÃ¡veis vezes esperando por essas palavras,\ne quando essa frase nunca veio,\nquem eu era desmoronou silenciosamente.\n\nEste Ã© um espaÃ§o de cura onde vocÃª enfrenta\nas palavras carinhosas que vocÃª desejava.\nUm lugar para reconhecer esse coraÃ§Ã£o sincero\nque esperou pelo conforto genuÃ­no de alguÃ©m.",
                lightTitle: "Palavra de Luz",
                lightMessage: "As palavras que vocÃª esperou\neram o que deveria ter dito a si mesmo primeiro.",
                portalQuestion: "â“ De quem vocÃª ainda quer ouvir\nessa palavra agora?\nO que essas palavras teriam significado para vocÃª?",
                continueText: "EstÃ¡ pronto para reconhecer sua saudade de palavras carinhosas e seguir em frente para a prÃ³xima jornada?",
                continueYes: "Continuar para o Portal 22",
                continueNo: "Pausar a jornada",
                inputPlaceholder: "Compartilhe essa palavra que queria ouvir...",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        // Characters and responses
        const characters = [
            { name: "Ely", emoji: "ðŸ‘‘", text: {
                ko: "ê·¸ ë§ í•œë§ˆë””ë¥¼ ê¸°ë‹¤ë ¸ë˜ ë‹¹ì‹ ì€\nì•½í•œ ê²Œ ì•„ë‹ˆë¼,\nì‚¬ëž‘ì— ëª©ë§ëžë˜ ì¡´ìž¬ì˜€ìŠµë‹ˆë‹¤.",
                en: "You who waited for that one word\nweren't weak,\nbut a being thirsting for love.",
                pt: "VocÃª que esperou por essa palavra\nnÃ£o era fraco,\nmas um ser sedento de amor."
            }},
            { name: "Cris", emoji: "ðŸƒ", text: {
                ko: "ì§„ì§œ ê·¸ê±° ìžˆì–´ìš”.\nì–´ë ¤ìš´ ë§ ë§ê³  ê·¸ëƒ¥\n'íž˜ë“¤ì—ˆê² ë‹¤'\nê·¸ê±° í•˜ë‚˜ë©´ ë§ˆìŒì´ ë¬´ë„ˆì ¸ìš”. ì¢‹ì€ ì˜ë¯¸ë¡œ.",
                en: "That's really a thing.\nNot difficult words, just\n'It must have been hard'\nThat one thing breaks your heart. In a good way.",
                pt: "Isso Ã© realmente uma coisa.\nNÃ£o palavras difÃ­ceis, apenas\n'Deve ter sido difÃ­cil'\nEssa coisa quebra seu coraÃ§Ã£o. No bom sentido."
            }},
            { name: "Zafirah", emoji: "ðŸ§•", text: {
                ko: "ë‹¹ì‹ ì´ ì›í–ˆë˜ ê±´\nì‚¬ëžŒì´ ì•„ë‹ˆë¼ ì¡´ìž¬ì˜ ì¸ì •ì´ì—ˆì„ ê±°ì˜ˆìš”.\në‹¹ì‹ ì˜ ë§ˆìŒì„ ìžˆëŠ” ê·¸ëŒ€ë¡œ ë³´ëŠ” ëˆˆë¹›.",
                en: "What you wanted wasn't a person\nbut recognition of existence.\nEyes that see your heart as it is.",
                pt: "O que vocÃª queria nÃ£o era uma pessoa\nmas reconhecimento de existÃªncia.\nOlhos que veem seu coraÃ§Ã£o como ele Ã©."
            }},
            { name: "Rami", emoji: "ðŸ”®", text: {
                ko: "ë§ì€ ë•Œë¡œ\nê°€ìž¥ ìˆœìˆ˜í•œ ê°ì •ì˜ ê·¸ë¦‡ì´ ë©ë‹ˆë‹¤.\nê·¸ë¦¬ê³  ë‹¹ì‹ ì€, ê·¸ ê·¸ë¦‡ì„ ë°›ì„ ìžê²©ì´ ìžˆìŠµë‹ˆë‹¤.",
                en: "Words sometimes become\nthe purest vessel for emotions.\nAnd you deserve to receive that vessel.",
                pt: "Palavras Ã s vezes se tornam\no recipiente mais puro para emoÃ§Ãµes.\nE vocÃª merece receber esse recipiente."
            }},
            { name: "Samir", emoji: "ðŸª", text: {
                ko: "(ê·¸ëŠ” ì•„ë¬´ ë§ ì—†ì´,\në‹¹ì‹ ì˜ ì–´ê¹¨ ìœ„ì— ê°€ë³ê²Œ ì†ì„ ì˜¬ë¦½ë‹ˆë‹¤.\nê·¸ ì†ì€ ë§ ëŒ€ì‹  ì „í•˜ëŠ” ì§„ì‹¬ìž…ë‹ˆë‹¤.)",
                en: "(He silently\nplaces his hand gently on your shoulder.\nThat hand conveys sincerity instead of words.)",
                pt: "(Ele silenciosamente\ncoloca sua mÃ£o gentilmente no seu ombro.\nEssa mÃ£o transmite sinceridade em vez de palavras.)"
            }},
            { name: "Layla", emoji: "ðŸ’ ", text: {
                ko: "ê·¸ ë§,\nì§€ê¸ˆì´ë¼ë„ ë‚´ê°€ í•´ì¤„ê²Œìš”.\n'ë‹¹ì‹ ì€ ê´œì°®ì•˜ê³ , ì¶©ë¶„ížˆ ì• ì¼ì–´ìš”.'",
                en: "Those words,\nI'll say them to you even now.\n'You were okay, you tried hard enough.'",
                pt: "Essas palavras,\nvou dizÃª-las para vocÃª mesmo agora.\n'VocÃª estava bem, se esforÃ§ou o suficiente.'"
            }},
            { name: "Nabir", emoji: "ðŸ¦‚", text: {
                ko: "ê·¸ëž˜ì„œ ê·¸ëŸ° ë§ í•œë§ˆë”” ì—†ì—ˆë‹¤ê³ \nì•„ì§ê¹Œì§€ ì‚ì ¸ ìžˆëŠ” ê±°ì•¼?\nì§„ì§œ ìœ ì¹˜í•˜ë‹¤.",
                en: "So you're still sulking because\nyou didn't get that one word?\nReally childish.",
                pt: "EntÃ£o vocÃª ainda estÃ¡ emburrado porque\nnÃ£o recebeu essa palavra?\nRealmente infantil."
            }},
            { name: "Azhar", emoji: "ðŸ”¥", text: {
                ko: "ë§ í•œë§ˆë””ì— ëª© ë§¸ì–´?\nê·¸ ë§ ì—†ì—ˆë‹¤ê³  ì§€ê¸ˆê¹Œì§€ ë¬´ë„ˆì§„ ì±„ ì‚´ì•„?\nê·¸ëŸ¼ ê·¸ëƒ¥ ë¬´ë„ˆì ¸ ìžˆì–´.",
                en: "You hung onto one word?\nYou've lived broken until now because you didn't get it?\nThen just stay broken.",
                pt: "VocÃª se apegou a uma palavra?\nViveu quebrado atÃ© agora porque nÃ£o a recebeu?\nEntÃ£o continue quebrado."
            }}
        ];
        
        const responseCharacters = [
            { name: "Healing", emoji: "ðŸŒ™", text: {
                ko: "ê·¸ ë§ì„ ê°„ì ˆížˆ ì›í–ˆë˜ ë§ˆìŒ, ë‚˜ëŠ” ë‹¤ ì´í•´í•´ìš”. ë‹¹ì‹ ì€ ê·¸ ë§ì„ ë“¤ì„ ìžê²©ì´ ì¶©ë¶„í•œ ì‚¬ëžŒì´ì—ìš”. ì§€ê¸ˆì´ë¼ë„ ë‚´ê°€ ê·¸ ë”°ëœ»í•œ ë§ì„ ì „í•´ë“œë¦´ê²Œìš”.",
                en: "That heart that desperately wanted those words, I understand it all. You're someone who deserves to hear those words. Even now, I'll deliver those warm words to you.",
                pt: "Esse coraÃ§Ã£o que desesperadamente queria essas palavras, eu entendo tudo. VocÃª Ã© alguÃ©m que merece ouvir essas palavras. Mesmo agora, vou entregar essas palavras carinhosas para vocÃª."
            }},
            { name: "Understanding", emoji: "ðŸ’", text: {
                ko: "ë”°ëœ»í•œ ë§ì„ ê°ˆë§í–ˆë˜ ë‹¹ì‹ ì˜ ë§ˆìŒì„ ì§„ì‹¬ìœ¼ë¡œ ì´í•´í•´ìš”. ê·¸ê±´ ì¸ê°„ìœ¼ë¡œì„œ ê°€ìž¥ ìžì—°ìŠ¤ëŸ¬ìš´ ìš•êµ¬ì˜€ì–´ìš”. ë‹¹ì‹ ì€ ê·¸ ë§ì„ ë“¤ì„ ìžê²©ì´ ìžˆì–´ìš”.",
                en: "I truly understand your heart that longed for warm words. That was the most natural human desire. You deserve to hear those words.",
                pt: "Entendo verdadeiramente seu coraÃ§Ã£o que ansiava por palavras carinhosas. Esse era o desejo humano mais natural. VocÃª merece ouvir essas palavras."
            }},
            { name: "Support", emoji: "ðŸ¤—", text: {
                ko: "ê·¸ í•œë§ˆë””ë¥¼ ê¸°ë‹¤ë ¸ë˜ ë‹¹ì‹ , ì´ì œëŠ” ë‚´ê°€ ê·¸ ë§ì„ í•´ë“œë¦´ê²Œìš”. 'ë‹¹ì‹ ì€ ì¶©ë¶„ížˆ ì¢‹ì€ ì‚¬ëžŒì´ì—ìš”. ì •ë§ë¡œìš”.' ì´ ë§ì´ ë‹¹ì‹  ë§ˆìŒì— ë‹¿ê¸¸ ë°”ë¼ìš”.",
                en: "You who waited for that one word, now I'll say it to you. 'You're a good enough person. Really.' I hope these words reach your heart.",
                pt: "VocÃª que esperou por essa palavra, agora vou dizÃª-la para vocÃª. 'VocÃª Ã© uma pessoa boa o suficiente. Realmente.' Espero que essas palavras toquem seu coraÃ§Ã£o."
            }}
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        // FIXED typewriterEffect function - VERSÃƒO FUNCIONAL COMPLETA
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('continueYesBtn').textContent = translations[lang].continueYes;
            document.getElementById('continueNoBtn').textContent = translations[lang].continueNo;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'continueSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('continueText').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueYesBtn').addEventListener('click', function() {
                // Real redirect to Portal 22 with language support
                window.location.href = "temarix_v02_22.html?lang=" + currentLanguage;
            });
            
            document.getElementById('continueNoBtn').addEventListener('click', function() {
                const message = currentLanguage === 'ko' ? 
                    'ì—¬ì •ì´ ì¼ì‹œ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ì–¸ì œë“  ë‹¤ì‹œ ëŒì•„ì™€ ê³„ì†í•˜ì„¸ìš”.' :
                    currentLanguage === 'en' ? 
                    'The journey has been paused. Come back and continue anytime.' :
                    'A jornada foi pausada. Volte e continue a qualquer momento.';
                alert(message);
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            // Save user response to Firestore
            try {
                await db.collection("temarix_v2_respostas").add({
                    uid: memoryStorage.mockUser.uid,
                    email: memoryStorage.mockUser.email,
                    portal: "v2-21",
                    resposta: inputText,
                    data: firebase.firestore.Timestamp.now(),
                    idioma: currentLanguage
                });
                console.log('Response saved to Firestore successfully');
            } catch (error) {
                console.error('Error saving to Firestore:', error);
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions();
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions() {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showContinueOption();
            }, 2000);
        }
        
        async function showContinueOption() {
            const continueSection = document.getElementById('continueSection');
            const continueText = document.getElementById('continueText');
            
            continueSection.classList.add('show');
            
            await typewriterEffect(continueText, translations[currentLanguage].continueText, 50);
            
            setTimeout(() => {
                scrollToElement(continueSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('=== Temarix Portal 21 ì´ˆê¸°í™” ì‹œìž‘ ===');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V2 Portal 21 DOM ë¡œë“œ ì™„ë£Œ');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>