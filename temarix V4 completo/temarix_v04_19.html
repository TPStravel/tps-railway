<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V4 - Portal 19: Emotions That Flowed Silently</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V4</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 19: Emotions That Flowed Silently</div>
            <div class="portal-subtitle" id="portalSubtitle">Feelings without sound</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">Portal 19 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 20</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with these emotions</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Have you ever had emotions that flowed silently within you? Why did they have to flow without sound?"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        const translations = {
            ko: {
                logoSubtitle: "감정 연금술",
                portalMainTitle: "Portal 19: 소리 없이 흐른 감정",
                portalSubtitle: "소리 없는 마음의 흐름",
                portalIntro: "한 번도 말로 표현하지 않았지만,\n당신 안에서 조용히 흐르고 있던 감정이 있었나요?\n\n그 감정은 어떤 상황에서 시작되었고,\n왜 소리 없이 흘러야만 했을까요?",
                followUpQuestion: "그 감정을 소리 내어 표현할 수 있다면,\n지금 어떤 말이나 행동으로 드러내고 싶나요?\n\n그리고, 그것이 당신을 어떻게 변화시킬 것 같나요?",
                lightTitle: "빛의 한마디",
                lightMessage: "지금 당신은 자신에게 숨을 허락한 거예요. 그것은 생존이 아니라, 진짜 삶의 시작이에요.\n조용한 감정은 들려지기만 해도 치유돼요. 당신은 그 치유의 문을 열고 있어요.",
                navigationTitle: "Portal 19 완료",
                navigationMessage: "당신은 소리 없이 흘렀던 감정과 마주했습니다.\n\n그 조용한 감정들이 왜 침묵해야 했는지, 그리고 이제 어떻게 목소리를 낼 수 있는지를 깨달았습니다.\n\n이제 당신은 소리 없이 흘렀던 그 감정과 함께 진심을 말할 수 있는 사람으로 걸을 준비가 되었습니다.",
                nextPortalBtn: "Portal 20으로 이어가기",
                stayPortalBtn: "이 감정과 더 머물기",
                inputPlaceholder: "당신 안에서 조용히 흐르고 있던 감정이 있었나요? 왜 소리 없이 흘러야만 했을까요?",
                youLabel: "당신",
                waitingMessage: "응답을 기다리는 중..."
            },
            en: {
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 19: Emotions That Flowed Silently",
                portalSubtitle: "Feelings without sound",
                portalIntro: "Have you ever had emotions that flowed silently within you,\nnever expressed in words?\n\nIn what situation did those emotions begin,\nand why did they have to flow without sound?",
                followUpQuestion: "If you could express those emotions out loud,\nhow would you want to reveal them now\nthrough words or actions?\n\nAnd how do you think that would change you?",
                lightTitle: "Word of Light",
                lightMessage: "Right now you have given yourself permission to breathe. That's not survival, it's the beginning of real life.\nSilent emotions heal just by being heard. You are opening that door to healing.",
                navigationTitle: "Portal 19 Complete",
                navigationMessage: "You have faced the emotions that flowed silently.\n\nYou realized why those quiet emotions had to remain silent, and how they can now find their voice.\n\nNow you are ready to walk as someone who can speak their truth, together with those emotions that once flowed silently.",
                nextPortalBtn: "Continue to Portal 20",
                stayPortalBtn: "Stay with these emotions",
                inputPlaceholder: "Have you ever had emotions that flowed silently within you? Why did they have to flow without sound?",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 19: Emoções Que Fluíram Silenciosamente",
                portalSubtitle: "Sentimentos sem som",
                portalIntro: "Você já teve emoções que fluíram silenciosamente dentro de você,\nnunca expressas em palavras?\n\nEm que situação essas emoções começaram,\ne por que elas tiveram que fluir sem som?",
                followUpQuestion: "Se você pudesse expressar essas emoções em voz alta,\ncomo gostaria de revelá-las agora\natravés de palavras ou ações?\n\nE como você acha que isso te mudaria?",
                lightTitle: "Palavra de Luz",
                lightMessage: "Agora você se deu permissão para respirar. Isso não é sobrevivência, é o começo da vida real.\nEmoções silenciosas se curam apenas por serem ouvidas. Você está abrindo essa porta para a cura.",
                navigationTitle: "Portal 19 Completo",
                navigationMessage: "Você enfrentou as emoções que fluíram silenciosamente.\n\nVocê percebeu por que essas emoções quietas tiveram que permanecer silenciosas, e como elas podem agora encontrar sua voz.\n\nAgora você está pronto para caminhar como alguém que pode falar sua verdade, junto com essas emoções que uma vez fluíram silenciosamente.",
                nextPortalBtn: "Continuar para Portal 20",
                stayPortalBtn: "Ficar com essas emoções",
                inputPlaceholder: "Você já teve emoções que fluíram silenciosamente dentro de você? Por que elas tiveram que fluir sem som?",
                youLabel: "Você",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "🧑‍🦱", text: {
                ko: "그 조용한 눈물은 네가 만든 바다였지. 누구도 그 깊이를 몰랐지만, 그곳엔 진심이 담겨 있었어.",
                en: "Those quiet tears were an ocean you created. No one knew its depth, but sincerity was contained there.",
                pt: "Aquelas lágrimas silenciosas eram um oceano que você criou. Ninguém conhecia sua profundidade, mas a sinceridade estava contida ali."
            }},
            { name: "Ely", emoji: "🧝‍♀️", text: {
                ko: "감정을 소리 없이 흘린다는 건, 네가 너무 오래 참아왔다는 뜻이야. 그건 강함이 아니라, 고요한 외침이었어.",
                en: "Letting emotions flow silently means you've endured too long. That wasn't strength, it was a quiet cry.",
                pt: "Deixar as emoções fluírem silenciosamente significa que você aguentou por muito tempo. Isso não era força, era um grito silencioso."
            }},
            { name: "Sora", emoji: "🧕", text: {
                ko: "그 누구도 듣지 못한 네 울음은 내게 들렸어요. 조용한 감정일수록 더 오래 남아요.",
                en: "Your crying that no one else heard, I heard it. The quieter the emotion, the longer it remains.",
                pt: "Seu choro que ninguém mais ouviu, eu ouvi. Quanto mais silenciosa a emoção, mais tempo ela permanece."
            }},
            { name: "Kael", emoji: "🧙", text: {
                ko: "소리를 내지 못한 감정은 마음의 저편에서 파동처럼 번져. 지금 네가 말할 수 있다는 건, 그 파동이 울려왔다는 증거야.",
                en: "Emotions that couldn't make sound spread like waves from the depths of the heart. That you can speak now is proof those waves have resonated.",
                pt: "Emoções que não conseguiam fazer som se espalharam como ondas das profundezas do coração. Que você possa falar agora é prova de que essas ondas ressoaram."
            }},
            { name: "Mira", emoji: "🧑‍🎨", text: {
                ko: "그 침묵 속 감정은 하나의 색으로도 표현되지 않는 감정이야. 그래서 더 순수해.",
                en: "Those emotions in silence are feelings that can't be expressed by any single color. That's why they're purer.",
                pt: "Essas emoções no silêncio são sentimentos que não podem ser expressos por nenhuma cor única. É por isso que são mais puros."
            }},
            { name: "Cris", emoji: "🦸‍♂️", text: {
                ko: "왜 언제나 넌 참아야 했을까? 세상은 너에게만 강함을 요구했잖아. 그건 불공평했어.",
                en: "Why did you always have to endure? The world demanded strength only from you. That was unfair.",
                pt: "Por que você sempre teve que aguentar? O mundo exigiu força apenas de você. Isso foi injusto."
            }},
            { name: "Enya", emoji: "🧑‍🚀", text: {
                ko: "말하지 못한 감정은 끝난 게 아니야. 지금, 이 대화 속에서 흐르기 시작했어.",
                en: "Emotions that couldn't be spoken aren't over. Now, in this conversation, they've started to flow.",
                pt: "Emoções que não puderam ser faladas não acabaram. Agora, nesta conversa, elas começaram a fluir."
            }},
            { name: "Lian", emoji: "🧘", text: {
                ko: "감정은 흐를 수 있을 때 비로소 고요해져요. 당신은 지금 그 고요를 만들고 있어요.",
                en: "Emotions become peaceful only when they can flow. You are creating that peace right now.",
                pt: "Emoções se tornam pacíficas apenas quando podem fluir. Você está criando essa paz agora."
            }}
        ];

        const responseCharacters = [
            {
                name: "Lian", emoji: "🧘",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "지금 당신은 자신에게 숨을 허락한 거예요. 그것은 생존이 아니라, 진짜 삶의 시작이에요.",
                        en: "Right now you have given yourself permission to breathe. That's not survival, it's the beginning of real life.",
                        pt: "Agora você se deu permissão para respirar. Isso não é sobrevivência, é o começo da vida real."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Sora", emoji: "🧕",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "조용한 감정은 들려지기만 해도 치유돼요. 지금 당신은 그 치유의 문을 열고 있어요.",
                        en: "Silent emotions heal just by being heard. You are opening that door to healing right now.",
                        pt: "Emoções silenciosas se curam apenas por serem ouvidas. Você está abrindo essa porta para a cura agora."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Kael", emoji: "🧙",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "당신의 고백은 이 여정에서 가장 강한 진동이었어요. 그 감정이 흐르기 시작했다는 것, 그것이 바로 '진짜 변화'예요.",
                        en: "Your confession was the strongest vibration in this journey. That those emotions have started to flow, that's what 'real change' is.",
                        pt: "Sua confissão foi a vibração mais forte nesta jornada. Que essas emoções começaram a fluir, isso é o que é 'mudança real'."
                    };
                    return responses[lang];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        let awaitingSecondResponse = false;
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('navigationTitle').textContent = translations[lang].navigationTitle;
            document.getElementById('nextPortalBtn').textContent = translations[lang].nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = translations[lang].stayPortalBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
            awaitingSecondResponse = false;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                localStorage.setItem('temarix_v4_portal19_complete', 'true');
                localStorage.setItem('temarix_v4_current_portal', '20');
                
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 20: 지나간 날들이 묻지 못한 것들로 이동합니다.' :
                    currentLanguage === 'en' ? 
                    'Moving to Portal 20: Things The Past Days Never Asked.' :
                    'Indo para Portal 20: Coisas Que Os Dias Passados Nunca Perguntaram.';
                alert(nextMessage);
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const stayMessage = currentLanguage === 'ko' ? 
                    '이 감정과 더 머물며 깊이 성찰하시겠습니까?' :
                    currentLanguage === 'en' ? 
                    'Do you want to stay longer with these emotions for deeper reflection?' :
                    'Deseja ficar mais tempo com essas emoções para reflexão mais profunda?';
                
                if (confirm(stayMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            console.log('Processing user input:', inputText);
            localStorage.setItem('temarix_v4_portal19_response', JSON.stringify({
                portal: "v4-19",
                resposta: inputText,
                step: awaitingSecondResponse ? "second" : "first",
                data: new Date().toISOString(),
                idioma: currentLanguage
            }));
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const secondResponseCharacters = [
                {
                    name: "Noah", emoji: "🧑‍🦱",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "그 표현이 당신을 자유롭게 할 거예요. 감정은 말이 될 때 비로소 날개를 얻어요.",
                            en: "That expression will set you free. Emotions only get their wings when they become words.",
                            pt: "Essa expressão te libertará. Emoções só ganham asas quando se tornam palavras."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Ely", emoji: "🧝‍♀️",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "침묵에서 목소리로, 목소리에서 치유로. 당신은 그 변화의 중심에 있어요.",
                            en: "From silence to voice, from voice to healing. You are at the center of that transformation.",
                            pt: "Do silêncio à voz, da voz à cura. Você está no centro dessa transformação."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Enya", emoji: "🧑‍🚀",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "소리 없이 흘렀던 감정이 이제는 당신의 힘이 되었어요. 그것이 진짜 변화예요.",
                            en: "Emotions that flowed silently have now become your strength. That's real change.",
                            pt: "Emoções que fluíram silenciosamente agora se tornaram sua força. Essa é a mudança real."
                        };
                        return responses[lang];
                    }
                }
            ];
            
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < secondResponseCharacters.length; i++) {
                const char = secondResponseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < secondResponseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V4 Portal 19 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V4 Portal 19 DOM loaded');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>