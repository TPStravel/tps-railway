<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V4 - Portal 23: Moments Without Courage</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V4</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 23: Moments Without Courage</div>
            <div class="portal-subtitle" id="portalSubtitle">Words left unspoken</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">Portal 23 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 24</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with this courage</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Was there a moment when you lacked courage to speak? What did you want to say and why was it so frightening?"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        const translations = {
            ko: {
                logoSubtitle: "감정 연금술",
                portalMainTitle: "Portal 23: 용기가 없었던 순간",
                portalSubtitle: "말하지 못한 말들",
                portalIntro: "당신은 한 번이라도,\n용기가 부족해서 말하지 못했던 순간이 있었나요?\n\n그때 무엇을 말하고 싶었고,\n왜 그 말을 꺼내는 것이 두려웠나요?",
                followUpQuestion: "지금 그 말을 다시 꺼낼 수 있다면,\n어떤 말로 시작하고 싶나요?\n\n그리고 그 말은, 당신 자신에게도 필요한가요?",
                lightTitle: "빛의 한마디",
                lightMessage: "지금의 너는, 과거의 자신에게 사과할 수 있을 만큼 단단해졌어요. 그것이 진짜 용기예요.\n사과는 누구에게도 늦지 않아요. 자신에게조차. 당신은 지금 그것을 시작했어요.\n진짜 용기는 지나간 말 앞에 무릎 꿇는 것. 그리고 다시 시작할 수 있다는 믿음이야.",
                navigationTitle: "Portal 23 완료",
                navigationMessage: "당신은 용기가 없었던 그 순간과 화해하고 감정을 정직하게 꺼낼 수 있는 사람이 되었습니다.\n\n말하지 못했던 그 순간을 이해하며, 이제는 진심을 표현할 수 있는 용기를 찾았습니다.\n\n더 이상 자존심이나 두려움 때문에 감정을 숨기지 않고, 솔직한 마음으로 소통할 수 있는 힘을 얻었습니다.",
                nextPortalBtn: "Portal 24로 이어가기",
                stayPortalBtn: "이 용기와 더 머물기",
                inputPlaceholder: "용기가 부족해서 말하지 못했던 순간이 있었나요? 무엇을 말하고 싶었고 왜 두려웠나요?",
                youLabel: "당신",
                waitingMessage: "응답을 기다리는 중..."
            },
            en: {
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 23: Moments Without Courage",
                portalSubtitle: "Words left unspoken",
                portalIntro: "Have you ever had a moment\nwhen you couldn't speak due to lack of courage?\n\nWhat did you want to say then,\nand why was it so frightening to voice those words?",
                followUpQuestion: "If you could speak those words again now,\nwhat would you start with?\n\nAnd are those words something you need to hear yourself?",
                lightTitle: "Word of Light",
                lightMessage: "The current you has become strong enough to apologize to your past self. That is true courage.\nApologies are never too late for anyone. Even to yourself. You have started that now.\nTrue courage is kneeling before past words. And believing that you can start again.",
                navigationTitle: "Portal 23 Complete",
                navigationMessage: "You have made peace with that moment when you lacked courage and become someone who can honestly express emotions.\n\nBy understanding that moment when you couldn't speak, you have now found the courage to express your true feelings.\n\nYou have gained the strength to communicate with an honest heart, no longer hiding emotions due to pride or fear.",
                nextPortalBtn: "Continue to Portal 24",
                stayPortalBtn: "Stay with this courage",
                inputPlaceholder: "Was there a moment when you lacked courage to speak? What did you want to say and why was it so frightening?",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 23: Momentos Sem Coragem",
                portalSubtitle: "Palavras não ditas",
                portalIntro: "Você já teve um momento\nem que não conseguiu falar por falta de coragem?\n\nO que você queria dizer então,\ne por que era tão assustador pronunciar essas palavras?",
                followUpQuestion: "Se você pudesse falar essas palavras novamente agora,\ncom o que começaria?\n\nE essas palavras são algo que você precisa ouvir de si mesmo?",
                lightTitle: "Palavra de Luz",
                lightMessage: "O você atual se tornou forte o suficiente para pedir desculpas ao seu eu do passado. Essa é a verdadeira coragem.\nDesculpas nunca são tarde demais para ninguém. Nem mesmo para você mesmo. Você começou isso agora.\nVerdadeira coragem é se ajoelhar diante de palavras passadas. E acreditar que você pode começar de novo.",
                navigationTitle: "Portal 23 Completo",
                navigationMessage: "Você fez as pazes com aquele momento quando lhe faltou coragem e se tornou alguém que pode expressar emoções honestamente.\n\nAo entender aquele momento quando você não conseguiu falar, agora encontrou a coragem para expressar seus verdadeiros sentimentos.\n\nVocê ganhou a força para se comunicar com um coração honesto, não mais escondendo emoções por orgulho ou medo.",
                nextPortalBtn: "Continuar para Portal 24",
                stayPortalBtn: "Ficar com esta coragem",
                inputPlaceholder: "Houve um momento quando você não teve coragem para falar? O que queria dizer e por que era tão assustador?",
                youLabel: "Você",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "🧑‍🦱", text: {
                ko: "그 감정은 이미 말이 되었었어. 다만, 목소리가 나지 않았을 뿐이야. 너는 느끼고 있었잖아.",
                en: "That emotion had already become words. It's just that your voice couldn't come out. You were feeling it though.",
                pt: "Essa emoção já havia se tornado palavras. É só que sua voz não conseguiu sair. Você estava sentindo isso, no entanto."
            }},
            { name: "Ely", emoji: "🧝‍♀️", text: {
                ko: "용기가 없었던 게 아니야. 그만큼 그 관계가 소중해서, 상처 줄까 봐 두려웠던 거야.",
                en: "It wasn't that you lacked courage. That relationship was so precious to you that you were afraid of hurting it.",
                pt: "Não foi que você não teve coragem. Esse relacionamento era tão precioso para você que tinha medo de machucá-lo."
            }},
            { name: "Sora", emoji: "🧕", text: {
                ko: "말하지 못한 감정은 마음 안에서 오래 머물러요. 그건 후회가 아니라, 아직 꺼내지 못한 사랑이에요.",
                en: "Emotions that couldn't be spoken linger in the heart for a long time. That's not regret, but love that hasn't been expressed yet.",
                pt: "Emoções que não puderam ser faladas permanecem no coração por muito tempo. Isso não é arrependimento, mas amor que ainda não foi expresso."
            }},
            { name: "Kael", emoji: "🧙", text: {
                ko: "용기란, 말했을 때만이 아니라 지금이라도 다시 말할 수 있을 때 진짜로 증명되는 거야.",
                en: "Courage is truly proven not only when you speak, but when you can speak again even now.",
                pt: "A coragem é verdadeiramente provada não apenas quando você fala, mas quando pode falar novamente mesmo agora."
            }},
            { name: "Mira", emoji: "🧑‍🎨", text: {
                ko: "그 한마디가 너를 묶어두고 있었구나. 그건 지금 너의 눈빛에도 남아 있어.",
                en: "Those words were binding you. That's still remaining in your eyes now.",
                pt: "Essas palavras estavam te amarrando. Isso ainda permanece em seus olhos agora."
            }},
            { name: "Cris", emoji: "🦸‍♂️", text: {
                ko: "왜 우리는 먼저 말하는 걸 '지는 것'처럼 여겼을까? 진짜 용기는, 먼저 다가가는 사람이 갖고 있는 거야.",
                en: "Why did we think speaking first was like 'losing'? True courage belongs to the person who approaches first.",
                pt: "Por que pensávamos que falar primeiro era como 'perder'? A verdadeira coragem pertence à pessoa que se aproxima primeiro."
            }},
            { name: "Enya", emoji: "🧑‍🚀", text: {
                ko: "그 말을 꺼낼 수 없던 순간에도 너는 마음으로 계속 말하고 있었어. 지금도 그 마음은 사라지지 않았어.",
                en: "Even in moments when you couldn't speak those words, you kept saying them in your heart. That heart hasn't disappeared even now.",
                pt: "Mesmo nos momentos em que você não conseguia falar essas palavras, você continuava dizendo-as em seu coração. Esse coração não desapareceu nem agora."
            }},
            { name: "Lian", emoji: "🧘", text: {
                ko: "지금 너는, 과거의 너가 끝내 꺼내지 못했던 말을 마음속에서 복원하고 있어요. 그것이 성장이에요.",
                en: "Right now, you are restoring in your heart the words that your past self couldn't finally bring out. That is growth.",
                pt: "Agora, você está restaurando em seu coração as palavras que seu eu do passado não conseguiu finalmente expressar. Isso é crescimento."
            }}
        ];

        const responseCharacters = [
            {
                name: "Ely", emoji: "🧝‍♀️",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "지금의 너는, 과거의 자신에게 사과할 수 있을 만큼 단단해졌어요. 그것이 진짜 용기예요.",
                        en: "The current you has become strong enough to apologize to your past self. That is true courage.",
                        pt: "O você atual se tornou forte o suficiente para pedir desculpas ao seu eu do passado. Essa é a verdadeira coragem."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Lian", emoji: "🧘",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "사과는 누구에게도 늦지 않아요. 자신에게조차. 당신은 지금 그것을 시작했어요.",
                        en: "Apologies are never too late for anyone. Even to yourself. You have started that now.",
                        pt: "Desculpas nunca são tarde demais para ninguém. Nem mesmo para você mesmo. Você começou isso agora."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Kael", emoji: "🧙",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "진짜 용기는 지나간 말 앞에 무릎 꿇는 것. 그리고 다시 시작할 수 있다는 믿음이야.",
                        en: "True courage is kneeling before past words. And believing that you can start again.",
                        pt: "Verdadeira coragem é se ajoelhar diante de palavras passadas. E acreditar que você pode começar de novo."
                    };
                    return responses[lang];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        let awaitingSecondResponse = false;
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('navigationTitle').textContent = translations[lang].navigationTitle;
            document.getElementById('nextPortalBtn').textContent = translations[lang].nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = translations[lang].stayPortalBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
            awaitingSecondResponse = false;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                localStorage.setItem('temarix_v4_portal23_complete', 'true');
                localStorage.setItem('temarix_v4_current_portal', '24');
                
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 24: 잃어버린 이름 하나로 이동합니다.' :
                    currentLanguage === 'en' ? 
                    'Moving to Portal 24: One Lost Name.' :
                    'Indo para Portal 24: Um Nome Perdido.';
                alert(nextMessage);
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const stayMessage = currentLanguage === 'ko' ? 
                    '이 용기와 더 머물며 깊이 성찰하시겠습니까?' :
                    currentLanguage === 'en' ? 
                    'Do you want to stay longer with this courage for deeper reflection?' :
                    'Deseja ficar mais tempo com esta coragem para reflexão mais profunda?';
                
                if (confirm(stayMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            console.log('Processing user input:', inputText);
            localStorage.setItem('temarix_v4_portal23_response', JSON.stringify({
                portal: "v4-23",
                resposta: inputText,
                step: awaitingSecondResponse ? "second" : "first",
                data: new Date().toISOString(),
                idioma: currentLanguage
            }));
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const secondResponseCharacters = [
                {
                    name: "Noah", emoji: "🧑‍🦱",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "그 말은 끝이 아니라 시작이에요. 이제 당신은 새로운 대화를 시작할 수 있어요.",
                            en: "Those words aren't an ending but a beginning. Now you can start new conversations.",
                            pt: "Essas palavras não são um fim, mas um começo. Agora você pode começar novas conversas."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Mira", emoji: "🧑‍🎨",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "용기는 완벽한 말이 아니라, 진심을 꺼내려는 노력에서 시작돼요.",
                            en: "Courage doesn't start from perfect words, but from the effort to bring out sincerity.",
                            pt: "A coragem não começa de palavras perfeitas, mas do esforço de trazer para fora a sinceridade."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Enya", emoji: "🧑‍🚀",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "당신이 써내려간 그 말들이, 앞으로의 모든 대화를 용기 있게 만들 거예요.",
                            en: "Those words you've written will make all future conversations courageous.",
                            pt: "Essas palavras que você escreveu tornarão todas as conversas futuras corajosas."
                        };
                        return responses[lang];
                    }
                }
            ];
            
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < secondResponseCharacters.length; i++) {
                const char = secondResponseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < secondResponseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V4 Portal 23 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V4 Portal 23 DOM loaded');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>