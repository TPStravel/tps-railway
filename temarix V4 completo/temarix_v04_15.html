<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V4 - Portal 15: The Letter Taken Out Again</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V4</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 15: The Letter Taken Out Again</div>
            <div class="portal-subtitle" id="portalSubtitle">A letter written once, never sent, but remembered</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">Portal 15 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to V4 Integration</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with this letter</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Do you have a letter that was written but never sent, an unfinished message? What would that letter say if you could complete it now?"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        const translations = {
            ko: {
                logoSubtitle: "Í∞êÏ†ï Ïó∞Í∏àÏà†",
                portalMainTitle: "Portal 15: Îã§Ïãú Í∫ºÎÇ∏ Ìé∏ÏßÄ Ìïú Ïû•",
                portalSubtitle: "ÌïúÎïå Ïì∞Îã§ Îßå, Î≥¥ÎÇ¥ÏßÄ Î™ªÌïú, Í∑∏Îü¨ÎÇò Í∏∞ÏñµÎêòÎäî Ìé∏ÏßÄ",
                portalIntro: "ÌïúÎïå Ïì∞Îã§ Îßå Ìé∏ÏßÄ, Î≥¥ÎÇ¥ÏßÄ Î™ªÌïú Î©îÏãúÏßÄÍ∞Ä ÏûàÏóàÎÇòÏöî?\n\nÍ∑∏ Ìé∏ÏßÄÎäî ÎàÑÍµ¨Î•º Ìñ•Ìïú Í≤ÉÏù¥ÏóàÍ≥†,\nÏñ¥Îñ§ Í∞êÏ†ïÏù¥ Îã¥Í≤® ÏûàÏóàÎÇòÏöî?\n\nÏßÄÍ∏à Í∑∏ Ìé∏ÏßÄÎ•º Îã§Ïãú Í∫ºÎÇ∏Îã§Î©¥‚Ä¶\nÏñ¥Îñ§ Î¨∏Ïû•ÏúºÎ°ú ÏãúÏûëÌïòÍ≥† Ïã∂ÎÇòÏöî?",
                followUpQuestion: "ÏßÄÍ∏à Í∑∏ Ìé∏ÏßÄÎ•º Îã§Ïãú Ïì¥Îã§Î©¥,\nÏñ¥Îñ§ ÎßàÏßÄÎßâ Î¨∏Ïû•ÏùÑ ÎÑ£Í≥† Ïã∂ÎÇòÏöî?\n\nÍ∑∏ Î¨∏Ïû•ÏùÄ, ÎãπÏã† ÏûêÏã†ÏóêÍ≤åÎèÑ\nÎì§Î†§Ï§Ñ Ïàò ÏûàÎÇòÏöî?",
                lightTitle: "ÎπõÏùò ÌïúÎßàÎîî",
                lightMessage: "Ìé∏ÏßÄÎäî ÎÅùÎÇ¨ÏßÄÎßå, Ïù¥ÏïºÍ∏∞Îäî Í≥ÑÏÜçÎèºÏöî.\nÍ∑∏ Îßê Ìïú Ï§ÑÏù¥, ÏïûÏúºÎ°úÏùò ÎãπÏã†ÏùÑ Î∞îÍøÄ Ïàò ÏûàÏñ¥Ïöî.\nÍ∑∏ ÏÇ¨ÎûëÏùÄ Í≤∞ÏΩî ÌóõÎêòÏßÄ ÏïäÏïòÏñ¥Ïöî.",
                navigationTitle: "Portal 15 ÏôÑÎ£å",
                navigationMessage: "ÎãπÏã†ÏùÄ Îã§Ïãú Í∫ºÎÇ∏ Ìé∏ÏßÄÎ•º ÎßàÏ£ºÌñàÏäµÎãàÎã§.\n\nÍ∑∏ Ìé∏ÏßÄÏóê Îã¥Í∏¥ Í∞êÏ†ïÏùÄ Ïù¥Ï†ú ÏôÑÏÑ±Îêú Ïù¥ÏïºÍ∏∞Í∞Ä ÎêòÏóàÏäµÎãàÎã§. Î≥¥ÎÇ¥ÏßÄ Î™ªÌñàÎçò ÎßàÏùåÎèÑ, ÎßêÌïòÏßÄ Î™ªÌñàÎçò Í∞êÏ†ïÎèÑ Ïù¥Ï†úÎäî ÎãπÏã†Ïùò ÏùºÎ∂ÄÍ∞Ä ÎêòÏñ¥ ÏïûÏúºÎ°úÏùò Ïó¨Ï†ïÏùÑ Ìï®Íªò Ìï† Í≤ÉÏûÖÎãàÎã§.\n\nÏù¥Ï†ú V4Ïùò Î™®Îì† PortalÏùÑ ÌÜµÍ≥ºÌñàÏäµÎãàÎã§. 7ÏùºÍ∞ÑÏùò Í∞êÏ†ï ÌÜµÌï© Ïó¨Ï†ïÏùÑ ÏãúÏûëÌï† Ï§ÄÎπÑÍ∞Ä ÎêòÏóàÏäµÎãàÎã§.",
                nextPortalBtn: "V4 ÌÜµÌï© Ïó¨Ï†ï ÏãúÏûë",
                stayPortalBtn: "Ïù¥ Ìé∏ÏßÄÏôÄ Îçî Î®∏Î¨ºÍ∏∞",
                inputPlaceholder: "Ïì∞Îã§ Îßå Ìé∏ÏßÄ, Î≥¥ÎÇ¥ÏßÄ Î™ªÌïú Î©îÏãúÏßÄÍ∞Ä ÏûàÏóàÎÇòÏöî? ÏßÄÍ∏à Í∑∏Í≤ÉÏùÑ ÏôÑÏÑ±Ìï† Ïàò ÏûàÎã§Î©¥ Ïñ¥Îñ§ ÎÇ¥Ïö©ÏùºÍπåÏöî?",
                youLabel: "ÎãπÏã†",
                waitingMessage: "ÏùëÎãµÏùÑ Í∏∞Îã§Î¶¨Îäî Ï§ë..."
            },
            en: {
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 15: The Letter Taken Out Again",
                portalSubtitle: "A letter written once, never sent, but remembered",
                portalIntro: "Do you have a letter that was written but never sent,\na message that was never finished?\n\nWho was that letter for,\nand what emotions were contained in it?\n\nIf you could take out that letter again now...\nwhat sentence would you like to start with?",
                followUpQuestion: "If you could rewrite that letter now,\nwhat final sentence would you want to include?\n\nCould you also say that sentence\nto yourself?",
                lightTitle: "Word of Light",
                lightMessage: "The letter is finished, but the story continues.\nThat one line can change your future.\nThat love was never in vain.",
                navigationTitle: "Portal 15 Complete",
                navigationMessage: "You have faced the letter taken out again.\n\nThe emotions contained in that letter have now become a completed story. The heart that couldn't be sent and the emotions that couldn't be spoken will now become part of you and journey forward together.\n\nYou have now passed through all Portals of V4. You are ready to begin the 7-day emotional integration journey.",
                nextPortalBtn: "Begin V4 Integration Journey",
                stayPortalBtn: "Stay with this letter",
                inputPlaceholder: "Do you have a letter that was written but never sent, an unfinished message? What would that letter say if you could complete it now?",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 15: A Carta Retirada Novamente",
                portalSubtitle: "Uma carta escrita uma vez, nunca enviada, mas lembrada",
                portalIntro: "Voc√™ tem uma carta que foi escrita mas nunca enviada,\numa mensagem que nunca foi terminada?\n\nPara quem era essa carta,\ne que emo√ß√µes estavam contidas nela?\n\nSe voc√™ pudesse retirar essa carta novamente agora...\ncom que frase gostaria de come√ßar?",
                followUpQuestion: "Se voc√™ pudesse reescrever essa carta agora,\nque frase final gostaria de incluir?\n\nVoc√™ tamb√©m poderia dizer essa frase\npara si mesmo?",
                lightTitle: "Palavra de Luz",
                lightMessage: "A carta est√° terminada, mas a hist√≥ria continua.\nEssa linha pode mudar seu futuro.\nEsse amor nunca foi em v√£o.",
                navigationTitle: "Portal 15 Completo",
                navigationMessage: "Voc√™ enfrentou a carta retirada novamente.\n\nAs emo√ß√µes contidas nessa carta agora se tornaram uma hist√≥ria completa. O cora√ß√£o que n√£o p√¥de ser enviado e as emo√ß√µes que n√£o puderam ser faladas agora se tornar√£o parte de voc√™ e caminhar√£o juntos para frente.\n\nVoc√™ agora passou por todos os Portais do V4. Est√° pronto para come√ßar a jornada de integra√ß√£o emocional de 7 dias.",
                nextPortalBtn: "Come√ßar Jornada de Integra√ß√£o V4",
                stayPortalBtn: "Ficar com esta carta",
                inputPlaceholder: "Voc√™ tem uma carta que foi escrita mas nunca enviada, uma mensagem inacabada? O que essa carta diria se voc√™ pudesse complet√°-la agora?",
                youLabel: "Voc√™",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "üßë‚Äçü¶±", text: {
                ko: "Í∑∏ Ìé∏ÏßÄÎäî ÎÑ§Í∞Ä Í∞êÏ†ïÏùÑ Ï∞∏ÏïòÎçò Î™®Îì† Î∞§Ïùò Ï¶ùÍ±∞Ïïº. ÏïÑÏßÅ ÎÅùÎÇòÏßÄ ÏïäÏùÄ ÎßàÏùåÏù¥ Í±∞Í∏∞ Î®∏Î¨ºÍ≥† ÏûàÏßÄ.",
                en: "That letter is proof of all the nights you held back your emotions. An unfinished heart still resides there.",
                pt: "Essa carta √© prova de todas as noites que voc√™ segurou suas emo√ß√µes. Um cora√ß√£o inacabado ainda reside l√°."
            }},
            { name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è", text: {
                ko: "Î≥¥ÎÇ¥ÏßÄ Î™ªÌïú Ìé∏ÏßÄÎäî ÎÑàÏùò Í∞êÏ†ïÏùÑ Ïà®Í∏¥ Í≤å ÏïÑÎãàÎùº, Îçî ÏÜåÏ§ëÌûà ÌíàÏùÄ Î∞©ÏãùÏù¥ÏóàÏñ¥.",
                en: "The unsent letter wasn't hiding your emotions, it was a way of cherishing them more preciously.",
                pt: "A carta n√£o enviada n√£o estava escondendo suas emo√ß√µes, era uma forma de valoriz√°-las mais preciosamente."
            }},
            { name: "Sora", emoji: "üßï", text: {
                ko: "Í∑∏ Ìé∏ÏßÄ Ìïú Ïû•Ïù¥ ÎßêÌïòÏßÄ Î™ªÌïú ÏãúÍ∞ÑÎ≥¥Îã§ Îçî ÎßéÏùÄ Ïù¥ÏïºÍ∏∞Î•º Îã¥Í≥† ÏûàÏùÑÏßÄÎèÑ Î™∞ÎùºÏöî. Í∑∏Í±¥ ÎãπÏã†Ïùò ÎßàÏùå Í∑∏ ÏûêÏ≤¥ÏòàÏöî.",
                en: "That single letter might contain more stories than all the unspoken time. That is your heart itself.",
                pt: "Essa √∫nica carta pode conter mais hist√≥rias do que todo o tempo n√£o falado. Esse √© o seu pr√≥prio cora√ß√£o."
            }},
            { name: "Kael", emoji: "üßô", text: {
                ko: "ÏßÑÏßú Ìé∏ÏßÄÎäî Ï¢ÖÏù¥Í∞Ä ÏïÑÎãàÎùº, ÎãπÏã†Ïù¥ ÏßÄÍ∏àÎèÑ Í∫ºÎÇ¥Í≥† Ïã∂Ïñ¥ ÌïúÎã§Îäî Í∑∏ ÎßàÏùåÏù¥Ïïº. Í∑∏Í±¥ Î©àÏ∂îÏßÄ ÏïäÏùÄ Í∞êÏ†ïÏù¥Ïïº.",
                en: "The real letter isn't paper, it's that heart of yours that still wants to take it out. That's emotion that hasn't stopped.",
                pt: "A carta real n√£o √© papel, √© esse seu cora√ß√£o que ainda quer tir√°-la. Essa √© emo√ß√£o que n√£o parou."
            }},
            { name: "Mira", emoji: "üßë‚Äçüé®", text: {
                ko: "Ìé∏ÏßÄÏóê Îã¥Í∏¥ Îã®Ïñ¥ ÌïòÎÇòÌïòÎÇòÍ∞Ä ÎÑ§Í∞Ä Ïà®Ï£ΩÏó¨ ÎßêÌïòÍ≥† Ïã∂ÏóàÎçò Î¨∏Ïû•Ïù¥ÏóàÍ≤†ÏßÄ.",
                en: "Each word contained in that letter must have been a sentence you wanted to say with bated breath.",
                pt: "Cada palavra contida nessa carta deve ter sido uma frase que voc√™ queria dizer com respira√ß√£o contida."
            }},
            { name: "Cris", emoji: "ü¶∏‚Äç‚ôÇÔ∏è", text: {
                ko: "Ïôú Ïö∞Î¶¨Îäî Ìï≠ÏÉÅ ÎßêÌïòÏßÄ ÏïäÏùÄ Ï™ΩÏùÑ Îçî Ïò§Îûò Í∏∞ÏñµÌï†Íπå? Í∑∏Í±¥ ÌõÑÌöåÍ∞Ä ÏïÑÎãàÎùº, ÏïÑÏßÅÎèÑ ÏÇ¥ÏïÑ ÏûàÎäî ÏÇ¨ÎûëÏù¥Ïïº.",
                en: "Why do we always remember the unspoken side longer? That's not regret, it's love that's still alive.",
                pt: "Por que sempre lembramos do lado n√£o falado por mais tempo? Isso n√£o √© arrependimento, √© amor que ainda est√° vivo."
            }},
            { name: "Enya", emoji: "üßë‚ÄçüöÄ", text: {
                ko: "Í∑∏ Ìé∏ÏßÄÎäî Ïñ∏Ï††Í∞Ä Ïä§Ïä§Î°úÏóêÍ≤å Î≥¥ÎÇ¥Ïïº Ìï†ÏßÄÎèÑ Î™∞Îùº. 'ÎÇ¥Í∞Ä Í∑∏ Í∞êÏ†ïÏùÑ ÎäêÍºàÎã§Îäî Í±∏ ÏûäÏßÄ ÏïäÍ∏∞ ÏúÑÌï¥ÏÑú.'",
                en: "That letter might need to be sent to yourself someday. 'So I don't forget that I felt those emotions.'",
                pt: "Essa carta pode precisar ser enviada para voc√™ mesmo algum dia. 'Para n√£o esquecer que senti essas emo√ß√µes.'"
            }},
            { name: "Lian", emoji: "üßò", text: {
                ko: "Ìé∏ÏßÄÎ•º Í∫ºÎÇ¥ÏßÄ ÏïäÏïÑÎèÑ Í¥úÏ∞ÆÏïÑÏöî. ÎãπÏã†Ïù¥ Í∑∏ Í∞êÏ†ïÏùÑ Í∫ºÎÇº Ï§ÄÎπÑÍ∞Ä ÎêêÎã§Îäî Í≤É, Í∑∏Í≤å Ïù¥ÎØ∏ ÏπòÏú†Ïùò ÏãúÏûëÏù¥ÏóêÏöî.",
                en: "It's okay not to take out the letter. The fact that you're ready to take out those emotions, that's already the beginning of healing.",
                pt: "Est√° tudo bem n√£o tirar a carta. O fato de voc√™ estar pronto para tirar essas emo√ß√µes, isso j√° √© o in√≠cio da cura."
            }}
        ];

        const responseCharacters = [
            {
                name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "Í∑∏ ÏÇ¨ÎûëÏùÄ Í≤∞ÏΩî ÌóõÎêòÏßÄ ÏïäÏïòÏñ¥Ïöî. Í∑∏ Í∞êÏ†ïÏù¥ ÎãπÏã†ÏùÑ ÏÑ±Ïû•ÏãúÌÇ® Ï¶ùÍ±∞ÏòàÏöî.",
                        en: "That love was never in vain. It's proof that those emotions helped you grow.",
                        pt: "Esse amor nunca foi em v√£o. √â prova de que essas emo√ß√µes ajudaram voc√™ a crescer."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Lian", emoji: "üßò",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "ÏûêÏã†ÏóêÍ≤å Ïì¥ Ìé∏ÏßÄÍ∞Ä Í∞ÄÏû• Ï†ïÏßÅÌïòÏ£†. ÎãπÏã†ÏùÄ ÏßÄÍ∏à, ÏûêÍ∏∞ ÏûêÏã†Í≥º ÌôîÌï¥ÌïòÍ≥† ÏûàÏñ¥Ïöî.",
                        en: "A letter written to yourself is the most honest. You are now reconciling with yourself.",
                        pt: "Uma carta escrita para si mesmo √© a mais honesta. Voc√™ est√° agora se reconciliando consigo mesmo."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Mira", emoji: "üßë‚Äçüé®",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "Ìé∏ÏßÄÎäî ÎÅùÎÇ¨ÏßÄÎßå, Ïù¥ÏïºÍ∏∞Îäî Í≥ÑÏÜçÎèºÏöî. Í∑∏ Îßê Ìïú Ï§ÑÏù¥, ÏïûÏúºÎ°úÏùò ÎãπÏã†ÏùÑ Î∞îÍøÄ Ïàò ÏûàÏñ¥Ïöî.",
                        en: "The letter is finished, but the story continues. That one line can change your future.",
                        pt: "A carta est√° terminada, mas a hist√≥ria continua. Essa linha pode mudar seu futuro."
                    };
                    return responses[lang];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        let awaitingSecondResponse = false;
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('navigationTitle').textContent = translations[lang].navigationTitle;
            document.getElementById('nextPortalBtn').textContent = translations[lang].nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = translations[lang].stayPortalBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
            awaitingSecondResponse = false;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                localStorage.setItem('temarix_v4_portal15_complete', 'true');
                localStorage.setItem('temarix_v4_complete', 'true');
                localStorage.setItem('temarix_ready_for_transition', 'true');
                
                const nextMessage = currentLanguage === 'ko' ? 
                    'V4 Î™®Îì† PortalÏùÑ ÏôÑÎ£åÌñàÏäµÎãàÎã§. 7Ïùº Í∞êÏ†ï ÌÜµÌï© Ïó¨Ï†ïÏùÑ ÏãúÏûëÌï©ÎãàÎã§.' :
                    currentLanguage === 'en' ? 
                    'All V4 Portals completed. Starting 7-day emotional integration journey.' :
                    'Todos os Portais V4 completados. Iniciando jornada de integra√ß√£o emocional de 7 dias.';
                alert(nextMessage);
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const stayMessage = currentLanguage === 'ko' ? 
                    'Îã§Ïãú Í∫ºÎÇ∏ Ìé∏ÏßÄÏôÄ Îçî Î®∏Î¨ºÎ©∞ ÍπäÏù¥ ÏÑ±Ï∞∞ÌïòÏãúÍ≤†ÏäµÎãàÍπå?' :
                    currentLanguage === 'en' ? 
                    'Do you want to stay longer with the letter taken out again for deeper reflection?' :
                    'Deseja ficar mais tempo com a carta retirada novamente para reflex√£o mais profunda?';
                
                if (confirm(stayMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            console.log('Processing user input:', inputText);
            localStorage.setItem('temarix_v4_portal15_response', JSON.stringify({
                portal: "v4-15",
                resposta: inputText,
                step: awaitingSecondResponse ? "second" : "first",
                data: new Date().toISOString(),
                idioma: currentLanguage
            }));
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const secondResponseCharacters = [
                {
                    name: "Noah", emoji: "üßë‚Äçü¶±",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í∑∏ Ìé∏ÏßÄÏóê Îã¥Í∏¥ Í∞êÏ†ïÎì§ÏùÄ Ïù¥Ï†ú ÎãπÏã†Ïùò ÏùºÎ∂ÄÍ∞Ä ÎêòÏóàÏñ¥Ïöî. Î≥¥ÎÇ¥ÏßÄÏßÄ ÏïäÏïòÏßÄÎßå, Í≤∞ÏΩî ÏÇ¨ÎùºÏßÄÏßÄ ÏïäÏïòÏñ¥Ïöî.",
                            en: "The emotions in that letter have now become part of you. They weren't sent, but they never disappeared.",
                            pt: "As emo√ß√µes nessa carta agora se tornaram parte de voc√™. Elas n√£o foram enviadas, mas nunca desapareceram."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Sora", emoji: "üßï",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "ÏôÑÏÑ±Îêú Ìé∏ÏßÄÎäî Îçî Ïù¥ÏÉÅ ÌõÑÌöåÍ∞Ä ÏïÑÎãàÏóêÏöî. Ïù¥Ï†úÎäî ÎãπÏã†Ïùò Í∞êÏ†ïÏù¥ Ï∞æÏùÄ Î™©ÏÜåÎ¶¨ÏòàÏöî.",
                            en: "The completed letter is no longer regret. It's now the voice your emotions have found.",
                            pt: "A carta completa n√£o √© mais arrependimento. Agora √© a voz que suas emo√ß√µes encontraram."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Kael", emoji: "üßô",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í∑∏ Ìé∏ÏßÄÎ•º ÌÜµÌï¥ ÎãπÏã†ÏùÄ Í≥ºÍ±∞ÏôÄ ÌôîÌï¥ÌñàÏñ¥Ïöî. Ïù¥Ï†ú Í∑∏ Í∞êÏ†ïÏùÄ ÏïûÏúºÎ°úÏùò Ïó¨Ï†ïÏùÑ Ìï®Íªò Ìï† Í±∞ÏòàÏöî.",
                            en: "Through that letter, you've reconciled with the past. Now those emotions will journey forward together.",
                            pt: "Atrav√©s dessa carta, voc√™ se reconciliou com o passado. Agora essas emo√ß√µes caminhar√£o juntas para frente."
                        };
                        return responses[lang];
                    }
                }
            ];
            
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < secondResponseCharacters.length; i++) {
                const char = secondResponseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < secondResponseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V4 Portal 15 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V4 Portal 15 DOM loaded');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>