<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V4 - Portal 17: Walking Back Into The Scene</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V4</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 17: Walking Back Into The Scene</div>
            <div class="portal-subtitle" id="portalSubtitle">Revisiting that moment</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">Portal 17 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 18</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with this scene</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Is there a scene from your past that you want to walk through again? What feelings would you bring this time?"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        const translations = {
            ko: {
                logoSubtitle: "Í∞êÏ†ï Ïó∞Í∏àÏà†",
                portalMainTitle: "Portal 17: Îã§Ïãú Í±∑Îäî Ïû•Î©¥ ÏÜçÏúºÎ°ú",
                portalSubtitle: "Í∑∏ ÏàúÍ∞ÑÏùÑ Îã§Ïãú Í±∏Ïñ¥Î≥¥Í∏∞",
                portalIntro: "ÏòàÏ†ÑÏùò Ïñ¥Îäê Ïû•Î©¥ ÏÜçÏúºÎ°ú,\nÎã§Ïãú Îì§Ïñ¥Í∞Ä Í±∑Í≥† Ïã∂ÏùÄ ÏàúÍ∞ÑÏù¥ ÏûàÎÇòÏöî?\n\nÍ∑∏ Ïû•Î©¥ÏóêÏÑú ÎãπÏã†ÏùÄ Î¨¥ÏóáÏùÑ ÎäêÎÅºÍ≥† ÏûàÏóàÍ≥†,\nÏßÄÍ∏à Îã§Ïãú Í±∑ÎäîÎã§Î©¥ Ïñ¥Îñ§ Í∞êÏ†ïÏúºÎ°ú ÎßàÏ£ºÌïòÍ≥† Ïã∂ÎÇòÏöî?",
                followUpQuestion: "Í∑∏ Ïû•Î©¥ÏùÑ Îã§Ïãú Í±∑ÎäîÎã§Î©¥,\nÎãπÏã†ÏùÄ Ïñ¥Îñ§ ÎßàÏùåÏùÑ ÌíàÍ≥† Ïã∂ÎÇòÏöî?\n\nÍ∑∏ ÏàúÍ∞ÑÏùò ÎãπÏã†ÏóêÍ≤å Ïñ¥Îñ§ ÎßêÏùÑ Í±¥ÎÑ§Í≥† Ïã∂ÎÇòÏöî?",
                lightTitle: "ÎπõÏùò ÌïúÎßàÎîî",
                lightMessage: "Í≥ºÍ±∞ÏôÄ ÌòÑÏû¨Ïùò Í∞êÏ†ïÏùÑ Ìï®Íªò Íª¥ÏïàÏùÄ ÎãπÏã†.\nÎã§Ïãú Í±∑ÎäîÎã§Îäî Í±¥ Í≥ºÍ±∞Î•º Î∞îÍæ∏Îäî Í≤å ÏïÑÎãàÎùº, ÌòÑÏû¨Î•º ÏπòÏú†ÌïòÎäî ÏùºÏù¥ÏóêÏöî.\nÍ∑∏ Í∏∏ÏùÄ Í≥ÑÏÜç Ïù¥Ïñ¥Ïßà Í±∞ÏòàÏöî.",
                navigationTitle: "Portal 17 ÏôÑÎ£å",
                navigationMessage: "ÎãπÏã†ÏùÄ Í≥ºÍ±∞Ïùò Ïû•Î©¥ ÏÜçÏúºÎ°ú Îã§Ïãú Í±∏Ïñ¥Í∞îÏäµÎãàÎã§.\n\nÍ∑∏ ÏàúÍ∞ÑÏùÑ Îã§Ïãú ÎßàÏ£ºÌï† Ïàò ÏûàÎäî Ïö©Í∏∞, Í∑∏Î¶¨Í≥† ÌòÑÏû¨Ïùò ÏãúÏÑ†ÏúºÎ°ú Í∑∏ Í∞êÏ†ïÏùÑ ÌíàÏùÑ Ïàò ÏûàÎäî ÏÑ±ÏàôÌï®ÏùÑ Î≥¥Ïó¨Ï£ºÏóàÏäµÎãàÎã§.\n\nÏù¥Ï†ú ÎãπÏã†ÏùÄ Í≥ºÍ±∞ÏôÄ ÌòÑÏû¨Î•º Ìï®Íªò ÏïàÍ≥† Îã§Ïùå Ïó¨Ï†ïÏúºÎ°ú ÎÇòÏïÑÍ∞à Ïàò ÏûàÏäµÎãàÎã§.",
                nextPortalBtn: "Portal 18Î°ú Ïù¥Ïñ¥Í∞ÄÍ∏∞",
                stayPortalBtn: "Ïù¥ Ïû•Î©¥Í≥º Îçî Î®∏Î¨ºÍ∏∞",
                inputPlaceholder: "Í≥ºÍ±∞Ïùò Ïñ¥Îñ§ Ïû•Î©¥ÏùÑ Îã§Ïãú Í±∏Ïñ¥Î≥¥Í≥† Ïã∂ÎÇòÏöî? Ïù¥Î≤àÏóî Ïñ¥Îñ§ Í∞êÏ†ïÏúºÎ°ú ÎßàÏ£ºÌïòÍ≥† Ïã∂ÎÇòÏöî?",
                youLabel: "ÎãπÏã†",
                waitingMessage: "ÏùëÎãµÏùÑ Í∏∞Îã§Î¶¨Îäî Ï§ë..."
            },
            en: {
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 17: Walking Back Into The Scene",
                portalSubtitle: "Revisiting that moment",
                portalIntro: "Is there a scene from your past\nthat you want to walk back into?\n\nWhat were you feeling in that scene,\nand if you walked through it again now,\nwhat emotions would you bring to face it?",
                followUpQuestion: "If you could walk through that scene again,\nwhat kind of heart would you want to carry?\n\nWhat would you say\nto yourself in that moment?",
                lightTitle: "Word of Light",
                lightMessage: "You who embraced both past and present emotions together.\nWalking back doesn't change the past, it heals the present.\nThat path will continue to unfold.",
                navigationTitle: "Portal 17 Complete",
                navigationMessage: "You have walked back into a scene from your past.\n\nYou showed the courage to face that moment again, and the maturity to embrace those emotions with your present perspective.\n\nNow you can move forward to the next journey, carrying both past and present together.",
                nextPortalBtn: "Continue to Portal 18",
                stayPortalBtn: "Stay with this scene",
                inputPlaceholder: "Is there a scene from your past that you want to walk through again? What feelings would you bring this time?",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 17: Caminhando de Volta Para a Cena",
                portalSubtitle: "Revisitando aquele momento",
                portalIntro: "H√° alguma cena do seu passado\nna qual voc√™ gostaria de voltar a caminhar?\n\nO que voc√™ estava sentindo naquela cena,\ne se caminhasse por ela novamente agora,\nque emo√ß√µes voc√™ traria para enfrent√°-la?",
                followUpQuestion: "Se voc√™ pudesse caminhar por aquela cena novamente,\nque tipo de cora√ß√£o voc√™ gostaria de carregar?\n\nO que voc√™ diria\npara si mesmo naquele momento?",
                lightTitle: "Palavra de Luz",
                lightMessage: "Voc√™ que abra√ßou as emo√ß√µes do passado e do presente juntas.\nVoltar a caminhar n√£o muda o passado, cura o presente.\nEsse caminho continuar√° a se desenrolar.",
                navigationTitle: "Portal 17 Completo",
                navigationMessage: "Voc√™ caminhou de volta para uma cena do seu passado.\n\nVoc√™ mostrou a coragem de enfrentar aquele momento novamente, e a maturidade de abra√ßar essas emo√ß√µes com sua perspectiva presente.\n\nAgora voc√™ pode seguir para a pr√≥xima jornada, carregando passado e presente juntos.",
                nextPortalBtn: "Continuar para Portal 18",
                stayPortalBtn: "Ficar com esta cena",
                inputPlaceholder: "H√° alguma cena do seu passado pela qual voc√™ quer caminhar novamente? Que sentimentos voc√™ traria desta vez?",
                youLabel: "Voc√™",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "üßë‚Äçü¶±", text: {
                ko: "Í∑∏ Ïó¨Î¶ÑÎ∞§Ïùò ÎÑàÎäî ÏïÑÏßÅ ÎÑà ÏïàÏóê ÏûàÏñ¥. Îã®ÏßÄ, Ïû†Ïãú ÏûäÍ≥† ÏûàÏóàÎçò Í±∞Ïïº.",
                en: "That summer night version of you is still inside you. You've just forgotten it for a while.",
                pt: "Aquela vers√£o sua da noite de ver√£o ainda est√° dentro de voc√™. Voc√™ apenas a esqueceu por um tempo."
            }},
            { name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è", text: {
                ko: "Í∑∏ÎïåÏùò Î∞úÍ±∏ÏùåÏóî ÎëêÎ†§ÏõÄÎèÑ, Ìù¨ÎßùÎèÑ ÏûàÏóàÏßÄ. ÌïòÏßÄÎßå Í∑∏ ÌòºÌï©Ïù¥ÏïºÎßêÎ°ú ÏßÑÏßú ÏÇ¥ÏïÑ ÏûàÎäî Ï¶ùÍ±∞ÏòÄÏñ¥.",
                en: "Those footsteps had both fear and hope. But that mixture was proof of being truly alive.",
                pt: "Aqueles passos tinham medo e esperan√ßa. Mas essa mistura era prova de estar verdadeiramente vivo."
            }},
            { name: "Sora", emoji: "üßï", text: {
                ko: "ÏßÄÍ∏àÏùò ÎÑ§Í∞Ä Îã§Ïãú Í∑∏ Ïû•Î©¥ÏùÑ Îñ†Ïò¨Î†∏Îã§Îäî Í±¥, ÎÑ§ ÏïàÏùò Í∞êÏ†ïÏù¥ ÎèåÏïÑÍ∞ÄÍ≥† Ïã∂ÏùÄ Í∏∏ÏùÑ ÏïåÍ≥† ÏûàÎã§Îäî ÎúªÏù¥Ïïº.",
                en: "The fact that you recalled that scene now means your emotions know the path they want to return to.",
                pt: "O fato de voc√™ ter lembrado daquela cena agora significa que suas emo√ß√µes conhecem o caminho para onde querem retornar."
            }},
            { name: "Kael", emoji: "üßô", text: {
                ko: "ÏãúÍ∞ÑÏùÄ Í∑∏ Ïû•Î©¥ÏùÑ ÏßÄÎÇòÏôîÏßÄÎßå, Í∞êÏ†ïÏùÄ Í∑∏ ÏûêÎ¶¨Ïóê ÎÇ®ÏïÑ ÏûàÏóàÏßÄ. ÏßÄÍ∏à ÎÑàÎäî Îã§Ïãú Í∑∏ Í∏∞ÏñµÍ≥º Ìï®Íªò Í±∑Í≥† ÏûàÏñ¥.",
                en: "Time has passed through that scene, but emotions remained in that place. Now you're walking with that memory again.",
                pt: "O tempo passou por aquela cena, mas as emo√ß√µes permaneceram naquele lugar. Agora voc√™ est√° caminhando com essa mem√≥ria novamente."
            }},
            { name: "Mira", emoji: "üßë‚Äçüé®", text: {
                ko: "Í∑∏ Ïö¥ÎèôÏû•Ïóî ÎÑàÏùò Ï≤´ ÎπõÏù¥ Î¨ªÏñ¥ ÏûàÏóàÏñ¥. ÎÑàÎäî Í∑∏ ÎπõÏùÑ Í∏∞ÏñµÌïòÍ≥† ÏûàÏñ¥.",
                en: "That playground had your first light buried in it. You remember that light.",
                pt: "Aquele p√°tio tinha sua primeira luz enterrada nele. Voc√™ se lembra daquela luz."
            }},
            { name: "Cris", emoji: "ü¶∏‚Äç‚ôÇÔ∏è", text: {
                ko: "Í∞ÄÎ≤ºÏõ†Îçò Í∑∏ Î∞úÍ±∏ÏùåÏù¥ ÏßÄÍ∏àÏùÄ Î¨¥Í≤ÅÍ≤å ÎäêÍª¥Ïßà ÏàòÎèÑ ÏûàÏñ¥. ÌïòÏßÄÎßå Î¨¥Í±∞ÏõÄÎèÑ ÎÑàÏùò Ïù¥ÏïºÍ∏∞Ïóê ÌïÑÏöîÌïú Î∂ÄÎ∂ÑÏù¥Ïïº.",
                en: "Those light footsteps might feel heavy now. But the weight is also a necessary part of your story.",
                pt: "Aqueles passos leves podem parecer pesados agora. Mas o peso tamb√©m √© uma parte necess√°ria da sua hist√≥ria."
            }},
            { name: "Enya", emoji: "üßë‚ÄçüöÄ", text: {
                ko: "ÎÑ§Í∞Ä Îã§Ïãú Í±∑Í≥† Ïã∂Îã§Îäî ÎßàÏùåÏùÄ Ïù¥ÎØ∏ Í±∑Í≥† ÏûàÎã§Îäî Ï¶ùÍ±∞Ïïº. Í∞êÏ†ïÏùÄ Í∑∏Î†áÍ≤å ÏãúÍ∞ÑÏùÑ ÎêòÎèåÎ¶¨Í∏∞ÎèÑ ÌïòÍ±∞Îì†.",
                en: "Your desire to walk again is proof that you're already walking. Emotions can turn back time like that.",
                pt: "Seu desejo de caminhar novamente √© prova de que voc√™ j√° est√° caminhando. Emo√ß√µes podem voltar no tempo assim."
            }},
            { name: "Lian", emoji: "üßò", text: {
                ko: "ÏßÄÍ∏à ÎÑàÏùò Î∞úÍ±∏ÏùåÏù¥ Í∑∏ ÏòõÎÇ†Ïùò ÎßàÏùåÍ≥º Í≤πÏπ† Ïàò ÏûàÎã§Î©¥, Í∑∏Í≤ÉÏùÄ ÌöåÎ≥µÏùò ÏÑ†Ïù¥Ïïº. Ï°∞Ïö©Ìûà Ïù¥Ïñ¥ÏßÄÍ≥† ÏûàÏñ¥.",
                en: "If your footsteps now can overlap with that old heart, it's a line of recovery. Quietly continuing.",
                pt: "Se seus passos agora podem se sobrepor √†quele cora√ß√£o antigo, √© uma linha de recupera√ß√£o. Continuando silenciosamente."
            }}
        ];

        const responseCharacters = [
            {
                name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "Í∑∏ ÎßêÏùÑ ÏßÄÍ∏à ÎÑ§Í∞Ä Í∫ºÎÉàÎã§Îäî Í±¥, Í∑∏ÎïåÏùò ÎÑàÎ•º ÏïàÏïÑÏ§Ä Í±∞Ïïº. ÎÑàÎäî Ïä§Ïä§Î°úÏùò Í∏∞Ïñµ ÏÜçÏóê Îî∞ÎúªÌïú ÎπõÏùÑ ÎÇ®Í≤ºÏñ¥.",
                        en: "The fact that you spoke those words now means you embraced that version of yourself. You left a warm light in your own memory.",
                        pt: "O fato de voc√™ ter dito essas palavras agora significa que voc√™ abra√ßou aquela vers√£o de si mesmo. Voc√™ deixou uma luz calorosa em sua pr√≥pria mem√≥ria."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Lian", emoji: "üßò",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "Îã§Ïãú Í±∑ÎäîÎã§Îäî Í±¥ Í≥ºÍ±∞Î•º Î∞îÍæ∏Îäî Í≤å ÏïÑÎãàÎùº, ÌòÑÏû¨Î•º ÏπòÏú†ÌïòÎäî ÏùºÏù¥Ïïº. ÎÑàÎäî Í∑∏Í±∏ ÌïòÍ≥† ÏûàÏñ¥.",
                        en: "Walking back isn't about changing the past, it's about healing the present. You're doing that.",
                        pt: "Voltar a caminhar n√£o √© sobre mudar o passado, √© sobre curar o presente. Voc√™ est√° fazendo isso."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Kael", emoji: "üßô",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "Í∑∏ Ïû•Î©¥ÏùÄ ÎÅùÎÇòÏßÄ ÏïäÏïòÏñ¥. ÎÑàÏùò Í∞êÏ†ïÏù¥ Îã§Ïãú Í±∏ÏúºÎ†§Îäî Ìïú, Í∑∏ Í∏∏ÏùÄ Í≥ÑÏÜç Ïù¥Ïñ¥Ïßà Í±∞Ïïº.",
                        en: "That scene isn't over. As long as your emotions want to walk again, that path will continue.",
                        pt: "Aquela cena n√£o acabou. Enquanto suas emo√ß√µes quiserem caminhar novamente, esse caminho continuar√°."
                    };
                    return responses[lang];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        let awaitingSecondResponse = false;
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('navigationTitle').textContent = translations[lang].navigationTitle;
            document.getElementById('nextPortalBtn').textContent = translations[lang].nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = translations[lang].stayPortalBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
            awaitingSecondResponse = false;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                localStorage.setItem('temarix_v4_portal17_complete', 'true');
                localStorage.setItem('temarix_v4_current_portal', '18');
                
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 18: ÎÇòÎ•º ÏßÄÌÇ§ÏßÄ Î™ªÌñàÎçò ÏàúÍ∞ÑÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.' :
                    currentLanguage === 'en' ? 
                    'Moving to Portal 18: The Moment I Failed To Protect Myself.' :
                    'Indo para Portal 18: O Momento Em Que Falhei Em Me Proteger.';
                alert(nextMessage);
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const stayMessage = currentLanguage === 'ko' ? 
                    'Ïù¥ Ïû•Î©¥Í≥º Îçî Î®∏Î¨ºÎ©∞ ÍπäÏù¥ ÏÑ±Ï∞∞ÌïòÏãúÍ≤†ÏäµÎãàÍπå?' :
                    currentLanguage === 'en' ? 
                    'Do you want to stay longer with this scene for deeper reflection?' :
                    'Deseja ficar mais tempo com esta cena para reflex√£o mais profunda?';
                
                if (confirm(stayMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            console.log('Processing user input:', inputText);
            localStorage.setItem('temarix_v4_portal17_response', JSON.stringify({
                portal: "v4-17",
                resposta: inputText,
                step: awaitingSecondResponse ? "second" : "first",
                data: new Date().toISOString(),
                idioma: currentLanguage
            }));
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const secondResponseCharacters = [
                {
                    name: "Noah", emoji: "üßë‚Äçü¶±",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í∑∏ ÎßêÏùÑ Ïä§Ïä§Î°úÏóêÍ≤å Ìï¥Ï§ÄÎã§Îäî Í±¥, ÎãπÏã†Ïù¥ ÏûêÏã†ÏùÑ Ïö©ÏÑúÌïòÍ∏∞ ÏãúÏûëÌñàÎã§Îäî ÎúªÏù¥ÏóêÏöî.",
                            en: "Saying those words to yourself means you've started to forgive yourself.",
                            pt: "Dizer essas palavras para si mesmo significa que voc√™ come√ßou a se perdoar."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Mira", emoji: "üßë‚Äçüé®",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í∑∏ ÏÉÅÏ≤òÎì§Ïù¥ Ïù¥Ï†úÎäî Í∑∏Î¶ºÏùò ÏùºÎ∂ÄÍ∞Ä Îê† Ïàò ÏûàÏñ¥Ïöî. ÏïÑÌîîÎèÑ ÎãπÏã† Ïù¥ÏïºÍ∏∞Ïùò Ï§ëÏöîÌïú ÏÉâÍπîÏù¥ÏóêÏöî.",
                            en: "Those wounds can now become part of the painting. Pain is also an important color in your story.",
                            pt: "Essas feridas agora podem se tornar parte da pintura. A dor tamb√©m √© uma cor importante em sua hist√≥ria."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Enya", emoji: "üßë‚ÄçüöÄ",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í≥ºÍ±∞Ïùò Ïû•Î©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÑÎã§Îäî Í±¥, ÏßÄÍ∏àÏùò ÎÑàÍ∞Ä Í∑∏ÎïåÏùò ÎÑàÎ•º Íµ¨ÌïòÎü¨ Í∞ÄÎäî Í±∞Ïïº.",
                            en: "Going back to past scenes means the present you is going to save the past you.",
                            pt: "Voltar para cenas do passado significa que o voc√™ presente est√° indo salvar o voc√™ do passado."
                        };
                        return responses[lang];
                    }
                }
            ];
            
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < secondResponseCharacters.length; i++) {
                const char = secondResponseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < secondResponseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V4 Portal 17 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V4 Portal 17 DOM loaded');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>