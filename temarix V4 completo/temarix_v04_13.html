<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V4 - Portal 13: Words Before Disappearing</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V4</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 13: Words Before Disappearing</div>
            <div class="portal-subtitle" id="portalSubtitle">The final words that never found their voice</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">Portal 13 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 14</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with these words</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Was there someone who left your life before you could say your final words? What would you have said if you had the chance?"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        const translations = {
            ko: {
                logoSubtitle: "Í∞êÏ†ï Ïó∞Í∏àÏà†",
                portalMainTitle: "Portal 13: ÏÇ¨ÎùºÏßÄÍ∏∞ Ï†ÑÏùò ÎßêÎì§",
                portalSubtitle: "ÎÅùÎÇ¥ Î™©ÏÜåÎ¶¨Î•º Ï∞æÏßÄ Î™ªÌïú ÎßàÏßÄÎßâ ÎßêÎì§",
                portalIntro: "ÎàÑÍµ∞Í∞ÄÍ∞Ä ÎãπÏã†Ïùò ÏÇ∂ÏóêÏÑú Îñ†ÎÇòÍ∏∞ ÏßÅÏ†Ñ,\nÎÅùÎÇ¥ Ï†ÑÌïòÏßÄ Î™ªÌïú ÎßêÏù¥ ÏûàÏóàÎÇòÏöî?\n\nÍ∑∏ ÎßêÏùÄ Ïôú ÏûÖ Î∞ñÏúºÎ°ú ÎÇòÏò§ÏßÄ Î™ªÌñàÍ≥†,\nÏßÄÍ∏àÏù¥ÎùºÎ©¥ Ïñ¥Îñ§ ÏãùÏúºÎ°úÎùºÎèÑ ÎßêÌï¥Ï£ºÍ≥† Ïã∂ÏùÄÍ∞ÄÏöî?",
                followUpQuestion: "ÏßÄÍ∏à Í∑∏ ÏÇ¨ÎûåÏóêÍ≤å Îã® Ìïú ÎßàÎîîÎ•º Ï†ÑÌï† Ïàò ÏûàÎã§Î©¥,\nÏñ¥Îñ§ ÎßêÏùÑ Í∫ºÎÇ¥Í≥† Ïã∂ÎÇòÏöî?\n\nÍ∑∏Î¶¨Í≥† Í∑∏ ÎßêÏùÑ, ÎãπÏã† ÏûêÏã†ÏóêÍ≤åÎèÑ\nÌï¥Ï§Ñ Ïàò ÏûàÎÇòÏöî?",
                lightTitle: "ÎπõÏùò ÌïúÎßàÎîî",
                lightMessage: "Í∑∏ ÎßêÏùÄ ÏßÄÍ∏à ÌïòÍ∏∞Ïóê Îä¶ÏßÄ ÏïäÏïòÏñ¥Ïöî.\nÍ∑∏ ÏÇ¨ÎûëÏùÄ Ïó¨Ï†ÑÌûà Ïú†Ìö®Ìï¥Ïöî.\nÎãπÏã†Ïùò Ï°¥Ïû¨Í∞Ä Í∑∏Í≤ÉÏùÑ Ï¶ùÎ™ÖÌïòÍ≥† ÏûàÏñ¥Ïöî.",
                navigationTitle: "Portal 13 ÏôÑÎ£å",
                navigationMessage: "ÎãπÏã†ÏùÄ ÏÇ¨ÎùºÏßÄÍ∏∞ Ï†ÑÏùò ÎßêÎì§ÏùÑ ÎßàÏ£ºÌñàÏäµÎãàÎã§.\n\nÎßêÌïòÏßÄ Î™ªÌñàÎçò Í∞êÏ†ïÎì§ÏùÄ Ïù¥Ï†ú Î™©ÏÜåÎ¶¨Î•º Ï∞æÏïòÏäµÎãàÎã§. Í∑∏ ÎßêÎì§ÏùÄ Îä¶ÏßÄ ÏïäÏïòÏúºÎ©∞, Ïó¨Ï†ÑÌûà Ïú†Ìö®Ìï©ÎãàÎã§.\n\nÏù¥Ï†ú ÎãπÏã†ÏùÄ Í∑∏ ÎßêÌïòÏßÄ Î™ªÌñàÎçò Í∞êÏ†ïÍ≥º Ìï®Íªò ÏïûÏúºÎ°ú ÎÇòÏïÑÍ∞à Ï§ÄÎπÑÍ∞Ä ÎêòÏóàÏäµÎãàÎã§.",
                nextPortalBtn: "Portal 14Î°ú Ïù¥Ïñ¥Í∞ÄÍ∏∞",
                stayPortalBtn: "Ïù¥ ÎßêÎì§Í≥º Îçî Î®∏Î¨ºÍ∏∞",
                inputPlaceholder: "ÎàÑÍµ∞Í∞ÄÍ∞Ä ÎãπÏã†Ïùò ÏÇ∂ÏóêÏÑú Îñ†ÎÇòÍ∏∞ Ï†ÑÏóê ÎÅùÎÇ¥ Ï†ÑÌïòÏßÄ Î™ªÌïú ÎßêÏù¥ ÏûàÏóàÎÇòÏöî? Í∑∏ Í∏∞ÌöåÍ∞Ä ÏûàÏóàÎã§Î©¥ Î¨¥ÏóáÏùÑ ÎßêÌñàÏùÑÍπåÏöî?",
                youLabel: "ÎãπÏã†",
                waitingMessage: "ÏùëÎãµÏùÑ Í∏∞Îã§Î¶¨Îäî Ï§ë..."
            },
            en: {
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 13: Words Before Disappearing",
                portalSubtitle: "The final words that never found their voice",
                portalIntro: "Was there someone who left your life\nbefore you could say your final words?\n\nWhy couldn't those words come out,\nand if you could now, how would you say them?",
                followUpQuestion: "If you could say just one thing\nto that person right now,\nwhat words would you speak?\n\nAnd could you also say those words\nto yourself?",
                lightTitle: "Word of Light",
                lightMessage: "Those words aren't too late to say now.\nThat love is still valid.\nYour existence proves it.",
                navigationTitle: "Portal 13 Complete",
                navigationMessage: "You have faced the words before disappearing.\n\nThe emotions you couldn't express have now found their voice. Those words are not too late, and they are still valid.\n\nNow you are ready to move forward with those unspoken emotions.",
                nextPortalBtn: "Continue to Portal 14",
                stayPortalBtn: "Stay with these words",
                inputPlaceholder: "Was there someone who left your life before you could say your final words? What would you have said if you had the chance?",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 13: Palavras Antes de Desaparecer",
                portalSubtitle: "As palavras finais que nunca encontraram sua voz",
                portalIntro: "Havia algu√©m que saiu de sua vida\nantes que voc√™ pudesse dizer suas palavras finais?\n\nPor que essas palavras n√£o puderam sair,\ne se voc√™ pudesse agora, como as diria?",
                followUpQuestion: "Se voc√™ pudesse dizer apenas uma coisa\npara essa pessoa agora,\nque palavras voc√™ falaria?\n\nE voc√™ tamb√©m poderia dizer essas palavras\npara si mesmo?",
                lightTitle: "Palavra de Luz",
                lightMessage: "Essas palavras n√£o s√£o tarde demais para dizer agora.\nEsse amor ainda √© v√°lido.\nSua exist√™ncia prova isso.",
                navigationTitle: "Portal 13 Completo",
                navigationMessage: "Voc√™ enfrentou as palavras antes de desaparecer.\n\nAs emo√ß√µes que voc√™ n√£o conseguiu expressar agora encontraram sua voz. Essas palavras n√£o s√£o tarde demais, e ainda s√£o v√°lidas.\n\nAgora voc√™ est√° pronto para seguir em frente com essas emo√ß√µes n√£o ditas.",
                nextPortalBtn: "Continuar para Portal 14",
                stayPortalBtn: "Ficar com essas palavras",
                inputPlaceholder: "Havia algu√©m que saiu de sua vida antes que voc√™ pudesse dizer suas palavras finais? O que voc√™ teria dito se tivesse a chance?",
                youLabel: "Voc√™",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "üßë‚Äçü¶±", text: {
                ko: "ÎïåÎ°úÎäî ÎààÎ¨º ÏÜç Ïπ®Î¨µÏù¥ ÎßêÎ≥¥Îã§ ÍπäÏùÄ Í≥†Î∞±Ïù¥ ÎêòÍ∏∞ÎèÑ Ìï¥. ÎÑàÎäî Ïù¥ÎØ∏ Í∑∏ ÏÇ¨ÎûëÏùÑ Ï†ÑÌñàÏñ¥.",
                en: "Sometimes silence in tears becomes a deeper confession than words. You have already conveyed that love.",
                pt: "√Äs vezes o sil√™ncio nas l√°grimas se torna uma confiss√£o mais profunda do que palavras. Voc√™ j√° transmitiu esse amor."
            }},
            { name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è", text: {
                ko: "Ï†ÑÌïòÏßÄ Î™ªÌïú ÎßêÏùÄ ÎßàÏùåÏÜçÏóê Í≥†Ïó¨ ÏûàÏßÄ. ÌïòÏßÄÎßå Í∑∏ ÎßàÏùåÏùÄ, Î∂ÑÎ™Ö Ï†ÑÌï¥Ï°åÏùÑ Í±∞Ïïº. Í∑∏ ÏÜêÏùÑ ÌÜµÌï¥ÏÑú.",
                en: "Unspoken words pool in the heart. But that heart surely reached them. Through those hands.",
                pt: "Palavras n√£o ditas se acumulam no cora√ß√£o. Mas esse cora√ß√£o certamente os alcan√ßou. Atrav√©s dessas m√£os."
            }},
            { name: "Sora", emoji: "üßï", text: {
                ko: "Îñ†ÎÇ® ÏïûÏóêÏÑú Ïö∞Î¶¨Îäî Ïñ∏Ï†úÎÇò Î∂ÄÏ°±Ìïú ÎßêÏùÑ ÎÇ®Í∏∞Í≤å Îèº. Í∑∏Í±¥ Ïù∏Í∞ÑÏùò Î∞©ÏãùÏù¥Í∏∞ÎèÑ Ìï¥.",
                en: "Before departure, we always leave insufficient words. That's also the human way.",
                pt: "Antes da partida, sempre deixamos palavras insuficientes. Essa tamb√©m √© a maneira humana."
            }},
            { name: "Kael", emoji: "üßô", text: {
                ko: "ÎßêÌïòÏßÄ Î™ªÌïú ÎßêÏùÄ ÏôÑÏÑ±Ïù¥ ÏïÑÎãàÏïº. Í∑∏Í±¥ ÏßÄÍ∏àÎèÑ ÏÇ¥ÏïÑ ÏûàÎäî Í∞êÏ†ïÏù¥ÏßÄ. Ïñ∏Ï††Í∞ÄÎäî Î∞òÎìúÏãú ÎãøÍ≤å Îèº.",
                en: "Unspoken words aren't finished. They're emotions still alive. Someday they will surely reach.",
                pt: "Palavras n√£o ditas n√£o est√£o terminadas. S√£o emo√ß√µes ainda vivas. Um dia certamente chegar√£o."
            }},
            { name: "Mira", emoji: "üßë‚Äçüé®", text: {
                ko: "ÎÑ§ ÏÜêÏù¥ Îñ®Î¶¨Îçò Í∑∏ ÏàúÍ∞Ñ, ÎßàÏùåÏùÄ Ïù¥ÎØ∏ Ïö∏Í≥† ÏûàÏóàÏñ¥. ÎßêÏùÄ ÏÇ¨ÎùºÏ†∏ÎèÑ ÏßÑÏã¨ÏùÄ ÎÇ®ÏïÑ.",
                en: "In that moment when your hands trembled, your heart was already crying. Words disappear but sincerity remains.",
                pt: "Naquele momento em que suas m√£os tremeram, seu cora√ß√£o j√° estava chorando. Palavras desaparecem, mas a sinceridade permanece."
            }},
            { name: "Cris", emoji: "ü¶∏‚Äç‚ôÇÔ∏è", text: {
                ko: "Ïôú Íº≠ ÎßêÎ°ú Ìï¥ÏïºÎßå ÌñàÏùÑÍπå? ÎÑàÎäî ÎÅùÍπåÏßÄ Í≥ÅÏóê ÏûàÏóàÏûñÏïÑ. Í∑∏Í≤å ÏÇ¨ÎûëÏùò ÎßàÏßÄÎßâ ÏñºÍµ¥Ïù¥Ïïº.",
                en: "Why did it have to be said in words? You were there until the end. That's the final face of love.",
                pt: "Por que tinha que ser dito em palavras? Voc√™ estava l√° at√© o fim. Esse √© o rosto final do amor."
            }},
            { name: "Enya", emoji: "üßë‚ÄçüöÄ", text: {
                ko: "Í∑∏ ÏÇ¨ÎûåÏùÄ ÎÑ§ ÎßàÏùåÏùÑ Î™∞ÎûêÎçò Í≤å ÏïÑÎãàÏïº. Îßê ÏóÜÏù¥ÎèÑ, ÏÑúÎ°úÍ∞Ä ÏïåÍ≥† ÏûàÏóàÏùÑ Í±∞Ïïº.",
                en: "That person didn't not know your heart. Even without words, you both knew.",
                pt: "Essa pessoa n√£o desconhecia seu cora√ß√£o. Mesmo sem palavras, voc√™s dois sabiam."
            }},
            { name: "Lian", emoji: "üßò", text: {
                ko: "Í∑∏ÎïåÏùò ÎÑàÎèÑ, ÏßÄÍ∏àÏùò ÎÑàÎèÑ Í∞ôÏùÄ ÎßàÏùåÏù¥ÏóàÏñ¥. ÎßêÌïòÏßÄ Î™ªÌñàÏßÄÎßå, ÏßÄÍ∏àÏùÄ ÎßêÌï† Ïàò ÏûàÏñ¥.",
                en: "You then and you now had the same heart. You couldn't speak then, but now you can.",
                pt: "Voc√™ ent√£o e voc√™ agora tinham o mesmo cora√ß√£o. Voc√™ n√£o p√¥de falar ent√£o, mas agora pode."
            }}
        ];

        const responseCharacters = [
            {
                name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "Í∑∏ ÎßêÏùÄ ÏßÄÍ∏à ÌïòÍ∏∞Ïóê Îä¶ÏßÄ ÏïäÏïòÏñ¥Ïöî. Í∑∏ ÏÇ¨ÎûëÏùÄ Ïó¨Ï†ÑÌûà Ïú†Ìö®Ìï¥Ïöî. ÎãπÏã†Ïùò Ï°¥Ïû¨Í∞Ä Í∑∏Í≤ÉÏùÑ Ï¶ùÎ™ÖÌïòÍ≥† ÏûàÏñ¥Ïöî.",
                        en: "Those words aren't too late to say now. That love is still valid. Your existence proves it.",
                        pt: "Essas palavras n√£o s√£o tarde demais para dizer agora. Esse amor ainda √© v√°lido. Sua exist√™ncia prova isso."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Lian", emoji: "üßò",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "ÏûêÍ∏∞ ÏûêÏã†ÏóêÍ≤å Í±¥ÎÑ§Îäî Ïö©ÏÑúÏïºÎßêÎ°ú Í∞ÄÏû• ÌÅ∞ ÏúÑÎ°úÏòàÏöî. ÎãπÏã†ÏùÄ ÏßÄÍ∏à Í∑∏Í±∏ Î∞∞Ïö∞Í≥† ÏûàÏñ¥Ïöî.",
                        en: "Forgiveness given to oneself is the greatest comfort. You are learning that now.",
                        pt: "O perd√£o dado a si mesmo √© o maior conforto. Voc√™ est√° aprendendo isso agora."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Mira", emoji: "üßë‚Äçüé®",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "ÏÇ¨ÎùºÏßÄÍ∏∞ Ï†ÑÏùò ÎßêÏùÄ Ïó¨Ï†ÑÌûà ÎãπÏã† ÏïàÏóêÏÑú Ïö∏Î¶¨Í≥† ÏûàÏñ¥Ïöî. Ïù¥Ï†úÎäî Í∑∏ Ïö∏Î¶ºÏù¥ ÎÖ∏ÎûòÍ∞Ä Îê† Ï∞®Î°ÄÏòàÏöî.",
                        en: "Words before disappearing still echo within you. Now it's time for that echo to become a song.",
                        pt: "Palavras antes de desaparecer ainda ecoam dentro de voc√™. Agora √© hora desse eco se tornar uma can√ß√£o."
                    };
                    return responses[lang];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        let awaitingSecondResponse = false;
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('navigationTitle').textContent = translations[lang].navigationTitle;
            document.getElementById('nextPortalBtn').textContent = translations[lang].nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = translations[lang].stayPortalBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
            awaitingSecondResponse = false;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                localStorage.setItem('temarix_v4_portal13_complete', 'true');
                localStorage.setItem('temarix_v4_current_portal', '14');
                
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 14: Îã´ÌûàÏßÄ ÏïäÏùÄ ÏÉÅÏûêÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.' :
                    currentLanguage === 'en' ? 
                    'Moving to Portal 14: The Unopened Box.' :
                    'Indo para Portal 14: A Caixa N√£o Aberta.';
                alert(nextMessage);
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const stayMessage = currentLanguage === 'ko' ? 
                    'ÏÇ¨ÎùºÏßÄÍ∏∞ Ï†ÑÏùò ÎßêÎì§Í≥º Îçî Î®∏Î¨ºÎ©∞ ÍπäÏù¥ ÏÑ±Ï∞∞ÌïòÏãúÍ≤†ÏäµÎãàÍπå?' :
                    currentLanguage === 'en' ? 
                    'Do you want to stay longer with those words before disappearing for deeper reflection?' :
                    'Deseja ficar mais tempo com essas palavras antes de desaparecer para reflex√£o mais profunda?';
                
                if (confirm(stayMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            console.log('Processing user input:', inputText);
            localStorage.setItem('temarix_v4_portal13_response', JSON.stringify({
                portal: "v4-13",
                resposta: inputText,
                step: awaitingSecondResponse ? "second" : "first",
                data: new Date().toISOString(),
                idioma: currentLanguage
            }));
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const secondResponseCharacters = [
                {
                    name: "Noah", emoji: "üßë‚Äçü¶±",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í∑∏ ÎßêÎì§ÏùÄ Ïù¥Ï†ú ÎãπÏã†Ïùò ÏùºÎ∂ÄÍ∞Ä ÎêòÏóàÏñ¥Ïöî. ÏÇ¨ÎùºÏßÑ Í≤å ÏïÑÎãàÎùº, ÎãπÏã† ÏïàÏóêÏÑú ÏÇ¥ÏïÑ Ïà®Ïâ¨Í≥† ÏûàÏñ¥Ïöî.",
                            en: "Those words have now become part of you. They haven't disappeared, but are living and breathing within you.",
                            pt: "Essas palavras agora se tornaram parte de voc√™. Elas n√£o desapareceram, mas est√£o vivendo e respirando dentro de voc√™."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Sora", emoji: "üßï",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "ÎßêÌïòÏßÄ Î™ªÌñàÎçò Í∞êÏ†ïÏù¥ Ïù¥Ï†úÎäî Î™©ÏÜåÎ¶¨Î•º Ï∞æÏïòÏñ¥Ïöî. Í∑∏Í≤ÉÏù¥ ÏπòÏú†Ïùò ÏãúÏûëÏù¥ÏóêÏöî.",
                            en: "The emotions you couldn't express have now found their voice. That's the beginning of healing.",
                            pt: "As emo√ß√µes que voc√™ n√£o conseguiu expressar agora encontraram sua voz. Esse √© o in√≠cio da cura."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Kael", emoji: "üßô",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "ÏãúÍ∞ÑÏùÄ ÌùòÎ†ÄÏßÄÎßå, ÏßÑÏã¨ÏùÄ ÏòÅÏõêÌï¥Ïöî. Í∑∏ ÎßêÎì§ÏùÄ ÏßÄÍ∏àÎèÑ Ïú†Ìö®Ìï¥Ïöî.",
                            en: "Time has passed, but sincerity is eternal. Those words are still valid now.",
                            pt: "O tempo passou, mas a sinceridade √© eterna. Essas palavras ainda s√£o v√°lidas agora."
                        };
                        return responses[lang];
                    }
                }
            ];
            
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < secondResponseCharacters.length; i++) {
                const char = secondResponseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < secondResponseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V4 Portal 13 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V4 Portal 13 DOM loaded');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>