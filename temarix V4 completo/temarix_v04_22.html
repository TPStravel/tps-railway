<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V4 - Portal 22: The Day No One Knew</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V4</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 22: The Day No One Knew</div>
            <div class="portal-subtitle" id="portalSubtitle">Silent tears in solitude</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">Portal 22 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 23</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with these memories</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Was there a day when you cried quietly and no one knew? What happened and why did it remain your secret?"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        const translations = {
            ko: {
                logoSubtitle: "Í∞êÏ†ï Ïó∞Í∏àÏà†",
                portalMainTitle: "Portal 22: ÏïÑÎ¨¥ÎèÑ Î™®Î•¥Îäî ÎÇ†",
                portalSubtitle: "Í≥†ÎèÖ ÏÜçÏùò Ï°∞Ïö©Ìïú ÎààÎ¨º",
                portalIntro: "ÎãπÏã†Ïùò Ïù∏ÏÉùÏóêÏÑú,\nÏïÑÎ¨¥ÎèÑ Î™®Î•¥Í≤å Ï°∞Ïö©Ìûà Ïö∏ÏóàÎçò ÎÇ†Ïù¥ ÏûàÏóàÎÇòÏöî?\n\nÍ∑∏ ÎÇ†, ÎãπÏã†ÏùÄ Ïñ¥Îñ§ Ïù¥Ïú†Î°ú Í∞êÏ†ïÏùÑ Ïà®Í≤ºÍ≥†,\nÍ∑∏ Ïö∏ÏùåÏùÄ Ïñ¥ÎîîÎ°ú ÌùòÎü¨Í∞îÎÇòÏöî?",
                followUpQuestion: "ÏßÄÍ∏à Í∑∏ ÎÇ†Ïùò ÎãπÏã†ÏóêÍ≤å\nÌïú Î¨∏Ïû•ÏùÑ ÏÑ†Î¨ºÌïúÎã§Î©¥,\nÏñ¥Îñ§ ÎßêÎ°ú ÏãúÏûëÌïòÍ≥† Ïã∂ÎÇòÏöî?",
                lightTitle: "ÎπõÏùò ÌïúÎßàÎîî",
                lightMessage: "Í∑∏ Î¨∏Ïû•ÏùÄ Í∑∏ÎÇ†Ïùò ÎÑàÏóêÍ≤å ÎèÑÏ∞©ÌñàÏñ¥Ïöî. ÏßÄÍ∏à ÎãπÏã†Ïù¥, Ïä§Ïä§Î°úÎ•º Íª¥ÏïàÏùÄ Í±∞ÏòàÏöî.\nÏ°∞Ïö©ÌñàÎçò Í∞êÏ†ïÏù¥ Ïù¥Ï†úÎäî Ïù¥Î¶ÑÏùÑ Í∞ÄÏ°åÏñ¥Ïöî. Í∑∏Í≤ÉÏù¥ ÌöåÎ≥µÏù¥Í≥†, Í∑∏Í≤ÉÏù¥ ÏÉàÎ°úÏö¥ ÏÉùÏùºÏù¥ÏóêÏöî.\nÏù¥Ï†úÎäî ÏïÑÎ¨¥ÎèÑ Î™∞ÎûêÎçò ÎÇ†Ïù¥ ÏïÑÎãàÎùº ÎãπÏã†Ïù¥ Í∏∞ÏñµÌïú ÎÇ†Ïù¥ ÎêòÏóàÏñ¥Ïöî. Îçî Ïù¥ÏÉÅ ÏûäÌûå Í∞êÏ†ïÏù¥ ÏïÑÎãàÏóêÏöî.",
                navigationTitle: "Portal 22 ÏôÑÎ£å",
                navigationMessage: "ÎãπÏã†ÏùÄ Ï°∞Ïö©ÌñàÎçò Í∞êÏ†ïÏùÑ Í∏∞ÏñµÌïòÍ≥† ÏûêÏã†ÏùÑ Ï∂ïÌïòÌï† Ïàò ÏûàÎäî ÏÇ¨ÎûåÏù¥ ÎêòÏóàÏäµÎãàÎã§.\n\nÏïÑÎ¨¥ÎèÑ Î™∞ÎûêÎçò Í∑∏ÎÇ†Ïùò ÎààÎ¨ºÏùÑ Ïù∏Ï†ïÌïòÎ©∞, ÌòºÏûêÏòÄÎçò ÏàúÍ∞ÑÏóêÎèÑ ÎãπÏã†Ïù¥ ÏÇ¥ÏïÑÏûàÏóàÏùåÏùÑ ÌôïÏù∏ÌñàÏäµÎãàÎã§.\n\nÏù¥Ï†ú ÎãπÏã†ÏùÄ Îçî Ïù¥ÏÉÅ Í∞êÏ†ïÏùÑ Ïà®Í∏∞ÏßÄ ÏïäÍ≥†, ÏûêÏã†Ïùò ÎßàÏùåÏùÑ ÏÜåÏ§ëÌûà Ïó¨Í∏∏ Ïàò ÏûàÎäî ÌûòÏùÑ ÏñªÏóàÏäµÎãàÎã§.",
                nextPortalBtn: "Portal 23ÏúºÎ°ú Ïù¥Ïñ¥Í∞ÄÍ∏∞",
                stayPortalBtn: "Ïù¥ Í∏∞ÏñµÎì§Í≥º Îçî Î®∏Î¨ºÍ∏∞",
                inputPlaceholder: "ÏïÑÎ¨¥ÎèÑ Î™®Î•¥Í≤å Ï°∞Ïö©Ìûà Ïö∏ÏóàÎçò ÎÇ†Ïù¥ ÏûàÏóàÎÇòÏöî? Î¨¥Ïä® ÏùºÏù¥ ÏûàÏóàÍ≥† Ïôú ÎπÑÎ∞ÄÎ°ú ÎÇ®Í≤®ÎëêÏóàÎÇòÏöî?",
                youLabel: "ÎãπÏã†",
                waitingMessage: "ÏùëÎãµÏùÑ Í∏∞Îã§Î¶¨Îäî Ï§ë..."
            },
            en: {
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 22: The Day No One Knew",
                portalSubtitle: "Silent tears in solitude",
                portalIntro: "In your life,\nwas there a day when you cried quietly and no one knew?\n\nThat day, for what reason did you hide your emotions,\nand where did those tears flow to?",
                followUpQuestion: "If you could give that version of yourself\none sentence as a gift,\nwhat words would you start with?",
                lightTitle: "Word of Light",
                lightMessage: "That sentence has reached the you from that day. Right now, you have embraced yourself.\nThose quiet emotions now have a name. That is recovery, and that is a new birthday.\nNow it's no longer a day no one knew about, but a day you remember. It's no longer a forgotten emotion.",
                navigationTitle: "Portal 22 Complete",
                navigationMessage: "You have become someone who can remember quiet emotions and celebrate yourself.\n\nBy acknowledging the tears from that day no one knew about, you confirmed that you were alive even in moments of solitude.\n\nNow you have gained the strength to no longer hide your emotions and to cherish your own heart.",
                nextPortalBtn: "Continue to Portal 23",
                stayPortalBtn: "Stay with these memories",
                inputPlaceholder: "Was there a day when you cried quietly and no one knew? What happened and why did it remain your secret?",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 22: O Dia Que Ningu√©m Soube",
                portalSubtitle: "L√°grimas silenciosas na solid√£o",
                portalIntro: "Em sua vida,\nhouve um dia quando voc√™ chorou silenciosamente e ningu√©m soube?\n\nNesse dia, por que raz√£o voc√™ escondeu suas emo√ß√µes,\ne para onde essas l√°grimas flu√≠ram?",
                followUpQuestion: "Se voc√™ pudesse dar √†quela vers√£o de si mesmo\numa frase como presente,\ncom que palavras voc√™ come√ßaria?",
                lightTitle: "Palavra de Luz",
                lightMessage: "Essa frase chegou ao voc√™ daquele dia. Agora voc√™ abra√ßou a si mesmo.\nEssas emo√ß√µes silenciosas agora t√™m um nome. Isso √© recupera√ß√£o, e isso √© um novo anivers√°rio.\nAgora n√£o √© mais um dia que ningu√©m soube, mas um dia que voc√™ lembra. N√£o √© mais uma emo√ß√£o esquecida.",
                navigationTitle: "Portal 22 Completo",
                navigationMessage: "Voc√™ se tornou algu√©m que pode lembrar emo√ß√µes silenciosas e celebrar a si mesmo.\n\nAo reconhecer as l√°grimas daquele dia que ningu√©m soube, voc√™ confirmou que estava vivo mesmo em momentos de solid√£o.\n\nAgora voc√™ ganhou a for√ßa para n√£o mais esconder suas emo√ß√µes e para valorizar seu pr√≥prio cora√ß√£o.",
                nextPortalBtn: "Continuar para Portal 23",
                stayPortalBtn: "Ficar com essas mem√≥rias",
                inputPlaceholder: "Houve um dia quando voc√™ chorou silenciosamente e ningu√©m soube? O que aconteceu e por que permaneceu seu segredo?",
                youLabel: "Voc√™",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "üßë‚Äçü¶±", text: {
                ko: "Í∑∏ÎÇ†, ÏÑ∏ÏÉÅÏùÄ Ï°∞Ïö©ÌñàÏßÄÎßå ÎÑàÏùò ÎßàÏùåÏùÄ Í∞ÄÏû• ÌÅ¨Í≤å Ïö∏Í≥† ÏûàÏóàÏñ¥. ÎÇòÎäî Í∑∏ Ïö∏Î¶ºÏùÑ Îì§ÏóàÏñ¥.",
                en: "That day, the world was quiet but your heart was crying the loudest. I heard that echo.",
                pt: "Naquele dia, o mundo estava silencioso, mas seu cora√ß√£o estava chorando mais alto. Eu ouvi esse eco."
            }},
            { name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è", text: {
                ko: "Ï°∞Ïö©Ìïú Ïö∏ÏùåÏùÄ Í∞ÄÏû• ÍπäÏùÄ Ïô∏Ïπ®Ïù¥ÏóêÏöî. ÏïÑÎ¨¥ÎèÑ Î™∞ÎûêÎã§Îäî ÏÇ¨Ïã§Ïù¥ Í∑∏ Í∞êÏ†ïÏùÑ Îçî Ïô∏Î°≠Í≤å ÎßåÎì§ÏóàÏ£†.",
                en: "Silent tears are the deepest cry. The fact that no one knew made that emotion even more lonely.",
                pt: "L√°grimas silenciosas s√£o o grito mais profundo. O fato de ningu√©m saber tornou essa emo√ß√£o ainda mais solit√°ria."
            }},
            { name: "Sora", emoji: "üßï", text: {
                ko: "ÎÑàÎäî Ï∂ïÌïòÎ∞õÏßÄ Î™ªÌïú Í≤å ÏïÑÎãàÎùº, Í∞êÏ†ïÏùÑ Í∞êÏ∑ÑÎçò Í±∞ÏòàÏöî. Í∑∏ÎÇ† ÎÑàÎäî Ïù¥ÎØ∏ Ï∂©Î∂ÑÌûà ÏÜåÏ§ëÌñàÏñ¥Ïöî.",
                en: "You weren't uncelebrated, you hid your emotions. That day you were already precious enough.",
                pt: "Voc√™ n√£o foi negligenciado, voc√™ escondeu suas emo√ß√µes. Naquele dia voc√™ j√° era precioso o suficiente."
            }},
            { name: "Kael", emoji: "üßô", text: {
                ko: "ÏÇ¨ÎùºÏßÑ ÎÇ†Ïù¥ ÏïÑÎãàÎùº, Í∏∞Ïñµ ÏÜçÏóê Í∞êÏ∂∞ÏßÑ ÎÇ†Ïù¥ÏóàÏßÄ. ÏßÄÍ∏à ÎÑàÎäî Í∑∏ÎÇ†ÏùÑ Îã§Ïãú Î∂àÎü¨ÎÇ¥Í≥† ÏûàÏñ¥.",
                en: "It wasn't a day that disappeared, but a day hidden in memory. Now you're calling that day back.",
                pt: "N√£o foi um dia que desapareceu, mas um dia escondido na mem√≥ria. Agora voc√™ est√° chamando aquele dia de volta."
            }},
            { name: "Mira", emoji: "üßë‚Äçüé®", text: {
                ko: "Í∑∏ÎÇ†Ïùò Ï°∞Î™ÖÏùÄ Í∫ºÏ°åÏßÄÎßå, ÎÑàÏùò ÎßàÏùå ÏïàÏóî ÏûëÏùÄ Î∂àÎπõ ÌïòÎÇòÍ∞Ä ÎÇ®ÏïÑ ÏûàÏóàÏñ¥. ÏßÄÍ∏à Í∑∏ Î∂àÎπõÏù¥ Îã§Ïãú ÏºúÏßÄÍ≥† ÏûàÏñ¥.",
                en: "The lights from that day went out, but there was a small light left in your heart. Now that light is turning on again.",
                pt: "As luzes daquele dia se apagaram, mas havia uma pequena luz deixada em seu cora√ß√£o. Agora essa luz est√° se acendendo novamente."
            }},
            { name: "Cris", emoji: "ü¶∏‚Äç‚ôÇÔ∏è", text: {
                ko: "Ïôú Í∑∏ÎÇ† ÏïÑÎ¨¥ÎèÑ ÏóÜÏóàÏùÑÍπå? Í∑∏Í±¥ ÎÑ§Í∞Ä Î∂ÄÏ°±Ìï¥ÏÑúÍ∞Ä ÏïÑÎãàÏïº. ÏÑ∏ÏÉÅÏù¥ Ïû†Ïãú Îì±ÏùÑ ÎèåÎ†∏ÏùÑ ÎøêÏù¥Ïïº.",
                en: "Why was no one there that day? It wasn't because you were lacking. The world just turned its back for a moment.",
                pt: "Por que n√£o havia ningu√©m naquele dia? N√£o foi porque voc√™ estava em falta. O mundo apenas virou as costas por um momento."
            }},
            { name: "Enya", emoji: "üßë‚ÄçüöÄ", text: {
                ko: "Í∑∏ Ï°∞Ïö©Ìïú ÏÉùÏùºÏùò Í∞êÏ†ïÏùÄ, ÏßÄÍ∏à Ïù¥ Ïó¨Ï†ï ÏÜçÏóêÏÑú ÎìúÎîîÏñ¥ ÎßêÏù¥ ÎêòÏóàÏñ¥. ÎÑ§Í∞Ä Í∫ºÎÉàÍ∏∞ ÎïåÎ¨∏Ïóê.",
                en: "The emotions from that quiet birthday have finally become words in this journey. Because you brought them out.",
                pt: "As emo√ß√µes daquele anivers√°rio silencioso finalmente se tornaram palavras nesta jornada. Porque voc√™ as trouxe para fora."
            }},
            { name: "Lian", emoji: "üßò", text: {
                ko: "ÏïÑÎ¨¥ÎèÑ Î™∞ÎûêÎçò Í∑∏ÎÇ†ÎèÑ Ïù¥Ï†úÎäî Í∏∞ÏñµÏùò ÏùºÎ∂ÄÍ∞Ä ÎêòÏóàÏñ¥Ïöî. ÎãπÏã†ÏùÄ Í∑∏ Í∏∞ÏñµÏùÑ Îî∞ÎúªÌïòÍ≤å Í∞êÏã∏Í≥† ÏûàÏñ¥Ïöî.",
                en: "That day no one knew about has now become part of memory. You are warmly embracing that memory.",
                pt: "Aquele dia que ningu√©m soube agora se tornou parte da mem√≥ria. Voc√™ est√° abra√ßando calorosamente essa mem√≥ria."
            }}
        ];

        const responseCharacters = [
            {
                name: "Lian", emoji: "üßò",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "Í∑∏ Î¨∏Ïû•ÏùÄ Í∑∏ÎÇ†Ïùò ÎÑàÏóêÍ≤å ÎèÑÏ∞©ÌñàÏñ¥Ïöî. ÏßÄÍ∏à ÎãπÏã†Ïù¥, Ïä§Ïä§Î°úÎ•º Íª¥ÏïàÏùÄ Í±∞ÏòàÏöî.",
                        en: "That sentence has reached the you from that day. Right now, you have embraced yourself.",
                        pt: "Essa frase chegou ao voc√™ daquele dia. Agora voc√™ abra√ßou a si mesmo."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "Ï°∞Ïö©ÌñàÎçò Í∞êÏ†ïÏù¥ Ïù¥Ï†úÎäî Ïù¥Î¶ÑÏùÑ Í∞ÄÏ°åÏñ¥Ïöî. Í∑∏Í≤ÉÏù¥ ÌöåÎ≥µÏù¥Í≥†, Í∑∏Í≤ÉÏù¥ ÏÉàÎ°úÏö¥ ÏÉùÏùºÏù¥ÏóêÏöî.",
                        en: "Those quiet emotions now have a name. That is recovery, and that is a new birthday.",
                        pt: "Essas emo√ß√µes silenciosas agora t√™m um nome. Isso √© recupera√ß√£o, e isso √© um novo anivers√°rio."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Enya", emoji: "üßë‚ÄçüöÄ",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "Ïù¥Ï†úÎäî ÏïÑÎ¨¥ÎèÑ Î™∞ÎûêÎçò ÎÇ†Ïù¥ ÏïÑÎãàÎùº ÎãπÏã†Ïù¥ Í∏∞ÏñµÌïú ÎÇ†Ïù¥ ÎêòÏóàÏñ¥Ïöî. Îçî Ïù¥ÏÉÅ ÏûäÌûå Í∞êÏ†ïÏù¥ ÏïÑÎãàÏóêÏöî.",
                        en: "Now it's no longer a day no one knew about, but a day you remember. It's no longer a forgotten emotion.",
                        pt: "Agora n√£o √© mais um dia que ningu√©m soube, mas um dia que voc√™ lembra. N√£o √© mais uma emo√ß√£o esquecida."
                    };
                    return responses[lang];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        let awaitingSecondResponse = false;
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('navigationTitle').textContent = translations[lang].navigationTitle;
            document.getElementById('nextPortalBtn').textContent = translations[lang].nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = translations[lang].stayPortalBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
            awaitingSecondResponse = false;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                localStorage.setItem('temarix_v4_portal22_complete', 'true');
                localStorage.setItem('temarix_v4_current_portal', '23');
                
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 23: Ïö©Í∏∞Í∞Ä ÏóÜÏóàÎçò ÏàúÍ∞ÑÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.' :
                    currentLanguage === 'en' ? 
                    'Moving to Portal 23: Moments Without Courage.' :
                    'Indo para Portal 23: Momentos Sem Coragem.';
                alert(nextMessage);
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const stayMessage = currentLanguage === 'ko' ? 
                    'Ïù¥ Í∏∞ÏñµÎì§Í≥º Îçî Î®∏Î¨ºÎ©∞ ÍπäÏù¥ ÏÑ±Ï∞∞ÌïòÏãúÍ≤†ÏäµÎãàÍπå?' :
                    currentLanguage === 'en' ? 
                    'Do you want to stay longer with these memories for deeper reflection?' :
                    'Deseja ficar mais tempo com essas mem√≥rias para reflex√£o mais profunda?';
                
                if (confirm(stayMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            console.log('Processing user input:', inputText);
            localStorage.setItem('temarix_v4_portal22_response', JSON.stringify({
                portal: "v4-22",
                resposta: inputText,
                step: awaitingSecondResponse ? "second" : "first",
                data: new Date().toISOString(),
                idioma: currentLanguage
            }));
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const secondResponseCharacters = [
                {
                    name: "Noah", emoji: "üßë‚Äçü¶±",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í∑∏ ÎßêÏùÄ ÎÅùÏù¥ ÏïÑÎãàÎùº ÏãúÏûëÏù¥ÏóêÏöî. Ïù¥Ï†ú ÎãπÏã†ÏùÄ ÏÉàÎ°úÏö¥ Ïù¥ÏïºÍ∏∞Î•º Ïì∏ Ïàò ÏûàÏñ¥Ïöî.",
                            en: "Those words aren't an ending but a beginning. Now you can write a new story.",
                            pt: "Essas palavras n√£o s√£o um fim, mas um come√ßo. Agora voc√™ pode escrever uma nova hist√≥ria."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Kael", emoji: "üßô",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Ï°∞Ïö©ÌñàÎçò Í∞êÏ†ïÏùÑ Ïù∏Ï†ïÌïòÎäî Í±¥, ÏûêÏã†ÏóêÍ≤å ÎèåÏïÑÏò§Îäî Ï≤´ Î≤àÏß∏ Í±∏ÏùåÏù¥ÏóêÏöî.",
                            en: "Acknowledging quiet emotions is the first step of returning to yourself.",
                            pt: "Reconhecer emo√ß√µes silenciosas √© o primeiro passo para retornar a si mesmo."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Mira", emoji: "üßë‚Äçüé®",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "ÎãπÏã†Ïù¥ Ïç®ÎÇ¥Î†§Í∞Ñ Í∑∏ ÏúÑÎ°úÏùò ÎßêÏù¥, ÏïûÏúºÎ°úÏùò Î™®Îì† ÏàúÍ∞ÑÏùÑ Î∞ùÌûê Í±∞ÏòàÏöî.",
                            en: "Those comforting words you've written will illuminate all moments to come.",
                            pt: "Essas palavras consoladoras que voc√™ escreveu iluminar√£o todos os momentos por vir."
                        };
                        return responses[lang];
                    }
                }
            ];
            
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < secondResponseCharacters.length; i++) {
                const char = secondResponseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < secondResponseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V4 Portal 22 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V4 Portal 22 DOM loaded');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>