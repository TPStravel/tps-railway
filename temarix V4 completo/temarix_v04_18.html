<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V4 - Portal 18: The Moment I Failed To Protect Myself</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V4</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 18: The Moment I Failed To Protect Myself</div>
            <div class="portal-subtitle" id="portalSubtitle">When I couldn't guard my heart</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">Portal 18 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 19</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with this moment</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Was there a moment when you felt you failed to protect yourself? What happened and how has it affected you?"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        const translations = {
            ko: {
                logoSubtitle: "Í∞êÏ†ï Ïó∞Í∏àÏà†",
                portalMainTitle: "Portal 18: ÎÇòÎ•º ÏßÄÌÇ§ÏßÄ Î™ªÌñàÎçò ÏàúÍ∞Ñ",
                portalSubtitle: "ÎÇ¥ ÎßàÏùåÏùÑ ÏßÄÏºúÏ£ºÏßÄ Î™ªÌñàÏùÑ Îïå",
                portalIntro: "ÎãπÏã†Ïù¥ Ïä§Ïä§Î°úÎ•º ÏßÄÌÇ§ÏßÄ Î™ªÌñàÎã§Í≥† ÎäêÍºàÎçò ÏàúÍ∞ÑÏù¥ ÏûàÏóàÎÇòÏöî?\n\nÍ∑∏Îïå ÎãπÏã†ÏùÄ Ïñ¥Îñ§ ÏÑ†ÌÉùÏùÑ ÌñàÍ≥†,\nÍ∑∏ ÏÑ†ÌÉùÏùÄ ÏßÄÍ∏àÏùò ÎãπÏã†ÏóêÍ≤å Ïñ¥Îñ§ ÌùîÏ†ÅÏùÑ ÎÇ®Í≤ºÎÇòÏöî?",
                followUpQuestion: "Í∑∏ÎïåÏùò ÎãπÏã†ÏóêÍ≤å ÏßÄÍ∏à ÎèåÏïÑÍ∞ÑÎã§Î©¥,\nÏñ¥Îñ§ ÎßêÏùÑ Ìï¥Ï£ºÍ≥† Ïã∂ÎÇòÏöî?\n\nÍ∑∏Î¶¨Í≥†, ÏßÄÍ∏àÏùò ÎãπÏã†ÏùÄ\nÎçî Ïù¥ÏÉÅ ÏûêÏã†ÏùÑ ÏßÄÏö∞ÏßÄ ÏïäÍ∏∞ ÏúÑÌï¥\nÏñ¥Îñ§ Îã§ÏßêÏùÑ Ìï† Ïàò ÏûàÏùÑÍπåÏöî?",
                lightTitle: "ÎπõÏùò ÌïúÎßàÎîî",
                lightMessage: "ÎÇòÎ•º ÏßÄÌÇ§ÏßÄ Î™ªÌñàÎçò Í∑∏ ÏàúÍ∞ÑÍ≥º ÌôîÌï¥Ìïú ÎãπÏã†.\nÍ≥ºÍ±∞Î•º ÎßàÏ£ºÌïú Ïö©Í∏∞Îäî ÌòÑÏû¨Ïùò ÎãπÏã†ÏùÑ Îçî Îã®Îã®ÌïòÍ≤å ÎßåÎì§Ïñ¥Ïöî.\nÎãπÏã†ÏùÄ ÏßÄÍ∏à, ÏÉàÎ°úÏö¥ ÏÑ†ÌÉùÏùÑ Ï§ÄÎπÑÌïòÍ≥† ÏûàÏñ¥Ïöî.",
                navigationTitle: "Portal 18 ÏôÑÎ£å",
                navigationMessage: "ÎãπÏã†ÏùÄ ÏûêÏã†ÏùÑ ÏßÄÌÇ§ÏßÄ Î™ªÌñàÎã§Í≥† ÎäêÍºàÎçò ÏàúÍ∞ÑÏùÑ ÎßàÏ£ºÌñàÏäµÎãàÎã§.\n\nÍ∑∏ ÏàúÍ∞ÑÏù¥ ÎãπÏã†Ïùò ÏûòÎ™ªÏù¥ ÏïÑÎãàÏóàÏùåÏùÑ, Í∑∏Î¶¨Í≥† Í∑∏ÎïåÏùò ÏÑ†ÌÉùÏù¥ ÏÉùÏ°¥ÏùÑ ÏúÑÌïú Î≥∏Îä•Ïù¥ÏóàÏùåÏùÑ Ïù∏Ï†ïÌñàÏäµÎãàÎã§.\n\nÏù¥Ï†ú ÎãπÏã†ÏùÄ ÏûêÏã†ÏùÑ Î≥¥Ìò∏ÌïòÎäî ÏÉàÎ°úÏö¥ Î∞©Î≤ïÏùÑ Î∞∞Ïö∞Î©∞, Îçî Ïù¥ÏÉÅ ÏûêÏã†ÏùÑ ÏßÄÏö∞ÏßÄ ÏïäÍ∏∞Î°ú Îã§ÏßêÌï† Ïàò ÏûàÏäµÎãàÎã§.",
                nextPortalBtn: "Portal 19Î°ú Ïù¥Ïñ¥Í∞ÄÍ∏∞",
                stayPortalBtn: "Ïù¥ ÏàúÍ∞ÑÍ≥º Îçî Î®∏Î¨ºÍ∏∞",
                inputPlaceholder: "Ïä§Ïä§Î°úÎ•º ÏßÄÌÇ§ÏßÄ Î™ªÌñàÎã§Í≥† ÎäêÍºàÎçò ÏàúÍ∞ÑÏù¥ ÏûàÏóàÎÇòÏöî? Î¨¥Ïä® ÏùºÏù¥ ÏûàÏóàÍ≥† Ïñ¥Îñ§ ÏòÅÌñ•ÏùÑ Ï£ºÏóàÎÇòÏöî?",
                youLabel: "ÎãπÏã†",
                waitingMessage: "ÏùëÎãµÏùÑ Í∏∞Îã§Î¶¨Îäî Ï§ë..."
            },
            en: {
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 18: The Moment I Failed To Protect Myself",
                portalSubtitle: "When I couldn't guard my heart",
                portalIntro: "Was there a moment when you felt\nyou failed to protect yourself?\n\nWhat choice did you make then,\nand what traces has that choice\nleft on who you are today?",
                followUpQuestion: "If you could go back to yourself in that moment,\nwhat would you want to say?\n\nAnd what commitment can you make now\nto never erase yourself again?",
                lightTitle: "Word of Light",
                lightMessage: "You who have reconciled with that moment when you failed to protect yourself.\nThe courage to face the past makes your present self stronger.\nYou are now preparing to make new choices.",
                navigationTitle: "Portal 18 Complete",
                navigationMessage: "You have faced the moment when you felt you failed to protect yourself.\n\nYou acknowledged that it wasn't your fault, and that your choice then was an instinct for survival.\n\nNow you can learn new ways to protect yourself and commit to never erasing yourself again.",
                nextPortalBtn: "Continue to Portal 19",
                stayPortalBtn: "Stay with this moment",
                inputPlaceholder: "Was there a moment when you felt you failed to protect yourself? What happened and how has it affected you?",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 18: O Momento Em Que Falhei Em Me Proteger",
                portalSubtitle: "Quando n√£o consegui guardar meu cora√ß√£o",
                portalIntro: "Houve um momento em que voc√™ sentiu\nque falhou em se proteger?\n\nQue escolha voc√™ fez ent√£o,\ne que marcas essa escolha\ndeixou em quem voc√™ √© hoje?",
                followUpQuestion: "Se voc√™ pudesse voltar para si mesmo naquele momento,\no que gostaria de dizer?\n\nE que compromisso voc√™ pode fazer agora\npara nunca mais se apagar?",
                lightTitle: "Palavra de Luz",
                lightMessage: "Voc√™ que se reconciliou com aquele momento em que falhou em se proteger.\nA coragem de enfrentar o passado torna seu eu presente mais forte.\nVoc√™ est√° agora se preparando para fazer novas escolhas.",
                navigationTitle: "Portal 18 Completo",
                navigationMessage: "Voc√™ enfrentou o momento em que sentiu que falhou em se proteger.\n\nVoc√™ reconheceu que n√£o foi sua culpa, e que sua escolha ent√£o foi um instinto de sobreviv√™ncia.\n\nAgora voc√™ pode aprender novas maneiras de se proteger e se comprometer a nunca mais se apagar.",
                nextPortalBtn: "Continuar para Portal 19",
                stayPortalBtn: "Ficar com este momento",
                inputPlaceholder: "Houve um momento em que voc√™ sentiu que falhou em se proteger? O que aconteceu e como isso te afetou?",
                youLabel: "Voc√™",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "üßë‚Äçü¶±", text: {
                ko: "Í∑∏ ÏàúÍ∞Ñ ÎÑå ÌòºÏûêÏòÄÏßÄ. ÎàÑÍ∞Ä ÎÑê ÎåÄÏã† ÏßÄÏºúÏ§¨Ïñ¥Ïïº ÌñàÎäîÎç∞, ÏïÑÎ¨¥ÎèÑ ÏóÜÏóàÏñ¥.",
                en: "You were alone in that moment. Someone should have protected you instead, but no one was there.",
                pt: "Voc√™ estava sozinho naquele momento. Algu√©m deveria ter te protegido, mas n√£o havia ningu√©m."
            }},
            { name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è", text: {
                ko: "ÏûêÏã†ÏùÑ ÏßÄÌÇ§ÏßÄ Î™ªÌïú Í≤å ÏïÑÎãàÎùº, Í∑∏ ÏÉÅÌô©Ïù¥ ÎÑàÎ¨¥ ÏúÑÌòëÏ†ÅÏù¥ÏóàÎçò Í±∞Ïïº. ÎÑ§ ÏûòÎ™ªÏù¥ ÏïÑÎãàÏïº.",
                en: "You didn't fail to protect yourself, the situation was too threatening. It wasn't your fault.",
                pt: "Voc√™ n√£o falhou em se proteger, a situa√ß√£o era muito amea√ßadora. N√£o foi sua culpa."
            }},
            { name: "Sora", emoji: "üßï", text: {
                ko: "Í∑∏ÎÇ†Ïùò ÎÑàÎäî Ï∂©Î∂ÑÌûà ÎëêÎ†§Ïõ†Ïñ¥. ÎßêÌïòÏßÄ ÏïäÏùÄ Í≤å ÏïÑÎãàÎùº, ÎßêÌï† Ïàò ÏóÜÏóàÎçò Í±∞Ïïº.",
                en: "You were frightened enough that day. You didn't choose not to speak, you couldn't speak.",
                pt: "Voc√™ estava assustado o suficiente naquele dia. Voc√™ n√£o escolheu n√£o falar, voc√™ n√£o conseguia falar."
            }},
            { name: "Kael", emoji: "üßô", text: {
                ko: "ÏûêÍ∏∞ Î∞©Ïñ¥Î•º Î∞∞Ïö∞Í∏∞ Ï†ÑÏóê ÏÉÅÏ≤òÎ∞õÏùÄ ÏÇ¨ÎûåÏùÄ, Îäò Ï£ÑÏ±ÖÍ∞êÏùÑ Î®ºÏ†Ä Î∞∞Ïõå. Í∑∏Í±¥ ÎÑ§Í∞Ä ÏûòÎ™ªÌïú Í≤å ÏïÑÎãàÏïº.",
                en: "Those who get hurt before learning self-defense always learn guilt first. That's not something you did wrong.",
                pt: "Aqueles que se machucam antes de aprender autodefesa sempre aprendem a culpa primeiro. Isso n√£o √© algo que voc√™ fez de errado."
            }},
            { name: "Mira", emoji: "üßë‚Äçüé®", text: {
                ko: "Í∑∏Îïå ÎÑå ÎØ∏ÏÜåÎùºÎäî Î∞©Ìå®Î•º Îì§Í≥† ÏûàÏóàÏñ¥. Ïö∏ÏßÄ ÏïäÏúºÎ†§, Î¨¥ÎÑàÏßÄÏßÄ ÏïäÏúºÎ†§‚Ä¶ Í∑∏Í±¥ ÎßàÏßÄÎßâ ÌûòÏù¥ÏóàÏßÄ.",
                en: "You were holding a shield of smiles then. Trying not to cry, not to break down... that was your last strength.",
                pt: "Voc√™ estava segurando um escudo de sorrisos ent√£o. Tentando n√£o chorar, n√£o desmoronar... essa era sua √∫ltima for√ßa."
            }},
            { name: "Cris", emoji: "ü¶∏‚Äç‚ôÇÔ∏è", text: {
                ko: "Í∑∏Í±∏ Í∞ïÏöîÌïú ÏÇ¨ÎûåÏùÄ Ï±ÖÏûÑÏùÑ ÏßÄÏßÄ ÏïäÏïòÏßÄ. ÎåÄÏã† ÎÑàÎßå Ïä§Ïä§Î°úÎ•º Ï±ÖÎßùÌñàÏñ¥. Ïù¥Ï†† Î∞îÎÄåÏñ¥Ïïº Ìï¥.",
                en: "The person who forced that didn't take responsibility. Instead, only you blamed yourself. That needs to change now.",
                pt: "A pessoa que for√ßou isso n√£o assumiu responsabilidade. Em vez disso, apenas voc√™ se culpou. Isso precisa mudar agora."
            }},
            { name: "Enya", emoji: "üßë‚ÄçüöÄ", text: {
                ko: "Í∑∏ ÏÑ†ÌÉùÏùÄ ÎÑ§Í∞Ä ÏÇ¥ÏïÑÎÇ®Í∏∞ ÏúÑÌï¥ ÎßåÎì† Î≥∏Îä•Ïù¥ÏóàÏñ¥. Í∑∏Í±¥ Í≤∞ÏΩî ÏïΩÌï®Ïù¥ ÏïÑÎãàÏïº.",
                en: "That choice was an instinct you created to survive. That was never weakness.",
                pt: "Essa escolha foi um instinto que voc√™ criou para sobreviver. Isso nunca foi fraqueza."
            }},
            { name: "Lian", emoji: "üßò", text: {
                ko: "ÏßÄÍ∏à ÎÑàÎäî Í∑∏ÎïåÏùò ÎÑàÎ•º Î∞îÎùºÎ≥¥Î©∞ Î≥¥Ìò∏ÌïòÍ≥† Ïã∂Îã§Îäî ÎßàÏùåÏùÑ ÌíàÍ≥† ÏûàÏñ¥. Í∑∏Í≤ÉÏù¥ ÏπòÏú†Ïùò Ï≤´Í±∏ÏùåÏù¥Ïïº.",
                en: "Now you're looking at that version of yourself with a desire to protect. That's the first step of healing.",
                pt: "Agora voc√™ est√° olhando para aquela vers√£o de si mesmo com o desejo de proteger. Esse √© o primeiro passo da cura."
            }}
        ];

        const responseCharacters = [
            {
                name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "ÏßÑÏã¨ÏùÄ Î¨¥Í∏∞Í∞Ä ÏïÑÎãàÏïº. Ïò§ÌûàÎ†§ Í∞ÄÏû• Î∂ÄÎìúÎü¨Ïö¥ Î∞©Ìå®Ïïº. ÎÑàÎ•º ÏßÄÌÇ§Îäî Î∞©ÏãùÏù¥ Îã¨ÎùºÏßÑ Í±∞Ïïº.",
                        en: "Sincerity isn't a weapon. It's actually the softest shield. Your way of protecting yourself has changed.",
                        pt: "A sinceridade n√£o √© uma arma. √â na verdade o escudo mais suave. Sua maneira de se proteger mudou."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Lian", emoji: "üßò",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "ÎÑàÎäî Ïù¥Ï†ú, ÏûêÏã†ÏùÑ ÏßÄÌÇ§Îäî Î∞©Î≤ïÏùÑ Î∞∞Ïö∞Í≥† ÏûàÏñ¥. Îä¶ÏßÄ ÏïäÏïòÏñ¥.",
                        en: "You are now learning how to protect yourself. It's not too late.",
                        pt: "Voc√™ est√° agora aprendendo como se proteger. N√£o √© tarde demais."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Kael", emoji: "üßô",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "Í≥ºÍ±∞Î•º ÎßàÏ£ºÌïú Ïö©Í∏∞Îäî ÌòÑÏû¨Ïùò ÎÑàÎ•º Îçî Îã®Îã®ÌïòÍ≤å ÎßåÎì§Ïñ¥. ÎÑàÎäî ÏßÄÍ∏à, ÏÉàÎ°úÏö¥ ÏÑ†ÌÉùÏùÑ Ï§ÄÎπÑÌïòÍ≥† ÏûàÏñ¥.",
                        en: "The courage to face the past makes your present self stronger. You are now preparing to make new choices.",
                        pt: "A coragem de enfrentar o passado torna seu eu presente mais forte. Voc√™ est√° agora se preparando para fazer novas escolhas."
                    };
                    return responses[lang];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        let awaitingSecondResponse = false;
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('navigationTitle').textContent = translations[lang].navigationTitle;
            document.getElementById('nextPortalBtn').textContent = translations[lang].nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = translations[lang].stayPortalBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
            awaitingSecondResponse = false;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                localStorage.setItem('temarix_v4_portal18_complete', 'true');
                localStorage.setItem('temarix_v4_current_portal', '19');
                
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 19: ÏÜåÎ¶¨ ÏóÜÏù¥ ÌùêÎ•∏ Í∞êÏ†ïÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.' :
                    currentLanguage === 'en' ? 
                    'Moving to Portal 19: Emotions That Flowed Silently.' :
                    'Indo para Portal 19: Emo√ß√µes Que Flu√≠ram Silenciosamente.';
                alert(nextMessage);
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const stayMessage = currentLanguage === 'ko' ? 
                    'Ïù¥ ÏàúÍ∞ÑÍ≥º Îçî Î®∏Î¨ºÎ©∞ ÍπäÏù¥ ÏÑ±Ï∞∞ÌïòÏãúÍ≤†ÏäµÎãàÍπå?' :
                    currentLanguage === 'en' ? 
                    'Do you want to stay longer with this moment for deeper reflection?' :
                    'Deseja ficar mais tempo com este momento para reflex√£o mais profunda?';
                
                if (confirm(stayMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            console.log('Processing user input:', inputText);
            localStorage.setItem('temarix_v4_portal18_response', JSON.stringify({
                portal: "v4-18",
                resposta: inputText,
                step: awaitingSecondResponse ? "second" : "first",
                data: new Date().toISOString(),
                idioma: currentLanguage
            }));
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const secondResponseCharacters = [
                {
                    name: "Noah", emoji: "üßë‚Äçü¶±",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í∑∏ ÎßêÏùÑ Ïä§Ïä§Î°úÏóêÍ≤å Ìï¥Ï§ÄÎã§Îäî Í±¥, ÎãπÏã†Ïù¥ ÏûêÏã†ÏùÑ Ïö©ÏÑúÌïòÍ∏∞ ÏãúÏûëÌñàÎã§Îäî ÎúªÏù¥ÏóêÏöî.",
                            en: "Saying those words to yourself means you've started to forgive yourself.",
                            pt: "Dizer essas palavras para si mesmo significa que voc√™ come√ßou a se perdoar."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Cris", emoji: "ü¶∏‚Äç‚ôÇÔ∏è",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Ïù¥Ï†úÎäî ÎãπÏã†Ïù¥ ÏûêÏã†Ïùò ÏàòÌò∏ÏûêÍ∞Ä ÎêòÏñ¥Ï£ºÏÑ∏Ïöî. Í∑∏ Îã§ÏßêÏù¥ ÏßÑÏßú ÌûòÏù¥ÏóêÏöî.",
                            en: "Now you become your own guardian. That commitment is real strength.",
                            pt: "Agora voc√™ se torna seu pr√≥prio guardi√£o. Esse compromisso √© for√ßa real."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Enya", emoji: "üßë‚ÄçüöÄ",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "ÎãπÏã†ÏùÄ ÏßÄÍ∏à, Í≥ºÍ±∞Ïùò ÏÉÅÏ≤òÎ•º ÎØ∏ÎûòÏùò Î≥¥Ìò∏ÎßâÏúºÎ°ú Î∞îÍæ∏Í≥† ÏûàÏñ¥Ïöî.",
                            en: "You are now transforming past wounds into future protection.",
                            pt: "Voc√™ est√° agora transformando feridas passadas em prote√ß√£o futura."
                        };
                        return responses[lang];
                    }
                }
            ];
            
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < secondResponseCharacters.length; i++) {
                const char = secondResponseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < secondResponseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V4 Portal 18 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V4 Portal 18 DOM loaded');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>
                