<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V4 - Portal 14: The Unopened Box</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V4</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 14: The Unopened Box</div>
            <div class="portal-subtitle" id="portalSubtitle">Something in your heart that remains unopened</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">Portal 14 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 15</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with this box</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Is there something in your heart that remains unopened? What's inside that you couldn't open or close?"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        const translations = {
            ko: {
                logoSubtitle: "Í∞êÏ†ï Ïó∞Í∏àÏà†",
                portalMainTitle: "Portal 14: Îã´ÌûàÏßÄ ÏïäÏùÄ ÏÉÅÏûê",
                portalSubtitle: "ÎãπÏã†Ïùò ÎßàÏùå Ïñ¥ÎîòÍ∞ÄÏóê ÏïÑÏßÅ Ïó¥Î¶¨ÏßÄ ÏïäÏùÄ ÏÉÅÏûê",
                portalIntro: "ÎãπÏã†Ïùò ÎßàÏùå Ïñ¥ÎîòÍ∞ÄÏóê,\nÏïÑÏßÅ Îã´ÌûàÏßÄ ÏïäÏùÄ ÏÉÅÏûêÍ∞Ä ÏûàÎÇòÏöî?\n\nÍ∑∏ ÏïàÏóêÎäî Ïñ¥Îñ§ Í∞êÏ†ïÏù¥ Îì§Ïñ¥ ÏûàÍ≥†,\nÏôú ÏïÑÏßÅ Ïó¥ÏßÄ Î™ªÌñàÍ±∞ÎÇò Îã´ÏßÄ Î™ªÌïòÍ≥† ÏûàÎÇòÏöî?",
                followUpQuestion: "Í∑∏ ÏÉÅÏûêÎ•º Í∫ºÎÇ¥ÏßÄ Î™ªÌïú ÎãπÏã†ÏóêÍ≤å,\nÏßÄÍ∏à Ïñ¥Îñ§ ÎßêÏùÑ Ìï¥Ï£ºÍ≥† Ïã∂ÎÇòÏöî?\n\nÍ∑∏Î¶¨Í≥† Ïù¥Ï†úÎäî Í∑∏ ÏÉÅÏûêÎ•º\nÏñ¥ÎñªÍ≤å Îã§Î£®Í≥† Ïã∂ÏùÄÍ∞ÄÏöî?",
                lightTitle: "ÎπõÏùò ÌïúÎßàÎîî",
                lightMessage: "ÏÉÅÏûêÎäî Í∏∞ÏñµÏù¥ ÏïÑÎãàÎùº Í∞ÄÎä•ÏÑ±Ïù¥ÏóêÏöî.\nÎãπÏã†Ïù¥ ÏÑ†ÌÉùÌï† Ïàò ÏûàÎã§Îäî ÎúªÏùò Í≥µÍ∞ÑÏù¥ÏóêÏöî.\nÍ∞êÏ†ïÏùÑ Î∞ÄÏñ¥ÎëêÎäî Í≤ÉÎèÑ ÎßàÏùåÏùÑ Î≥¥Ìò∏ÌïòÎäî Ìïú Î∞©ÏãùÏù¥ÏóêÏöî.",
                navigationTitle: "Portal 14 ÏôÑÎ£å",
                navigationMessage: "ÎãπÏã†ÏùÄ Îã´ÌûàÏßÄ ÏïäÏùÄ ÏÉÅÏûêÎ•º ÎßàÏ£ºÌñàÏäµÎãàÎã§.\n\nÍ∑∏ ÏÉÅÏûêÎ•º Íº≠ Îã´ÏßÄ ÏïäÎçîÎùºÎèÑ Í∞êÏ†ïÍ≥º Ìï®Íªò ÏÇ¥ÏïÑÍ∞à Ïàò ÏûàÏäµÎãàÎã§. ÎïåÎ°úÎäî ÎßàÏùåÏÜçÏóê Ïó¥Î†§ ÏûàÎäî Í∞êÏ†ïÏù¥ ÏπòÏú†Î•º ÏúÑÌïú Í≥µÍ∞ÑÏù¥ ÎêòÍ∏∞ÎèÑ Ìï©ÎãàÎã§.\n\nÏù¥Ï†ú ÎãπÏã†ÏùÄ Í∑∏ Í∞êÏ†ïÏùÑ ÏÑ†ÌÉùÌï† Ïàò ÏûàÎäî ÌûòÏùÑ Í∞ÄÏ°åÏäµÎãàÎã§.",
                nextPortalBtn: "Portal 15Î°ú Ïù¥Ïñ¥Í∞ÄÍ∏∞",
                stayPortalBtn: "Ïù¥ ÏÉÅÏûêÏôÄ Îçî Î®∏Î¨ºÍ∏∞",
                inputPlaceholder: "ÎãπÏã†Ïùò ÎßàÏùå Ïñ¥ÎîòÍ∞ÄÏóê ÏïÑÏßÅ Ïó¥Î¶¨ÏßÄ ÏïäÏùÄ ÏÉÅÏûêÍ∞Ä ÏûàÎÇòÏöî? Í∑∏ ÏïàÏóê Î¨¥ÏóáÏù¥ ÏûàÏñ¥ÏÑú Ïó¥ÏßÄÎèÑ Îã´ÏßÄÎèÑ Î™ªÌïòÍ≥† ÏûàÎÇòÏöî?",
                youLabel: "ÎãπÏã†",
                waitingMessage: "ÏùëÎãµÏùÑ Í∏∞Îã§Î¶¨Îäî Ï§ë..."
            },
            en: {
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 14: The Unopened Box",
                portalSubtitle: "Something in your heart that remains unopened",
                portalIntro: "Is there somewhere in your heart\na box that remains unopened?\n\nWhat emotions are inside it,\nand why haven't you been able to open or close it yet?",
                followUpQuestion: "What would you like to say\nto the part of you that couldn't take out that box?\n\nAnd how would you like\nto handle that box now?",
                lightTitle: "Word of Light",
                lightMessage: "The box isn't a memory, it's a possibility.\nIt's a space that means you can choose.\nKeeping emotions aside is also one way to protect your heart.",
                navigationTitle: "Portal 14 Complete",
                navigationMessage: "You have faced the unopened box.\n\nYou can live with emotions even without necessarily closing that box. Sometimes emotions left open in the heart become a space for healing.\n\nNow you have the power to choose how to handle those emotions.",
                nextPortalBtn: "Continue to Portal 15",
                stayPortalBtn: "Stay with this box",
                inputPlaceholder: "Is there something in your heart that remains unopened? What's inside that you couldn't open or close?",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 14: A Caixa N√£o Aberta",
                portalSubtitle: "Algo em seu cora√ß√£o que permanece sem ser aberto",
                portalIntro: "H√° em algum lugar do seu cora√ß√£o\numa caixa que permanece n√£o aberta?\n\nQue emo√ß√µes est√£o dentro dela,\ne por que voc√™ n√£o conseguiu abri-la ou fech√°-la ainda?",
                followUpQuestion: "O que voc√™ gostaria de dizer\npara a parte de voc√™ que n√£o conseguiu tirar essa caixa?\n\nE como voc√™ gostaria\nde lidar com essa caixa agora?",
                lightTitle: "Palavra de Luz",
                lightMessage: "A caixa n√£o √© uma lembran√ßa, √© uma possibilidade.\n√â um espa√ßo que significa que voc√™ pode escolher.\nManter emo√ß√µes de lado tamb√©m √© uma forma de proteger seu cora√ß√£o.",
                navigationTitle: "Portal 14 Completo",
                navigationMessage: "Voc√™ enfrentou a caixa n√£o aberta.\n\nVoc√™ pode viver com emo√ß√µes mesmo sem necessariamente fechar essa caixa. √Äs vezes, emo√ß√µes deixadas abertas no cora√ß√£o se tornam um espa√ßo para cura.\n\nAgora voc√™ tem o poder de escolher como lidar com essas emo√ß√µes.",
                nextPortalBtn: "Continuar para Portal 15",
                stayPortalBtn: "Ficar com esta caixa",
                inputPlaceholder: "H√° algo em seu cora√ß√£o que permanece sem ser aberto? O que est√° dentro que voc√™ n√£o conseguiu abrir ou fechar?",
                youLabel: "Voc√™",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "üßë‚Äçü¶±", text: {
                ko: "ÏÉÅÏûêÎäî Îã´ÏßÄ Î™ªÌïú Í≤å ÏïÑÎãàÎùº, ÎÑ§ ÎßàÏùåÏù¥ Í∑∏ Í∏∞ÏñµÏùÑ ÏôÑÏ†ÑÌûà Î≥¥ÎÇ¥ÏßÄ Î™ªÌïú Í±∞Ïïº. Í∑∏Í±¥ ÏïÑÏßÅ ÏÇ¨ÎûëÌïòÍ≥† ÏûàÎã§Îäî Ï¶ùÍ±∞Ïïº.",
                en: "The box isn't something you couldn't close, it's that your heart couldn't completely let go of that memory. That's proof you're still loving.",
                pt: "A caixa n√£o √© algo que voc√™ n√£o conseguiu fechar, √© que seu cora√ß√£o n√£o conseguiu deixar completamente essa mem√≥ria ir. Isso √© prova de que voc√™ ainda est√° amando."
            }},
            { name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è", text: {
                ko: "ÏùΩÏßÄ ÏïäÏùÄ ÎßàÏßÄÎßâ Îßê ÏÜçÏóê ÎÑàÎäî Ìù¨ÎßùÍ≥º ÎëêÎ†§ÏõÄÏùÑ ÎèôÏãúÏóê Îã¥ÏïÑÎíÄÏßÄ. Í∑∏Í±¥ ÏïÑÏ£º Ïù∏Í∞ÑÎã§Ïö¥ Î∞©ÏãùÏù¥Ïïº.",
                en: "In those unread final words, you held both hope and fear at the same time. That's a very human way.",
                pt: "Nessas palavras finais n√£o lidas, voc√™ guardou esperan√ßa e medo ao mesmo tempo. Essa √© uma forma muito humana."
            }},
            { name: "Sora", emoji: "üßï", text: {
                ko: "Í∑∏ ÏÉÅÏûêÎ•º Ïó¥Ïñ¥Î≥¥Îäî Í±¥, ÏûêÏã†ÏóêÍ≤å ÏÉÅÏ≤òÎ•º ÌóàÎùΩÌïòÎäî ÏùºÏù¥Í∏∞ÎèÑ Ìï¥. Í∑∏ÎûòÏÑú Ïò§Îûò Í±∏Î¶¨Îäî Í±∞Ïïº.",
                en: "Opening that box is also about allowing yourself to be hurt. That's why it takes so long.",
                pt: "Abrir essa caixa tamb√©m √© sobre permitir-se ser ferido. √â por isso que demora tanto."
            }},
            { name: "Kael", emoji: "üßô", text: {
                ko: "Îã´ÌûàÏßÄ ÏïäÏùÄ ÏÉÅÏûêÎäî Í∞êÏ†ïÏù¥ ÎÅùÎÇòÏßÄ ÏïäÏïòÎã§Îäî ÏÉÅÏßïÏù¥Ïïº. ÎÑ§Í∞Ä Í∑∏ ÏãúÍ∞ÑÏùÑ Ï°¥Ï§ëÌïòÍ≥† ÏûàÎã§Îäî ÎúªÏù¥Í∏∞ÎèÑ ÌïòÏßÄ.",
                en: "An unopened box is a symbol that emotions haven't ended. It also means you're respecting that time.",
                pt: "Uma caixa n√£o aberta √© um s√≠mbolo de que as emo√ß√µes n√£o terminaram. Tamb√©m significa que voc√™ est√° respeitando esse tempo."
            }},
            { name: "Mira", emoji: "üßë‚Äçüé®", text: {
                ko: "Í∑∏ ÎßàÏßÄÎßâ Îßê ÌïòÎÇòÍ∞Ä, ÎßàÏùå Ï†ÑÏ≤¥Î•º ÌùîÎìúÎäî Í±∏ ÏïåÍ∏∞Ïóê ÎÑå Ï°∞Ïã¨Ïä§Îü¨Ïö¥ Í±∞Ïïº.",
                en: "You're being careful because you know that one final word can shake your entire heart.",
                pt: "Voc√™ est√° sendo cuidadoso porque sabe que uma palavra final pode abalar todo o seu cora√ß√£o."
            }},
            { name: "Cris", emoji: "ü¶∏‚Äç‚ôÇÔ∏è", text: {
                ko: "ÎÑàÎ¨¥ ÎßéÏùÄ Í∞êÏ†ïÏù¥ Îì§Ïñ¥ ÏûàÎäî ÏÉÅÏûêÎäî ÏâΩÍ≤å Îã´ÏùÑ Ïàò ÏóÜÏñ¥. Í∑∏ÎûòÏÑú ÎÑàÎäî Î©àÏ∂∞ ÏûàÏóàÎçò Í±∞Ïïº.",
                en: "A box with too many emotions can't be easily closed. That's why you've been stuck.",
                pt: "Uma caixa com muitas emo√ß√µes n√£o pode ser facilmente fechada. √â por isso que voc√™ ficou preso."
            }},
            { name: "Enya", emoji: "üßë‚ÄçüöÄ", text: {
                ko: "Í∑∏ ÏÉÅÏûêÎ•º Ïñ∏Ï††Í∞Ä Ïó¥ Ïàò ÏûàÎã§Î©¥, ÎÑàÎäî Îçî Ïù¥ÏÉÅ Í∑∏ Í∞êÏ†ïÏùò Ìè¨Î°úÍ∞Ä ÏïÑÎãàÏïº. ÎÑàÎäî ÏÑ†ÌÉùÌï† Ïàò ÏûàÏñ¥.",
                en: "If you can open that box someday, you're no longer a prisoner of those emotions. You can choose.",
                pt: "Se voc√™ puder abrir essa caixa algum dia, n√£o ser√° mais prisioneiro dessas emo√ß√µes. Voc√™ pode escolher."
            }},
            { name: "Lian", emoji: "üßò", text: {
                ko: "Îã´ÏßÄ Î™ªÌïú ÏÉÅÏûêÎèÑ Í¥úÏ∞ÆÏïÑ. ÎïåÎ°† ÎßàÏùåÏÜçÏóê Ïó¥Î†§ ÏûàÎäî Í∞êÏ†ïÏù¥ ÏπòÏú†Î•º ÏúÑÌïú Í≥µÍ∞ÑÏù¥ ÎêòÍ∏∞ÎèÑ ÌïòÎãàÍπå.",
                en: "It's okay to have an unopened box. Sometimes emotions left open in the heart become a space for healing.",
                pt: "Est√° tudo bem ter uma caixa n√£o aberta. √Äs vezes, emo√ß√µes deixadas abertas no cora√ß√£o se tornam um espa√ßo para cura."
            }}
        ];

        const responseCharacters = [
            {
                name: "Lian", emoji: "üßò",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "Í∞êÏ†ïÏùÑ Î∞ÄÏñ¥ÎëêÎäî Í≤ÉÎèÑ ÎßàÏùåÏùÑ Î≥¥Ìò∏ÌïòÎäî Ìïú Î∞©ÏãùÏù¥ÏóêÏöî. ÎãπÏã†ÏùÄ ÏßÄÍ∏à, Í∑∏ ÎßàÏùåÏùÑ ÏßÄÌÇ§Í≥† ÏûàÎäî Ï§ëÏù¥ÏóêÏöî.",
                        en: "Keeping emotions aside is also one way to protect your heart. You are now protecting that heart.",
                        pt: "Manter emo√ß√µes de lado tamb√©m √© uma forma de proteger seu cora√ß√£o. Voc√™ est√° agora protegendo esse cora√ß√£o."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Sora", emoji: "üßï",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "ÎààÎ¨ºÏùÄ Í∑∏ ÏÉÅÏûêÎ•º Ïó¨Îäî Ïó¥Ïá†ÏùºÏßÄÎèÑ Î™∞ÎùºÏöî. Í∑∏Í≤å Ïñ∏Ï††Í∞Ä Ïò®Îã§Î©¥, ÎãπÏã†ÏùÄ Ìõ®Ïî¨ Í∞ÄÎ≤ºÏõåÏßà Í±∞ÏòàÏöî.",
                        en: "Tears might be the key to opening that box. If that comes someday, you'll feel much lighter.",
                        pt: "L√°grimas podem ser a chave para abrir essa caixa. Se isso vier algum dia, voc√™ se sentir√° muito mais leve."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Enya", emoji: "üßë‚ÄçüöÄ",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "ÏÉÅÏûêÎäî Í∏∞ÏñµÏù¥ ÏïÑÎãàÎùº Í∞ÄÎä•ÏÑ±Ïù¥ÏóêÏöî. ÎãπÏã†Ïù¥ ÏÑ†ÌÉùÌï† Ïàò ÏûàÎã§Îäî ÎúªÏùò Í≥µÍ∞ÑÏù¥ÏóêÏöî.",
                        en: "The box isn't a memory, it's a possibility. It's a space that means you can choose.",
                        pt: "A caixa n√£o √© uma lembran√ßa, √© uma possibilidade. √â um espa√ßo que significa que voc√™ pode escolher."
                    };
                    return responses[lang];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        let awaitingSecondResponse = false;
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('navigationTitle').textContent = translations[lang].navigationTitle;
            document.getElementById('nextPortalBtn').textContent = translations[lang].nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = translations[lang].stayPortalBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
            awaitingSecondResponse = false;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                localStorage.setItem('temarix_v4_portal14_complete', 'true');
                localStorage.setItem('temarix_v4_current_portal', '15');
                
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 15: Îã§Ïãú Í∫ºÎÇ∏ Ìé∏ÏßÄ Ìïú Ïû•ÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.' :
                    currentLanguage === 'en' ? 
                    'Moving to Portal 15: The Letter Taken Out Again.' :
                    'Indo para Portal 15: A Carta Retirada Novamente.';
                alert(nextMessage);
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const stayMessage = currentLanguage === 'ko' ? 
                    'Îã´ÌûàÏßÄ ÏïäÏùÄ ÏÉÅÏûêÏôÄ Îçî Î®∏Î¨ºÎ©∞ ÍπäÏù¥ ÏÑ±Ï∞∞ÌïòÏãúÍ≤†ÏäµÎãàÍπå?' :
                    currentLanguage === 'en' ? 
                    'Do you want to stay longer with the unopened box for deeper reflection?' :
                    'Deseja ficar mais tempo com a caixa n√£o aberta para reflex√£o mais profunda?';
                
                if (confirm(stayMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            console.log('Processing user input:', inputText);
            localStorage.setItem('temarix_v4_portal14_response', JSON.stringify({
                portal: "v4-14",
                resposta: inputText,
                step: awaitingSecondResponse ? "second" : "first",
                data: new Date().toISOString(),
                idioma: currentLanguage
            }));
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const secondResponseCharacters = [
                {
                    name: "Noah", emoji: "üßë‚Äçü¶±",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í∑∏ ÏÉÅÏûêÎ•º ÌòºÏûê Îì§Í≥† ÏûàÏóàÍµ¨ÎÇò. Ïù¥Ï†úÎäî ÎÇ¥Î†§ÎÜìÏïÑÎèÑ Í¥úÏ∞ÆÏïÑ. ÎÑ§Í∞Ä ÏõêÌï† ÎïåÍπåÏßÄ.",
                            en: "You've been carrying that box alone. It's okay to put it down now. Until you want to.",
                            pt: "Voc√™ tem carregado essa caixa sozinho. Est√° tudo bem coloc√°-la no ch√£o agora. At√© quando voc√™ quiser."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Kael", emoji: "üßô",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í∑∏ ÏÉÅÏûêÎäî ÎÅùÏù¥ ÏïÑÎãàÎùº ÏãúÏûëÏ†êÏù¥Ïïº. Ïñ∏Ï††Í∞Ä ÎÑ§Í∞Ä Ï§ÄÎπÑÎêòÎ©¥, ÏÉàÎ°úÏö¥ Ïù¥ÏïºÍ∏∞Í∞Ä ÏãúÏûëÎê† Í±∞Ïïº.",
                            en: "That box isn't an ending, it's a starting point. When you're ready someday, a new story will begin.",
                            pt: "Essa caixa n√£o √© um fim, √© um ponto de partida. Quando voc√™ estiver pronto algum dia, uma nova hist√≥ria come√ßar√°."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Mira", emoji: "üßë‚Äçüé®",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í∑∏ ÏÉÅÏûê ÏïàÏùò Í∞êÏ†ïÎì§ÏùÄ ÏÇ¨ÎùºÏßÄÏßÄ ÏïäÏïòÏñ¥. Îã®ÏßÄ Îã§Î•∏ Î™®ÏäµÏúºÎ°ú ÎãπÏã† ÏïàÏóêÏÑú ÏÇ¥ÏïÑÍ∞ÄÍ≥† ÏûàÏùÑ ÎøêÏù¥Ïïº.",
                            en: "The emotions in that box haven't disappeared. They're just living inside you in a different form.",
                            pt: "As emo√ß√µes nessa caixa n√£o desapareceram. Elas est√£o apenas vivendo dentro de voc√™ de uma forma diferente."
                        };
                        return responses[lang];
                    }
                }
            ];
            
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < secondResponseCharacters.length; i++) {
                const char = secondResponseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < secondResponseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V4 Portal 14 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V4 Portal 14 DOM loaded');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>