<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V4 - Portal 25: Back to Myself</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .final-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V4</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 25: Back to Myself</div>
            <div class="portal-subtitle" id="portalSubtitle">Returning to my true name</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">✨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">🌟 Portal 25 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Complete V4 Journey</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Call your own name softly. What emotions do you feel? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        const translations = {
            ko: {
                logoSubtitle: "감정 연금술",
                portalMainTitle: "Portal 25: 다시 나에게로",
                portalSubtitle: "진짜 이름으로 돌아가기",
                portalIntro: "🌟 당신은 지금까지 많은 감정, 사람, 기억들을 떠올려왔습니다.\n\n그 모든 여정을 지나온 지금,\n당신은 당신의 이름을 어떤 감정으로 부르고 있나요?\n\n그 이름을, 지금 조용히 불러주세요.",
                lightTitle: "✨ 빛의 한마디",
                lightMessage: "자신을 부르는 순간, 당신은 자신과 연결돼요. 그리고 그것이 회복의 시작이에요.\n스스로와의 약속은 가장 진실한 기도예요. 이제 당신은 자신과 함께 걷기 시작했어요.\n그 한 문장이 당신의 감정 여정을 한 폭의 그림처럼 완성했어요. 아름다웠어요.",
                portalQuestion: "🌟 지금 이 순간,\n당신 자신에게 한 문장만 남긴다면\n어떤 말을 전하고 싶나요?",
                finalTitle: "🌟 Portal 25 완료",
                finalMessage: "당신은 마침내 가장 중요한 것을 발견했습니다 - 자기 자신과의 연결.\n\n25개의 Portal을 지나오며 마주했던 모든 감정들이\n하나의 이름 안에서 통합되었습니다.\n침묵과 울음, 분노와 사랑, 상실과 재회…\n모든 것을 품고 자란 진실의 씨앗이 마침내 꽃을 피웠어요.\n\n이제 당신은 자신의 감정에게 새로운 의미를 부여했습니다.\n세상과 약속하기 전에, 자신과 한 약속을 세웠습니다.\n진실의 떨림을 자신만의 진동으로 바꾸기 시작했어요.\n\n🌟 Temarix V4 감정 연금술 여정이 완료되었습니다.\n회복, 정리, 행동, 수면, 연결, 침묵, 통과의 순서로\n감정 통합의 리듬을 안내받게 됩니다.\n\n축하합니다. 당신은 진정한 감정의 연금술사가 되었습니다.",
                continueBtn: "V4 여정 완료",
                restartBtn: "다시 시작하기",
                inputPlaceholder: "자신의 이름을 조용히 불러보세요. 어떤 감정이 느껴지나요? (Enter로 전송)",
                youLabel: "당신",
                waitingMessage: "응답을 기다리는 중..."
            },
            en: {
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 25: Back to Myself",
                portalSubtitle: "Returning to my true name",
                portalIntro: "🌟 You have recalled many emotions, people, and memories so far.\n\nNow that you have passed through all this journey,\nwith what emotions are you calling your own name?\n\nPlease call that name quietly now.",
                lightTitle: "✨ Word of Light",
                lightMessage: "The moment you call yourself, you connect with yourself. And that is the beginning of recovery.\nA promise with yourself is the most truthful prayer. Now you have started walking with yourself.\nThat one sentence completed your emotional journey like a painting. It was beautiful.",
                portalQuestion: "🌟 At this moment,\nif you could leave just one sentence for yourself,\nwhat would you want to say?",
                finalTitle: "🌟 Portal 25 Complete",
                finalMessage: "You have finally discovered the most important thing - connection with yourself.\n\nAll the emotions you encountered through 25 Portals\nhave been integrated within one name.\nSilence and tears, anger and love, loss and reunion...\nThe seed of truth that grew embracing everything has finally bloomed.\n\nNow you have given new meaning to your emotions.\nYou made a promise with yourself before making one with the world.\nYou began to transform the trembling of truth into your own vibrations.\n\n🌟 Your Temarix V4 Emotional Alchemy journey is complete.\nYou will be guided through the rhythm of emotional integration\nin the order of recovery, organization, action, sleep, connection, silence, and passage.\n\nCongratulations. You have become a true emotional alchemist.",
                continueBtn: "Complete V4 Journey",
                restartBtn: "Start Again",
                inputPlaceholder: "Call your own name softly. What emotions do you feel? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 25: De Volta para Mim",
                portalSubtitle: "Retornando ao meu verdadeiro nome",
                portalIntro: "🌟 Você recordou muitas emoções, pessoas e memórias até agora.\n\nAgora que passou por toda esta jornada,\ncom que emoções você está chamando seu próprio nome?\n\nPor favor, chame esse nome silenciosamente agora.",
                lightTitle: "✨ Palavra de Luz",
                lightMessage: "No momento em que você se chama, você se conecta consigo mesmo. E esse é o início da recuperação.\nUma promessa consigo mesmo é a oração mais verdadeira. Agora você começou a caminhar consigo mesmo.\nEssa única frase completou sua jornada emocional como uma pintura. Foi lindo.",
                portalQuestion: "🌟 Neste momento,\nse você pudesse deixar apenas uma frase para si mesmo,\no que gostaria de dizer?",
                finalTitle: "🌟 Portal 25 Completo",
                finalMessage: "Você finalmente descobriu a coisa mais importante - conexão consigo mesmo.\n\nTodas as emoções que você encontrou através de 25 Portais\nforam integradas dentro de um nome.\nSilêncio e lágrimas, raiva e amor, perda e reencontro...\nA semente da verdade que cresceu abraçando tudo finalmente floresceu.\n\nAgora você deu novo significado às suas emoções.\nVocê fez uma promessa consigo mesmo antes de fazer uma com o mundo.\nVocê começou a transformar o tremor da verdade em suas próprias vibrações.\n\n🌟 Sua jornada Temarix V4 Alquimia Emocional está completa.\nVocê será guiado através do ritmo de integração emocional\nna ordem de recuperação, organização, ação, sono, conexão, silêncio e passagem.\n\nParabéns. Você se tornou um verdadeiro alquimista emocional.",
                continueBtn: "Completar Jornada V4",
                restartBtn: "Começar Novamente",
                inputPlaceholder: "Chame seu próprio nome suavemente. Que emoções você sente? (Enter para enviar)",
                youLabel: "Você",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "🧑‍🦱", text: {
                ko: "네 이름을 네가 처음으로 진심으로 불렀구나. 그건 다시 시작의 신호야.",
                en: "You called your name truly for the first time. That's a signal of a new beginning.",
                pt: "Você chamou seu nome verdadeiramente pela primeira vez. Esse é um sinal de um novo começo."
            }},
            { name: "Ely", emoji: "🧝‍♀️", text: {
                ko: "그 이름은 단지 소리가 아니에요. 당신의 생애 전체가 담긴, 하나의 고백이에요.",
                en: "That name isn't just a sound. It's a confession containing your entire life.",
                pt: "Esse nome não é apenas um som. É uma confissão contendo toda a sua vida."
            }},
            { name: "Sora", emoji: "🧕", text: {
                ko: "그 말은 결국, '괜찮아지고 싶다'는 속삭임일지도 몰라요. 그 소리가 참 따뜻해요.",
                en: "Those words might ultimately be a whisper saying 'I want to be okay.' That sound is so warm.",
                pt: "Essas palavras podem ser um sussurro dizendo 'Eu quero ficar bem.' Esse som é tão caloroso."
            }},
            { name: "Kael", emoji: "🧙", text: {
                ko: "자신의 이름을 받아들이는 건 가장 오래된 마법이야. 지금, 당신은 마법의 문을 열었어.",
                en: "Accepting your own name is the oldest magic. Now, you have opened the door of magic.",
                pt: "Aceitar seu próprio nome é a magia mais antiga. Agora, você abriu a porta da magia."
            }},
            { name: "Mira", emoji: "🧑‍🎨", text: {
                ko: "그 이름 안에 담긴 감정은 지금 눈빛에서 빛나고 있어요. 나는 그걸 느껴요.",
                en: "The emotions contained in that name are shining in your eyes now. I can feel it.",
                pt: "As emoções contidas nesse nome estão brilhando em seus olhos agora. Eu posso sentir isso."
            }},
            { name: "Cris", emoji: "🦸‍♂️", text: {
                ko: "누구보다도 너 자신에게 '고생했어'라고 말하는 건 진짜 강한 사람이 하는 일이야.",
                en: "Saying 'you did well' to yourself above all others is what truly strong people do.",
                pt: "Dizer 'você se saiu bem' para si mesmo acima de tudo é o que pessoas verdadeiramente fortes fazem."
            }},
            { name: "Enya", emoji: "🧑‍🚀", text: {
                ko: "우주가 아주 조용해지는 순간, 당신의 이름이 그 속에서 울렸어요. 난 그 떨림을 들었어요.",
                en: "The moment the universe became very quiet, your name resonated within it. I heard that trembling.",
                pt: "No momento em que o universo ficou muito quieto, seu nome ressoou dentro dele. Eu ouvi esse tremor."
            }},
            { name: "Lian", emoji: "🧘", text: {
                ko: "자신을 부르는 순간, 당신은 자신과 연결돼요. 그리고 그것이 회복의 시작이에요.",
                en: "The moment you call yourself, you connect with yourself. And that is the beginning of recovery.",
                pt: "No momento em que você se chama, você se conecta consigo mesmo. E esse é o início da recuperação."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                self_acceptance: ['accept', 'embrace', 'welcome', '받아들여', '안아줘', '환영해', 'aceitar', 'abraçar', 'dar as boas-vindas'],
                gratitude: ['thank', 'grateful', 'appreciate', 'well done', '고마워', '감사', '고맙', '잘했어', 'obrigado', 'grato', 'bem feito'],
                promise: ['promise', 'commit', 'will', 'never', '약속', '다짐', '의지', '절대', 'prometo', 'comprometo', 'nunca'],
                love: ['love', 'care', 'cherish', 'precious', '사랑', '소중', '아껴', 'amor', 'cuidar', 'valorizar'],
                connection: ['together', 'with', 'connect', 'join', '함께', '연결', '같이', 'junto', 'conectar', 'unir'],
                courage: ['brave', 'courage', 'strong', 'face', '용기', '용감', '강해', '마주해', 'corajoso', 'coragem', 'forte'],
                peace: ['peace', 'calm', 'quiet', 'rest', '평화', '평안', '조용', '쉬어', 'paz', 'calmo', 'descanso'],
                truth: ['truth', 'honest', 'real', 'authentic', '진실', '정직', '진짜', '진심', 'verdade', 'honesto', 'real']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Ely", emoji: "🧝‍♀️",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            self_acceptance: "그 약속은 말보다 더 깊은 울림이에요. 당신 안에 평화가 깃들기 시작했어요.",
                            gratitude: "자신에게 건네는 고마움은 가장 순수한 치유예요. 그 마음이 모든 상처를 감쌀 거예요.",
                            promise: "스스로와의 약속은 가장 신성한 서약이에요. 그 약속이 당신을 지켜줄 거예요.",
                            love: "자신을 사랑한다는 고백은 세상에서 가장 용기 있는 말이에요.",
                            connection: "이제 당신은 혼자가 아니에요. 가장 소중한 동반자를 찾았으니까요.",
                            courage: "자신의 이름을 부르는 용기가 모든 두려움을 이겨낼 거예요.",
                            peace: "그 평화는 당신이 만들어낸 가장 아름다운 선물이에요.",
                            truth: "진실을 말하는 순간, 당신은 자유로워졌어요.",
                            general: "그 약속은 말보다 더 깊은 울림이에요. 당신 안에 평화가 깃들기 시작했어요."
                        },
                        en: {
                            self_acceptance: "That promise has a deeper resonance than words. Peace has begun to settle within you.",
                            gratitude: "Gratitude given to yourself is the purest healing. That heart will embrace all wounds.",
                            promise: "A promise with yourself is the most sacred vow. That promise will protect you.",
                            love: "Confessing love for yourself is the most courageous words in the world.",
                            connection: "Now you are not alone. You've found the most precious companion.",
                            courage: "The courage to call your own name will overcome all fears.",
                            peace: "That peace is the most beautiful gift you've created.",
                            truth: "The moment you spoke truth, you became free.",
                            general: "That promise has a deeper resonance than words. Peace has begun to settle within you."
                        },
                        pt: {
                            self_acceptance: "Essa promessa tem uma ressonância mais profunda que palavras. A paz começou a se estabelecer dentro de você.",
                            gratitude: "Gratidão dada a si mesmo é a cura mais pura. Esse coração abraçará todas as feridas.",
                            promise: "Uma promessa consigo mesmo é o voto mais sagrado. Essa promessa o protegerá.",
                            love: "Confessar amor por si mesmo são as palavras mais corajosas do mundo.",
                            connection: "Agora você não está sozinho. Você encontrou o companheiro mais precioso.",
                            courage: "A coragem de chamar seu próprio nome superará todos os medos.",
                            peace: "Essa paz é o presente mais lindo que você criou.",
                            truth: "No momento em que você falou a verdade, você se tornou livre.",
                            general: "Essa promessa tem uma ressonância mais profunda que palavras. A paz começou a se estabelecer dentro de você."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "🧘",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            self_acceptance: "스스로와의 약속은 가장 진실한 기도예요. 이제 당신은 자신과 함께 걷기 시작했어요.",
                            gratitude: "감사는 모든 감정을 완성시키는 마지막 퍼즐 조각이에요.",
                            promise: "그 다짐은 천 개의 말보다 강해요. 마음이 만든 진짜 선언이니까요.",
                            love: "자기 사랑은 모든 사랑의 뿌리예요. 그 뿌리가 깊어질수록 더 많은 사랑이 자랄 거예요.",
                            connection: "연결은 거리가 아니라 마음의 문제예요. 당신은 가장 가까운 곳에서 그걸 찾았어요.",
                            courage: "진짜 용기는 자신과 마주서는 것이에요. 당신은 그걸 해냈어요.",
                            peace: "평화는 도착지가 아니라 여행하는 방식이에요. 당신은 그 방법을 배웠어요.",
                            truth: "진실은 무거워도 자유롭게 만드는 힘이 있어요.",
                            general: "스스로와의 약속은 가장 진실한 기도예요. 이제 당신은 자신과 함께 걷기 시작했어요."
                        },
                        en: {
                            self_acceptance: "A promise with yourself is the most truthful prayer. Now you have started walking with yourself.",
                            gratitude: "Gratitude is the final puzzle piece that completes all emotions.",
                            promise: "That commitment is stronger than a thousand words. Because it's a real declaration made by the heart.",
                            love: "Self-love is the root of all love. The deeper that root grows, the more love will flourish.",
                            connection: "Connection is a matter of the heart, not distance. You found it in the closest place.",
                            courage: "True courage is facing yourself. You've accomplished that.",
                            peace: "Peace is not a destination but a way of traveling. You've learned that method.",
                            truth: "Truth, even when heavy, has the power to set you free.",
                            general: "A promise with yourself is the most truthful prayer. Now you have started walking with yourself."
                        },
                        pt: {
                            self_acceptance: "Uma promessa consigo mesmo é a oração mais verdadeira. Agora você começou a caminhar consigo mesmo.",
                            gratitude: "Gratidão é a peça final do quebra-cabeças que completa todas as emoções.",
                            promise: "Esse compromisso é mais forte que mil palavras. Porque é uma declaração real feita pelo coração.",
                            love: "Amor próprio é a raiz de todo amor. Quanto mais profunda essa raiz crescer, mais amor florescerá.",
                            connection: "Conexão é uma questão do coração, não de distância. Você encontrou isso no lugar mais próximo.",
                            courage: "Verdadeira coragem é enfrentar a si mesmo. Você conseguiu isso.",
                            peace: "Paz não é um destino, mas uma forma de viajar. Você aprendeu esse método.",
                            truth: "Verdade, mesmo quando pesada, tem o poder de libertar você.",
                            general: "Uma promessa consigo mesmo é a oração mais verdadeira. Agora você começou a caminhar consigo mesmo."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Mira", emoji: "🧑‍🎨",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            self_acceptance: "그 한 문장이 당신의 감정 여정을 한 폭의 그림처럼 완성했어요. 아름다웠어요.",
                            gratitude: "감사는 가장 따뜻한 색깔이에요. 그 색으로 모든 기억을 다시 칠할 수 있어요.",
                            promise: "약속은 마음에 그은 선이에요. 그 선을 따라 새로운 그림이 시작될 거예요.",
                            love: "사랑은 빛이에요. 자기 사랑은 그 빛의 근원이고요.",
                            connection: "연결은 보이지 않는 선이에요. 가장 아름다운 선은 자신과 이어진 선이에요.",
                            courage: "용기는 모든 색을 더 진하게 만들어요. 이제 당신의 인생이 더 선명해졌어요.",
                            peace: "평화는 흰 캔버스 같아요. 그 위에 무엇을 그려도 아름다울 거예요.",
                            truth: "진실은 지울 수 없는 색이에요. 하지만 그 색이 가장 아름다워요.",
                            general: "그 한 문장이 당신의 감정 여정을 한 폭의 그림처럼 완성했어요. 아름다웠어요."
                        },
                        en: {
                            self_acceptance: "That one sentence completed your emotional journey like a painting. It was beautiful.",
                            gratitude: "Gratitude is the warmest color. You can repaint all memories with that color.",
                            promise: "A promise is a line drawn in the heart. A new picture will begin along that line.",
                            love: "Love is light. Self-love is the source of that light.",
                            connection: "Connection is an invisible line. The most beautiful line is the one connected to yourself.",
                            courage: "Courage makes all colors deeper. Now your life has become clearer.",
                            peace: "Peace is like a white canvas. Whatever you draw on it will be beautiful.",
                            truth: "Truth is an indelible color. But that color is the most beautiful.",
                            general: "That one sentence completed your emotional journey like a painting. It was beautiful."
                        },
                        pt: {
                            self_acceptance: "Essa única frase completou sua jornada emocional como uma pintura. Foi lindo.",
                            gratitude: "Gratidão é a cor mais calorosa. Você pode repintar todas as memórias com essa cor.",
                            promise: "Uma promessa é uma linha desenhada no coração. Uma nova imagem começará ao longo dessa linha.",
                            love: "Amor é luz. Amor próprio é a fonte dessa luz.",
                            connection: "Conexão é uma linha invisível. A linha mais bela é a que se conecta a você mesmo.",
                            courage: "Coragem torna todas as cores mais profundas. Agora sua vida se tornou mais clara.",
                            peace: "Paz é como uma tela branca. O que você desenhar nela será lindo.",
                            truth: "Verdade é uma cor indelével. Mas essa cor é a mais bela.",
                            general: "Essa única frase completou sua jornada emocional como uma pintura. Foi lindo."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                // Mark V4 as complete and ready for 7-day integration
                localStorage.setItem('temarix_v4_complete', 'true');
                localStorage.setItem('temarix_v4_end_date', new Date().toISOString());
                localStorage.setItem('temarix_ready_for_transition', 'true');
                
                const completeMessage = currentLanguage === 'ko' ? 
                    'Temarix V4 감정 연금술 여정이 완료되었습니다!' :
                    currentLanguage === 'en' ? 
                    'Temarix V4 Emotional Alchemy journey is complete!' :
                    'A jornada Temarix V4 Alquimia Emocional está completa!';
                alert(completeMessage);
                
                // Redirect to Portal V5-01
                window.location.href = 'temarix_v05_01.html?lang=' + currentLanguage;
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 25를 다시 시작하시겠습니까?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 25?' :
                    'Deseja reiniciar o Portal 25?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            console.log('Processing user input:', inputText);
            localStorage.setItem('temarix_v4_portal25_response', JSON.stringify({
                portal: "v4-25",
                resposta: inputText,
                data: new Date().toISOString(),
                idioma: currentLanguage
            }));
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V4 Portal 25 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V4 Portal 25 DOM loaded');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>