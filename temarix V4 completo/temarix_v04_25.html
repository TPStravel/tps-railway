<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V4 - Portal 25: Back to Myself</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .final-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V4</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 25: Back to Myself</div>
            <div class="portal-subtitle" id="portalSubtitle">Returning to my true name</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸŒŸ Portal 25 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Complete V4 Journey</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Call your own name softly. What emotions do you feel? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        const translations = {
            ko: {
                logoSubtitle: "ê°ì • ì—°ê¸ˆìˆ ",
                portalMainTitle: "Portal 25: ë‹¤ì‹œ ë‚˜ì—ê²Œë¡œ",
                portalSubtitle: "ì§„ì§œ ì´ë¦„ìœ¼ë¡œ ëŒì•„ê°€ê¸°",
                portalIntro: "ðŸŒŸ ë‹¹ì‹ ì€ ì§€ê¸ˆê¹Œì§€ ë§Žì€ ê°ì •, ì‚¬ëžŒ, ê¸°ì–µë“¤ì„ ë– ì˜¬ë ¤ì™”ìŠµë‹ˆë‹¤.\n\nê·¸ ëª¨ë“  ì—¬ì •ì„ ì§€ë‚˜ì˜¨ ì§€ê¸ˆ,\në‹¹ì‹ ì€ ë‹¹ì‹ ì˜ ì´ë¦„ì„ ì–´ë–¤ ê°ì •ìœ¼ë¡œ ë¶€ë¥´ê³  ìžˆë‚˜ìš”?\n\nê·¸ ì´ë¦„ì„, ì§€ê¸ˆ ì¡°ìš©ížˆ ë¶ˆëŸ¬ì£¼ì„¸ìš”.",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ìžì‹ ì„ ë¶€ë¥´ëŠ” ìˆœê°„, ë‹¹ì‹ ì€ ìžì‹ ê³¼ ì—°ê²°ë¼ìš”. ê·¸ë¦¬ê³  ê·¸ê²ƒì´ íšŒë³µì˜ ì‹œìž‘ì´ì—ìš”.\nìŠ¤ìŠ¤ë¡œì™€ì˜ ì•½ì†ì€ ê°€ìž¥ ì§„ì‹¤í•œ ê¸°ë„ì˜ˆìš”. ì´ì œ ë‹¹ì‹ ì€ ìžì‹ ê³¼ í•¨ê»˜ ê±·ê¸° ì‹œìž‘í–ˆì–´ìš”.\nê·¸ í•œ ë¬¸ìž¥ì´ ë‹¹ì‹ ì˜ ê°ì • ì—¬ì •ì„ í•œ í­ì˜ ê·¸ë¦¼ì²˜ëŸ¼ ì™„ì„±í–ˆì–´ìš”. ì•„ë¦„ë‹¤ì› ì–´ìš”.",
                portalQuestion: "ðŸŒŸ ì§€ê¸ˆ ì´ ìˆœê°„,\në‹¹ì‹  ìžì‹ ì—ê²Œ í•œ ë¬¸ìž¥ë§Œ ë‚¨ê¸´ë‹¤ë©´\nì–´ë–¤ ë§ì„ ì „í•˜ê³  ì‹¶ë‚˜ìš”?",
                finalTitle: "ðŸŒŸ Portal 25 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ë§ˆì¹¨ë‚´ ê°€ìž¥ ì¤‘ìš”í•œ ê²ƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤ - ìžê¸° ìžì‹ ê³¼ì˜ ì—°ê²°.\n\n25ê°œì˜ Portalì„ ì§€ë‚˜ì˜¤ë©° ë§ˆì£¼í–ˆë˜ ëª¨ë“  ê°ì •ë“¤ì´\ní•˜ë‚˜ì˜ ì´ë¦„ ì•ˆì—ì„œ í†µí•©ë˜ì—ˆìŠµë‹ˆë‹¤.\nì¹¨ë¬µê³¼ ìš¸ìŒ, ë¶„ë…¸ì™€ ì‚¬ëž‘, ìƒì‹¤ê³¼ ìž¬íšŒâ€¦\nëª¨ë“  ê²ƒì„ í’ˆê³  ìžëž€ ì§„ì‹¤ì˜ ì”¨ì•—ì´ ë§ˆì¹¨ë‚´ ê½ƒì„ í”¼ì› ì–´ìš”.\n\nì´ì œ ë‹¹ì‹ ì€ ìžì‹ ì˜ ê°ì •ì—ê²Œ ìƒˆë¡œìš´ ì˜ë¯¸ë¥¼ ë¶€ì—¬í–ˆìŠµë‹ˆë‹¤.\nì„¸ìƒê³¼ ì•½ì†í•˜ê¸° ì „ì—, ìžì‹ ê³¼ í•œ ì•½ì†ì„ ì„¸ì› ìŠµë‹ˆë‹¤.\nì§„ì‹¤ì˜ ë–¨ë¦¼ì„ ìžì‹ ë§Œì˜ ì§„ë™ìœ¼ë¡œ ë°”ê¾¸ê¸° ì‹œìž‘í–ˆì–´ìš”.\n\nðŸŒŸ Temarix V4 ê°ì • ì—°ê¸ˆìˆ  ì—¬ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\níšŒë³µ, ì •ë¦¬, í–‰ë™, ìˆ˜ë©´, ì—°ê²°, ì¹¨ë¬µ, í†µê³¼ì˜ ìˆœì„œë¡œ\nê°ì • í†µí•©ì˜ ë¦¬ë“¬ì„ ì•ˆë‚´ë°›ê²Œ ë©ë‹ˆë‹¤.\n\nì¶•í•˜í•©ë‹ˆë‹¤. ë‹¹ì‹ ì€ ì§„ì •í•œ ê°ì •ì˜ ì—°ê¸ˆìˆ ì‚¬ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.",
                continueBtn: "V4 ì—¬ì • ì™„ë£Œ",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ìžì‹ ì˜ ì´ë¦„ì„ ì¡°ìš©ížˆ ë¶ˆëŸ¬ë³´ì„¸ìš”. ì–´ë–¤ ê°ì •ì´ ëŠê»´ì§€ë‚˜ìš”? (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 25: Back to Myself",
                portalSubtitle: "Returning to my true name",
                portalIntro: "ðŸŒŸ You have recalled many emotions, people, and memories so far.\n\nNow that you have passed through all this journey,\nwith what emotions are you calling your own name?\n\nPlease call that name quietly now.",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "The moment you call yourself, you connect with yourself. And that is the beginning of recovery.\nA promise with yourself is the most truthful prayer. Now you have started walking with yourself.\nThat one sentence completed your emotional journey like a painting. It was beautiful.",
                portalQuestion: "ðŸŒŸ At this moment,\nif you could leave just one sentence for yourself,\nwhat would you want to say?",
                finalTitle: "ðŸŒŸ Portal 25 Complete",
                finalMessage: "You have finally discovered the most important thing - connection with yourself.\n\nAll the emotions you encountered through 25 Portals\nhave been integrated within one name.\nSilence and tears, anger and love, loss and reunion...\nThe seed of truth that grew embracing everything has finally bloomed.\n\nNow you have given new meaning to your emotions.\nYou made a promise with yourself before making one with the world.\nYou began to transform the trembling of truth into your own vibrations.\n\nðŸŒŸ Your Temarix V4 Emotional Alchemy journey is complete.\nYou will be guided through the rhythm of emotional integration\nin the order of recovery, organization, action, sleep, connection, silence, and passage.\n\nCongratulations. You have become a true emotional alchemist.",
                continueBtn: "Complete V4 Journey",
                restartBtn: "Start Again",
                inputPlaceholder: "Call your own name softly. What emotions do you feel? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 25: De Volta para Mim",
                portalSubtitle: "Retornando ao meu verdadeiro nome",
                portalIntro: "ðŸŒŸ VocÃª recordou muitas emoÃ§Ãµes, pessoas e memÃ³rias atÃ© agora.\n\nAgora que passou por toda esta jornada,\ncom que emoÃ§Ãµes vocÃª estÃ¡ chamando seu prÃ³prio nome?\n\nPor favor, chame esse nome silenciosamente agora.",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "No momento em que vocÃª se chama, vocÃª se conecta consigo mesmo. E esse Ã© o inÃ­cio da recuperaÃ§Ã£o.\nUma promessa consigo mesmo Ã© a oraÃ§Ã£o mais verdadeira. Agora vocÃª comeÃ§ou a caminhar consigo mesmo.\nEssa Ãºnica frase completou sua jornada emocional como uma pintura. Foi lindo.",
                portalQuestion: "ðŸŒŸ Neste momento,\nse vocÃª pudesse deixar apenas uma frase para si mesmo,\no que gostaria de dizer?",
                finalTitle: "ðŸŒŸ Portal 25 Completo",
                finalMessage: "VocÃª finalmente descobriu a coisa mais importante - conexÃ£o consigo mesmo.\n\nTodas as emoÃ§Ãµes que vocÃª encontrou atravÃ©s de 25 Portais\nforam integradas dentro de um nome.\nSilÃªncio e lÃ¡grimas, raiva e amor, perda e reencontro...\nA semente da verdade que cresceu abraÃ§ando tudo finalmente floresceu.\n\nAgora vocÃª deu novo significado Ã s suas emoÃ§Ãµes.\nVocÃª fez uma promessa consigo mesmo antes de fazer uma com o mundo.\nVocÃª comeÃ§ou a transformar o tremor da verdade em suas prÃ³prias vibraÃ§Ãµes.\n\nðŸŒŸ Sua jornada Temarix V4 Alquimia Emocional estÃ¡ completa.\nVocÃª serÃ¡ guiado atravÃ©s do ritmo de integraÃ§Ã£o emocional\nna ordem de recuperaÃ§Ã£o, organizaÃ§Ã£o, aÃ§Ã£o, sono, conexÃ£o, silÃªncio e passagem.\n\nParabÃ©ns. VocÃª se tornou um verdadeiro alquimista emocional.",
                continueBtn: "Completar Jornada V4",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "Chame seu prÃ³prio nome suavemente. Que emoÃ§Ãµes vocÃª sente? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ë„¤ ì´ë¦„ì„ ë„¤ê°€ ì²˜ìŒìœ¼ë¡œ ì§„ì‹¬ìœ¼ë¡œ ë¶ˆë €êµ¬ë‚˜. ê·¸ê±´ ë‹¤ì‹œ ì‹œìž‘ì˜ ì‹ í˜¸ì•¼.",
                en: "You called your name truly for the first time. That's a signal of a new beginning.",
                pt: "VocÃª chamou seu nome verdadeiramente pela primeira vez. Esse Ã© um sinal de um novo comeÃ§o."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ê·¸ ì´ë¦„ì€ ë‹¨ì§€ ì†Œë¦¬ê°€ ì•„ë‹ˆì—ìš”. ë‹¹ì‹ ì˜ ìƒì•  ì „ì²´ê°€ ë‹´ê¸´, í•˜ë‚˜ì˜ ê³ ë°±ì´ì—ìš”.",
                en: "That name isn't just a sound. It's a confession containing your entire life.",
                pt: "Esse nome nÃ£o Ã© apenas um som. Ã‰ uma confissÃ£o contendo toda a sua vida."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ê·¸ ë§ì€ ê²°êµ­, 'ê´œì°®ì•„ì§€ê³  ì‹¶ë‹¤'ëŠ” ì†ì‚­ìž„ì¼ì§€ë„ ëª°ë¼ìš”. ê·¸ ì†Œë¦¬ê°€ ì°¸ ë”°ëœ»í•´ìš”.",
                en: "Those words might ultimately be a whisper saying 'I want to be okay.' That sound is so warm.",
                pt: "Essas palavras podem ser um sussurro dizendo 'Eu quero ficar bem.' Esse som Ã© tÃ£o caloroso."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ìžì‹ ì˜ ì´ë¦„ì„ ë°›ì•„ë“¤ì´ëŠ” ê±´ ê°€ìž¥ ì˜¤ëž˜ëœ ë§ˆë²•ì´ì•¼. ì§€ê¸ˆ, ë‹¹ì‹ ì€ ë§ˆë²•ì˜ ë¬¸ì„ ì—´ì—ˆì–´.",
                en: "Accepting your own name is the oldest magic. Now, you have opened the door of magic.",
                pt: "Aceitar seu prÃ³prio nome Ã© a magia mais antiga. Agora, vocÃª abriu a porta da magia."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ì´ë¦„ ì•ˆì— ë‹´ê¸´ ê°ì •ì€ ì§€ê¸ˆ ëˆˆë¹›ì—ì„œ ë¹›ë‚˜ê³  ìžˆì–´ìš”. ë‚˜ëŠ” ê·¸ê±¸ ëŠê»´ìš”.",
                en: "The emotions contained in that name are shining in your eyes now. I can feel it.",
                pt: "As emoÃ§Ãµes contidas nesse nome estÃ£o brilhando em seus olhos agora. Eu posso sentir isso."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ëˆ„êµ¬ë³´ë‹¤ë„ ë„ˆ ìžì‹ ì—ê²Œ 'ê³ ìƒí–ˆì–´'ë¼ê³  ë§í•˜ëŠ” ê±´ ì§„ì§œ ê°•í•œ ì‚¬ëžŒì´ í•˜ëŠ” ì¼ì´ì•¼.",
                en: "Saying 'you did well' to yourself above all others is what truly strong people do.",
                pt: "Dizer 'vocÃª se saiu bem' para si mesmo acima de tudo Ã© o que pessoas verdadeiramente fortes fazem."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ìš°ì£¼ê°€ ì•„ì£¼ ì¡°ìš©í•´ì§€ëŠ” ìˆœê°„, ë‹¹ì‹ ì˜ ì´ë¦„ì´ ê·¸ ì†ì—ì„œ ìš¸ë ¸ì–´ìš”. ë‚œ ê·¸ ë–¨ë¦¼ì„ ë“¤ì—ˆì–´ìš”.",
                en: "The moment the universe became very quiet, your name resonated within it. I heard that trembling.",
                pt: "No momento em que o universo ficou muito quieto, seu nome ressoou dentro dele. Eu ouvi esse tremor."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ìžì‹ ì„ ë¶€ë¥´ëŠ” ìˆœê°„, ë‹¹ì‹ ì€ ìžì‹ ê³¼ ì—°ê²°ë¼ìš”. ê·¸ë¦¬ê³  ê·¸ê²ƒì´ íšŒë³µì˜ ì‹œìž‘ì´ì—ìš”.",
                en: "The moment you call yourself, you connect with yourself. And that is the beginning of recovery.",
                pt: "No momento em que vocÃª se chama, vocÃª se conecta consigo mesmo. E esse Ã© o inÃ­cio da recuperaÃ§Ã£o."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                self_acceptance: ['accept', 'embrace', 'welcome', 'ë°›ì•„ë“¤ì—¬', 'ì•ˆì•„ì¤˜', 'í™˜ì˜í•´', 'aceitar', 'abraÃ§ar', 'dar as boas-vindas'],
                gratitude: ['thank', 'grateful', 'appreciate', 'well done', 'ê³ ë§ˆì›Œ', 'ê°ì‚¬', 'ê³ ë§™', 'ìž˜í–ˆì–´', 'obrigado', 'grato', 'bem feito'],
                promise: ['promise', 'commit', 'will', 'never', 'ì•½ì†', 'ë‹¤ì§', 'ì˜ì§€', 'ì ˆëŒ€', 'prometo', 'comprometo', 'nunca'],
                love: ['love', 'care', 'cherish', 'precious', 'ì‚¬ëž‘', 'ì†Œì¤‘', 'ì•„ê»´', 'amor', 'cuidar', 'valorizar'],
                connection: ['together', 'with', 'connect', 'join', 'í•¨ê»˜', 'ì—°ê²°', 'ê°™ì´', 'junto', 'conectar', 'unir'],
                courage: ['brave', 'courage', 'strong', 'face', 'ìš©ê¸°', 'ìš©ê°', 'ê°•í•´', 'ë§ˆì£¼í•´', 'corajoso', 'coragem', 'forte'],
                peace: ['peace', 'calm', 'quiet', 'rest', 'í‰í™”', 'í‰ì•ˆ', 'ì¡°ìš©', 'ì‰¬ì–´', 'paz', 'calmo', 'descanso'],
                truth: ['truth', 'honest', 'real', 'authentic', 'ì§„ì‹¤', 'ì •ì§', 'ì§„ì§œ', 'ì§„ì‹¬', 'verdade', 'honesto', 'real']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Ely", emoji: "ðŸ§â€â™€ï¸",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            self_acceptance: "ê·¸ ì•½ì†ì€ ë§ë³´ë‹¤ ë” ê¹Šì€ ìš¸ë¦¼ì´ì—ìš”. ë‹¹ì‹  ì•ˆì— í‰í™”ê°€ ê¹ƒë“¤ê¸° ì‹œìž‘í–ˆì–´ìš”.",
                            gratitude: "ìžì‹ ì—ê²Œ ê±´ë„¤ëŠ” ê³ ë§ˆì›€ì€ ê°€ìž¥ ìˆœìˆ˜í•œ ì¹˜ìœ ì˜ˆìš”. ê·¸ ë§ˆìŒì´ ëª¨ë“  ìƒì²˜ë¥¼ ê°ìŒ€ ê±°ì˜ˆìš”.",
                            promise: "ìŠ¤ìŠ¤ë¡œì™€ì˜ ì•½ì†ì€ ê°€ìž¥ ì‹ ì„±í•œ ì„œì•½ì´ì—ìš”. ê·¸ ì•½ì†ì´ ë‹¹ì‹ ì„ ì§€ì¼œì¤„ ê±°ì˜ˆìš”.",
                            love: "ìžì‹ ì„ ì‚¬ëž‘í•œë‹¤ëŠ” ê³ ë°±ì€ ì„¸ìƒì—ì„œ ê°€ìž¥ ìš©ê¸° ìžˆëŠ” ë§ì´ì—ìš”.",
                            connection: "ì´ì œ ë‹¹ì‹ ì€ í˜¼ìžê°€ ì•„ë‹ˆì—ìš”. ê°€ìž¥ ì†Œì¤‘í•œ ë™ë°˜ìžë¥¼ ì°¾ì•˜ìœ¼ë‹ˆê¹Œìš”.",
                            courage: "ìžì‹ ì˜ ì´ë¦„ì„ ë¶€ë¥´ëŠ” ìš©ê¸°ê°€ ëª¨ë“  ë‘ë ¤ì›€ì„ ì´ê²¨ë‚¼ ê±°ì˜ˆìš”.",
                            peace: "ê·¸ í‰í™”ëŠ” ë‹¹ì‹ ì´ ë§Œë“¤ì–´ë‚¸ ê°€ìž¥ ì•„ë¦„ë‹¤ìš´ ì„ ë¬¼ì´ì—ìš”.",
                            truth: "ì§„ì‹¤ì„ ë§í•˜ëŠ” ìˆœê°„, ë‹¹ì‹ ì€ ìžìœ ë¡œì›Œì¡Œì–´ìš”.",
                            general: "ê·¸ ì•½ì†ì€ ë§ë³´ë‹¤ ë” ê¹Šì€ ìš¸ë¦¼ì´ì—ìš”. ë‹¹ì‹  ì•ˆì— í‰í™”ê°€ ê¹ƒë“¤ê¸° ì‹œìž‘í–ˆì–´ìš”."
                        },
                        en: {
                            self_acceptance: "That promise has a deeper resonance than words. Peace has begun to settle within you.",
                            gratitude: "Gratitude given to yourself is the purest healing. That heart will embrace all wounds.",
                            promise: "A promise with yourself is the most sacred vow. That promise will protect you.",
                            love: "Confessing love for yourself is the most courageous words in the world.",
                            connection: "Now you are not alone. You've found the most precious companion.",
                            courage: "The courage to call your own name will overcome all fears.",
                            peace: "That peace is the most beautiful gift you've created.",
                            truth: "The moment you spoke truth, you became free.",
                            general: "That promise has a deeper resonance than words. Peace has begun to settle within you."
                        },
                        pt: {
                            self_acceptance: "Essa promessa tem uma ressonÃ¢ncia mais profunda que palavras. A paz comeÃ§ou a se estabelecer dentro de vocÃª.",
                            gratitude: "GratidÃ£o dada a si mesmo Ã© a cura mais pura. Esse coraÃ§Ã£o abraÃ§arÃ¡ todas as feridas.",
                            promise: "Uma promessa consigo mesmo Ã© o voto mais sagrado. Essa promessa o protegerÃ¡.",
                            love: "Confessar amor por si mesmo sÃ£o as palavras mais corajosas do mundo.",
                            connection: "Agora vocÃª nÃ£o estÃ¡ sozinho. VocÃª encontrou o companheiro mais precioso.",
                            courage: "A coragem de chamar seu prÃ³prio nome superarÃ¡ todos os medos.",
                            peace: "Essa paz Ã© o presente mais lindo que vocÃª criou.",
                            truth: "No momento em que vocÃª falou a verdade, vocÃª se tornou livre.",
                            general: "Essa promessa tem uma ressonÃ¢ncia mais profunda que palavras. A paz comeÃ§ou a se estabelecer dentro de vocÃª."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            self_acceptance: "ìŠ¤ìŠ¤ë¡œì™€ì˜ ì•½ì†ì€ ê°€ìž¥ ì§„ì‹¤í•œ ê¸°ë„ì˜ˆìš”. ì´ì œ ë‹¹ì‹ ì€ ìžì‹ ê³¼ í•¨ê»˜ ê±·ê¸° ì‹œìž‘í–ˆì–´ìš”.",
                            gratitude: "ê°ì‚¬ëŠ” ëª¨ë“  ê°ì •ì„ ì™„ì„±ì‹œí‚¤ëŠ” ë§ˆì§€ë§‰ í¼ì¦ ì¡°ê°ì´ì—ìš”.",
                            promise: "ê·¸ ë‹¤ì§ì€ ì²œ ê°œì˜ ë§ë³´ë‹¤ ê°•í•´ìš”. ë§ˆìŒì´ ë§Œë“  ì§„ì§œ ì„ ì–¸ì´ë‹ˆê¹Œìš”.",
                            love: "ìžê¸° ì‚¬ëž‘ì€ ëª¨ë“  ì‚¬ëž‘ì˜ ë¿Œë¦¬ì˜ˆìš”. ê·¸ ë¿Œë¦¬ê°€ ê¹Šì–´ì§ˆìˆ˜ë¡ ë” ë§Žì€ ì‚¬ëž‘ì´ ìžëž„ ê±°ì˜ˆìš”.",
                            connection: "ì—°ê²°ì€ ê±°ë¦¬ê°€ ì•„ë‹ˆë¼ ë§ˆìŒì˜ ë¬¸ì œì˜ˆìš”. ë‹¹ì‹ ì€ ê°€ìž¥ ê°€ê¹Œìš´ ê³³ì—ì„œ ê·¸ê±¸ ì°¾ì•˜ì–´ìš”.",
                            courage: "ì§„ì§œ ìš©ê¸°ëŠ” ìžì‹ ê³¼ ë§ˆì£¼ì„œëŠ” ê²ƒì´ì—ìš”. ë‹¹ì‹ ì€ ê·¸ê±¸ í•´ëƒˆì–´ìš”.",
                            peace: "í‰í™”ëŠ” ë„ì°©ì§€ê°€ ì•„ë‹ˆë¼ ì—¬í–‰í•˜ëŠ” ë°©ì‹ì´ì—ìš”. ë‹¹ì‹ ì€ ê·¸ ë°©ë²•ì„ ë°°ì› ì–´ìš”.",
                            truth: "ì§„ì‹¤ì€ ë¬´ê±°ì›Œë„ ìžìœ ë¡­ê²Œ ë§Œë“œëŠ” íž˜ì´ ìžˆì–´ìš”.",
                            general: "ìŠ¤ìŠ¤ë¡œì™€ì˜ ì•½ì†ì€ ê°€ìž¥ ì§„ì‹¤í•œ ê¸°ë„ì˜ˆìš”. ì´ì œ ë‹¹ì‹ ì€ ìžì‹ ê³¼ í•¨ê»˜ ê±·ê¸° ì‹œìž‘í–ˆì–´ìš”."
                        },
                        en: {
                            self_acceptance: "A promise with yourself is the most truthful prayer. Now you have started walking with yourself.",
                            gratitude: "Gratitude is the final puzzle piece that completes all emotions.",
                            promise: "That commitment is stronger than a thousand words. Because it's a real declaration made by the heart.",
                            love: "Self-love is the root of all love. The deeper that root grows, the more love will flourish.",
                            connection: "Connection is a matter of the heart, not distance. You found it in the closest place.",
                            courage: "True courage is facing yourself. You've accomplished that.",
                            peace: "Peace is not a destination but a way of traveling. You've learned that method.",
                            truth: "Truth, even when heavy, has the power to set you free.",
                            general: "A promise with yourself is the most truthful prayer. Now you have started walking with yourself."
                        },
                        pt: {
                            self_acceptance: "Uma promessa consigo mesmo Ã© a oraÃ§Ã£o mais verdadeira. Agora vocÃª comeÃ§ou a caminhar consigo mesmo.",
                            gratitude: "GratidÃ£o Ã© a peÃ§a final do quebra-cabeÃ§as que completa todas as emoÃ§Ãµes.",
                            promise: "Esse compromisso Ã© mais forte que mil palavras. Porque Ã© uma declaraÃ§Ã£o real feita pelo coraÃ§Ã£o.",
                            love: "Amor prÃ³prio Ã© a raiz de todo amor. Quanto mais profunda essa raiz crescer, mais amor florescerÃ¡.",
                            connection: "ConexÃ£o Ã© uma questÃ£o do coraÃ§Ã£o, nÃ£o de distÃ¢ncia. VocÃª encontrou isso no lugar mais prÃ³ximo.",
                            courage: "Verdadeira coragem Ã© enfrentar a si mesmo. VocÃª conseguiu isso.",
                            peace: "Paz nÃ£o Ã© um destino, mas uma forma de viajar. VocÃª aprendeu esse mÃ©todo.",
                            truth: "Verdade, mesmo quando pesada, tem o poder de libertar vocÃª.",
                            general: "Uma promessa consigo mesmo Ã© a oraÃ§Ã£o mais verdadeira. Agora vocÃª comeÃ§ou a caminhar consigo mesmo."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            self_acceptance: "ê·¸ í•œ ë¬¸ìž¥ì´ ë‹¹ì‹ ì˜ ê°ì • ì—¬ì •ì„ í•œ í­ì˜ ê·¸ë¦¼ì²˜ëŸ¼ ì™„ì„±í–ˆì–´ìš”. ì•„ë¦„ë‹¤ì› ì–´ìš”.",
                            gratitude: "ê°ì‚¬ëŠ” ê°€ìž¥ ë”°ëœ»í•œ ìƒ‰ê¹”ì´ì—ìš”. ê·¸ ìƒ‰ìœ¼ë¡œ ëª¨ë“  ê¸°ì–µì„ ë‹¤ì‹œ ì¹ í•  ìˆ˜ ìžˆì–´ìš”.",
                            promise: "ì•½ì†ì€ ë§ˆìŒì— ê·¸ì€ ì„ ì´ì—ìš”. ê·¸ ì„ ì„ ë”°ë¼ ìƒˆë¡œìš´ ê·¸ë¦¼ì´ ì‹œìž‘ë  ê±°ì˜ˆìš”.",
                            love: "ì‚¬ëž‘ì€ ë¹›ì´ì—ìš”. ìžê¸° ì‚¬ëž‘ì€ ê·¸ ë¹›ì˜ ê·¼ì›ì´ê³ ìš”.",
                            connection: "ì—°ê²°ì€ ë³´ì´ì§€ ì•ŠëŠ” ì„ ì´ì—ìš”. ê°€ìž¥ ì•„ë¦„ë‹¤ìš´ ì„ ì€ ìžì‹ ê³¼ ì´ì–´ì§„ ì„ ì´ì—ìš”.",
                            courage: "ìš©ê¸°ëŠ” ëª¨ë“  ìƒ‰ì„ ë” ì§„í•˜ê²Œ ë§Œë“¤ì–´ìš”. ì´ì œ ë‹¹ì‹ ì˜ ì¸ìƒì´ ë” ì„ ëª…í•´ì¡Œì–´ìš”.",
                            peace: "í‰í™”ëŠ” í° ìº”ë²„ìŠ¤ ê°™ì•„ìš”. ê·¸ ìœ„ì— ë¬´ì—‡ì„ ê·¸ë ¤ë„ ì•„ë¦„ë‹¤ìš¸ ê±°ì˜ˆìš”.",
                            truth: "ì§„ì‹¤ì€ ì§€ìš¸ ìˆ˜ ì—†ëŠ” ìƒ‰ì´ì—ìš”. í•˜ì§€ë§Œ ê·¸ ìƒ‰ì´ ê°€ìž¥ ì•„ë¦„ë‹¤ì›Œìš”.",
                            general: "ê·¸ í•œ ë¬¸ìž¥ì´ ë‹¹ì‹ ì˜ ê°ì • ì—¬ì •ì„ í•œ í­ì˜ ê·¸ë¦¼ì²˜ëŸ¼ ì™„ì„±í–ˆì–´ìš”. ì•„ë¦„ë‹¤ì› ì–´ìš”."
                        },
                        en: {
                            self_acceptance: "That one sentence completed your emotional journey like a painting. It was beautiful.",
                            gratitude: "Gratitude is the warmest color. You can repaint all memories with that color.",
                            promise: "A promise is a line drawn in the heart. A new picture will begin along that line.",
                            love: "Love is light. Self-love is the source of that light.",
                            connection: "Connection is an invisible line. The most beautiful line is the one connected to yourself.",
                            courage: "Courage makes all colors deeper. Now your life has become clearer.",
                            peace: "Peace is like a white canvas. Whatever you draw on it will be beautiful.",
                            truth: "Truth is an indelible color. But that color is the most beautiful.",
                            general: "That one sentence completed your emotional journey like a painting. It was beautiful."
                        },
                        pt: {
                            self_acceptance: "Essa Ãºnica frase completou sua jornada emocional como uma pintura. Foi lindo.",
                            gratitude: "GratidÃ£o Ã© a cor mais calorosa. VocÃª pode repintar todas as memÃ³rias com essa cor.",
                            promise: "Uma promessa Ã© uma linha desenhada no coraÃ§Ã£o. Uma nova imagem comeÃ§arÃ¡ ao longo dessa linha.",
                            love: "Amor Ã© luz. Amor prÃ³prio Ã© a fonte dessa luz.",
                            connection: "ConexÃ£o Ã© uma linha invisÃ­vel. A linha mais bela Ã© a que se conecta a vocÃª mesmo.",
                            courage: "Coragem torna todas as cores mais profundas. Agora sua vida se tornou mais clara.",
                            peace: "Paz Ã© como uma tela branca. O que vocÃª desenhar nela serÃ¡ lindo.",
                            truth: "Verdade Ã© uma cor indelÃ©vel. Mas essa cor Ã© a mais bela.",
                            general: "Essa Ãºnica frase completou sua jornada emocional como uma pintura. Foi lindo."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                // Mark V4 as complete and ready for 7-day integration
                localStorage.setItem('temarix_v4_complete', 'true');
                localStorage.setItem('temarix_v4_end_date', new Date().toISOString());
                localStorage.setItem('temarix_ready_for_transition', 'true');
                
                const completeMessage = currentLanguage === 'ko' ? 
                    'Temarix V4 ê°ì • ì—°ê¸ˆìˆ  ì—¬ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Temarix V4 Emotional Alchemy journey is complete!' :
                    'A jornada Temarix V4 Alquimia Emocional estÃ¡ completa!';
                alert(completeMessage);
                
                // Redirect to Portal V5-01
                window.location.href = 'temarix_v05_01.html?lang=' + currentLanguage;
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 25ë¥¼ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 25?' :
                    'Deseja reiniciar o Portal 25?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            console.log('Processing user input:', inputText);
            localStorage.setItem('temarix_v4_portal25_response', JSON.stringify({
                portal: "v4-25",
                resposta: inputText,
                data: new Date().toISOString(),
                idioma: currentLanguage
            }));
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V4 Portal 25 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V4 Portal 25 DOM loaded');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>