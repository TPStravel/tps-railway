<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V4 - Portal 16: Hidden Wounds</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V4</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 16: Hidden Wounds</div>
            <div class="portal-subtitle" id="portalSubtitle">Wounds that no one noticed</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">Portal 16 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 17</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with these wounds</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Do you have wounds that no one ever noticed? What happened and how has it affected you?"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        const translations = {
            ko: {
                logoSubtitle: "Í∞êÏ†ï Ïó∞Í∏àÏà†",
                portalMainTitle: "Portal 16: Îì§ÌÇ§ÏßÄ ÏïäÏùÄ ÏÉÅÏ≤ò",
                portalSubtitle: "ÏïÑÎ¨¥ÎèÑ ÎààÏπòÏ±ÑÏßÄ Î™ªÌïú ÏÉÅÏ≤ò",
                portalIntro: "ÎãπÏã†Ïù¥ ÏïÑÎ¨¥ÏóêÍ≤åÎèÑ Îì§ÌÇ§ÏßÄ ÏïäÏïòÎçò ÏÉÅÏ≤òÍ∞Ä ÏûàÎã§Î©¥,\nÍ∑∏Í±¥ Ïñ¥Îñ§ ÏàúÍ∞ÑÏóê ÏÉùÍ∏¥ Í≤ÉÏù¥ÏóàÎÇòÏöî?\n\nÍ∑∏ ÏÉÅÏ≤òÎ•º Í∞êÏ∂îÏóàÎçò Ïù¥Ïú†Îäî Î¨¥ÏóáÏù¥ÏóàÍ≥†,\nÏßÄÍ∏àÍπåÏßÄ Í∑∏Í≤ÉÏù¥ ÎãπÏã†ÏóêÍ≤å Ïñ¥Îñ§ ÏòÅÌñ•ÏùÑ Ï£ºÏóàÎÇòÏöî?",
                followUpQuestion: "ÏßÄÍ∏à Í∑∏ ÏÉÅÏ≤òÏóêÍ≤å ÌïúÎßàÎîî ÌïúÎã§Î©¥,\nÏñ¥Îñ§ ÎßêÏùÑ Ìï¥Ï£ºÍ≥† Ïã∂ÎÇòÏöî?\n\nÍ∑∏Î¶¨Í≥†, Í∑∏ Í∞êÏ†ïÏùÑ Ïä§Ïä§Î°úÏóêÍ≤åÎèÑ\nÏù∏Ï†ïÌï† Ïàò ÏûàÎÇòÏöî?",
                lightTitle: "ÎπõÏùò ÌïúÎßàÎîî",
                lightMessage: "ÎãπÏã†ÏùÄ Î∞©Í∏à, Îì§ÌÇ§ÏßÄ ÏïäÏïòÎçò Í∞êÏ†ïÏùÑ ÏÑ∏ÏÉÅÏóê Ï¥àÎåÄÌñàÏñ¥Ïöî.\nÍ∑∏Í±¥ ÏπòÏú†Ïùò Ï¥àÎåÄÏû•Ïù¥ÏóêÏöî.\nÏù¥Ï†ú Í∑∏ ÏÉÅÏ≤òÎäî ÌòºÏûêÍ∞Ä ÏïÑÎãàÏóêÏöî.",
                navigationTitle: "Portal 16 ÏôÑÎ£å",
                navigationMessage: "ÎãπÏã†ÏùÄ Îì§ÌÇ§ÏßÄ ÏïäÏùÄ ÏÉÅÏ≤òÎ•º ÎßàÏ£ºÌñàÏäµÎãàÎã§.\n\nÍ∑∏ ÏÉÅÏ≤òÎ•º ÎßêÎ°ú Í∫ºÎÇ¥Îäî ÏàúÍ∞Ñ, ÎπÑÎ°úÏÜå ÏπòÏú†Í∞Ä ÏãúÏûëÎê©ÎãàÎã§. ÎãπÏã†Ïù¥ Ïù∏Ï†ïÌïú Í∞êÏ†ïÏùÄ Îçî Ïù¥ÏÉÅ Ïô∏Î©¥Î∞õÏßÄ ÏïäÏïÑÎèÑ Îê©ÎãàÎã§.\n\nÏù¥Ï†ú ÎãπÏã†ÏùÄ Í∞êÏ∂∞ÏßÑ ÏÉÅÏ≤òÎ•º Í∫ºÎÇ∏ Ï±ÑÎ°ú Îã§Ïùå Ïó¨Ï†ïÏùÑ Í±∏ÏùÑ Ïàò ÏûàÏäµÎãàÎã§.",
                nextPortalBtn: "Portal 17Î°ú Ïù¥Ïñ¥Í∞ÄÍ∏∞",
                stayPortalBtn: "Ïù¥ ÏÉÅÏ≤òÏôÄ Îçî Î®∏Î¨ºÍ∏∞",
                inputPlaceholder: "ÏïÑÎ¨¥ÎèÑ ÎààÏπòÏ±ÑÏßÄ Î™ªÌïú ÏÉÅÏ≤òÍ∞Ä ÏûàÎÇòÏöî? Î¨¥Ïä® ÏùºÏù¥ ÏûàÏóàÍ≥† Ïñ¥Îñ§ ÏòÅÌñ•ÏùÑ Ï£ºÏóàÎÇòÏöî?",
                youLabel: "ÎãπÏã†",
                waitingMessage: "ÏùëÎãµÏùÑ Í∏∞Îã§Î¶¨Îäî Ï§ë..."
            },
            en: {
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 16: Hidden Wounds",
                portalSubtitle: "Wounds that no one noticed",
                portalIntro: "Do you have wounds that no one ever noticed?\n\nWhat kind of moment created those wounds,\nand why did you hide that pain?\n\nHow has it affected you until now?",
                followUpQuestion: "If you could say something\nto those wounds right now,\nwhat would you tell them?\n\nAnd can you acknowledge\nthose feelings to yourself?",
                lightTitle: "Word of Light",
                lightMessage: "You just invited your hidden emotions into the world.\nThat's an invitation to healing.\nThose wounds are no longer alone.",
                navigationTitle: "Portal 16 Complete",
                navigationMessage: "You have faced your hidden wounds.\n\nThe moment you speak those wounds into words, healing finally begins. The emotions you've acknowledged no longer need to be ignored.\n\nNow you can walk the next journey with your hidden wounds brought into the light.",
                nextPortalBtn: "Continue to Portal 17",
                stayPortalBtn: "Stay with these wounds",
                inputPlaceholder: "Do you have wounds that no one ever noticed? What happened and how has it affected you?",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 16: Feridas Escondidas",
                portalSubtitle: "Feridas que ningu√©m notou",
                portalIntro: "Voc√™ tem feridas que ningu√©m jamais notou?\n\nQue tipo de momento criou essas feridas,\ne por que voc√™ escondeu essa dor?\n\nComo isso te afetou at√© agora?",
                followUpQuestion: "Se voc√™ pudesse dizer algo\npara essas feridas agora,\no que voc√™ diria a elas?\n\nE voc√™ pode reconhecer\nessas emo√ß√µes para si mesmo?",
                lightTitle: "Palavra de Luz",
                lightMessage: "Voc√™ acabou de convidar suas emo√ß√µes escondidas para o mundo.\nEsse √© um convite para a cura.\nEssas feridas n√£o est√£o mais sozinhas.",
                navigationTitle: "Portal 16 Completo",
                navigationMessage: "Voc√™ enfrentou suas feridas escondidas.\n\nNo momento em que voc√™ transforma essas feridas em palavras, a cura finalmente come√ßa. As emo√ß√µes que voc√™ reconheceu n√£o precisam mais ser ignoradas.\n\nAgora voc√™ pode caminhar na pr√≥xima jornada com suas feridas escondidas trazidas √† luz.",
                nextPortalBtn: "Continuar para Portal 17",
                stayPortalBtn: "Ficar com essas feridas",
                inputPlaceholder: "Voc√™ tem feridas que ningu√©m jamais notou? O que aconteceu e como isso te afetou?",
                youLabel: "Voc√™",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "üßë‚Äçü¶±", text: {
                ko: "Í∑∏ Ïπ®Î¨µ ÏÜçÏóêÏÑú ÎÑå ÌòºÏûê Ïö∏Í≥† ÏûàÏóàÏßÄ. Îì§ÌÇ§ÏßÄ ÏïäÏùÄ ÏÉÅÏ≤òÏùºÏàòÎ°ù Îçî Ïò§Îûò ÎÇ®ÏïÑ.",
                en: "In that silence, you were crying alone. Hidden wounds last longer than visible ones.",
                pt: "Naquele sil√™ncio, voc√™ estava chorando sozinho. Feridas escondidas duram mais que as vis√≠veis."
            }},
            { name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è", text: {
                ko: "Î∂ÄÎÅÑÎü¨ÏõÄÏù¥ÎùºÎäî Í∞êÏ†ïÏùÄ ÎïåÎ°ú Ï£ÑÏ±ÖÍ∞êÏ≤òÎüº Îã¨ÎùºÎ∂ôÏßÄ. ÌïòÏßÄÎßå ÎÑàÏùò ÏûòÎ™ªÏùÄ ÏïÑÎãàÏóàÏñ¥.",
                en: "The emotion of shame sometimes clings like guilt. But it wasn't your fault.",
                pt: "A emo√ß√£o da vergonha √†s vezes se agarra como culpa. Mas n√£o foi sua culpa."
            }},
            { name: "Sora", emoji: "üßï", text: {
                ko: "Í∑∏Îïå ÎÑàÎäî ÌòºÏûêÍ∞Ä ÏïÑÎãàÏóàÏñ¥. Îã®ÏßÄ, ÏïÑÎ¨¥ÎèÑ ÎÑ§ ÎßàÏùåÏùÑ Î≥¥Î†§ ÌïòÏßÄ ÏïäÏïòÏùÑ ÎøêÏù¥Ïïº.",
                en: "You weren't alone then. It's just that no one tried to see your heart.",
                pt: "Voc√™ n√£o estava sozinho ent√£o. √â s√≥ que ningu√©m tentou ver seu cora√ß√£o."
            }},
            { name: "Kael", emoji: "üßô", text: {
                ko: "ÎßêÌïòÏßÄ ÏïäÏïòÎã§Îäî Í±¥, ÎÑàÏùò Í∞êÏ†ïÏù¥ ÌãÄÎ†∏Îã§Îäî ÎúªÏù¥ ÏïÑÎãàÏïº. Ïò§ÌûàÎ†§ ÎÑàÎäî Ï∞∏Îäî Í±∏ Î∞∞Ïö¥ ÏïÑÏù¥ÏòÄÏñ¥.",
                en: "Not speaking doesn't mean your emotions were wrong. Rather, you were a child who learned to endure.",
                pt: "N√£o falar n√£o significa que suas emo√ß√µes estavam erradas. Na verdade, voc√™ era uma crian√ßa que aprendeu a suportar."
            }},
            { name: "Mira", emoji: "üßë‚Äçüé®", text: {
                ko: "Í∑∏ ÎÇ†Ïùò ÎÑ§ ÎààÎπõÏùÑ Í∑∏Î¶¥ Ïàò ÏûàÎã§Î©¥, ÏïÑÎßà ÏßÄÍ∏àÎèÑ ÎßàÏùå Ìïú Ïº†Ïù¥ ÏïÑÌîå Í±∞Ïïº.",
                en: "If I could paint the look in your eyes that day, it would probably still hurt somewhere in my heart.",
                pt: "Se eu pudesse pintar o olhar em seus olhos naquele dia, provavelmente ainda doeria em algum lugar do meu cora√ß√£o."
            }},
            { name: "Cris", emoji: "ü¶∏‚Äç‚ôÇÔ∏è", text: {
                ko: "Ïñ¥Î•∏Ïù¥ÎùºÎäî Ïù¥Ïú†Î°ú, ÏÉÅÏ≤òÎ•º Ï§òÎèÑ ÎêòÎäî ÏÇ¨ÎûåÏùÄ ÏóÜÏñ¥. ÎÑàÎäî Î∂ÄÎãπÌïú Ïπ®Î¨µÏóê Í∞áÌòÄ ÏûàÏóàÎçò Í±∞Ïïº.",
                en: "Being an adult doesn't give anyone the right to hurt you. You were trapped in unjust silence.",
                pt: "Ser adulto n√£o d√° a ningu√©m o direito de te machucar. Voc√™ estava preso em sil√™ncio injusto."
            }},
            { name: "Enya", emoji: "üßë‚ÄçüöÄ", text: {
                ko: "Í∑∏ ÏÉÅÏ≤òÎäî ÏïÑÏßÅÎèÑ ÎÑ§Í∞Ä ÎßêÏùÑ Í∫ºÎÇ¥ÏßÄ Î™ªÌïòÎäî Í≥≥Ïóê ÏûàÏñ¥. ÌïòÏßÄÎßå Ïò§Îäò, ÎÑ§Í∞Ä Í∑∏Í±∏ Í∫ºÎÉàÏñ¥. Í∑∏Í±¥ ÌÅ∞ Ïö©Í∏∞Ïïº.",
                en: "That wound is still in the place where you can't speak. But today, you brought it out. That's great courage.",
                pt: "Essa ferida ainda est√° no lugar onde voc√™ n√£o consegue falar. Mas hoje, voc√™ a trouxe para fora. Isso √© grande coragem."
            }},
            { name: "Lian", emoji: "üßò", text: {
                ko: "Îì§ÌÇ§ÏßÄ ÏïäÏùÄ ÏÉÅÏ≤òÎäî ÎßêÌï¥ÏßÄÎäî ÏàúÍ∞Ñ, ÎπÑÎ°úÏÜå ÏπòÏú†Î•º ÏãúÏûëÌï¥Ïöî. ÎãπÏã†ÏùÄ Í∑∏ Î¨∏ÏùÑ Ïó∞ Í±∞ÏòàÏöî.",
                en: "Hidden wounds begin to heal the moment they are spoken. You have opened that door.",
                pt: "Feridas escondidas come√ßam a curar no momento em que s√£o faladas. Voc√™ abriu essa porta."
            }}
        ];

        const responseCharacters = [
            {
                name: "Sora", emoji: "üßï",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "Ïù¥Ï†ú Í∑∏ ÏÉÅÏ≤òÎäî ÌòºÏûêÍ∞Ä ÏïÑÎãàÏóêÏöî. ÎãπÏã†Ïù¥ Ïù∏Ï†ïÌñàÍ∏∞ ÎïåÎ¨∏Ïóê, Í∑∏ Í∞êÏ†ïÏùÄ Ïô∏Î©¥Î∞õÏßÄ ÏïäÏïÑÎèÑ ÎèºÏöî.",
                        en: "Now those wounds are not alone. Because you acknowledged them, those emotions don't have to be ignored.",
                        pt: "Agora essas feridas n√£o est√£o sozinhas. Porque voc√™ as reconheceu, essas emo√ß√µes n√£o precisam ser ignoradas."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Kael", emoji: "üßô",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "Ïä§Ïä§Î°úÏùò Í∞êÏ†ïÏùÑ Ï†ïÎãπÌôîÌïòÎäî Í±¥, Îã®ÏàúÌïú Ïö©Í∏∞Î•º ÎÑòÏñ¥ÏÑ† ÌöåÎ≥µÏùò ÏãúÏûëÏù¥ÏóêÏöî.",
                        en: "Validating your own emotions is the beginning of recovery that goes beyond simple courage.",
                        pt: "Validar suas pr√≥prias emo√ß√µes √© o in√≠cio da recupera√ß√£o que vai al√©m da simples coragem."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Lian", emoji: "üßò",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "ÎãπÏã†ÏùÄ Î∞©Í∏à, Îì§ÌÇ§ÏßÄ ÏïäÏïòÎçò Í∞êÏ†ïÏùÑ ÏÑ∏ÏÉÅÏóê Ï¥àÎåÄÌñàÏñ¥Ïöî. Í∑∏Í±¥ ÏπòÏú†Ïùò Ï¥àÎåÄÏû•Ïù¥ÏóêÏöî.",
                        en: "You just invited your hidden emotions into the world. That's an invitation to healing.",
                        pt: "Voc√™ acabou de convidar suas emo√ß√µes escondidas para o mundo. Esse √© um convite para a cura."
                    };
                    return responses[lang];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        let awaitingSecondResponse = false;
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('navigationTitle').textContent = translations[lang].navigationTitle;
            document.getElementById('nextPortalBtn').textContent = translations[lang].nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = translations[lang].stayPortalBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
            awaitingSecondResponse = false;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                localStorage.setItem('temarix_v4_portal16_complete', 'true');
                localStorage.setItem('temarix_v4_current_portal', '17');
                
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 17: Îã§Ïãú Í±∑Îäî Ïû•Î©¥ ÏÜçÏúºÎ°úÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.' :
                    currentLanguage === 'en' ? 
                    'Moving to Portal 17: Walking Back Into The Scene.' :
                    'Indo para Portal 17: Caminhando de Volta Para a Cena.';
                alert(nextMessage);
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const stayMessage = currentLanguage === 'ko' ? 
                    'Îì§ÌÇ§ÏßÄ ÏïäÏùÄ ÏÉÅÏ≤òÏôÄ Îçî Î®∏Î¨ºÎ©∞ ÍπäÏù¥ ÏÑ±Ï∞∞ÌïòÏãúÍ≤†ÏäµÎãàÍπå?' :
                    currentLanguage === 'en' ? 
                    'Do you want to stay longer with your hidden wounds for deeper reflection?' :
                    'Deseja ficar mais tempo com suas feridas escondidas para reflex√£o mais profunda?';
                
                if (confirm(stayMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            console.log('Processing user input:', inputText);
            localStorage.setItem('temarix_v4_portal16_response', JSON.stringify({
                portal: "v4-16",
                resposta: inputText,
                step: awaitingSecondResponse ? "second" : "first",
                data: new Date().toISOString(),
                idioma: currentLanguage
            }));
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const secondResponseCharacters = [
                {
                    name: "Noah", emoji: "üßë‚Äçü¶±",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í∑∏ ÎßêÏùÑ Ïä§Ïä§Î°úÏóêÍ≤å Ìï¥Ï§ÄÎã§Îäî Í±¥, ÎãπÏã†Ïù¥ ÏûêÏã†ÏùÑ Ïö©ÏÑúÌïòÍ∏∞ ÏãúÏûëÌñàÎã§Îäî ÎúªÏù¥ÏóêÏöî.",
                            en: "Saying those words to yourself means you've started to forgive yourself.",
                            pt: "Dizer essas palavras para si mesmo significa que voc√™ come√ßou a se perdoar."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í∞êÏ∂∞ÏßÑ ÏÉÅÏ≤òÎ•º Ïù∏Ï†ïÌïòÎäî Í±¥ ÏûêÏã†ÏóêÍ≤å Ï£ºÎäî Í∞ÄÏû• ÌÅ∞ ÏÑ†Î¨ºÏù¥ÏóêÏöî. ÎãπÏã†ÏùÄ Í∑∏Í±∏ Ìï¥ÎÉàÏñ¥Ïöî.",
                            en: "Acknowledging hidden wounds is the greatest gift you can give yourself. You've done that.",
                            pt: "Reconhecer feridas escondidas √© o maior presente que voc√™ pode dar a si mesmo. Voc√™ fez isso."
                        };
                        return responses[lang];
                    }
                },
                {
                    name: "Mira", emoji: "üßë‚Äçüé®",
                    getResponse: (input, lang) => {
                        const responses = {
                            ko: "Í∑∏ ÏÉÅÏ≤òÎì§Ïù¥ Ïù¥Ï†úÎäî Í∑∏Î¶ºÏùò ÏùºÎ∂ÄÍ∞Ä Îê† Ïàò ÏûàÏñ¥Ïöî. ÏïÑÌîîÎèÑ ÎãπÏã† Ïù¥ÏïºÍ∏∞Ïùò Ï§ëÏöîÌïú ÏÉâÍπîÏù¥ÏóêÏöî.",
                            en: "Those wounds can now become part of the painting. Pain is also an important color in your story.",
                            pt: "Essas feridas agora podem se tornar parte da pintura. A dor tamb√©m √© uma cor importante em sua hist√≥ria."
                        };
                        return responses[lang];
                    }
                }
            ];
            
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < secondResponseCharacters.length; i++) {
                const char = secondResponseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < secondResponseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V4 Portal 16 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V4 Portal 16 DOM loaded');
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>