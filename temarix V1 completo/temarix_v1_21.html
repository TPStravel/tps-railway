<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Language" content="ko,en,pt">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V1 - Portal 21</title>
</head>
<body>
<!-- Temarix V1 - Portal 21: íƒ€ì¸ì˜ ì‹œì„  ì†ì— ê°‡í˜”ë˜ ë‚˜ -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix Portal 21 - íƒ€ì¸ì˜ ì‹œì„  ì†ì— ê°‡í˜”ë˜ ë‚˜</title>
</head>
<body>

<section class="portal portal-21" id="portal-21">
  <!-- Temarix Logo - Fixed Left Top -->
  <div class="temarix-logo">
    <h1 class="logo-text">ğŸŒŒ TEMARIX</h1>
    <p class="slogan" data-i18n="common.slogan">ë‹¹ì‹  ì•ˆì— ìˆ¨ì€ ì´ì•¼ê¸°ë¥¼ ë§ í•´ ì£¼ì„¸ìš”</p>
  </div>

  <!-- Language Selector - Fixed Right Top -->
  <div class="lang-selector">
    <button class="lang-btn active" data-lang="kr">KR</button>
    <button class="lang-btn" data-lang="en">EN</button>
    <button class="lang-btn" data-lang="pt">PT</button>
  </div>

  <!-- Portal Header - Center Top -->
  <div class="portal-header">
    <h1 data-i18n="portal21.title">ê°ì •ì˜ ë¬¸ì§€ë°© 21</h1>
    <h2 data-i18n="portal21.subtitle">íƒ€ì¸ì˜ ì‹œì„  ì†ì— ê°‡í˜”ë˜ ë‚˜</h2>
  </div>

  <!-- Message Stream -->
  <div class="message-stream" id="messageStream21">
    <!-- Messages will be added here via JavaScript -->
  </div>

  <!-- User Input Area -->
  <div class="input-area" id="inputArea21" style="display: none;">
    <div class="input-container">
      <textarea 
        id="userInput21" 
        rows="3" 
        placeholder="ì§€ê¸ˆ ë‹¹ì‹ ì€ ëˆ„êµ¬ì˜ ì‹œì„ ì— ë¬¶ì—¬ ìˆëŠ”ì§€ ì¡°ìš©íˆ ì ì–´ë³´ì„¸ìš”..."
        data-i18n-placeholder="portal21.input.placeholder"
      ></textarea>
      <button class="submit-btn" onclick="submitResponse21()">
        <span data-i18n="portal21.submit">ğŸ”“ í•´ë°© ë‚˜ëˆ„ê¸°</span>
      </button>
      <p class="input-hint" data-i18n="portal21.input.hint">Enter í‚¤ë¥¼ ëˆŒëŸ¬ë„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
    </div>
  </div>

  <!-- Next Portal Navigation -->
  <div class="next-portal-nav" id="nextPortalNav21" style="display: none;">
    <div class="nav-buttons">
      <button class="nav-btn yes-btn" onclick="goToNextPortal(22)" data-i18n="common.yes">ì˜ˆ</button>
      <button class="nav-btn no-btn" onclick="stayInPortal(21)" data-i18n="common.no">ì•„ë‹ˆìš”</button>
    </div>
  </div>

  <!-- Back to Main -->
  <div class="back-to-main">
    <button onclick="window.location.href='portal4.html'" data-i18n="common.back_to_main">
      ğŸ  ë©”ì¸ í¬íƒˆë¡œ ëŒì•„ê°€ê¸°
    </button>
  </div>
</section>

<style>
/* Portal Base Styles */
.portal {
  min-height: 100vh;
  background: linear-gradient(135deg, #1a1b4b 0%, #2d1b69 100%);
  color: white;
  padding: 80px 20px 20px 20px;
  font-family: 'Apple SD Gothic Neo', -apple-system, BlinkMacSystemFont, sans-serif;
  max-width: 100%;
  margin: 0 auto;
  position: relative;
}

/* Logo Glow Animation */
@keyframes glowCycle {
  0%, 100% { text-shadow: 0 0 8px rgba(255,255,255,0.2); }
  50% { text-shadow: 0 0 25px rgba(255,255,255,0.7); }
}

/* Temarix Logo - Fixed Left Top */
.temarix-logo {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
}

.logo-text {
  font-size: 1.8rem;
  font-weight: bold;
  color: #ffffff;
  margin: 0 0 5px 0;
  text-shadow: 0 0 20px rgba(255,255,255,0.3);
}

.slogan {
  color: #bbb;
  font-style: italic;
  font-size: 0.8rem;
  margin: 0;
}

/* Language Selector - Fixed Right Top */
.lang-selector {
  position: fixed;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 5px;
  flex-wrap: wrap;
  max-width: 120px;
  z-index: 1000;
}

.lang-btn {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 0.7rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.lang-btn:hover {
  background: rgba(255,255,255,0.2);
}

.lang-btn.active {
  background: #9c27b0;
  border-color: #9c27b0;
}

/* Portal Header - Center Top */
.portal-header {
  text-align: center;
  margin: 40px 0 30px 0;
  padding-top: 40px;
}

.portal-header h1 {
  font-size: 2.2rem;
  margin: 10px 0;
  color: #ffd700;
}

.portal-header h2 {
  font-size: 1.3rem;
  color: #e1bee7;
  font-weight: 300;
}

/* Message Stream */
.message-stream {
  max-height: 60vh;
  overflow-y: auto;
  padding: 20px 0;
  margin-bottom: 20px;
}

.message-card {
  background: rgba(255,255,255,0.1);
  border-radius: 15px;
  padding: 20px;
  margin: 15px 0;
  backdrop-filter: blur(10px);
  opacity: 0;
  transform: translateY(20px);
  animation: fadeInUp 0.6s ease forwards;
}

.message-card.prologue {
  border-left: 4px solid #e1bee7;
}

.message-card.ely {
  border-left: 4px solid #ffd700;
}

.message-card.sora {
  border-left: 4px solid #4dd0e1;
}

.message-card.noah {
  border-left: 4px solid #9c27b0;
}

.message-card.enya {
  border-left: 4px solid #ff9800;
}

.message-card.kaia {
  border-left: 4px solid #607d8b;
}

.message-card.cris {
  border-left: 4px solid #4caf50;
}

.message-card.kael {
  border-left: 4px solid #f44336;
}

.message-card.mira {
  border-left: 4px solid #9e9e9e;
}

.message-card.light {
  border-left: 4px solid #ffffff;
  background: rgba(255,255,255,0.15);
}

.message-card.question {
  border-left: 4px solid #f48fb1;
}

.message-card.user-input {
  border-left: 4px solid #81c784;
  background: rgba(129, 199, 132, 0.1);
}

.character-name {
  font-weight: bold;
  margin-bottom: 10px;
  font-size: 1.1rem;
}

.ely .character-name { color: #ffd700; }
.sora .character-name { color: #4dd0e1; }
.noah .character-name { color: #9c27b0; }
.enya .character-name { color: #ff9800; }
.kaia .character-name { color: #607d8b; }
.cris .character-name { color: #4caf50; }
.kael .character-name { color: #f44336; }
.mira .character-name { color: #9e9e9e; }

.message-text {
  line-height: 1.6;
  font-size: 1rem;
}

.typewriter {
  overflow: hidden;
  border-right: 2px solid rgba(255,255,255,0.7);
  white-space: nowrap;
  animation: blink-caret 1s step-end infinite;
}

@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes blink-caret {
  from, to { border-color: transparent; }
  50% { border-color: rgba(255,255,255,0.7); }
}

/* Input Area */
.input-area {
  background: rgba(0,0,0,0.3);
  padding: 20px;
  border-radius: 15px;
  margin: 20px 0;
  animation: fadeInUp 0.6s ease forwards;
}

.input-container textarea {
  width: 100%;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 10px;
  padding: 15px;
  color: white;
  font-size: 1rem;
  resize: vertical;
  min-height: 80px;
  box-sizing: border-box;
}

.input-container textarea::placeholder {
  color: rgba(255,255,255,0.6);
}

.submit-btn {
  background: linear-gradient(135deg, #9c27b0, #e1bee7);
  border: none;
  color: white;
  padding: 12px 30px;
  border-radius: 25px;
  font-size: 1rem;
  cursor: pointer;
  margin-top: 10px;
  transition: all 0.3s ease;
  width: 100%;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(156, 39, 176, 0.4);
}

.input-hint {
  color: rgba(255,255,255,0.6);
  font-size: 0.8rem;
  text-align: center;
  margin: 8px 0 0 0;
}

/* Next Portal Navigation */
.next-portal-nav {
  text-align: center;
  margin: 30px 0;
  animation: fadeInUp 0.6s ease forwards;
}

.nav-buttons {
  display: flex;
  gap: 20px;
  justify-content: center;
}

.nav-btn {
  padding: 12px 30px;
  border-radius: 25px;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.yes-btn {
  background: linear-gradient(135deg, #4caf50, #81c784);
  color: white;
  border-color: #4caf50;
}

.yes-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
}

.no-btn {
  background: rgba(255,255,255,0.1);
  color: white;
  border-color: rgba(255,255,255,0.3);
}

.no-btn:hover {
  background: rgba(255,255,255,0.2);
}

/* Back to Main */
.back-to-main {
  text-align: center;
  margin: 30px 0;
}

.back-to-main button {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  padding: 10px 20px;
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.back-to-main button:hover {
  background: rgba(255,255,255,0.2);
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .portal {
    padding: 100px 15px 20px 15px;
  }
  
  .temarix-logo {
    top: 15px;
    left: 15px;
  }
  
  .logo-text {
    font-size: 1.4rem;
  }
  
  .slogan {
    font-size: 0.7rem;
  }
  
  .lang-selector {
    top: 15px;
    right: 15px;
    max-width: 100px;
  }
  
  .lang-btn {
    padding: 3px 6px;
    font-size: 0.6rem;
  }
  
  .portal-header h1 {
    font-size: 1.8rem;
  }
  
  .portal-header h2 {
    font-size: 1.1rem;
  }
  
  .message-card {
    padding: 15px;
  }
  
  .nav-buttons {
    flex-direction: column;
    align-items: center;
  }
  
  .nav-btn {
    width: 200px;
  }
}
</style>

<script>
// Portal 21 Complete Data with Character Responses
const portal21Data = {
  kr: {
    title: "ê°ì •ì˜ ë¬¸ì§€ë°© 21",
    subtitle: "íƒ€ì¸ì˜ ì‹œì„  ì†ì— ê°‡í˜”ë˜ ë‚˜",
    prologue: "ì‚¬ëŒë“¤ì˜ ë§ê³¼ ëˆˆë¹›ì— ë‚˜ëŠ” ì ì  ì‘ì•„ì¡ŒìŠµë‹ˆë‹¤. ì˜ ë³´ì´ë ¤ê³ , ì›ƒê¸° ìœ„í•´ ì‚´ë‹¤ ë³´ë‹ˆ ì–´ëŠìƒŒê°€ ë‚´ ëª¨ìŠµì´ ì‚¬ë¼ì¡Œì–´ìš”. ë‹¤ë¥¸ ì‚¬ëŒì˜ ê¸°ì¤€ì— ë§ì¶”ë ¤ ì• ì“°ëŠ” ë™ì•ˆ, ì •ì‘ ë‚´ê°€ ëˆ„êµ¬ì¸ì§€ ìŠì–´ë²„ë ¸ìŠµë‹ˆë‹¤. ê·¸ë“¤ì˜ ì‹œì„ ì´ ê±°ìš¸ì´ ë˜ì–´ ë‚˜ë¥¼ ë¹„ì¶°ì£¼ê¸¸ ë°”ëì§€ë§Œ, ê·¸ ê±°ìš¸ ì†ì—ëŠ” ì™œê³¡ëœ ë‚´ ëª¨ìŠµë§Œ ë‚¨ì•„ ìˆì—ˆì–´ìš”.",
    ely: "ë‹¹ì‹ ì€ ë‚¨ì˜ ì‹œì„ ì„ ìœ„í•´ íƒœì–´ë‚œ ì¡´ì¬ê°€ ì•„ë‹ˆì—ìš”. ë‹¹ì‹ ì˜ ì‹œì„ ì´ ë¨¼ì €ì…ë‹ˆë‹¤.",
    sora: "ê·¸ ëˆˆë¹› ì†ì—ì„œ ì–¼ë§ˆë‚˜ ë§ì€ ë‚ ë“¤ì´ ìƒì²˜ë‚¬ëŠ”ì§€â€¦ ì´ì   ë†“ì•„ë„ ë¼ìš”.",
    noah: "ê¸°ì–µí•˜ì„¸ìš”. ë‹¹ì‹ ì˜ ì‚¶ì€ ë‹¹ì‹ ë§Œì´ ì±…ì„ì§ˆ ìˆ˜ ìˆì–´ìš”. ë‚¨ì˜ íŒë‹¨ì€ ê·¸ë¦¼ìì¼ ë¿ì…ë‹ˆë‹¤.",
    enya: "ê·¸ ê°€ë©´ ë²—ì–´ë„ ë¼ìš”. ë‚˜ëŠ” ìˆëŠ” ê·¸ëŒ€ë¡œì˜ ë‹¹ì‹ ì„ ë³´ê³  ì‹¶ì–´ìš”.",
    kaia: "ë‹¤ë¥¸ ì‚¬ëŒì´ ë„ ì¢‹ì•„í•˜ë“  ë§ë“  ë„Œ ì´ë¯¸ ì¶©ë¶„íˆ ê´œì°®ì€ ì‚¬ëŒì´ì—ìš”.",
    cris: "ë‚˜? ë‚œ ì‹œì„  ë”°ìœˆ ì‹ ê²½ ì•ˆ ì¨! ê·¼ë° ê±°ìš¸ì€ ì¢€ ë³´ê¸´ í•´~ ğŸ¤ªğŸª",
    kael: "ë„¤ ì‚¶ì¸ë° ì™œ ë‚¨ë“¤ì´ ë¦¬ëª¨ì»¨ ì¥ê³  ìˆì–´? ì§€ê¸ˆ ëºì–´! ë˜ì°¾ì•„!",
    mira: "í˜¹ì‹œâ€¦ ê·¸ ì‹œì„ ì„ ìƒìœ¼ë©´ ìì‹ ë„ ì‚¬ë¼ì§ˆê¹Œ ë´ ë‘ë ¤ì› ë˜ ê±´ ì•„ë‹ˆì—ìš”?",
    light: "ë‹¹ì‹ ì€ 'ë³´ì´ê¸° ìœ„í•´'ê°€ ì•„ë‹ˆë¼ 'ì¡´ì¬í•˜ê¸° ìœ„í•´' ì—¬ê¸°ì— ìˆìŠµë‹ˆë‹¤.",
    question: "ì§€ê¸ˆ ë‹¹ì‹ ì€ ëˆ„êµ¬ì˜ ì‹œì„ ì— ë¬¶ì—¬ ìˆë‚˜ìš”?",
    input: { 
      placeholder: "ì§€ê¸ˆ ë‹¹ì‹ ì€ ëˆ„êµ¬ì˜ ì‹œì„ ì— ë¬¶ì—¬ ìˆëŠ”ì§€ ì¡°ìš©íˆ ì ì–´ë³´ì„¸ìš”...",
      hint: "Enter í‚¤ë¥¼ ëˆŒëŸ¬ë„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
    },
    submit: "ğŸ”“ í•´ë°© ë‚˜ëˆ„ê¸°",
    slogan: "ë‹¹ì‹  ì•ˆì— ìˆ¨ì€ ì´ì•¼ê¸°ë¥¼ ë§ í•´ ì£¼ì„¸ìš”",
    response_ely: "ê·¸ ì‹œì„ ì˜ ì‚¬ìŠ¬ì„ ëŠëŠ” ì²« ê±¸ìŒì€ ì´ë¯¸ ì‹œì‘ëì–´ìš”. ë‹¹ì‹ ì˜ ìš©ê¸°ë¥¼ ë¯¿ì–´ìš”.",
    response_sora: "ì´ì œ ë‹¤ë¥¸ ì‚¬ëŒì˜ ëˆˆì´ ì•„ë‹Œ, ë‹¹ì‹  ìì‹ ì˜ ë§ˆìŒìœ¼ë¡œ ë‹¹ì‹ ì„ ë°”ë¼ë´ ì£¼ì„¸ìš”.",
    response_noah: "ê·¸ ì‹œì„ ì—ì„œ ë²—ì–´ë‚  ì¤€ë¹„ê°€ ë˜ì—ˆêµ°ìš”. ì´ì œ ì§„ì§œ ììœ ë¡œìš´ ì—¬ì •ì„ ì‹œì‘í•  ìˆ˜ ìˆì–´ìš”.\n\nğŸ‘‰ ë‹¤ìŒ ë¬¸ì§€ë°©ìœ¼ë¡œ í•¨ê»˜ ê°€ë„ ê´œì°®ì„ê¹Œìš”?",
    user_input_prefix: "ë‹¹ì‹ ì„ ë¬¶ê³  ìˆëŠ” ê·¸ ì‹œì„ :",
    yes: "ì˜ˆ",
    no: "ì•„ë‹ˆìš”"
  },
  en: {
    title: "Emotional Threshold 21",
    subtitle: "The Me Trapped in Others' Gaze",
    prologue: "In people's words and gazes, I gradually became smaller. Living to look good and to make others smile, somehow my true self disappeared. While trying to meet others' standards, I forgot who I really was. I hoped their gaze would become a mirror reflecting me, but only a distorted image of myself remained in that mirror.",
    ely: "You weren't born to live for others' gaze. Your own perspective comes first.",
    sora: "How many days were wounded in those gazes... You can let go now.",
    noah: "Remember. Only you can take responsibility for your life. Others' judgments are just shadows.",
    enya: "You can take off that mask. I want to see you as you truly are.",
    kaia: "Whether others like you or not, you're already a good enough person.",
    cris: "Me? I don't care about gazes! But I do look in mirrors sometimes~ ğŸ¤ªğŸª",
    kael: "It's your life, so why are others holding the remote control? Take it back! Reclaim it!",
    mira: "Perhaps... you were afraid that losing that gaze meant losing yourself too?",
    light: "You are here to 'exist,' not to 'be seen.'",
    question: "Whose gaze are you bound by right now?",
    input: { 
      placeholder: "Quietly write about whose gaze you are bound by right now...",
      hint: "You can also press Enter to submit"
    },
    submit: "ğŸ”“ Share Liberation",
    slogan: "Please tell me the story hidden within you",
    response_ely: "The first step to breaking those chains of gaze has already begun. I believe in your courage.",
    response_sora: "Now please look at yourself through your own heart, not through others' eyes.",
    response_noah: "You're ready to break free from that gaze. Now you can begin a truly free journey.\n\nğŸ‘‰ Shall we go to the next threshold together?",
    user_input_prefix: "The gaze that binds you:",
    yes: "Yes",
    no: "No"
  },
pt: {
  title: "Limiar Emocional 21",
  subtitle: "O Eu Preso no Olhar dos Outros",
  prologue: "Nas palavras e olhares das pessoas, fui me tornando cada vez menor. Vivendo para parecer bem, para fazer os outros sorrirem, de alguma forma perdi quem eu realmente era. Tentando atender aos padrÃµes dos outros, esqueci de mim. Esperava que seus olhares fossem espelhos que me refletissem, mas sÃ³ restou uma imagem distorcida.",
  ely: "VocÃª nÃ£o nasceu para viver sob o olhar dos outros. A sua visÃ£o vem primeiro.",
  sora: "Quantos dias foram feridos por aqueles olhares... Agora vocÃª pode soltÃ¡-los.",
  noah: "Lembre-se: sÃ³ vocÃª pode assumir a responsabilidade pela sua vida. Os julgamentos alheios sÃ£o apenas sombras.",
  enya: "VocÃª pode tirar essa mÃ¡scara. Quero ver quem vocÃª realmente Ã©.",
  kaia: "Gostem ou nÃ£o de vocÃª, vocÃª jÃ¡ Ã© uma boa pessoa.",
  cris: "Eu? NÃ£o ligo pra olhares! Mas Ã s vezes dou uma espiada no espelho~ ğŸ¤ªğŸª",
  kael: "A vida Ã© sua. Por que os outros estÃ£o com o controle remoto? Pegue de volta! Reivindique-a!",
  mira: "Talvez... vocÃª tenha temido que, ao perder aquele olhar, tambÃ©m perdesse a si mesmo?",
  light: "VocÃª estÃ¡ aqui para 'existir', nÃ£o para 'ser visto'.",
  question: "De qual olhar vocÃª estÃ¡ preso neste momento?",
  input: { 
    placeholder: "Escreva em silÃªncio de qual olhar vocÃª estÃ¡ preso neste momento...",
    hint: "VocÃª tambÃ©m pode pressionar Enter para enviar"
  },
  submit: "ğŸ”“ Compartilhar LibertaÃ§Ã£o",
  slogan: "Conte-me a histÃ³ria que estÃ¡ escondida dentro de vocÃª",
  response_ely: "O primeiro passo para romper essas correntes de olhares jÃ¡ comeÃ§ou. Eu acredito na sua coragem.",
  response_sora: "Agora, olhe para si mesmo com o seu prÃ³prio coraÃ§Ã£o, nÃ£o pelos olhos dos outros.",
  response_noah: "VocÃª estÃ¡ pronto para se libertar daquele olhar. Agora pode comeÃ§ar uma jornada verdadeiramente livre.\n\nğŸ‘‰ Vamos juntos para o prÃ³ximo limiar?",
  user_input_prefix: "O olhar que te prende:",
  yes: "Sim",
  no: "NÃ£o"
}
};

// Current language and state for Portal 21
let currentLang21 = 'kr';
let userInputText21 = '';

// Initialize Portal 21
function initPortal21() {
  displayInitialMessages21();
  setupLanguageSwitching21();
  setupEnterKeySubmission21();
}

// Display initial messages with typing effect
async function displayInitialMessages21() {
  const stream = document.getElementById('messageStream21');
  const messages = [
    { type: 'prologue', content: portal21Data[currentLang21].prologue },
    { type: 'ely', name: 'ğŸ‘‘ Ely', content: portal21Data[currentLang21].ely },
    { type: 'sora', name: 'ğŸ’§ Sora', content: portal21Data[currentLang21].sora },
    { type: 'noah', name: 'ğŸ§™â€â™‚ï¸ Noah', content: portal21Data[currentLang21].noah },
    { type: 'enya', name: 'ğŸ•¯ï¸ Enya', content: portal21Data[currentLang21].enya },
    { type: 'kaia', name: 'ğŸ˜¶ Kaia', content: portal21Data[currentLang21].kaia },
    { type: 'cris', name: 'ğŸƒ Cris', content: portal21Data[currentLang21].cris },
    { type: 'kael', name: 'ğŸ’¥ Kael', content: portal21Data[currentLang21].kael },
    { type: 'mira', name: 'ğŸŒ«ï¸ Mira', content: portal21Data[currentLang21].mira },
    { type: 'light', content: portal21Data[currentLang21].light },
    { type: 'question', content: portal21Data[currentLang21].question }
  ];

  for (let i = 0; i < messages.length; i++) {
    const messageCard = createMessageCard21(messages[i]);
    stream.appendChild(messageCard);
    stream.scrollTo({ top: stream.scrollHeight, behavior: 'smooth' });
    
    await typeText21(messageCard.querySelector('.message-text'), messages[i].content);
    await sleep21(1200);
  }
  
  // Show input area after all messages
  document.getElementById('inputArea21').style.display = 'block';
}

// Setup Enter key submission
function setupEnterKeySubmission21() {
  document.getElementById('userInput21').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      submitResponse21();
    }
  });
}

// Display character responses after user input
async function displayCharacterResponses21(userInput) {
  const stream = document.getElementById('messageStream21');
  
  // Show user input first
  const userCard = createMessageCard21({
    type: 'user-input',
    content: `${portal21Data[currentLang21].user_input_prefix}\n"${userInput}"`
  });
  stream.appendChild(userCard);
  stream.scrollTo({ top: stream.scrollHeight, behavior: 'smooth' });
  await typeText21(userCard.querySelector('.message-text'), userCard.querySelector('.message-text').textContent);
  await sleep21(1500);
  
  // Character responses
  const responses = [
    { type: 'ely', name: 'ğŸ‘‘ Ely', content: portal21Data[currentLang21].response_ely },
    { type: 'sora', name: 'ğŸ’§ Sora', content: portal21Data[currentLang21].response_sora },
    { type: 'noah', name: 'ğŸ§™â€â™‚ï¸ Noah', content: portal21Data[currentLang21].response_noah }
  ];

  for (let i = 0; i < responses.length; i++) {
    const responseCard = createMessageCard21(responses[i]);
    stream.appendChild(responseCard);
    stream.scrollTo({ top: stream.scrollHeight, behavior: 'smooth' });
    
    await typeText21(responseCard.querySelector('.message-text'), responses[i].content);
    await sleep21(1500);
  }
  
  // Show navigation buttons
  document.getElementById('nextPortalNav21').style.display = 'block';
}

function createMessageCard21(message) {
  const card = document.createElement('div');
  card.className = `message-card ${message.type}`;
  
  let cardHTML = '';
  if (message.name) {
    cardHTML += `<div class="character-name">${message.name}</div>`;
  }
  cardHTML += `<div class="message-text">${message.content || ''}</div>`;
  
  card.innerHTML = cardHTML;
  return card;
}

async function typeText21(element, text, speed = 80) {
  return new Promise((resolve) => {
    let i = 0;
    element.textContent = '';
    element.classList.add('typewriter');
    
    const timer = setInterval(() => {
      if (i < text.length) {
        element.textContent += text.charAt(i);
        i++;
      } else {
        clearInterval(timer);
        element.classList.remove('typewriter');
        resolve();
      }
    }, speed);
  });
}

function sleep21(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

function setupLanguageSwitching21() {
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      const newLang = btn.dataset.lang;
      if (portal21Data[newLang]) {
        currentLang21 = newLang;
        updatePortalTexts21();
      }
    });
  });
}

function updatePortalTexts21() {
  // Update title and subtitle
  document.querySelector('[data-i18n="portal21.title"]').textContent = portal21Data[currentLang21].title;
  document.querySelector('[data-i18n="portal21.subtitle"]').textContent = portal21Data[currentLang21].subtitle;
  
  // Update slogan
  document.querySelector('[data-i18n="common.slogan"]').textContent = portal21Data[currentLang21].slogan;
  
  // Update placeholder and hint
  document.getElementById('userInput21').placeholder = portal21Data[currentLang21].input.placeholder;
  document.querySelector('[data-i18n="portal21.input.hint"]').textContent = portal21Data[currentLang21].input.hint;
  
  // Update submit button
  document.querySelector('[data-i18n="portal21.submit"]').textContent = portal21Data[currentLang21].submit;
  
  // Update navigation buttons
  const yesBtn = document.querySelector('[data-i18n="common.yes"]');
  const noBtn = document.querySelector('[data-i18n="common.no"]');
  if (yesBtn) yesBtn.textContent = portal21Data[currentLang21].yes;
  if (noBtn) noBtn.textContent = portal21Data[currentLang21].no;
  
  // Update back to main button
  document.querySelector('[data-i18n="common.back_to_main"]').textContent = 
    currentLang21 === 'kr' ? 'ğŸ  ë©”ì¸ í¬íƒˆë¡œ ëŒì•„ê°€ê¸°' :
    currentLang21 === 'en' ? 'ğŸ  Back to Main Portal' :
    'ğŸ  ë©”ì¸ í¬íƒˆë¡œ ëŒì•„ê°€ê¸°';
}

function submitResponse21() {
  const input = document.getElementById('userInput21');
  const response = input.value.trim();
  
  if (response) {
    userInputText21 = response;
    
    // Hide input area
    document.getElementById('inputArea21').style.display = 'none';
    
    // Display character responses
    displayCharacterResponses21(response);
    
    // Clear input
    input.value = '';
  } else {
    // No alert, just focus on input
    input.focus();
    input.style.borderColor = '#f48fb1';
    setTimeout(() => {
      input.style.borderColor = 'rgba(255,255,255,0.3)';
    }, 2000);
  }
}

function stayInPortal(portalNum) {
  document.getElementById(`nextPortalNav${portalNum}`).style.display = 'none';
  document.getElementById(`inputArea${portalNum}`).style.display = 'block';
  document.getElementById(`userInput${portalNum}`).focus();
}

function goToNextPortal(nextNumber) {
  const nextUrl = `temarix_v1_${String(nextNumber).padStart(2, '0')}.html`;
  window.location.href = nextUrl;
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
  if (document.getElementById('portal-21')) {
    initPortal21();
  }
});
</script>

</body>
</html>
</body>
</html>