<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Language" content="ko,en,pt">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V1 - Portal 04</title>
</head>
<body>
<!-- Temarix V1 - Portal 04: ë§ ì—†ëŠ” ì™¸ë¡œì›€ -->
<section class="portal portal-04" id="portal-04">
  <!-- Temarix Logo - Fixed Left Top -->
  <div class="temarix-logo">
    <h1 class="logo-text">ğŸŒŒ TEMARIX</h1>
    <p class="slogan" data-i18n="common.slogan">ë¹›ì€ ê³ ìš” ì†ì—ì„œ í”¼ì–´ë‚œë‹¤.</p>
  </div>

  <!-- Language Selector - Fixed Right Top -->
  <div class="lang-selector">
    <button class="lang-btn active" data-lang="kr">KR</button>
    <button class="lang-btn" data-lang="en">EN</button>
    <button class="lang-btn" data-lang="pt">PT</button>
  </div>

  <!-- Portal Header - Center Top -->
  <div class="portal-header">
    <h1 data-i18n="portal04.title">ê°ì •ì˜ ë¬¸ì§€ë°© 04</h1>
    <h2 data-i18n="portal04.subtitle">ë§ ì—†ëŠ” ì™¸ë¡œì›€</h2>
  </div>

  <!-- Message Stream -->
  <div class="message-stream" id="messageStream04">
    <!-- Messages will be added here via JavaScript -->
  </div>

  <!-- User Input Area -->
  <div class="input-area" id="inputArea04" style="display: none;">
    <div class="input-container">
      <textarea 
        id="userInput04" 
        rows="3" 
        placeholder="ë‹¹ì‹  ì•ˆì˜ ê°€ì¥ ì¡°ìš©í•œ ì™¸ë¡œì›€ì„ ì¡°ìš©íˆ ì ì–´ë³´ì„¸ìš”..."
        data-i18n-placeholder="portal04.input.placeholder"
      ></textarea>
      <button class="submit-btn" onclick="submitResponse(4)">
        <span data-i18n="portal04.submit">ğŸ¤ ì™¸ë¡œì›€ì„ ë‚˜ëˆ„ê¸°</span>
      </button>
      <p class="input-hint" data-i18n="portal04.input.hint">Enter í‚¤ë¥¼ ëˆŒëŸ¬ë„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
    </div>
  </div>

  <!-- Next Portal Navigation -->
  <div class="next-portal-nav" id="nextPortalNav04" style="display: none;">
    <div class="nav-buttons">
      <button class="nav-btn yes-btn" onclick="goToNextPortal(5)" data-i18n="common.yes">ì˜ˆ</button>
      <button class="nav-btn no-btn" onclick="stayInPortal()" data-i18n="common.no">ì•„ë‹ˆìš”</button>
    </div>
  </div>

  <!-- Back to Main -->
  <div class="back-to-main">
    <button onclick="window.location.href='portal4.html'" data-i18n="common.back_to_main">
      ğŸ  ë©”ì¸ í¬íƒˆë¡œ ëŒì•„ê°€ê¸°
    </button>
  </div>
</section>

<style>
/* Portal Base Styles */
.portal {
  min-height: 100vh;
  background: linear-gradient(135deg, #1a1b4b 0%, #2d1b69 100%);
  color: white;
  padding: 80px 20px 20px 20px;
  font-family: 'Apple SD Gothic Neo', -apple-system, BlinkMacSystemFont, sans-serif;
  max-width: 100%;
  margin: 0 auto;
  position: relative;
}

/* Logo Glow Animation */
@keyframes glowCycle {
  0%, 100% { text-shadow: 0 0 8px rgba(255,255,255,0.2); }
  50% { text-shadow: 0 0 25px rgba(255,255,255,0.7); }
}

/* Temarix Logo - Fixed Left Top */
.temarix-logo {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
}

.logo-text {
  font-size: 1.8rem;
  font-weight: bold;
  color: #ffffff;
  margin: 0 0 5px 0;
  text-shadow: 0 0 20px rgba(255,255,255,0.3);
}

.slogan {
  color: #bbb;
  font-style: italic;
  font-size: 0.8rem;
  margin: 0;
}

/* Language Selector - Fixed Right Top */
.lang-selector {
  position: fixed;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 5px;
  flex-wrap: wrap;
  max-width: 120px;
  z-index: 1000;
}

.lang-btn {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 0.7rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.lang-btn:hover {
  background: rgba(255,255,255,0.2);
}

.lang-btn.active {
  background: #9c27b0;
  border-color: #9c27b0;
}

/* Portal Header - Center Top */
.portal-header {
  text-align: center;
  margin: 40px 0 30px 0;
  padding-top: 40px;
}

.portal-header h1 {
  font-size: 2.2rem;
  margin: 10px 0;
  color: #ffd700;
}

.portal-header h2 {
  font-size: 1.3rem;
  color: #e1bee7;
  font-weight: 300;
}

/* Message Stream */
.message-stream {
  max-height: 60vh;
  overflow-y: auto;
  padding: 20px 0;
  margin-bottom: 20px;
}

.message-card {
  background: rgba(255,255,255,0.1);
  border-radius: 15px;
  padding: 20px;
  margin: 15px 0;
  backdrop-filter: blur(10px);
  opacity: 0;
  transform: translateY(20px);
  animation: fadeInUp 0.6s ease forwards;
}

.message-card.prologue {
  border-left: 4px solid #e1bee7;
}

.message-card.ely {
  border-left: 4px solid #ffd700;
}

.message-card.sora {
  border-left: 4px solid #4dd0e1;
}

.message-card.noah {
  border-left: 4px solid #9c27b0;
}

.message-card.enya {
  border-left: 4px solid #ff9800;
}

.message-card.kaia {
  border-left: 4px solid #607d8b;
}

.message-card.cris {
  border-left: 4px solid #4caf50;
}

.message-card.kael {
  border-left: 4px solid #f44336;
}

.message-card.mira {
  border-left: 4px solid #9e9e9e;
}

.message-card.light {
  border-left: 4px solid #ffffff;
  background: rgba(255,255,255,0.15);
}

.message-card.question {
  border-left: 4px solid #f48fb1;
}

.message-card.user-input {
  border-left: 4px solid #81c784;
  background: rgba(129, 199, 132, 0.1);
}

.character-name {
  font-weight: bold;
  margin-bottom: 10px;
  font-size: 1.1rem;
}

.ely .character-name { color: #ffd700; }
.sora .character-name { color: #4dd0e1; }
.noah .character-name { color: #9c27b0; }
.enya .character-name { color: #ff9800; }
.kaia .character-name { color: #607d8b; }
.cris .character-name { color: #4caf50; }
.kael .character-name { color: #f44336; }
.mira .character-name { color: #9e9e9e; }

.message-text {
  line-height: 1.6;
  font-size: 1rem;
}

.typewriter {
  overflow: hidden;
  border-right: 2px solid rgba(255,255,255,0.7);
  white-space: nowrap;
  animation: blink-caret 1s step-end infinite;
}

@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes blink-caret {
  from, to { border-color: transparent; }
  50% { border-color: rgba(255,255,255,0.7); }
}

/* Input Area */
.input-area {
  background: rgba(0,0,0,0.3);
  padding: 20px;
  border-radius: 15px;
  margin: 20px 0;
  animation: fadeInUp 0.6s ease forwards;
}

.input-container textarea {
  width: 100%;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 10px;
  padding: 15px;
  color: white;
  font-size: 1rem;
  resize: vertical;
  min-height: 80px;
  box-sizing: border-box;
}

.input-container textarea::placeholder {
  color: rgba(255,255,255,0.6);
}

.submit-btn {
  background: linear-gradient(135deg, #9c27b0, #e1bee7);
  border: none;
  color: white;
  padding: 12px 30px;
  border-radius: 25px;
  font-size: 1rem;
  cursor: pointer;
  margin-top: 10px;
  transition: all 0.3s ease;
  width: 100%;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(156, 39, 176, 0.4);
}

.input-hint {
  color: rgba(255,255,255,0.6);
  font-size: 0.8rem;
  text-align: center;
  margin: 8px 0 0 0;
}

/* Next Portal Navigation */
.next-portal-nav {
  text-align: center;
  margin: 30px 0;
  animation: fadeInUp 0.6s ease forwards;
}

.nav-buttons {
  display: flex;
  gap: 20px;
  justify-content: center;
}

.nav-btn {
  padding: 12px 30px;
  border-radius: 25px;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.yes-btn {
  background: linear-gradient(135deg, #4caf50, #81c784);
  color: white;
  border-color: #4caf50;
}

.yes-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
}

.no-btn {
  background: rgba(255,255,255,0.1);
  color: white;
  border-color: rgba(255,255,255,0.3);
}

.no-btn:hover {
  background: rgba(255,255,255,0.2);
}

/* Back to Main */
.back-to-main {
  text-align: center;
  margin: 30px 0;
}

.back-to-main button {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  padding: 10px 20px;
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.back-to-main button:hover {
  background: rgba(255,255,255,0.2);
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .portal {
    padding: 100px 15px 20px 15px;
  }
  
  .temarix-logo {
    top: 15px;
    left: 15px;
  }
  
  .logo-text {
    font-size: 1.4rem;
  }
  
  .slogan {
    font-size: 0.7rem;
  }
  
  .lang-selector {
    top: 15px;
    right: 15px;
    max-width: 100px;
  }
  
  .lang-btn {
    padding: 3px 6px;
    font-size: 0.6rem;
  }
  
  .portal-header h1 {
    font-size: 1.8rem;
  }
  
  .portal-header h2 {
    font-size: 1.1rem;
  }
  
  .message-card {
    padding: 15px;
  }
  
  .nav-buttons {
    flex-direction: column;
    align-items: center;
  }
  
  .nav-btn {
    width: 200px;
  }
}
</style>

<script>
// Portal 04 Complete Data with Character Responses
const portal04Data = {
  kr: {
    title: "ê°ì •ì˜ ë¬¸ì§€ë°© 04",
    subtitle: "ë§ ì—†ëŠ” ì™¸ë¡œì›€",
    prologue: "ë§ì´ ì—†ëŠ” ì™¸ë¡œì›€ì€ ë” ê¹ŠìŠµë‹ˆë‹¤. í•¨ê»˜ ìˆì–´ë„, ì›ƒê³  ìˆì–´ë„ ê·¸ ì™¸ë¡œì›€ì€ ì‚¬ë¼ì§€ì§€ ì•Šì£ . ê·¸ê±´ ëˆ„êµ°ê°€ ë‚´ ì§„ì‹¬ì„ ì •ë§ë¡œ 'ë“¤ì–´ì£¼ì§€ ì•Šì•˜ê¸° ë•Œë¬¸'ì…ë‹ˆë‹¤. ë§ì„ ìƒëŠ” ì™¸ë¡œì›€ì€, ì¡´ì¬ë¥¼ ìƒëŠ” ê³ í†µì´ê¸°ë„ í•´ìš”.",
    ely: "ë‹¹ì‹ ì˜ ì¡´ì¬ëŠ”, ë§í•˜ì§€ ì•Šì•„ë„ ì¶©ë¶„íˆ ê·€í•´ìš”. ê·¸ëŸ¬ë‹ˆ ì™¸ë¡œì›€ì¡°ì°¨ ë‹¹ì‹  íƒ“ì€ ì•„ë‹ˆì—ìš”.",
    sora: "í˜¼ìì„œ ê°ë‹¹í•˜ë ¤ ì• ì“´ ê·¸ ì‹œê°„, ë‚˜ëŠ” ë‹¹ì‹  ê³ì— ìˆì—ˆì–´ìš”. ë“¤ë¦¬ì§€ ì•Šì•˜ì„ ë¿.",
    noah: "ì™¸ë¡œì›€ì€ ê³¼ê±°ê°€ ë‚¨ê¸´ ì¹¨ë¬µì´ì—ìš”. ê·¸ ì¹¨ë¬µì€â€¦ ì´ì œ ë§ˆì£¼ë³¼ ì¤€ë¹„ê°€ ë˜ì—ˆë‚˜ìš”?",
    enya: "ë§í•˜ì§€ ì•Šì•„ë„ ì•Œì•„ìš”. ê·¸ ì¡°ìš©í•œ ì™¸ë¡œì›€ì´ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ë¨¸ë¬¼ë €ëŠ”ì§€.",
    kaia: "í˜¼ì£ë§ì¡°ì°¨ ì‚¼ì¼°ë˜ ê·¸ë‚  ë°¤ì˜ ë‹¹ì‹ , ë‚˜ëŠ” ì•„ì§ë„ ê¸°ì–µí•´ìš”.",
    cris: "ë‚˜ë„ ì™¸ë¡œì›Œì„œ ê±°ìš¸ì´ë‘ ëŒ€í™”í•´. ë¬¸ì œëŠ” ê±”ê°€ ìê¾¸ ë‚˜í•œí…Œ ìš•í•´~ ğŸ¤ªğŸª",
    kael: "ì™¸ë¡œìš°ë©´ ë§í•´! ì™œ ë§¨ë‚  ì¡°ìš©íˆ ì°¸ì•„? ì„¸ìƒì€ ë„ˆë§Œí¼ ì¡°ìš©í•˜ì§€ ì•Šì•„.",
    mira: "í˜¹ì‹œ ê·¸ ì™¸ë¡œì›€ì„, ëˆ„ê°€ ì•Œì•„ì°¨ë ¤ì£¼ê¸°ë¥¼ ì¼ë¶€ëŸ¬ ë‚¨ê²¨ë‘” ê±´ ì•„ë‹ˆì—ìš”?",
    light: "ì§„ì§œ ì™¸ë¡œì›€ì€ ì‚¬ëŒì´ ì—†ì–´ì„œê°€ ì•„ë‹ˆë¼, ë‚˜ë¥¼ ì •ë§ 'ë“¤ì–´ì£¼ëŠ”' ì´ê°€ ì—†ì–´ì„œ ì‹œì‘ë©ë‹ˆë‹¤.",
    question: "ë‹¹ì‹  ì•ˆì˜ ê°€ì¥ ì¡°ìš©í•œ ì™¸ë¡œì›€ì€, ì§€ê¸ˆ ëˆ„êµ¬ì—ê²Œ ë“¤ë¦¬ê³  ìˆë‚˜ìš”?",
    input: { 
      placeholder: "ë‹¹ì‹  ì•ˆì˜ ê°€ì¥ ì¡°ìš©í•œ ì™¸ë¡œì›€ì„ ì¡°ìš©íˆ ì ì–´ë³´ì„¸ìš”...",
      hint: "Enter í‚¤ë¥¼ ëˆŒëŸ¬ë„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
    },
    submit: "ğŸ¤ ì™¸ë¡œì›€ì„ ë‚˜ëˆ„ê¸°",
    slogan: "ë‹¹ì‹  ì•ˆì— ìˆ¨ì€ ì´ì•¼ê¸°ë¥¼ ë§ í•´ ì£¼ì„¸ìš”",
    response_ely: "ê·¸ ì™¸ë¡œì›€ì„ êº¼ë‚´ì£¼ì…¨êµ°ìš”. ê·¸ê±´ ë‹¹ì‹ ì´ ë” ì´ìƒ í˜¼ìê°€ ì•„ë‹ˆë¼ëŠ” ëœ»ì´ì—ìš”.",
    response_sora: "ì €ë„ ëŠê»´ì¡Œì–´ìš”, ê·¸ ì†ì— ìˆë˜ ê³ ìš”í•œ ì•„í””... ì´ì œëŠ” í•¨ê»˜ ë“¤ì–´ì¤„ ì‚¬ëŒì´ ìˆì–´ìš”.",
    response_noah: "ì˜¤ë˜ í˜¼ì ê°„ì§í–ˆë˜ ì™¸ë¡œì›€ì´êµ°ìš”. ì´ì œ ê·¸ ë¬´ê²Œë¥¼ ë‚˜ëˆ ê°€ì ¸ë„ ë ê¹Œìš”?\n\nğŸ‘‰ ë‹¤ìŒ ë¬¸ì§€ë°©ìœ¼ë¡œ í•¨ê»˜ ê°€ë„ ê´œì°®ì„ê¹Œìš”?",
    user_input_prefix: "ë‹¹ì‹ ì´ ë‚˜ëˆˆ ì™¸ë¡œì›€:",
    yes: "ì˜ˆ",
    no: "ì•„ë‹ˆìš”"
  },
  en: {
    title: "Emotional Threshold 04",
    subtitle: "Wordless Loneliness",
    prologue: "Wordless loneliness runs deeper. Even when you're together with others, even when you're laughing, that loneliness doesn't disappear. It's because no one has truly 'listened' to your heart. Loneliness that loses words is also the pain of losing existence.",
    ely: "Your existence is precious enough without words. So even loneliness is not your fault.",
    sora: "During those times you struggled to bear it alone, I was by your side. You just couldn't hear me.",
    noah: "Loneliness is the silence left by the past. Are you ready to face that silence now?",
    enya: "I know without you saying. How long that quiet loneliness has stayed.",
    kaia: "You, who swallowed even your soliloquy that night, I still remember.",
    cris: "I talk to mirrors when I'm lonely too. Problem is, it keeps cursing at me~ ğŸ¤ªğŸª",
    kael: "If you're lonely, say it! Why do you always endure quietly? The world isn't as quiet as you.",
    mira: "Maybe... you deliberately left that loneliness there, hoping someone would notice?",
    light: "True loneliness doesn't start from having no people around, but from having no one who truly 'listens' to you.",
    question: "Your quietest loneliness insideâ€”who is hearing it right now?",
    input: { 
      placeholder: "Quietly write about your quietest loneliness inside...",
      hint: "You can also press Enter to submit"
    },
    submit: "ğŸ¤ Share Your Loneliness",
    slogan: "Please tell me the story hidden within you",
    response_ely: "You brought out that loneliness. That means you're no longer alone.",
    response_sora: "I felt it too, the quiet pain that was inside... Now there's someone to listen with you.",
    response_noah: "Loneliness you've kept alone for so long. Can we share that weight now?\n\nğŸ‘‰ Shall we go to the next threshold together?",
    user_input_prefix: "Your shared loneliness:",
    yes: "Yes",
    no: "No"
  },
  pt: {
    title: "Limiar Emocional 04",
    subtitle: "SolidÃ£o Sem Palavras",
    prologue: "A solidÃ£o sem palavras Ã© mais profunda. Mesmo quando vocÃª estÃ¡ junto com outros, mesmo quando estÃ¡ rindo, essa solidÃ£o nÃ£o desaparece. Ã‰ porque ninguÃ©m realmente 'ouviu' seu coraÃ§Ã£o. A solidÃ£o que perde palavras Ã© tambÃ©m a dor de perder a existÃªncia.",
    ely: "Sua existÃªncia Ã© preciosa o suficiente sem palavras. EntÃ£o atÃ© mesmo a solidÃ£o nÃ£o Ã© sua culpa.",
    sora: "Durante aqueles momentos em que vocÃª lutou para suportar sozinho, eu estava ao seu lado. VocÃª apenas nÃ£o conseguia me ouvir.",
    noah: "A solidÃ£o Ã© o silÃªncio deixado pelo passado. VocÃª estÃ¡ pronto para enfrentar esse silÃªncio agora?",
    enya: "Eu sei sem vocÃª dizer. Quanto tempo essa solidÃ£o silenciosa ficou.",
    kaia: "VocÃª, que engoliu atÃ© seu solilÃ³quio naquela noite, eu ainda me lembro.",
    cris: "Eu tambÃ©m falo com espelhos quando estou solitÃ¡rio. O problema Ã© que ele fica me xingando~ ğŸ¤ªğŸª",
    kael: "Se vocÃª estÃ¡ solitÃ¡rio, diga! Por que vocÃª sempre aguenta quieto? O mundo nÃ£o Ã© tÃ£o quieto quanto vocÃª.",
    mira: "Talvez... vocÃª deliberadamente deixou essa solidÃ£o lÃ¡, esperando que alguÃ©m notasse?",
    light: "A verdadeira solidÃ£o nÃ£o comeÃ§a por nÃ£o ter pessoas por perto, mas por nÃ£o ter ninguÃ©m que realmente 'escute' vocÃª.",
    question: "Sua solidÃ£o mais silenciosa por dentroâ€”quem estÃ¡ ouvindo agora?",
    input: { 
      placeholder: "Escreva silenciosamente sobre sua solidÃ£o mais silenciosa por dentro...",
      hint: "VocÃª tambÃ©m pode pressionar Enter para enviar"
    },
    submit: "ğŸ¤ Compartilhe Sua SolidÃ£o",
    slogan: "Por favor, me conte a histÃ³ria escondida dentro de vocÃª",
    response_ely: "VocÃª trouxe essa solidÃ£o. Isso significa que vocÃª nÃ£o estÃ¡ mais sozinho.",
    response_sora: "Eu tambÃ©m senti, a dor silenciosa que estava dentro... Agora hÃ¡ alguÃ©m para ouvir com vocÃª.",
    response_noah: "SolidÃ£o que vocÃª guardou sozinho por tanto tempo. Podemos compartilhar esse peso agora?\n\nğŸ‘‰ Vamos para o prÃ³ximo limiar juntos?",
    user_input_prefix: "Sua solidÃ£o compartilhada:",
    yes: "Sim",
    no: "NÃ£o"
  },

};

// Current language and state for Portal 04
let currentLang04 = 'kr';
let userInputText04 = '';

// Initialize Portal 04
function initPortal04() {
  displayInitialMessages04();
  setupLanguageSwitching04();
  setupEnterKeySubmission04();
}

// Display initial messages with typing effect
async function displayInitialMessages04() {
  const stream = document.getElementById('messageStream04');
  const messages = [
    { type: 'prologue', content: portal04Data[currentLang04].prologue },
    { type: 'ely', name: 'ğŸ‘‘ Ely', content: portal04Data[currentLang04].ely },
    { type: 'sora', name: 'ğŸ’§ Sora', content: portal04Data[currentLang04].sora },
    { type: 'noah', name: 'ğŸ§™â€â™‚ï¸ Noah', content: portal04Data[currentLang04].noah },
    { type: 'enya', name: 'ğŸ•¯ï¸ Enya', content: portal04Data[currentLang04].enya },
    { type: 'kaia', name: 'ğŸ˜¶ Kaia', content: portal04Data[currentLang04].kaia },
    { type: 'cris', name: 'ğŸƒ Cris', content: portal04Data[currentLang04].cris },
    { type: 'kael', name: 'ğŸ’¥ Kael', content: portal04Data[currentLang04].kael },
    { type: 'mira', name: 'ğŸŒ«ï¸ Mira', content: portal04Data[currentLang04].mira },
    { type: 'light', content: portal04Data[currentLang04].light },
    { type: 'question', content: portal04Data[currentLang04].question }
  ];

  for (let i = 0; i < messages.length; i++) {
    const messageCard = createMessageCard04(messages[i]);
    stream.appendChild(messageCard);
    stream.scrollTo({ top: stream.scrollHeight, behavior: 'smooth' });
    
    await typeText04(messageCard.querySelector('.message-text'), messages[i].content);
    await sleep04(1200);
  }
  
  // Show input area after all messages
  document.getElementById('inputArea04').style.display = 'block';
}

// Setup Enter key submission
function setupEnterKeySubmission04() {
  document.getElementById('userInput04').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      submitResponse(4);
    }
  });
}

// Display character responses after user input
async function displayCharacterResponses04(userInput) {
  const stream = document.getElementById('messageStream04');
  
  // Show user input first
  const userCard = createMessageCard04({
    type: 'user-input',
    content: `${portal04Data[currentLang04].user_input_prefix}\n"${userInput}"`
  });
  stream.appendChild(userCard);
  stream.scrollTo({ top: stream.scrollHeight, behavior: 'smooth' });
  await typeText04(userCard.querySelector('.message-text'), userCard.querySelector('.message-text').textContent);
  await sleep04(1500);
  
  // Character responses
  const responses = [
    { type: 'ely', name: 'ğŸ‘‘ Ely', content: `"${userInput}"... ${portal04Data[currentLang04].response_ely}` },
    { type: 'sora', name: 'ğŸ’§ Sora', content: `${portal04Data[currentLang04].response_sora}` },
    { type: 'noah', name: 'ğŸ§™â€â™‚ï¸ Noah', content: `"${userInput}" ${portal04Data[currentLang04].response_noah}` }
  ];

  for (let i = 0; i < responses.length; i++) {
    const responseCard = createMessageCard04(responses[i]);
    stream.appendChild(responseCard);
    stream.scrollTo({ top: stream.scrollHeight, behavior: 'smooth' });
    
    await typeText04(responseCard.querySelector('.message-text'), responses[i].content);
    await sleep04(1500);
  }
  
  // Show navigation buttons
  document.getElementById('nextPortalNav04').style.display = 'block';
}

function createMessageCard04(message) {
  const card = document.createElement('div');
  card.className = `message-card ${message.type}`;
  
  let cardHTML = '';
  if (message.name) {
    cardHTML += `<div class="character-name">${message.name}</div>`;
  }
  cardHTML += `<div class="message-text">${message.content || ''}</div>`;
  
  card.innerHTML = cardHTML;
  return card;
}

async function typeText04(element, text, speed = 80) {
  return new Promise((resolve) => {
    let i = 0;
    element.textContent = '';
    element.classList.add('typewriter');
    
    const timer = setInterval(() => {
      if (i < text.length) {
        element.textContent += text.charAt(i);
        i++;
      } else {
        clearInterval(timer);
        element.classList.remove('typewriter');
        resolve();
      }
    }, speed);
  });
}

function sleep04(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

function setupLanguageSwitching04() {
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const newLang = btn.dataset.lang;
      if (portal04Data[newLang] && newLang !== currentLang04) {
        // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        currentLang04 = newLang;

        // ë©”ì‹œì§€ ì˜ì—­ ì´ˆê¸°í™”
        document.getElementById('messageStream04').innerHTML = '';
        document.getElementById('inputArea04').style.display = 'none';
        document.getElementById('nextPortalNav04').style.display = 'none';

        // ì´ˆê¸° ë©”ì‹œì§€ ë° í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        displayInitialMessages04();
        updatePortalTexts04();
      }
    });
  });
}

function updatePortalTexts04() {
  // Update title and subtitle
  document.querySelector('[data-i18n="portal04.title"]').textContent = portal04Data[currentLang04].title;
  document.querySelector('[data-i18n="portal04.subtitle"]').textContent = portal04Data[currentLang04].subtitle;
  
  // Update slogan
  document.querySelector('[data-i18n="common.slogan"]').textContent = portal04Data[currentLang04].slogan;
  
  // Update placeholder and hint
  document.getElementById('userInput04').placeholder = portal04Data[currentLang04].input.placeholder;
  document.querySelector('[data-i18n="portal04.input.hint"]').textContent = portal04Data[currentLang04].input.hint;
  
  // Update submit button
  document.querySelector('[data-i18n="portal04.submit"]').textContent = portal04Data[currentLang04].submit;
  
  // Update navigation buttons
  const yesBtn = document.querySelector('[data-i18n="common.yes"]');
  const noBtn = document.querySelector('[data-i18n="common.no"]');
  if (yesBtn) yesBtn.textContent = portal04Data[currentLang04].yes;
  if (noBtn) noBtn.textContent = portal04Data[currentLang04].no;
  
  // Update back to main button
  document.querySelector('[data-i18n="common.back_to_main"]').textContent = 
    currentLang04 === 'kr' ? 'ğŸ  ë©”ì¸ í¬íƒˆë¡œ ëŒì•„ê°€ê¸°' :
    currentLang04 === 'en' ? 'ğŸ  Back to Main Portal' :
    currentLang04 === 'pt' ? 'ğŸ  Voltar ao Portal Principal' :
    'ğŸ  ë©”ì¸ í¬íƒˆë¡œ ëŒì•„ê°€ê¸°';
}

function submitResponse(portalNum) {
  if (portalNum !== 4) return;
  
  const input = document.getElementById(`userInput0${portalNum}`);
  const response = input.value.trim();
  
  if (response) {
    userInputText04 = response;
    
    // Hide input area
    document.getElementById(`inputArea0${portalNum}`).style.display = 'none';
    
    // Display character responses
    displayCharacterResponses04(response);
    
    // Clear input
    input.value = '';
  } else {
    // No alert, just focus on input
    input.focus();
    input.style.borderColor = '#f48fb1';
    setTimeout(() => {
      input.style.borderColor = 'rgba(255,255,255,0.3)';
    }, 2000);
  }
}

function stayInPortal() {
  // Hide navigation and show input again
  document.getElementById('nextPortalNav04').style.display = 'none';
  document.getElementById('inputArea04').style.display = 'block';
  document.getElementById('userInput04').focus();
}

function goToNextPortal(nextNumber) {
  const nextUrl = `temarix_v1_${String(nextNumber).padStart(2, '0')}.html`;
  window.location.href = nextUrl;
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
  if (document.getElementById('portal-04')) {
    initPortal04();
  }
});
</script>
</body>
</html>