<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Language" content="ko,en,pt">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V1 - Portal 25</title>
    
    <!-- Firebase SDK v8 - Primary CDN -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Firebase SDK v8 - Fallback CDN -->
    <script>
      // Check if Firebase loaded, if not try alternative CDN
      if (typeof firebase === 'undefined') {
        console.log('ğŸ”„ Loading Firebase from fallback CDN...');
        const scripts = [
          'https://firebase.googleapis.com/libs/firebase/8.10.1/firebase-app.js',
          'https://firebase.googleapis.com/libs/firebase/8.10.1/firebase-auth.js',
          'https://firebase.googleapis.com/libs/firebase/8.10.1/firebase-firestore.js'
        ];
        
        scripts.forEach(src => {
          const script = document.createElement('script');
          script.src = src;
          script.async = false;
          document.head.appendChild(script);
        });
      }
    </script>
</head>
<body>
<!-- Temarix V2 - Portal 25: ì§€ê¸ˆ ì´ ìˆœê°„, ë‚˜ì—ê²Œ ë§ºëŠ” ì•½ì† -->
<section class="portal portal-25" id="portal-25">
  <!-- Temarix Logo - Fixed Left Top -->
  <div class="temarix-logo">
    <h1 class="logo-text">ğŸŒŒ TEMARIX</h1>
    <p class="slogan" data-i18n="common.slogan">ë‹¹ì‹  ì•ˆì— ìˆ¨ì€ ì´ì•¼ê¸°ë¥¼ ë§ í•´ ì£¼ì„¸ìš”</p>
  </div>

  <!-- Language Selector - Fixed Right Top -->
  <div class="lang-selector">
    <button class="lang-btn active" data-lang="kr">KR</button>
    <button class="lang-btn" data-lang="en">EN</button>
    <button class="lang-btn" data-lang="pt">PT</button>
  </div>

  <!-- Portal Header - Center Top -->
  <div class="portal-header">
    <h1 data-i18n="portal25.title">ê°ì •ì˜ ë¬¸ì§€ë°© 25</h1>
    <h2 data-i18n="portal25.subtitle">ì§€ê¸ˆ ì´ ìˆœê°„, ë‚˜ì—ê²Œ ë§ºëŠ” ì•½ì†</h2>
  </div>

  <!-- Message Stream -->
  <div class="message-stream" id="messageStream25">
    <!-- Messages will be added here via JavaScript -->
  </div>

  <!-- User Input Area -->
  <div class="input-area" id="inputArea25" style="display: none;">
    <div class="input-container">
      <textarea 
        id="userInput25" 
        rows="3" 
        placeholder="ì§€ê¸ˆ ì´ ìˆœê°„, ë‹¹ì‹ ì´ ìì‹ ì—ê²Œ ë§ºê³  ì‹¶ì€ ì•½ì†ì„ ì ì–´ë³´ì„¸ìš”..."
        data-i18n-placeholder="portal25.input.placeholder"
      ></textarea>
      <button class="submit-btn" onclick="submitResponse(25)">
        <span data-i18n="portal25.submit">âœ¨ ë‚˜ì™€ì˜ ì•½ì† ìƒˆê¸°ê¸°</span>
      </button>
      <p class="input-hint" data-i18n="portal25.input.hint">Enter í‚¤ë¥¼ ëˆŒëŸ¬ë„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
    </div>
  </div>

  <!-- Journey Completion -->
  <div class="journey-completion" id="journeyCompletion25" style="display: none;">
    <div class="completion-card">
      <div class="completion-header">
        <h3 data-i18n="portal25.completion_title">âœ¨ ë‹¹ì‹ ì€ ê°ì •ì˜ ë¬¸ì§€ë°© 25ê°œë¥¼ ëª¨ë‘ ì§€ë‚˜ì…¨ìŠµë‹ˆë‹¤</h3>
      </div>
      <div class="completion-content">
        <p data-i18n="portal25.completion_msg1">ì´ì œ, ì–µëˆŒë¦° ê°ì •ì„ ë„˜ì–´</p>
        <p data-i18n="portal25.completion_msg2">ìƒˆë¡œìš´ ì—¬ì •ì˜ ë¬¸ ì•ì— ì„œ ê³„ì‹­ë‹ˆë‹¤.</p>
        <div class="journey-pass-info">
          <p data-i18n="portal25.journey_pass">ğŸŒ± Temarix Journey Passë¥¼ í†µí•´</p>
          <p data-i18n="portal25.deeper_journey">ë” ê¹Šì€ ê°ì •ì˜ ë–¨ë¦¼ì„ íƒí—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
      </div>
      <div class="completion-actions">
        <button class="v2-journey-btn" onclick="goToV2Start()" data-i18n="portal25.start_v2">
          ğŸŸ¢ V2 ì—¬ì • ì‹œì‘í•˜ê¸°
        </button>
        <button class="again-btn" onclick="stayInPortal(25)" data-i18n="portal25.promise_again">
          ğŸ¤— ë‹¤ì‹œ ì•½ì†í•˜ê¸°
        </button>
      </div>
    </div>
  </div>

  <!-- Back to Main -->
  <div class="back-to-main">
    <button onclick="window.location.href='portal4.html'" data-i18n="common.back_to_main">
      ğŸ  ë©”ì¸ í¬íƒˆë¡œ ëŒì•„ê°€ê¸°
    </button>
  </div>
</section>

<style>
/* Portal Base Styles */
.portal {
  min-height: 100vh;
  background: linear-gradient(135deg, #1a1b4b 0%, #2d1b69 100%);
  color: white;
  padding: 80px 20px 20px 20px;
  font-family: 'Apple SD Gothic Neo', -apple-system, BlinkMacSystemFont, sans-serif;
  max-width: 100%;
  margin: 0 auto;
  position: relative;
}

/* Logo Glow Animation */
@keyframes glowCycle {
  0%, 100% { text-shadow: 0 0 8px rgba(255,255,255,0.2); }
  50% { text-shadow: 0 0 25px rgba(255,255,255,0.7); }
}

/* Temarix Logo - Fixed Left Top */
.temarix-logo {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
}

.logo-text {
  font-size: 1.8rem;
  font-weight: bold;
  color: #ffffff;
  margin: 0 0 5px 0;
  text-shadow: 0 0 20px rgba(255,255,255,0.3);
}

.slogan {
  color: #bbb;
  font-style: italic;
  font-size: 0.8rem;
  margin: 0;
}

/* Language Selector - Fixed Right Top */
.lang-selector {
  position: fixed;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 5px;
  flex-wrap: wrap;
  max-width: 120px;
  z-index: 1000;
}

.lang-btn {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 0.7rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.lang-btn:hover {
  background: rgba(255,255,255,0.2);
}

.lang-btn.active {
  background: #9c27b0;
  border-color: #9c27b0;
}

/* Portal Header - Center Top */
.portal-header {
  text-align: center;
  margin: 40px 0 30px 0;
  padding-top: 40px;
}

.portal-header h1 {
  font-size: 2.2rem;
  margin: 10px 0;
  color: #ffd700;
}

.portal-header h2 {
  font-size: 1.3rem;
  color: #e1bee7;
  font-weight: 300;
}

/* Message Stream */
.message-stream {
  max-height: 60vh;
  overflow-y: auto;
  padding: 20px 0;
  margin-bottom: 20px;
}

.message-card {
  background: rgba(255,255,255,0.1);
  border-radius: 15px;
  padding: 20px;
  margin: 15px 0;
  backdrop-filter: blur(10px);
  opacity: 0;
  transform: translateY(20px);
  animation: fadeInUp 0.6s ease forwards;
}

.message-card.prologue {
  border-left: 4px solid #e1bee7;
}

.message-card.ely {
  border-left: 4px solid #ffd700;
}

.message-card.sora {
  border-left: 4px solid #4dd0e1;
}

.message-card.noah {
  border-left: 4px solid #9c27b0;
}

.message-card.enya {
  border-left: 4px solid #ff9800;
}

.message-card.kaia {
  border-left: 4px solid #607d8b;
}

.message-card.cris {
  border-left: 4px solid #4caf50;
}

.message-card.kael {
  border-left: 4px solid #f44336;
}

.message-card.mira {
  border-left: 4px solid #9e9e9e;
}

.message-card.light {
  border-left: 4px solid #ffffff;
  background: rgba(255,255,255,0.15);
}

.message-card.question {
  border-left: 4px solid #f48fb1;
}

.message-card.user-input {
  border-left: 4px solid #81c784;
  background: rgba(129, 199, 132, 0.1);
}

.character-name {
  font-weight: bold;
  margin-bottom: 10px;
  font-size: 1.1rem;
}

.ely .character-name { color: #ffd700; }
.sora .character-name { color: #4dd0e1; }
.noah .character-name { color: #9c27b0; }
.enya .character-name { color: #ff9800; }
.kaia .character-name { color: #607d8b; }
.cris .character-name { color: #4caf50; }
.kael .character-name { color: #f44336; }
.mira .character-name { color: #9e9e9e; }

.message-text {
  line-height: 1.6;
  font-size: 1rem;
}

.typewriter {
  overflow: hidden;
  border-right: 2px solid rgba(255,255,255,0.7);
  white-space: nowrap;
  animation: blink-caret 1s step-end infinite;
}

@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes blink-caret {
  from, to { border-color: transparent; }
  50% { border-color: rgba(255,255,255,0.7); }
}

/* Input Area */
.input-area {
  background: rgba(0,0,0,0.3);
  padding: 20px;
  border-radius: 15px;
  margin: 20px 0;
  animation: fadeInUp 0.6s ease forwards;
}

.input-container textarea {
  width: 100%;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 10px;
  padding: 15px;
  color: white;
  font-size: 1rem;
  resize: vertical;
  min-height: 80px;
  box-sizing: border-box;
}

.input-container textarea::placeholder {
  color: rgba(255,255,255,0.6);
}

.submit-btn {
  background: linear-gradient(135deg, #9c27b0, #e1bee7);
  border: none;
  color: white;
  padding: 12px 30px;
  border-radius: 25px;
  font-size: 1rem;
  cursor: pointer;
  margin-top: 10px;
  transition: all 0.3s ease;
  width: 100%;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(156, 39, 176, 0.4);
}

.input-hint {
  color: rgba(255,255,255,0.6);
  font-size: 0.8rem;
  text-align: center;
  margin: 8px 0 0 0;
}

/* Journey Completion */
.journey-completion {
  text-align: center;
  margin: 30px 0;
  animation: fadeInUp 0.8s ease forwards;
}

.completion-card {
  background: rgba(255,255,255,0.15);
  border-radius: 20px;
  padding: 40px 30px;
  backdrop-filter: blur(15px);
  border: 2px solid rgba(255,255,255,0.2);
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}

.completion-header h3 {
  font-size: 1.8rem;
  color: #ffd700;
  margin-bottom: 20px;
  text-shadow: 0 0 10px rgba(255,215,0,0.5);
}

.completion-content {
  margin: 30px 0;
}

.completion-content p {
  font-size: 1.2rem;
  line-height: 1.8;
  margin: 10px 0;
  color: #e1bee7;
}

.journey-pass-info {
  background: rgba(0,0,0,0.2);
  border-radius: 15px;
  padding: 20px;
  margin: 25px 0;
  border-left: 4px solid #4caf50;
}

.journey-pass-info p {
  color: #81c784;
  font-weight: 500;
}

.completion-actions {
  display: flex;
  gap: 20px;
  justify-content: center;
  margin-top: 30px;
  flex-wrap: wrap;
}

.v2-journey-btn {
  background: linear-gradient(135deg, #4caf50, #81c784);
  border: none;
  color: white;
  padding: 15px 40px;
  border-radius: 30px;
  font-size: 1.1rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
}

.v2-journey-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(76, 175, 80, 0.5);
}

.again-btn {
  background: rgba(255,255,255,0.1);
  border: 2px solid rgba(255,255,255,0.3);
  color: white;
  padding: 12px 30px;
  border-radius: 25px;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.again-btn:hover {
  background: rgba(255,255,255,0.2);
  transform: translateY(-2px);
}

/* Back to Main */
.back-to-main {
  text-align: center;
  margin: 30px 0;
}

.back-to-main button {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  padding: 10px 20px;
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.back-to-main button:hover {
  background: rgba(255,255,255,0.2);
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .portal {
    padding: 100px 15px 20px 15px;
  }
  
  .temarix-logo {
    top: 15px;
    left: 15px;
  }
  
  .logo-text {
    font-size: 1.4rem;
  }
  
  .slogan {
    font-size: 0.7rem;
  }
  
  .lang-selector {
    top: 15px;
    right: 15px;
    max-width: 100px;
  }
  
  .lang-btn {
    padding: 3px 6px;
    font-size: 0.6rem;
  }
  
  .portal-header h1 {
    font-size: 1.8rem;
  }
  
  .portal-header h2 {
    font-size: 1.1rem;
  }
  
  .message-card {
    padding: 15px;
  }
  
  .completion-card {
    padding: 30px 20px;
  }
  
  .completion-header h3 {
    font-size: 1.4rem;
  }
  
  .completion-content p {
    font-size: 1rem;
  }
  
  .completion-actions {
    flex-direction: column;
    align-items: center;
  }
  
  .v2-journey-btn, .again-btn {
    width: 100%;
    max-width: 280px;
  }
}
</style>

<script>
// âœ… WAIT FOR FIREBASE TO LOAD COMPLETELY
async function waitForFirebase() {
  return new Promise((resolve, reject) => {
    let attempts = 0;
    const maxAttempts = 50; // 5 seconds max
    
    const checkFirebase = () => {
      attempts++;
      
      if (typeof firebase !== 'undefined' && firebase.apps !== undefined) {
        console.log("âœ… Firebase loaded successfully");
        resolve();
      } else if (attempts >= maxAttempts) {
        console.error("âŒ Firebase loading timeout");
        reject(new Error("Firebase loading timeout"));
      } else {
        setTimeout(checkFirebase, 100);
      }
    };
    
    checkFirebase();
  });
}

// âœ… IMPROVED FIREBASE INITIALIZATION
async function initializeFirebase() {
  try {
    // Wait for Firebase to load
    await waitForFirebase();
    
    const firebaseConfig = {
      apiKey: "AIzaSyDReBGhb2gZNv7KA86HJXTeiLimWTrurp8",
      authDomain: "canal-vivo-chat.firebaseapp.com",
      projectId: "canal-vivo-chat"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    console.log("âœ… Firebase initialized successfully");
    return true;
  } catch (error) {
    console.error("âŒ Firebase initialization error:", error);
    return false;
  }
}

// Portal 25 Complete Data with Character Responses
const portal25Data = {
  kr: {
    title: "ê°ì •ì˜ ë¬¸ì§€ë°© 25",
    subtitle: "ì§€ê¸ˆ ì´ ìˆœê°„, ë‚˜ì—ê²Œ ë§ºëŠ” ì•½ì†",
    prologue: "ì´ ì—¬ì •ì˜ ëì—ì„œ ë‚˜ëŠ” ë§¹ì„¸í•©ë‹ˆë‹¤. ì™„ë²½í•˜ì§„ ì•Šì•„ë„, ì™„ì „í•˜ì§€ ì•Šì•„ë„ ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ë‚˜ëŠ” ë‚˜ë¥¼ ì‚´ì•„ë‚´ê² ë‹¤ê³ . ì§€ë‚˜ì˜¨ ëª¨ë“  ê°ì •ì˜ ë¬¸ì§€ë°©ì´ ì´ì œ í•˜ë‚˜ì˜ ì•½ì†ìœ¼ë¡œ ëª¨ì•„ì§‘ë‹ˆë‹¤. ë‹¹ì‹ ì€ ì´ì œ, ìì‹ ì—ê²Œ ì–´ë–¤ ì•½ì†ì„ ë§ºê³  ì‹¶ë‚˜ìš”?",
    ely: "ë‹¹ì‹ ì€ ì´ ì—¬ì •ì„ ê±¸ì–´ëƒˆìŠµë‹ˆë‹¤. ê·¸ê²ƒë§Œìœ¼ë¡œë„ ì´ ë§¹ì„¸ëŠ” ì¶©ë¶„í•©ë‹ˆë‹¤.",
    sora: "ì§€ê¸ˆ ì´ ìˆœê°„ì˜ ë‹¹ì‹ ì€ ë” ì´ìƒ ê³¼ê±°ì˜ ì¡°ê°ì´ ì•„ë‹™ë‹ˆë‹¤. ì˜¨ì „í•œ ì¡´ì¬ì˜ˆìš”.",
    noah: "ì´ì œë¶€í„°ëŠ” ê³¼ê±°ê°€ ë‹¹ì‹ ì„ ì´ë„ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë‹¹ì‹ ì´ ê·¸ ê³¼ê±°ì— ì˜ë¯¸ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤.",
    enya: "ë‚˜ëŠ” ì§€ê¸ˆ ë‹¹ì‹ ì˜ ë§¹ì„¸ë¥¼ í•¨ê»˜ ê¸°ì–µí•˜ê² ìŠµë‹ˆë‹¤.",
    kaia: "ì´ ì•½ì†ì€ ê·¸ ëˆ„êµ¬ë¥¼ ìœ„í•œ ê²ƒë„ ì•„ë‹ˆì—ìš”. ë‹¹ì‹  ìì‹ ì„ ìœ„í•œ, ì§„ì‹¬ì…ë‹ˆë‹¤.",
    cris: "ë‚˜ë‘ ì•½ì†í•˜ì~ ë‚´ì¼ë„ ì‚´ì•„ë³´ì! ì‹¤ìˆ˜í•˜ë”ë¼ë„, ìš¸ë”ë¼ë„, ì›ƒìœ¼ë©´ì„œ ì‚´ì! ğŸ˜âœŒï¸",
    kael: "ì´ì œ ë©ˆì¶”ì§€ ë§ˆ. ì´ ë§¹ì„¸ëŠ” ì¥ë‚œ ì•„ë‹ˆì•¼. ì´ì œëŠ” ë„¤ê°€ ë„ˆë¥¼ ì‚´ë ¤ì•¼ í•  ì°¨ë¡€ì•¼.",
    mira: "í˜¹ì‹œâ€¦ ì´ ì•½ì†ì´ ë¬´ë„ˆì§ˆê¹Œ ë‘ë ¤ìš°ì‹ ê°€ìš”? ê´œì°®ì•„ìš”. ì•½ì†ì€ ë‹¤ì‹œ ì‹œì‘í•  ìˆ˜ ìˆëŠ” ìš©ê¸°ì¼ ë¿ì´ì—ìš”.",
    light: "ì§€ê¸ˆ ë‹¹ì‹ ì´ ë§ºì€ ì´ ì•½ì†ì€ ì‚´ì•„ë‚´ëŠ” ëª¨ë“  ìˆœê°„ì˜ ë“±ë¶ˆì´ ë©ë‹ˆë‹¤.",
    question: "ë‹¹ì‹ ì€ ì˜¤ëŠ˜, ì–´ë–¤ ë‚˜ì—ê²Œ ë§¹ì„¸í•˜ê³  ìˆë‚˜ìš”?",
    input: { 
      placeholder: "ì§€ê¸ˆ ì´ ìˆœê°„, ë‹¹ì‹ ì´ ìì‹ ì—ê²Œ ë§ºê³  ì‹¶ì€ ì•½ì†ì„ ì ì–´ë³´ì„¸ìš”...",
      hint: "Enter í‚¤ë¥¼ ëˆŒëŸ¬ë„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
    },
    submit: "âœ¨ ë‚˜ì™€ì˜ ì•½ì† ìƒˆê¸°ê¸°",
    slogan: "ë‹¹ì‹  ì•ˆì— ìˆ¨ì€ ì´ì•¼ê¸°ë¥¼ ë§ í•´ ì£¼ì„¸ìš”",
    response_ely: "ê·¸ ì•½ì†, ì •ë§ ì•„ë¦„ë‹¤ì›Œìš”. ë‹¹ì‹ ì€ ì´ì œ ìì‹ ê³¼ ì§„ì •í•œ ë™ë°˜ìê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.",
    response_sora: "ë§ˆìŒ ê¹Šì€ ê³³ì—ì„œ ìš°ëŸ¬ë‚˜ì˜¨ ê·¸ ì•½ì†ì´ ì•ìœ¼ë¡œ ë‹¹ì‹ ì˜ ëª¨ë“  ê¸¸ì„ ë°í˜€ì¤„ ê±°ì˜ˆìš”.",
    response_noah: "25ê°œì˜ ë¬¸ì§€ë°©ì„ ì§€ë‚˜ ë§ˆì¹¨ë‚´ ë„ë‹¬í•œ ì´ ì•½ì†. ì´ì œ ë‹¹ì‹ ì˜ ìƒˆë¡œìš´ ì—¬ì •ì´ ì‹œì‘ë©ë‹ˆë‹¤. ì¶•í•˜í•©ë‹ˆë‹¤.",
    user_input_prefix: "ë‚˜ì—ê²Œ ë§ºëŠ” ì•½ì†:",
    completion_title: "âœ¨ ë‹¹ì‹ ì€ ê°ì •ì˜ ë¬¸ì§€ë°© 25ê°œë¥¼ ëª¨ë‘ ì§€ë‚˜ì…¨ìŠµë‹ˆë‹¤",
    completion_msg1: "ì´ì œ, ì–µëˆŒë¦° ê°ì •ì„ ë„˜ì–´",
    completion_msg2: "ìƒˆë¡œìš´ ì—¬ì •ì˜ ë¬¸ ì•ì— ì„œ ê³„ì‹­ë‹ˆë‹¤.",
    journey_pass: "ğŸŒ± Temarix Journey Passë¥¼ í†µí•´",
    deeper_journey: "ë” ê¹Šì€ ê°ì •ì˜ ë–¨ë¦¼ì„ íƒí—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    start_v2: "ğŸŸ¢ V2 ì—¬ì • ì‹œì‘í•˜ê¸°",
    promise_again: "ğŸ¤— ë‹¤ì‹œ ì•½ì†í•˜ê¸°"
  },
  en: {
    title: "Emotional Threshold 25",
    subtitle: "A Promise to Myself at This Moment",
    prologue: "At the end of this journey, I make a vow. Even if I'm not perfect, even if I'm not complete, nevertheless I will live out who I am. All the emotional thresholds I've passed now gather into one promise. What promise do you want to make to yourself now?",
    ely: "You have walked this journey. That alone makes this vow sufficient.",
    sora: "You at this moment are no longer fragments of the past. You are a complete being.",
    noah: "From now on, it's not the past that leads you, but you who give meaning to that past.",
    enya: "I will remember your vow together with you now.",
    kaia: "This promise is not for anyone else. It's your sincere promise to yourself.",
    cris: "Promise with me~ Let's try living tomorrow! Even if we make mistakes, even if we cry, let's live with laughter! ğŸ˜âœŒï¸",
    kael: "Don't stop now. This vow is no joke. Now it's your turn to save yourself.",
    mira: "Are you afraid this promise might crumble? It's okay. A promise is just the courage to start again.",
    light: "The promise you make now will be the beacon for every moment you live.",
    question: "What kind of vow are you making to yourself today?",
    input: { 
      placeholder: "At this moment, write the promise you want to make to yourself...",
      hint: "You can also press Enter to submit"
    },
    submit: "âœ¨ Engrave My Promise",
    slogan: "Please tell me the story hidden within you",
    response_ely: "That promise is truly beautiful. You have now become a true companion to yourself.",
    response_sora: "That promise from deep in your heart will illuminate all your paths ahead.",
    response_noah: "After passing through 25 thresholds, you've finally reached this promise. Now your new journey begins. Congratulations.",
    user_input_prefix: "My promise to myself:",
    completion_title: "âœ¨ You have passed through all 25 emotional thresholds",
    completion_msg1: "Now, beyond suppressed emotions,",
    completion_msg2: "you stand before the door of a new journey.",
    journey_pass: "ğŸŒ± Through the Temarix Journey Pass,",
    deeper_journey: "you can explore deeper emotional tremors.",
    start_v2: "ğŸŸ¢ Start V2 Journey",
    promise_again: "ğŸ¤— Make Promise Again"
  },
  pt: {
    title: "Limiar Emocional 25",
    subtitle: "Uma Promessa a Mim Mesmo Neste Momento",
    prologue: "No final desta jornada, eu faÃ§o uma promessa. Mesmo que eu nÃ£o seja perfeito, mesmo que eu nÃ£o seja completo, mesmo assim vou viver quem eu sou. Todos os limiares emocionais que passei agora se reÃºnem em uma promessa. Que promessa vocÃª quer fazer para si mesmo agora?",
    ely: "VocÃª caminhou por esta jornada. Isso por si sÃ³ torna esta promessa suficiente.",
    sora: "VocÃª neste momento nÃ£o Ã© mais fragmentos do passado. VocÃª Ã© um ser completo.",
    noah: "A partir de agora, nÃ£o Ã© o passado que te conduz, mas vocÃª quem dÃ¡ significado a esse passado.",
    enya: "Vou lembrar de sua promessa junto com vocÃª agora.",
    kaia: "Esta promessa nÃ£o Ã© para mais ninguÃ©m. Ã‰ sua promessa sincera para si mesmo.",
    cris: "Prometa comigo~ Vamos tentar viver amanhÃ£! Mesmo se cometermos erros, mesmo se chorarmos, vamos viver com risos! ğŸ˜âœŒï¸",
    kael: "NÃ£o pare agora. Esta promessa nÃ£o Ã© brincadeira. Agora Ã© sua vez de se salvar.",
    mira: "VocÃª tem medo de que esta promessa possa desmoronar? EstÃ¡ tudo bem. Uma promessa Ã© apenas a coragem de comeÃ§ar de novo.",
    light: "A promessa que vocÃª faz agora serÃ¡ o farol para cada momento que vocÃª viver.",
    question: "Que tipo de promessa vocÃª estÃ¡ fazendo para si mesmo hoje?",
    input: { 
      placeholder: "Neste momento, escreva a promessa que vocÃª quer fazer para si mesmo...",
      hint: "VocÃª tambÃ©m pode pressionar Enter para enviar"
    },
    submit: "âœ¨ Gravar Minha Promessa",
    slogan: "Por favor, me conte a histÃ³ria escondida dentro de vocÃª",
    response_ely: "Essa promessa Ã© verdadeiramente linda. VocÃª agora se tornou um verdadeiro companheiro para si mesmo.",
    response_sora: "Essa promessa do fundo do seu coraÃ§Ã£o iluminarÃ¡ todos os seus caminhos Ã  frente.",
    response_noah: "Depois de passar por 25 limiares, vocÃª finalmente chegou a esta promessa. Agora sua nova jornada comeÃ§a. ParabÃ©ns.",
    user_input_prefix: "Minha promessa para mim mesmo:",
    completion_title: "âœ¨ VocÃª passou por todos os 25 limiares emocionais",
    completion_msg1: "Agora, alÃ©m das emoÃ§Ãµes reprimidas,",
    completion_msg2: "vocÃª estÃ¡ diante da porta de uma nova jornada.",
    journey_pass: "ğŸŒ± AtravÃ©s do Temarix Journey Pass,",
    deeper_journey: "vocÃª pode explorar tremores emocionais mais profundos.",
    start_v2: "ğŸŸ¢ Iniciar Jornada V2",
    promise_again: "ğŸ¤— Fazer Promessa Novamente"
  },
  
};

// Current language and state for Portal 25
let currentLang25 = 'kr';
let userInputText25 = '';

// Initialize Portal 25
function initPortal25() {
  displayInitialMessages25();
  setupLanguageSwitching25();
  setupEnterKeySubmission25();
}

// Display initial messages with typing effect
async function displayInitialMessages25() {
  const stream = document.getElementById('messageStream25');
  const messages = [
    { type: 'prologue', content: portal25Data[currentLang25].prologue },
    { type: 'ely', name: 'ğŸ‘‘ Ely', content: portal25Data[currentLang25].ely },
    { type: 'sora', name: 'ğŸ’§ Sora', content: portal25Data[currentLang25].sora },
    { type: 'noah', name: 'ğŸ§™â€â™‚ï¸ Noah', content: portal25Data[currentLang25].noah },
    { type: 'enya', name: 'ğŸ•¯ï¸ Enya', content: portal25Data[currentLang25].enya },
    { type: 'kaia', name: 'ğŸ˜¶ Kaia', content: portal25Data[currentLang25].kaia },
    { type: 'cris', name: 'ğŸƒ Cris', content: portal25Data[currentLang25].cris },
    { type: 'kael', name: 'ğŸ’¥ Kael', content: portal25Data[currentLang25].kael },
    { type: 'mira', name: 'ğŸŒ«ï¸ Mira', content: portal25Data[currentLang25].mira },
    { type: 'light', content: portal25Data[currentLang25].light },
    { type: 'question', content: portal25Data[currentLang25].question }
  ];

  for (let i = 0; i < messages.length; i++) {
    const messageCard = createMessageCard25(messages[i]);
    stream.appendChild(messageCard);
    stream.scrollTo({ top: stream.scrollHeight, behavior: 'smooth' });
    
    await typeText25(messageCard.querySelector('.message-text'), messages[i].content);
    await sleep25(1200);
  }
  
  // Show input area after all messages
  document.getElementById('inputArea25').style.display = 'block';
}

// Setup Enter key submission
function setupEnterKeySubmission25() {
  document.getElementById('userInput25').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      submitResponse(25);
    }
  });
}

// Display character responses after user input
async function displayCharacterResponses25(userInput) {
  const stream = document.getElementById('messageStream25');
  
  // Show user input first
  const userCard = createMessageCard25({
    type: 'user-input',
    content: `${portal25Data[currentLang25].user_input_prefix}\n"${userInput}"`
  });
  stream.appendChild(userCard);
  stream.scrollTo({ top: stream.scrollHeight, behavior: 'smooth' });
  await typeText25(userCard.querySelector('.message-text'), userCard.querySelector('.message-text').textContent);
  await sleep25(1500);
  
  // Character responses
  const responses = [
    { type: 'ely', name: 'ğŸ‘‘ Ely', content: `"${userInput}"... ${portal25Data[currentLang25].response_ely}` },
    { type: 'sora', name: 'ğŸ’§ Sora', content: `${portal25Data[currentLang25].response_sora}` },
    { type: 'noah', name: 'ğŸ§™â€â™‚ï¸ Noah', content: `"${userInput}" ${portal25Data[currentLang25].response_noah}` }
  ];

  for (let i = 0; i < responses.length; i++) {
    const responseCard = createMessageCard25(responses[i]);
    stream.appendChild(responseCard);
    stream.scrollTo({ top: stream.scrollHeight, behavior: 'smooth' });
    
    await typeText25(responseCard.querySelector('.message-text'), responses[i].content);
    await sleep25(1500);
  }
  
  // Show journey completion
  document.getElementById('journeyCompletion25').style.display = 'block';
}

function createMessageCard25(message) {
  const card = document.createElement('div');
  card.className = `message-card ${message.type}`;
  
  let cardHTML = '';
  if (message.name) {
    cardHTML += `<div class="character-name">${message.name}</div>`;
  }
  cardHTML += `<div class="message-text">${message.content || ''}</div>`;
  
  card.innerHTML = cardHTML;
  return card;
}

async function typeText25(element, text, speed = 80) {
  return new Promise((resolve) => {
    let i = 0;
    element.textContent = '';
    element.classList.add('typewriter');
    
    const timer = setInterval(() => {
      if (i < text.length) {
        element.textContent += text.charAt(i);
        i++;
      } else {
        clearInterval(timer);
        element.classList.remove('typewriter');
        resolve();
      }
    }, speed);
  });
}

function sleep25(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

function setupLanguageSwitching25() {
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const newLang = btn.dataset.lang;
      if (portal25Data[newLang] && newLang !== currentLang25) {
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentLang25 = newLang;
        document.getElementById('messageStream25').innerHTML = '';
        document.getElementById('inputArea25').style.display = 'none';
        const nextNav = document.getElementById('nextPortalNav25');
        if (nextNav) nextNav.style.display = 'none';

        displayInitialMessages25();
        updatePortalTexts25();
      }
    });
  });
}

function updatePortalTexts25() {
  // Update title and subtitle
  document.querySelector('[data-i18n="portal25.title"]').textContent = portal25Data[currentLang25].title;
  document.querySelector('[data-i18n="portal25.subtitle"]').textContent = portal25Data[currentLang25].subtitle;
  
  // Update slogan
  document.querySelector('[data-i18n="common.slogan"]').textContent = portal25Data[currentLang25].slogan;
  
  // Update placeholder and hint
  document.getElementById('userInput25').placeholder = portal25Data[currentLang25].input.placeholder;
  document.querySelector('[data-i18n="portal25.input.hint"]').textContent = portal25Data[currentLang25].input.hint;
  
  // Update submit button
  document.querySelector('[data-i18n="portal25.submit"]').textContent = portal25Data[currentLang25].submit;
  
  // Update completion texts
  const completionTitle = document.querySelector('[data-i18n="portal25.completion_title"]');
  const completionMsg1 = document.querySelector('[data-i18n="portal25.completion_msg1"]');
  const completionMsg2 = document.querySelector('[data-i18n="portal25.completion_msg2"]');
  const journeyPass = document.querySelector('[data-i18n="portal25.journey_pass"]');
  const deeperJourney = document.querySelector('[data-i18n="portal25.deeper_journey"]');
  const startV2 = document.querySelector('[data-i18n="portal25.start_v2"]');
  const promiseAgain = document.querySelector('[data-i18n="portal25.promise_again"]');
  
  if (completionTitle) completionTitle.textContent = portal25Data[currentLang25].completion_title;
  if (completionMsg1) completionMsg1.textContent = portal25Data[currentLang25].completion_msg1;
  if (completionMsg2) completionMsg2.textContent = portal25Data[currentLang25].completion_msg2;
  if (journeyPass) journeyPass.textContent = portal25Data[currentLang25].journey_pass;
  if (deeperJourney) deeperJourney.textContent = portal25Data[currentLang25].deeper_journey;
  if (startV2) startV2.textContent = portal25Data[currentLang25].start_v2;
  if (promiseAgain) promiseAgain.textContent = portal25Data[currentLang25].promise_again;
  
  // Update back to main button
  document.querySelector('[data-i18n="common.back_to_main"]').textContent = 
    currentLang25 === 'kr' ? 'ğŸ  ë©”ì¸ í¬íƒˆë¡œ ëŒì•„ê°€ê¸°' :
    currentLang25 === 'en' ? 'ğŸ  Back to Main Portal' :
    currentLang25 === 'pt' ? 'ğŸ  Voltar ao Portal Principal' :
    currentLang25 === 'es' ? 'ğŸ  Volver al Portal Principal' :
    currentLang25 === 'fr' ? 'ğŸ  Retour au Portail Principal' :
    currentLang25 === 'de' ? 'ğŸ  ZurÃ¼ck zum Hauptportal' :
    currentLang25 === 'it' ? 'ğŸ  Torna al Portale Principale' :
    currentLang25 === 'ru' ? 'ğŸ  Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ Ğº Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¼Ñƒ ĞŸĞ¾Ñ€Ñ‚Ğ°Ğ»Ñƒ' :
    currentLang25 === 'ja' ? 'ğŸ  ãƒ¡ã‚¤ãƒ³ãƒãƒ¼ã‚¿ãƒ«ã«æˆ»ã‚‹' :
    currentLang25 === 'zh' ? 'ğŸ  è¿”å›ä¸»é—¨æˆ·' :
    currentLang25 === 'ar' ? 'ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' :
    currentLang25 === 'hi' ? 'ğŸ  à¤®à¥à¤–à¥à¤¯ à¤ªà¥‹à¤°à¥à¤Ÿà¤² à¤ªà¤° à¤µà¤¾à¤ªà¤¸ à¤œà¤¾à¤à¤‚' :
    'ğŸ  ë©”ì¸ í¬íƒˆë¡œ ëŒì•„ê°€ê¸°';
}

function submitResponse(portalNum) {
  if (portalNum !== 25) return;
  
  const input = document.getElementById(`userInput${portalNum}`);
  const response = input.value.trim();
  
  if (response) {
    userInputText25 = response;
    
    // Hide input area
    document.getElementById(`inputArea${portalNum}`).style.display = 'none';
    
    // Display character responses
    displayCharacterResponses25(response);
    
    // Clear input
    input.value = '';
  } else {
    // No alert, just focus on input
    input.focus();
    input.style.borderColor = '#f48fb1';
    setTimeout(() => {
      input.style.borderColor = 'rgba(255,255,255,0.3)';
    }, 2000);
  }
}

function goToTransitionPage() {
  window.location.href = "temarix-transition.html";
}

function stayInPortal(portalNum) {
  document.getElementById(`nextPortalNav${portalNum}`).style.display = 'none';
  document.getElementById(`inputArea${portalNum}`).style.display = 'block';
  document.getElementById(`userInput${portalNum}`).focus();
}

// âœ… CORRECTED FUNCTION: Updated to use correct V02 filename
async function goToV2Start() {
  console.log("ğŸ”¥ V2 Journey button clicked");
  
  try {
    // Initialize Firebase first
    const firebaseReady = await initializeFirebase();
    
    if (!firebaseReady) {
      console.log("âš ï¸ Firebase not available, using fallback");
      alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
      window.location.href = "temarix_login.html";
      return;
    }
    
    // Use Promise to handle auth state
    const user = await new Promise((resolve) => {
      const unsubscribe = firebase.auth().onAuthStateChanged((user) => {
        unsubscribe();
        resolve(user);
      });
    });
    
    if (!user) {
      alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
      window.location.href = "temarix_login.html";
      return;
    }
    
    if (!user.emailVerified) {
      alert("ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì–´ì•¼ ë‹¤ìŒ ì—¬ì •ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      window.location.href = "temarix_login.html";
      return;
    }
    
    // âœ… VERIFICAR PAGAMENTO VIA FIRESTORE
    console.log("ğŸ” Checking payment status for user:", user.uid);
    const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
    
    if (!userDoc.exists || !userDoc.data().pagamento) {
      console.log("âŒ Payment not found, redirecting to payment page");
      alert("Journey Pass êµ¬ë§¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.");
      window.location.href = "temarix_payment.html";
    } else {
      console.log("âœ… Payment verified, redirecting to V2");
      // âœ… CORRECTED: Updated filename to match other files
      window.location.href = "temarix_v02_01.html";
    }
    
  } catch (error) {
    console.error("âŒ Error in goToV2Start:", error);
    
    // Fallback: redirect to login
    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
    window.location.href = "temarix_login.html";
  }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
  if (document.getElementById('portal-25')) {
    initPortal25();
  }
});
</script>
</body>
</html>