<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TPS – Travel Personal Secretary</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3d 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ===== SCROLLBAR REFINADO E FINO ===== */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 15, 35, 0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(79, 70, 229, 0.4);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(79, 70, 229, 0.6);
        }

        /* ===== SCROLLBAR SIDEBAR AINDA MAIS FINO ===== */
        .sidebar::-webkit-scrollbar {
            width: 4px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(26, 26, 46, 0.2);
            border-radius: 2px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(79, 70, 229, 0.3);
            border-radius: 2px;
        }

        /* ===== LAYOUT PRINCIPAL ===== */
        .app-container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }

        /* ===== STATUS DE CONEXÃO ===== */
        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(47, 46, 92, 0.9);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 11px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 136, 0.3);
            z-index: 1001;
            color: #00ff88;
            transition: all 0.3s ease;
        }

        .connection-status.connecting {
            color: #ffd700;
            border-color: rgba(255, 215, 0, 0.3);
        }

        /* ===== SELETOR DE IDIOMA ===== */
        .language-selector {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(47, 46, 92, 0.9);
            border-radius: 12px;
            padding: 10px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        .language-selector select {
            background: transparent;
            border: none;
            color: white;
            padding: 8px 12px;
            font-size: 13px;
            cursor: pointer;
            outline: none;
            border-radius: 6px;
        }

        .language-selector select option {
            background: #2f2e5c;
            color: white;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 320px;
            background: linear-gradient(180deg, rgba(10, 10, 20, 0.98) 0%, rgba(15, 15, 25, 0.98) 100%);
            padding: 60px 20px 40px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(58, 58, 109, 0.5);
            box-shadow: 2px 0 20px rgba(0,0,0,0.6);
            overflow-y: auto;
            height: 100vh;
            position: sticky;
            top: 0;
            backdrop-filter: blur(15px);
        }

        .sidebar h2 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #888;
            text-align: center;
            border-bottom: 2px solid rgba(58, 58, 109, 0.5);
            padding-bottom: 20px;
        }

        .sidebar-message {
            font-size: 14px;
            color: #ffd700;
            text-align: center;
            line-height: 1.6;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .destinations-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px;
            margin-bottom: 25px;
        }

        .destination-item {
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 15px;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(20, 20, 30, 0.8), rgba(15, 15, 25, 0.8));
            box-shadow: 0 6px 20px rgba(0,0,0,0.7);
            position: relative;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .destination-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(63, 163, 255, 0.4);
        }

        .destination-item.clicked {
            transform: scale(0.95);
            transition: all 0.1s ease;
        }

        .destination-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            transition: transform 0.4s ease;
            filter: brightness(0.6);
        }

        .destination-item:hover img {
            transform: scale(1.08);
            filter: brightness(0.85);
        }

        .destination-item span {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 12px 8px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
        }

        .sidebar-footer {
            margin-top: auto;
            font-size: 11px;
            color: rgba(170, 170, 170, 0.7);
            text-align: center;
            padding: 20px 0 10px;
            border-top: 1px solid rgba(58, 58, 109, 0.3);
        }

        /* ===== ÁREA PRINCIPAL ===== */
        .main {
            flex: 1;
            background: #000;
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 60px 20px 20px;
            overflow: hidden;
            min-height: 100vh;
        }

        /* ===== LOGO CENTRALIZADO ===== */
        .logo-container {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1002;
        }

        .logo {
            font-size: 36px;
            font-weight: bold;
            color: #3fa3ff;
            text-shadow: 0 0 25px rgba(63, 163, 255, 0.6);
            animation: logoGlow 3s ease-in-out infinite alternate;
            text-align: center;
        }

        @keyframes logoGlow {
            from { text-shadow: 0 0 25px rgba(63, 163, 255, 0.6); }
            to { text-shadow: 0 0 35px rgba(63, 163, 255, 0.8), 0 0 50px rgba(63, 163, 255, 0.4); }
        }

        /* ===== BOTÕES SUPERIORES ===== */
        .header-tabs {
            position: absolute;
            top: 100px;
            right: 20px;
            left: 20px;
            display: flex;
            gap: 8px;
            z-index: 10;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 30px;
        }

        .tab-button {
            background: linear-gradient(135deg, #4f46e5, #6366f1);
            border: none;
            color: white;
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
            min-width: 90px;
            flex: 1;
            max-width: 120px;
        }

        .tab-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.5);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #3b36c8, #4f46e5);
            box-shadow: 0 6px 20px rgba(59, 54, 200, 0.6);
            transform: translateY(-2px);
        }

        .tab-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* ===== ÁREA DO CHAT - CORREÇÃO RADICAL ===== */
        .chat-container {
            flex: 1;
            background: transparent;
            padding: 0 20px;
            overflow-y: auto;
            overflow-x: hidden;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
            scroll-behavior: smooth;
            /* CORREÇÃO RADICAL: Posicionamento absoluto que NUNCA ultrapassa o input */
            /* Top: Abaixo dos botões (220px) */
            /* Bottom: Acima do input (120px) = espaço garantido */
            position: absolute;
            top: 220px;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            /* Padding interno para espaçamento */
            padding-bottom: 40px;
        }

        .conversation-line {
            width: 100%;
            margin-bottom: 25px;
            line-height: 1.6;
            font-size: 15px;
            word-wrap: break-word;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            opacity: 0;
            animation: fadeInUp 0.5s ease forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .conversation-line.user {
            color: #b8c5ff;
        }

        .conversation-line.assistant {
            color: #ffd700;
            margin-bottom: 30px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
            margin-top: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .conversation-line.user .message-avatar {
            background: linear-gradient(135deg, #4f46e5, #6366f1);
        }

        .conversation-line.assistant .message-avatar {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1a1a2e;
        }

        .message-content {
            flex: 1;
            padding: 0;
            background: transparent;
        }

        .message-header {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .conversation-line.user .message-header {
            color: #6366f1;
        }

        .conversation-line.assistant .message-header {
            color: #ffd700;
        }

        .message-text {
            line-height: 1.6;
        }

        /* ===== ÁREA DE INPUT - POSICIONAMENTO FIXO ===== */
        .input-container {
            position: fixed;
            bottom: 20px;
            left: 340px;
            right: 20px;
            display: flex;
            gap: 0;
            z-index: 9999;
            max-width: calc(100vw - 360px);
            background: rgba(0, 0, 0, 0.99);
            padding: 8px;
            border-radius: 18px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(79, 70, 229, 0.4);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.9);
        }

        .message-input {
            flex: 1;
            padding: 14px 18px;
            min-height: 50px;
            max-height: 100px;
            resize: none;
            border: 2px solid #4f46e5;
            border-radius: 14px 0 0 14px;
            background: rgba(26, 26, 46, 0.98);
            color: white;
            font-size: 15px;
            font-family: inherit;
            line-height: 1.4;
            outline: none;
        }

        .message-input:focus {
            border-color: #6d63ff;
            box-shadow: 0 0 0 4px rgba(109, 99, 255, 0.2);
        }

        .message-input::placeholder {
            color: #888;
        }

        .send-button {
            width: 90px;
            background: linear-gradient(135deg, #4f46e5, #6d63ff);
            border: none;
            border-radius: 0 14px 14px 0;
            color: white;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.5);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* ===== RESPONSIVO MOBILE ===== */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                order: 2;
                padding: 20px 15px;
                position: relative;
                max-height: 50vh;
                overflow-y: auto;
            }

            .destinations-grid {
                grid-template-columns: 1fr 1fr 1fr;
                gap: 12px;
            }

            .destination-item img {
                height: 70px;
            }

            .destination-item span {
                font-size: 11px;
                padding: 8px 6px;
            }

            .main {
                order: 1;
                padding: 80px 15px 20px;
                min-height: 60vh;
            }

            .logo {
                font-size: 28px;
            }

            .header-tabs {
                top: 90px;
                left: 15px;
                right: 15px;
                gap: 6px;
            }

            .tab-button {
                font-size: 11px;
                padding: 8px 10px;
                min-width: 70px;
            }

            .input-container {
                left: 15px;
                right: 15px;
                bottom: 15px;
                max-width: calc(100vw - 30px);
                z-index: 9999;
            }

            .send-button {
                width: 70px;
                font-size: 12px;
            }

            .chat-container {
                /* Mobile: Posicionamento absoluto garantindo espaço para input */
                position: absolute;
                top: 200px;
                bottom: 100px;
                left: 15px;
                right: 15px;
                transform: none;
                padding: 0 15px;
                padding-bottom: 30px;
                margin: 0;
            }
        }

        @media (min-width: 1200px) {
            .sidebar {
                width: 360px;
            }

            .input-container {
                left: 380px;
                right: 40px;
                max-width: calc(100vw - 420px);
            }

            .language-selector {
                left: 380px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Status de Conexão -->
        <div class="connection-status" id="connectionStatus">🟢 Online</div>

        <!-- Seletor de Idioma -->
        <div class="language-selector">
            <select id="languageSelect">
                <option value="en">🇺🇸 EN</option>
                <option value="pt">🇧🇷 PT</option>
                <option value="es">🇪🇸 ES</option>
                <option value="fr">🇫🇷 FR</option>
                <option value="de">🇩🇪 DE</option>
                <option value="it">🇮🇹 IT</option>
                <option value="ja">🇯🇵 JP</option>
                <option value="ko">🇰🇷 KR</option>
                <option value="zh">🇨🇳 CN</option>
                <option value="ru">🇷🇺 RU</option>
                <option value="ar">🇸🇦 AR</option>
                <option value="hi">🇮🇳 HI</option>
            </select>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <h2>🧭 Destinations that Touch the Soul</h2>
            
            <!-- Mensagem Simbólica -->
            <div class="sidebar-message" data-translate="sidebar-message">
                🌱 Every journey through TPS plants hope and transforms lives. Grateful to be part of this chain of light.
            </div>
            
            <!-- Grid de Destinos -->
            <div class="destinations-grid">
                <div class="destination-item" data-destination="New York">
                    <img alt="New York" src="https://images.unsplash.com/photo-1496442226666-8d4d0e62e6e9?w=400&h=300&fit=crop"/>
                    <span>New York</span>
                </div>
                <div class="destination-item" data-destination="Paris">
                    <img alt="Paris" src="https://images.unsplash.com/photo-1500916434205-0c77489c6cf7?w=400&h=300&fit=crop"/>
                    <span>Paris</span>
                </div>
                <div class="destination-item" data-destination="Tokyo">
                    <img alt="Tokyo" src="https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=400&h=300&fit=crop"/>
                    <span>Tokyo</span>
                </div>
                <div class="destination-item" data-destination="Seoul">
                    <img alt="Seoul" src="https://images.unsplash.com/photo-1549693578-d683be217e58?w=400&h=300&fit=crop"/>
                    <span>Seoul</span>
                </div>
                <div class="destination-item" data-destination="London">
                    <img alt="London" src="https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?w=400&h=300&fit=crop"/>
                    <span>London</span>
                </div>
                <div class="destination-item" data-destination="São Paulo">
                    <img alt="São Paulo" src="https://images.unsplash.com/photo-1541781774459-bb2af2f05b55?w=400&h=300&fit=crop"/>
                    <span>São Paulo</span>
                </div>
                <div class="destination-item" data-destination="Dubai">
                    <img alt="Dubai" src="https://images.unsplash.com/photo-1512453979798-5ea266f8880c?w=400&h=300&fit=crop"/>
                    <span>Dubai</span>
                </div>
                <div class="destination-item" data-destination="Barcelona">
                    <img alt="Barcelona" src="https://images.unsplash.com/photo-1539037116277-4db20889f2d4?w=400&h=300&fit=crop"/>
                    <span>Barcelona</span>
                </div>
                <div class="destination-item" data-destination="Rome">
                    <img alt="Rome" src="https://images.unsplash.com/photo-1531572753322-ad063cecc140?w=400&h=300&fit=crop"/>
                    <span>Rome</span>
                </div>
                <div class="destination-item" data-destination="Sydney">
                    <img alt="Sydney" src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=300&fit=crop"/>
                    <span>Sydney</span>
                </div>
                <div class="destination-item" data-destination="Bangkok">
                    <img alt="Bangkok" src="https://images.unsplash.com/photo-1508009603885-50cf7c579365?w=400&h=300&fit=crop"/>
                    <span>Bangkok</span>
                </div>
                <div class="destination-item" data-destination="Amsterdam">
                    <img alt="Amsterdam" src="https://images.unsplash.com/photo-1534351590666-13e3e96b5017?w=400&h=300&fit=crop"/>
                    <span>Amsterdam</span>
                </div>
            </div>
            
            <div class="sidebar-footer">Connecting hearts to the world</div>
        </div>

        <!-- Área Principal -->
        <div class="main">
            <!-- Logo Centralizado -->
            <div class="logo-container">
                <div class="logo">TPS</div>
            </div>

            <!-- Botões Superiores -->
            <div class="header-tabs">
                <button class="tab-button active" id="btn-voos" data-translate="flights">✈️ Flights</button>
                <button class="tab-button" id="btn-hospedagem" data-translate="hotels">🏨 Hotels</button>
                <button class="tab-button" id="btn-transporte" data-translate="transport">🚗 Transport</button>
                <button class="tab-button" id="btn-seguro" data-translate="insurance">🛡️ Insurance</button>
                <button class="tab-button" id="btn-ingressos" data-translate="tickets">🎫 Tickets</button>
                <button class="tab-button" id="btn-pacotes" data-translate="packages">📦 Packages</button>
            </div>

            <!-- Container do Chat -->
            <div class="chat-container" id="chatContainer">
                <!-- Mensagens aparecerão aqui -->
            </div>
        </div>

        <!-- Área de Input -->
        <div class="input-container">
            <textarea class="message-input" id="messageInput" placeholder="Share your travel dreams..." rows="1"></textarea>
            <button class="send-button" id="sendButton">
                <span data-translate="send">Send</span>
                <span>✈️</span>
            </button>
        </div>
    </div>

    <script>
        // ===== TRADUÇÕES =====
        const translations = {
            en: {
                welcome: "Ready to create your unique travel experience! ✨",
                status: "Share your travel dreams and let's make them come true!",
                "sidebar-message": "🌱 Every journey through TPS plants hope and transforms lives. Grateful to be part of this chain of light.",
                send: "Send",
                placeholder: "Share your travel dreams...",
                flights: "✈️ Flights",
                hotels: "🏨 Hotels", 
                transport: "🚗 Transport",
                insurance: "🛡️ Insurance",
                tickets: "🎫 Tickets",
                packages: "📦 Packages",
                you: "You",
                assistant: "TPS Assistant"
            },
            pt: {
                welcome: "Pronto para criar sua experiência de viagem única! ✨",
                status: "Compartilhe seus sonhos de viagem e vamos realizá-los!",
                "sidebar-message": "🌱 Cada jornada através do TPS semeia esperança e transforma vidas. Gratidão por ser parte desta corrente de luz.",
                send: "Enviar",
                placeholder: "Compartilhe seus sonhos de viagem...",
                flights: "✈️ Voos",
                hotels: "🏨 Hospedagem",
                transport: "🚗 Transporte", 
                insurance: "🛡️ Seguro",
                tickets: "🎫 Ingressos",
                packages: "📦 Pacotes",
                you: "Você",
                assistant: "TPS Assistant"
            },
            es: {
                welcome: "¡Listo para crear tu experiencia de viaje única! ✨",
                status: "¡Comparte tus sueños de viaje y hagámoslos realidad!",
                "sidebar-message": "🌱 Cada viaje a través de TPS siembra esperanza y transforma vidas. Agradecido de ser parte de esta cadena de luz.",
                send: "Enviar",
                placeholder: "Comparte tus sueños de viaje...",
                flights: "✈️ Vuelos",
                hotels: "🏨 Hoteles",
                transport: "🚗 Transporte",
                insurance: "🛡️ Seguro",
                tickets: "🎫 Entradas",
                packages: "📦 Paquetes",
                you: "Tú",
                assistant: "TPS Assistant"
            },
            fr: {
                welcome: "Prêt à créer votre expérience de voyage unique ! ✨",
                status: "Partagez vos rêves de voyage et réalisons-les !",
                "sidebar-message": "🌱 Chaque voyage à travers TPS sème l'espoir et transforme les vies. Reconnaissant de faire partie de cette chaîne de lumière.",
                send: "Envoyer",
                placeholder: "Partagez vos rêves de voyage...",
                flights: "✈️ Vols",
                hotels: "🏨 Hôtels",
                transport: "🚗 Transport",
                insurance: "🛡️ Assurance",
                tickets: "🎫 Billets",
                packages: "📦 Forfaits",
                you: "Vous",
                assistant: "Assistant TPS"
            },
            de: {
                welcome: "Bereit, Ihr einzigartiges Reiseerlebnis zu schaffen! ✨",
                status: "Teilen Sie Ihre Reiseträume und lassen Sie uns sie wahr werden!",
                "sidebar-message": "🌱 Jede Reise durch TPS sät Hoffnung und verändert Leben. Dankbar, Teil dieser Lichtkette zu sein.",
                send: "Senden",
                placeholder: "Teilen Sie Ihre Reiseträume...",
                flights: "✈️ Flüge",
                hotels: "🏨 Hotels",
                transport: "🚗 Transport",
                insurance: "🛡️ Versicherung",
                tickets: "🎫 Tickets",
                packages: "📦 Pakete",
                you: "Sie",
                assistant: "TPS Assistent"
            }
        };

        // ===== VARIÁVEIS GLOBAIS =====
        let currentLang = 'en';
        let isProcessing = false;
        let chatContainer = null;
        let messageInput = null;
        let sendButton = null;
        let languageSelect = null;
        let connectionStatus = null;

        // ===== FUNÇÕES UTILITÁRIAS =====
        function getBrowserLanguage() {
            const browserLang = navigator.language.slice(0, 2);
            const supportedLangs = ['en', 'pt', 'es', 'fr', 'de', 'it', 'ja', 'ko', 'zh', 'ru', 'ar', 'hi'];
            return supportedLangs.includes(browserLang) ? browserLang : 'en';
        }

        function updateLanguage(lang) {
            currentLang = lang;
            const texts = translations[lang] || translations['en'];
            
            // Atualizar textos traduzíveis
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (texts[key]) {
                    element.textContent = texts[key];
                }
            });

            // Atualizar placeholder
            if (messageInput) {
                messageInput.placeholder = texts.placeholder;
            }
            
            // Salvar preferência
            localStorage.setItem('tps-language', lang);
        }

        function updateConnectionStatus(status) {
            if (!connectionStatus) return;
            
            switch(status) {
                case 'online':
                    connectionStatus.textContent = '🟢 Online';
                    connectionStatus.className = 'connection-status';
                    break;
                case 'connecting':
                    connectionStatus.textContent = '🟡 Connecting';
                    connectionStatus.className = 'connection-status connecting';
                    break;
                case 'offline':
                    connectionStatus.textContent = '🔴 Offline';
                    connectionStatus.className = 'connection-status';
                    break;
            }
        }

        function setButtonsState(disabled) {
            // Desabilitar/habilitar todos os botões interativos
            const buttons = document.querySelectorAll('.tab-button, .destination-item');
            buttons.forEach(button => {
                if (disabled) {
                    button.style.pointerEvents = 'none';
                    button.style.opacity = '0.7';
                } else {
                    button.style.pointerEvents = 'auto';
                    button.style.opacity = '1';
                }
            });
        }

        // ===== FUNÇÕES DE CHAT =====
        function addMessage(text, isUser = false) {
            // Verificar se chatContainer existe
            if (!chatContainer) {
                console.error('chatContainer não encontrado!');
                return;
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `conversation-line ${isUser ? 'user' : 'assistant'}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = isUser ? '👤' : '🤖';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            
            const header = document.createElement('div');
            header.className = 'message-header';
            const texts = translations[currentLang] || translations['en'];
            header.textContent = isUser ? texts.you : texts.assistant;
            
            const textDiv = document.createElement('div');
            textDiv.className = 'message-text';
            textDiv.innerHTML = text.replace(/\n/g, '<br>');
            
            content.appendChild(header);
            content.appendChild(textDiv);
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            
            // GARANTIR que a mensagem seja adicionada no chatContainer correto
            chatContainer.appendChild(messageDiv);
            
            // Scroll simples até o final
            setTimeout(() => {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 100);
            
            console.log('Mensagem adicionada:', isUser ? 'usuário' : 'assistente');
        }

        function showTyping() {
            if (!chatContainer) {
                console.error('chatContainer não encontrado para showTyping');
                return;
            }
            
            const typingDiv = document.createElement('div');
            typingDiv.className = 'conversation-line assistant';
            typingDiv.id = 'typing-indicator';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = '🤖';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            
            const textDiv = document.createElement('div');
            textDiv.className = 'message-text';
            textDiv.innerHTML = '✈️ Preparando sua experiência única...';
            
            content.appendChild(textDiv);
            typingDiv.appendChild(avatar);
            typingDiv.appendChild(content);
            
            chatContainer.appendChild(typingDiv);
            
            // Scroll simples até o final
            setTimeout(() => {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 50);
        }

        function hideTyping() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // ===== FUNÇÃO PRINCIPAL DE ENVIO =====
        async function sendMessage() {
            console.log('sendMessage chamada');
            
            if (isProcessing) {
                console.log('Já processando, ignorando...');
                return;
            }
            
            if (!messageInput || !sendButton) {
                console.error('Elementos de input não encontrados');
                return;
            }
            
            const message = messageInput.value.trim();
            if (!message) {
                console.log('Mensagem vazia, ignorando...');
                return;
            }

            console.log('Enviando mensagem:', message);

            isProcessing = true;
            sendButton.disabled = true;
            setButtonsState(true);
            updateConnectionStatus('connecting');
            
            const texts = translations[currentLang] || translations['en'];
            sendButton.innerHTML = '<span class="loading-dots">Enviando</span>';

            // Adicionar mensagem do usuário
            addMessage(message, true);
            messageInput.value = '';
            messageInput.style.height = 'auto';

            // Mostrar indicador de digitação
            showTyping();

            try {
                // Simular resposta inteligente local (já que está rodando no cliente)
                console.log('Gerando resposta local...');
                
                // Aguardar um pouco para simular processamento
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const fallbackResponse = await generateResponse(message);
                
                // Remover indicador de digitação
                hideTyping();
                
                // Adicionar resposta
                addMessage(`🌐 **TPS Local Mode**\n\n${fallbackResponse}`);
                
                updateConnectionStatus('online');
                
            } catch (error) {
                hideTyping();
                console.error('Erro na geração de resposta:', error);
                
                addMessage(`⚠️ **Erro interno**\n\nDesculpe, ocorreu um erro. Tente novamente!`);
                
                updateConnectionStatus('offline');
            } finally {
                isProcessing = false;
                sendButton.disabled = false;
                setButtonsState(false);
                sendButton.innerHTML = `<span>${texts.send}</span><span>✈️</span>`;
                
                console.log('sendMessage finalizada');
            }
        }

        // ===== GERAÇÃO DE RESPOSTA INTELIGENTE (FALLBACK) =====
        async function generateResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Respostas específicas para voos
            if (lowerMessage.includes('voo') || lowerMessage.includes('flight') || lowerMessage.includes('voar') || lowerMessage.includes('buscar voos')) {
                return `✈️ **Perfeito! Vamos encontrar os melhores voos para você!**

Para oferecer as opções mais adequadas, preciso de algumas informações:

📋 **Informações necessárias:**
📍 **Cidade de origem** (ex: São Paulo, Rio de Janeiro)
📍 **Destino desejado** (ex: Paris, Nova York, Tóquio)
📅 **Data de ida** (dd/mm/aaaa)
📅 **Data de volta** (dd/mm/aaaa) - ou só ida
👥 **Número de passageiros** (adultos/crianças)
💺 **Classe preferida** (econômica, executiva, primeira)

🌟 **Ofertas em destaque:**
• **Europa**: A partir de R$ 2.890 (Paris, Londres, Roma)
• **América do Norte**: A partir de R$ 3.520 (Nova York, Miami)
• **Ásia**: A partir de R$ 4.180 (Tóquio, Seoul, Singapura)

💡 **Dica do especialista**: Voos com 1-2 escalas costumam ter preços 30% menores que diretos!

Me informe seus dados e vou buscar as melhores opções disponíveis! ✨`;
            }

            // Respostas específicas para hospedagem
            if (lowerMessage.includes('hotel') || lowerMessage.includes('hospedagem') || lowerMessage.includes('accommodation') || lowerMessage.includes('estou procurando hospedagem')) {
                return `🏨 **Excelente! Vou te ajudar a encontrar a hospedagem ideal!**

Para sugerir as melhores opções, preciso conhecer suas preferências:

📋 **Detalhes da hospedagem:**
📍 **Destino específico** (cidade/bairro)
📅 **Check-in** (dd/mm/aaaa)
📅 **Check-out** (dd/mm/aaaa)
👥 **Número de hóspedes** (adultos/crianças)
🛏️ **Tipo de acomodação** (quarto, suíte, apartamento)
⭐ **Categoria** (econômica, conforto, luxo)
📍 **Localização preferida** (centro, praia, aeroporto)

🏆 **Recomendações por destino:**
• **Paris**: Hotéis boutique no Marais ou Saint-Germain
• **Tóquio**: Ryokans tradicionais ou hotéis em Shibuya
• **Nova York**: Hotéis em Midtown ou Brooklyn
• **Londres**: Charming hotels em Covent Garden

💰 **Faixas de preço médias:**
• Econômica: R$ 150-300/noite
• Conforto: R$ 300-600/noite  
• Luxo: R$ 600+/noite

Compartilhe seus detalhes e vou encontrar opções perfeitas! 🌟`;
            }

            // Resposta padrão personalizada
            return `✨ **Bem-vindo ao TPS - seu assistente pessoal de viagens!**

Que emocionante começar a planejar sua viagem! Estou aqui para transformar seus sonhos em realidade.

🎯 **Como posso te ajudar especificamente hoje?**

Use os botões acima para acesso rápido ou me conte:
• 📍 **Seu destino dos sonhos**
• 📅 **Quando pretende viajar**
• 🎯 **Que tipo de experiência busca**

💡 **Dica especial**: Quanto mais detalhes você me der, melhor posso personalizar suas opções com ofertas exclusivas e dicas de insider!

Por onde começamos sua próxima aventura? 🌍✨`;
        }

        // ===== EVENT LISTENERS =====
        function initializeEventListeners() {

            // Envio de mensagem
            sendButton.addEventListener('click', () => {
                console.log('Botão Send clicado');
                sendMessage();
            });
            
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    console.log('Enter pressionado');
                    sendMessage();
                }
            });

            // Auto-resize do textarea
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 100) + 'px';
            });

            // Mudança de idioma
            languageSelect.addEventListener('change', (e) => {
                updateLanguage(e.target.value);
            });

            // Clique em destinos
            document.querySelectorAll('.destination-item').forEach(item => {
                item.addEventListener('click', () => {
                    if (isProcessing) return;
                    
                    // Efeito visual de clique
                    item.classList.add('clicked');
                    setTimeout(() => item.classList.remove('clicked'), 150);
                    
                    const destination = item.getAttribute('data-destination');
                    
                    setTimeout(() => {
                        messageInput.value = `Quero conhecer ${destination}. Pode me ajudar?`;
                        sendMessage();
                    }, 150);
                });
            });

            // Clique em botões de categoria
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    if (isProcessing) return;
                    
                    processTabButtonClick(button);
                });
            });
        }
        
        function processTabButtonClick(button) {
            // Simples e direto - apenas aguardar um momento antes da ação
            setTimeout(() => {
                executeTabAction(button);
            }, 200);
        }

        function executeTabAction(button) {
            // Remover active de todos
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            // Adicionar active no clicado
            button.classList.add('active');
            
            // Obter texto específico do botão e gerar pergunta única
            const buttonId = button.id;
            let specificQuestion = '';
            
            switch(buttonId) {
                case 'btn-voos':
                    specificQuestion = 'Quero buscar voos internacionais. Pode me ajudar?';
                    break;
                case 'btn-hospedagem':
                    specificQuestion = 'Estou procurando hospedagem. Pode me recomendar hotéis?';
                    break;
                case 'btn-transporte':
                    specificQuestion = 'Quais opções de transporte local você sugere no meu destino?';
                    break;
                case 'btn-seguro':
                    specificQuestion = 'Preciso de seguro viagem. Pode mostrar opções seguras?';
                    break;
                case 'btn-ingressos':
                    specificQuestion = 'Quero ver ingressos para atrações e passeios. Pode mostrar?';
                    break;
                case 'btn-pacotes':
                    specificQuestion = 'Você pode montar pacotes com voos + hotel para mim?';
                    break;
                default:
                    specificQuestion = 'Quero buscar voos internacionais. Pode me ajudar?';
            }
            
            setTimeout(() => {
                messageInput.value = specificQuestion;
                sendMessage();
            }, 150);
        }

        // ===== INICIALIZAÇÃO =====
        function initialize() {
            // Aguardar DOM estar completamente carregado
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initialize);
                return;
            }

            // ===== INICIALIZAR VARIÁVEIS DOM =====
            chatContainer = document.getElementById('chatContainer');
            messageInput = document.getElementById('messageInput');
            sendButton = document.getElementById('sendButton');
            languageSelect = document.getElementById('languageSelect');
            connectionStatus = document.getElementById('connectionStatus');

            // Verificar se todos os elementos foram encontrados
            if (!chatContainer || !messageInput || !sendButton || !languageSelect) {
                console.error('Elementos DOM não encontrados:', {
                    chatContainer: !!chatContainer,
                    messageInput: !!messageInput,
                    sendButton: !!sendButton,
                    languageSelect: !!languageSelect
                });
                return;
            }

            // Configurar idioma inicial
            const savedLang = localStorage.getItem('tps-language');
            const initialLang = savedLang || getBrowserLanguage();
            
            languageSelect.value = initialLang;
            updateLanguage(initialLang);

            // Inicializar status de conexão
            updateConnectionStatus('online');

            // Inicializar event listeners
            initializeEventListeners();

            // Mensagem de boas-vindas
            setTimeout(() => {
                addMessage(`✨ Olá! Bem-vindo ao TPS - seu assistente pessoal de viagens!

Estou aqui para transformar seus sonhos de viagem em realidade. Posso te ajudar com voos, hotéis, transporte, seguros, ingressos e pacotes completos.

🌍 **Como podemos começar sua próxima aventura?**

Pode me contar seu destino dos sonhos ou clique em uma das opções acima! 🚀

🔗 **Status**: Modo Local ativo!`);
            }, 1000);

            console.log('✅ TPS inicializado com sucesso!');
        }

        // Inicializar quando a página carregar
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }
    </script>
</body>
</html>