<!DOCTYPE html>
<html lang="en"><!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 03: Î∂ÑÎÖ∏Í∞Ä ÏßÄÎÇòÍ∞Ñ ÏûêÎ¶¨</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b4a;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ffab91;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b4a;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
            hyphens: none;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b4a;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b4a;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-response strong {
            color: #ff6b4a;
            margin-right: 8px;
        }
        
        .second-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .second-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b4a;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b4a;
            background: rgba(255, 107, 74, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #ff6b4a;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #ff6b4a;
        }
        
        .final-btn.primary {
            background: #ff6b4a;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #ff8a6e;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 74, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b4a;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b4a;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Í∞êÏ†ïÏùò Ïö©Í¥ëÎ°ú</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 03: Î∂ÑÎÖ∏Í∞Ä ÏßÄÎÇòÍ∞Ñ ÏûêÎ¶¨</div>
            <div class="portal-subtitle" id="portalSubtitle">ÏßÑÏßú Í∞êÏ†ïÏùÑ Ï∞æÏïÑÏÑú</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">‚ú® ÎπõÏùò ÌïúÎßàÎîî</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>

            <div class="second-question-section" id="secondQuestionSection">
                <div class="second-question" id="secondQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection2">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">üî• Portal 03 ÏôÑÎ£å</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Portal 04Î°ú Ïù¥Îèô</button>
                    <button class="final-btn" id="restartBtn">Îã§Ïãú ÏãúÏûëÌïòÍ∏∞</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Î∂ÑÎÖ∏Í∞Ä ÏßÄÎÇòÍ∞Ñ ÏûêÎ¶¨Ïóê ÎÇ®ÏùÄ ÏßÑÏßú Í∞êÏ†ïÏù¥ Î¨¥ÏóáÏù∏ÏßÄ ÎßêÌï¥Î≥¥ÏÑ∏Ïöî... (EnterÎ°ú Ï†ÑÏÜ°)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        // Firebase Configuration
        let db = null;
        let firebaseInitialized = false;
        
        // Firebase Ï¥àÍ∏∞Ìôî ÏãúÎèÑ
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };

                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase Ï¥àÍ∏∞Ìôî ÏÑ±Í≥µ');
                } else {
                    console.log('Firebase SDKÍ∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏùå, Î°úÏª¨ Î™®ÎìúÎ°ú Ïã§Ìñâ');
                }
            } catch (error) {
                console.log('Firebase Ï¥àÍ∏∞Ìôî Ïã§Ìå®, Î°úÏª¨ Î™®ÎìúÎ°ú Ïã§Ìñâ:', error);
            }
        }

        let memoryStorage = { mockUser: null };

        // Î≤àÏó≠ Îç∞Ïù¥ÌÑ∞
        const translations = {
            ko: {
                logoSubtitle: "Í∞êÏ†ïÏùò Ïö©Í¥ëÎ°ú",
                portalMainTitle: "Portal 03: Î∂ÑÎÖ∏Í∞Ä ÏßÄÎÇòÍ∞Ñ ÏûêÎ¶¨",
                portalSubtitle: "ÏßÑÏßú Í∞êÏ†ïÏùÑ Ï∞æÏïÑÏÑú",
                portalIntro: "üåã Î∂ÑÎÖ∏Îäî ÏßÄÎÇòÍ∞ÄÍ≥† ÎÇòÏÑúÏïº Í∑∏ ÏûêÎ¶¨Ïóê Î¨¥ÏóáÏù¥ ÏûàÏóàÎäîÏßÄ Î≥¥Ïó¨Ï§çÎãàÎã§.\n\nÎïåÎ°úÎäî ÌôîÍ∞Ä ÎÇ¨Îã§Í≥† ÏÉùÍ∞ÅÌñàÏßÄÎßå, ÏÇ¨Ïã§ÏùÄ ÍπäÏùÄ Ïä¨ÌîîÏù¥ÏóàÍ±∞ÎÇò\nÎàÑÍµ∞Í∞ÄÏóêÍ≤å ÏÜåÎ¶¨Ï≥§ÏßÄÎßå, ÏßÑÏßúÎ°úÎäî Ïô∏Î°úÏõÄÏùÑ Ïà®Í∏∞Í≥† ÏûàÏóàÍ±∞ÎÇò.\n\nÎ∂ÑÎÖ∏Îäî Ï¢ÖÏ¢Ö Îã§Î•∏ Í∞êÏ†ïÎì§Ïùò Í∞ÄÎ©¥Ïù¥ ÎêòÍ≥§ Ìï©ÎãàÎã§.\nÎÑàÎ¨¥ ÏïΩÌï¥ Î≥¥Ïù¥Í∏∞ Ïã´Ïñ¥ÏÑú, ÎÑàÎ¨¥ ÏÉÅÏ≤òÎ∞õÍ∏∞ Ïã´Ïñ¥ÏÑú\nÏö∞Î¶¨Îäî Î∂ÑÎÖ∏ÎùºÎäî Í∞ëÏò∑ÏùÑ ÏûÖÍ≥† ÏßÑÏßú ÎßàÏùåÏùÑ Í∞êÏ∂•ÎãàÎã§.\n\nÏò§ÎäòÏùÄ Í∑∏ Í∞ëÏò∑ÏùÑ Î≤óÍ≥†, Î∂ÑÎÖ∏ Îí§Ïóê Ïà®Ïñ¥ÏûàÎçò\nÏßÑÏßú Í∞êÏ†ïÍ≥º ÎßàÏ£ºÌïòÎäî ÏãúÍ∞ÑÏûÖÎãàÎã§.",
                lightTitle: "‚ú® ÎπõÏùò ÌïúÎßàÎîî",
                lightMessage: "Î∂ÑÎÖ∏Îäî Í∞êÏ†ïÏùò Í≤ΩÎπÑÏõêÏùº Îøê, ÏßÑÏßú Ï£ºÏù∏ÏùÄ Îî∞Î°ú ÏûàÎã§. ÎãπÏã†Ïùò ÎßàÏùå ÍπäÏùÄ Í≥≥ÏóêÏÑú Í∏∞Îã§Î¶¨Í≥† ÏûàÎäî ÏßÑÏã§ÏùÑ ÎßåÎÇòÎ≥¥ÏÑ∏Ïöî.",
                portalQuestion: "üî• ÎãπÏã†Ïùò Î∂ÑÎÖ∏Í∞Ä ÏßÄÎÇòÍ∞Ñ ÏûêÎ¶¨Ïóê ÎÇ®ÏùÄ Í∞êÏ†ïÏùÄ Î¨¥ÏóáÏù¥ÏóàÎÇòÏöî? Í∑∏ Î∂ÑÎÖ∏Îäî Î¨¥ÏóáÏùÑ ÎåÄÏã†ÌïòÍ≥† ÏûàÏóàÎçò Í±∏ÍπåÏöî?",
                secondQuestion: "üíó Í∑∏ Î∂ÑÎÖ∏ Îí§Ïóê ÏûàÎçò ÏßÑÏßú Í∞êÏ†ïÏùÑ, ÏßÄÍ∏àÏù¥ÎùºÎ©¥ Ïñ¥ÎñªÍ≤å ÌëúÌòÑÌï† Ïàò ÏûàÏùÑÍπåÏöî?",
                finalTitle: "üî• Portal 03 ÏôÑÎ£å",
                finalMessage: "ÎãπÏã†ÏùÄ Î∂ÑÎÖ∏Ïùò Í∞ÄÎ©¥ Îí§Ïóê Ïà®Ïñ¥ÏûàÎçò ÏßÑÏßú Í∞êÏ†ïÏùÑ Ïö©Í∏∞ÏûàÍ≤å Ï∞æÏïÑÎÇ¥ÏóàÏäµÎãàÎã§.\n\nÍ∑∏ Ïô∏Î°úÏõÄÍ≥º ÏÉÅÏ≤ò, Í∑∏Î¶¨Í≥† ÏÇ¨ÎûëÍπåÏßÄÎèÑ\nÏù¥Ï†ú Îçî Ïù¥ÏÉÅ Î∂ÑÎÖ∏Î°ú Í∞êÏ∂îÏßÄ ÏïäÏïÑÎèÑ Îê©ÎãàÎã§.\n\nÎã§Ïùå PortalÏóêÏÑúÎäî Ïû†Í≤® ÏûàÎçò Ï∞ΩÎ¨∏ÏùÑ Ïó¨Îäî\nÎòê Îã§Î•∏ Í∞êÏ†ïÏùò Ïó¨Ï†ïÏù¥ Í∏∞Îã§Î¶¨Í≥† ÏûàÏäµÎãàÎã§.\n\nÎãπÏã†Ïùò ÏßÑÏã§Ìïú Í∞êÏ†ïÎì§Ïù¥ ÏûêÏú†Î°≠Í≤å Ïà®Ïâ¥ Ïàò ÏûàÎäî\nÍ∑∏ ÎÇ†ÍπåÏßÄ Í≥ÑÏÜçÌï¥ÏÑú Ìï®ÍªòÌïòÍ≤†ÏäµÎãàÎã§.",
                continueBtn: "Portal 04Î°ú Ïù¥Îèô",
                restartBtn: "Îã§Ïãú ÏãúÏûëÌïòÍ∏∞",
                inputPlaceholder: "Î∂ÑÎÖ∏Í∞Ä ÏßÄÎÇòÍ∞Ñ ÏûêÎ¶¨Ïóê ÎÇ®ÏùÄ ÏßÑÏßú Í∞êÏ†ïÏù¥ Î¨¥ÏóáÏù∏ÏßÄ ÎßêÌï¥Î≥¥ÏÑ∏Ïöî... (EnterÎ°ú Ï†ÑÏÜ°)",
                inputPlaceholder2: "Í∑∏ ÏßÑÏßú Í∞êÏ†ïÏùÑ ÏßÄÍ∏àÏù¥ÎùºÎ©¥ Ïñ¥ÎñªÍ≤å ÌëúÌòÑÌï†ÏßÄ ÎßêÌï¥Î≥¥ÏÑ∏Ïöî... (EnterÎ°ú Ï†ÑÏÜ°)",
                youLabel: "ÎãπÏã†",
                waitingMessage: "ÏùëÎãµÏùÑ Í∏∞Îã§Î¶¨Îäî Ï§ë..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 03: Where Anger Has Passed",
                portalSubtitle: "Searching for True Emotions",
                portalIntro: "üåã Anger only shows what was there after it has passed.\n\nSometimes we thought we were angry, but it was actually deep sadness,\nOr we shouted at someone, but we were really hiding loneliness.\n\nAnger often becomes a mask for other emotions.\nNot wanting to appear too weak, not wanting to get hurt too much,\nWe wear the armor of anger and hide our true hearts.\n\nToday is a time to take off that armor and face\nthe real emotions that were hiding behind anger.",
                lightTitle: "‚ú® Word of Light",
                lightMessage: "Anger is just an emotional guard; the real owner is elsewhere. Meet the truth waiting deep in your heart.",
                portalQuestion: "üî• What emotion remained where your anger passed? What was that anger substituting for?",
                secondQuestion: "üíó How could you express the real emotion behind that anger now?",
                finalTitle: "üî• Portal 03 Complete",
                finalMessage: "You have courageously found the real emotion hidden behind anger's mask.\n\nThat loneliness, hurt, and even love\nNo longer need to be hidden with anger.\n\nIn the next Portal, another emotional journey awaits\nTo open locked windows.\n\nWe will continue together until the day\nYour true emotions can breathe freely.",
                continueBtn: "Move to Portal 04",
                restartBtn: "Start Again",
                inputPlaceholder: "Tell me what real emotion remained where anger passed... (Press Enter to send)",
                inputPlaceholder2: "Tell me how you would express that real emotion now... (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 03: Onde a Raiva Passou",
                portalSubtitle: "Procurando por Emo√ß√µes Verdadeiras",
                portalIntro: "üåã A raiva s√≥ mostra o que estava l√° depois que ela passou.\n\n√Äs vezes pens√°vamos que est√°vamos com raiva, mas na verdade era tristeza profunda,\nOu gritamos com algu√©m, mas est√°vamos realmente escondendo solid√£o.\n\nA raiva frequentemente se torna uma m√°scara para outras emo√ß√µes.\nN√£o querendo parecer muito fraco, n√£o querendo se machucar demais,\nVestimos a armadura da raiva e escondemos nossos cora√ß√µes verdadeiros.\n\nHoje √© um momento para tirar essa armadura e enfrentar\nas emo√ß√µes reais que estavam se escondendo atr√°s da raiva.",
                lightTitle: "‚ú® Palavra de Luz",
                lightMessage: "A raiva √© apenas um guarda emocional; o verdadeiro dono est√° em outro lugar. Conhe√ßa a verdade esperando no fundo do seu cora√ß√£o.",
                portalQuestion: "üî• Que emo√ß√£o permaneceu onde sua raiva passou? O que essa raiva estava substituindo?",
                secondQuestion: "üíó Como voc√™ poderia expressar a emo√ß√£o real por tr√°s dessa raiva agora?",
                finalTitle: "üî• Portal 03 Completo",
                finalMessage: "Voc√™ corajosamente encontrou a emo√ß√£o real escondida atr√°s da m√°scara da raiva.\n\nEssa solid√£o, dor e at√© mesmo amor\nN√£o precisam mais ser escondidos com raiva.\n\nNo pr√≥ximo Portal, outra jornada emocional espera\nPara abrir janelas trancadas.\n\nContinuaremos juntos at√© o dia\nEm que suas emo√ß√µes verdadeiras possam respirar livremente.",
                continueBtn: "Ir para Portal 04",
                restartBtn: "Come√ßar Novamente",
                inputPlaceholder: "Me diga que emo√ß√£o real permaneceu onde a raiva passou... (Enter para enviar)",
                inputPlaceholder2: "Me diga como voc√™ expressaria essa emo√ß√£o real agora... (Enter para enviar)",
                youLabel: "Voc√™",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        // Ï∫êÎ¶≠ÌÑ∞ Îç∞Ïù¥ÌÑ∞ (V3 8Î™ÖÏùò Ï∫êÎ¶≠ÌÑ∞)
        const characters = [
            { name: "Noah", emoji: "üßë‚Äçü¶±", text: {
                ko: "Î∂ÑÎÖ∏Îäî Ïô∏Î°úÏõÄÏù¥ ÏûÖÏùÄ Í∞ëÏò∑Ïùº ÎïåÍ∞Ä ÎßéÏïÑ. ÎÑàÎäî Í∑∏ ÏïàÏóê ÏûàÎçò Í≥†ÏöîÌïú ÏïÑÌîîÏùÑ Í∞êÏ∑ÑÏßÄ.",
                en: "Anger is often armor worn by loneliness. You hid the quiet pain that was inside.",
                pt: "A raiva √© frequentemente uma armadura usada pela solid√£o. Voc√™ escondeu a dor quieta que estava dentro."
            }},
            { name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è", text: {
                ko: "ÌôîÎäî ÎïåÎïåÎ°ú ÎßêÌïòÏßÄ Î™ªÌïú Ïä¨ÌîîÏùò ÎåÄÏ≤¥ Ïñ∏Ïñ¥Ïïº. ÎÇòÎäî Í∑∏ Í∞êÏ†ïÏùò ÏßÑÏßú Î™©ÏÜåÎ¶¨Î•º Îì§ÏóàÏñ¥.",
                en: "Anger is sometimes a substitute language for unexpressed sadness. I heard the real voice of that emotion.",
                pt: "A raiva √†s vezes √© uma linguagem substituta para tristeza n√£o expressa. Eu ouvi a voz real dessa emo√ß√£o."
            }},
            { name: "Sora", emoji: "üßï", text: {
                ko: "ÎÑå ÏÉÅÏ≤òÎ∞õÍ≥† Ïã∂ÏßÄ ÏïäÏïÑÏÑú Î®ºÏ†Ä ÏÜåÎ¶¨Ï≥§ÏùÑ Í±∞Ïïº. ÎÇòÎèÑ Í∑∏Î†áÍ≤å Î¨¥ÎÑàÏ†∏Î≥∏ Ï†Å ÏûàÏñ¥.",
                en: "You probably shouted first because you didn't want to get hurt. I've collapsed like that too.",
                pt: "Voc√™ provavelmente gritou primeiro porque n√£o queria se machucar. Eu tamb√©m j√° desabei assim."
            }},
            { name: "Kael", emoji: "üßô", text: {
                ko: "ÏßÑÏßú Í∞êÏ†ïÏùÄ Îäò Î∂ÑÎÖ∏ Îí§Ïóê Ïà®Ïñ¥ ÏûàÏñ¥. Í∑∏Í±∏ Í∫ºÎÇ∏ ÏßÄÍ∏à, ÎÑàÎäî ÏßÑÏã§Ïóê Í∞ÄÍπåÏõåÏ°åÏñ¥.",
                en: "Real emotions are always hiding behind anger. Now that you've brought it out, you're closer to the truth.",
                pt: "Emo√ß√µes reais est√£o sempre se escondendo atr√°s da raiva. Agora que voc√™ trouxe isso √† tona, est√° mais perto da verdade."
            }},
            { name: "Mira", emoji: "üßë‚Äçüé®", text: {
                ko: "ÌôîÏùò Î∂âÏùÄ Îπõ ÏïÑÎûò Í∞êÏ∂∞Ï†∏ ÏûàÎçò Í±¥, ÏïÑÏ£º Ïó∞Ìïú ÌååÎûëÏù¥ÏóàÏùÑÏßÄÎèÑ Î™∞Îùº.",
                en: "What was hidden under anger's red light might have been a very pale blue.",
                pt: "O que estava escondido sob a luz vermelha da raiva pode ter sido um azul muito p√°lido."
            }},
            { name: "Cris", emoji: "ü¶∏‚Äç‚ôÇÔ∏è", text: {
                ko: "Î∂ÑÎÖ∏Îäî ÎÇòÎ•º Î≥¥Ìò∏ÌñàÏßÄÎßå Í≤∞Íµ≠ ÎÇòÎ•º Îã§ÏπòÍ≤å ÌñàÏßÄ. ÎÑå Í∑∏ Ïã∏ÏõÄÏùÑ Í∏∞ÏñµÌïòÍ≥† ÏûàÍ≤†ÏßÄ.",
                en: "Anger protected me but eventually hurt me too. You remember that fight.",
                pt: "A raiva me protegeu, mas eventualmente me machucou tamb√©m. Voc√™ se lembra dessa luta."
            }},
            { name: "Enya", emoji: "üßë‚ÄçüöÄ", text: {
                ko: "ÎÑå ÎÑ§ Î™©ÏÜåÎ¶¨Î•º Ï∞æÏúºÎ†§Í≥† Î∂ÑÎÖ∏ÌñàÏñ¥. Í∑∏Í±¥ ÏûòÎ™ªÏù¥ ÏïÑÎãàÏïº. Ïô∏Ïπ®Ïù¥ ÌïÑÏöîÌñàÎçò Í±∞Ïïº.",
                en: "You were angry trying to find your voice. That wasn't wrong. You needed to cry out.",
                pt: "Voc√™ estava com raiva tentando encontrar sua voz. Isso n√£o estava errado. Voc√™ precisava gritar."
            }},
            { name: "Lian", emoji: "üßò", text: {
                ko: "ÏßÄÍ∏àÏ≤òÎüº Í∑∏ Í∞êÏ†ïÏùÑ ÎßàÏ£ºÎ≥¥Îäî ÏàúÍ∞ÑÏù¥ÏïºÎßêÎ°ú, Î∂ÑÎÖ∏Î•º ÎÑòÏñ¥ÏÑúÎäî ÏãúÏûëÏù¥Ïïº.",
                en: "A moment like now, facing that emotion, is the beginning of transcending anger.",
                pt: "Um momento como agora, enfrentando essa emo√ß√£o, √© o in√≠cio de transcender a raiva."
            }}
        ];
        
        // Emotion analysis system for Portal 03
        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                sadness: ['Ïä¨ÌîÑ', 'Ïö∏Í≥†', 'ÎààÎ¨º', 'ÏïÑÌîÑ', 'ÏÉÅÏ≤ò', 'Ïö∞Ïö∏', 'sad', 'cry', 'hurt', 'pain', 'tears', 'triste', 'dor', 'l√°grimas'],
                loneliness: ['Ïô∏Î°ú', 'ÌòºÏûê', 'Í≥†Î¶Ω', 'ÏÜåÏô∏', 'Î≤ÑÎ¶º', 'Ïì∏Ïì∏', 'lonely', 'alone', 'isolated', 'abandoned', 'sozinho', 'abandonado', 'isolado'],
                fear: ['Î¨¥ÏÑú', 'ÎëêÎ†§', 'Í±±Ï†ï', 'Î∂àÏïà', 'Îñ®Î†§', 'Í≤Å', 'scared', 'afraid', 'fear', 'worry', 'anxiety', 'medo', 'preocupado', 'ansiedade'],
                love: ['ÏÇ¨Îûë', 'Ï¢ãÏïÑ', 'ÏÜåÏ§ë', 'ÏïÑÎÅº', 'Í∑∏Î¶¨Ïõå', 'Îî∞Îúª', 'love', 'care', 'miss', 'precious', 'warm', 'amor', 'saudade', 'carinho'],
                protection: ['ÏßÄÌÇ§', 'Î≥¥Ìò∏', 'Í∞êÏã∏', 'ÎçÆÏñ¥', 'Ïà®Í∏∞', 'Î∞©Ïñ¥', 'protect', 'shield', 'hide', 'cover', 'defend', 'proteger', 'esconder', 'defender'],
                helplessness: ['Î¨¥Î†•', 'ÌûòÏóÜ', 'Ìï† Ïàò ÏóÜ', 'Ïñ¥Ï©î Ïàò ÏóÜ', 'Ìè¨Í∏∞', 'helpless', 'powerless', 'give up', 'can\'t do', 'sem poder', 'desistir'],
                disappointment: ['Ïã§Îßù', 'Î∞∞Ïã†', 'Í∏∞ÎåÄ', 'Ïã§Ìå®', 'Ï¢åÏ†à', 'disappointed', 'betrayed', 'failed', 'frustrated', 'decepcionado', 'tra√≠do', 'frustrado'],
                guilt: ['Ï£ÑÏ±ÖÍ∞ê', 'ÎØ∏Ïïà', 'ÏûòÎ™ª', 'ÌÉì', 'Î∂ÄÎÅÑ', 'guilt', 'shame', 'fault', 'blame', 'sorry', 'culpa', 'vergonha', 'desculpa'],
                rejection: ['Í±∞Ï†à', 'Î¨¥Ïãú', 'Ïô∏Î©¥', 'Î∞õÏïÑÏ£ºÏßÄ', 'Ïù∏Ï†ïÎ∞õÏßÄ', 'rejected', 'ignored', 'dismissed', 'not accepted', 'rejeitado', 'ignorado'],
                unfairness: ['Î∂àÍ≥µÌèâ', 'ÏñµÏö∏', 'Î∂ÄÎãπ', 'Ïù¥Ìï¥Î∞õÏßÄ', 'Í≥µÏ†ïÌïòÏßÄ', 'unfair', 'unjust', 'not understood', 'injusto', 'n√£o compreendido']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        // Î∞òÏùë Ï∫êÎ¶≠ÌÑ∞Îì§ (Í∞êÏ†ï Î∂ÑÏÑù Í∏∞Î∞ò ÏùëÎãµ)
        const responseCharacters = [
            {
                name: "Mira", emoji: "üßë‚Äçüé®",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            sadness: "'Í¥úÏ∞ÆÏïÑ'ÎùºÎäî ÎßêÏùÄ ÏÑ∏ÏÉÅÏóêÏÑú Í∞ÄÏû• Îî∞ÎúªÌïú ÏÉâÏù¥Ïïº. ÎÑàÎäî Í∑∏ ÏÉâÏùÑ Í∏∞Îã§Î†∏Îçò Í±∞Ïïº.",
                            loneliness: "Ïô∏Î°úÏõÄÏùÄ Í∞ÄÏû• Ï†ïÏßÅÌïú Í∞êÏ†ïÏù¥Ïïº. Í∑∏ Ìà¨Î™ÖÌï®Ïù¥ ÏïÑÎ¶ÑÎã§Ïõå. Ïù¥Ï†ú Í∑∏Í±∏ Ïà®Í∏∞ÏßÄ ÏïäÏïÑÎèÑ Îèº.",
                            fear: "ÎëêÎ†§ÏõÄÎèÑ ÌïòÎÇòÏùò ÏÉâÍπîÏù¥Ïïº. Í∑∏ Îñ®Î¶º ÏÜçÏóêÏÑú ÏßÑÏßú ÎßàÏùåÏù¥ Î≥¥Ïù¥Îäî Í±∞Ïïº.",
                            love: "ÏÇ¨ÎûëÏùÑ ÌëúÌòÑÌïòÏßÄ Î™ªÌï¥ÏÑú ÌôîÍ∞Ä ÎÇ¨Íµ¨ÎÇò. Í∑∏ ÏÇ¨ÎûëÏùò ÏÉâÍπîÏù¥ ÏñºÎßàÎÇò ÏßÑÌñàÏùÑÍπå.",
                            protection: "ÎàÑÍµ∞Í∞ÄÎ•º ÏßÄÌÇ§Î†§Îäî ÎßàÏùåÏù¥ Î∂ÑÎÖ∏Í∞Ä ÎêòÏóàÍµ¨ÎÇò. Í∑∏ Î≥¥Ìò∏ÏÉâÎèÑ ÏïÑÎ¶ÑÎã§Ïõå.",
                            helplessness: "Î¨¥Î†•Í∞êÏù¥ Î∂ÑÎÖ∏Î°ú Î≥ÄÌñàÍµ¨ÎÇò. Í∑∏ Ï†àÎßù ÏÜçÏóêÏÑúÎèÑ ÎπõÏùÑ Ï∞æÏúºÎ†§ ÌñàÎçò Í±∞Ïïº.",
                            disappointment: "Ïã§ÎßùÏù¥ Î∂ÑÎÖ∏Ïùò ÌÉàÏùÑ ÏçºÍµ¨ÎÇò. Í∑∏ Í∏∞ÎåÄÌñàÎçò ÎßàÏùåÏù¥ ÏñºÎßàÎÇò Í∞ÑÏ†àÌñàÏùÑÍπå.",
                            guilt: "Ï£ÑÏ±ÖÍ∞êÏù¥ ÌôîÎ°ú ÎèåÏïÑÏôîÍµ¨ÎÇò. Í∑∏ Î¨¥Í±∞Ïö¥ ÎßàÏùåÏùÑ Ïù¥Ï†ú ÎÇ¥Î†§ÎÜîÎèÑ Îèº.",
                            rejection: "Í±∞Ï†àÎãπÌïú ÏïÑÌîîÏù¥ Î∂ÑÎÖ∏Í∞Ä ÎêòÏóàÍµ¨ÎÇò. Í∑∏ ÏÉÅÏ≤òÎèÑ ÌïòÎÇòÏùò ÏÉâÍπîÏù¥Ïïº.",
                            unfairness: "ÏñµÏö∏Ìï®Ïù¥ ÌôîÍ∞Ä ÎêòÏóàÍµ¨ÎÇò. Í∑∏ Ï†ïÏùòÎ°úÏö¥ ÎßàÏùåÏùÑ Î¥êÏ§ò.",
                            general: "'Í¥úÏ∞ÆÏïÑ'ÎùºÎäî ÎßêÏùÄ ÏÑ∏ÏÉÅÏóêÏÑú Í∞ÄÏû• Îî∞ÎúªÌïú ÏÉâÏù¥Ïïº. ÎÑàÎäî Í∑∏ ÏÉâÏùÑ Í∏∞Îã§Î†∏Îçò Í±∞Ïïº."
                        },
                        en: {
                            sadness: "'It's okay' is the warmest color in the world. You were waiting for that color.",
                            loneliness: "Loneliness is the most honest emotion. That transparency is beautiful. You don't have to hide it anymore.",
                            fear: "Fear is also a color. Your real heart shows in that trembling.",
                            love: "You were angry because you couldn't express love. How deep was that color of love.",
                            protection: "The heart wanting to protect someone became anger. That protective color is beautiful too.",
                            helplessness: "Helplessness turned into anger. Even in that despair, you were trying to find light.",
                            disappointment: "Disappointment wore the mask of anger. How desperate was that expectant heart.",
                            guilt: "Guilt returned as anger. You can put down that heavy heart now.",
                            rejection: "The pain of rejection became anger. That wound is also a color.",
                            unfairness: "Injustice became anger. See that righteous heart.",
                            general: "'It's okay' is the warmest color in the world. You were waiting for that color."
                        },
                        pt: {
                            sadness: "'Est√° tudo bem' √© a cor mais quente do mundo. Voc√™ estava esperando por essa cor.",
                            loneliness: "A solid√£o √© a emo√ß√£o mais honesta. Essa transpar√™ncia √© bonita. Voc√™ n√£o precisa mais escond√™-la.",
                            fear: "O medo tamb√©m √© uma cor. Seu cora√ß√£o real aparece nesse tremor.",
                            love: "Voc√™ estava com raiva porque n√£o conseguiu expressar amor. Qu√£o profunda era essa cor do amor.",
                            protection: "O cora√ß√£o que quer proteger algu√©m se tornou raiva. Essa cor protetora tamb√©m √© bonita.",
                            helplessness: "O desamparo se transformou em raiva. Mesmo nesse desespero, voc√™ estava tentando encontrar luz.",
                            disappointment: "A decep√ß√£o usou a m√°scara da raiva. Qu√£o desesperado estava esse cora√ß√£o expectante.",
                            guilt: "A culpa voltou como raiva. Voc√™ pode largar esse cora√ß√£o pesado agora.",
                            rejection: "A dor da rejei√ß√£o se tornou raiva. Essa ferida tamb√©m √© uma cor.",
                            unfairness: "A injusti√ßa se tornou raiva. Veja esse cora√ß√£o justo.",
                            general: "'Est√° tudo bem' √© a cor mais quente do mundo. Voc√™ estava esperando por essa cor."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "üßò",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            sadness: "Í∑∏ ÎßêÏùÑ ÏßÄÍ∏à ÎÑà ÏûêÏã†ÏóêÍ≤å Ìï¥Ï§òÎèÑ Í¥úÏ∞ÆÏïÑ. 'Í¥úÏ∞ÆÏïÑ, Ïûò Î≤ÑÌÖºÏñ¥'ÎùºÍ≥†.",
                            loneliness: "Ïô∏Î°úÏõÄÏùÑ Ïù∏Ï†ïÌïòÎäî ÏàúÍ∞Ñ, ÏßÑÏßú Ïó∞Í≤∞Ïù¥ ÏãúÏûëÎèº. ÎÑàÎäî Îçî Ïù¥ÏÉÅ ÌòºÏûêÍ∞Ä ÏïÑÎãàÏïº.",
                            fear: "ÎëêÎ†§ÏõÄÏùÑ ÎßàÏ£ºÌïòÎäî Í≤É ÏûêÏ≤¥Í∞Ä Ïö©Í∏∞Ïïº. Í∑∏ Îñ®Î¶ºÎèÑ ÏÇ∂Ïùò ÏùºÎ∂ÄÏïº.",
                            love: "ÏÇ¨ÎûëÏùÄ ÌëúÌòÑÎêòÏßÄ ÏïäÏïÑÎèÑ Ï°¥Ïû¨Ìï¥. Í∑∏ ÎßàÏùå ÏûêÏ≤¥Î°ú Ï∂©Î∂ÑÌï¥.",
                            protection: "ÏûêÏã†ÏùÑ Ìù¨ÏÉùÌï¥ÏÑú Îã§Î•∏ Ïù¥Î•º ÏßÄÌÇ§Î†§ ÌñàÍµ¨ÎÇò. Ïù¥Ï†úÎäî ÎÑàÎèÑ Î≥¥Ìò∏Î∞õÏùÑ ÎïåÏïº.",
                            helplessness: "Î¨¥Î†•Í∞êÎèÑ ÌïòÎÇòÏùò ÏßÑÏã§Ïù¥Ïïº. Í∑∏Í±∏ Î∞õÏïÑÎì§Ïù¥Îäî Í≤å ÏπòÏú†Ïùò ÏãúÏûëÏù¥Ïïº.",
                            disappointment: "Í∏∞ÎåÄÍ∞Ä ÏûàÏóàÍ∏∞Ïóê Ïã§ÎßùÎèÑ ÏûàÏóàÏñ¥. Í∑∏ Í∏∞ÎåÄ ÏûêÏ≤¥Í∞Ä ÏÇ¨ÎûëÏù¥ÏóàÏñ¥.",
                            guilt: "Ï£ÑÏ±ÖÍ∞êÏùÄ ÎÑ§Í∞Ä ÏÑ†Ìïú ÏÇ¨ÎûåÏù¥ÎùºÎäî Ï¶ùÍ±∞Ïïº. ÌïòÏßÄÎßå Ïù¥Ï†ú ÏûêÏú†Î°úÏõåÏ†∏ÎèÑ Îèº.",
                            rejection: "Í±∞Ï†àÏùÄ ÎÑ§ Í∞ÄÏπòÎ•º Í≤∞Ï†ïÌïòÏßÄ ÏïäÏïÑ. ÎÑàÎäî Ïó¨Ï†ÑÌûà ÏÜåÏ§ëÌï¥.",
                            unfairness: "ÏñµÏö∏Ìï®ÏùÄ Ï†ïÏùòÍ∞êÏùò ÌëúÌòÑÏù¥Ïïº. Í∑∏ ÎßàÏùåÏùÑ ÏÜåÏ§ëÌûà Ïó¨Í≤®.",
                            general: "Í∑∏ ÎßêÏùÑ ÏßÄÍ∏à ÎÑà ÏûêÏã†ÏóêÍ≤å Ìï¥Ï§òÎèÑ Í¥úÏ∞ÆÏïÑ. 'Í¥úÏ∞ÆÏïÑ, Ïûò Î≤ÑÌÖºÏñ¥'ÎùºÍ≥†."
                        },
                        en: {
                            sadness: "It's okay to say those words to yourself now. 'It's okay, you endured well.'",
                            loneliness: "The moment you acknowledge loneliness, real connection begins. You're not alone anymore.",
                            fear: "Facing fear itself is courage. That trembling is also part of life.",
                            love: "Love exists even when not expressed. That heart itself is enough.",
                            protection: "You tried to protect others by sacrificing yourself. Now it's time for you to be protected too.",
                            helplessness: "Helplessness is also a truth. Accepting it is the beginning of healing.",
                            disappointment: "There was disappointment because there was expectation. That expectation itself was love.",
                            guilt: "Guilt is proof that you're a good person. But now you can be free.",
                            rejection: "Rejection doesn't determine your worth. You're still precious.",
                            unfairness: "Injustice is an expression of sense of justice. Cherish that heart.",
                            general: "It's okay to say those words to yourself now. 'It's okay, you endured well.'"
                        },
                        pt: {
                            sadness: "Est√° tudo bem dizer essas palavras para si mesmo agora. 'Est√° tudo bem, voc√™ resistiu bem.'",
                            loneliness: "No momento em que voc√™ reconhece a solid√£o, a conex√£o real come√ßa. Voc√™ n√£o est√° mais sozinho.",
                            fear: "Enfrentar o medo em si √© coragem. Esse tremor tamb√©m √© parte da vida.",
                            love: "O amor existe mesmo quando n√£o √© expresso. Esse cora√ß√£o em si √© suficiente.",
                            protection: "Voc√™ tentou proteger outros sacrificando a si mesmo. Agora √© hora de voc√™ ser protegido tamb√©m.",
                            helplessness: "O desamparo tamb√©m √© uma verdade. Aceit√°-lo √© o in√≠cio da cura.",
                            disappointment: "Houve decep√ß√£o porque houve expectativa. Essa expectativa em si era amor.",
                            guilt: "A culpa √© prova de que voc√™ √© uma boa pessoa. Mas agora voc√™ pode ser livre.",
                            rejection: "A rejei√ß√£o n√£o determina seu valor. Voc√™ ainda √© precioso.",
                            unfairness: "A injusti√ßa √© uma express√£o do senso de justi√ßa. Valorize esse cora√ß√£o.",
                            general: "Est√° tudo bem dizer essas palavras para si mesmo agora. 'Est√° tudo bem, voc√™ resistiu bem.'"
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Kael", emoji: "üßô",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            sadness: "Ïù¥Ìï¥Î∞õÍ≥† Ïã∂Îã§Îäî ÎßàÏùåÏùÄ Ïù∏Í∞ÑÏùò Î≥∏Îä•Ïù¥Ïïº. Í∑∏Í±∏ ÎßêÌïú ÎÑàÎäî Îçî Ïù¥ÏÉÅ Ïà®Ïñ¥ÏûàÏßÄ ÏïäÏïÑ.",
                            loneliness: "Ïô∏Î°úÏõÄÏùÑ ÎßêÌïòÎäî ÏàúÍ∞Ñ, Í∑∏Í±¥ Îçî Ïù¥ÏÉÅ Ïô∏Î°úÏõÄÏù¥ ÏïÑÎãàÏïº. Ïó∞Í≤∞Ïùò ÏãúÏûëÏù¥ÏßÄ.",
                            fear: "ÎëêÎ†§ÏõÄÏùÑ Ïù∏Ï†ïÌïòÎäî Í±¥ ÏßÄÌòúÏïº. Í∑∏ ÏïàÏóêÏÑú ÏßÑÏßú ÌûòÏùÑ Ï∞æÏùÑ Ïàò ÏûàÏñ¥.",
                            love: "ÏÇ¨ÎûëÏùÄ Í∞ÄÏû• Í∞ïÌïú ÎßàÎ≤ïÏù¥Ïïº. Í∑∏Í±∏ ÎäêÍºàÎã§Îäî Í≤ÉÎßåÏúºÎ°úÎèÑ Ï∂ïÎ≥µÏù¥Ïïº.",
                            protection: "Î≥¥Ìò∏Ïùò ÎßàÏùåÏùÄ Í∞ÄÏû• Í≥†Í∑ÄÌïú Í∞êÏ†ïÏù¥Ïïº. Í∑∏ Ìù¨ÏÉùÎèÑ ÏÇ¨ÎûëÏùò ÌòïÌÉúÏòÄÏñ¥.",
                            helplessness: "Î¨¥Î†•Í∞êÏùÑ ÎßàÏ£ºÌïòÎäî Í±¥ Ïö©Í∏∞Ïïº. Í∑∏ ÏàúÍ∞ÑÎ∂ÄÌÑ∞ ÏßÑÏßú Î≥ÄÌôîÍ∞Ä ÏãúÏûëÎèº.",
                            disappointment: "Ïã§ÎßùÎèÑ ÏÑ±Ïû•Ïùò ÏùºÎ∂ÄÏïº. Í∑∏ Í≤ΩÌóòÏù¥ ÎÑàÎ•º Îçî ÍπäÍ≤å ÎßåÎì§Ïñ¥.",
                            guilt: "Ï£ÑÏ±ÖÍ∞êÏùÄ ÏñëÏã¨Ïùò Ï¶ùÍ±∞Ïïº. ÌïòÏßÄÎßå Í∑∏Í≤ÉÏù¥ ÎÑàÎ•º Í∞ÄÎëêÏßÄÎäî ÏïäÏïÑ.",
                            rejection: "Í±∞Ï†àÏùÄ ÎïåÎ°ú ÏÉàÎ°úÏö¥ Í∏∏ÏùÑ Ïó¨Îäî Î¨∏Ïù¥Ïïº. Îã§Î•∏ Í∞ÄÎä•ÏÑ±ÏùÑ Î¥ê.",
                            unfairness: "Î∂àÏùòÏóê ÎßûÏÑúÎäî ÎßàÏùåÏùÄ Ï†ïÏùòÎ°úÏö¥ ÏòÅÌòºÏùò Ï¶ùÍ±∞Ïïº. Í∑∏ Î∂ÑÎÖ∏Îäî Ï†ïÎãπÌï¥.",
                            general: "Ïù¥Ìï¥Î∞õÍ≥† Ïã∂Îã§Îäî ÎßàÏùåÏùÄ Ïù∏Í∞ÑÏùò Î≥∏Îä•Ïù¥Ïïº. Í∑∏Í±∏ ÎßêÌïú ÎÑàÎäî Îçî Ïù¥ÏÉÅ Ïà®Ïñ¥ÏûàÏßÄ ÏïäÏïÑ."
                        },
                        en: {
                            sadness: "The desire to be understood is human instinct. Having said that, you're no longer hiding.",
                            loneliness: "The moment you speak of loneliness, it's no longer loneliness. It's the beginning of connection.",
                            fear: "Acknowledging fear is wisdom. You can find real strength within it.",
                            love: "Love is the strongest magic. Just feeling it is a blessing.",
                            protection: "The heart of protection is the most noble emotion. That sacrifice was also a form of love.",
                            helplessness: "Facing helplessness is courage. Real change begins from that moment.",
                            disappointment: "Disappointment is also part of growth. That experience makes you deeper.",
                            guilt: "Guilt is proof of conscience. But it doesn't imprison you.",
                            rejection: "Rejection sometimes opens doors to new paths. See other possibilities.",
                            unfairness: "The heart that confronts injustice is proof of a righteous soul. That anger is justified.",
                            general: "The desire to be understood is human instinct. Having said that, you're no longer hiding."
                        },
                        pt: {
                            sadness: "O desejo de ser compreendido √© instinto humano. Tendo dito isso, voc√™ n√£o est√° mais se escondendo.",
                            loneliness: "No momento em que voc√™ fala de solid√£o, n√£o √© mais solid√£o. √â o in√≠cio da conex√£o.",
                            fear: "Reconhecer o medo √© sabedoria. Voc√™ pode encontrar for√ßa real dentro dele.",
                            love: "O amor √© a magia mais forte. Apenas senti-lo √© uma b√™n√ß√£o.",
                            protection: "O cora√ß√£o da prote√ß√£o √© a emo√ß√£o mais nobre. Esse sacrif√≠cio tamb√©m era uma forma de amor.",
                            helplessness: "Enfrentar o desamparo √© coragem. A mudan√ßa real come√ßa desse momento.",
                            disappointment: "A decep√ß√£o tamb√©m √© parte do crescimento. Essa experi√™ncia te torna mais profundo.",
                            guilt: "A culpa √© prova de consci√™ncia. Mas ela n√£o te aprisiona.",
                            rejection: "A rejei√ß√£o √†s vezes abre portas para novos caminhos. Veja outras possibilidades.",
                            unfairness: "O cora√ß√£o que confronta a injusti√ßa √© prova de uma alma justa. Essa raiva √© justificada.",
                            general: "O desejo de ser compreendido √© instinto humano. Tendo dito isso, voc√™ n√£o est√° mais se escondendo."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse1 = '';
        let userResponse2 = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let currentStep = 1; // 1: Ï≤´Î≤àÏß∏ ÏßàÎ¨∏, 2: ÎëêÎ≤àÏß∏ ÏßàÎ¨∏
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'secondQuestionSection', 'userInputSection2',
                'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userInputSection2' ||
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('secondQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse1 = '';
            userResponse2 = '';
            currentTypingElement = null;
            currentStep = 1;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 04Í∞Ä Í≥ß Ï§ÄÎπÑÎê©ÎãàÎã§. Ïû†Í≤® ÏûàÎçò Ï∞ΩÎ¨∏ÏùÑ Ïó¨Îäî Ïó¨Ï†ïÏù¥ Ïù¥Ïñ¥ÏßëÎãàÎã§!' :
                    currentLanguage === 'en' ? 
                    'Portal 04 will be ready soon. The journey to open locked windows will continue!' :
                    'Portal 04 estar√° pronto em breve. A jornada para abrir janelas trancadas continuar√°!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 03ÏùÑ Ï≤òÏùåÎ∂ÄÌÑ∞ Îã§Ïãú ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 03 from the beginning?' :
                    'Deseja reiniciar o Portal 03 desde o in√≠cio?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            if (currentStep === 1) {
                userResponse1 = inputText;
                
                // Firebase Ï†ÄÏû• ÏãúÎèÑ - Ï≤´ Î≤àÏß∏ ÏùëÎãµ
                if (firebaseInitialized && db) {
                    try {
                        await db.collection("temarix_v3_respostas").add({
                            uid: memoryStorage.mockUser.uid,
                            email: memoryStorage.mockUser.email,
                            portal: "v3-03",
                            pergunta: "primeira",
                            resposta: inputText,
                            data: firebase.firestore.Timestamp.now(),
                            idioma: currentLanguage
                        });
                        console.log('Ï≤´ Î≤àÏß∏ ÏùëÎãµÏù¥ FirestoreÏóê Ï†ÄÏû•Îê®');
                    } catch (error) {
                        console.error('Firestore Ï†ÄÏû• Ïò§Î•ò:', error);
                    }
                } else {
                    console.log('Firebase ÏÇ¨Ïö© Î∂àÍ∞Ä, Î°úÏª¨Ïóê Ï†ÄÏû•:', inputText);
                    localStorage.setItem('temarix_v3_response_1', JSON.stringify({
                        portal: "v3-03",
                        pergunta: "primeira",
                        resposta: inputText,
                        data: new Date().toISOString(),
                        idioma: currentLanguage
                    }));
                }
                
                disableUserInput();
                showUserResponse(inputText, 1);
                
                setTimeout(() => {
                    showSecondQuestion();
                }, 1000);
                
            } else if (currentStep === 2) {
                userResponse2 = inputText;
                
                // Firebase Ï†ÄÏû• ÏãúÎèÑ - Îëê Î≤àÏß∏ ÏùëÎãµ
                if (firebaseInitialized && db) {
                    try {
                        await db.collection("temarix_v3_respostas").add({
                            uid: memoryStorage.mockUser.uid,
                            email: memoryStorage.mockUser.email,
                            portal: "v3-03",
                            pergunta: "segunda",
                            resposta: inputText,
                            data: firebase.firestore.Timestamp.now(),
                            idioma: currentLanguage
                        });
                        console.log('Îëê Î≤àÏß∏ ÏùëÎãµÏù¥ FirestoreÏóê Ï†ÄÏû•Îê®');
                    } catch (error) {
                        console.error('Firestore Ï†ÄÏû• Ïò§Î•ò:', error);
                    }
                } else {
                    console.log('Firebase ÏÇ¨Ïö© Î∂àÍ∞Ä, Î°úÏª¨Ïóê Ï†ÄÏû•:', inputText);
                    localStorage.setItem('temarix_v3_response_2', JSON.stringify({
                        portal: "v3-03",
                        pergunta: "segunda",
                        resposta: inputText,
                        data: new Date().toISOString(),
                        idioma: currentLanguage
                    }));
                }
                
                disableUserInput();
                showUserResponse(inputText, 2);
                
                setTimeout(() => {
                    showUserReactions();
                }, 1000);
            }
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput(step) {
            currentStep = step;
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            
            if (step === 1) {
                userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            } else {
                userTextarea.placeholder = translations[currentLanguage].inputPlaceholder2;
            }
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text, step) {
            const inputSection = step === 1 ? 
                document.getElementById('userInputSection') : 
                document.getElementById('userInputSection2');
            
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions() {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            // Îëê ÏùëÎãµÏùÑ Í≤∞Ìï©Ìï¥ÏÑú Î∂ÑÏÑù
            const combinedInput = userResponse1 + ' ' + userResponse2;
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(combinedInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('=== Temarix V3 Portal 03 Ï¥àÍ∏∞Ìôî ÏãúÏûë ===');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showFirstQuestion();
            }, 2000);
        }
        
        async function showFirstQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput(1);
            }, 1500);
        }
        
        async function showSecondQuestion() {
            const questionSection = document.getElementById('secondQuestionSection');
            const questionEl = document.getElementById('secondQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].secondQuestion, 50);
            
            setTimeout(() => {
                enableUserInput(2);
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 03 DOM Î°úÎìú ÏôÑÎ£å');
            
            // Firebase Ï¥àÍ∏∞Ìôî
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>