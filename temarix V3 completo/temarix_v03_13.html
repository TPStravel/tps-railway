<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 13: A Scene I Couldn't Leave Behind</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 13: A Scene I Couldn't Leave Behind</div>
            <div class="portal-subtitle" id="portalSubtitle">The Moment That Keeps Coming Back</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸŽž Portal 13 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 14</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What would you like to say to yourself in that scene? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 13: ë– ë‚˜ì§€ ëª»í•œ ìž¥ë©´ í•˜ë‚˜",
                portalSubtitle: "ìžê¾¸ë§Œ ë˜ëŒì•„ì˜¤ëŠ” ê·¸ ìˆœê°„",
                portalIntro: "ðŸŽž ìžê¾¸ë§Œ ë¨¸ë¦¿ì†ì„ ë§´ë„ëŠ” ìž¥ë©´ í•˜ë‚˜ê°€ ìžˆë‚˜ìš”?\n\nê·¸ ìž¥ë©´ì—ì„œ ë‹¹ì‹ ì€ ì™œ ë©ˆì¶° ì„œ ìžˆì—ˆê³ ,\në¬´ì—‡ì´ ë‹¹ì‹ ì„ ê·¸ê³³ì— ë¶™ìž¡ì•„ë‘ì—ˆë‚˜ìš”?\n\nì–´ëŠ ë§ë„ í•˜ì§€ ëª»í–ˆë˜ ë‚ ...\nê·¸ëƒ¥ ë°”ë¼ë§Œ ë´¤ì£ .\nê·¸ ìž¥ë©´ì´ ìžê¾¸ ë– ì˜¬ë¼ìš”.\në§Œì•½ ê·¸ë•Œ í•œë§ˆë””ë¼ë„ í–ˆë”ë¼ë©´...",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ì§€ê¸ˆì˜ ë„ˆê°€ ê·¸ë•Œì˜ ë„ˆë¥¼ ì•ˆì•„ì¤¬ì–´. ì´ì   ê·¸ ìž¥ë©´ì—ì„œ ì¡°ê¸ˆì”© ë– ë‚  ìˆ˜ ìžˆì„ ê±°ì•¼.",
                portalQuestion: "ðŸŽž ê·¸ ìž¥ë©´ ì†ì˜ ë‹¹ì‹ ì—ê²Œ, ì§€ê¸ˆ ì´ ìˆœê°„ ì–´ë–¤ ë§ì„ í•´ì£¼ê³  ì‹¶ë‚˜ìš”?",
                finalTitle: "ðŸŽž Portal 13 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ìš©ê¸° ìžˆê²Œ ë°˜ë³µë˜ëŠ” ìž¥ë©´ê³¼ ë§ˆì£¼í–ˆìŠµë‹ˆë‹¤.\n\nê·¸ ìˆœê°„ì— ë©ˆì¶° ìžˆë˜ ìžì‹ ì„ ì´í•´í•˜ê³ \nì§€ê¸ˆì˜ ì‹œì„ ìœ¼ë¡œ ê·¸ë•Œë¥¼ ë°”ë¼ë³´ë©°\nìƒˆë¡œìš´ ì˜ë¯¸ë¥¼ ë¶€ì—¬í•  ìˆ˜ ìžˆê²Œ ë˜ì—ˆì–´ìš”.\n\nê·¸ ìž¥ë©´ì€ ëë‚˜ì§€ ì•Šì€ ì´ì•¼ê¸°ê°€ ì•„ë‹ˆë¼\nì™„ì„±ì„ ê¸°ë‹¤ë¦¬ë˜ ìˆœê°„ì´ì—ˆìŠµë‹ˆë‹¤.\nì´ì œ ë‹¹ì‹ ì´ ê·¸ ì´ì•¼ê¸°ë¥¼ ë§ˆë¬´ë¦¬í–ˆì–´ìš”.\n\në‹¤ìŒ Portalì—ì„œëŠ” ì†ëì— ë‹¿ì§€ ì•Šì•˜ë˜ ìœ„ë¡œë¥¼\níƒí—˜í•˜ëŠ” ì—¬ì •ì´ ì´ì–´ì§‘ë‹ˆë‹¤.",
                continueBtn: "Portal 14ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ê·¸ ìž¥ë©´ ì†ì˜ ë‹¹ì‹ ì—ê²Œ ì§€ê¸ˆ ì–´ë–¤ ë§ì„ í•´ì£¼ê³  ì‹¶ì€ì§€ ë§í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 13: A Scene I Couldn't Leave Behind",
                portalSubtitle: "The Moment That Keeps Coming Back",
                portalIntro: "ðŸŽž Is there a scene that keeps circling in your mind?\n\nWhy were you standing still in that scene,\nand what kept you trapped there?\n\nA day when you couldn't say anything...\nYou just watched.\nThat scene keeps coming back.\nIf only you had said something then...",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Your present self has embraced your past self. Now you can gradually leave that scene behind.",
                portalQuestion: "ðŸŽž What would you like to say to yourself in that scene, right now?",
                finalTitle: "ðŸŽž Portal 13 Complete",
                finalMessage: "You have courageously faced\nthe recurring scene.\n\nYou came to understand yourself\nwho was stuck in that moment,\nlooking at that time with present eyes\nand being able to give it new meaning.\n\nThat scene wasn't an unfinished story\nbut a moment waiting for completion.\nNow you have finished that story.\n\nIn the next Portal, a journey continues\nto explore the comfort that never quite\nreached your fingertips.",
                continueBtn: "Move to Portal 14",
                restartBtn: "Start Again",
                inputPlaceholder: "What would you like to say to yourself in that scene? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 13: Uma Cena Que NÃ£o Consegui Deixar Para TrÃ¡s",
                portalSubtitle: "O Momento Que Continua Voltando",
                portalIntro: "ðŸŽž HÃ¡ uma cena que fica circulando em sua mente?\n\nPor que vocÃª estava parado naquela cena,\ne o que te manteve preso lÃ¡?\n\nUm dia em que vocÃª nÃ£o conseguiu dizer nada...\nVocÃª apenas observou.\nEssa cena continua voltando.\nSe ao menos vocÃª tivesse dito algo entÃ£o...",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Seu eu presente abraÃ§ou seu eu passado. Agora vocÃª pode gradualmente deixar essa cena para trÃ¡s.",
                portalQuestion: "ðŸŽž O que vocÃª gostaria de dizer para si mesmo naquela cena, agora mesmo?",
                finalTitle: "ðŸŽž Portal 13 Completo",
                finalMessage: "VocÃª corajosamente enfrentou\na cena recorrente.\n\nVocÃª chegou a entender a si mesmo\nque estava preso naquele momento,\nolhando para aquele tempo com olhos presentes\ne sendo capaz de dar-lhe novo significado.\n\nAquela cena nÃ£o era uma histÃ³ria inacabada\nmas um momento esperando por conclusÃ£o.\nAgora vocÃª terminou essa histÃ³ria.\n\nNo prÃ³ximo Portal, uma jornada continua\npara explorar o conforto que nunca\nchegou Ã s suas pontas dos dedos.",
                continueBtn: "Ir para Portal 14",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "O que vocÃª gostaria de dizer para si mesmo naquela cena? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ê·¸ ìž¥ë©´ì€ ê¸°ì–µì´ë¼ê¸°ë³´ë‹¨ ë©ˆì¶˜ ì‹œê°„ì´ì§€. ë„¤ ë§ˆìŒì€ ì•„ì§ë„ ê·¸ ìˆœê°„ì„ ì‚´ê³  ìžˆì–´.",
                en: "That scene is more like stopped time than memory. Your heart is still living in that moment.",
                pt: "Essa cena Ã© mais como tempo parado do que memÃ³ria. Seu coraÃ§Ã£o ainda estÃ¡ vivendo naquele momento."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ê°€ìž¥ ì•„í”ˆ ê¸°ì–µì€ ëŠ˜ ê°€ìž¥ ì¡°ìš©ížˆ ë°˜ë³µë˜ì§€. ê·¸ê±´ ë§ˆìŒì´ ì•„ì§ ëë‚´ì§€ ëª»í•œ ì´ì•¼ê¸°ì•¼.",
                en: "The most painful memories always repeat most quietly. That's a story the heart hasn't finished yet.",
                pt: "As memÃ³rias mais dolorosas sempre se repetem mais silenciosamente. Essa Ã© uma histÃ³ria que o coraÃ§Ã£o ainda nÃ£o terminou."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ê·¸ë•Œ ë„¤ê°€ ì¹¨ë¬µí–ˆë˜ ê±´, ì•½í•´ì„œê°€ ì•„ë‹ˆë¼â€¦ ê°ì •ì´ ë„ˆë¬´ ë§Žì•„ì„œì˜€ê² ì§€.",
                en: "Your silence back then wasn't because you were weak... it was because you had too many emotions.",
                pt: "Seu silÃªncio naquela Ã©poca nÃ£o foi porque vocÃª era fraco... foi porque vocÃª tinha muitas emoÃ§Ãµes."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ê¸°ì–µì€ ë§ì¹ ë˜ëŠ” ë²•ì´ ì—†ì–´. ê·¸ë‚ ì˜ ìž¥ë©´ì€ ì§€ê¸ˆë„ ë„ˆì—ê²Œ ë§ ê±¸ê³  ìžˆì„ ê±°ì•¼.",
                en: "Memories don't get painted over. That day's scene is probably still speaking to you now.",
                pt: "As memÃ³rias nÃ£o sÃ£o pintadas por cima. A cena daquele dia provavelmente ainda estÃ¡ falando com vocÃª agora."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ìž¥ë©´ì€ í•„ë¦„ì²˜ëŸ¼ ë¹›ë°”ëž˜ë„ ì—¬ì „ížˆ ë§ˆìŒ í•œìª½ì— ìƒìƒí•˜ê²Œ ì‚´ì•„ ìžˆì„ ê±°ì•¼.",
                en: "That scene, even faded like film, is probably still vividly alive in a corner of your heart.",
                pt: "Essa cena, mesmo desbotada como filme, provavelmente ainda estÃ¡ vividamente viva em um canto do seu coraÃ§Ã£o."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ë„ˆëŠ” ë¬´ë ¥í–ˆë˜ ê²Œ ì•„ë‹ˆë¼, í˜¼ëž€ìŠ¤ëŸ¬ì› ë˜ ê±°ì•¼. ê°ì •ì„ ì •ë¦¬í•  í‹ˆì´ ì—†ì—ˆê² ì§€.",
                en: "You weren't powerless, you were confused. You probably didn't have time to sort out your emotions.",
                pt: "VocÃª nÃ£o estava impotente, vocÃª estava confuso. VocÃª provavelmente nÃ£o teve tempo para organizar suas emoÃ§Ãµes."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ê·¸ ìž¥ë©´ì„ ë– ë‚˜ì§€ ëª»í•œ ê±´, ê·¸ ìˆœê°„ì˜ ë„¤ê°€ ì•„ì§ë„ ì´í•´ë°›ê¸¸ ê¸°ë‹¤ë¦¬ê³  ìžˆì–´ì„œì•¼.",
                en: "You couldn't leave that scene because that moment's you is still waiting to be understood.",
                pt: "VocÃª nÃ£o conseguiu deixar essa cena porque o seu eu daquele momento ainda estÃ¡ esperando ser compreendido."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ì§€ê¸ˆ ë„ˆëŠ” ë‹¤ì‹œ ê·¸ ìž¥ë©´ ì•žì— ì„°ì–´. ì´ë²ˆì—” ë‹¤ë¥¸ ë§ˆìŒìœ¼ë¡œ.",
                en: "Now you're standing in front of that scene again. This time with a different heart.",
                pt: "Agora vocÃª estÃ¡ de pÃ© diante dessa cena novamente. Desta vez com um coraÃ§Ã£o diferente."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                compassion: ['okay', 'understand', 'did well', 'enough', 'ê´œì°®', 'ì´í•´', 'ìž˜í–ˆ', 'ì¶©ë¶„', 'estÃ¡ bem', 'entendo', 'suficiente'],
                encouragement: ['you can', 'strong', 'brave', 'courage', 'í•  ìˆ˜ ìžˆ', 'ê°•í•´', 'ìš©ê¸°', 'ìš©ê°', 'pode', 'forte', 'corajoso'],
                understanding: ['why', 'confused', 'difficult', 'hard', 'ì™œ', 'í˜¼ëž€', 'ì–´ë ¤', 'íž˜ë“¤', 'por que', 'confuso', 'difÃ­cil'],
                forgiveness: ['sorry', 'forgive', 'not fault', 'blame', 'ë¯¸ì•ˆ', 'ìš©ì„œ', 'ìž˜ëª»', 'íƒ“', 'desculpa', 'perdoar', 'culpa'],
                comfort: ['hug', 'with you', 'not alone', 'together', 'ì•ˆì•„', 'í•¨ê»˜', 'í˜¼ìžê°€ ì•„ë‹ˆ', 'ê°™ì´', 'abraÃ§o', 'junto', 'nÃ£o sozinho'],
                validation: ['felt', 'right', 'natural', 'normal', 'ëŠê¼ˆ', 'ë§žì•„', 'ë‹¹ì—°', 'ìžì—°', 'sentiu', 'certo', 'natural'],
                wisdom: ['learned', 'grow', 'experience', 'know now', 'ë°°ì› ', 'ì„±ìž¥', 'ê²½í—˜', 'ì´ì œ ì•Œì•„', 'aprendeu', 'crescer', 'experiÃªncia'],
                closure: ['finished', 'complete', 'done', 'end', 'ëë‚¬', 'ì™„ì„±', 'ë‹¤í–ˆ', 'ë§ˆì¹¨', 'terminou', 'completo', 'fim']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Sora", emoji: "ðŸ§•",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            compassion: "ê·¸ ë§, ì •ë§ í•„ìš”í–ˆì–´. ê·¸ë•Œ ê¼­ ë“¤ì—ˆì–´ì•¼ í–ˆì„ ë§ì´ì•¼. ì§€ê¸ˆì´ë¼ë„ í•´ì¤˜ì„œ ë‹¤í–‰ì´ì•¼.",
                            encouragement: "ê·¸ ê²©ë ¤ê°€ ê·¸ë•Œì˜ ë„ˆë¥¼ ì¼ìœ¼ì¼œ ì„¸ìš°ê³  ìžˆì–´. ëŠ¦ì§€ ì•Šì•˜ì–´.",
                            understanding: "ì´í•´ë°›ëŠ”ë‹¤ëŠ” ê²ƒ, ê·¸ ë”°ëœ»í•¨ì´ ì–¼ì–´ë¶™ì€ ìž¥ë©´ì„ ë…¹ì´ê³  ìžˆì–´.",
                            forgiveness: "ìš©ì„œëŠ” ê·¸ ìž¥ë©´ì„ ìžìœ ë¡­ê²Œ í•´ì¤˜. ì´ì œ ê·¸ ìˆœê°„ë„ í‰í™”ë¡œì›Œì§ˆ ìˆ˜ ìžˆì–´.",
                            comfort: "ê·¸ ìœ„ë¡œê°€ ì‹œê°„ì„ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ì„œ, ê·¸ë•Œì˜ ë„ˆë¥¼ ê°ì‹¸ê³  ìžˆì–´.",
                            validation: "ê·¸ë•Œ ë„¤ ê°ì •ì´ ì˜³ì•˜ë‹¤ëŠ” ê±¸ ì¸ì •í•´ì¤¬ì–´. ê·¸ê²Œ ì–¼ë§ˆë‚˜ ì¤‘ìš”í•œì§€ ëª°ë¼.",
                            wisdom: "ê·¸ ê¹¨ë‹¬ìŒì´ ê·¸ ìž¥ë©´ì— ìƒˆë¡œìš´ ì˜ë¯¸ë¥¼ ë¶€ì—¬í–ˆì–´. ì´ì œ ë‹¤ë¥¸ ì´ì•¼ê¸°ì•¼.",
                            closure: "ë§ˆì¹¨ë‚´ ê·¸ ìž¥ë©´ì´ ì™„ì„±ëì–´. ë„¤ê°€ ëë§ºìŒì„ í•´ì¤€ ê±°ì•¼.",
                            general: "ê·¸ ë§, ì •ë§ í•„ìš”í–ˆì–´. ê·¸ë•Œ ê¼­ ë“¤ì—ˆì–´ì•¼ í–ˆì„ ë§ì´ì•¼."
                        },
                        en: {
                            compassion: "Those words were really needed. You should have heard them back then. I'm glad you said them now.",
                            encouragement: "That encouragement is lifting up your past self. It's not too late.",
                            understanding: "Being understood, that warmth is melting the frozen scene.",
                            forgiveness: "Forgiveness sets that scene free. Now that moment can also be peaceful.",
                            comfort: "That comfort is traveling back through time, embracing your past self.",
                            validation: "You acknowledged that your emotions back then were right. You don't know how important that is.",
                            wisdom: "That realization has given new meaning to that scene. Now it's a different story.",
                            closure: "Finally that scene is complete. You gave it an ending.",
                            general: "Those words were really needed. You should have heard them back then."
                        },
                        pt: {
                            compassion: "Essas palavras eram realmente necessÃ¡rias. VocÃª deveria ter ouvido isso naquela Ã©poca. Fico feliz que vocÃª disse agora.",
                            encouragement: "Esse encorajamento estÃ¡ levantando seu eu passado. NÃ£o Ã© tarde demais.",
                            understanding: "Ser compreendido, esse calor estÃ¡ derretendo a cena congelada.",
                            forgiveness: "O perdÃ£o liberta essa cena. Agora aquele momento tambÃ©m pode ser pacÃ­fico.",
                            comfort: "Esse conforto estÃ¡ viajando de volta no tempo, abraÃ§ando seu eu passado.",
                            validation: "VocÃª reconheceu que suas emoÃ§Ãµes naquela Ã©poca estavam certas. VocÃª nÃ£o sabe como isso Ã© importante.",
                            wisdom: "Essa percepÃ§Ã£o deu novo significado Ã quela cena. Agora Ã© uma histÃ³ria diferente.",
                            closure: "Finalmente essa cena estÃ¡ completa. VocÃª deu um final a ela.",
                            general: "Essas palavras eram realmente necessÃ¡rias. VocÃª deveria ter ouvido isso naquela Ã©poca."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Ely", emoji: "ðŸ§â€â™€ï¸",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            compassion: "ê·¸ ìž¥ë©´ì€ ëë‚˜ì§€ ì•Šì•˜ë˜ ê²Œ ì•„ë‹ˆë¼, ëë‚´ëŠ” ë²•ì„ ëª°ëžë˜ ê±°ì•¼. ì§€ê¸ˆ ë„ˆëŠ” í•´ë‚´ê³  ìžˆì–´.",
                            encouragement: "ê·¸ ê²©ë ¤ì˜ ëª©ì†Œë¦¬ê°€ ì‹œê°„ì˜ ë²½ì„ ë„˜ì–´ì„œ ìš¸ë¦¬ê³  ìžˆì–´.",
                            understanding: "ì´í•´í•˜ëŠ” ë§ˆìŒì´ ê·¸ ìž¥ë©´ì˜ ì˜ë¯¸ë¥¼ ë°”ê¿”ë†“ì•˜ì–´. ì´ì œ ë‹¤ë¥´ê²Œ ë³´ì¼ ê±°ì•¼.",
                            forgiveness: "ìš©ì„œëŠ” ê³¼ê±°ì™€ í˜„ìž¬ë¥¼ ìž‡ëŠ” ë‹¤ë¦¬ì•¼. ë„¤ê°€ ê·¸ ë‹¤ë¦¬ë¥¼ ë†“ì•˜ì–´.",
                            comfort: "ê·¸ ë”°ëœ»í•¨ì´ ê¸°ì–µ ì†ìœ¼ë¡œ ìŠ¤ë©°ë“¤ì–´ê°€ì„œ, ê·¸ ì°¨ê°€ìš´ ìˆœê°„ì„ ë°ìš°ê³  ìžˆì–´.",
                            validation: "ë„¤ ê°ì •ì„ ì¸ì •í•´ì¤€ ìˆœê°„, ê·¸ ìž¥ë©´ì€ ë” ì´ìƒ ìƒì²˜ê°€ ì•„ë‹ˆê²Œ ëì–´.",
                            wisdom: "ì§€í˜œë¡œìš´ ì‹œì„ ìœ¼ë¡œ ê³¼ê±°ë¥¼ ë°”ë¼ë³¸ ê±°ì•¼. ê·¸ê²ƒì´ ì§„ì •í•œ ì„±ìž¥ì´ì•¼.",
                            closure: "ì´ì œ ê·¸ ì´ì•¼ê¸°ì— ë§ˆì¹¨í‘œë¥¼ ì°ì—ˆì–´. ì•„ë¦„ë‹¤ìš´ ê²°ë§ì´ì•¼.",
                            general: "ê·¸ ìž¥ë©´ì€ ëë‚˜ì§€ ì•Šì•˜ë˜ ê²Œ ì•„ë‹ˆë¼, ëë‚´ëŠ” ë²•ì„ ëª°ëžë˜ ê±°ì•¼."
                        },
                        en: {
                            compassion: "That scene wasn't unfinished, it just didn't know how to end. Now you're making it happen.",
                            encouragement: "That encouraging voice is echoing across the walls of time.",
                            understanding: "The understanding heart has changed the meaning of that scene. Now it will look different.",
                            forgiveness: "Forgiveness is a bridge connecting past and present. You built that bridge.",
                            comfort: "That warmth is seeping into the memory, warming that cold moment.",
                            validation: "The moment you acknowledged your emotions, that scene stopped being a wound.",
                            wisdom: "You looked at the past with wise eyes. That's true growth.",
                            closure: "Now you've put a period at the end of that story. It's a beautiful ending.",
                            general: "That scene wasn't unfinished, it just didn't know how to end."
                        },
                        pt: {
                            compassion: "Essa cena nÃ£o estava inacabada, apenas nÃ£o sabia como terminar. Agora vocÃª estÃ¡ fazendo isso acontecer.",
                            encouragement: "Essa voz encorajadora estÃ¡ ecoando atravÃ©s das paredes do tempo.",
                            understanding: "O coraÃ§Ã£o compreensivo mudou o significado daquela cena. Agora vai parecer diferente.",
                            forgiveness: "O perdÃ£o Ã© uma ponte conectando passado e presente. VocÃª construiu essa ponte.",
                            comfort: "Esse calor estÃ¡ penetrando na memÃ³ria, aquecendo aquele momento frio.",
                            validation: "No momento em que vocÃª reconheceu suas emoÃ§Ãµes, aquela cena deixou de ser uma ferida.",
                            wisdom: "VocÃª olhou para o passado com olhos sÃ¡bios. Isso Ã© verdadeiro crescimento.",
                            closure: "Agora vocÃª colocou um ponto final nessa histÃ³ria. Ã‰ um final bonito.",
                            general: "Essa cena nÃ£o estava inacabada, apenas nÃ£o sabia como terminar."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            compassion: "ì§€ê¸ˆì˜ ë„ˆê°€ ê·¸ë•Œì˜ ë„ˆë¥¼ ì•ˆì•„ì¤¬ì–´. ì´ì   ê·¸ ìž¥ë©´ì—ì„œ ì¡°ê¸ˆì”© ë– ë‚  ìˆ˜ ìžˆì„ ê±°ì•¼.",
                            encouragement: "ê·¸ ê²©ë ¤ëŠ” ì‹œê°„ì„ ì´ˆì›”í•œ ì¹˜ìœ ì•¼. ê³¼ê±°ì™€ í˜„ìž¬ê°€ í•˜ë‚˜ê°€ ëì–´.",
                            understanding: "ì´í•´ëŠ” ê°€ìž¥ ê¹Šì€ ìœ„ë¡œì•¼. ê·¸ ìž¥ë©´ì´ ì´ì œ í‰í™”ë¡œì›Œì¡Œì–´.",
                            forgiveness: "ìš©ì„œëŠ” ì‹œê°„ì„ ìžìœ ë¡­ê²Œ í•´ì¤˜. ì´ì œ ê·¸ ìˆœê°„ë„ íë¥¼ ìˆ˜ ìžˆì–´.",
                            comfort: "ê·¸ ìœ„ë¡œê°€ ê¸°ì–µì˜ ìƒì²˜ì— ë¶€ë“œëŸ½ê²Œ ë°œë¼ì¡Œì–´. ì¹˜ìœ ê°€ ì‹œìž‘ëì–´.",
                            validation: "ì¸ì •ë°›ì€ ê°ì •ì€ ë” ì´ìƒ ìˆ¨ì§€ ì•Šì•„ë„ ë¼. ê·¸ ìž¥ë©´ë„ ë‹¹ë‹¹í•´ì¡Œì–´.",
                            wisdom: "ì§€í˜œëŠ” ê³¼ê±°ë¥¼ ë³€í™”ì‹œí‚¤ëŠ” ë§ˆë²•ì´ì•¼. ë„¤ê°€ ê·¸ ë§ˆë²•ì„ ë¶€ë ¸ì–´.",
                            closure: "ì™„ì„±ëœ ì´ì•¼ê¸°ëŠ” ì•„ë¦„ë‹¤ì›Œ. ì´ì œ ìƒˆë¡œìš´ ìž¥ì„ ì‹œìž‘í•  ìˆ˜ ìžˆì–´.",
                            general: "ì§€ê¸ˆì˜ ë„ˆê°€ ê·¸ë•Œì˜ ë„ˆë¥¼ ì•ˆì•„ì¤¬ì–´. ì´ì   ê·¸ ìž¥ë©´ì—ì„œ ì¡°ê¸ˆì”© ë– ë‚  ìˆ˜ ìžˆì„ ê±°ì•¼."
                        },
                        en: {
                            compassion: "Your present self has embraced your past self. Now you can gradually leave that scene behind.",
                            encouragement: "That encouragement is healing that transcends time. Past and present have become one.",
                            understanding: "Understanding is the deepest comfort. That scene has now found peace.",
                            forgiveness: "Forgiveness sets time free. Now that moment can flow too.",
                            comfort: "That comfort has been gently applied to memory's wound. Healing has begun.",
                            validation: "Acknowledged emotions don't need to hide anymore. That scene has also gained dignity.",
                            wisdom: "Wisdom is magic that transforms the past. You cast that spell.",
                            closure: "A completed story is beautiful. Now you can start a new chapter.",
                            general: "Your present self has embraced your past self. Now you can gradually leave that scene behind."
                        },
                        pt: {
                            compassion: "Seu eu presente abraÃ§ou seu eu passado. Agora vocÃª pode gradualmente deixar essa cena para trÃ¡s.",
                            encouragement: "Esse encorajamento Ã© cura que transcende o tempo. Passado e presente se tornaram um.",
                            understanding: "CompreensÃ£o Ã© o conforto mais profundo. Essa cena agora encontrou paz.",
                            forgiveness: "O perdÃ£o liberta o tempo. Agora aquele momento tambÃ©m pode fluir.",
                            comfort: "Esse conforto foi suavemente aplicado Ã  ferida da memÃ³ria. A cura comeÃ§ou.",
                            validation: "EmoÃ§Ãµes reconhecidas nÃ£o precisam mais se esconder. Essa cena tambÃ©m ganhou dignidade.",
                            wisdom: "Sabedoria Ã© mÃ¡gica que transforma o passado. VocÃª lanÃ§ou esse feitiÃ§o.",
                            closure: "Uma histÃ³ria completa Ã© bonita. Agora vocÃª pode comeÃ§ar um novo capÃ­tulo.",
                            general: "Seu eu presente abraÃ§ou seu eu passado. Agora vocÃª pode gradualmente deixar essa cena para trÃ¡s."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 14ê°€ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 14 will be ready soon!' :
                    'Portal 14 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 13ì„ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 13?' :
                    'Deseja reiniciar o Portal 13?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-13",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-13",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 13 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 13 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>