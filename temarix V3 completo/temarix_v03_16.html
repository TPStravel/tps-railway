<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 16: The Path to Find Lost Emotions</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 16: The Path to Find Lost Emotions</div>
            <div class="portal-subtitle" id="portalSubtitle">The Search for What Was Once Mine</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸ§­ Portal 16 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 17</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What would you like to say to that lost emotion? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 16: ì‚¬ë¼ì§„ ê°ì •ì„ ì°¾ëŠ” ê¸¸",
                portalSubtitle: "í•œë•Œ ë‚´ ê²ƒì´ì—ˆë˜ ê²ƒë“¤ì˜ íƒìƒ‰",
                portalIntro: "ðŸ§­ ë‹¹ì‹ ì€ ì–¸ì  ê°€ ê°ì •ì„ ìžƒì–´ë²„ë¦° ê²ƒì²˜ëŸ¼ ëŠê»´ë³¸ ì  ìžˆë‚˜ìš”?\n\në¬´ì–¸ê°€ë¥¼ ëŠë¼ì§€ ëª»í•˜ê²Œ ëœ ìˆœê°„,\nê·¸ ê°ì •ì€ ì–´ë””ë¡œ ì‚¬ë¼ì¡Œë‹¤ê³  ìƒê°í•˜ë‚˜ìš”?\n\nì–´ëŠ ìˆœê°„ë¶€í„° ê·¸ëƒ¥ ë¬´ê°ê°í•´ì¡Œì–´ìš”.\nê¸°ì˜ì§€ë„, ìŠ¬í”„ì§€ë„ ì•Šì•˜ê³ â€¦\nì•„ë¬´ê²ƒë„ ëŠë¼ê³  ì‹¶ì§€ ì•Šì•˜ì–´ìš”.",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ê°ì •ì€ ì‚¬ë¼ì§€ì§€ ì•Šì•„. ìžƒì–´ë²„ë¦° ê²Œ ì•„ë‹ˆë¼â€¦ ë‹¤ì‹œ ì°¾ê³  ìžˆëŠ” ì¤‘ì´ì•¼.",
                portalQuestion: "ðŸ§­ ê·¸ ì‚¬ë¼ì¡Œë˜ ê°ì •ì—ê²Œ, ì§€ê¸ˆ ë‹¹ì‹ ì´ ë§í•˜ê³  ì‹¶ì€ í•œë§ˆë””ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
                finalTitle: "ðŸ§­ Portal 16 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ìžƒì–´ë²„ë ¸ë‹¤ê³  ìƒê°í–ˆë˜ ê°ì •ì„\në‹¤ì‹œ ì°¾ê¸° ì‹œìž‘í–ˆìŠµë‹ˆë‹¤.\n\nê°ì •ì€ ì‚¬ë¼ì§€ëŠ” ê²ƒì´ ì•„ë‹ˆë¼\në•Œë¡œëŠ” ìˆ¨ì–´ì„œ ê¸°ë‹¤ë¦¬ê³  ìžˆì„ ë¿ìž…ë‹ˆë‹¤.\në‹¹ì‹ ì´ ë‹¤ì‹œ ëŠë‚„ ì¤€ë¹„ê°€ ë  ë•Œê¹Œì§€ìš”.\n\nì´ì œ ë‹¹ì‹ ì€ ê·¸ ê°ì •ë“¤ì—ê²Œ\nëŒì•„ì™€ë„ ê´œì°®ë‹¤ê³  ë§í•´ì£¼ì—ˆì–´ìš”.\në§ˆìŒì˜ ë¬¸ì´ ë‹¤ì‹œ ì—´ë¦¬ê¸° ì‹œìž‘í–ˆìŠµë‹ˆë‹¤.\n\në‹¤ìŒ Portalì—ì„œëŠ” ë§ ì—†ëŠ” ì™¸ë¡œì›€ì„ íƒí—˜í•˜ëŠ”\nìƒˆë¡œìš´ ì—¬ì •ì´ ì´ì–´ì§‘ë‹ˆë‹¤.",
                continueBtn: "Portal 17ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ê·¸ ì‚¬ë¼ì§„ ê°ì •ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë§ì„ í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 16: The Path to Find Lost Emotions",
                portalSubtitle: "The Search for What Was Once Mine",
                portalIntro: "ðŸ§­ Have you ever felt like you lost your emotions?\n\nWhen you became unable to feel something,\nwhere do you think that emotion disappeared to?\n\nAt some point, I just became numb.\nI wasn't happy or sad...\nI didn't want to feel anything.",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Emotions don't disappear. You haven't lost them... you're in the process of finding them again.",
                portalQuestion: "ðŸ§­ What would you like to say to that lost emotion right now?",
                finalTitle: "ðŸ§­ Portal 16 Complete",
                finalMessage: "You have begun to find again\nthe emotions you thought you had lost.\n\nEmotions don't disappearâ€”\nsometimes they just hide and wait\nuntil you're ready to feel again.\n\nNow you have told those emotions\nthat it's okay for them to return.\nThe door of your heart has begun to open again.\n\nIn the next Portal, a new journey continues\nto explore the silent loneliness.",
                continueBtn: "Move to Portal 17",
                restartBtn: "Start Again",
                inputPlaceholder: "What would you like to say to that lost emotion? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 16: O Caminho para Encontrar EmoÃ§Ãµes Perdidas",
                portalSubtitle: "A Busca pelo Que Era Meu",
                portalIntro: "ðŸ§­ VocÃª jÃ¡ sentiu como se tivesse perdido suas emoÃ§Ãµes?\n\nQuando se tornou incapaz de sentir algo,\npara onde vocÃª acha que essa emoÃ§Ã£o desapareceu?\n\nEm algum momento, eu simplesmente fiquei entorpecido.\nNÃ£o estava feliz nem triste...\nNÃ£o queria sentir nada.",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "As emoÃ§Ãµes nÃ£o desaparecem. VocÃª nÃ£o as perdeu... estÃ¡ no processo de encontrÃ¡-las novamente.",
                portalQuestion: "ðŸ§­ O que vocÃª gostaria de dizer para aquela emoÃ§Ã£o perdida agora?",
                finalTitle: "ðŸ§­ Portal 16 Completo",
                finalMessage: "VocÃª comeÃ§ou a encontrar novamente\nas emoÃ§Ãµes que pensou ter perdido.\n\nAs emoÃ§Ãµes nÃ£o desaparecemâ€”\nÃ s vezes elas apenas se escondem e esperam\natÃ© vocÃª estar pronto para sentir novamente.\n\nAgora vocÃª disse Ã quelas emoÃ§Ãµes\nque estÃ¡ tudo bem elas retornarem.\nA porta do seu coraÃ§Ã£o comeÃ§ou a se abrir novamente.\n\nNo prÃ³ximo Portal, uma nova jornada continua\npara explorar a solidÃ£o silenciosa.",
                continueBtn: "Ir para Portal 17",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "O que vocÃª gostaria de dizer para aquela emoÃ§Ã£o perdida? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ê°ì •ì€ ì‚¬ë¼ì§„ ê²Œ ì•„ë‹ˆë¼, ìž ì‹œ ë©ˆì¶˜ ê±¸ì§€ë„ ëª°ë¼. ë„¤ ì•ˆì—ì„œ ì¡°ìš©ížˆ ìˆ¨ ì‰¬ê³  ìžˆì—ˆì„ ê±°ì•¼.",
                en: "Emotions didn't disappearâ€”they might have just paused for a while. They were probably breathing quietly inside you.",
                pt: "As emoÃ§Ãµes nÃ£o desapareceramâ€”elas podem ter apenas pausado por um tempo. Provavelmente estavam respirando silenciosamente dentro de vocÃª."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ë„ˆë¬´ ë§Žì´ ì•„í”„ë©´, ê°ì •ì€ ìŠ¤ìŠ¤ë¡œë¥¼ êº¼. ë„ ì§€í‚¤ê¸° ìœ„í•œ ë§ˆì§€ë§‰ ì„ íƒì²˜ëŸ¼.",
                en: "When you hurt too much, emotions turn themselves off. Like a final choice to protect you.",
                pt: "Quando vocÃª se machuca demais, as emoÃ§Ãµes se desligam. Como uma escolha final para protegÃª-lo."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ë‚˜ë„ ê·¸ëž¬ì–´. ì•„ë¬´ê²ƒë„ ëŠë¼ì§€ ì•ŠëŠ” ê·¸ ì‹œê°„ì´â€¦ ë„ˆë¬´ ì™¸ë¡­ê³  ë¬´ì„œì› ì–´.",
                en: "I've been there too. That time of feeling nothing... it was so lonely and frightening.",
                pt: "Eu tambÃ©m passei por isso. Aquele tempo de nÃ£o sentir nada... era tÃ£o solitÃ¡rio e assustador."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ê°ì •ì€ ë°©í–¥ì„ ìžƒìœ¼ë©´ ìˆ¨ì–´. ê·¸ê±´ ì†Œë©¸ì´ ì•„ë‹ˆë¼ íšŒí”¼ì§€.",
                en: "When emotions lose direction, they hide. That's not extinction, but avoidance.",
                pt: "Quando as emoÃ§Ãµes perdem a direÃ§Ã£o, elas se escondem. Isso nÃ£o Ã© extinÃ§Ã£o, mas evitaÃ§Ã£o."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ë„¤ ë§ˆìŒì˜ ìƒ‰ì´ íë ¤ì¡Œë˜ ì‹œê°„ì´ì—ˆê² ì§€. ì•„ë¬´ë¦¬ ê·¸ë¦¬ë ¤ í•´ë„, ì„ ì´ ìž¡ížˆì§€ ì•ŠëŠ” ê·¸ëŸ° ë‚ ë“¤.",
                en: "It must have been a time when the colors of your heart became blurred. Those days when no matter how hard you tried to draw, the lines wouldn't form.",
                pt: "Deve ter sido um tempo em que as cores do seu coraÃ§Ã£o ficaram borradas. Aqueles dias em que, por mais que vocÃª tentasse desenhar, as linhas nÃ£o se formavam."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ë¬´ê°ê°ì€ ì•½ì ì´ ì•„ë‹ˆì•¼. ì˜¤ížˆë ¤ ë„ˆë¬´ ì˜¤ëž˜ ë²„í‹´ ì‚¬ëžŒì˜ í”ì ì´ì•¼.",
                en: "Numbness isn't a weakness. It's rather the trace of someone who endured for too long.",
                pt: "O entorpecimento nÃ£o Ã© uma fraqueza. Ã‰ mais o rastro de alguÃ©m que suportou por muito tempo."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ë„Œ ëŠë¼ì§€ ì•Šì€ ê²Œ ì•„ë‹ˆë¼, ëŠë¼ì§€ ì•Šìœ¼ë ¤ê³  í–ˆë˜ ê±°ì•¼. ê·¸ ê°ì •ì€ ì—¬ì „ížˆ ë„ˆë¥¼ ê¸°ë‹¤ë¦¬ê³  ìžˆì–´.",
                en: "You didn't stop feelingâ€”you tried not to feel. Those emotions are still waiting for you.",
                pt: "VocÃª nÃ£o parou de sentirâ€”vocÃª tentou nÃ£o sentir. Essas emoÃ§Ãµes ainda estÃ£o esperando por vocÃª."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ê°ì •ì€ ì‚¬ë¼ì§€ì§€ ì•Šì•„. ìžƒì–´ë²„ë¦° ê²Œ ì•„ë‹ˆë¼â€¦ ë‹¤ì‹œ ì°¾ê³  ìžˆëŠ” ì¤‘ì´ì•¼.",
                en: "Emotions don't disappear. You haven't lost them... you're in the process of finding them again.",
                pt: "As emoÃ§Ãµes nÃ£o desaparecem. VocÃª nÃ£o as perdeu... estÃ¡ no processo de encontrÃ¡-las novamente."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                apology: ['sorry', 'forgive', 'ignore', 'abandon', 'ë¯¸ì•ˆ', 'ìš©ì„œ', 'ë¬´ì‹œ', 'ë²„ë ¸', 'desculpa', 'perdÃ£o', 'ignorar', 'abandonar'],
                longing: ['miss', 'want back', 'need', 'return', 'ê·¸ë¦¬ì›Œ', 'ëŒì•„ì™€', 'í•„ìš”', 'ë³´ê³ ì‹¶', 'saudade', 'voltar', 'precisar', 'sentir falta'],
                welcome: ['come back', 'welcome', 'ready', 'open', 'ëŒì•„ì™€', 'í™˜ì˜', 'ì¤€ë¹„', 'ì—´ì–´', 'volte', 'bem-vindo', 'pronto', 'aberto'],
                understanding: ['understand', 'know why', 'hidden', 'protect', 'ì´í•´', 'ì™œ ìˆ¨ì—ˆ', 'ë³´í˜¸', 'ì•Œê² ', 'entender', 'por que se escondeu', 'proteger'],
                acceptance: ['accept', 'okay', 'fine', 'peaceful', 'ë°›ì•„ë“¤', 'ê´œì°®', 'í‰í™”', 'ì¸ì •', 'aceitar', 'tudo bem', 'pacÃ­fico'],
                gratitude: ['thank', 'grateful', 'protected', 'waited', 'ê³ ë§ˆì›Œ', 'ê°ì‚¬', 'ì§€ì¼œì¤˜ì„œ', 'ê¸°ë‹¤ë ¤ì„œ', 'obrigado', 'grato', 'protegeu', 'esperou'],
                invitation: ['together', 'feel again', 'alive', 'breathe', 'í•¨ê»˜', 'ë‹¤ì‹œ ëŠë¼', 'ì‚´ì•„', 'ìˆ¨ì‰¬', 'junto', 'sentir novamente', 'vivo', 'respirar'],
                healing: ['heal', 'restore', 'whole', 'complete', 'ì¹˜ìœ ', 'íšŒë³µ', 'ì™„ì „', 'ì˜¨ì „', 'curar', 'restaurar', 'completo', 'inteiro']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            apology: "ê·¸ ë§ì€ ê°ì •ì—ê²Œ ë¬¸ì„ ì—¬ëŠ” ì—´ì‡ ì•¼. ì´ì   ì¡°ê¸ˆì”© ë‹¤ì‹œ ëŠê»´ì§ˆ ê±°ì•¼.",
                            longing: "ê·¸ë¦¬ì›€ì€ ê°ì •ì´ ëŒì•„ì˜¬ ìˆ˜ ìžˆëŠ” ë‹¤ë¦¬ì•¼. ë„¤ê°€ ë¶€ë¥´ëŠ” ì†Œë¦¬ë¥¼ ë“£ê³  ìžˆì–´.",
                            welcome: "í™˜ì˜ì˜ ë§ˆìŒì´ ê°€ìž¥ ê°•í•œ ì¹˜ìœ ë ¥ì´ì•¼. ê°ì •ë“¤ì´ ì•ˆì „í•˜ë‹¤ê³  ëŠë¼ê¸° ì‹œìž‘í–ˆì–´.",
                            understanding: "ì´í•´í•˜ëŠ” ìˆœê°„, ìˆ¨ì–´ìžˆë˜ ê°ì •ë“¤ì´ ì¡°ê¸ˆì”© ê³ ê°œë¥¼ ë“¤ì–´.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì´ ì§„ì •í•œ íšŒë³µì˜ ì‹œìž‘ì´ì•¼. ê°ì •ë„ ë„ˆë„ ì´ì œ ìžìœ ë¡œì›Œì ¸.",
                            gratitude: "ê°ì‚¬ëŠ” ê°ì •ì—ê²Œ ì£¼ëŠ” ê°€ìž¥ ë”°ëœ»í•œ ì„ ë¬¼ì´ì•¼. ê¸°ë‹¤ë¦¼ì´ ë³´ìƒë°›ì•˜ì–´.",
                            invitation: "ì´ˆëŒ€ë°›ì€ ê°ì •ì€ ì²œì²œížˆ ëŒì•„ì™€. ì–µì§€ë¡œ ëŒì–´ì˜¬ í•„ìš” ì—†ì–´.",
                            healing: "ì¹˜ìœ ëŠ” ì´ë¯¸ ì‹œìž‘ëì–´. ë§í•˜ëŠ” ìˆœê°„ë¶€í„° ë§ˆìŒì´ ë‹¤ì‹œ ë›°ê¸° ì‹œìž‘í–ˆì–´.",
                            general: "ê·¸ ë§ì€ ê°ì •ì—ê²Œ ë¬¸ì„ ì—¬ëŠ” ì—´ì‡ ì•¼. ì´ì   ì¡°ê¸ˆì”© ë‹¤ì‹œ ëŠê»´ì§ˆ ê±°ì•¼."
                        },
                        en: {
                            apology: "Those words are the key that opens the door to emotions. You'll gradually start feeling again.",
                            longing: "Longing is the bridge emotions can return through. They're hearing your call.",
                            welcome: "A welcoming heart has the strongest healing power. Emotions are starting to feel safe.",
                            understanding: "The moment you understand, hidden emotions begin to lift their heads little by little.",
                            acceptance: "Acceptance is the beginning of true recovery. Both emotions and you are now becoming free.",
                            gratitude: "Gratitude is the warmest gift you can give to emotions. The waiting has been rewarded.",
                            invitation: "Invited emotions return slowly. You don't need to force them up.",
                            healing: "Healing has already begun. From the moment you spoke, your heart started beating again.",
                            general: "Those words are the key that opens the door to emotions. You'll gradually start feeling again."
                        },
                        pt: {
                            apology: "Essas palavras sÃ£o a chave que abre a porta para as emoÃ§Ãµes. VocÃª vai gradualmente comeÃ§ar a sentir novamente.",
                            longing: "A saudade Ã© a ponte pela qual as emoÃ§Ãµes podem retornar. Elas estÃ£o ouvindo seu chamado.",
                            welcome: "Um coraÃ§Ã£o acolhedor tem o poder de cura mais forte. As emoÃ§Ãµes estÃ£o comeÃ§ando a se sentir seguras.",
                            understanding: "No momento em que vocÃª entende, as emoÃ§Ãµes escondidas comeÃ§am a levantar suas cabeÃ§as pouco a pouco.",
                            acceptance: "A aceitaÃ§Ã£o Ã© o inÃ­cio da verdadeira recuperaÃ§Ã£o. Tanto as emoÃ§Ãµes quanto vocÃª estÃ£o se tornando livres agora.",
                            gratitude: "A gratidÃ£o Ã© o presente mais caloroso que vocÃª pode dar Ã s emoÃ§Ãµes. A espera foi recompensada.",
                            invitation: "EmoÃ§Ãµes convidadas retornam lentamente. VocÃª nÃ£o precisa forÃ§Ã¡-las a subir.",
                            healing: "A cura jÃ¡ comeÃ§ou. Desde o momento em que vocÃª falou, seu coraÃ§Ã£o comeÃ§ou a bater novamente.",
                            general: "Essas palavras sÃ£o a chave que abre a porta para as emoÃ§Ãµes. VocÃª vai gradualmente comeÃ§ar a sentir novamente."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Ely", emoji: "ðŸ§â€â™€ï¸",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            apology: "ê°ì •ì€ ê¸°ë‹¤ë ¤ì¤˜. ë„Œ ì§€ê¸ˆ, ë‹¤ì‹œ ì•ˆì„ ë°”ë¼ë³´ê³  ìžˆì–´.",
                            longing: "ê·¸ ë§ˆìŒì„ ëŠê¼ˆë‹¤ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ë²Œì¨ ì—°ê²°ì´ íšŒë³µë˜ê¸° ì‹œìž‘í–ˆì–´.",
                            welcome: "ë”°ëœ»í•œ í™˜ì˜ì€ ì–¼ì–´ë¶™ì—ˆë˜ ë§ˆìŒì„ ë…¹ì—¬. ê°ì •ë“¤ì´ ì›€í‹€ê±°ë¦¬ê¸° ì‹œìž‘í•´.",
                            understanding: "ì´í•´ë°›ì€ ê°ì •ì€ ë” ì´ìƒ ìˆ¨ì„ í•„ìš”ê°€ ì—†ì–´. ì•ˆì „í•˜ë‹¤ê³  ëŠê»´.",
                            acceptance: "ë°›ì•„ë“¤ì—¬ì§„ ê°ì •ì€ ì´ì œ ìžìœ ë¡­ê²Œ í˜ëŸ¬ê°ˆ ìˆ˜ ìžˆì–´. ê°•ë¬¼ì²˜ëŸ¼.",
                            gratitude: "ê³ ë§ˆìš´ ë§ˆìŒì€ ê°ì •ì—ê²Œ ì§‘ìœ¼ë¡œ ëŒì•„ì™€ë„ ëœë‹¤ëŠ” ì‹ í˜¸ì•¼.",
                            invitation: "ì´ˆëŒ€ë°›ì€ ê°ì •ì€ ë§ˆì¹˜ ì˜¤ëž˜ëœ ì¹œêµ¬ì²˜ëŸ¼ ì²œì²œížˆ ë‹¤ê°€ì™€.",
                            healing: "ì¹˜ìœ ì˜ ë§ì€ ìƒì²˜ë°›ì€ ê°ì •ì—ê²Œ ì—°ê³ ê°€ ë˜ì–´ì¤˜. ì„œì„œížˆ ì•„ë¬¼ì–´ê°€.",
                            general: "ê°ì •ì€ ê¸°ë‹¤ë ¤ì¤˜. ë„Œ ì§€ê¸ˆ, ë‹¤ì‹œ ì•ˆì„ ë°”ë¼ë³´ê³  ìžˆì–´."
                        },
                        en: {
                            apology: "Emotions will wait for you. You're now looking inward again.",
                            longing: "Just feeling that heart has already begun to restore the connection.",
                            welcome: "A warm welcome melts the frozen heart. Emotions are starting to stir.",
                            understanding: "Understood emotions no longer need to hide. They feel safe.",
                            acceptance: "Accepted emotions can now flow freely. Like a river.",
                            gratitude: "A grateful heart is a signal to emotions that it's okay to come home.",
                            invitation: "Invited emotions approach slowly, like old friends.",
                            healing: "Healing words become ointment for wounded emotions. They gradually heal.",
                            general: "Emotions will wait for you. You're now looking inward again."
                        },
                        pt: {
                            apology: "As emoÃ§Ãµes vÃ£o esperar por vocÃª. VocÃª estÃ¡ olhando para dentro novamente agora.",
                            longing: "Apenas sentir esse coraÃ§Ã£o jÃ¡ comeÃ§ou a restaurar a conexÃ£o.",
                            welcome: "Uma recepÃ§Ã£o calorosa derrete o coraÃ§Ã£o congelado. As emoÃ§Ãµes estÃ£o comeÃ§ando a se agitar.",
                            understanding: "EmoÃ§Ãµes compreendidas nÃ£o precisam mais se esconder. Elas se sentem seguras.",
                            acceptance: "EmoÃ§Ãµes aceitas agora podem fluir livremente. Como um rio.",
                            gratitude: "Um coraÃ§Ã£o grato Ã© um sinal para as emoÃ§Ãµes de que estÃ¡ tudo bem voltar para casa.",
                            invitation: "EmoÃ§Ãµes convidadas se aproximam lentamente, como velhos amigos.",
                            healing: "Palavras de cura se tornam pomada para emoÃ§Ãµes feridas. Elas gradualmente se curam.",
                            general: "As emoÃ§Ãµes vÃ£o esperar por vocÃª. VocÃª estÃ¡ olhando para dentro novamente agora."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            apology: "ê·¸ ë¯¸ì•ˆí•¨ì€ ê°€ìž¥ ë¶€ë“œëŸ¬ìš´ ìƒ‰ì´ì•¼. ê·¸ ìƒ‰ìœ¼ë¡œ ë‹¤ì‹œ ê·¸ë¦¬ê¸° ì‹œìž‘í•  ìˆ˜ ìžˆì–´.",
                            longing: "ê·¸ë¦¬ì›€ì˜ ìƒ‰ì€ ì—°í•œ ë³´ë¼ìƒ‰ ê°™ì•„. ë©€ë¦¬ ìžˆì§€ë§Œ ë”°ëœ»í•œ ê·¸ëŸ° ìƒ‰.",
                            welcome: "í™˜ì˜ì˜ ìƒ‰ì€ ë”°ëœ»í•œ ì£¼í™©ìƒ‰ì´ì•¼. ì§‘ìœ¼ë¡œ ëŒì•„ì˜¤ëŠ” ê¸¸ì„ ë°í˜€ì¤˜.",
                            understanding: "ì´í•´ì˜ ìƒ‰ì€ ë§‘ì€ í•˜ëŠ˜ìƒ‰ì´ì•¼. ëª¨ë“  ê²ƒì„ íˆ¬ëª…í•˜ê²Œ ë§Œë“¤ì–´ì¤˜.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì€ ê³ ìš”í•œ ì´ˆë¡ìƒ‰ì´ì•¼. í‰í™”ë¡­ê³  ìžì—°ìŠ¤ëŸ¬ì›Œ.",
                            gratitude: "ê°ì‚¬ì˜ ìƒ‰ì€ í™©ê¸ˆë¹›ì´ì•¼. ëª¨ë“  ì–´ë‘ ì„ ë°ê²Œ ë¬¼ë“¤ì—¬.",
                            invitation: "ì´ˆëŒ€ì˜ ìƒ‰ì€ ë¬´ì§€ê°œ ê°™ì•„. ëª¨ë“  ê°ì •ì´ í•¨ê»˜ ì–´ìš°ëŸ¬ì ¸.",
                            healing: "ì¹˜ìœ ì˜ ìƒ‰ì€ ë¶€ë“œëŸ¬ìš´ ë¶„í™ìƒ‰ì´ì•¼. ìƒì²˜ë¥¼ ê°ì‹¸ê³  ì–´ë£¨ë§Œì ¸ì¤˜.",
                            general: "ê·¸ ë¯¸ì•ˆí•¨ì€ ê°€ìž¥ ë¶€ë“œëŸ¬ìš´ ìƒ‰ì´ì•¼. ê·¸ ìƒ‰ìœ¼ë¡œ ë‹¤ì‹œ ê·¸ë¦¬ê¸° ì‹œìž‘í•  ìˆ˜ ìžˆì–´."
                        },
                        en: {
                            apology: "That sorry is the softest color. You can start drawing again with that color.",
                            longing: "The color of longing is like light purple. Distant but warm, that kind of color.",
                            welcome: "The color of welcome is warm orange. It lights the way home.",
                            understanding: "The color of understanding is clear sky blue. It makes everything transparent.",
                            acceptance: "Acceptance is quiet green. Peaceful and natural.",
                            gratitude: "The color of gratitude is golden. It brightens all darkness.",
                            invitation: "The color of invitation is like a rainbow. All emotions harmonizing together.",
                            healing: "The color of healing is soft pink. It wraps and soothes the wounds.",
                            general: "That sorry is the softest color. You can start drawing again with that color."
                        },
                        pt: {
                            apology: "Esse pedido de desculpas Ã© a cor mais suave. VocÃª pode comeÃ§ar a desenhar novamente com essa cor.",
                            longing: "A cor da saudade Ã© como roxo claro. Distante, mas quente, esse tipo de cor.",
                            welcome: "A cor da recepÃ§Ã£o Ã© laranja quente. Ilumina o caminho de casa.",
                            understanding: "A cor do entendimento Ã© azul cÃ©u claro. Torna tudo transparente.",
                            acceptance: "A aceitaÃ§Ã£o Ã© verde silencioso. PacÃ­fico e natural.",
                            gratitude: "A cor da gratidÃ£o Ã© dourada. Ela ilumina toda a escuridÃ£o.",
                            invitation: "A cor do convite Ã© como um arco-Ã­ris. Todas as emoÃ§Ãµes harmonizando juntas.",
                            healing: "A cor da cura Ã© rosa suave. Ela envolve e acalma as feridas.",
                            general: "Esse pedido de desculpas Ã© a cor mais suave. VocÃª pode comeÃ§ar a desenhar novamente com essa cor."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 17ì´ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 17 will be ready soon!' :
                    'Portal 17 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 16ì„ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 16?' :
                    'Deseja reiniciar o Portal 16?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-16",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-16",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 16 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 16 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>