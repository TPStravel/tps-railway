<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 07: The Self Buried in Others' Gaze</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 07: The Self Buried in Others' Gaze</div>
            <div class="portal-subtitle" id="portalSubtitle">Living Within the Eyes of Others</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">‚ú® Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">üëÅ‚Äçüó® Portal 07 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 08</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="If you could step out of that gaze and stand as your authentic self, what would you look like now? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "Í∞êÏ†ïÏùò Ïö©Í¥ëÎ°ú",
                portalMainTitle: "Portal 07: ÌÉÄÏù∏Ïùò ÏãúÏÑ† ÏÜçÏóê Î¨ªÌûå ÎÇò",
                portalSubtitle: "ÌÉÄÏù∏Ïùò ÎààÍ∏∏ ÏÜçÏóêÏÑú ÏÇ¥ÏïÑÍ∞ÄÎäî ÎÇò",
                portalIntro: "üëÅ‚Äçüó® ÎãπÏã†ÏùÄ Ïñ∏Ï†úÎ∂ÄÌÑ∞, ÌÉÄÏù∏Ïùò ÏãúÏÑ† ÏïàÏóê ÏÇ¥Í≥† ÏûàÏóàÎÇòÏöî?\n\nÎàÑÍµ∞Í∞ÄÍ∞Ä Ïñ¥ÎñªÍ≤å Î≥ºÏßÄ Î®ºÏ†Ä ÏÉùÍ∞ÅÌïòÍ≤å ÎêòÍ≥†,\nÍ∑∏ ÎààÍ∏∏ÏùÑ ÏùòÏãùÌï¥ÏÑú ÌëúÏ†ïÏùÑ ÎßåÎì§Í≥†, ÎßêÌà¨Î•º Î∞îÍæ∏Í≥†,\nÌñâÎèôÏùÑ Ï°∞Ïã¨ÌïòÎ©∞ ÏÇ¥ÏïÑÏò® ÏãúÍ∞ÑÎì§.\n\nÏñ∏Ï†úÎ∂ÄÌÑ¥Í∞Ä Í±∞Ïö∏ÏùÑ Î≥¥Îäî Í≤ÉÏ≤òÎüº ÏûêÏó∞Ïä§ÎüΩÍ≤å\nÎã§Î•∏ ÏÇ¨ÎûåÏùò ÎààÏùÑ ÌÜµÌï¥ ÎÇòÎ•º Î∞îÎùºÎ≥¥Í≤å ÎêòÏóàÏ£†.\n\n\"Ï†Ä ÏÇ¨ÎûåÏù¥ ÎÇ† Ïñ¥ÎñªÍ≤å ÏÉùÍ∞ÅÌï†Íπå?\"\n\"Ïù¥Î†áÍ≤å ÎßêÌïòÎ©¥ Ïù¥ÏÉÅÌïòÍ≤å Î≥¥Ïù¥ÏßÄ ÏïäÏùÑÍπå?\"\n\"Ïã§ÎßùÏãúÌÇ§Î©¥ Ïñ¥ÎñªÍ≤å ÌïòÏßÄ?\"\n\nÍ∑∏ ÏãúÏÑ†Îì§ ÏÇ¨Ïù¥ÏóêÏÑú ÏßÑÏßú ÎãπÏã†ÏùÄ Ïñ¥ÎîîÎ°ú Ïà®ÏóàÎÇòÏöî?\nÍ∑∏ ÎààÍ∏∏ ÏÜçÏóêÏÑú ÎãπÏã†ÏùÄ Ïñ¥Îñ§ ÏñºÍµ¥ÏùÑ ÌïòÍ≥† ÏûàÏóàÎÇòÏöî?",
                lightTitle: "‚ú® ÎπõÏùò ÌïúÎßàÎîî",
                lightMessage: "ÌÉÄÏù∏Ïùò ÏãúÏÑ†ÏùÄ Í±∞Ïö∏Ïù¥ ÏïÑÎãôÎãàÎã§. ÎãπÏã†Ïù¥ Ïä§Ïä§Î°úÎ•º Î∞îÎùºÎ≥¥Îäî ÎààÏù¥ Í∞ÄÏû• ÏßÑÏã§Ïóê Í∞ÄÍπùÏäµÎãàÎã§.",
                portalQuestion: "üëÅ‚Äçüó® ÌÉÄÏù∏Ïùò ÏãúÏÑ†ÏùÑ Î≤óÍ≥†, Ïò§Î°ØÌïú ÎÇòÎ°ú ÏÑúÍ≤å ÎêúÎã§Î©¥ ÏßÄÍ∏àÏùò ÎÇòÎäî Ïñ¥Îñ§ Î™®ÏäµÏùºÍπåÏöî?",
                finalTitle: "üëÅ‚Äçüó® Portal 07 ÏôÑÎ£å",
                finalMessage: "ÎãπÏã†ÏùÄ Ïö©Í∏∞ ÏûàÍ≤å ÌÉÄÏù∏Ïùò ÏãúÏÑ†ÏóêÏÑú Ìïú Î∞úÏßù ÎÇòÏôîÏäµÎãàÎã§.\n\nÍ∑∏ÎèôÏïà Îã§Î•∏ ÏÇ¨ÎûåÏùò ÎààÏùÑ ÌÜµÌï¥ ÏûêÏã†ÏùÑ Î∞îÎùºÎ≥¥Î©∞\nÏßÑÏßú Î™®ÏäµÏùÑ Ïà®Í∏∞Í≥† ÏÇ¥ÏïòÎçò ÏãúÍ∞ÑÎì§Ïù¥\nÏñºÎßàÎÇò ÌûòÎì§ÏóàÎäîÏßÄ Ïù∏Ï†ïÌïòÏÖ®Ï£†.\n\nÏù¥Ï†ú ÎãπÏã†ÎßåÏùò ÏãúÏÑ†ÏúºÎ°ú\nÏûêÏã†ÏùÑ Î∞îÎùºÎ≥º Ïàò ÏûàÍ≤å ÎêòÏóàÏäµÎãàÎã§.\n\nÎã§Ïùå PortalÏóêÏÑúÎäî ÍπäÏàôÏù¥ Í∞êÏ∂∞Îëî\nÍ∏∞ÏñµÏùò ÏÉÅÏûêÎ•º Ïó¥Ïñ¥Î≥¥Îäî Ïó¨Ï†ïÏù¥ Ïù¥Ïñ¥ÏßëÎãàÎã§.",
                continueBtn: "Portal 08Î°ú Ïù¥Îèô",
                restartBtn: "Îã§Ïãú ÏãúÏûëÌïòÍ∏∞",
                inputPlaceholder: "ÌÉÄÏù∏Ïùò ÏãúÏÑ†ÏùÑ Î≤óÍ≥† ÏßÑÏßú ÎÇòÎ°ú ÏÑ†Îã§Î©¥, ÏßÄÍ∏à Ïñ¥Îñ§ Î™®ÏäµÏùºÏßÄ ÎßêÌï¥Î≥¥ÏÑ∏Ïöî... (EnterÎ°ú Ï†ÑÏÜ°)",
                youLabel: "ÎãπÏã†",
                waitingMessage: "ÏùëÎãµÏùÑ Í∏∞Îã§Î¶¨Îäî Ï§ë..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 07: The Self Buried in Others' Gaze",
                portalSubtitle: "Living Within the Eyes of Others",
                portalIntro: "üëÅ‚Äçüó® Since when have you been living within the gaze of others?\n\nThinking first about how someone might see you,\ncrafting expressions with their eyes in mind, changing your tone,\nbeing careful with your actions through all those times.\n\nAt some point, as naturally as looking in a mirror,\nyou began to see yourself through other people's eyes.\n\n\"What will they think of me?\"\n\"Won't I look strange if I say this?\"\n\"What if I disappoint them?\"\n\nAmidst all those gazes, where did the real you hide?\nWhat kind of face were you wearing in their sight?",
                lightTitle: "‚ú® Word of Light",
                lightMessage: "Others' gazes are not mirrors. The eyes with which you see yourself are closest to the truth.",
                portalQuestion: "üëÅ‚Äçüó® If you could step out of that gaze and stand as your authentic self, what would you look like now?",
                finalTitle: "üëÅ‚Äçüó® Portal 07 Complete",
                finalMessage: "You have courageously stepped out of others' gazes.\n\nYou acknowledged how difficult it was\nto live while hiding your true self,\nseeing yourself through other people's eyes\nall this time.\n\nNow you can look at yourself\nthrough your own eyes.\n\nIn the next Portal, a journey continues\nto open the box of deeply hidden memories.",
                continueBtn: "Move to Portal 08",
                restartBtn: "Start Again",
                inputPlaceholder: "If you could step out of that gaze and stand as your authentic self, what would you look like now? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 07: O Eu Enterrado no Olhar dos Outros",
                portalSubtitle: "Vivendo Dentro dos Olhos dos Outros",
                portalIntro: "üëÅ‚Äçüó® Desde quando voc√™ tem vivido dentro do olhar dos outros?\n\nPensando primeiro em como algu√©m pode te ver,\ncriando express√µes com seus olhos em mente, mudando seu tom,\nsendo cuidadoso com suas a√ß√µes durante todos esses momentos.\n\nEm algum ponto, t√£o naturalmente quanto olhar no espelho,\nvoc√™ come√ßou a se ver atrav√©s dos olhos de outras pessoas.\n\n\"O que eles v√£o pensar de mim?\"\n\"N√£o vou parecer estranho se disser isso?\"\n\"E se eu os decepcionar?\"\n\nNo meio de todos esses olhares, onde o verdadeiro voc√™ se escondeu?\nQue tipo de rosto voc√™ estava usando na vista deles?",
                lightTitle: "‚ú® Palavra de Luz",
                lightMessage: "Os olhares dos outros n√£o s√£o espelhos. Os olhos com os quais voc√™ se v√™ est√£o mais pr√≥ximos da verdade.",
                portalQuestion: "üëÅ‚Äçüó® Se voc√™ pudesse sair desse olhar e se colocar como seu eu aut√™ntico, como voc√™ seria agora?",
                finalTitle: "üëÅ‚Äçüó® Portal 07 Completo",
                finalMessage: "Voc√™ corajosamente saiu dos olhares dos outros.\n\nVoc√™ reconheceu o qu√£o dif√≠cil foi\nviver escondendo seu verdadeiro eu,\nvendo-se atrav√©s dos olhos de outras pessoas\ntodo esse tempo.\n\nAgora voc√™ pode olhar para si mesmo\natrav√©s de seus pr√≥prios olhos.\n\nNo pr√≥ximo Portal, uma jornada continua\npara abrir a caixa de mem√≥rias profundamente escondidas.",
                continueBtn: "Ir para Portal 08",
                restartBtn: "Come√ßar Novamente",
                inputPlaceholder: "Se voc√™ pudesse sair desse olhar e se colocar como seu eu aut√™ntico, como voc√™ seria agora? (Enter para enviar)",
                youLabel: "Voc√™",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "üßë‚Äçü¶±", text: {
                ko: "ÎÑàÎäî ÎÑàÎ¨¥ Ïò§Îûò Í±∞Ïö∏Ïù¥ ÎêòÏñ¥ ÏûàÏóàÏßÄ. ÌÉÄÏù∏Ïùò ÌëúÏ†ïÎßåÏùÑ Î∞òÏÇ¨ÌïòÎ©∞, Ïä§Ïä§Î°úÎ•º ÏûäÏùÄ Ï±Ñ.",
                en: "You've been a mirror for too long. Reflecting only others' expressions while forgetting yourself.",
                pt: "Voc√™ foi um espelho por muito tempo. Refletindo apenas as express√µes dos outros enquanto se esquecia de si mesmo."
            }},
            { name: "Ely", emoji: "üßù‚Äç‚ôÄÔ∏è", text: {
                ko: "Í∑∏ ÏãúÏÑ† ÏÜçÏùò ÎÑàÎäî Ï°∞Ïö©ÌñàÍ≥†, Ï°∞Ïã¨Ïä§Îü¨Ïõ†ÏßÄ. ÎÇòÎäî Í∑∏ Ïπ®Î¨µ ÏÜç Ïô∏Ïπ®ÏùÑ Îì§ÏóàÏñ¥.",
                en: "You in that gaze were quiet and cautious. I heard the cry within that silence.",
                pt: "Voc√™ naquele olhar era quieto e cauteloso. Eu ouvi o grito dentro daquele sil√™ncio."
            }},
            { name: "Sora", emoji: "üßï", text: {
                ko: "Î≥¥Ïù¥Îäî ÎåÄÎ°ú ÏÇ¥ÏïÑÏïº ÌïúÎã§Îäî Îßê‚Ä¶ ÏñºÎßàÎÇò ÎßéÏùÄ ÎÑàÎ•º Í∞ÄÎëêÍ≤å ÎßåÎì§ÏóàÏùÑÍπå.",
                en: "The expectation to live as you appear... how much of you did that imprison?",
                pt: "A expectativa de viver como voc√™ aparenta... quanto de voc√™ isso aprisionou?"
            }},
            { name: "Kael", emoji: "üßô", text: {
                ko: "ÏãúÏÑ†ÏùÄ Î¨¥Í≤åÍ∞Ä ÏûàÏñ¥. ÎÑ§Í∞Ä ÎäêÍºàÎçò ÏïïÎ∞ïÏùÄ ÌóàÏÉÅÏù¥ ÏïÑÎãàÏïº. ÏßÑÏßú ÎÑàÎäî Í∑∏ Î∞ëÏóêÏÑú Ïà® Ïâ¨Í≥† ÏûàÏóàÎçò Í±∞Ïïº.",
                en: "Gazes have weight. The pressure you felt wasn't an illusion. The real you was breathing beneath all that.",
                pt: "Os olhares t√™m peso. A press√£o que voc√™ sentiu n√£o era uma ilus√£o. O verdadeiro voc√™ estava respirando debaixo de tudo isso."
            }},
            { name: "Mira", emoji: "üßë‚Äçüé®", text: {
                ko: "ÎÑ§ ÏñºÍµ¥Ïóê Î∂ôÏùÄ ÌëúÏ†ïÎì§‚Ä¶ ÏßÑÏßú ÎÑàÏùò ÏÉâÏùÄ Í∑∏ ÏïÑÎûòÏóêÏÑú ÏñºÎßàÎÇò ÌùîÎì§Î†∏ÏùÑÍπå?",
                en: "The expressions pasted on your face... how much did your true colors tremble underneath?",
                pt: "As express√µes coladas no seu rosto... quanto suas verdadeiras cores tremeram por baixo?"
            }},
            { name: "Cris", emoji: "ü¶∏‚Äç‚ôÇÔ∏è", text: {
                ko: "ÎÇ®Îì§Ïù¥ ÎÑê ÌåêÎã®ÌïòÍ∏∞ Ï†ÑÏóê, ÎÑà Ïä§Ïä§Î°úÎ•º Îã®Ï£ÑÌñàÍ≤†ÏßÄ. ÎÇòÎèÑ Í∑∏ Ïã∏ÏõÄÏùÑ ÌñàÏóàÏñ¥.",
                en: "Before others could judge you, you condemned yourself. I've fought that battle too.",
                pt: "Antes que outros pudessem te julgar, voc√™ se condenou. Eu tamb√©m lutei essa batalha."
            }},
            { name: "Enya", emoji: "üßë‚ÄçüöÄ", text: {
                ko: "ÎÑå Îäò Ïó∞Í∏∞ÌñàÏßÄÎßå, Í∑∏Í±¥ Í±∞ÏßìÏù¥ ÏïÑÎãàÎùº ÏÇ¥ÏïÑÎÇ®Í∏∞ ÏúÑÌïú Î∞©ÏãùÏù¥ÏóàÏùÑÏßÄÎèÑ Î™∞Îùº.",
                en: "You always performed, but that wasn't falsehood‚Äîit might have been your way of surviving.",
                pt: "Voc√™ sempre atuou, mas isso n√£o era falsidade‚Äîpode ter sido sua maneira de sobreviver."
            }},
            { name: "Lian", emoji: "üßò", text: {
                ko: "ÏßÑÏßú ÎÑê Í∫ºÎÇ¥Îäî Îç∞Ïóî ÏãúÍ∞ÑÎèÑ, Ïö©Í∏∞ÎèÑ ÌïÑÏöîÌï¥. Ïò§Îäò Í∑∏ Î¨∏ÏùÑ Ï°∞Í∏à Ïó¥ÏóàÍµ¨ÎÇò.",
                en: "Bringing out the real you takes time and courage. Today you've opened that door a little.",
                pt: "Trazer o verdadeiro voc√™ para fora leva tempo e coragem. Hoje voc√™ abriu essa porta um pouco."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                authentic: ['authentic', 'real', 'true', 'genuine', 'honest'],
                free: ['free', 'liberated', 'independent', 'unbound'],
                confident: ['confident', 'strong', 'brave', 'bold'],
                peaceful: ['peaceful', 'calm', 'quiet', 'serene'],
                creative: ['creative', 'artistic', 'expressive', 'colorful'],
                vulnerable: ['vulnerable', 'open', 'exposed', 'fragile'],
                happy: ['happy', 'joyful', 'bright', 'cheerful'],
                uncertain: ['uncertain', 'confused', 'lost', 'unsure'],
                angry: ['angry', 'mad', 'fierce', 'rebellious'],
                sad: ['sad', 'melancholy', 'quiet', 'withdrawn']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Sora", emoji: "üßï",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            authentic: "ÌùîÎì§Î¶¨Îäî ÎÑà, Í∑∏ ÏûêÏ≤¥Î°ú ÏïÑÎ¶ÑÎã§Ïõå. ÎàÑÍµ∞Í∞ÄÎ•º Îî∞Îùº ÎßåÎì§ÏßÄ ÏïäÏïÑÎèÑ Îèº.",
                            free: "ÏûêÏú†Î°úÏö¥ ÎÑ§ Î™®ÏäµÏù¥ ÏñºÎßàÎÇò ÎπõÎÇòÎäîÏßÄ ÏïåÏïÑ? Í∑∏ ÎÇ†Í∞úÎ•º ÌéºÏπ† ÏãúÍ∞ÑÏù¥Ïïº.",
                            confident: "Í∑∏ ÎãπÎãπÌï®Ïù¥ ÏßÑÏßú ÎÑàÍµ¨ÎÇò. Ïù¥Ï†ú ÏïÑÎ¨¥ÎèÑ ÎÑ§ ÎπõÏùÑ Í∞ÄÎ¶¥ Ïàò ÏóÜÏñ¥.",
                            peaceful: "Í≥†ÏöîÌïú ÎÑàÏùò ÌûòÏùÑ ÎäêÍª¥. ÌèâÏò®Ìï® ÏÜçÏóêÏÑú ÏßÑÏ†ïÌïú Í∞ïÌï®Ïù¥ ÎÇòÏôÄ.",
                            general: "ÌùîÎì§Î¶¨Îäî ÎÑà, Í∑∏ ÏûêÏ≤¥Î°ú ÏïÑÎ¶ÑÎã§Ïõå. ÎàÑÍµ∞Í∞ÄÎ•º Îî∞Îùº ÎßåÎì§ÏßÄ ÏïäÏïÑÎèÑ Îèº."
                        },
                        en: {
                            authentic: "You, trembling as you are, are beautiful just like that. You don't need to be molded after someone else.",
                            free: "Do you know how radiant your free self is? It's time to spread those wings.",
                            confident: "That confidence is the real you. Now no one can dim your light.",
                            peaceful: "I feel the power in your quietness. True strength emerges from tranquility.",
                            general: "You, trembling as you are, are beautiful just like that. You don't need to be molded after someone else."
                        },
                        pt: {
                            authentic: "Voc√™, tremendo como est√°, √© lindo assim mesmo. Voc√™ n√£o precisa ser moldado segundo outra pessoa.",
                            free: "Voc√™ sabe qu√£o radiante √© seu eu livre? √â hora de abrir essas asas.",
                            confident: "Essa confian√ßa √© o verdadeiro voc√™. Agora ningu√©m pode diminuir sua luz.",
                            peaceful: "Eu sinto o poder na sua quietude. A verdadeira for√ßa emerge da tranquilidade.",
                            general: "Voc√™, tremendo como est√°, √© lindo assim mesmo. Voc√™ n√£o precisa ser moldado segundo outra pessoa."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "üßò",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            authentic: "'Í∑∏ÎÉ• ÎÇò'ÎùºÎäî ÏÑ†Ïñ∏Ïù¥ ÏñºÎßàÎÇò Í∞ïÌïúÏßÄ ÏïåÏïÑ? Í∑∏Í±¥ ÏÑ∏ÏÉÅÏóê Ï≤òÏùåÏúºÎ°ú ÎÑàÎ•º Î≥¥Ïó¨Ï£ºÎäî ÏùºÏù¥Ïïº.",
                            vulnerable: "ÏïΩÌï¥ Î≥¥Ïù¥Îäî Í≤ÉÎèÑ Ïö©Í∏∞Ïïº. ÏßÑÏßú Í∞ïÌï®ÏùÄ ÏïΩÌï®ÏùÑ Ïà®Í∏∞ÏßÄ ÏïäÎäî Îç∞ÏÑú ÎÇòÏôÄ.",
                            uncertain: "ÌôïÏã†Ïù¥ ÏóÜÏñ¥ÎèÑ Í¥úÏ∞ÆÏïÑ. Í∏∏ÏùÑ Ï∞æÏïÑÍ∞ÄÎäî Í≥ºÏ†ï ÏûêÏ≤¥Í∞Ä ÎÑàÏùò ÏßÑÏßú Î™®ÏäµÏù¥ÎãàÍπå.",
                            creative: "ÎÑ§ ÏïàÏùò Ï∞ΩÏ°∞ÏÑ±Ïù¥ Íπ®Ïñ¥ÎÇòÍ≥† ÏûàÏñ¥. Ïù¥Ï†ú ÏÑ∏ÏÉÅÏùÄ ÎÑ§ ÏÉâÏúºÎ°ú Ïπ†Ìï¥Ïßà Í±∞Ïïº.",
                            general: "'Í∑∏ÎÉ• ÎÇò'ÎùºÎäî ÏÑ†Ïñ∏Ïù¥ ÏñºÎßàÎÇò Í∞ïÌïúÏßÄ ÏïåÏïÑ? Í∑∏Í±¥ ÏÑ∏ÏÉÅÏóê Ï≤òÏùåÏúºÎ°ú ÎÑàÎ•º Î≥¥Ïó¨Ï£ºÎäî ÏùºÏù¥Ïïº."
                        },
                        en: {
                            authentic: "Do you know how powerful the declaration 'just me' is? It's showing yourself to the world for the first time.",
                            vulnerable: "Appearing vulnerable is also courage. True strength comes from not hiding weakness.",
                            uncertain: "It's okay to be uncertain. The process of finding your way is your true self.",
                            creative: "The creativity within you is awakening. Now the world will be painted in your colors.",
                            general: "Do you know how powerful the declaration 'just me' is? It's showing yourself to the world for the first time."
                        },
                        pt: {
                            authentic: "Voc√™ sabe qu√£o poderosa √© a declara√ß√£o 'apenas eu'? √â mostrar-se ao mundo pela primeira vez.",
                            vulnerable: "Parecer vulner√°vel tamb√©m √© coragem. A verdadeira for√ßa vem de n√£o esconder a fraqueza.",
                            uncertain: "Est√° tudo bem ser incerto. O processo de encontrar seu caminho √© seu verdadeiro eu.",
                            creative: "A criatividade dentro de voc√™ est√° despertando. Agora o mundo ser√° pintado com suas cores.",
                            general: "Voc√™ sabe qu√£o poderosa √© a declara√ß√£o 'apenas eu'? √â mostrar-se ao mundo pela primeira vez."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Mira", emoji: "üßë‚Äçüé®",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            creative: "Í∑∏ ÏÜîÏßÅÌï®Ïù¥ÏïºÎßêÎ°ú Í∞ÄÏû• ÎπõÎÇòÎäî ÏÉâÏù¥Ïïº. Ïù¥Ï†ú Ï∫îÎ≤ÑÏä§Îäî ÎÑ§ Í≤ÉÏù¥Ïïº.",
                            happy: "ÎÑ§ Í∏∞ÏÅ®Ïùò ÏÉâÍπîÏù¥ ÏñºÎßàÎÇò Îî∞ÎúªÌïúÏßÄ! Í∑∏ Î∞ùÏùåÏúºÎ°ú ÏÑ∏ÏÉÅÏùÑ Î¨ºÎì§Ïó¨.",
                            sad: "Ïä¨ÌîîÎèÑ ÏïÑÎ¶ÑÎã§Ïö¥ ÏÉâÏù¥Ïïº. Í∑∏ ÍπäÏù¥Í∞Ä ÎÑ§ Í∑∏Î¶ºÏùÑ ÎçîÏö± ÌíçÎ∂ÄÌïòÍ≤å ÎßåÎì§Ïñ¥.",
                            angry: "Í∑∏ Î∂ÑÎÖ∏Ïùò Îπ®Í∞ÑÏÉâ, Ïà®Í∏∞ÏßÄ Îßà. Í∑∏Í≤ÉÎèÑ ÎÑ§ ÌåîÎ†àÌä∏Ïùò ÏùºÎ∂ÄÏïº.",
                            general: "Í∑∏ ÏÜîÏßÅÌï®Ïù¥ÏïºÎßêÎ°ú Í∞ÄÏû• ÎπõÎÇòÎäî ÏÉâÏù¥Ïïº. Ïù¥Ï†ú Ï∫îÎ≤ÑÏä§Îäî ÎÑ§ Í≤ÉÏù¥Ïïº."
                        },
                        en: {
                            creative: "That honesty is the most radiant color. Now the canvas is yours.",
                            happy: "How warm the color of your joy is! Paint the world with that brightness.",
                            sad: "Sadness is also a beautiful color. That depth makes your painting richer.",
                            angry: "That red of your anger, don't hide it. It's also part of your palette.",
                            general: "That honesty is the most radiant color. Now the canvas is yours."
                        },
                        pt: {
                            creative: "Essa honestidade √© a cor mais radiante. Agora a tela √© sua.",
                            happy: "Qu√£o quente √© a cor da sua alegria! Pinte o mundo com esse brilho.",
                            sad: "A tristeza tamb√©m √© uma cor linda. Essa profundidade torna sua pintura mais rica.",
                            angry: "Esse vermelho da sua raiva, n√£o esconda. Tamb√©m faz parte da sua paleta.",
                            general: "Essa honestidade √© a cor mais radiante. Agora a tela √© sua."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 08Ïù¥ Í≥ß Ï§ÄÎπÑÎê©ÎãàÎã§!' :
                    currentLanguage === 'en' ? 
                    'Portal 08 will be ready soon!' :
                    'Portal 08 estar√° pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 07ÏùÑ Îã§Ïãú ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 07?' :
                    'Deseja reiniciar o Portal 07?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-07",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-07",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 07 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 07 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>