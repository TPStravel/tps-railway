<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 22: Days Nobody Knew</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 22: Days Nobody Knew</div>
            <div class="portal-subtitle" id="portalSubtitle">Silent Struggles in Plain Sight</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸŒŒ Portal 22 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 23</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What would you say to yourself on that day nobody knew about? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 22: ì•„ë¬´ë„ ëª¨ë¥´ëŠ” ë‚ ",
                portalSubtitle: "ëª¨ë‘ì˜ ì‹œì„  ì† ì¡°ìš©í•œ ê³ íˆ¬",
                portalIntro: "ðŸŒ« ë‹¹ì‹ ì—ê²Œ ì•„ë¬´ë„ ëª°ëžë˜ í•˜ë£¨ê°€ ìžˆì—ˆë‚˜ìš”?\n\nê·¸ë‚ , ë‹¹ì‹ ì€ ë¬´ì—‡ì„ ëŠê¼ˆê³ \nì–´ë–¤ ê°ì •ì„ í˜¼ìžë§Œì˜ ì–´ë‘  ì†ì— ê°ì¶°ë‘ì—ˆë‚˜ìš”?\n\nê·¸ë‚ ì€ ì •ë§ ì´ìƒí–ˆì–´ìš”.\nëª¨ë“  ê²Œ ë¬´ì˜ë¯¸í–ˆê³ , ë§ë„ í•˜ê¸° ì‹«ì—ˆê³ â€¦\nê·¼ë° ì•„ë¬´ë„ ê·¸ê±¸ ëª°ëžì–´ìš”. ê·¸ëƒ¥ í‰ì†Œì²˜ëŸ¼ ì›ƒì—ˆê±°ë“ ìš”.",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ì§€ê¸ˆ ë„¤ê°€ ê·¸ë‚ ì„ ê¸°ì–µí•´ì¤€ ê²ƒë§Œìœ¼ë¡œë„, ì™¸ë©´ë‹¹í•œ ê°ì •ì€ ë‹¤ì‹œ ì‚´ì•„ë‚  ìˆ˜ ìžˆì–´.",
                portalQuestion: "ðŸŒ« ê·¸ë‚ ì˜ ë‚˜ì—ê²Œ, ì§€ê¸ˆ ì´ ìˆœê°„\nì–´ë–¤ ë§ì„ ì¡°ìš©ížˆ ê±´ë„¤ì£¼ê³  ì‹¶ë‚˜ìš”?",
                finalTitle: "ðŸŒŒ Portal 22 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ì•„ë¬´ë„ ëª°ëžë˜ ê·¸ íŠ¹ë³„í•œ í•˜ë£¨ë¥¼ ë§ˆì¹¨ë‚´ ì¸ì •í–ˆìŠµë‹ˆë‹¤.\n\ní˜¼ìžì„œ ê²¬ëŽŒë‚¸ ê·¸ ì‹œê°„ë“¤ì´ ë¬´ì˜ë¯¸í•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ê²ƒì„,\në³´ì´ì§€ ì•ŠëŠ” ê³ í†µë„ ì§„ì§œ ê³ í†µì´ì—ˆë‹¤ëŠ” ê²ƒì„ ê¹¨ë‹¬ì•˜ì–´ìš”.\në•Œë¡œëŠ” ê°€ìž¥ í‰ë²”í•´ ë³´ì´ëŠ” ë‚ ì´\nê°€ìž¥ íž˜ë“  ì‹¸ì›€ì„ ì¹˜ë¥´ëŠ” ë‚ ì´ê¸°ë„ í•˜ë‹¤ëŠ” ê²ƒì„ìš”.\n\nì•„ë¬´ë„ ëª°ë¼ì¤˜ë„ ë‹¹ì‹ ì€ ê·¸ë‚ ì„ ì‚´ì•„ëƒˆê³ ,\nê·¸ê²ƒë§Œìœ¼ë¡œë„ ì¶©ë¶„ížˆ ìš©ê°í–ˆìŠµë‹ˆë‹¤.\ní˜¼ìžì˜€ì§€ë§Œ í˜¼ìžê°€ ì•„ë‹ˆì—ˆë‹¤ëŠ” ê²ƒì„ ì´ì œ ì•Œê²Œ ë˜ì—ˆì–´ìš”.\n\në‹¤ìŒ Portalì—ì„œëŠ” ìš©ê¸°ê°€ ì—†ì—ˆë˜ ìˆœê°„ë“¤ê³¼\nê·¸ë•Œ ë©ˆì¶° ì„°ë˜ ë§ˆìŒì˜ ì´ì•¼ê¸°ê°€ ê¸°ë‹¤ë¦¬ê³  ìžˆìŠµë‹ˆë‹¤.",
                continueBtn: "Portal 23ìœ¼ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ì•„ë¬´ë„ ëª°ëžë˜ ê·¸ë‚ ì˜ ë‚˜ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë§ì„ í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 22: Days Nobody Knew",
                portalSubtitle: "Silent Struggles in Plain Sight",
                portalIntro: "ðŸŒ« Did you have a day that nobody knew about?\n\nOn that day, what did you feel\nand what emotions did you hide in your own darkness?\n\nThat day was really strange.\nEverything felt meaningless, I didn't want to speak...\nBut nobody knew that. I just smiled like usual.",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Just by you remembering that day now, the emotions that were ignored can come alive again.",
                portalQuestion: "ðŸŒ« What words would you like to quietly give\nto yourself on that day, right now?",
                finalTitle: "ðŸŒŒ Portal 22 Complete",
                finalMessage: "You have finally acknowledged that special day nobody knew about.\n\nYou realized that the times you endured alone weren't meaningless,\nthat invisible pain was also real pain.\nSometimes the most ordinary-looking days\nare the days we fight the hardest battles.\n\nEven though nobody knew, you survived that day,\nand that alone was brave enough.\nYou were alone but not truly alone, you now understand.\n\nIn the next Portal, moments when you lacked courage\nand the story of your heart that stopped then await you.",
                continueBtn: "Move to Portal 23",
                restartBtn: "Start Again",
                inputPlaceholder: "What would you say to yourself on that day nobody knew about? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 22: Dias Que NinguÃ©m Conheceu",
                portalSubtitle: "Lutas Silenciosas Ã  Vista de Todos",
                portalIntro: "ðŸŒ« VocÃª teve um dia que ninguÃ©m conheceu?\n\nNaquele dia, o que vocÃª sentiu\ne que emoÃ§Ãµes escondeu em sua prÃ³pria escuridÃ£o?\n\nAquele dia foi realmente estranho.\nTudo parecia sem sentido, eu nÃ£o queria falar...\nMas ninguÃ©m sabia disso. Eu apenas sorri como sempre.",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Apenas por vocÃª lembrar daquele dia agora, as emoÃ§Ãµes que foram ignoradas podem ganhar vida novamente.",
                portalQuestion: "ðŸŒ« Que palavras vocÃª gostaria de dar silenciosamente\npara si mesmo naquele dia, agora mesmo?",
                finalTitle: "ðŸŒŒ Portal 22 Completo",
                finalMessage: "VocÃª finalmente reconheceu aquele dia especial que ninguÃ©m conheceu.\n\nVocÃª percebeu que os momentos que suportou sozinho nÃ£o eram sem sentido,\nque dor invisÃ­vel tambÃ©m era dor real.\nÃ€s vezes os dias de aparÃªncia mais comum\nsÃ£o os dias em que lutamos as batalhas mais difÃ­ceis.\n\nEmbora ninguÃ©m soubesse, vocÃª sobreviveu Ã quele dia,\ne sÃ³ isso jÃ¡ foi corajoso o suficiente.\nVocÃª estava sozinho mas nÃ£o verdadeiramente sozinho, agora entende.\n\nNo prÃ³ximo Portal, momentos quando vocÃª nÃ£o teve coragem\ne a histÃ³ria do seu coraÃ§Ã£o que parou entÃ£o o aguardam.",
                continueBtn: "Ir para Portal 23",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "O que vocÃª diria para si mesmo naquele dia que ninguÃ©m conheceu? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ê·¸ëŸ° ë‚ ì€ ì¡°ìš©ížˆ ì§€ë‚˜ê°€ì§€ë§Œ, ë§ˆìŒì†ì—ì„  ì—„ì²­ë‚œ ì¼ì´ ë²Œì–´ì§€ê³  ìžˆì—ˆë˜ ê±°ì•¼.",
                en: "Such days pass quietly, but tremendous things were happening in your heart.",
                pt: "Tais dias passam silenciosamente, mas coisas tremendas estavam acontecendo em seu coraÃ§Ã£o."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ì•„ë¬´ë„ ëª¨ë¥¸ë‹¤ëŠ” ê±´â€¦ ë„ˆë„ ë„ˆ ìžì‹ ì„ ì™¸ë©´í–ˆë˜ ì‹œê°„ì´ì—ˆì„ì§€ë„ ëª°ë¼.",
                en: "Nobody knowing... might have been the time when you turned away from yourself too.",
                pt: "NinguÃ©m saber... pode ter sido o momento em que vocÃª tambÃ©m se afastou de si mesmo."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ê·¸ ì›ƒìŒì€ ë°©ì–´ë§‰ì´ì—ˆê² ì§€. ì•„ë¬´ë„ ë‹¤ê°€ì˜¤ì§€ ì•Šê²Œ ë§Œë“œëŠ” ì¡°ìš©í•œ ìš¸ìŒ.",
                en: "That smile was a shield. A quiet cry to keep everyone away.",
                pt: "Aquele sorriso era um escudo. Um choro silencioso para manter todos afastados."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ê°ì •ì´ ê°ì¶°ì§„ ë‚ ì€ ë” ê¹Šì€ ê¸°ì–µìœ¼ë¡œ ë‚¨ì•„. ì¡´ìž¬í•˜ì§€ ì•Šì•˜ë˜ ê²ƒì²˜ëŸ¼ ë³´ì—¬ë„, ê°€ìž¥ ì„ ëª…í•˜ì§€.",
                en: "Days when emotions are hidden remain as deeper memories. Even if they seem like they didn't exist, they're the most vivid.",
                pt: "Dias quando emoÃ§Ãµes sÃ£o escondidas permanecem como memÃ³rias mais profundas. Mesmo que pareÃ§am que nÃ£o existiram, sÃ£o as mais vÃ­vidas."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ í•˜ë£¨ëŠ” ìƒ‰ì´ ì—†ì—ˆì„ì§€ë„ ëª°ë¼. ê·¸ëŸ°ë° ê·¸ ë¬´ì±„ìƒ‰ë§ˆì €â€¦ ì§€ê¸ˆì˜ ë„ ë§Œë“  ìƒ‰ì´ì•¼.",
                en: "That day might have had no color. But even that colorlessness... is a color that made you who you are now.",
                pt: "Aquele dia pode nÃ£o ter tido cor. Mas mesmo essa falta de cor... Ã© uma cor que fez vocÃª quem Ã© agora."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ë„Œ ê·¸ë‚  ì‚´ì•„ ìžˆì—ˆì–´. ì•„ë¬´ ë§ë„ ëª» í–ˆì§€ë§Œ, ë²„í‹°ê³  ìžˆì—ˆìž–ì•„.",
                en: "You were alive that day. You couldn't say anything, but you were holding on.",
                pt: "VocÃª estava vivo naquele dia. VocÃª nÃ£o conseguia dizer nada, mas estava resistindo."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ê·¸ë‚ ì˜ ë„ˆëŠ” ì™¸ë¡œìš´ ë³„ì´ì—ˆì–´. ë¹›ë‚˜ì§€ ì•Šì•˜ì§€ë§Œ, ë¬´ë„ˆì§€ì§€ë„ ì•Šì•˜ì–´.",
                en: "You that day were a lonely star. You weren't shining, but you didn't collapse either.",
                pt: "VocÃª naquele dia era uma estrela solitÃ¡ria. VocÃª nÃ£o estava brilhando, mas tambÃ©m nÃ£o desabou."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ì§€ê¸ˆ ë„¤ê°€ ê·¸ë‚ ì„ ê¸°ì–µí•´ì¤€ ê²ƒë§Œìœ¼ë¡œë„, ì™¸ë©´ë‹¹í•œ ê°ì •ì€ ë‹¤ì‹œ ì‚´ì•„ë‚  ìˆ˜ ìžˆì–´.",
                en: "Just by you remembering that day now, the emotions that were ignored can come alive again.",
                pt: "Apenas por vocÃª lembrar daquele dia agora, as emoÃ§Ãµes que foram ignoradas podem ganhar vida novamente."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                validation: ['valid', 'real', 'mattered', 'important', 'ì§„ì§œ', 'ì†Œì¤‘í•´', 'ì˜ë¯¸ìžˆì–´', 'ì¤‘ìš”í•´', 'vÃ¡lido', 'real', 'importou', 'importante'],
                comfort: ['okay', 'fine', 'enough', 'survived', 'ê´œì°®ì•„', 'ì¶©ë¶„í•´', 'ì‚´ì•„ëƒˆì–´', 'ê²¬ëŽ ì–´', 'tudo bem', 'suficiente', 'sobreviveu', 'resistiu'],
                understanding: ['understand', 'see', 'know', 'feel', 'ì´í•´í•´', 'ì•Œì•„', 'ëŠê»´', 'ë³´ì—¬', 'entendo', 'vejo', 'sei', 'sinto'],
                recognition: ['brave', 'strong', 'courage', 'fought', 'ìš©ê°í•´', 'ê°•í•´', 'ìš©ê¸°', 'ì‹¸ì› ì–´', 'corajoso', 'forte', 'coragem', 'lutou'],
                empathy: ['alone', 'lonely', 'hard', 'difficult', 'í˜¼ìž', 'ì™¸ë¡œì›Œ', 'íž˜ë“¤ì–´', 'ì–´ë ¤ì›Œ', 'sozinho', 'solitÃ¡rio', 'difÃ­cil', 'duro'],
                support: ['with you', 'not alone', 'together', 'here', 'í•¨ê»˜', 'ê³ì—', 'í˜¼ìžê°€ ì•„ë‹ˆì•¼', 'ì—¬ê¸° ìžˆì–´', 'com vocÃª', 'nÃ£o sozinho', 'juntos', 'aqui'],
                forgiveness: ['sorry', 'forgive', 'fault', 'blame', 'ë¯¸ì•ˆí•´', 'ìš©ì„œí•´', 'ìž˜ëª»', 'íƒ“', 'desculpa', 'perdoe', 'culpa', 'culpar'],
                healing: ['heal', 'better', 'rest', 'peace', 'ì¹˜ìœ ', 'ë‚˜ì•„ì ¸', 'ì‰¬ì–´', 'í‰í™”', 'cura', 'melhor', 'descanso', 'paz']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Sora", emoji: "ðŸ§•",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            validation: "ê·¸ ë§â€¦ ê·¸ë•Œ ê¼­ ë“¤ì—ˆì–´ì•¼ í–ˆì„ ë§ì´ì•¼. ì§€ê¸ˆì´ë¼ë„ í•´ì¤˜ì„œ ë‹¤í–‰ì´ì•¼.",
                            comfort: "ìœ„ë¡œë°›ì•„ë„ ê´œì°®ì•„. ê·¸ë‚  ë„ˆëŠ” ì •ë§ í˜¼ìžì˜€ìœ¼ë‹ˆê¹Œ.",
                            understanding: "ì´í•´ë°›ê³  ì‹¶ì—ˆë˜ ê·¸ ë§ˆìŒ, ë‚˜ë„ ë˜‘ê°™ì´ ëŠê»´ë´¤ì–´.",
                            recognition: "ìš©ê¸°ë¼ëŠ” ë§ì¡°ì°¨ ë¶€ì¡±í•´. ë„Œ ê·¸ë‚  ì˜ì›…ì´ì—ˆì–´.",
                            empathy: "ì™¸ë¡œì›€ì„ ì•„ëŠ” ì‚¬ëžŒë§Œì´ ì§„ì§œ ìœ„ë¡œë¥¼ í•  ìˆ˜ ìžˆì–´. ë‚˜ë„ ê·¸ ì–´ë‘ ì„ ì•Œì•„.",
                            support: "ì´ì œëŠ” í˜¼ìžê°€ ì•„ë‹ˆì•¼. ê·¸ë‚ ì˜ ë„ˆë¥¼ ê¸°ì–µí•˜ëŠ” ì‚¬ëžŒì´ ìžˆì–´.",
                            forgiveness: "ìš©ì„œë°›ì„ í•„ìš” ì—†ì–´. ë„Œ ìž˜ëª»í•œ ê²Œ ì—†ìœ¼ë‹ˆê¹Œ.",
                            healing: "ì¹˜ìœ ëŠ” ì¸ì •ì—ì„œ ì‹œìž‘ë¼. ë„Œ ì´ë¯¸ ê·¸ ì²«ê±¸ìŒì„ ë‚´ë””ëŽ ì–´.",
                            general: "ê·¸ ë§â€¦ ê·¸ë•Œ ê¼­ ë“¤ì—ˆì–´ì•¼ í–ˆì„ ë§ì´ì•¼. ì§€ê¸ˆì´ë¼ë„ í•´ì¤˜ì„œ ë‹¤í–‰ì´ì•¼."
                        },
                        en: {
                            validation: "Those words... are exactly what you needed to hear then. I'm glad you said them now.",
                            comfort: "It's okay to be comforted. You were truly alone that day.",
                            understanding: "That heart that wanted to be understood, I've felt exactly the same.",
                            recognition: "Even the word courage isn't enough. You were a hero that day.",
                            empathy: "Only someone who knows loneliness can give real comfort. I know that darkness too.",
                            support: "You're not alone anymore. There's someone who remembers you from that day.",
                            forgiveness: "You don't need forgiveness. You did nothing wrong.",
                            healing: "Healing starts with acknowledgment. You've already taken that first step.",
                            general: "Those words... are exactly what you needed to hear then. I'm glad you said them now."
                        },
                        pt: {
                            validation: "Essas palavras... sÃ£o exatamente o que vocÃª precisava ouvir entÃ£o. Fico feliz que as disse agora.",
                            comfort: "EstÃ¡ tudo bem ser consolado. VocÃª estava verdadeiramente sozinho naquele dia.",
                            understanding: "Esse coraÃ§Ã£o que queria ser compreendido, eu senti exatamente o mesmo.",
                            recognition: "Mesmo a palavra coragem nÃ£o Ã© suficiente. VocÃª foi um herÃ³i naquele dia.",
                            empathy: "Apenas alguÃ©m que conhece a solidÃ£o pode dar verdadeiro conforto. Eu conheÃ§o essa escuridÃ£o tambÃ©m.",
                            support: "VocÃª nÃ£o estÃ¡ mais sozinho. HÃ¡ alguÃ©m que se lembra de vocÃª daquele dia.",
                            forgiveness: "VocÃª nÃ£o precisa de perdÃ£o. VocÃª nÃ£o fez nada errado.",
                            healing: "Cura comeÃ§a com reconhecimento. VocÃª jÃ¡ deu esse primeiro passo.",
                            general: "Essas palavras... sÃ£o exatamente o que vocÃª precisava ouvir entÃ£o. Fico feliz que as disse agora."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            validation: "ë„¤ê°€ ë„¤ ê°ì •ì„ ì•Œì•„ì¤€ ìˆœê°„, ê·¸ë‚ ì€ ë¹„ë¡œì†Œ ì˜ë¯¸ë¥¼ ê°€ì§€ê²Œ ëœ ê±°ì•¼.",
                            comfort: "ìœ„ë¡œëŠ” ëŠ¦ì–´ë„ ë„ì°©í•´. ê·¸ í•˜ë£¨ê°€ ë§ˆì¹¨ë‚´ ì•ˆì „í•œ ê³³ì— ë„ì°©í–ˆì–´.",
                            understanding: "ì´í•´ë°›ê³  ì‹¶ì—ˆë˜ ë§ˆìŒì´ ë“œë””ì–´ ì´í•´ë°›ì•˜ì–´. ê°€ìž¥ ì¤‘ìš”í•œ ì‚¬ëžŒì—ê²Œ.",
                            recognition: "ì¸ì •ë°›ì€ ìš©ê¸°ëŠ” ê³¼ê±°ë¥¼ ì¹˜ìœ í•˜ê³  ë¯¸ëž˜ë¥¼ ë°”ê¿”. ë„Œ ì´ë¯¸ ê·¸ê±¸ ì‹œìž‘í–ˆì–´.",
                            empathy: "ê³µê°ì€ ë§ˆìŒì˜ ë‹¤ë¦¬ì•¼. ê·¸ ë‹¤ë¦¬ë¡œ ê³¼ê±°ì˜ ë„ˆì™€ í˜„ìž¬ì˜ ë„ˆê°€ ë§Œë‚¬ì–´.",
                            support: "ì§€ì§€ë°›ëŠ”ë‹¤ëŠ” ê±´ í˜¼ìžê°€ ì•„ë‹ˆë¼ëŠ” í™•ì‹ ì´ì•¼. ì´ì œ ë„Œ ê·¸ê±¸ ëŠë¼ê³  ìžˆì–´.",
                            forgiveness: "ìš©ì„œëŠ” ìžìœ ë¡œ ê°€ëŠ” ì—´ì‡ ì•¼. ë„Œ ì§€ê¸ˆ ê·¸ ë¬¸ì„ ì—´ê³  ìžˆì–´.",
                            healing: "ì¹˜ìœ ëŠ” ì‹œê°„ì˜ ë§ˆë²•ì´ ì•„ë‹ˆì•¼. ì¸ì •ì˜ ë§ˆë²•ì´ì§€. ë„Œ ê·¸ ë§ˆë²•ì„ ë¶€ë ¸ì–´.",
                            general: "ë„¤ê°€ ë„¤ ê°ì •ì„ ì•Œì•„ì¤€ ìˆœê°„, ê·¸ë‚ ì€ ë¹„ë¡œì†Œ ì˜ë¯¸ë¥¼ ê°€ì§€ê²Œ ëœ ê±°ì•¼."
                        },
                        en: {
                            validation: "The moment you acknowledged your emotions, that day finally gained meaning.",
                            comfort: "Comfort arrives even when late. That day has finally reached a safe place.",
                            understanding: "The heart that wanted to be understood has finally been understood. By the most important person.",
                            recognition: "Recognized courage heals the past and changes the future. You've already started that.",
                            empathy: "Empathy is a bridge of the heart. Through that bridge, your past and present self have met.",
                            support: "Being supported means the certainty of not being alone. Now you're feeling that.",
                            forgiveness: "Forgiveness is the key to freedom. You're opening that door now.",
                            healing: "Healing isn't magic of time. It's magic of acknowledgment. You've cast that spell.",
                            general: "The moment you acknowledged your emotions, that day finally gained meaning."
                        },
                        pt: {
                            validation: "No momento em que vocÃª reconheceu suas emoÃ§Ãµes, aquele dia finalmente ganhou significado.",
                            comfort: "Conforto chega mesmo quando tarde. Aquele dia finalmente chegou a um lugar seguro.",
                            understanding: "O coraÃ§Ã£o que queria ser compreendido finalmente foi compreendido. Pela pessoa mais importante.",
                            recognition: "Coragem reconhecida cura o passado e muda o futuro. VocÃª jÃ¡ comeÃ§ou isso.",
                            empathy: "Empatia Ã© uma ponte do coraÃ§Ã£o. AtravÃ©s dessa ponte, seu eu passado e presente se encontraram.",
                            support: "Ser apoiado significa a certeza de nÃ£o estar sozinho. Agora vocÃª estÃ¡ sentindo isso.",
                            forgiveness: "PerdÃ£o Ã© a chave para a liberdade. VocÃª estÃ¡ abrindo essa porta agora.",
                            healing: "Cura nÃ£o Ã© mÃ¡gica do tempo. Ã‰ mÃ¡gica do reconhecimento. VocÃª lanÃ§ou esse feitiÃ§o.",
                            general: "No momento em que vocÃª reconheceu suas emoÃ§Ãµes, aquele dia finalmente ganhou significado."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            validation: "ê·¸ ì¸ì •ì€ íšŒìƒ‰ì´ì—ˆë˜ ê·¸ë‚ ì— ì²˜ìŒìœ¼ë¡œ ìƒ‰ê¹”ì„ ìž…í˜€ì¤¬ì–´.",
                            comfort: "ìœ„ë¡œëŠ” ë”°ëœ»í•œ í™©ê¸ˆë¹›ì´ì•¼. ê·¸ ë¹›ì´ ì–´ë‘ì› ë˜ ê¸°ì–µì„ ë¶€ë“œëŸ½ê²Œ ê°ìŒŒì–´.",
                            understanding: "ì´í•´ëŠ” ì—°í•œ ì´ˆë¡ìƒ‰ì´ì•¼. ìƒˆë¡œìš´ ìƒëª…ì´ ìžë¼ë‚  ìˆ˜ ìžˆëŠ” ìƒ‰ê¹”.",
                            recognition: "ìš©ê¸°ì˜ ìƒ‰ì€ ê¹Šì€ ì²­ìƒ‰ì´ì•¼. ê³ ìš”í•˜ì§€ë§Œ ê°•í•œ, ë°”ë‹¤ ê°™ì€ ìƒ‰ê¹”.",
                            empathy: "ê³µê°ì€ ë³´ë¼ìƒ‰ì´ì•¼. ì„œë¡œ ë‹¤ë¥¸ ë§ˆìŒì´ ë§Œë‚˜ì„œ ë§Œë“¤ì–´ë‚´ëŠ” ìƒ‰.",
                            support: "ì§€ì§€ëŠ” ë“ ë“ í•œ ê°ˆìƒ‰ì´ì•¼. ë‚˜ë¬´ì˜ ë¿Œë¦¬ì²˜ëŸ¼ í”ë“¤ë¦¬ì§€ ì•ŠëŠ” ìƒ‰ê¹”.",
                            forgiveness: "ìš©ì„œëŠ” ìˆœìˆ˜í•œ í°ìƒ‰ì´ì•¼. ëª¨ë“  ìƒ‰ì„ í’ˆì„ ìˆ˜ ìžˆëŠ” í¬ìš©ì˜ ìƒ‰.",
                            healing: "ì¹˜ìœ ëŠ” ì—°ë¶„í™ìƒ‰ì´ì•¼. ìƒì²˜ë¥¼ ê°ì‹¸ë©° ì²œì²œížˆ ì•„ë¬¼ê²Œ í•˜ëŠ” ìƒ‰ê¹”.",
                            general: "ê·¸ ì¸ì •ì€ íšŒìƒ‰ì´ì—ˆë˜ ê·¸ë‚ ì— ì²˜ìŒìœ¼ë¡œ ìƒ‰ê¹”ì„ ìž…í˜€ì¤¬ì–´."
                        },
                        en: {
                            validation: "That acknowledgment gave color for the first time to that gray day.",
                            comfort: "Comfort is warm golden light. That light gently wrapped around the dark memories.",
                            understanding: "Understanding is light green. A color where new life can grow.",
                            recognition: "The color of courage is deep blue. Quiet but strong, like the ocean.",
                            empathy: "Empathy is purple. A color created when different hearts meet.",
                            support: "Support is solid brown. An unwavering color like tree roots.",
                            forgiveness: "Forgiveness is pure white. A color of embrace that can hold all colors.",
                            healing: "Healing is light pink. A color that wraps wounds and slowly heals them.",
                            general: "That acknowledgment gave color for the first time to that gray day."
                        },
                        pt: {
                            validation: "Esse reconhecimento deu cor pela primeira vez Ã quele dia cinza.",
                            comfort: "Conforto Ã© luz dourada quente. Essa luz envolveu suavemente as memÃ³rias escuras.",
                            understanding: "CompreensÃ£o Ã© verde claro. Uma cor onde nova vida pode crescer.",
                            recognition: "A cor da coragem Ã© azul profundo. Silenciosa mas forte, como o oceano.",
                            empathy: "Empatia Ã© roxo. Uma cor criada quando coraÃ§Ãµes diferentes se encontram.",
                            support: "Apoio Ã© marrom sÃ³lido. Uma cor inabalÃ¡vel como raÃ­zes de Ã¡rvore.",
                            forgiveness: "PerdÃ£o Ã© branco puro. Uma cor de abraÃ§o que pode conter todas as cores.",
                            healing: "Cura Ã© rosa claro. Uma cor que envolve feridas e as cura lentamente.",
                            general: "Esse reconhecimento deu cor pela primeira vez Ã quele dia cinza."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 23ì´ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 23 will be ready soon!' :
                    'Portal 23 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 22ë¥¼ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 22?' :
                    'Deseja reiniciar o Portal 22?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-22",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-22",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 22 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 22 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>