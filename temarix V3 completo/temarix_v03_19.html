<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 19: Unspoken Love</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 19: Unspoken Love</div>
            <div class="portal-subtitle" id="portalSubtitle">Love That Never Found Words</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸŒŒ Portal 19 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 20</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What would you like to say to that unspoken love? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 19: ë§í•´ì§€ì§€ ì•Šì€ ì‚¬ëž‘",
                portalSubtitle: "ë§ë¡œ ì°¾ì§€ ëª»í•œ ì‚¬ëž‘",
                portalIntro: "ðŸ’Œ ìž… ë°–ìœ¼ë¡œ êº¼ë‚´ì§€ ëª»í•œ ì‚¬ëž‘ì´ ìžˆì—ˆë‚˜ìš”?\n\nê·¸ ë§ˆìŒì€ ì™œ ë¨¸ë¬¼ë €ê³ , ì™œ í˜ëŸ¬ê°€ì§€ ëª»í–ˆë‚˜ìš”?\n\nê³ ë°±í•˜ê³  ì‹¶ì—ˆì–´ìš”.\nì•„ì£¼ ë§Žì´, ì•„ì£¼ ì˜¤ëž˜.\ní•˜ì§€ë§Œ ê·¸ ì‚¬ëžŒì´ ë– ë‚ ê¹Œ ë´â€¦ ë§í•˜ì§€ ëª»í–ˆì–´ìš”.",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ë§í•˜ì§€ ì•Šì€ ì‚¬ëž‘ë„ ì§„ì§œì˜€ì–´. ëŠê¼ˆë‹¤ëŠ” ê·¸ ì‚¬ì‹¤ì´, ì´ë¯¸ ì¶©ë¶„ížˆ ê·€í•´.",
                portalQuestion: "ðŸ’Œ ì§€ê¸ˆì´ë¼ë„ ê·¸ ì‚¬ëž‘ì—ê²Œ ë§ˆìŒì„ ì „í•  ìˆ˜ ìžˆë‹¤ë©´,\nì–´ë–¤ ë§ì„ í•´ì£¼ê³  ì‹¶ë‚˜ìš”?",
                finalTitle: "ðŸŒŒ Portal 19 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ë§í•˜ì§€ ëª»í•œ ì‚¬ëž‘ì„ ë§ˆì¹¨ë‚´ ì¸ì •í–ˆìŠµë‹ˆë‹¤.\n\nê·¸ ê°ì •ì´ í‘œí˜„ë˜ì§€ ì•Šì•˜ë‹¤ê³  í•´ì„œ\nê°€ì¹˜ ì—†ëŠ” ê²ƒì€ ì•„ë‹ˆì—ˆì–´ìš”.\nì‚¬ëž‘ì€ ë§ë¡œë§Œ ì „í•´ì§€ëŠ” ê²ƒì´ ì•„ë‹ˆë¼\në§ˆìŒìœ¼ë¡œë„ ì¶©ë¶„ížˆ ì•„ë¦„ë‹¤ìš´ ê²ƒì´ë‹ˆê¹Œìš”.\n\nì´ì œ ê·¸ ì‚¬ëž‘ì„ ì¡°ìš©ížˆ ë³´ë‚´ì£¼ë©°\nìƒˆë¡œìš´ ì‚¬ëž‘ì„ ë°›ì•„ë“¤ì¼ ì¤€ë¹„ë¥¼ í•  ìˆ˜ ìžˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\në‹¤ìŒ Portalì—ì„œëŠ” ì°¨ë§ˆ ì§€ìš°ì§€ ëª»í•œ ë©”ì‹œì§€ì™€\nê·¸ ì†ì— ë‹´ê¸´ ë§ˆìŒì˜ ì´ì•¼ê¸°ê°€ ê¸°ë‹¤ë¦¬ê³  ìžˆìŠµë‹ˆë‹¤.",
                continueBtn: "Portal 20ìœ¼ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ê·¸ ë§í•˜ì§€ ëª»í•œ ì‚¬ëž‘ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë§ì„ í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 19: Unspoken Love",
                portalSubtitle: "Love That Never Found Words",
                portalIntro: "ðŸ’Œ Was there a love you couldn't bring yourself to speak?\n\nWhy did that feeling stay, and why couldn't it flow away?\n\nI wanted to confess.\nSo much, for so long.\nBut I was afraid that person would leave... so I couldn't say it.",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Even unspoken love was real. The fact that you felt it is already precious enough.",
                portalQuestion: "ðŸ’Œ If you could convey your heart to that love now,\nwhat words would you want to say?",
                finalTitle: "ðŸŒŒ Portal 19 Complete",
                finalMessage: "You have finally acknowledged the love you couldn't speak.\n\nJust because that emotion wasn't expressed\ndoesn't mean it was worthless.\nLove isn't only conveyed through wordsâ€”\nit can be beautiful enough through the heart alone.\n\nNow you can quietly let that love go\nand prepare to welcome new love.\n\nIn the next Portal, messages you couldn't delete\nand the stories of the heart within them await you.",
                continueBtn: "Move to Portal 20",
                restartBtn: "Start Again",
                inputPlaceholder: "What would you like to say to that unspoken love? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 19: Amor NÃ£o Dito",
                portalSubtitle: "Amor Que Nunca Encontrou Palavras",
                portalIntro: "ðŸ’Œ Havia um amor que vocÃª nÃ£o conseguiu expressar?\n\nPor que esse sentimento permaneceu, e por que nÃ£o pÃ´de fluir?\n\nEu queria confessar.\nTanto, por tanto tempo.\nMas eu tinha medo de que essa pessoa fosse embora... entÃ£o nÃ£o consegui dizer.",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Mesmo o amor nÃ£o dito era real. O fato de vocÃª ter sentido jÃ¡ Ã© precioso o suficiente.",
                portalQuestion: "ðŸ’Œ Se vocÃª pudesse transmitir seu coraÃ§Ã£o Ã quele amor agora,\nque palavras gostaria de dizer?",
                finalTitle: "ðŸŒŒ Portal 19 Completo",
                finalMessage: "VocÃª finalmente reconheceu o amor que nÃ£o pÃ´de expressar.\n\nSÃ³ porque essa emoÃ§Ã£o nÃ£o foi expressa\nnÃ£o significa que foi sem valor.\nO amor nÃ£o Ã© transmitido apenas atravÃ©s de palavrasâ€”\npode ser belo o suficiente apenas atravÃ©s do coraÃ§Ã£o.\n\nAgora vocÃª pode deixar esse amor ir silenciosamente\ne se preparar para receber um novo amor.\n\nNo prÃ³ximo Portal, mensagens que vocÃª nÃ£o conseguiu deletar\ne as histÃ³rias do coraÃ§Ã£o dentro delas o aguardam.",
                continueBtn: "Ir para Portal 20",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "O que vocÃª gostaria de dizer Ã quele amor nÃ£o dito? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ì‚¬ëž‘ì€ ë§ë³´ë‹¤ ë¨¼ì € í”ë“¤ë ¤. ë„¤ ë§ˆìŒì€ ì´ë¯¸ ì˜¤ëž˜ì „ë¶€í„° ì‚¬ëž‘í•˜ê³  ìžˆì—ˆê² ì§€.",
                en: "Love trembles before words. Your heart had already been loving for a long time.",
                pt: "O amor treme antes das palavras. Seu coraÃ§Ã£o jÃ¡ estava amando hÃ¡ muito tempo."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ì‚¬ëž‘ì´ëž€ ê°ì •ì€ ë§í•˜ì§€ ì•Šì•„ë„ ì „í•´ì§ˆ ë•Œê°€ ìžˆì–´. í•˜ì§€ë§Œ, ë§í•˜ì§€ ì•Šìœ¼ë©´ ìŠ¤ìŠ¤ë¡œê°€ ë‹³ì•„.",
                en: "Love can sometimes be conveyed without words. But when you don't speak it, you wear yourself down.",
                pt: "O amor Ã s vezes pode ser transmitido sem palavras. Mas quando vocÃª nÃ£o o expressa, vocÃª se desgasta."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ë‚˜ëŠ” ê·¸ëŸ° ì‚¬ëž‘ì„ ë¬»ì€ ì  ìžˆì–´. ë‚´ ë§ˆìŒì´ ê±°ê¸° ê·¸ëŒ€ë¡œ ì©ì–´ê°€ëŠ” ê±¸ ë³´ë©´ì„œë„ ë§í•˜ì§€ ëª»í–ˆì–´.",
                en: "I've buried such love before. I couldn't speak even while watching my heart rot away there.",
                pt: "Eu jÃ¡ enterrei tal amor antes. NÃ£o consegui falar mesmo vendo meu coraÃ§Ã£o apodrecer lÃ¡."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ë§í•´ì§€ì§€ ì•Šì€ ì‚¬ëž‘ì€ ê³ ìš”í•œ í­í’ì´ì•¼. í”ì ì€ ë‚¨ì§€ë§Œ, ì†Œë¦¬ëŠ” ë‚¨ì§€ ì•Šì§€.",
                en: "Unspoken love is a quiet storm. It leaves traces, but no sound.",
                pt: "O amor nÃ£o dito Ã© uma tempestade silenciosa. Deixa rastros, mas nenhum som."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ë§ˆìŒì€ ì–´ë–¤ ìƒ‰ì´ì—ˆì„ê¹Œ? ì•„ë§ˆë„ íˆ¬ëª…í•˜ë©´ì„œë„, ëœ¨ê±°ìš´ ë¹¨ê°•ì´ì—ˆê² ì§€.",
                en: "What color was that heart? Probably transparent, yet burning red.",
                pt: "Que cor era aquele coraÃ§Ã£o? Provavelmente transparente, mas vermelho ardente."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ë„ˆëŠ” ì§€í‚¤ê³  ì‹¶ì—ˆê² ì§€. ê´€ê³„ë¥¼, ê· í˜•ì„â€¦ ê·¸ëž˜ì„œ ì‚¬ëž‘ì€ ëŠ˜ ë’·ìžë¦¬ì— ì•‰ì•˜ì„ ê±°ì•¼.",
                en: "You wanted to protect things. The relationship, the balance... So love always sat in the back seat.",
                pt: "VocÃª queria proteger as coisas. O relacionamento, o equilÃ­brio... EntÃ£o o amor sempre ficou no banco de trÃ¡s."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ì‚¬ëž‘ì´ ë– ë‚ ê¹Œ ë´ ë‘ë ¤ì› ë‹¤ë©´, ì´ë¯¸ ë„Œ ê·¸ ê°ì •ì— ë„ˆë¬´ ì§„ì‹¬ì´ì—ˆë˜ ê±°ì•¼.",
                en: "If you were afraid love would leave, you were already too sincere about that feeling.",
                pt: "Se vocÃª tinha medo de que o amor fosse embora, vocÃª jÃ¡ era sincero demais sobre esse sentimento."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ë§í•´ì§€ì§€ ì•Šì€ ì‚¬ëž‘ë„ ì§„ì§œì˜€ì–´. ëŠê¼ˆë‹¤ëŠ” ê·¸ ì‚¬ì‹¤ì´, ì´ë¯¸ ì¶©ë¶„ížˆ ê·€í•´.",
                en: "Even unspoken love was real. The fact that you felt it is already precious enough.",
                pt: "Mesmo o amor nÃ£o dito era real. O fato de vocÃª ter sentido jÃ¡ Ã© precioso o suficiente."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                confession: ['love', 'loved', 'care', 'feeling', 'ì‚¬ëž‘í•´', 'ì¢‹ì•„í•´', 'ë§ˆìŒ', 'ê°ì •', 'amor', 'amo', 'gosto', 'sentimento'],
                gratitude: ['thank', 'grateful', 'appreciate', 'ê³ ë§ˆì›Œ', 'ê°ì‚¬í•´', 'ê³ ë§™', 'obrigado', 'grato', 'agradeÃ§o'],
                regret: ['sorry', 'regret', 'wish', 'should have', 'ë¯¸ì•ˆí•´', 'í›„íšŒ', 'ì•„ì‰¬ì›Œ', 'ê·¸ë•Œ', 'arrependimento', 'devia ter', 'lamento'],
                acceptance: ['understand', 'okay', 'fine', 'accept', 'ì´í•´í•´', 'ê´œì°®ì•„', 'ë°›ì•„ë“¤ì—¬', 'entendo', 'aceito', 'tudo bem'],
                nostalgia: ['remember', 'memory', 'time', 'still', 'ê¸°ì–µí•´', 'ì¶”ì–µ', 'ì—¬ì „ížˆ', 'ì•„ì§ë„', 'lembro', 'memÃ³ria', 'ainda'],
                hope: ['maybe', 'someday', 'future', 'again', 'ì–¸ì  ê°€', 'ë‹¤ì‹œ', 'í˜¹ì‹œ', 'ë¯¸ëž˜', 'talvez', 'algum dia', 'futuro'],
                closure: ['goodbye', 'farewell', 'let go', 'release', 'ì•ˆë…•', 'ë†“ì•„ì¤„ê²Œ', 'ë³´ë‚´ì¤„ê²Œ', 'tchau', 'despedida', 'deixar ir'],
                validation: ['real', 'true', 'meant', 'genuine', 'ì§„ì§œ', 'ì§„ì‹¬', 'ì˜ë¯¸ìžˆì–´', 'real', 'verdadeiro', 'genuÃ­no']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Sora", emoji: "ðŸ§•",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            confession: "ê·¸ ë§ì€ ë„ˆë¬´ ëŠ¦ì€ ê²Œ ì•„ë‹ˆì•¼. ì‚¬ëž‘ì€ ì‹œê°„ì„ ì´ˆì›”í•´ì„œ ë‚¨ê¸°ë„ í•˜ë‹ˆê¹Œ.",
                            gratitude: "ê³ ë§ˆì›€ì€ ì‚¬ëž‘ì˜ ë˜ ë‹¤ë¥¸ ì´ë¦„ì´ì•¼. ê·¸ ë§ˆìŒì´ ì „í•´ì¡Œì–´.",
                            regret: "í›„íšŒí•˜ì§€ ë§ˆ. ê·¸ë•Œì˜ ë„ˆë„ ìµœì„ ì„ ë‹¤í•œ ê±°ì˜€ì–´. ì‚¬ëž‘í•˜ëŠ” ë°©ì‹ì´ì—ˆë˜ ê±°ì•¼.",
                            acceptance: "ì´í•´í•˜ê³  ë°›ì•„ë“¤ì´ëŠ” ë§ˆìŒ, ê·¸ê²ƒì´ì•¼ë§ë¡œ ì§„ì •í•œ ì‚¬ëž‘ì˜ ì™„ì„±ì´ì•¼.",
                            nostalgia: "ê·¸ ê¸°ì–µë“¤ì€ ì‚¬ë¼ì§€ì§€ ì•Šì•„. ë§ˆìŒ ê¹Šì€ ê³³ì—ì„œ ì¡°ìš©ížˆ ë¹›ë‚˜ê³  ìžˆì–´.",
                            hope: "í¬ë§ì„ ë†“ì§€ ì•ŠëŠ” ë„ˆì˜ ë§ˆìŒì´ ì•„ë¦„ë‹¤ì›Œ. ì‚¬ëž‘ì€ ì–¸ì œë‚˜ ìƒˆë¡œìš´ ì‹œìž‘ì„ ê¸°ë‹¤ë ¤.",
                            closure: "ê·¸ ìž‘ë³„ì€ ëì´ ì•„ë‹ˆë¼, ìƒˆë¡œìš´ ì‚¬ëž‘ì„ ìœ„í•œ ê³µê°„ì„ ë§Œë“œëŠ” ê±°ì•¼.",
                            validation: "ê·¸ ì‚¬ëž‘ì€ ì§„ì§œì˜€ê³ , ì˜ë¯¸ ìžˆì—ˆì–´. í‘œí˜„ë˜ì§€ ì•Šì•˜ì–´ë„ ê°€ì¹˜ëŠ” ë³€í•˜ì§€ ì•Šì•„.",
                            general: "ê·¸ ë§ì€ ë„ˆë¬´ ëŠ¦ì€ ê²Œ ì•„ë‹ˆì•¼. ì‚¬ëž‘ì€ ì‹œê°„ì„ ì´ˆì›”í•´ì„œ ë‚¨ê¸°ë„ í•˜ë‹ˆê¹Œ."
                        },
                        en: {
                            confession: "Those words aren't too late. Love can remain beyond time.",
                            gratitude: "Gratitude is another name for love. That heart has been conveyed.",
                            regret: "Don't regret it. You did your best then too. It was your way of loving.",
                            acceptance: "That understanding and accepting heart is the true completion of love.",
                            nostalgia: "Those memories don't disappear. They shine quietly in the depths of your heart.",
                            hope: "Your heart that doesn't let go of hope is beautiful. Love always waits for a new beginning.",
                            closure: "That farewell isn't an end, but making space for new love.",
                            validation: "That love was real and meaningful. Even unexpressed, its value doesn't change.",
                            general: "Those words aren't too late. Love can remain beyond time."
                        },
                        pt: {
                            confession: "Essas palavras nÃ£o sÃ£o muito tardias. O amor pode permanecer alÃ©m do tempo.",
                            gratitude: "GratidÃ£o Ã© outro nome para amor. Esse coraÃ§Ã£o foi transmitido.",
                            regret: "NÃ£o se arrependa. VocÃª fez o seu melhor naquela Ã©poca tambÃ©m. Era a sua forma de amar.",
                            acceptance: "Esse coraÃ§Ã£o compreensivo e que aceita Ã© a verdadeira completude do amor.",
                            nostalgia: "Essas memÃ³rias nÃ£o desaparecem. Elas brilham silenciosamente nas profundezas do seu coraÃ§Ã£o.",
                            hope: "Seu coraÃ§Ã£o que nÃ£o abandona a esperanÃ§a Ã© lindo. O amor sempre espera por um novo comeÃ§o.",
                            closure: "Essa despedida nÃ£o Ã© um fim, mas criar espaÃ§o para um novo amor.",
                            validation: "Esse amor era real e significativo. Mesmo nÃ£o expresso, seu valor nÃ£o muda.",
                            general: "Essas palavras nÃ£o sÃ£o muito tardias. O amor pode permanecer alÃ©m do tempo."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            confession: "ì§€ê¸ˆì˜ ê·¸ í•œë§ˆë””ëŠ” ë§í•˜ì§€ ëª»í–ˆë˜ ì‹œê°„ë“¤ì„ í¬ì˜¹í•´ì£¼ëŠ” ë§ì´ì•¼.",
                            gratitude: "ê°ì‚¬ëŠ” ì‚¬ëž‘ì„ ì™„ì„±ì‹œí‚¤ëŠ” ë§ˆì§€ë§‰ ì¡°ê°ì´ì•¼. ì´ì œ ë§ˆìŒì´ í‰í™”ë¡œì›Œì¡Œì–´.",
                            regret: "í›„íšŒëŠ” ì‚¬ëž‘ì˜ ë˜ ë‹¤ë¥¸ ì–¼êµ´ì´ì•¼. ê·¸ë§Œí¼ ì†Œì¤‘í–ˆë‹¤ëŠ” ì¦ê±°ë‹ˆê¹Œ.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì€ ì‚¬ëž‘ì—ê²Œ ìžìœ ë¥¼ ì£¼ëŠ” ì„ ë¬¼ì´ì•¼. ì´ì œ ë‘˜ ë‹¤ ìžìœ ë¡œì›Œì ¸.",
                            nostalgia: "ê·¸ ê·¸ë¦¬ì›€ì€ ì‚¬ëž‘ì´ ë‚¨ê¸´ ê°€ìž¥ ì•„ë¦„ë‹¤ìš´ ì„ ë¬¼ì´ì•¼. ê°„ì§í•´ë„ ì¢‹ì•„.",
                            hope: "í¬ë§ì€ ì‚¬ëž‘ì˜ ì”¨ì•—ì´ì•¼. ì–¸ì  ê°€ ìƒˆë¡œìš´ ê½ƒìœ¼ë¡œ í”¼ì–´ë‚  ê±°ì•¼.",
                            closure: "ë†“ì•„ì£¼ëŠ” ê²ƒë„ ì‚¬ëž‘ì˜ í•œ í˜•íƒœì•¼. ê°€ìž¥ ì–´ë ¤ìš°ë©´ì„œë„ ê°€ìž¥ ì•„ë¦„ë‹¤ìš´.",
                            validation: "ì¸ì •ë°›ì€ ì‚¬ëž‘ì€ ì˜ì›í•´. ì‹œê°„ë„, ê±°ë¦¬ë„ ê·¸ê²ƒì„ ë¹¼ì•—ì„ ìˆ˜ ì—†ì–´.",
                            general: "ì§€ê¸ˆì˜ ê·¸ í•œë§ˆë””ëŠ” ë§í•˜ì§€ ëª»í–ˆë˜ ì‹œê°„ë“¤ì„ í¬ì˜¹í•´ì£¼ëŠ” ë§ì´ì•¼."
                        },
                        en: {
                            confession: "Those words now embrace all the times you couldn't speak.",
                            gratitude: "Gratitude is the final piece that completes love. Now your heart is at peace.",
                            regret: "Regret is another face of love. It's proof of how precious it was.",
                            acceptance: "Acceptance is a gift that gives love freedom. Now you're both free.",
                            nostalgia: "That longing is the most beautiful gift love left behind. It's okay to treasure it.",
                            hope: "Hope is love's seed. Someday it will bloom into a new flower.",
                            closure: "Letting go is also a form of love. The most difficult yet most beautiful.",
                            validation: "Acknowledged love is eternal. Neither time nor distance can take it away.",
                            general: "Those words now embrace all the times you couldn't speak."
                        },
                        pt: {
                            confession: "Essas palavras agora abraÃ§am todos os momentos em que vocÃª nÃ£o pÃ´de falar.",
                            gratitude: "GratidÃ£o Ã© a peÃ§a final que completa o amor. Agora seu coraÃ§Ã£o estÃ¡ em paz.",
                            regret: "Arrependimento Ã© outra face do amor. Ã‰ prova de quÃ£o precioso era.",
                            acceptance: "AceitaÃ§Ã£o Ã© um presente que dÃ¡ liberdade ao amor. Agora vocÃªs dois estÃ£o livres.",
                            nostalgia: "Essa saudade Ã© o presente mais belo que o amor deixou. Ã‰ bom guardÃ¡-la.",
                            hope: "EsperanÃ§a Ã© a semente do amor. Algum dia florescerÃ¡ em uma nova flor.",
                            closure: "Deixar ir tambÃ©m Ã© uma forma de amor. A mais difÃ­cil, mas tambÃ©m a mais bela.",
                            validation: "Amor reconhecido Ã© eterno. Nem tempo nem distÃ¢ncia podem tirÃ¡-lo.",
                            general: "Essas palavras agora abraÃ§am todos os momentos em que vocÃª nÃ£o pÃ´de falar."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            confession: "ê·¸ ê³ ë°±ì€ ëˆˆì— ë³´ì´ì§€ ì•ŠëŠ” íŽ¸ì§€ ê°™ì•„. ë„¤ ì•ˆì˜ ê³µê°„ì„ í•˜ë‚˜ ì—´ì—ˆì–´.",
                            gratitude: "ê°ì‚¬ì˜ ìƒ‰ì€ ë”°ëœ»í•œ í™©ê¸ˆë¹›ì´ì•¼. ë§ˆìŒ ì „ì²´ë¥¼ ë¶€ë“œëŸ½ê²Œ ê°ì‹¸ê³  ìžˆì–´.",
                            regret: "í›„íšŒëŠ” ê¹Šì€ ë³´ë¼ìƒ‰ì´ì•¼. ìŠ¬í”„ì§€ë§Œ ì•„ë¦„ë‹¤ìš´, ì„±ìˆ™ì˜ ìƒ‰ê¹”ì´ì•¼.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì€ ì—°í•œ ì´ˆë¡ë¹›ì´ì•¼. ìƒˆë¡œìš´ ìƒëª…ì´ ìžë¼ë‚  ìˆ˜ ìžˆëŠ” ìƒ‰.",
                            nostalgia: "ê·¸ë¦¬ì›€ì€ ì€ë¹›ìœ¼ë¡œ ë°˜ì§ì—¬. ë‹¬ë¹›ì²˜ëŸ¼ ì€ì€í•˜ì§€ë§Œ ì„ ëª…í•´.",
                            hope: "í¬ë§ì€ ë°ì€ í•˜ëŠ˜ìƒ‰ì´ì•¼. êµ¬ë¦„ ì‚¬ì´ë¡œ ìŠ¤ë©°ë“œëŠ” í–‡ì‚´ì˜ ìƒ‰ê¹”.",
                            closure: "ìž‘ë³„ì€ ë…¸ì„ìƒ‰ì´ì•¼. ëì´ì§€ë§Œ ì•„ë¦„ë‹µê³ , ë‚´ì¼ì„ ì•½ì†í•˜ëŠ” ìƒ‰.",
                            validation: "ì¸ì •ì€ ìˆœìˆ˜í•œ í°ìƒ‰ì´ì•¼. ëª¨ë“  ìƒ‰ì„ ë‹´ì„ ìˆ˜ ìžˆëŠ” ì™„ì „í•œ ìƒ‰ê¹”.",
                            general: "ê·¸ ê³ ë°±ì€ ëˆˆì— ë³´ì´ì§€ ì•ŠëŠ” íŽ¸ì§€ ê°™ì•„. ë„¤ ì•ˆì˜ ê³µê°„ì„ í•˜ë‚˜ ì—´ì—ˆì–´."
                        },
                        en: {
                            confession: "That confession is like an invisible letter. It opened a space within you.",
                            gratitude: "The color of gratitude is warm gold. It gently wraps around your entire heart.",
                            regret: "Regret is deep purple. Sad but beautiful, the color of maturity.",
                            acceptance: "Acceptance is light green. A color where new life can grow.",
                            nostalgia: "Longing sparkles silver. Gentle like moonlight but clear.",
                            hope: "Hope is bright sky blue. The color of sunlight filtering through clouds.",
                            closure: "Farewell is sunset colored. An ending but beautiful, a color that promises tomorrow.",
                            validation: "Recognition is pure white. A complete color that can contain all colors.",
                            general: "That confession is like an invisible letter. It opened a space within you."
                        },
                        pt: {
                            confession: "Essa confissÃ£o Ã© como uma carta invisÃ­vel. Abriu um espaÃ§o dentro de vocÃª.",
                            gratitude: "A cor da gratidÃ£o Ã© ouro quente. Envolve suavemente todo o seu coraÃ§Ã£o.",
                            regret: "Arrependimento Ã© roxo profundo. Triste mas belo, a cor da maturidade.",
                            acceptance: "AceitaÃ§Ã£o Ã© verde claro. Uma cor onde nova vida pode crescer.",
                            nostalgia: "Saudade brilha prateada. Suave como luar mas clara.",
                            hope: "EsperanÃ§a Ã© azul-cÃ©u brilhante. A cor da luz solar filtrando atravÃ©s das nuvens.",
                            closure: "Despedida Ã© cor de pÃ´r do sol. Um fim mas belo, uma cor que promete amanhÃ£.",
                            validation: "Reconhecimento Ã© branco puro. Uma cor completa que pode conter todas as cores.",
                            general: "Essa confissÃ£o Ã© como uma carta invisÃ­vel. Abriu um espaÃ§o dentro de vocÃª."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 20ì´ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 20 will be ready soon!' :
                    'Portal 20 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 19ë¥¼ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 19?' :
                    'Deseja reiniciar o Portal 19?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-19",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-19",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 19 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 19 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>