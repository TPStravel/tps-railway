<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 08: The Box That Hides Memories</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 08: The Box That Hides Memories</div>
            <div class="portal-subtitle" id="portalSubtitle">Memories You Tried Not to Remember</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸ“¦ Portal 08 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 09</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What would you like to say to that memory in the box now? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 08: ê¸°ì–µì„ ê°ì¶˜ ìƒìž",
                portalSubtitle: "ê¸°ì–µí•˜ì§€ ì•Šìœ¼ë ¤ í–ˆë˜ ìˆœê°„ë“¤",
                portalIntro: "ðŸ“¦ ë‹¹ì‹ ì´ ê¸°ì–µí•˜ì§€ ì•Šìœ¼ë ¤ í–ˆë˜ ìˆœê°„ì´ ìžˆì—ˆë‚˜ìš”?\n\nê·¸ ê¸°ì–µì€ ì–´ë–¤ ìƒìžì— ë‹´ê²¨, ì§€ê¸ˆ ì–´ë””ì— ìˆ¨ì–´ ìžˆë‚˜ìš”?\n\nì–´ë–¤ ê¸°ì–µë“¤ì€ ë„ˆë¬´ ì•„í”„ê±°ë‚˜, ë„ˆë¬´ ë¬´ê²ê±°ë‚˜, ë„ˆë¬´ ë³µìž¡í•´ì„œ\në§ˆìŒ ê¹Šì€ ê³³ ì–´ë”˜ê°€ì— ë‹¨ë‹¨ížˆ ë¬»ì–´ë‘ê²Œ ë©ë‹ˆë‹¤.\n\n\"ê·¸ë•Œ ìžˆì—ˆë˜ ì¼ì€ ë– ì˜¬ë¦¬ëŠ” ê²ƒì¡°ì°¨ ì‹«ì–´.\"\n\"ë§ˆì¹˜ ê·¸ ìž¥ë©´ì„ ë³´ë©´ ë‚´ê°€ ë‹¤ì‹œ ë¬´ë„ˆì§ˆ ê²ƒ ê°™ì•„ì„œâ€¦\"\n\"ê·¸ëƒ¥ ëšœê»‘ì„ ë‹«ê³  ìˆ¨ê²¨ë’€ì–´.\"\n\ní•˜ì§€ë§Œ ê°ì¶°ë‘” ê¸°ì–µë„ ì‚´ì•„ ìžˆìŠµë‹ˆë‹¤.\nê·¸ ìƒìž ì•ˆì—ì„œ ì¡°ìš©ížˆ ìˆ¨ ì‰¬ë©°, ë•Œë•Œë¡œ ë¬¸ì„ ë‘ë“œë¦¬ì£ .\n\nì˜¤ëŠ˜ì€ ê·¸ ìƒìž ì•žì— ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ì„œë³´ëŠ” ì‹œê°„ìž…ë‹ˆë‹¤.",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ê¸°ì–µì„ ê°ì¶˜ë‹¤ê³  í•´ì„œ ì‚¬ë¼ì§€ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. ë‹¤ë§Œ ê·¸ê²ƒì€ ë” ê¹Šì€ ì–´ë‘  ì†ì—ì„œ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦¬ê³  ìžˆì„ ë¿ìž…ë‹ˆë‹¤.",
                portalQuestion: "ðŸ“¦ ê·¸ ìƒìž ì† ê¸°ì–µì—ê²Œ, ì§€ê¸ˆ ë‹¹ì‹ ì´ ì „í•˜ê³  ì‹¶ì€ ë§ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                finalTitle: "ðŸ“¦ Portal 08 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ìš©ê¸° ìžˆê²Œ ê°ì¶°ë‘” ê¸°ì–µì˜ ìƒìžë¥¼ ë§ˆì£¼í–ˆìŠµë‹ˆë‹¤.\n\nê·¸ë™ì•ˆ í”¼í•˜ê³  ì‹¶ì—ˆë˜ ê·¸ ê¸°ì–µë“¤ì´\nì–¼ë§ˆë‚˜ ë¬´ê±°ì› ëŠ”ì§€, ì–¼ë§ˆë‚˜ ì™¸ë¡œì› ëŠ”ì§€\nì¸ì •í•˜ê²Œ ë˜ì—ˆì£ .\n\nì´ì œ ê·¸ ìƒìžë¥¼ ë‹¤ì‹œ ì—´ í•„ìš”ëŠ” ì—†ì§€ë§Œ,\nê·¸ê²ƒì´ ì¡´ìž¬í•œë‹¤ëŠ” ê²ƒì„ ë°›ì•„ë“¤ì¼ ìˆ˜ ìžˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\në‹¤ìŒ Portalì—ì„œëŠ” ë¶€ì„œì§„ ì¹¨ë¬µì˜ ì¡°ê°ë“¤ì„\ní•˜ë‚˜ì”© ëª¨ì•„ë³´ëŠ” ì—¬ì •ì´ ì´ì–´ì§‘ë‹ˆë‹¤.",
                continueBtn: "Portal 09ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ê·¸ ìƒìž ì† ê¸°ì–µì—ê²Œ ì§€ê¸ˆ ì–´ë–¤ ë§ì„ í•´ì£¼ê³  ì‹¶ì€ì§€ ë§í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 08: The Box That Hides Memories",
                portalSubtitle: "Memories You Tried Not to Remember",
                portalIntro: "ðŸ“¦ Have you ever had moments you tried not to remember?\n\nIn what kind of box are those memories kept, and where are they hiding now?\n\nSome memories are too painful, too heavy, or too complicated,\nso we bury them deep somewhere in our hearts.\n\n\"I hate even thinking about what happened then.\"\n\"It feels like I'd collapse again if I saw that scene...\"\n\"So I just closed the lid and hid it away.\"\n\nBut hidden memories are still alive.\nThey breathe quietly in that box, sometimes knocking on the door.\n\nToday is a time to carefully stand before that box.",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Hiding memories doesn't make them disappear. They are simply waiting for you in deeper darkness.",
                portalQuestion: "ðŸ“¦ What would you like to say to that memory in the box now?",
                finalTitle: "ðŸ“¦ Portal 08 Complete",
                finalMessage: "You have courageously faced the box of hidden memories.\n\nYou've come to acknowledge how heavy\nand how lonely those memories\nyou wanted to avoid have been.\n\nNow you don't need to reopen that box,\nbut you can accept that it exists.\n\nIn the next Portal, a journey continues\nto gather the fragments of broken silence\none by one.",
                continueBtn: "Move to Portal 09",
                restartBtn: "Start Again",
                inputPlaceholder: "What would you like to say to that memory in the box now? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 08: A Caixa que Esconde MemÃ³rias",
                portalSubtitle: "MemÃ³rias que Tentou NÃ£o Lembrar",
                portalIntro: "ðŸ“¦ VocÃª jÃ¡ teve momentos que tentou nÃ£o lembrar?\n\nEm que tipo de caixa essas memÃ³rias estÃ£o guardadas, e onde estÃ£o se escondendo agora?\n\nAlgumas memÃ³rias sÃ£o muito dolorosas, muito pesadas, ou muito complicadas,\nentÃ£o as enterramos bem fundo em algum lugar dos nossos coraÃ§Ãµes.\n\n\"Eu odeio atÃ© mesmo pensar no que aconteceu entÃ£o.\"\n\"Parece que eu desabaria de novo se visse aquela cena...\"\n\"EntÃ£o eu apenas fechei a tampa e escondi.\"\n\nMas memÃ³rias escondidas ainda estÃ£o vivas.\nElas respiram silenciosamente naquela caixa, Ã s vezes batendo na porta.\n\nHoje Ã© um momento para ficar cuidadosamente diante daquela caixa.",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Esconder memÃ³rias nÃ£o as faz desaparecer. Elas estÃ£o simplesmente esperando por vocÃª na escuridÃ£o mais profunda.",
                portalQuestion: "ðŸ“¦ O que vocÃª gostaria de dizer para aquela memÃ³ria na caixa agora?",
                finalTitle: "ðŸ“¦ Portal 08 Completo",
                finalMessage: "VocÃª corajosamente enfrentou a caixa de memÃ³rias escondidas.\n\nVocÃª passou a reconhecer o quÃ£o pesadas\ne o quÃ£o solitÃ¡rias foram essas memÃ³rias\nque vocÃª queria evitar.\n\nAgora vocÃª nÃ£o precisa reabrir aquela caixa,\nmas pode aceitar que ela existe.\n\nNo prÃ³ximo Portal, uma jornada continua\npara reunir os fragmentos do silÃªncio quebrado\num por um.",
                continueBtn: "Ir para Portal 09",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "O que vocÃª gostaria de dizer para aquela memÃ³ria na caixa agora? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ê·¸ ìƒìžëŠ” ë‹¨ì§€ ë‹«ížŒ ê²Œ ì•„ë‹ˆì•¼. ë„¤ ë§ˆìŒì˜ ì–´ë‘ìš´ êµ¬ì„ ì–´ë”˜ê°€ì— ë¬»í˜€ ìžˆì—ˆì§€.",
                en: "That box isn't just closed. It was buried somewhere in the dark corners of your heart.",
                pt: "Aquela caixa nÃ£o estÃ¡ apenas fechada. Foi enterrada em algum lugar nos cantos escuros do seu coraÃ§Ã£o."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ê¸°ì–µì„ í”¼í•˜ëŠ” ê±´ ë¶€ë„ëŸ¬ìš´ ê²Œ ì•„ë‹ˆì•¼. ê·¸ê±´ ë„¤ê°€ ë„ˆ ìžì‹ ì„ ì§€í‚¤ë ¤ëŠ” ë°©ì‹ì´ì—ˆì–´.",
                en: "Avoiding memories isn't shameful. It was your way of protecting yourself.",
                pt: "Evitar memÃ³rias nÃ£o Ã© vergonhoso. Era sua maneira de se proteger."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ê·¸ ìƒìž ì•ˆì—ëŠ” ì•„í””ë§Œ ìžˆëŠ” ê²Œ ì•„ë‹ˆì•¼. ì™¸ë©´ë‹¹í•œ ë„ˆì˜ ëª©ì†Œë¦¬ë„ í•¨ê»˜ ìžˆì—ˆì–´.",
                en: "That box doesn't only contain pain. Your neglected voice was also in there.",
                pt: "Aquela caixa nÃ£o contÃ©m apenas dor. Sua voz negligenciada tambÃ©m estava lÃ¡."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ê¸°ì–µì„ ê°ì¶˜ë‹¤ê³  í•´ì„œ, ê·¸ê²ƒì´ ì‚¬ë¼ì§€ëŠ” ê±´ ì•„ë‹ˆì§€. ë‹¤ë§Œ ê·¸ê²ƒì€ ë” ê¹Šì€ ì–´ë‘  ì†ì—ì„œ ìžë¼ë‚  ë¿ì´ì•¼.",
                en: "Hiding memories doesn't make them disappear. They just grow in deeper darkness.",
                pt: "Esconder memÃ³rias nÃ£o as faz desaparecer. Elas apenas crescem na escuridÃ£o mais profunda."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ìƒìžëŠ” ì–´ë–¤ ìƒ‰ì´ì—ˆì„ê¹Œ? ë„ˆë¬´ ê²€ì–´ì„œ ë³¼ ìˆ˜ ì—†ë˜, í˜¹ì€ ë„ˆë¬´ ë°ì•„ì„œ ëˆˆì„ ëŒë ¤ì•¼ í–ˆë˜.",
                en: "What color was that box? Too black to see, or perhaps too bright that you had to look away?",
                pt: "Que cor tinha aquela caixa? Muito preta para ver, ou talvez muito brilhante que vocÃª teve que desviar o olhar?"
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ê·¸ê±¸ ë‹¤ì‹œ ì—´ë©´ ë¬´ë„ˆì§ˆê¹Œ ë‘ë µê² ì§€. í•˜ì§€ë§Œ ë„¤ê°€ ê°•í•´ì ¸ì•¼ë§Œ ì—´ ìˆ˜ ìžˆëŠ” ê±´ ì•„ë‹ˆì•¼.",
                en: "You're afraid you'll collapse if you open it again. But you don't need to be strong to open it.",
                pt: "VocÃª tem medo de desabar se abri-la novamente. Mas vocÃª nÃ£o precisa ser forte para abri-la."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ê·¸ ìƒìžëŠ” í˜¼ìž ì—´ í•„ìš”ëŠ” ì—†ì–´. ëˆ„êµ°ê°€ì™€ í•¨ê»˜ ì—´ë©´, ë¬´ì„­ë˜ ê·¸ë¦¼ìžë„ ì¡°ê¸ˆì€ ìž‘ì•„ì ¸.",
                en: "You don't need to open that box alone. If you open it with someone, even scary shadows become smaller.",
                pt: "VocÃª nÃ£o precisa abrir aquela caixa sozinho. Se vocÃª abrir com alguÃ©m, atÃ© sombras assustadoras se tornam menores."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ì§€ê¸ˆ ë„Œ ê·¸ ìƒìžë¥¼ ë°”ë¼ë³´ê³  ìžˆì–´. ê·¸ê²ƒë§Œìœ¼ë¡œë„, ì´ë¯¸ ì²« ê±¸ìŒì„ ë‚´ë””ë”˜ ê±°ì•¼.",
                en: "You're looking at that box now. That alone means you've already taken the first step.",
                pt: "VocÃª estÃ¡ olhando para aquela caixa agora. Isso por si sÃ³ significa que vocÃª jÃ¡ deu o primeiro passo."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                sorry: ['sorry', 'apologize', 'regret', 'forgive'],
                angry: ['angry', 'mad', 'hate', 'furious', 'rage'],
                sad: ['sad', 'hurt', 'pain', 'lonely', 'cry'],
                peaceful: ['peace', 'calm', 'quiet', 'rest', 'gentle'],
                understanding: ['understand', 'accept', 'okay', 'fine'],
                brave: ['brave', 'strong', 'courage', 'face', 'ready'],
                thank: ['thank', 'grateful', 'appreciate'],
                release: ['let go', 'release', 'free', 'goodbye']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Sora", emoji: "ðŸ§•",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            sorry: "ë¯¸ì•ˆí•˜ë‹¤ê³  ë§í•  í•„ìš”ëŠ” ì—†ì–´. ê·¸ ê¸°ì–µë„ ë„¤ê°€ ì‚´ì•„ì˜¨ ì¼ë¶€ë‹ˆê¹Œ.",
                            angry: "í™”ê°€ ë‚˜ëŠ” ê±´ ë‹¹ì—°í•´. ê·¸ ê°ì •ë„ ë¬»ì–´ë‘˜ í•„ìš” ì—†ì–´.",
                            sad: "ìŠ¬í¼í•´ë„ ê´œì°®ì•„. ê·¸ ëˆˆë¬¼ì´ ìƒìžë¥¼ ì”»ì–´ì¤„ ê±°ì•¼.",
                            peaceful: "í‰ì˜¨í•¨ì„ ì°¾ì•˜êµ¬ë‚˜. ì´ì œ ê·¸ ìƒìžì™€ í•¨ê»˜ ìˆ¨ ì‰´ ìˆ˜ ìžˆì–´.",
                            understanding: "ì´í•´í–ˆë‹¤ëŠ” ê±´ ìš©ê¸° ìžˆëŠ” ì¼ì´ì•¼. ë°›ì•„ë“¤ìž„ì´ ì¹˜ìœ ì˜ ì‹œìž‘ì´ì•¼.",
                            brave: "ìš©ê°í•˜ê²Œ ë§ˆì£¼í–ˆêµ¬ë‚˜. ì´ì œ ê·¸ ê¸°ì–µì´ ë„ ì§€ë°°í•˜ì§€ ì•Šì„ ê±°ì•¼.",
                            thank: "ê³ ë§ˆì›Œí•˜ëŠ” ë§ˆìŒì´ ëŠê»´ì ¸. ê·¸ ê¸°ì–µë„ ë„¤ ê°ì‚¬ë¥¼ ê¸°ë‹¤ë ¸ì„ì§€ ëª°ë¼.",
                            release: "ë†“ì•„ì£¼ëŠ” ê²ƒë„ ì‚¬ëž‘ì˜ í•œ í˜•íƒœì•¼. ìžìœ ë¡œì›Œì ¸ë„ ê´œì°®ì•„.",
                            general: "ë„ˆëŠ” ë²„ë¦° ê²Œ ì•„ë‹ˆë¼, ë„ë§ì¹œ ê±°ì•¼. ê·¸ë¦¬ê³  ì§€ê¸ˆì€â€¦ ëŒì•„ì˜¨ ê±°ì•¼."
                        },
                        en: {
                            sorry: "You don't need to say sorry. That memory is also part of how you've lived.",
                            angry: "It's natural to be angry. You don't need to bury that emotion either.",
                            sad: "It's okay to be sad. Those tears will wash the box clean.",
                            peaceful: "You've found peace. Now you can breathe together with that box.",
                            understanding: "Understanding is a courageous thing. Acceptance is the beginning of healing.",
                            brave: "You've bravely faced it. Now that memory won't dominate you.",
                            thank: "I feel your gratitude. That memory might have been waiting for your thanks.",
                            release: "Letting go is also a form of love. It's okay to become free.",
                            general: "You didn't abandon it, you ran away. And now... you've come back."
                        },
                        pt: {
                            sorry: "VocÃª nÃ£o precisa pedir desculpas. Essa memÃ³ria tambÃ©m Ã© parte de como vocÃª viveu.",
                            angry: "Ã‰ natural estar com raiva. VocÃª nÃ£o precisa enterrar essa emoÃ§Ã£o tambÃ©m.",
                            sad: "EstÃ¡ tudo bem estar triste. Essas lÃ¡grimas vÃ£o limpar a caixa.",
                            peaceful: "VocÃª encontrou paz. Agora pode respirar junto com aquela caixa.",
                            understanding: "Compreender Ã© uma coisa corajosa. A aceitaÃ§Ã£o Ã© o inÃ­cio da cura.",
                            brave: "VocÃª enfrentou corajosamente. Agora essa memÃ³ria nÃ£o vai te dominar.",
                            thank: "Sinto sua gratidÃ£o. Essa memÃ³ria pode ter estado esperando por seu agradecimento.",
                            release: "Deixar ir tambÃ©m Ã© uma forma de amor. EstÃ¡ tudo bem se tornar livre.",
                            general: "VocÃª nÃ£o a abandonou, vocÃª fugiu. E agora... vocÃª voltou."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Kael", emoji: "ðŸ§™",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            sorry: "ì‚¬ê³¼ëŠ” ì¹˜ìœ ì˜ ì‹œìž‘ì´ì•¼. ê·¸ ê¸°ì–µë„ ë„¤ ìš©ì„œë¥¼ ê¸°ë‹¤ë ¸ì„ì§€ ëª°ë¼.",
                            angry: "ê·¸ ë¶„ë…¸ë¥¼ ëŠê»´ë´. ê·¸ê²ƒë„ ì§„ì‹¤ì´ê³ , ë¬»ì–´ë‘˜ í•„ìš” ì—†ì–´.",
                            sad: "ìŠ¬í””ì€ ì •ì§í•œ ê°ì •ì´ì•¼. ê·¸ ë¬´ê²Œë¥¼ ì¸ì •í•˜ëŠ” ê²Œ ì²«ê±¸ìŒì´ì•¼.",
                            peaceful: "í‰í™”ë¥¼ ì°¾ì€ ë„ˆì˜ ë§ˆìŒì´ ë³´ì—¬. ì´ì œ ê·¸ ìƒìžë„ ì¡°ìš©í•´ì§ˆ ê±°ì•¼.",
                            understanding: "ì´í•´í•œë‹¤ëŠ” ê±´ íž˜ë“  ì¼ì´ì•¼. í•˜ì§€ë§Œ ë„Œ í•´ëƒˆì–´.",
                            brave: "ìš©ê¸°ë¥¼ ë‚¸ ê±¸ ì•Œì•„. ê·¸ ë‘ë ¤ì›€ê³¼ ë§žì„  ë„ˆë¥¼ ì¡´ê²½í•´.",
                            thank: "ê°ì‚¬ì˜ ë§ˆìŒì´ ì „í•´ì ¸. ê·¸ê²ƒì´ ê°€ìž¥ ê°•ë ¥í•œ ì¹˜ìœ ì˜ íž˜ì´ì•¼.",
                            release: "ìžìœ ë¡­ê²Œ ë†“ì•„ì£¼ëŠ” ê±°ì•¼. ê·¸ê²ƒì´ ì§„ì •í•œ ê°•í•¨ì´ì•¼.",
                            general: "ê·¸ ë‘ë ¤ì›€ì€ ì§„ì§œì˜€ê³ , ê·¸ ë–¨ë¦¼ë„ ì§„ì§œì˜€ì–´. ê°ì •ì€ ì •ì§í•˜ê³ , ì§€ê¸ˆ ë„ˆë„ ê·¸ëž˜."
                        },
                        en: {
                            sorry: "Apology is the beginning of healing. That memory might have been waiting for your forgiveness.",
                            angry: "Feel that anger. It's also truth, and doesn't need to be buried.",
                            sad: "Sadness is an honest emotion. Acknowledging its weight is the first step.",
                            peaceful: "I see your peaceful heart. Now that box will also become quiet.",
                            understanding: "Understanding is difficult. But you've done it.",
                            brave: "I know you've been brave. I respect you for facing that fear.",
                            thank: "Your gratitude comes through. That's the most powerful healing force.",
                            release: "You're freely letting it go. That's true strength.",
                            general: "That fear was real, and that trembling was real too. Emotions are honest, and so are you now."
                        },
                        pt: {
                            sorry: "O pedido de desculpas Ã© o inÃ­cio da cura. Essa memÃ³ria pode ter estado esperando por seu perdÃ£o.",
                            angry: "Sinta essa raiva. TambÃ©m Ã© verdade, e nÃ£o precisa ser enterrada.",
                            sad: "A tristeza Ã© uma emoÃ§Ã£o honesta. Reconhecer seu peso Ã© o primeiro passo.",
                            peaceful: "Vejo seu coraÃ§Ã£o em paz. Agora aquela caixa tambÃ©m ficarÃ¡ quieta.",
                            understanding: "Compreender Ã© difÃ­cil. Mas vocÃª conseguiu.",
                            brave: "Sei que vocÃª foi corajoso. Respeito vocÃª por enfrentar esse medo.",
                            thank: "Sua gratidÃ£o se manifesta. Essa Ã© a forÃ§a de cura mais poderosa.",
                            release: "VocÃª estÃ¡ deixando ir livremente. Essa Ã© a verdadeira forÃ§a.",
                            general: "Aquele medo era real, e aquele tremor tambÃ©m era real. As emoÃ§Ãµes sÃ£o honestas, e vocÃª tambÃ©m Ã© agora."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Enya", emoji: "ðŸ§‘â€ðŸš€",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            sorry: "ë¯¸ì•ˆí•˜ë‹¤ëŠ” ë§ì´ ë„¤ ë§ˆìŒì„ ê°€ë³ê²Œ í•´ì¤„ ê±°ì•¼. ìš©ì„œëŠ” ìžìœ ë¡œì›€ì´ì•¼.",
                            angry: "ê·¸ í™”ë„ ë„¤ ì¼ë¶€ì•¼. ê°ì •ì„ ìˆ¨ê¸°ì§€ ì•Šì•„ë„ ë¼.",
                            sad: "ëˆˆë¬¼ì„ í˜ë ¤ë„ ê´œì°®ì•„. ê·¸ê²ƒë„ ë„¤ê°€ ì‚´ì•„ìžˆë‹¤ëŠ” ì¦ê±°ì•¼.",
                            peaceful: "í‰ì˜¨í•¨ ì†ì—ì„œ ë‹µì„ ì°¾ì•˜êµ¬ë‚˜. ì´ì œ ì•žìœ¼ë¡œ ë‚˜ì•„ê°ˆ ìˆ˜ ìžˆì–´.",
                            understanding: "ë°›ì•„ë“¤ì´ëŠ” ë§ˆìŒì´ ë³´ì—¬. ê·¸ê²ƒì´ ê°€ìž¥ í° ì„±ìž¥ì´ì•¼.",
                            brave: "ìš©ê¸° ìžˆê²Œ ë§ˆì£¼í•œ ë„ˆë¥¼ ë´. ì´ì œ ë‘ë ¤ì›Œí•  ê²Œ ì—†ì–´.",
                            thank: "ê°ì‚¬í•˜ëŠ” ë§ˆìŒì´ ë”°ëœ»í•´. ê·¸ ê¸°ì–µë„ ì‚¬ëž‘ë°›ê³  ìžˆë‹¤ê³  ëŠë‚„ ê±°ì•¼.",
                            release: "ìžìœ ë¡­ê²Œ ë‚ ì•„ê°€ë„ ê´œì°®ì•„. ë†“ì•„ì£¼ëŠ” ê²ƒë„ ì„ íƒì´ì•¼.",
                            general: "ê·¸ ìƒìžê°€ ì—¬ì „ížˆ ì—´ë¦¬ì§€ ì•Šì•„ë„ ê´œì°®ì•„. ì¤‘ìš”í•œ ê±´, ì§€ê¸ˆ ë„¤ê°€ ê·¸ ì•žì— ìžˆë‹¤ëŠ” ê±°ì•¼."
                        },
                        en: {
                            sorry: "Saying sorry will lighten your heart. Forgiveness is freedom.",
                            angry: "That anger is also part of you. You don't have to hide emotions.",
                            sad: "It's okay to shed tears. That's also proof that you're alive.",
                            peaceful: "You've found answers in tranquility. Now you can move forward.",
                            understanding: "I see your accepting heart. That's the greatest growth.",
                            brave: "Look at you, courageously facing it. Now there's nothing to fear.",
                            thank: "Your grateful heart is warm. That memory will feel loved too.",
                            release: "It's okay to fly freely. Letting go is also a choice.",
                            general: "It's okay if that box still won't open. What matters is that you're standing in front of it now."
                        },
                        pt: {
                            sorry: "Pedir desculpas vai aliviar seu coraÃ§Ã£o. O perdÃ£o Ã© liberdade.",
                            angry: "Essa raiva tambÃ©m Ã© parte de vocÃª. VocÃª nÃ£o precisa esconder emoÃ§Ãµes.",
                            sad: "EstÃ¡ tudo bem derramar lÃ¡grimas. Isso tambÃ©m Ã© prova de que vocÃª estÃ¡ vivo.",
                            peaceful: "VocÃª encontrou respostas na tranquilidade. Agora pode seguir em frente.",
                            understanding: "Vejo seu coraÃ§Ã£o que aceita. Esse Ã© o maior crescimento.",
                            brave: "Olhe para vocÃª, enfrentando corajosamente. Agora nÃ£o hÃ¡ nada a temer.",
                            thank: "Seu coraÃ§Ã£o grato Ã© caloroso. Essa memÃ³ria tambÃ©m se sentirÃ¡ amada.",
                            release: "EstÃ¡ tudo bem voar livremente. Deixar ir tambÃ©m Ã© uma escolha.",
                            general: "EstÃ¡ tudo bem se aquela caixa ainda nÃ£o se abrir. O que importa Ã© que vocÃª estÃ¡ de pÃ© na frente dela agora."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 09ê°€ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 09 will be ready soon!' :
                    'Portal 09 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 08ì„ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 08?' :
                    'Deseja reiniciar o Portal 08?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-08",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-08",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 08 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 08 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>