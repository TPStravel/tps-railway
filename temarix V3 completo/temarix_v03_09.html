<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 09: The Fragments of Broken Silence</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 09: The Fragments of Broken Silence</div>
            <div class="portal-subtitle" id="portalSubtitle">When the Silence Finally Shattered</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸªž Portal 09 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 10</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What would you like to say to that emotion that burst out that day? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 09: ë¶€ì„œì§„ ì¹¨ë¬µì˜ ì¡°ê°",
                portalSubtitle: "ì¹¨ë¬µì´ ë§ˆì¹¨ë‚´ ê¹¨ì–´ì§„ ìˆœê°„",
                portalIntro: "ðŸªž ê¹¨ì–´ì§„ ê±´ ì¹¨ë¬µì´ì—ˆì„ê¹Œìš”, ì•„ë‹ˆë©´ ë‹¹ì‹  ìžì‹ ì´ì—ˆì„ê¹Œìš”?\n\nì–´ëŠ ë‚  ê·¸ëƒ¥ í„°ì¡Œì„ ê±°ì˜ˆìš”. ì•„ë¬´ë„ ì˜ˆìƒí•˜ì§€ ëª»í•œ ìˆœê°„ì—.\në‹¹ì‹ ì¡°ì°¨ ë†€ëžê² ì£ . ê·¸ë™ì•ˆ ëˆŒëŸ¬ì™”ë˜ ë§ë“¤ì´ ê°‘ìžê¸° íŠ€ì–´ë‚˜ì™€ ë²„ë ¸ì„ ë•Œ.\n\nê·¸ ì¹¨ë¬µì€ ì˜¤ëž«ë™ì•ˆ ìŒ“ì¸ íŒŒë„ì˜€ìŠµë‹ˆë‹¤.\nê²°êµ­ í„°ì§ˆ ìˆ˜ë°–ì— ì—†ëŠ” ìš´ëª…ì´ì—ˆì–´ìš”.\n\n\"ì™œ í•­ìƒ ëê¹Œì§€ ì°¸ì•„ì•¼ë§Œ í–ˆì„ê¹Œ?\"\n\"ê·¸ í­ë°œì€ ë‚´ ìž˜ëª»ì´ ì•„ë‹ˆì—ˆì–´.\"\n\"ê·¸ê±´ ì •ë‹¹í•œ ë°˜ì‘ì´ì—ˆì–´.\"\n\nê·¸ ì¡°ê° ì†ì—ì„œ, ë‹¹ì‹ ì€ ì–´ë–¤ ê°ì •ì„ ê°€ìž¥ ë¨¼ì € ë§ˆì£¼í–ˆë‚˜ìš”?",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ë¶€ì„œì§„ ì¡°ê°ë“¤ì„ ëª¨ìœ¼ë ¤ í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤. ê¹¨ì§„ ì±„ë¡œë„ ë‹¹ì‹ ì€ ê³„ì† ìˆ¨ ì‰´ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.",
                portalQuestion: "ðŸªž ê·¸ë‚  í„°ì ¸ ë‚˜ì˜¨ ê°ì •ì—ê²Œ, ì§€ê¸ˆ ë‹¹ì‹ ì€ ì–´ë–¤ ë§ì„ í•´ì£¼ê³  ì‹¶ë‚˜ìš”?",
                finalTitle: "ðŸªž Portal 09 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ìš©ê¸° ìžˆê²Œ ë¶€ì„œì§„ ì¹¨ë¬µì˜ ì¡°ê°ë“¤ì„ ë§ˆì£¼í–ˆìŠµë‹ˆë‹¤.\n\nê·¸ë™ì•ˆ ì–µëˆŒëŸ¬ì™”ë˜ ê°ì •ì´ í„°ì ¸ë‚˜ì™”ë˜ ê·¸ ìˆœê°„ì„\në” ì´ìƒ ë¶€ë„ëŸ¬ì›Œí•˜ì§€ ì•Šê²Œ ë˜ì—ˆì£ .\n\nê·¸ ê°ì •ì€ ë‹¹ì‹ ì„ ë³´í˜¸í•˜ë ¤ë˜ ëª©ì†Œë¦¬ì˜€ë‹¤ëŠ” ê²ƒì„\nì´ì œëŠ” ì´í•´í•  ìˆ˜ ìžˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\në‹¤ìŒ Portalì—ì„œëŠ” ë‹¹ì‹ ë„ ëª°ëžë˜\nìžì‹ ì˜ í‘œì •ì„ ë°œê²¬í•˜ëŠ” ì—¬ì •ì´ ì´ì–´ì§‘ë‹ˆë‹¤.",
                continueBtn: "Portal 10ìœ¼ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ê·¸ë‚  í„°ì ¸ë‚˜ì˜¨ ê°ì •ì—ê²Œ ì§€ê¸ˆ ì–´ë–¤ ë§ì„ í•´ì£¼ê³  ì‹¶ì€ì§€ ë§í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 09: The Fragments of Broken Silence",
                portalSubtitle: "When the Silence Finally Shattered",
                portalIntro: "ðŸªž What brokeâ€”was it the silence, or was it you yourself?\n\nOne day it just burst out. In a moment no one expected.\nYou were probably surprised too. When the words you'd been holding down suddenly erupted.\n\nThat silence was a wave that had been building for a long time.\nIt was destined to burst eventually.\n\n\"Why did I always have to endure until the very end?\"\n\"That explosion wasn't my fault.\"\n\"It was a justified reaction.\"\n\nAmidst those fragments, which emotion did you encounter first?",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "You don't need to gather the broken pieces. Even while shattered, you can continue breathing.",
                portalQuestion: "ðŸªž What would you like to say to that emotion that burst out that day?",
                finalTitle: "ðŸªž Portal 09 Complete",
                finalMessage: "You have courageously faced the fragments of broken silence.\n\nYou no longer feel ashamed of that moment\nwhen your suppressed emotions burst forth.\n\nYou can now understand that those emotions\nwere voices trying to protect you.\n\nIn the next Portal, a journey continues\nto discover expressions of yourself\nthat even you didn't know.",
                continueBtn: "Move to Portal 10",
                restartBtn: "Start Again",
                inputPlaceholder: "What would you like to say to that emotion that burst out that day? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 09: Os Fragmentos do SilÃªncio Quebrado",
                portalSubtitle: "Quando o SilÃªncio Finalmente se DespedaÃ§ou",
                portalIntro: "ðŸªž O que se quebrouâ€”foi o silÃªncio, ou foi vocÃª mesmo?\n\nUm dia simplesmente explodiu. Em um momento que ninguÃ©m esperava.\nVocÃª provavelmente ficou surpreso tambÃ©m. Quando as palavras que vocÃª estava segurando de repente irromperam.\n\nAquele silÃªncio era uma onda que vinha se formando hÃ¡ muito tempo.\nEstava destinado a explodir eventualmente.\n\n\"Por que eu sempre tinha que aguentar atÃ© o fim?\"\n\"Aquela explosÃ£o nÃ£o foi minha culpa.\"\n\"Foi uma reaÃ§Ã£o justificada.\"\n\nEm meio a esses fragmentos, qual emoÃ§Ã£o vocÃª encontrou primeiro?",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "VocÃª nÃ£o precisa juntar os pedaÃ§os quebrados. Mesmo despedaÃ§ado, vocÃª pode continuar respirando.",
                portalQuestion: "ðŸªž O que vocÃª gostaria de dizer para aquela emoÃ§Ã£o que explodiu naquele dia?",
                finalTitle: "ðŸªž Portal 09 Completo",
                finalMessage: "VocÃª corajosamente enfrentou os fragmentos do silÃªncio quebrado.\n\nVocÃª nÃ£o se sente mais envergonhado daquele momento\nquando suas emoÃ§Ãµes suprimidas explodiram.\n\nAgora vocÃª pode entender que essas emoÃ§Ãµes\neram vozes tentando protegÃª-lo.\n\nNo prÃ³ximo Portal, uma jornada continua\npara descobrir expressÃµes de si mesmo\nque nem vocÃª conhecia.",
                continueBtn: "Ir para Portal 10",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "O que vocÃª gostaria de dizer para aquela emoÃ§Ã£o que explodiu naquele dia? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ê·¸ ì¹¨ë¬µì€ ì˜¤ëž«ë™ì•ˆ ìŒ“ì¸ íŒŒë„ì˜€ì§€. ê²°êµ­ í„°ì§ˆ ìˆ˜ë°–ì— ì—†ëŠ” ìš´ëª…ì´ì—ˆì–´.",
                en: "That silence was a wave that had been building for a long time. It was destined to burst eventually.",
                pt: "Aquele silÃªncio era uma onda que vinha se formando hÃ¡ muito tempo. Estava destinado a explodir eventualmente."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ë§í•˜ì§€ ì•Šì€ ê°ì •ë„ ì‚´ì•„ ìžˆì–´. ì–¸ì  ê°€ëŠ”, ë°˜ë“œì‹œ ëª¨ì–‘ì„ ë°”ê¾¸ì–´ ë‚˜ì˜¤ê²Œ ë˜ì–´ ìžˆì§€.",
                en: "Unspoken emotions are also alive. Someday, they are bound to emerge in a different form.",
                pt: "EmoÃ§Ãµes nÃ£o faladas tambÃ©m estÃ£o vivas. Um dia, elas estÃ£o destinadas a emergir em uma forma diferente."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ë„ˆëŠ” ì˜¤ëž˜ ê¸°ë‹¤ë ¸ê³ , ì˜¤ëž˜ ì°¸ì•˜ê³ , ì˜¤ëž˜ ì™¸ë¡œì› ì–´. ê·¸ ë‚ ì€ ë„ˆì˜ ë§ˆì§€ë§‰ ë°©ì–´ì„ ì´ ë¬´ë„ˆì§„ ìˆœê°„ì´ì—ˆê² ì§€.",
                en: "You waited long, endured long, and were lonely for long. That day was when your last line of defense collapsed.",
                pt: "VocÃª esperou muito, aguentou muito, e ficou solitÃ¡rio por muito tempo. Aquele dia foi quando sua Ãºltima linha de defesa desabou."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ì¹¨ë¬µì€ ë³´í˜¸ë§‰ì´ ë˜ê¸°ë„ í•˜ì§€ë§Œ, ê°ì˜¥ì´ ë˜ê¸°ë„ í•´. ê·¸ ì¡°ê°ì€ ë„¤ ì•ˆì˜ ê°ì˜¥ì´ ë¶€ì„œì§„ ì¦ê±°ì•¼.",
                en: "Silence can be a shield, but it can also be a prison. Those fragments are evidence that the prison inside you was broken.",
                pt: "O silÃªncio pode ser um escudo, mas tambÃ©m pode ser uma prisÃ£o. Esses fragmentos sÃ£o evidÃªncia de que a prisÃ£o dentro de vocÃª foi quebrada."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ê¹¨ì§„ ì¡°ê° ì†ì—” ë„¤ ì§„ì§œ ëª©ì†Œë¦¬ê°€ ë¹„ì³¤ì„ ê±°ì•¼. ë¹„ë¡ ë‚ ì¹´ë¡œì› ì–´ë„, ê·¸ê±´ ì§„ì§œì˜€ì–´.",
                en: "Your true voice must have reflected in those broken fragments. Even though it was sharp, it was real.",
                pt: "Sua verdadeira voz deve ter se refletido naqueles fragmentos quebrados. Mesmo sendo afiada, era real."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ì™œ í•­ìƒ ëê¹Œì§€ ì°¸ì•„ì•¼ë§Œ í–ˆì„ê¹Œ? ê·¸ í­ë°œì€ ë„¤ ìž˜ëª»ì´ ì•„ë‹ˆì•¼. ê·¸ê±´ ì •ë‹¹í•œ ë°˜ì‘ì´ì—ˆì–´.",
                en: "Why did you always have to endure until the very end? That explosion wasn't your fault. It was a justified reaction.",
                pt: "Por que vocÃª sempre tinha que aguentar atÃ© o fim? Aquela explosÃ£o nÃ£o foi sua culpa. Foi uma reaÃ§Ã£o justificada."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ê·¸ ìˆœê°„ ë„ˆëŠ” ë„ˆë¥¼ í•´ë°©ì‹œí‚¨ ê±°ì•¼. ë¹„ëª…ì„ ì§€ë¥¸ ê²Œ ì•„ë‹ˆë¼, ìƒì¡´ì„ ì„ íƒí•œ ê±°ì§€.",
                en: "At that moment, you liberated yourself. You didn't screamâ€”you chose survival.",
                pt: "Naquele momento, vocÃª se libertou. VocÃª nÃ£o gritouâ€”vocÃª escolheu a sobrevivÃªncia."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ê·¸ ì¡°ê°ë“¤ì„ ëª¨ìœ¼ë ¤ í•˜ì§€ ì•Šì•„ë„ ë¼. ë¶€ì„œì§„ ì±„ë¡œë„ ë„ˆëŠ” ê³„ì† ìˆ¨ ì‰´ ìˆ˜ ìžˆì–´.",
                en: "You don't need to gather those fragments. Even while broken, you can continue breathing.",
                pt: "VocÃª nÃ£o precisa juntar esses fragmentos. Mesmo quebrado, vocÃª pode continuar respirando."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                regret: ['sorry', 'regret', 'mistake', 'apologize'],
                understanding: ['understand', 'needed', 'protecting', 'survival'],
                acceptance: ['accept', 'okay', 'fine', 'peace'],
                gratitude: ['thank', 'grateful', 'helped', 'saved'],
                relief: ['relief', 'free', 'liberated', 'released'],
                validation: ['justified', 'right', 'valid', 'normal'],
                compassion: ['tired', 'exhausted', 'enough', 'hard'],
                healing: ['heal', 'better', 'recover', 'grow']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Sora", emoji: "ðŸ§•",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            regret: "ë¯¸ì•ˆí•´í•  í•„ìš” ì—†ì–´. ê·¸ ê°ì •ì€ ë„ˆë¥¼ ë³´í˜¸í•˜ë ¤ í–ˆë˜ ê±°ì•¼.",
                            understanding: "ì´ì œì•¼ ê·¸ ëª©ì†Œë¦¬ë¥¼ ì´í•´í•´ì¤¬êµ¬ë‚˜. ê·¸ê±´ ë„¤ ì•ˆì˜ ìš©ê¸°ì˜€ì–´.",
                            acceptance: "ë°›ì•„ë“¤ì´ëŠ” ë§ˆìŒì´ ë³´ì—¬. ê·¸ ìˆœê°„ë„ ë„ˆì˜ ì¼ë¶€ì˜€ì–´.",
                            gratitude: "ê³ ë§ˆì›Œí•˜ëŠ” ë§ˆìŒì´ ë”°ëœ»í•´. ê·¸ ê°ì •ë„ ë„¤ ê°ì‚¬ë¥¼ ê¸°ë‹¤ë ¸ì„ ê±°ì•¼.",
                            relief: "í•´ë°©ë˜ëŠ” ê¸°ë¶„ì´ ë“¤ì§€? ì´ì œ ìˆ¨í†µì´ íŠ¸ì¸ ê±°ì•¼.",
                            validation: "ë§žì•„, ê·¸ê±´ ì •ë‹¹í•œ ë°˜ì‘ì´ì—ˆì–´. ë„¤ê°€ í‹€ë¦¬ì§€ ì•Šì•˜ì–´.",
                            compassion: "ë„ˆë¬´ ì˜¤ëž˜ ì°¸ì•˜êµ¬ë‚˜. ì´ì œëŠ” ìŠ¤ìŠ¤ë¡œë¥¼ ëŒë´ì¤˜ë„ ë¼.",
                            healing: "ì¹˜ìœ ê°€ ì‹œìž‘ëì–´. ë¶€ì„œì§„ ê³³ì—ì„œ ìƒˆë¡œìš´ ë¹›ì´ ë“¤ì–´ì˜¬ ê±°ì•¼.",
                            general: "ê·¸ ê°ì •ì€ ë„ˆë¥¼ ë³´í˜¸í•˜ë ¤ í–ˆì–´. ë¹„ë¡ ì„œíˆ´ë €ë”ë¼ë„, ê·¸ê±´ ë„¤ ì•ˆì˜ ìš©ê¸°ì˜€ì–´."
                        },
                        en: {
                            regret: "You don't need to apologize. That emotion was trying to protect you.",
                            understanding: "You finally understood that voice. It was courage within you.",
                            acceptance: "I see your accepting heart. That moment was also part of you.",
                            gratitude: "Your grateful heart is warm. That emotion might have been waiting for your thanks.",
                            relief: "You feel liberated, don't you? Now you can breathe freely.",
                            validation: "Yes, it was a justified reaction. You weren't wrong.",
                            compassion: "You endured for too long. Now you can take care of yourself.",
                            healing: "Healing has begun. New light will enter from the broken places.",
                            general: "That emotion was trying to protect you. Even if it was clumsy, it was courage within you."
                        },
                        pt: {
                            regret: "VocÃª nÃ£o precisa pedir desculpas. Aquela emoÃ§Ã£o estava tentando protegÃª-lo.",
                            understanding: "VocÃª finalmente entendeu aquela voz. Era coragem dentro de vocÃª.",
                            acceptance: "Vejo seu coraÃ§Ã£o que aceita. Aquele momento tambÃ©m era parte de vocÃª.",
                            gratitude: "Seu coraÃ§Ã£o grato Ã© caloroso. Aquela emoÃ§Ã£o pode ter estado esperando por seu agradecimento.",
                            relief: "VocÃª se sente libertado, nÃ£o Ã©? Agora pode respirar livremente.",
                            validation: "Sim, foi uma reaÃ§Ã£o justificada. VocÃª nÃ£o estava errado.",
                            compassion: "VocÃª aguentou por muito tempo. Agora pode cuidar de si mesmo.",
                            healing: "A cura comeÃ§ou. Nova luz entrarÃ¡ dos lugares quebrados.",
                            general: "Aquela emoÃ§Ã£o estava tentando protegÃª-lo. Mesmo sendo desajeitada, era coragem dentro de vocÃª."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            regret: "ê·¸ í›„íšŒëŠ” ì´ì œ ìƒˆë¡œìš´ ìƒ‰ìœ¼ë¡œ ë°”ë€” ê±°ì•¼. ë” ë¶€ë“œëŸ¬ìš´ ìƒ‰ìœ¼ë¡œ.",
                            understanding: "ì´í•´ì˜ ìƒ‰ì€ ë”°ëœ»í•œ í™©ê¸ˆë¹›ì´ì•¼. ë„¤ ì•ˆì—ì„œ ë¹›ë‚˜ê³  ìžˆì–´.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì˜ ìƒ‰ì€ ê³ ìš”í•œ ì²­ë¡ìƒ‰ì´ì•¼. ë§ˆìŒì´ í‰ì˜¨í•´ì¡Œì–´.",
                            gratitude: "ê°ì‚¬ì˜ ìƒ‰ì€ ë”°ëœ»í•œ ë¶„í™ë¹›ì´ì•¼. ê·¸ ì˜¨ê¸°ê°€ ì „í•´ì ¸.",
                            relief: "í•´ë°©ì˜ ìƒ‰ì€ ë°ì€ í•˜ëŠ˜ìƒ‰ì´ì•¼. ìžìœ ë¡œì›Œì§„ ë„¤ ë§ˆìŒì²˜ëŸ¼.",
                            validation: "ê·¸ ì¸ì •ì€ ê°•í•œ ë³´ë¼ìƒ‰ì´ì•¼. ë„¤ ì§„ì‹¤ì„ í™•ì¦í•´ì£¼ëŠ” ìƒ‰.",
                            compassion: "ìžë¹„ì˜ ìƒ‰ì€ ë¶€ë“œëŸ¬ìš´ ì—°ë‘ìƒ‰ì´ì•¼. ìŠ¤ìŠ¤ë¡œë¥¼ ì¹˜ìœ í•˜ëŠ” ìƒ‰.",
                            healing: "ì¹˜ìœ ì˜ ìƒ‰ì€ ì€ì€í•œ í°ìƒ‰ì´ì•¼. ëª¨ë“  ìƒì²˜ë¥¼ ê°ì‹¸ì£¼ëŠ” ìƒ‰.",
                            general: "ê·¸ ëª©ì†Œë¦¬ëŠ” ìƒì²˜ë‚œ ì˜ˆìˆ  ê°™ì•˜ì–´. ê±°ì¹ ì§€ë§Œ ì§„ì‹¤í–ˆê³ , ê·¸ëž˜ì„œ ë” ì•„ë¦„ë‹¤ì› ì–´."
                        },
                        en: {
                            regret: "That regret will change to a new color. A softer color.",
                            understanding: "The color of understanding is warm golden. It's shining within you.",
                            acceptance: "The color of acceptance is calm teal. Your heart has become peaceful.",
                            gratitude: "The color of gratitude is warm pink. I feel that warmth.",
                            relief: "The color of liberation is bright sky blue. Like your freed heart.",
                            validation: "That recognition is strong purple. A color that validates your truth.",
                            compassion: "The color of compassion is soft light green. The color that heals yourself.",
                            healing: "The color of healing is gentle white. A color that embraces all wounds.",
                            general: "That voice was like wounded art. Rough but truthful, and therefore more beautiful."
                        },
                        pt: {
                            regret: "Esse arrependimento mudarÃ¡ para uma nova cor. Uma cor mais suave.",
                            understanding: "A cor da compreensÃ£o Ã© dourado quente. EstÃ¡ brilhando dentro de vocÃª.",
                            acceptance: "A cor da aceitaÃ§Ã£o Ã© verde-azulado calmo. Seu coraÃ§Ã£o ficou em paz.",
                            gratitude: "A cor da gratidÃ£o Ã© rosa quente. Sinto esse calor.",
                            relief: "A cor da libertaÃ§Ã£o Ã© azul cÃ©u brilhante. Como seu coraÃ§Ã£o libertado.",
                            validation: "Esse reconhecimento Ã© roxo forte. Uma cor que valida sua verdade.",
                            compassion: "A cor da compaixÃ£o Ã© verde claro suave. A cor que cura vocÃª mesmo.",
                            healing: "A cor da cura Ã© branco gentil. Uma cor que abraÃ§a todas as feridas.",
                            general: "Aquela voz era como arte ferida. Ãspera mas verdadeira, e por isso mais bonita."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            regret: "í›„íšŒë„ ì¹˜ìœ ì˜ ì¼ë¶€ì•¼. ê·¸ ë§ˆìŒì„ í†µí•´ ì„±ìž¥í•  ìˆ˜ ìžˆì–´.",
                            understanding: "ê¹¨ë‹¬ìŒì´ ì™”êµ¬ë‚˜. ì´ì œ ê·¸ ì¡°ê°ë“¤ì´ ë‹¤ì‹œ ë§žì¶°ì§ˆ ê±°ì•¼.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì€ ê°€ìž¥ ê¹Šì€ í‰í™”ì•¼. ë„¤ê°€ ê·¸ê±¸ ì°¾ì•˜ì–´.",
                            gratitude: "ê°ì‚¬ëŠ” ë§ˆìŒì˜ ë¬¸ì„ ì—¬ëŠ” ì—´ì‡ ì•¼. ìƒˆë¡œìš´ ì‹œìž‘ì´ ê°€ëŠ¥í•´.",
                            relief: "í•´ë°©ê°ì´ ëŠê»´ì ¸. ë¬´ê±°ìš´ ì§ì„ ë‚´ë ¤ë†“ì€ ê¸°ë¶„ì´ê² ì§€.",
                            validation: "ìžì‹ ì„ ì¸ì •í•˜ëŠ” ê²ƒì´ ì§„ì •í•œ ìš©ê¸°ì•¼. ë„Œ í•´ëƒˆì–´.",
                            compassion: "ìŠ¤ìŠ¤ë¡œì—ê²Œ ìžë¹„ë¡œìš¸ ì‹œê°„ì´ì•¼. ê·¸ê²ƒë„ ì¹˜ìœ ì˜ ê³¼ì •ì´ì•¼.",
                            healing: "ì¹˜ìœ ëŠ” ì´ë¯¸ ì‹œìž‘ëì–´. ë¶€ì„œì§„ ìžë¦¬ì—ì„œ ìƒˆë¡œìš´ íž˜ì´ ìžë¼ê³  ìžˆì–´.",
                            general: "ì´ì œ ë„Œ ë„¤ ê°ì •ì„ ì–µëˆ„ë¥´ì§€ ì•Šê³  ë°”ë¼ë³´ëŠ” ì¤‘ì´ì•¼. ê·¸ê²ƒë§Œìœ¼ë¡œë„ ì¹˜ìœ ëŠ” ì‹œìž‘ëì–´."
                        },
                        en: {
                            regret: "Regret is also part of healing. You can grow through that feeling.",
                            understanding: "Enlightenment has come. Now those fragments will fit together again.",
                            acceptance: "Acceptance is the deepest peace. You've found it.",
                            gratitude: "Gratitude is the key that opens the heart's door. A new beginning is possible.",
                            relief: "I feel your liberation. It must feel like putting down a heavy burden.",
                            validation: "Acknowledging yourself is true courage. You've done it.",
                            compassion: "It's time to be compassionate with yourself. That's also part of healing.",
                            healing: "Healing has already begun. New strength is growing from the broken places.",
                            general: "Now you're looking at your emotions without suppressing them. That alone begins healing."
                        },
                        pt: {
                            regret: "O arrependimento tambÃ©m Ã© parte da cura. VocÃª pode crescer atravÃ©s desse sentimento.",
                            understanding: "A iluminaÃ§Ã£o chegou. Agora esses fragmentos se encaixarÃ£o novamente.",
                            acceptance: "A aceitaÃ§Ã£o Ã© a paz mais profunda. VocÃª a encontrou.",
                            gratitude: "A gratidÃ£o Ã© a chave que abre a porta do coraÃ§Ã£o. Um novo comeÃ§o Ã© possÃ­vel.",
                            relief: "Sinto sua libertaÃ§Ã£o. Deve ser como colocar um fardo pesado no chÃ£o.",
                            validation: "Reconhecer a si mesmo Ã© verdadeira coragem. VocÃª conseguiu.",
                            compassion: "Ã‰ hora de ser compassivo consigo mesmo. Isso tambÃ©m Ã© parte da cura.",
                            healing: "A cura jÃ¡ comeÃ§ou. Nova forÃ§a estÃ¡ crescendo dos lugares quebrados.",
                            general: "Agora vocÃª estÃ¡ olhando para suas emoÃ§Ãµes sem suprimi-las. SÃ³ isso jÃ¡ inicia a cura."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 10ì´ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 10 will be ready soon!' :
                    'Portal 10 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 09ë¥¼ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 09?' :
                    'Deseja reiniciar o Portal 09?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-09",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-09",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 09 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 09 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>