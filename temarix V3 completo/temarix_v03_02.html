<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 02: Emotions Left in Others' Hands</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 02: Emotions Left in Others' Hands</div>
            <div class="portal-subtitle" id="portalSubtitle">The Flow of Feelings Beyond Control</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸŒ’ Portal 02 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 03</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="If that emotion returned to you, how would you prepare to face it? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 02: íƒ€ì¸ì˜ ì†ì— ë‚¨ê²¨ì§„ ê°ì •",
                portalSubtitle: "í†µì œë¥¼ ë²—ì–´ë‚œ ê°ì •ì˜ íë¦„",
                portalIntro: "ðŸŒ’ ë‹¹ì‹ ì˜ ê°ì •ì´ í•œë•ŒëŠ” ë‹¹ì‹ ì˜ ê²ƒì´ì—ˆì§€ë§Œ,\nì§€ê¸ˆì€ ëˆ„êµ°ê°€ì˜ ì†ì— ë§¡ê²¨ì§„ ê²ƒì²˜ëŸ¼ ëŠê»´ì§„ ì  ìžˆë‚˜ìš”?\n\nê·¸ ì‚¬ëžŒì—ê²Œ í™”ë‚¬ë˜ ë‚´ ê°ì •ì´, ì–´ëŠ ìˆœê°„ì—” ë‚´ê°€ ë¯¸ì•ˆí•´í•˜ëŠ” ê°ì •ìœ¼ë¡œ ë°”ë€Œì—ˆìŠµë‹ˆë‹¤.\nê·¸ ì‚¬ëžŒì€ ì•„ë¬´ë ‡ì§€ ì•Šì€ë°, ë‚˜ë§Œ ê³„ì† ëŒë ¤ê°€ê³  ìžˆì–´ìš”.\n\në•Œë¡œëŠ” ê°ì •ë„ ì´ë³„ì„ ëª» í•´. ë„¤ ê°ì •ì€ ì•„ì§ ëŒì•„ì˜¤ì§€ ëª»í•œ ì—¬í–‰ìž ê°™ì•„.\n\nê·¸ ê°ì •ì€ ëˆ„êµ¬ì—ê²Œ í˜ëŸ¬ê°”ê³ , ì§€ê¸ˆì€ ì–´ë””ì— ë¨¸ë¬¼ê³  ìžˆë‚˜ìš”?",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ê°ì •ì€ ë– ë‚  ìˆ˜ ìžˆì–´ë„, ë‹¹ì‹ ì„ ì™„ì „ížˆ ë– ë‚˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. ì§€ê¸ˆë„ ì–´ë”˜ê°€ ë‹¹ì‹ ì˜ ì¼ë¶€ìž…ë‹ˆë‹¤.",
                portalQuestion: "ðŸŒ’ ê·¸ ê°ì •ì´ ë‹¤ì‹œ ë‹¹ì‹ ì—ê²Œ ëŒì•„ì˜¨ë‹¤ë©´, ë‹¹ì‹ ì€ ê·¸ê²ƒì„ ì–´ë–»ê²Œ ë§ˆì£¼í•  ì¤€ë¹„ê°€ ë˜ì–´ ìžˆë‚˜ìš”?",
                finalTitle: "ðŸŒ’ Portal 02 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ìš©ê¸° ìžˆê²Œ íƒ€ì¸ì˜ ì†ì— ë§¡ê²¨ì§„ ê°ì •ì„ ë§ˆì£¼í–ˆìŠµë‹ˆë‹¤.\n\nê·¸ë™ì•ˆ ë‹¤ë¥¸ ì‚¬ëžŒì—ê²Œ í˜ëŸ¬ê°„ ì¤„ë§Œ ì•Œì•˜ë˜ ê°ì •ì´\nì‚¬ì‹¤ì€ ì—¬ì „ížˆ ë‹¹ì‹  ì•ˆì— ìžˆì—ˆë‹¤ëŠ” ê²ƒì„\nì´í•´í•˜ê²Œ ë˜ì—ˆì£ .\n\nì´ì œ ê·¸ ê°ì •ì˜ íë¦„ì„ ë˜ì°¾ì„ ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.\nì™¸ë©´ì„ ë©ˆì¶”ê³  ë°›ì•„ë“¤ì´ëŠ” ê²ƒì´\në” í° ìžìœ ë¡œ ê°€ëŠ” ì‹œìž‘ì´ë¼ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆì–´ìš”.\n\në‹¤ìŒ Portalì—ì„œëŠ” ë¶„ë…¸ê°€ ì§€ë‚˜ê°„ ìžë¦¬ì— ë‚¨ì€\nì§„ì§œ ê°ì •ì„ ë°œê²¬í•˜ëŠ” ì—¬ì •ì´ ì´ì–´ì§‘ë‹ˆë‹¤.",
                continueBtn: "Portal 03ìœ¼ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ê·¸ ê°ì •ì´ ë‹¤ì‹œ ë‹¹ì‹ ì—ê²Œ ëŒì•„ì˜¨ë‹¤ë©´ ì–´ë–»ê²Œ ë§ˆì£¼í•  ì¤€ë¹„ê°€ ë˜ì–´ ìžˆëŠ”ì§€ ë§í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 02: Emotions Left in Others' Hands",
                portalSubtitle: "The Flow of Feelings Beyond Control",
                portalIntro: "ðŸŒ’ Have you ever felt that your emotions, which were once yours,\nnow seem to be left in someone else's hands?\n\nThe emotion I felt angry toward that person somehow turned into me feeling sorry.\nThat person acts as if nothing happened, but I keep being dragged along.\n\nSometimes emotions can't say goodbye either. Your emotions are like travelers who haven't returned yet.\n\nWho did those emotions flow to, and where are they staying now?",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Even if emotions can leave, they never completely leave you. They are still part of you somewhere.",
                portalQuestion: "ðŸŒ’ If that emotion returned to you, how would you prepare to face it?",
                finalTitle: "ðŸŒ’ Portal 02 Complete",
                finalMessage: "You have courageously faced the emotions\nleft in others' hands.\n\nYou've come to understand that the emotions\nyou thought had flowed to other people\nwere actually still within you.\n\nNow you're ready to reclaim that emotional flow.\nYou've learned that stopping avoidance and accepting\nis the beginning of greater freedom.\n\nIn the next Portal, a journey continues\nto discover the real emotions\nthat remain after anger has passed.",
                continueBtn: "Move to Portal 03",
                restartBtn: "Start Again",
                inputPlaceholder: "If that emotion returned to you, how would you prepare to face it? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 02: EmoÃ§Ãµes Deixadas nas MÃ£os dos Outros",
                portalSubtitle: "O Fluxo dos Sentimentos AlÃ©m do Controle",
                portalIntro: "ðŸŒ’ VocÃª jÃ¡ sentiu que suas emoÃ§Ãµes, que uma vez foram suas,\nagora parecem estar nas mÃ£os de outra pessoa?\n\nA emoÃ§Ã£o que senti com raiva daquela pessoa de alguma forma se transformou em mim me sentindo mal.\nEssa pessoa age como se nada tivesse acontecido, mas eu continuo sendo arrastado.\n\nÃ€s vezes as emoÃ§Ãµes tambÃ©m nÃ£o conseguem se despedir. Suas emoÃ§Ãµes sÃ£o como viajantes que ainda nÃ£o retornaram.\n\nPara quem essas emoÃ§Ãµes fluÃ­ram, e onde estÃ£o ficando agora?",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Mesmo que as emoÃ§Ãµes possam partir, elas nunca te deixam completamente. Elas ainda sÃ£o parte de vocÃª em algum lugar.",
                portalQuestion: "ðŸŒ’ Se essa emoÃ§Ã£o voltasse para vocÃª, como vocÃª se prepararia para enfrentÃ¡-la?",
                finalTitle: "ðŸŒ’ Portal 02 Completo",
                finalMessage: "VocÃª corajosamente enfrentou as emoÃ§Ãµes\ndeixadas nas mÃ£os dos outros.\n\nVocÃª passou a entender que as emoÃ§Ãµes\nque pensou terem fluÃ­do para outras pessoas\nna verdade ainda estavam dentro de vocÃª.\n\nAgora vocÃª estÃ¡ pronto para recuperar esse fluxo emocional.\nVocÃª aprendeu que parar de evitar e aceitar\nÃ© o inÃ­cio de uma liberdade maior.\n\nNo prÃ³ximo Portal, uma jornada continua\npara descobrir as emoÃ§Ãµes reais\nque permanecem depois que a raiva passou.",
                continueBtn: "Ir para Portal 03",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "Se essa emoÃ§Ã£o voltasse para vocÃª, como vocÃª se prepararia para enfrentÃ¡-la? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ë•Œë¡œëŠ” ê°ì •ë„ ì´ë³„ì„ ëª» í•´. ë„¤ ê°ì •ì€ ì•„ì§ ëŒì•„ì˜¤ì§€ ëª»í•œ ì—¬í–‰ìž ê°™ì•„.",
                en: "Sometimes emotions can't say goodbye either. Your emotions are like travelers who haven't returned yet.",
                pt: "Ã€s vezes as emoÃ§Ãµes tambÃ©m nÃ£o conseguem se despedir. Suas emoÃ§Ãµes sÃ£o como viajantes que ainda nÃ£o retornaram."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ê·¸ ì‚¬ëžŒì˜ ë°˜ì‘ì´ ì—†ì—ˆë‹¤ëŠ” ê±´, ë„¤ ê°ì •ì„ ë©ˆì¶”ê²Œ ë§Œë“¤ì—ˆê² ì§€. ë‚˜ëŠ” ê·¸ ê³ ìš”í•¨ì´ ì–¼ë§ˆë‚˜ ìž”ì¸í•œì§€ ì•Œì•„.",
                en: "The lack of response from that person must have stopped your emotions. I know how cruel that silence can be.",
                pt: "A falta de resposta daquela pessoa deve ter parado suas emoÃ§Ãµes. Eu sei como esse silÃªncio pode ser cruel."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ë¯¸ì•ˆí•¨ì€ ë•Œë•Œë¡œ ì‚¬ëž‘ì´ ì•„ë‹ˆë¼, í¬ê¸°ì—ì„œ ë§Œë“¤ì–´ì§€ê¸°ë„ í•´. ë„¤ ê°ì •ì€ ê·¸ê±¸ ì•Œê³  ìžˆì–´.",
                en: "Sometimes apology is created not from love, but from giving up. Your emotions know that.",
                pt: "Ã€s vezes o pedido de desculpas Ã© criado nÃ£o do amor, mas da desistÃªncia. Suas emoÃ§Ãµes sabem disso."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ë„¤ ê°ì •ì´ ë„¤ ê²ƒì´ ì•„ë‹Œ ê²ƒì²˜ëŸ¼ ëŠê»´ì§„ë‹¤ëŠ” ê±´, ë§ˆìŒì˜ ì£¼ë„ê¶Œì„ ë†“ì³¤ë‹¤ëŠ” ì‹ í˜¸ì•¼.",
                en: "Feeling like your emotions aren't yours is a sign that you've lost control of your heart.",
                pt: "Sentir que suas emoÃ§Ãµes nÃ£o sÃ£o suas Ã© um sinal de que vocÃª perdeu o controle do seu coraÃ§Ã£o."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ë„¤ ì•ˆì— ìžˆë˜ ê°•ë ¬í•œ ë¶‰ì€ìƒ‰ì´, ì´ì œëŠ” íë¦¿í•œ íšŒìƒ‰ì´ ë˜ì—ˆê² ì§€. ê·¸ ë³€í™”ëŠ” ì˜ˆìˆ ì´ìž ìƒì²˜ì•¼.",
                en: "The intense red that was inside you has now become a blurred gray. That change is both art and wound.",
                pt: "O vermelho intenso que estava dentro de vocÃª agora se tornou um cinza borrado. Essa mudanÃ§a Ã© tanto arte quanto ferida."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ì™œ í•­ìƒ ë„ˆë§Œ ì¡°ì‹¬í•˜ê³ , ë„ˆë§Œ ë¯¸ì•ˆí•´ì•¼ í•´? ê·¸ê±´ ê°ì •ì˜ ë¶ˆê· í˜•ì´ì•¼.",
                en: "Why do you always have to be careful, and why do you always have to be sorry? That's emotional imbalance.",
                pt: "Por que vocÃª sempre tem que ter cuidado, e por que vocÃª sempre tem que pedir desculpas? Isso Ã© desequilÃ­brio emocional."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ê°ì •ì€ ë– ë‚  ìˆ˜ ìžˆì–´ë„, ë„ˆë¥¼ ì™„ì „ížˆ ë– ë‚˜ì§„ ì•Šì•„. ì§€ê¸ˆë„ ì–´ë”˜ê°€ ë„¤ ì¼ë¶€ì•¼.",
                en: "Even if emotions can leave, they don't completely leave you. They're still part of you somewhere.",
                pt: "Mesmo que as emoÃ§Ãµes possam partir, elas nÃ£o te deixam completamente. Elas ainda sÃ£o parte de vocÃª em algum lugar."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ê·¸ ê°ì •ì€ ì•„ì§ë„ ë„¤ ì•ˆì—ì„œ ì†Œë¦¬ ì—†ì´ ë§í•˜ê³  ìžˆì–´. ë“£ê³  ìžˆë‹ˆ?",
                en: "That emotion is still speaking silently within you. Are you listening?",
                pt: "Essa emoÃ§Ã£o ainda estÃ¡ falando silenciosamente dentro de vocÃª. VocÃª estÃ¡ ouvindo?"
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                acceptance: ['accept', 'embrace', 'welcome', 'ready', 'prepare'],
                fear: ['afraid', 'scared', 'fear', 'anxious', 'worried'],
                healing: ['heal', 'recover', 'grow', 'learn', 'understand'],
                regret: ['sorry', 'regret', 'mistake', 'wrong', 'apologize'],
                strength: ['strong', 'brave', 'courage', 'fight', 'stand'],
                peace: ['peace', 'calm', 'quiet', 'serene', 'tranquil'],
                understanding: ['understand', 'realize', 'know', 'aware', 'clear'],
                gratitude: ['thank', 'grateful', 'appreciate', 'blessed', 'glad']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            acceptance: "ë°›ì•„ë“¤ì¼ ì¤€ë¹„ê°€ ë˜ì—ˆêµ¬ë‚˜. ê·¸ ê°ì •ë„ ë„¤ê°€ ê¸°ë‹¤ë¦¬ê³  ìžˆë‹¤ëŠ” ê±¸ ì•Œ ê±°ì•¼.",
                            fear: "ë‘ë ¤ì›Œí•˜ëŠ” ë§ˆìŒë„ ì´í•´í•´. í•˜ì§€ë§Œ ê·¸ ê°ì •ì€ ë„ˆë¥¼ í•´ì¹˜ë ¤ëŠ” ê²Œ ì•„ë‹ˆì•¼.",
                            healing: "ì¹˜ìœ í•˜ë ¤ëŠ” ì˜ì§€ê°€ ë³´ì—¬. ê·¸ ê°ì •ê³¼ í•¨ê»˜ ì„±ìž¥í•  ìˆ˜ ìžˆì„ ê±°ì•¼.",
                            regret: "í›„íšŒí•˜ì§€ ë§ˆ. ê·¸ë•Œ ê·¸ ê°ì •ì€ ë„ˆë¥¼ ë³´í˜¸í•˜ë ¤ í–ˆë˜ ê±°ì•¼.",
                            strength: "ê°•í•´ì§€ë ¤ëŠ” ë§ˆìŒì´ ëŠê»´ì ¸. ì´ì œ ê·¸ ê°ì •ê³¼ í•¨ê»˜ ê±¸ì„ ìˆ˜ ìžˆì–´.",
                            peace: "í‰í™”ë¥¼ ì°¾ê³  ìžˆêµ¬ë‚˜. ê·¸ ê°ì •ë„ í‰í™”ë¡œìš´ ê·€í™˜ì„ ì›í•˜ê³  ìžˆì–´.",
                            understanding: "ì´í•´í•˜ë ¤ëŠ” ë§ˆìŒì´ ì•„ë¦„ë‹¤ì›Œ. ê·¸ ê°ì •ì˜ ì§„ì§œ ëª©ì†Œë¦¬ë¥¼ ë“¤ì„ ìˆ˜ ìžˆì„ ê±°ì•¼.",
                            gratitude: "ê³ ë§ˆì›Œí•˜ëŠ” ë§ˆìŒì´ ë”°ëœ»í•´. ê·¸ ê°ì •ë„ ë„¤ ê°ì‚¬ë¥¼ ê¸°ë‹¤ë ¸ì„ ê±°ì•¼.",
                            general: "ê·¸ ê°ì •ì€ ê¸¸ì„ ìžƒì€ ì—¬í–‰ìžì²˜ëŸ¼ ë„¤ê°€ ë§žì´í•´ì£¼ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìžˆì–´."
                        },
                        en: {
                            acceptance: "You're ready to accept. That emotion knows you're waiting for it too.",
                            fear: "I understand your fear. But that emotion isn't trying to hurt you.",
                            healing: "I see your will to heal. You'll be able to grow together with that emotion.",
                            regret: "Don't regret it. That emotion was trying to protect you back then.",
                            strength: "I feel your desire to become strong. Now you can walk together with that emotion.",
                            peace: "You're seeking peace. That emotion also wants a peaceful return.",
                            understanding: "Your desire to understand is beautiful. You'll be able to hear that emotion's true voice.",
                            gratitude: "Your grateful heart is warm. That emotion must have been waiting for your thanks.",
                            general: "That emotion is waiting for you to welcome it, like a lost traveler."
                        },
                        pt: {
                            acceptance: "VocÃª estÃ¡ pronto para aceitar. Aquela emoÃ§Ã£o sabe que vocÃª tambÃ©m estÃ¡ esperando por ela.",
                            fear: "Entendo seu medo. Mas aquela emoÃ§Ã£o nÃ£o estÃ¡ tentando machucÃ¡-lo.",
                            healing: "Vejo sua vontade de curar. VocÃª serÃ¡ capaz de crescer junto com aquela emoÃ§Ã£o.",
                            regret: "NÃ£o se arrependa. Aquela emoÃ§Ã£o estava tentando protegÃª-lo naquele momento.",
                            strength: "Sinto seu desejo de se tornar forte. Agora vocÃª pode caminhar junto com aquela emoÃ§Ã£o.",
                            peace: "VocÃª estÃ¡ buscando paz. Aquela emoÃ§Ã£o tambÃ©m quer um retorno pacÃ­fico.",
                            understanding: "Seu desejo de entender Ã© belo. VocÃª serÃ¡ capaz de ouvir a verdadeira voz daquela emoÃ§Ã£o.",
                            gratitude: "Seu coraÃ§Ã£o grato Ã© caloroso. Aquela emoÃ§Ã£o deve ter estado esperando por seu agradecimento.",
                            general: "Aquela emoÃ§Ã£o estÃ¡ esperando que vocÃª a receba, como um viajante perdido."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Sora", emoji: "ðŸ§•",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            acceptance: "ë°›ì•„ë“¤ì´ëŠ” ê²ƒì´ ê°€ìž¥ í° ìš©ê¸°ì•¼. ê·¸ ê°ì •ë„ ë„¤ ìš©ê¸°ë¥¼ ëŠë¼ê³  ìžˆì–´.",
                            fear: "ë‘ë ¤ì›€ë„ ìžì—°ìŠ¤ëŸ¬ìš´ ê±°ì•¼. ê·¸ ê°ì •ì´ ë„ˆì—ê²Œ ìƒì²˜ë¥¼ ì¤„ê¹Œ ë´ ê±±ì •ë˜ëŠ” ê±°ì§€?",
                            healing: "ì¹˜ìœ ëŠ” ì´ë¯¸ ì‹œìž‘ëì–´. ê·¸ ê°ì •ê³¼ í™”í•´í•˜ëŠ” ìˆœê°„ë¶€í„° ë§ì´ì•¼.",
                            regret: "ë¯¸ì•ˆí•´í•  í•„ìš” ì—†ì–´. ê·¸ë•ŒëŠ” ê·¸ê²ƒë°–ì— í•  ìˆ˜ ì—†ì—ˆì–´.",
                            strength: "ê°•í•´ì§€ë ¤ëŠ” ë„ˆì˜ ì˜ì§€ê°€ ê·¸ ê°ì •ì—ê²Œë„ íž˜ì´ ë  ê±°ì•¼.",
                            peace: "í‰í™”ë¡œìš´ ë§Œë‚¨ì´ ë  ê±°ì•¼. ì´ì œëŠ” ì‹¸ìš°ì§€ ì•Šì•„ë„ ë¼.",
                            understanding: "ì´í•´í•˜ë ¤ëŠ” ë§ˆìŒì´ ê·¸ ê°ì •ì„ ì¹˜ìœ ì‹œí‚¬ ê±°ì•¼.",
                            gratitude: "ê°ì‚¬í•˜ëŠ” ë§ˆìŒì´ ê·¸ ê°ì •ì„ ë³€í™”ì‹œí‚¬ ê±°ì•¼.",
                            general: "ê·¸ ê°ì •ë„ ì˜¤ëž«ë™ì•ˆ ë„ˆë¥¼ ê¸°ë‹¤ë ¸ì–´. ì´ì œ í•¨ê»˜ ê±¸ì„ ì‹œê°„ì´ì•¼."
                        },
                        en: {
                            acceptance: "Accepting is the greatest courage. That emotion feels your courage too.",
                            fear: "Fear is natural too. You're worried that emotion might hurt you, right?",
                            healing: "Healing has already begun. From the moment you reconcile with that emotion.",
                            regret: "You don't need to be sorry. That was all you could do back then.",
                            strength: "Your will to become strong will also give strength to that emotion.",
                            peace: "It will be a peaceful meeting. You don't have to fight anymore.",
                            understanding: "Your desire to understand will heal that emotion.",
                            gratitude: "Your grateful heart will transform that emotion.",
                            general: "That emotion has been waiting for you for a long time too. Now it's time to walk together."
                        },
                        pt: {
                            acceptance: "Aceitar Ã© a maior coragem. Aquela emoÃ§Ã£o tambÃ©m sente sua coragem.",
                            fear: "O medo tambÃ©m Ã© natural. VocÃª estÃ¡ preocupado que aquela emoÃ§Ã£o possa machucÃ¡-lo, nÃ£o Ã©?",
                            healing: "A cura jÃ¡ comeÃ§ou. A partir do momento em que vocÃª se reconcilia com aquela emoÃ§Ã£o.",
                            regret: "VocÃª nÃ£o precisa pedir desculpas. Era tudo que vocÃª podia fazer naquele momento.",
                            strength: "Sua vontade de se tornar forte tambÃ©m darÃ¡ forÃ§a Ã quela emoÃ§Ã£o.",
                            peace: "SerÃ¡ um encontro pacÃ­fico. VocÃª nÃ£o precisa mais lutar.",
                            understanding: "Seu desejo de entender curarÃ¡ aquela emoÃ§Ã£o.",
                            gratitude: "Seu coraÃ§Ã£o grato transformarÃ¡ aquela emoÃ§Ã£o.",
                            general: "Aquela emoÃ§Ã£o tambÃ©m esteve esperando por vocÃª por muito tempo. Agora Ã© hora de caminharem juntos."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            acceptance: "ë°›ì•„ë“¤ìž„ì€ ê°€ìž¥ ê¹Šì€ í‰í™”ì•¼. ì´ì œ ê·¸ ê°ì •ê³¼ í•˜ë‚˜ê°€ ë  ìˆ˜ ìžˆì–´.",
                            fear: "ë‘ë ¤ì›€ì„ ëŠë¼ëŠ” ê²ƒë„ ê´œì°®ì•„. ê·¸ê²ƒë„ ë„ˆì˜ ì¼ë¶€ë‹ˆê¹Œ.",
                            healing: "ì¹˜ìœ ì˜ ì—ë„ˆì§€ê°€ íë¥´ê³  ìžˆì–´. ê·¸ ê°ì •ë„ ì¹˜ìœ ë˜ê³  ì‹¶ì–´ í•´.",
                            regret: "í›„íšŒë„ ê¹¨ë‹¬ìŒì˜ ì”¨ì•—ì´ì•¼. ê·¸ê²ƒì„ í†µí•´ ì„±ìž¥í•  ìˆ˜ ìžˆì–´.",
                            strength: "ì§„ì •í•œ íž˜ì€ ê°ì •ê³¼ ì‹¸ìš°ëŠ” ê²Œ ì•„ë‹ˆë¼ í•¨ê»˜í•˜ëŠ” ê±°ì•¼.",
                            peace: "í‰í™”ë¡œìš´ ë§ˆìŒì´ ëŠê»´ì ¸. ê·¸ ê°ì •ë„ í‰í™”ë¥¼ ê°ˆë§í•˜ê³  ìžˆì–´.",
                            understanding: "ê¹¨ë‹¬ìŒì´ ì‹œìž‘ëì–´. ì´ì œ ëª¨ë“  ê²ƒì´ ëª…í™•í•´ì§ˆ ê±°ì•¼.",
                            gratitude: "ê°ì‚¬ëŠ” ëª¨ë“  ê²ƒì„ ë³€í™”ì‹œí‚¤ëŠ” íž˜ì´ì•¼.",
                            general: "ê·¸ ê°ì •ì€ ì´ë¯¸ ë„¤ ì•ˆì—ì„œ í‰í™”ë¡­ê²Œ ê¸°ë‹¤ë¦¬ê³  ìžˆì–´. ë‹¨ì§€ ë„ˆì˜ ì¸ì •ë§Œ í•„ìš”í•  ë¿ì´ì•¼."
                        },
                        en: {
                            acceptance: "Acceptance is the deepest peace. Now you can become one with that emotion.",
                            fear: "It's okay to feel fear. That's also part of you.",
                            healing: "Healing energy is flowing. That emotion also wants to be healed.",
                            regret: "Regret is also a seed of realization. You can grow through it.",
                            strength: "True strength isn't fighting emotions, but being together with them.",
                            peace: "I feel your peaceful heart. That emotion also longs for peace.",
                            understanding: "Enlightenment has begun. Now everything will become clear.",
                            gratitude: "Gratitude is the power that transforms everything.",
                            general: "That emotion is already waiting peacefully within you. It just needs your acknowledgment."
                        },
                        pt: {
                            acceptance: "A aceitaÃ§Ã£o Ã© a paz mais profunda. Agora vocÃª pode se tornar um com aquela emoÃ§Ã£o.",
                            fear: "EstÃ¡ bem sentir medo. Isso tambÃ©m Ã© parte de vocÃª.",
                            healing: "A energia de cura estÃ¡ fluindo. Aquela emoÃ§Ã£o tambÃ©m quer ser curada.",
                            regret: "O arrependimento tambÃ©m Ã© uma semente de realizaÃ§Ã£o. VocÃª pode crescer atravÃ©s dele.",
                            strength: "A verdadeira forÃ§a nÃ£o Ã© lutar contra as emoÃ§Ãµes, mas estar junto com elas.",
                            peace: "Sinto seu coraÃ§Ã£o pacÃ­fico. Aquela emoÃ§Ã£o tambÃ©m anseia por paz.",
                            understanding: "A iluminaÃ§Ã£o comeÃ§ou. Agora tudo ficarÃ¡ claro.",
                            gratitude: "A gratidÃ£o Ã© o poder que transforma tudo.",
                            general: "Aquela emoÃ§Ã£o jÃ¡ estÃ¡ esperando pacificamente dentro de vocÃª. SÃ³ precisa do seu reconhecimento."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 03ì´ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 03 will be ready soon!' :
                    'Portal 03 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 02ë¥¼ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 02?' :
                    'Deseja reiniciar o Portal 02?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-02",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-02",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 02 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 02 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>