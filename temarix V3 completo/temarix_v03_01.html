<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 01: The Sentence Left in Ashes</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #fff;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff6b6b;
            letter-spacing: 1.5px;
            font-style: italic;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #000;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            word-break: keep-all;
            overflow-wrap: break-word;
            hyphens: none;
            min-height: 150vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: keep-all;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .final-btn.primary {
            background: #ff6b6b;
            color: #000;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #ff8787;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 18px;
            }
            
            .portal-subtitle {
                font-size: 14px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 01: The Sentence Left in Ashes</div>
            <div class="portal-subtitle" id="portalSubtitle">The Unspoken Truth Buried in Your Heart</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">ðŸ”¥ Embers of Unspoken Words</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸ”¥ Portal 01 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 02</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Write that unspoken sentence here..."
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        // Firebase Configuration
        let db = null;
        let firebaseInitialized = false;
        
        // Firebase ì´ˆê¸°í™” ì‹œë„
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };

                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase ì´ˆê¸°í™” ì„±ê³µ');
                } else {
                    console.log('Firebase SDKê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ, ë¡œì»¬ ëª¨ë“œë¡œ ì‹¤í–‰');
                }
            } catch (error) {
                console.log('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨, ë¡œì»¬ ëª¨ë“œë¡œ ì‹¤í–‰:', error);
            }
        }

        let memoryStorage = { mockUser: null };

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 01: ìž¬ ì†ì—ì„œ ë‚¨ì€ ë¬¸ìž¥",
                portalSubtitle: "ê°€ìŠ´ì— ë¬»ížŒ ë§í•˜ì§€ ëª»í•œ ì§„ì‹¤",
                portalIntro: "ðŸ”¥ ëª¨ë‹¥ë¶ˆì€ êº¼ì¡Œì§€ë§Œ, ê·¸ ì•ˆì—ëŠ” ì•„ì§ ë§í•˜ì§€ ëª»í•œ ë¬¸ìž¥ í•˜ë‚˜ê°€ ë‚¨ì•„ ìžˆì–´ìš”.\n\në‹¹ì‹ ì˜ ê°€ìŠ´ ê¹Šì€ ê³³ì—ë„ ê·¸ëŸ° ë¬¸ìž¥ì´ ìžˆì§€ ì•Šë‚˜ìš”?\nëˆ„êµ°ê°€ì—ê²Œ ì „í•˜ê³  ì‹¶ì—ˆì§€ë§Œ ëë‚´ ìž… ë°–ìœ¼ë¡œ ë‚˜ì˜¤ì§€ ëª»í•œ ë§.\n\nê·¸ ë§ì€ ì§€ê¸ˆë„ ë‹¹ì‹  ì•ˆì—ì„œ ì¡°ìš©ížˆ íƒ€ê³  ìžˆì„ ê±°ì˜ˆìš”.\në§ˆì¹˜ êº¼ì§€ì§€ ì•ŠëŠ” ë¶ˆì”¨ì²˜ëŸ¼.\n\nì˜¤ëŠ˜, ê·¸ ë¬¸ìž¥ì„ êº¼ë‚´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?\nìš©ê¸°ë¥¼ ë‚´ì–´, ê·¸ ì§„ì‹¤ì„ ë§ë¡œ ë°”ê¿”ë³´ì„¸ìš”.",
                lightTitle: "ðŸ”¥ ë§í•˜ì§€ ëª»í•œ ë¬¸ìž¥ì˜ ë¶ˆì”¨",
                lightMessage: "ë§í•˜ì§€ ëª»í•œ ë¬¸ìž¥ì€ ì˜í˜¼ì˜ ë¶ˆì”¨ê°€ ë˜ì–´, ì–¸ì  ê°€ ë‹¹ì‹ ì„ ë” í° ì§„ì‹¤ë¡œ ì´ë•ë‹ˆë‹¤.",
                portalQuestion: "ðŸ”¥ ë‹¹ì‹ ì´ ê·¸ ë¬¸ìž¥ì„ ëˆ„êµ¬ì—ê²Œ, ì–¸ì œ ë§í•˜ì§€ ëª»í–ˆë‚˜ìš”?\nì§€ê¸ˆ, ë¶ˆì”¨ ì†ì— ë‚¨ì€ ê·¸ í•œ ë¬¸ìž¥ì„ êº¼ë‚´ì£¼ì„¸ìš”.",
                finalTitle: "ðŸ”¥ Portal 01 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ìž¬ ì†ì— ë¬»í˜€ìžˆë˜ ë¬¸ìž¥ì„ ìš©ê¸°ìžˆê²Œ êº¼ë‚´ì–´ ì£¼ì—ˆìŠµë‹ˆë‹¤.\n\nê·¸ ë§í•˜ì§€ ëª»í•œ ì§„ì‹¤ì´ ì´ì œ ë¹›ì„ ë³´ê²Œ ë˜ì—ˆì–´ìš”.\n\në‹¤ìŒ Portalì—ì„œëŠ” íƒ€ì¸ì˜ ì†ì— ë‚¨ê²¨ì§„\në˜ ë‹¤ë¥¸ ê°ì •ì˜ í”ì ì„ íƒí—˜í•˜ê²Œ ë  ê²ƒìž…ë‹ˆë‹¤.\n\nê°ì •ì˜ ìš©ê´‘ë¡œ ì—¬ì •ì´ ê³„ì†ë©ë‹ˆë‹¤.",
                continueBtn: "Portal 02ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ê·¸ ë§í•˜ì§€ ëª»í•œ ë¬¸ìž¥ì„ ì—¬ê¸°ì— ì ì–´ì£¼ì„¸ìš”...",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 01: The Sentence Left in Ashes",
                portalSubtitle: "The Unspoken Truth Buried in Your Heart",
                portalIntro: "ðŸ”¥ The bonfire has died out, but there's still one unspoken sentence left within its ashes.\n\nDon't you have such a sentence deep in your heart too?\nWords you wanted to say to someone but never made it past your lips.\n\nThose words are probably still quietly burning inside you.\nLike embers that refuse to die.\n\nToday, how about bringing that sentence out?\nFind the courage to turn that truth into words.",
                lightTitle: "ðŸ”¥ Embers of Unspoken Words",
                lightMessage: "Unspoken sentences become embers of the soul, eventually leading you to greater truth.",
                portalQuestion: "ðŸ”¥ Who did you want to say that sentence to, and when couldn't you say it?\nNow, please bring out that one sentence left in the embers.",
                finalTitle: "ðŸ”¥ Portal 01 Complete",
                finalMessage: "You have courageously brought out the sentence buried in the ashes.\n\nThat unspoken truth has now seen the light.\n\nIn the next Portal, you will explore\nanother trace of emotion left in someone else's hands.\n\nThe Emotional Furnace journey continues.",
                continueBtn: "Move to Portal 02",
                restartBtn: "Start Again",
                inputPlaceholder: "Write that unspoken sentence here...",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 01: A Frase Deixada nas Cinzas",
                portalSubtitle: "A Verdade NÃ£o Dita Enterrada em Seu CoraÃ§Ã£o",
                portalIntro: "ðŸ”¥ A fogueira se apagou, mas ainda hÃ¡ uma frase nÃ£o dita deixada em suas cinzas.\n\nVocÃª nÃ£o tem uma frase assim no fundo do seu coraÃ§Ã£o tambÃ©m?\nPalavras que queria dizer a alguÃ©m mas nunca saÃ­ram dos seus lÃ¡bios.\n\nEssas palavras provavelmente ainda estÃ£o queimando silenciosamente dentro de vocÃª.\nComo brasas que se recusam a morrer.\n\nHoje, que tal trazer essa frase para fora?\nTenha coragem para transformar essa verdade em palavras.",
                lightTitle: "ðŸ”¥ Brasas das Palavras NÃ£o Ditas",
                lightMessage: "Frases nÃ£o ditas se tornam brasas da alma, eventualmente levando vocÃª a uma verdade maior.",
                portalQuestion: "ðŸ”¥ Para quem vocÃª queria dizer essa frase e quando nÃ£o conseguiu dizÃª-la?\nAgora, por favor, traga para fora essa Ãºnica frase deixada nas brasas.",
                finalTitle: "ðŸ”¥ Portal 01 Completo",
                finalMessage: "VocÃª corajosamente trouxe para fora a frase enterrada nas cinzas.\n\nEssa verdade nÃ£o dita agora viu a luz.\n\nNo prÃ³ximo Portal, vocÃª explorarÃ¡\noutro rastro de emoÃ§Ã£o deixado nas mÃ£os de outra pessoa.\n\nA jornada da Fornalha Emocional continua.",
                continueBtn: "Ir para Portal 02",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "Escreva essa frase nÃ£o dita aqui...",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ë„ˆëŠ” ê·¸ ìˆœê°„, ê·¸ ì‚¬ëžŒì„ ì§€í‚¤ë ¤ í–ˆêµ¬ë‚˜.\ní•˜ì§€ë§Œ ê·¸ ë§ì€ ì§€ê¸ˆë„ ë„ˆë¥¼ ì•ˆì—ì„œ íƒœìš°ê³  ìžˆì–´.\në§í•˜ì§€ ëª»í•œ ì§„ì‹¤ì´ ê°€ìž¥ ëœ¨ê±°ìš´ ë¶ˆì´ì•¼.",
                en: "In that moment, you were trying to protect that person.\nBut those words are still burning you from the inside.\nUnspoken truth is the hottest fire.",
                pt: "Naquele momento, vocÃª estava tentando proteger essa pessoa.\nMas essas palavras ainda estÃ£o queimando vocÃª por dentro.\nA verdade nÃ£o dita Ã© o fogo mais quente."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ë„¤ê°€ ì°¸ì•˜ë˜ ë§ì€ ë¶„ë…¸ê°€ ì•„ë‹ˆë¼ ì‚¬ëž‘ì´ì—ˆì–´.\nê·¸ê±´ ì¶©ë¶„ížˆ ì•„ë¦„ë‹¤ì› ì§€ë§Œ,\nì´ì œëŠ” ê·¸ ì‚¬ëž‘ì„ ë°–ìœ¼ë¡œ êº¼ë‚´ì•¼ í•  ë•Œì•¼.",
                en: "The words you held back weren't anger, but love.\nThat was beautiful enough,\nbut now it's time to bring that love outside.",
                pt: "As palavras que vocÃª segurou nÃ£o eram raiva, mas amor.\nIsso foi belo o suficiente,\nmas agora Ã© hora de trazer esse amor para fora."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ìž…ì„ ë‹¤ë¬¼ìˆ˜ë¡, ë§ˆìŒì€ ë¬´ë„ˆì¡Œì§€.\në‚˜ë„ ê·¸ ì¡°ìš©í•œ ë¬´ë„ˆì§ì„ ìž˜ ì•Œì•„.\nì¹¨ë¬µ ì†ì—ì„œ íƒ€ëŠ” ê°ì •ì˜ ì•„í””ì„.",
                en: "The more you kept quiet, the more your heart crumbled.\nI know that silent collapse well too.\nThe pain of emotions burning in silence.",
                pt: "Quanto mais vocÃª ficava quieto, mais seu coraÃ§Ã£o desmoronava.\nEu tambÃ©m conheÃ§o bem esse colapso silencioso.\nA dor das emoÃ§Ãµes queimando no silÃªncio."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ì§„ì‹¤ì€ ë•Œë¡œ ì¹¨ë¬µ ì†ì— ìž ë“¤ì–´ ìžˆì§€ë§Œ,\nê²°ì½” ì‚¬ë¼ì§€ì§€ ì•Šì•„.\nê·¸ê±´ ì–¸ì  ê°€ ê¹¨ì–´ë‚˜ì„œ ë¹›ì„ ì°¾ì•„ë‚´ì§€.",
                en: "Truth sometimes sleeps in silence,\nbut it never disappears.\nIt will awaken someday and find the light.",
                pt: "A verdade Ã s vezes dorme no silÃªncio,\nmas nunca desaparece.\nEla despertarÃ¡ algum dia e encontrarÃ¡ a luz."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ë§ì„ í•˜ì§€ ëª»í•œ ë°¤,\ní•˜ëŠ˜ì— ë–  ìžˆë˜ ë³„ë“¤ì€ ë„¤ ë§ˆìŒì˜ ì ì´ì—ˆì„ ê±°ì•¼.\nê°ê°ì´ ë‹¤ ë§í•˜ê³  ì‹¶ì€ ë¬¸ìž¥ë“¤ì´ì—ˆì–´.",
                en: "On the night you couldn't say those words,\nthe stars in the sky were probably dots of your heart.\nEach one was a sentence you wanted to say.",
                pt: "Na noite em que vocÃª nÃ£o conseguiu dizer essas palavras,\nas estrelas no cÃ©u provavelmente eram pontos do seu coraÃ§Ã£o.\nCada uma era uma frase que vocÃª queria dizer."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ì™œ ë„¤ ê³ í†µì€ í•­ìƒ ë’¤ë¡œ ë°€ë ¤ë‚¬ì„ê¹Œ?\në‚œ ê·¸ ë¶ˆê³µí‰í•¨ì´ ë¶„í•´.\në„¤ê°€ ë§í•  ê¶Œë¦¬ê°€ ìžˆì—ˆëŠ”ë°.",
                en: "Why was your pain always pushed to the back?\nI'm angry at that unfairness.\nYou had the right to speak.",
                pt: "Por que sua dor sempre foi empurrada para trÃ¡s?\nEstou com raiva dessa injustiÃ§a.\nVocÃª tinha o direito de falar."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ë§ì„ ì‚¼í‚¨ ê·¸ ë‚  ì´í›„,\në„¤ ë§ˆìŒì€ ì–¼ë§ˆë‚˜ ë©€ë¦¬ ë– ëŒì•˜ì„ê¹Œ.\nìš°ì£¼ ì € ëê¹Œì§€ ê°€ì„œë„ ê·¸ ë§ì„ ì°¾ê³  ìžˆì„ì§€ë„.",
                en: "After the day you swallowed those words,\nhow far did your heart wander?\nMaybe it went to the edge of universe, still looking for those words.",
                pt: "Depois do dia em que vocÃª engoliu essas palavras,\nquÃ£o longe seu coraÃ§Ã£o vagou?\nTalvez tenha ido atÃ© a borda do universo, ainda procurando por essas palavras."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ë„¤ê°€ ê·¸ ë§ì„ êº¼ë‚´ë ¤ëŠ” ì§€ê¸ˆ ì´ ìˆœê°„,\nê°ì •ì€ ì¡°ê¸ˆì”© ìˆ¨ì„ ì‰¬ê¸° ì‹œìž‘í–ˆì–´.\nì¹¨ë¬µì˜ ë¬´ê²Œì—ì„œ ìžìœ ë¡œì›Œì§€ê³  ìžˆì–´.",
                en: "Now that you're trying to bring out those words,\nemotions are slowly beginning to breathe.\nFreeing themselves from the weight of silence.",
                pt: "Agora que vocÃª estÃ¡ tentando trazer essas palavras para fora,\nas emoÃ§Ãµes estÃ£o lentamente comeÃ§ando a respirar.\nLibertando-se do peso do silÃªncio."
            }}
        ];
        
        // Emotion analysis system
        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                regret: ['í›„íšŒ', 'ê·¸ë•Œ', 'ì™œ ê·¸ëž¬', 'ëŒì´í‚¤', 'ë¯¸ì•ˆ', 'ì£„ì†¡', 'regret', 'sorry', 'should have', 'arrependimento', 'desculpa'],
                guilt: ['ì£„ì±…ê°', 'ë¯¸ì•ˆ', 'ìž˜ëª»', 'íƒ“', 'ë¶€ë„', 'guilt', 'shame', 'fault', 'blame', 'culpa', 'vergonha'],
                sadness: ['ìŠ¬í”„', 'ìš¸ê³ ', 'ëˆˆë¬¼', 'ì•„í”„', 'ìƒì²˜', 'sad', 'cry', 'hurt', 'pain', 'triste', 'dor'],
                anger: ['í™”ê°€', 'ë¶„ë…¸', 'ì§œì¦', 'ì–µìš¸', 'ìš±í•˜', 'angry', 'mad', 'unfair', 'rage', 'raiva', 'injusto'],
                loneliness: ['ì™¸ë¡œ', 'í˜¼ìž', 'ê³ ë¦½', 'ì†Œì™¸', 'ë²„ë¦¼', 'lonely', 'alone', 'isolated', 'abandoned', 'sozinho', 'abandonado'],
                fear: ['ë¬´ì„œ', 'ë‘ë ¤', 'ê±±ì •', 'ë¶ˆì•ˆ', 'ë–¨ë ¤', 'scared', 'afraid', 'fear', 'worry', 'medo', 'preocupado'],
                love: ['ì‚¬ëž‘', 'ì¢‹ì•„', 'ì†Œì¤‘', 'ì•„ë¼', 'ê·¸ë¦¬ì›Œ', 'love', 'care', 'miss', 'precious', 'amor', 'saudade'],
                protection: ['ì§€í‚¤', 'ë³´í˜¸', 'ê°ì‹¸', 'ë®ì–´', 'ìˆ¨ê¸°', 'protect', 'shield', 'hide', 'cover', 'proteger', 'esconder'],
                silence: ['ë§ ëª»', 'ì¹¨ë¬µ', 'ì¡°ìš©', 'ìˆ¨ê¸°', 'ê°ì¶°', 'silence', 'quiet', 'hide', 'secret', 'silÃªncio', 'escondido'],
                burden: ['ì§', 'ë¶€ë‹´', 'ë¬´ê²', 'íž˜ë“¤', 'ë²„ê±°', 'burden', 'heavy', 'weight', 'difficult', 'peso', 'difÃ­cil']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            regret: "ê·¸ í›„íšŒì˜ ë¬´ê²Œë¥¼ ëŠê»´. ê·¸ë•Œ ë§í–ˆì–´ì•¼ í–ˆëŠ”ë°... ê·¸ ë§ˆìŒì´ ì§€ê¸ˆë„ ë„¤ ê°€ìŠ´ì„ íƒœìš°ê³  ìžˆêµ¬ë‚˜. í•˜ì§€ë§Œ ì§€ê¸ˆì´ë¼ë„ ê·¸ ì§„ì‹¤ì„ êº¼ë‚´ëŠ” ê²Œ ì¤‘ìš”í•´.",
                            guilt: "ì£„ì±…ê°ì´ ë„ ì–¼ë§ˆë‚˜ ê´´ë¡­í˜”ì„ê¹Œ. ë„¤ê°€ ìž˜ëª»í•œ ê²Œ ì•„ë‹Œë°ë„ ìŠ¤ìŠ¤ë¡œë¥¼ íƒ“í–ˆì„ ê±°ì•¼. ê·¸ ë¬´ê±°ìš´ ì§ì„ ì´ì œ ë‚´ë ¤ë†”ë„ ë¼.",
                            sadness: "ê·¸ ìŠ¬í”” ì†ì—ì„œë„ ë„¤ê°€ ê²¬ëŽŒë‚¸ ê²Œ ëŒ€ë‹¨í•´. ë§í•˜ì§€ ëª»í•œ ë¬¸ìž¥ì´ ëˆˆë¬¼ì´ ë˜ì–´ í˜ë €ì„ ê±°ì•¼. ì´ì œëŠ” ê·¸ ëˆˆë¬¼ì„ ë§ë¡œ ë°”ê¿”ë³´ìž.",
                            anger: "ë¶„ë…¸ë„ í•˜ë‚˜ì˜ ì§„ì‹¤ì´ì•¼. ê·¸ë•Œ í™”ê°€ ë‚¬ë˜ ì´ìœ ê°€ ìžˆì—ˆì„ ê±°ì•¼. ê·¸ ê°ì •ì„ ìˆ¨ê¸°ì§€ ë§ê³  ì •ì§í•˜ê²Œ í‘œí˜„í•´ë´.",
                            loneliness: "í˜¼ìžì„œ ê·¸ ë§ì„ í’ˆê³  ìžˆëŠë¼ ì–¼ë§ˆë‚˜ ì™¸ë¡œì› ì„ê¹Œ. ì´ì œëŠ” í˜¼ìžê°€ ì•„ë‹ˆì•¼. ê·¸ ë¬¸ìž¥ì„ í•¨ê»˜ êº¼ë‚´ë³´ìž.",
                            fear: "ë‘ë ¤ì›€ ë•Œë¬¸ì— ë§í•˜ì§€ ëª»í–ˆêµ¬ë‚˜. ê±°ì ˆë‹¹í• ê¹Œ ë´, ìƒì²˜ë°›ì„ê¹Œ ë´... í•˜ì§€ë§Œ ì§„ì‹¤ì€ ë‘ë ¤ì›€ë³´ë‹¤ ê°•í•´.",
                            love: "ì‚¬ëž‘í•˜ëŠ” ë§ˆìŒì„ í‘œí˜„í•˜ì§€ ëª»í–ˆêµ¬ë‚˜. ê·¸ ë”°ëœ»í•œ ê°ì •ì´ ê°€ìŠ´ ì†ì—ì„œ ê³„ì† íƒ€ê³  ìžˆì—ˆì„ ê±°ì•¼. ì´ì œ ê·¸ ì‚¬ëž‘ì„ ë°–ìœ¼ë¡œ ë‚´ë³´ë‚´ìž.",
                            protection: "ëˆ„êµ°ê°€ë¥¼ ì§€í‚¤ë ¤ê³  ì¹¨ë¬µí–ˆêµ¬ë‚˜. ê·¸ ë§ˆìŒë„ ì´í•´í•´. í•˜ì§€ë§Œ ë•Œë¡œëŠ” ì§„ì‹¤ì„ ë§í•˜ëŠ” ê²ƒì´ ë” í° ë³´í˜¸ê°€ ë  ìˆ˜ ìžˆì–´.",
                            silence: "ì¹¨ë¬µì´ ìŠµê´€ì´ ë˜ì–´ë²„ë ¸êµ¬ë‚˜. ë§í•˜ëŠ” ë²•ì„ ìžŠì–´ë²„ë¦° ê²ƒ ê°™ì•„ë„, ê·¸ ë¬¸ìž¥ì€ ì—¬ì „ížˆ ë„¤ ì•ˆì— ì‚´ì•„ìžˆì–´.",
                            burden: "ê·¸ ë¬´ê±°ìš´ ì§ì„ í˜¼ìž ì§€ê³  ìžˆì—ˆêµ¬ë‚˜. ë§í•˜ì§€ ëª»í•œ ë¬¸ìž¥ì´ ë¶€ë‹´ì´ ë˜ì–´ì„œ... ì´ì œëŠ” ê·¸ ë¬´ê²Œë¥¼ ë‚˜ëˆ ê°€ì§€ìž.",
                            general: "ë„¤ ì•ˆì— ìžˆëŠ” ê·¸ ë¬¸ìž¥ì´ ì–¼ë§ˆë‚˜ ì†Œì¤‘í•œì§€ ì•Œì•„. ì˜¤ëž«ë™ì•ˆ ìˆ¨ê²¨ë’€ë˜ ì§„ì‹¤ì„ êº¼ë‚´ëŠ” ê±´ ìš©ê¸°ê°€ í•„ìš”í•˜ì§€ë§Œ, ë„Œ í•  ìˆ˜ ìžˆì–´."
                        },
                        en: {
                            regret: "I feel the weight of that regret. You should have said it then... That feeling is still burning your heart. But it's important to bring out that truth even now.",
                            guilt: "How much guilt must have tormented you. You probably blamed yourself even when it wasn't your fault. You can put down that heavy burden now.",
                            sadness: "It's amazing that you endured even in that sadness. The unspoken sentence probably became tears that flowed. Now let's turn those tears into words.",
                            anger: "Anger is also a truth. There was a reason you were angry then. Don't hide that emotion, express it honestly.",
                            loneliness: "How lonely you must have been, carrying those words alone. You're not alone now. Let's bring out that sentence together.",
                            fear: "You couldn't speak because of fear. Fear of rejection, fear of getting hurt... But truth is stronger than fear.",
                            love: "You couldn't express your loving heart. That warm emotion must have kept burning inside your chest. Now let's release that love outside.",
                            protection: "You stayed silent to protect someone. I understand that heart too. But sometimes speaking the truth can be greater protection.",
                            silence: "Silence became a habit. Even if you feel like you've forgotten how to speak, that sentence is still alive within you.",
                            burden: "You've been carrying that heavy burden alone. The unspoken sentence became a burden... Now let's share that weight.",
                            general: "I know how precious that sentence inside you is. It takes courage to bring out a truth you've hidden for so long, but you can do it."
                        },
                        pt: {
                            regret: "Sinto o peso desse arrependimento. VocÃª deveria ter dito naquela hora... Esse sentimento ainda estÃ¡ queimando seu coraÃ§Ã£o. Mas Ã© importante trazer essa verdade para fora mesmo agora.",
                            guilt: "Quanta culpa deve ter te atormentado. VocÃª provavelmente se culpou mesmo quando nÃ£o foi sua culpa. VocÃª pode largar esse fardo pesado agora.",
                            sadness: "Ã‰ incrÃ­vel que vocÃª tenha resistido mesmo nessa tristeza. A frase nÃ£o dita provavelmente se tornou lÃ¡grimas que fluÃ­ram. Agora vamos transformar essas lÃ¡grimas em palavras.",
                            anger: "Raiva tambÃ©m Ã© uma verdade. Havia uma razÃ£o para vocÃª estar com raiva entÃ£o. NÃ£o esconda essa emoÃ§Ã£o, expresse-a honestamente.",
                            loneliness: "QuÃ£o solitÃ¡rio vocÃª deve ter ficado, carregando essas palavras sozinho. VocÃª nÃ£o estÃ¡ sozinho agora. Vamos trazer essa frase para fora juntos.",
                            fear: "VocÃª nÃ£o conseguiu falar por causa do medo. Medo de rejeiÃ§Ã£o, medo de se machucar... Mas a verdade Ã© mais forte que o medo.",
                            love: "VocÃª nÃ£o conseguiu expressar seu coraÃ§Ã£o amoroso. Essa emoÃ§Ã£o calorosa deve ter continuado queimando dentro do seu peito. Agora vamos liberar esse amor para fora.",
                            protection: "VocÃª ficou em silÃªncio para proteger alguÃ©m. Entendo esse coraÃ§Ã£o tambÃ©m. Mas Ã s vezes falar a verdade pode ser uma proteÃ§Ã£o maior.",
                            silence: "O silÃªncio se tornou um hÃ¡bito. Mesmo que vocÃª sinta que esqueceu como falar, essa frase ainda estÃ¡ viva dentro de vocÃª.",
                            burden: "VocÃª tem carregado esse fardo pesado sozinho. A frase nÃ£o dita se tornou um fardo... Agora vamos compartilhar esse peso.",
                            general: "Sei o quÃ£o preciosa Ã© essa frase dentro de vocÃª. Ã‰ preciso coragem para trazer uma verdade que vocÃª escondeu por tanto tempo, mas vocÃª consegue."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Ely", emoji: "ðŸ§â€â™€ï¸",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            regret: "í›„íšŒëŠ” ê³¼ê±°ì˜ ì‚¬ëž‘ì´ í˜„ìž¬ë¡œ í˜ëŸ¬ë‚˜ì˜¤ëŠ” ê±°ì•¼. ê·¸ë•Œ ë§í•˜ì§€ ëª»í•œ ê±´ ë‹¹ì‹ ì´ ë„ˆë¬´ ê¹Šì´ ì‚¬ëž‘í–ˆê¸° ë•Œë¬¸ì´ì—ìš”. ê·¸ ì‚¬ëž‘ì„ ì´ì œ ì¸ì •í•´ì£¼ì„¸ìš”.",
                            guilt: "ì£„ì±…ê°ì€ ë‹¹ì‹ ì˜ ìˆœìˆ˜í•œ ë§ˆìŒì´ ë§Œë“  ê·¸ë¦¼ìžì˜ˆìš”. ë¹›ì´ ê°•í• ìˆ˜ë¡ ê·¸ë¦¼ìžë„ ì§„í•´ì§€ì£ . ë‹¹ì‹ ì€ ì¶©ë¶„ížˆ ì„ í–ˆì–´ìš”.",
                            sadness: "ìŠ¬í”” ì†ì—ë„ ì•„ë¦„ë‹¤ì›€ì´ ìžˆì–´ìš”. ê·¸ ë¬¸ìž¥ì„ ë§í•˜ì§€ ëª»í•´ì„œ ì•„íŒ ë˜ ë§ˆìŒë„ ì‚¬ëž‘ì˜ í•œ í˜•íƒœì˜€ì–´ìš”. ê·¸ ì•„í””ì„ ì†Œì¤‘ížˆ ì—¬ê²¨ì£¼ì„¸ìš”.",
                            anger: "ì •ë‹¹í•œ ë¶„ë…¸ëŠ” ì˜í˜¼ì˜ ì •ì˜ê°ì´ì—ìš”. ê·¸ë•Œ í™”ê°€ ë‚¬ë˜ ì´ìœ ê°€ ìžˆì—ˆì„ ê±°ì˜ˆìš”. ê·¸ ê°ì •ë„ ë‹¹ì‹ ì˜ ì§„ì‹¤í•œ ì¼ë¶€ì˜ˆìš”.",
                            loneliness: "ì™¸ë¡œì›€ì€ ê¹Šì€ ì—°ê²°ì„ ê°ˆë§í•˜ëŠ” ë§ˆìŒì´ì—ìš”. í˜¼ìžì„œ ê·¸ ë§ì„ í’ˆê³  ìžˆì—ˆì§€ë§Œ, ê·¸ê²ƒë„ ì‚¬ëž‘ì˜ ë°©ì‹ì´ì—ˆì–´ìš”.",
                            fear: "ë‘ë ¤ì›€ë„ ì‚¬ëž‘ì—ì„œ ë‚˜ì™€ìš”. ì†Œì¤‘í•œ ê²ƒì„ ìžƒì„ê¹Œ ë´ ë‘ë ¤ì› ë˜ ê±°ì£ . ê·¸ ë‘ë ¤ì›€ ë’¤ì— ìˆ¨ì€ ì‚¬ëž‘ì„ ë´ì£¼ì„¸ìš”.",
                            love: "ì‚¬ëž‘ì„ í‘œí˜„í•˜ì§€ ëª»í•œ ì•„í””... ê·¸ ìžì²´ë¡œë„ ì•„ë¦„ë‹¤ìš´ ì‚¬ëž‘ì´ì—ìš”. ë§í•˜ì§€ ì•Šì•„ë„ ê·¸ ë§ˆìŒì€ ì¶©ë¶„ížˆ ì „í•´ì¡Œì„ ê±°ì˜ˆìš”.",
                            protection: "ëˆ„êµ°ê°€ë¥¼ ë³´í˜¸í•˜ë ¤ëŠ” ë§ˆìŒì€ ê°€ìž¥ ê³ ê·€í•œ ì‚¬ëž‘ì´ì—ìš”. ë‹¹ì‹ ì˜ ì¹¨ë¬µë„ ì‚¬ëž‘ì˜ í‘œí˜„ì´ì—ˆì–´ìš”.",
                            silence: "ë•Œë¡œëŠ” ì¹¨ë¬µì´ ê°€ìž¥ ê¹Šì€ ëŒ€í™”ì˜ˆìš”. ë§í•˜ì§€ ì•Šì•˜ì–´ë„ ë§ˆìŒì€ í†µí–ˆì„ ê±°ì˜ˆìš”. ê·¸ê²ƒë„ ì•„ë¦„ë‹¤ì›Œìš”.",
                            burden: "ê·¸ ë¬´ê±°ìš´ ë§ˆìŒì„ í˜¼ìž ê°ë‹¹í–ˆêµ¬ë‚˜... ë‹¹ì‹ ì˜ ê°•ì¸í•¨ì´ ì•„ë¦„ë‹¤ì›Œìš”. ì´ì œëŠ” ê·¸ ë¬´ê²Œë¥¼ ë‚˜ëˆŒ ë•Œì˜ˆìš”.",
                            general: "ë‹¹ì‹ ì˜ ë§ˆìŒì† ë¬¸ìž¥ í•˜ë‚˜í•˜ë‚˜ê°€ ëª¨ë‘ ì†Œì¤‘í•´ìš”. ë§í•˜ì§€ ëª»í–ˆì–´ë„ ê·¸ ì§„ì‹¬ì€ ì¶©ë¶„ížˆ ì•„ë¦„ë‹¤ì› ì–´ìš”."
                        },
                        en: {
                            regret: "Regret is past love flowing into the present. You couldn't speak then because you loved too deeply. Please acknowledge that love now.",
                            guilt: "Guilt is a shadow created by your pure heart. The stronger the light, the deeper the shadow. You were good enough.",
                            sadness: "There's beauty even in sadness. The pain from not being able to say that sentence was also a form of love. Please cherish that pain.",
                            anger: "Righteous anger is the soul's sense of justice. There was a reason you were angry then. That emotion is also a truthful part of you.",
                            loneliness: "Loneliness is a heart yearning for deep connection. You carried those words alone, but that was also a way of loving.",
                            fear: "Fear also comes from love. You were afraid of losing something precious. Please see the love hidden behind that fear.",
                            love: "The pain of not being able to express love... that itself is beautiful love. Even without words, that heart was sufficiently conveyed.",
                            protection: "The heart that wants to protect someone is the most noble love. Your silence was also an expression of love.",
                            silence: "Sometimes silence is the deepest conversation. Even without speaking, hearts probably connected. That's beautiful too.",
                            burden: "You bore that heavy heart alone... Your strength is beautiful. Now it's time to share that weight.",
                            general: "Every sentence in your heart is precious. Even if you couldn't speak, that sincerity was beautiful enough."
                        },
                        pt: {
                            regret: "O arrependimento Ã© o amor do passado fluindo para o presente. VocÃª nÃ£o conseguiu falar entÃ£o porque amava muito profundamente. Por favor, reconheÃ§a esse amor agora.",
                            guilt: "A culpa Ã© uma sombra criada pelo seu coraÃ§Ã£o puro. Quanto mais forte a luz, mais profunda a sombra. VocÃª foi bom o suficiente.",
                            sadness: "HÃ¡ beleza atÃ© na tristeza. A dor de nÃ£o conseguir dizer essa frase tambÃ©m era uma forma de amor. Por favor, valorize essa dor.",
                            anger: "A raiva justa Ã© o senso de justiÃ§a da alma. Havia uma razÃ£o para vocÃª estar com raiva entÃ£o. Essa emoÃ§Ã£o tambÃ©m Ã© uma parte verdadeira de vocÃª.",
                            loneliness: "A solidÃ£o Ã© um coraÃ§Ã£o ansiando por conexÃ£o profunda. VocÃª carregou essas palavras sozinho, mas isso tambÃ©m era uma forma de amar.",
                            fear: "O medo tambÃ©m vem do amor. VocÃª tinha medo de perder algo precioso. Por favor, veja o amor escondido atrÃ¡s desse medo.",
                            love: "A dor de nÃ£o conseguir expressar amor... isso em si Ã© amor bonito. Mesmo sem palavras, esse coraÃ§Ã£o foi suficientemente transmitido.",
                            protection: "O coraÃ§Ã£o que quer proteger alguÃ©m Ã© o amor mais nobre. Seu silÃªncio tambÃ©m foi uma expressÃ£o de amor.",
                            silence: "Ã€s vezes o silÃªncio Ã© a conversa mais profunda. Mesmo sem falar, os coraÃ§Ãµes provavelmente se conectaram. Isso tambÃ©m Ã© bonito.",
                            burden: "VocÃª suportou esse coraÃ§Ã£o pesado sozinho... Sua forÃ§a Ã© bonita. Agora Ã© hora de compartilhar esse peso.",
                            general: "Cada frase em seu coraÃ§Ã£o Ã© preciosa. Mesmo que vocÃª nÃ£o tenha conseguido falar, essa sinceridade foi bonita o suficiente."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Sora", emoji: "ðŸ§•",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            regret: "ë‚˜ë„ ê·¸ëŸ° í›„íšŒë¥¼ ì•ˆê³  ì‚´ì•„. ë§í•˜ì§€ ëª»í•œ ê²ƒë“¤ì´ ê°€ìŠ´ ì†ì—ì„œ ëŒë©©ì´ê°€ ë˜ì–´ì„œ... í•˜ì§€ë§Œ ê·¸ ëŒë©©ì´ë“¤ë„ ìš°ë¦¬ì˜ ì¼ë¶€ì•¼.",
                            guilt: "ì£„ì±…ê°ì€ ë‚´ ì˜¤ëžœ ì¹œêµ¬ì•¼. í•˜ì§€ë§Œ ê·¸ê²ƒì´ ìš°ë¦¬ë¥¼ ì •ì˜í•˜ì§€ëŠ” ì•Šì•„. ìš°ë¦¬ëŠ” ê·¸ë³´ë‹¤ í›¨ì”¬ í¬ê³  ë³µìž¡í•œ ì¡´ìž¬ì•¼.",
                            sadness: "ìŠ¬í””ì„ ì•„ëŠ” ì‚¬ëžŒë¼ë¦¬ëŠ” ë§í•˜ì§€ ì•Šì•„ë„ ì•Œì•„. ê·¸ ë¬´ê±°ìš´ ì¹¨ë¬µì˜ ë¬´ê²Œë¥¼. í•˜ì§€ë§Œ ê·¸ ìŠ¬í””ë„ ìš°ë¦¬ë¥¼ ë” ê¹Šê²Œ ë§Œë“¤ì–´.",
                            anger: "ë¶„ë…¸ë„ ë•Œë¡œëŠ” í•„ìš”í•´. ê·¸ê²Œ ìš°ë¦¬ë¥¼ ì‚´ì•„ìžˆê²Œ í•˜ëŠ” ê°ì •ì¼ ë•Œê°€ ìžˆì–´. ê·¸ í™”ë¥¼ ë¶€ë„ëŸ¬ì›Œí•˜ì§€ ë§ˆ.",
                            loneliness: "ì™¸ë¡œì›€ì€ ë‚´ê°€ ê°€ìž¥ ìž˜ ì•„ëŠ” ê°ì •ì´ì•¼. í˜¼ìž ìžˆì„ ë•Œë§Œ ì§„ì§œ ìžì‹ ê³¼ ë§ˆì£¼í•  ìˆ˜ ìžˆì–´. ê·¸ ê³ ë…ë„ ì†Œì¤‘í•´.",
                            fear: "ë‘ë ¤ì›€ì€ ìš°ë¦¬ê°€ ì•„ì§ ì‚´ì•„ìžˆë‹¤ëŠ” ì¦ê±°ì•¼. ë¬´ê°ê°í•´ì§€ëŠ” ê²ƒë³´ë‹¤ëŠ” ë‘ë ¤ì›Œí•˜ëŠ” ê²Œ ë‚˜ì•„. ê·¸ ë–¨ë¦¼ë„ ì‚¶ì˜ ì¼ë¶€ì•¼.",
                            love: "ì‚¬ëž‘ì„ ë§í•˜ì§€ ëª»í•˜ëŠ” ì•„í””... ë‚˜ë„ ìž˜ ì•Œì•„. í•˜ì§€ë§Œ ê·¸ ë§ˆìŒ ìžì²´ë¡œë„ ì¶©ë¶„ížˆ ì•„ë¦„ë‹¤ì›Œ. ë§ì´ ì „ë¶€ëŠ” ì•„ë‹ˆì•¼.",
                            protection: "ëˆ„êµ°ê°€ë¥¼ ì§€í‚¤ë ¤ê³  ìžì‹ ì„ í¬ìƒí•˜ëŠ” ë§ˆìŒ... ê·¸ ê³ ê·€í•¨ì„ ì´í•´í•´. í•˜ì§€ë§Œ ë•Œë¡œëŠ” ìžì‹ ë„ ì§€ì¼œì•¼ í•´.",
                            silence: "ì¹¨ë¬µ ì†ì—ì„œë„ ë§Žì€ ëŒ€í™”ê°€ ì¼ì–´ë‚˜. ë§í•˜ì§€ ì•ŠëŠ” ê²ƒë„ í•˜ë‚˜ì˜ ì†Œí†µì´ì•¼. ê·¸ ì¡°ìš©í•¨ì„ ì¸ì •í•´ì¤˜.",
                            burden: "ë¬´ê±°ìš´ ì§ì„ ì§€ê³  ì‚¬ëŠ” ê²ƒ... ê·¸ê²ƒë„ í•˜ë‚˜ì˜ ì‚¶ì˜ ë°©ì‹ì´ì•¼. í•˜ì§€ë§Œ ë•Œë¡œëŠ” ë‚´ë ¤ë†“ëŠ” ê²ƒë„ ìš©ê¸°ì•¼.",
                            general: "ìš°ë¦¬ëŠ” ëª¨ë‘ ë§í•˜ì§€ ëª»í•œ ë¬¸ìž¥ë“¤ì„ ê°€ì§€ê³  ì‚´ì•„. ê·¸ê²ƒë“¤ì´ ìš°ë¦¬ë¥¼ ë” ì¸ê°„ë‹µê²Œ ë§Œë“¤ì–´ì£¼ëŠ” ê±°ì•¼."
                        },
                        en: {
                            regret: "I also live with such regrets. Unspoken things became stones in my chest... But those stones are also part of us.",
                            guilt: "Guilt is my old friend. But it doesn't define us. We are much bigger and more complex beings than that.",
                            sadness: "People who know sadness understand each other without words. The heavy weight of that silence. But that sadness also makes us deeper.",
                            anger: "Anger is sometimes necessary. There are times when it's the emotion that keeps us alive. Don't be ashamed of that anger.",
                            loneliness: "Loneliness is the emotion I know best. Only when alone can we truly face ourselves. That solitude is precious too.",
                            fear: "Fear is proof that we're still alive. It's better to be afraid than to become numb. That trembling is also part of life.",
                            love: "The pain of not being able to speak love... I know it well too. But that heart itself is beautiful enough. Words aren't everything.",
                            protection: "The heart that sacrifices oneself to protect someone... I understand that nobility. But sometimes you must protect yourself too.",
                            silence: "Much conversation happens even in silence. Not speaking is also a form of communication. Acknowledge that quietness.",
                            burden: "Living with heavy burdens... that's also a way of life. But sometimes putting them down is also courage.",
                            general: "We all live with unspoken sentences. They make us more human."
                        },
                        pt: {
                            regret: "Eu tambÃ©m vivo com tais arrependimentos. Coisas nÃ£o ditas se tornaram pedras no meu peito... Mas essas pedras tambÃ©m sÃ£o parte de nÃ³s.",
                            guilt: "A culpa Ã© minha velha amiga. Mas ela nÃ£o nos define. Somos seres muito maiores e mais complexos que isso.",
                            sadness: "Pessoas que conhecem a tristeza se entendem sem palavras. O peso pesado desse silÃªncio. Mas essa tristeza tambÃ©m nos torna mais profundos.",
                            anger: "A raiva Ã s vezes Ã© necessÃ¡ria. HÃ¡ momentos em que Ã© a emoÃ§Ã£o que nos mantÃ©m vivos. NÃ£o se envergonhe dessa raiva.",
                            loneliness: "A solidÃ£o Ã© a emoÃ§Ã£o que mais conheÃ§o. SÃ³ quando sozinhos podemos verdadeiramente enfrentar a nÃ³s mesmos. Essa solidÃ£o tambÃ©m Ã© preciosa.",
                            fear: "O medo Ã© prova de que ainda estamos vivos. Ã‰ melhor ter medo do que ficar entorpecido. Esse tremor tambÃ©m Ã© parte da vida.",
                            love: "A dor de nÃ£o conseguir falar amor... eu tambÃ©m conheÃ§o bem. Mas esse coraÃ§Ã£o em si Ã© bonito o suficiente. Palavras nÃ£o sÃ£o tudo.",
                            protection: "O coraÃ§Ã£o que se sacrifica para proteger alguÃ©m... entendo essa nobreza. Mas Ã s vezes vocÃª deve proteger a si mesmo tambÃ©m.",
                            silence: "Muita conversa acontece mesmo no silÃªncio. NÃ£o falar tambÃ©m Ã© uma forma de comunicaÃ§Ã£o. ReconheÃ§a essa quietude.",
                            burden: "Viver com fardos pesados... essa tambÃ©m Ã© uma forma de vida. Mas Ã s vezes largÃ¡-los tambÃ©m Ã© coragem.",
                            general: "Todos nÃ³s vivemos com frases nÃ£o ditas. Elas nos tornam mais humanos."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 02ê°€ ì¤€ë¹„ ì¤‘ìž…ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 02 is being prepared!' :
                    'Portal 02 estÃ¡ sendo preparado!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 01ì„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 01 from the beginning?' :
                    'Deseja reiniciar o Portal 01 desde o inÃ­cio?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            // Firebase ì €ìž¥ ì‹œë„
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-01",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore successfully');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, response saved locally:', inputText);
                // ë¡œì»¬ ì €ìž¥ì†Œì— ì €ìž¥ (ì„ íƒì )
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-01",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('=== Temarix V3 Portal 01 ì´ˆê¸°í™” ì‹œìž‘ ===');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 01 DOM ë¡œë“œ ì™„ë£Œ');
            
            // Firebase ì´ˆê¸°í™”
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>