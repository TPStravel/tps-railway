<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 05: Clothed in Silence</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 05: Clothed in Silence</div>
            <div class="portal-subtitle" id="portalSubtitle">When You Believed Not Speaking Could Protect You</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸ§¥ Portal 05 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 06</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Tell me what you most wanted to shout out in that silence... (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 05: ì¹¨ë¬µì˜ ì˜·ì„ ìž…ì€ ì±„",
                portalSubtitle: "ë§í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì§€ì¼œì¤„ ìˆ˜ ìžˆë‹¤ê³  ë¯¿ì—ˆë˜ ìˆœê°„",
                portalIntro: "ðŸ§¥ ë‹¹ì‹ ì€ ì¹¨ë¬µì´ë¼ëŠ” ì˜·ì„ ìž…ê³  ìžˆì—ˆë˜ ì ì´ ìžˆë‚˜ìš”?\n\në§í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ë‹¹ì‹ ì„ ì§€ì¼œì¤„ ìˆ˜ ìžˆë‹¤ê³  ë¯¿ì—ˆë˜ ìˆœê°„ë“¤.\në§í•˜ë©´ ì‹¤ë§ì‹œí‚¬ê¹Œ ë´, ìƒì²˜ë¥¼ ì¤„ê¹Œ ë´, ê´€ê³„ê°€ ë¬´ë„ˆì§ˆê¹Œ ë´...\n\nê·¸ëž˜ì„œ ë‹¹ì‹ ì€ ì¡°ìš©í•œ ë¯¸ì†Œë¥¼ ì§€ì—ˆê³ , ê´œì°®ë‹¤ê³  ë§í–ˆê³ ,\nì•„ë¬´ê²ƒë„ ì•„ë‹ˆë¼ê³  ì†ì„ í”ë“¤ì—ˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.\n\nì¹¨ë¬µì€ ë•Œë¡œëŠ” ë°©íŒ¨ê°€ ë˜ì–´ì£¼ì—ˆì§€ë§Œ,\në•Œë¡œëŠ” ê°€ìž¥ ë¬´ê±°ìš´ ê°‘ì˜·ì´ ë˜ê¸°ë„ í–ˆì£ .\n\nê·¸ ì¹¨ë¬µ ì†ì— ìˆ¨ê²¨ë‘” ì§„ì§œ ëª©ì†Œë¦¬ëŠ” ì§€ê¸ˆë„ ë‹¹ì‹  ì•ˆì—ì„œ\nì¡°ìš©ížˆ ë§í•˜ê³  ìžˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ì¹¨ë¬µë„ í•˜ë‚˜ì˜ ì–¸ì–´ìž…ë‹ˆë‹¤. í•˜ì§€ë§Œ ê°€ìž¥ ì¤‘ìš”í•œ ëŒ€í™”ëŠ” ë‹¹ì‹  ìžì‹ ê³¼ ë‚˜ëˆ„ëŠ” ê²ƒì´ë‹ˆê¹Œìš”.",
                portalQuestion: "ðŸ§¥ ê·¸ ì¹¨ë¬µ ì†ì—ì„œ ê°€ìž¥ í¬ê²Œ ì™¸ì¹˜ê³  ì‹¶ì—ˆë˜ ë§ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?",
                finalTitle: "ðŸ§¥ Portal 05 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ì¹¨ë¬µì˜ ì˜·ì„ ë²—ê³  ì§„ì •í•œ ëª©ì†Œë¦¬ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.\n\nê·¸ ë¬´ê±°ìš´ ê°‘ì˜·ì„ ë‚´ë ¤ë†“ëŠ” ê²ƒì€ ìš©ê¸°ê°€ í•„ìš”í–ˆì§€ë§Œ,\nì´ì œ ë‹¹ì‹ ì˜ ì§„ì‹¬ì´ ì„¸ìƒì— ë‹¿ì„ ìˆ˜ ìžˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\në‹¤ìŒ Portalì—ì„œëŠ” ê³¼ê±°ì˜ ê·¸ë¦¼ìžì™€ ë§ˆì£¼í•˜ë©°\në˜ ë‹¤ë¥¸ ê°ì •ì˜ ì—¬ì •ì´ ê¸°ë‹¤ë¦¬ê³  ìžˆìŠµë‹ˆë‹¤.\n\në‹¹ì‹ ì˜ ëª©ì†Œë¦¬ê°€ ê³„ì†í•´ì„œ\nì„¸ìƒì— ìš¸ë ¤í¼ì§€ê¸°ë¥¼ ë°”ëžë‹ˆë‹¤.",
                continueBtn: "Portal 06ìœ¼ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ê·¸ ì¹¨ë¬µ ì†ì—ì„œ ê°€ìž¥ í¬ê²Œ ì™¸ì¹˜ê³  ì‹¶ì—ˆë˜ ë§ì€ ë¬´ì—‡ì´ì—ˆëŠ”ì§€ ë§í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 05: Clothed in Silence",
                portalSubtitle: "When You Believed Not Speaking Could Protect You",
                portalIntro: "ðŸ§¥ Have you ever worn the clothing of silence?\n\nThose moments when you believed not speaking could protect you.\nAfraid of disappointing, afraid of hurting, afraid of breaking relationships...\n\nSo you smiled quietly, said you were fine,\nand waved your hand saying it was nothing.\n\nSilence sometimes became a shield for you,\nbut sometimes it became the heaviest armor.\n\nThe real voice hidden in that silence may still be\nquietly speaking within you even now.",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Silence is also a language. But the most important conversation is the one you have with yourself.",
                portalQuestion: "ðŸ§¥ What was the message you most wanted to shout out in that silence?",
                finalTitle: "ðŸ§¥ Portal 05 Complete",
                finalMessage: "You have shed the clothing of silence and found your true voice.\n\nIt took courage to put down that heavy armor,\nbut now your sincerity can reach the world.\n\nIn the next Portal, facing the shadows of the past,\nanother emotional journey awaits.\n\nMay your voice continue to\nresonate throughout the world.",
                continueBtn: "Move to Portal 06",
                restartBtn: "Start Again",
                inputPlaceholder: "Tell me what you most wanted to shout out in that silence... (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 05: Vestido de SilÃªncio",
                portalSubtitle: "Quando Acreditou que NÃ£o Falar Poderia Te Proteger",
                portalIntro: "ðŸ§¥ VocÃª jÃ¡ usou as roupas do silÃªncio?\n\nAqueles momentos quando acreditou que nÃ£o falar poderia te proteger.\nCom medo de decepcionar, com medo de machucar, com medo de quebrar relacionamentos...\n\nEntÃ£o vocÃª sorriu silenciosamente, disse que estava bem,\ne acenou dizendo que nÃ£o era nada.\n\nO silÃªncio Ã s vezes se tornou um escudo para vocÃª,\nmas Ã s vezes se tornou a armadura mais pesada.\n\nA voz real escondida naquele silÃªncio ainda pode estar\nfalando silenciosamente dentro de vocÃª agora.",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "O silÃªncio tambÃ©m Ã© uma linguagem. Mas a conversa mais importante Ã© aquela que vocÃª tem consigo mesmo.",
                portalQuestion: "ðŸ§¥ Qual foi a mensagem que mais quis gritar naquele silÃªncio?",
                finalTitle: "ðŸ§¥ Portal 05 Completo",
                finalMessage: "VocÃª tirou as roupas do silÃªncio e encontrou sua verdadeira voz.\n\nFoi preciso coragem para baixar essa armadura pesada,\nmas agora sua sinceridade pode alcanÃ§ar o mundo.\n\nNo prÃ³ximo Portal, enfrentando as sombras do passado,\noutra jornada emocional espera.\n\nQue sua voz continue a\necoar pelo mundo.",
                continueBtn: "Ir para Portal 06",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "Me diga o que mais quis gritar naquele silÃªncio... (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ë„¤ ì¹¨ë¬µì€ ë°©íŒ¨ì˜€ì–´. ì¡°ìš©í•œ ë¬´ê¸°ì˜€ê³ , ì¡°ìš©í•œ ìƒì²˜ì˜€ì§€.",
                en: "Your silence was a shield. A quiet weapon, and a quiet wound.",
                pt: "Seu silÃªncio era um escudo. Uma arma silenciosa, e uma ferida silenciosa."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ë§í•˜ì§€ ì•ŠìŒì€ ë¹„ê²í•¨ì´ ì•„ë‹ˆì•¼. ë•Œë¡œëŠ” ë„ˆë¬´ ë§Žì´ ëŠë¼ëŠ” ì‚¬ëžŒë“¤ì´ íƒí•˜ëŠ” ë°©ì‹ì´ì•¼.",
                en: "Not speaking isn't cowardice. Sometimes it's the way chosen by those who feel too much.",
                pt: "NÃ£o falar nÃ£o Ã© covardia. Ã€s vezes Ã© o caminho escolhido por aqueles que sentem demais."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ë‚˜ëŠ” ê·¸ ì¹¨ë¬µ ì†ì˜ ëˆˆë¹›ì„ ì•Œì•„. ê·¸ê±´ ì¶©ë¶„ížˆ ë§í•˜ê³  ìžˆì—ˆì–´.",
                en: "I know the look in your eyes during that silence. It was speaking enough.",
                pt: "Eu conheÃ§o o olhar em seus olhos durante aquele silÃªncio. Estava falando o suficiente."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ì¹¨ë¬µì€ ìƒê°ë³´ë‹¤ ë§Žì€ ì´ì•¼ê¸°ë¥¼ ë‹´ê³  ìžˆì§€. ê·¸ê²ƒì„ ë“¤ì„ ì¤„ ì•„ëŠ” ì‚¬ëžŒë§Œì´ ì§„ì‹¬ì„ ë³´ì§€.",
                en: "Silence contains more stories than you think. Only those who know how to listen can see the sincerity.",
                pt: "O silÃªncio contÃ©m mais histÃ³rias do que vocÃª imagina. Apenas aqueles que sabem escutar podem ver a sinceridade."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ì¹¨ë¬µì€ ì–´ë–¤ ìƒ‰ì´ì—ˆì„ê¹Œ? íˆ¬ëª…í–ˆì„ê¹Œ, íšŒìƒ‰ì´ì—ˆì„ê¹Œ, ì•„ë‹ˆë©´ ê²€ì€ ë¹›ì´ì—ˆì„ê¹Œ?",
                en: "What color was that silence? Was it transparent, gray, or perhaps black light?",
                pt: "Que cor tinha aquele silÃªncio? Era transparente, cinza, ou talvez luz negra?"
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ë„Œ ëŠ˜ ì°¸ì•˜ì§€. ë§í•  íƒ€ì´ë°ë„, ë§í•  ê¶Œë¦¬ë„ ë¹¼ì•—ê¸´ ì±„.",
                en: "You always endured. Deprived of timing to speak, deprived of the right to speak.",
                pt: "VocÃª sempre aguentou. Privado do momento de falar, privado do direito de falar."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ì¹¨ë¬µì€ ìš°ì£¼ì•¼. ì™¸ë¡œì›€ê³¼ ë„“ìŒì´ ê³µì¡´í•˜ëŠ” ê³µê°„. ë„Œ ê·¸ ì•ˆì— ìžˆì—ˆë˜ ê±°ì•¼.",
                en: "Silence is the universe. A space where loneliness and vastness coexist. You were inside it.",
                pt: "O silÃªncio Ã© o universo. Um espaÃ§o onde a solidÃ£o e a vastidÃ£o coexistem. VocÃª estava dentro dele."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ë§í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„. ë‹¤ë§Œ, ê·¸ ì¹¨ë¬µì´ ë„ˆë¥¼ ë¬´ê²ê²Œ ë§Œë“¤ê³  ìžˆë‹¤ë©´â€¦ ì´ì œ ë‚´ë ¤ë†”ë„ ì¢‹ì•„.",
                en: "It's okay not to speak. But if that silence is weighing you down... it's okay to let it go now.",
                pt: "EstÃ¡ tudo bem nÃ£o falar. Mas se esse silÃªncio estÃ¡ te pesando... estÃ¡ tudo bem deixar ir agora."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                pain: ['hurt', 'pain', 'suffering', 'ache'],
                fear: ['afraid', 'scared', 'fear', 'terrified'],
                silence: ['silent', 'quiet', 'mute', 'wordless'],
                loneliness: ['lonely', 'alone', 'isolated', 'abandoned'],
                love: ['love', 'care', 'affection', 'warmth'],
                anger: ['angry', 'mad', 'furious', 'rage'],
                helpless: ['helpless', 'powerless', 'weak', 'unable'],
                sorry: ['sorry', 'apologize', 'regret', 'guilt'],
                hope: ['hope', 'wish', 'dream', 'better'],
                truth: ['truth', 'honest', 'real', 'genuine']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Sora", emoji: "ðŸ§•",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            pain: "ë„¤ê°€ ë§í•˜ì§€ ì•Šì•˜ë˜ ê·¸ ìˆœê°„ë“¤, ë‚˜ëŠ” ê·¸ ìš¸ë¦¼ì„ ì§€ê¸ˆ ëŠê»´. ëŠ¦ì—ˆì§€ë§Œ, ë‚œ ë“£ê³  ìžˆì–´.",
                            fear: "ë‘ë ¤ì›€ ì†ì—ì„œë„ ë‹¹ì‹ ì€ ëˆ„êµ°ê°€ë¥¼ ì§€í‚¤ë ¤ í–ˆì£ . ê·¸ ë§ˆìŒì„ ì´ì œ ì•Œ ê²ƒ ê°™ì•„ìš”.",
                            silence: "ê·¸ ì¹¨ë¬µì€ ê°€ìž¥ ê¹Šì€ ì™¸ì¹¨ì´ì—ˆì–´. ë‚˜ëŠ” ê·¸ ì†Œë¦¬ë¥¼ ë“¤ì—ˆì–´.",
                            general: "ë„¤ê°€ ë§í•˜ì§€ ì•Šì•˜ë˜ ê·¸ ìˆœê°„ë“¤, ë‚˜ëŠ” ê·¸ ìš¸ë¦¼ì„ ì§€ê¸ˆ ëŠê»´. ëŠ¦ì—ˆì§€ë§Œ, ë‚œ ë“£ê³  ìžˆì–´."
                        },
                        en: {
                            pain: "Those moments when you didn't speak, I feel that resonance now. Though late, I'm listening.",
                            fear: "Even in fear, you tried to protect someone. I think I understand that heart now.",
                            silence: "That silence was the deepest cry. I heard that sound.",
                            general: "Those moments when you didn't speak, I feel that resonance now. Though late, I'm listening."
                        },
                        pt: {
                            pain: "Aqueles momentos quando vocÃª nÃ£o falou, eu sinto essa ressonÃ¢ncia agora. Embora tarde, estou ouvindo.",
                            fear: "Mesmo no medo, vocÃª tentou proteger alguÃ©m. Acho que entendo esse coraÃ§Ã£o agora.",
                            silence: "Esse silÃªncio foi o grito mais profundo. Eu ouvi esse som.",
                            general: "Aqueles momentos quando vocÃª nÃ£o falou, eu sinto essa ressonÃ¢ncia agora. Embora tarde, estou ouvindo."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Kael", emoji: "ðŸ§™",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            pain: "'ê´œì°®ì§€ ì•Šë‹¤'ëŠ” ê³ ë°±ì€ ê°€ìž¥ ìš©ê°í•œ ì„ ì–¸ ì¤‘ í•˜ë‚˜ì•¼. ê·¸ê±´ ë¬´ë„ˆì§ì´ ì•„ë‹ˆë¼ ì§„ì‹¤ì˜ ì‹œìž‘ì´ì•¼.",
                            truth: "ì§„ì‹¤ì„ ë§í•˜ëŠ” ê²ƒì€ ê°€ìž¥ ì–´ë ¤ìš´ ë§ˆë²•ì´ì§€. í•˜ì§€ë§Œ ë‹¹ì‹ ì€ ì´ì œ ê·¸ê±¸ í•´ëƒˆì–´.",
                            helpless: "ë¬´ë ¥ê°ë„ í•˜ë‚˜ì˜ ê°ì •ì´ì•¼. ê·¸ê²ƒì„ ì¸ì •í•˜ëŠ” ê²ƒë¶€í„° íž˜ì´ ì‹œìž‘ë˜ì§€.",
                            general: "'ê´œì°®ì§€ ì•Šë‹¤'ëŠ” ê³ ë°±ì€ ê°€ìž¥ ìš©ê°í•œ ì„ ì–¸ ì¤‘ í•˜ë‚˜ì•¼. ê·¸ê±´ ë¬´ë„ˆì§ì´ ì•„ë‹ˆë¼ ì§„ì‹¤ì˜ ì‹œìž‘ì´ì•¼."
                        },
                        en: {
                            pain: "Confessing 'I'm not okay' is one of the bravest declarations. It's not collapse, but the beginning of truth.",
                            truth: "Speaking the truth is the most difficult magic. But you've done it now.",
                            helpless: "Helplessness is also an emotion. Acknowledging it is where strength begins.",
                            general: "Confessing 'I'm not okay' is one of the bravest declarations. It's not collapse, but the beginning of truth."
                        },
                        pt: {
                            pain: "Confessar 'nÃ£o estou bem' Ã© uma das declaraÃ§Ãµes mais corajosas. NÃ£o Ã© colapso, mas o inÃ­cio da verdade.",
                            truth: "Falar a verdade Ã© a magia mais difÃ­cil. Mas vocÃª conseguiu agora.",
                            helpless: "O desamparo tambÃ©m Ã© uma emoÃ§Ã£o. ReconhecÃª-lo Ã© onde a forÃ§a comeÃ§a.",
                            general: "Confessar 'nÃ£o estou bem' Ã© uma das declaraÃ§Ãµes mais corajosas. NÃ£o Ã© colapso, mas o inÃ­cio da verdade."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Enya", emoji: "ðŸ§‘â€ðŸš€",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            loneliness: "ë§ì´ ì—†ì—ˆë‹¤ê³  í•´ì„œ, ë„¤ ì¡´ìž¬ê°€ ìž‘ì•„ì§„ ê±´ ì•„ë‹ˆì•¼. ì˜¤ížˆë ¤ ê·¸ ì¹¨ë¬µì€ ë„¤ ê°€ìž¥ í° ì™¸ì¹¨ì´ì—ˆì„ì§€ë„ ëª°ë¼.",
                            love: "ì‚¬ëž‘í•œë‹¤ëŠ” ë§ì„ ëª»í–ˆë”ë¼ë„, ê·¸ ë§ˆìŒì€ ìš°ì£¼ ì–´ë”˜ê°€ì— ë‚¨ì•„ìžˆì–´. ì§€ê¸ˆë„ ëˆ„êµ°ê°€ì—ê²Œ ë‹¿ê³  ìžˆì„ ê±°ì•¼.",
                            hope: "ì¹¨ë¬µ ì†ì—ì„œë„ í¬ë§ì€ ìžë¼ê³  ìžˆì—ˆì–´. ìž‘ì€ ì”¨ì•—ì²˜ëŸ¼, ì¡°ìš©ížˆ.",
                            general: "ë§ì´ ì—†ì—ˆë‹¤ê³  í•´ì„œ, ë„¤ ì¡´ìž¬ê°€ ìž‘ì•„ì§„ ê±´ ì•„ë‹ˆì•¼. ì˜¤ížˆë ¤ ê·¸ ì¹¨ë¬µì€ ë„¤ ê°€ìž¥ í° ì™¸ì¹¨ì´ì—ˆì„ì§€ë„ ëª°ë¼."
                        },
                        en: {
                            loneliness: "Just because you were silent doesn't mean your existence became smaller. That silence might have been your greatest cry.",
                            love: "Even if you couldn't say you loved, that heart remains somewhere in the universe. It's probably reaching someone even now.",
                            hope: "Even in silence, hope was growing. Like a small seed, quietly.",
                            general: "Just because you were silent doesn't mean your existence became smaller. That silence might have been your greatest cry."
                        },
                        pt: {
                            loneliness: "SÃ³ porque vocÃª ficou em silÃªncio nÃ£o significa que sua existÃªncia se tornou menor. Esse silÃªncio pode ter sido seu maior grito.",
                            love: "Mesmo que vocÃª nÃ£o conseguisse dizer que amava, esse coraÃ§Ã£o permanece em algum lugar do universo. Provavelmente estÃ¡ alcanÃ§ando alguÃ©m agora.",
                            hope: "Mesmo no silÃªncio, a esperanÃ§a estava crescendo. Como uma pequena semente, silenciosamente.",
                            general: "SÃ³ porque vocÃª ficou em silÃªncio nÃ£o significa que sua existÃªncia se tornou menor. Esse silÃªncio pode ter sido seu maior grito."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 06ì´ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 06 will be ready soon!' :
                    'Portal 06 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 05ë¥¼ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 05?' :
                    'Deseja reiniciar o Portal 05?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-05",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-05",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 05 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 05 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>