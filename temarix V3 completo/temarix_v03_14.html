<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 14: Comfort That Never Reached My Fingertips</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 14: Comfort That Never Reached My Fingertips</div>
            <div class="portal-subtitle" id="portalSubtitle">The Warmth That Almost Touched Me</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸ¤² Portal 14 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 15</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What would you like to say to that comfort, or to that person? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 14: ì†ëì— ë‹¿ì§€ ì•Šì•˜ë˜ ìœ„ë¡œ",
                portalSubtitle: "ë‚˜ì—ê²Œ ê±°ì˜ ë‹¤ê°€ì™”ë˜ ì˜¨ê¸°",
                portalIntro: "ðŸ¤² ëˆ„êµ°ê°€ì˜ ìœ„ë¡œê°€ ì•„ì£¼ ê°€ê¹Œì´ ìžˆì—ˆì§€ë§Œ,\nëë‚´ ë‹¿ì§€ ì•Šì•˜ë˜ ìˆœê°„ì´ ìžˆì—ˆë‚˜ìš”?\n\nê·¸ ì†ëì— ë‹¿ì§€ ì•Šì€ ìœ„ë¡œëŠ”,\në‹¹ì‹ ì—ê²Œ ì–´ë–¤ ê°ì •ì„ ë‚¨ê²¼ë‚˜ìš”?\n\në§ ì—†ì´ ë‹¤ê°€ì™”ë˜ ì¹œêµ¬ê°€ ìžˆì—ˆì–´ìš”.\në¶„ëª… ë‚˜ë¥¼ ìœ„ë¡œí•˜ê³  ì‹¶ì–´ í–ˆëŠ”ë°â€¦\në‚˜ëŠ” ëë‚´ ê·¸ ì†ì„ ìž¡ì§€ ëª»í–ˆì–´ìš”.",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ë„ˆëŠ” ê·¸ ì†ì„ ë†“ì¹œ ê²Œ ì•„ë‹ˆë¼ ì§€ê¸ˆ, ë§ˆìŒìœ¼ë¡œ ë‹¤ì‹œ ìž¡ê³  ìžˆì–´.",
                portalQuestion: "ðŸ¤² ê·¸ë•Œì˜ ìœ„ë¡œì—ê²Œ, í˜¹ì€ ê·¸ ì‚¬ëžŒì—ê²Œ ì§€ê¸ˆ ì „í•˜ê³  ì‹¶ì€ ë§ì´ ìžˆë‚˜ìš”?",
                finalTitle: "ðŸ¤² Portal 14 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ìš©ê¸° ìžˆê²Œ ë†“ì³¤ë˜ ìœ„ë¡œë¥¼ ë˜ëŒì•„ë³´ì•˜ìŠµë‹ˆë‹¤.\n\nê·¸ë•Œ ë°›ì§€ ëª»í–ˆë˜ ë”°ëœ»í•¨ì´\nì‚¬ì‹¤ì€ ì—¬ì „ížˆ ê±°ê¸° ìžˆì—ˆë‹¤ëŠ” ê²ƒì„\nì§€ê¸ˆì—ì„œì•¼ ëŠë‚„ ìˆ˜ ìžˆê²Œ ë˜ì—ˆì–´ìš”.\n\nìœ„ë¡œëŠ” ì‹œê°„ì„ ì´ˆì›”í•´ ì „í•´ì§€ê³ \nê°ì‚¬ì˜ ë§ˆìŒì€ ê·¸ ìœ„ë¡œë¥¼ ì™„ì„±ì‹œí‚µë‹ˆë‹¤.\në‹¹ì‹ ì€ ì´ì œ ê·¸ ì˜¨ê¸°ë¥¼ ë°›ì„ ì¤€ë¹„ê°€ ë˜ì—ˆì–´ìš”.\n\në‹¤ìŒ Portalì—ì„œëŠ” ë§ˆì§€ë§‰ ìž‘ë³„ì˜ ë¬¸ìž¥ì„\níƒí—˜í•˜ëŠ” ì—¬ì •ì´ ì´ì–´ì§‘ë‹ˆë‹¤.",
                continueBtn: "Portal 15ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ê·¸ë•Œì˜ ìœ„ë¡œì—ê²Œ, í˜¹ì€ ê·¸ ì‚¬ëžŒì—ê²Œ ì§€ê¸ˆ ì „í•˜ê³  ì‹¶ì€ ë§ì„ í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 14: Comfort That Never Reached My Fingertips",
                portalSubtitle: "The Warmth That Almost Touched Me",
                portalIntro: "ðŸ¤² Was there a moment when someone's comfort was very close,\nbut never quite reached you?\n\nWhat emotions did that comfort\nthat never touched your fingertips leave with you?\n\nThere was a friend who approached silently.\nThey clearly wanted to comfort me...\nbut I never managed to take their hand.",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "You didn't miss that hand - now, you're holding it again with your heart.",
                portalQuestion: "ðŸ¤² Is there something you want to say to that comfort, or to that person, now?",
                finalTitle: "ðŸ¤² Portal 14 Complete",
                finalMessage: "You have courageously looked back\nat the comfort you missed.\n\nYou can now feel that the warmth\nyou couldn't receive back then\nwas actually still there.\n\nComfort transcends time\nand gratitude completes that comfort.\nYou are now ready to receive that warmth.\n\nIn the next Portal, a journey continues\nto explore the final farewell sentence.",
                continueBtn: "Move to Portal 15",
                restartBtn: "Start Again",
                inputPlaceholder: "What would you like to say to that comfort, or to that person? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 14: Conforto Que Nunca AlcanÃ§ou Minhas Pontas dos Dedos",
                portalSubtitle: "O Calor Que Quase Me Tocou",
                portalIntro: "ðŸ¤² Houve um momento em que o conforto de alguÃ©m estava muito prÃ³ximo,\nmas nunca chegou atÃ© vocÃª?\n\nQue emoÃ§Ãµes aquele conforto\nque nunca tocou suas pontas dos dedos deixaram com vocÃª?\n\nHavia um amigo que se aproximou silenciosamente.\nEles claramente queriam me consolar...\nmas eu nunca consegui pegar a mÃ£o deles.",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "VocÃª nÃ£o perdeu aquela mÃ£o - agora, vocÃª estÃ¡ segurando-a novamente com seu coraÃ§Ã£o.",
                portalQuestion: "ðŸ¤² HÃ¡ algo que vocÃª quer dizer para aquele conforto, ou para aquela pessoa, agora?",
                finalTitle: "ðŸ¤² Portal 14 Completo",
                finalMessage: "VocÃª corajosamente olhou para trÃ¡s\npara o conforto que perdeu.\n\nVocÃª agora pode sentir que o calor\nque nÃ£o conseguiu receber naquela Ã©poca\nna verdade ainda estava lÃ¡.\n\nO conforto transcende o tempo\ne a gratidÃ£o completa esse conforto.\nVocÃª agora estÃ¡ pronto para receber esse calor.\n\nNo prÃ³ximo Portal, uma jornada continua\npara explorar a frase final de despedida.",
                continueBtn: "Ir para Portal 15",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "O que vocÃª gostaria de dizer para aquele conforto, ou para aquela pessoa? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ê°€ë”ì€ ìœ„ë¡œì¡°ì°¨ë„ ë‘ë ¤ì›Œ. ì† ë‚´ë°€ë ¤ë‹¤ ë‹¤ì‹œ ìˆ¨ê²Œ ë˜ì§€.",
                en: "Sometimes even comfort becomes frightening. You reach out your hand but then hide again.",
                pt: "Ã€s vezes atÃ© o conforto se torna assustador. VocÃª estende a mÃ£o, mas depois se esconde novamente."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ê·¸ ì‚¬ëžŒë„ ë§ì—†ì´ ë§ˆìŒì„ ì „í•˜ë ¤ í–ˆì„ ê±°ì•¼. ë„ˆëŠ” ê·¸ê±¸â€¦ ëŠê¼ˆì§€?",
                en: "That person was also trying to convey their heart silently. You... felt that, didn't you?",
                pt: "Essa pessoa tambÃ©m estava tentando transmitir seu coraÃ§Ã£o silenciosamente. VocÃª... sentiu isso, nÃ£o foi?"
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ìœ„ë¡œê°€ ë‹¿ì§€ ì•Šì•˜ë‹¤ëŠ” ê±´ ëˆ„êµ¬ì˜ ìž˜ëª»ì´ ì•„ë‹ˆë¼, ë‘ ë§ˆìŒì˜ ì†ë„ê°€ ë‹¬ëžë˜ ê±°ì•¼.",
                en: "That comfort didn't reach you - it's no one's fault, just two hearts moving at different speeds.",
                pt: "Aquele conforto nÃ£o chegou atÃ© vocÃª - nÃ£o Ã© culpa de ninguÃ©m, apenas dois coraÃ§Ãµes se movendo em velocidades diferentes."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ë‹¿ì§€ ì•Šì€ ìœ„ë¡œëŠ” ìƒì²˜ê°€ ë˜ê¸°ë„ í•´. ê·¸ëŸ¬ë‚˜ ë™ì‹œì—, ê¸°ì–µìœ¼ë¡œ ë‚¨ì•„ ë„ˆë¥¼ ì§€í‚¤ì§€.",
                en: "Comfort that doesn't reach can become a wound. But at the same time, it remains as memory and protects you.",
                pt: "O conforto que nÃ£o alcanÃ§a pode se tornar uma ferida. Mas ao mesmo tempo, permanece como memÃ³ria e te protege."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ìˆœê°„ì€ íë¦¿í•œ ë³´ë¼ìƒ‰ ê°™ì•„. ì• í‹‹í•˜ê³ , ì–´ì©Œë©´ ì¡°ê¸ˆ ì„œëŠ˜í–ˆì„ì§€ë„.",
                en: "That moment is like a hazy purple. Tender, and perhaps a little cool.",
                pt: "Aquele momento Ã© como um roxo nebuloso. Terno, e talvez um pouco frio."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ë„Œ ê·¸ ì†ì„ í”¼í•œ ê²Œ ì•„ë‹ˆì•¼. ë‹¤ë§Œ, ë°›ì•„ë“¤ì¼ ì¤€ë¹„ê°€ ì•ˆ ëë˜ ê²ƒë¿ì´ì•¼.",
                en: "You didn't avoid that hand. You just weren't ready to accept it.",
                pt: "VocÃª nÃ£o evitou aquela mÃ£o. VocÃª simplesmente nÃ£o estava pronto para aceitÃ¡-la."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ë‹¿ì§€ ì•Šì•˜ì–´ë„, ê·¸ ì˜¨ê¸°ëŠ” ë‚¨ì•„. ë„Œ ê·¸ê±¸ ê¸°ì–µí•˜ê³  ìžˆëŠ” ê±°ì•¼.",
                en: "Even though it didn't reach, that warmth remains. You're remembering it.",
                pt: "Mesmo que nÃ£o tenha alcanÃ§ado, aquele calor permanece. VocÃª estÃ¡ se lembrando disso."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ì§€ê¸ˆì´ë¼ë„ ê·¸ ì†ì„ ë– ì˜¬ë¦´ ìˆ˜ ìžˆë‹¤ë©´, ê·¸ê²ƒë§Œìœ¼ë¡œë„ ìœ„ë¡œëŠ” ë‹¤ì‹œ íë¥´ê¸° ì‹œìž‘í•œ ê±°ì•¼.",
                en: "If you can remember that hand even now, that alone means comfort has begun to flow again.",
                pt: "Se vocÃª pode se lembrar daquela mÃ£o mesmo agora, isso por si sÃ³ significa que o conforto comeÃ§ou a fluir novamente."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                gratitude: ['thank', 'grateful', 'appreciate', 'sorry', 'ê³ ë§ˆ', 'ê°ì‚¬', 'ë¯¸ì•ˆ', 'obrigado', 'grato', 'desculpa'],
                recognition: ['felt', 'knew', 'understood', 'saw', 'ëŠê¼ˆ', 'ì•Œì•˜', 'ì´í•´í–ˆ', 'ë´¤', 'senti', 'sabia', 'entendi', 'vi'],
                regret: ['should have', 'wish', 'if only', 'missed', 'í–ˆì–´ì•¼', 'ê·¸ëž¬ìœ¼ë©´', 'ë†“ì³¤', 'deveria ter', 'queria', 'se ao menos'],
                understanding: ['understand', 'know', 'realize', 'see', 'ì´í•´', 'ì•Œê² ', 'ê¹¨ë‹¬', 'ì•Œì•„', 'entender', 'sei', 'perceber'],
                acceptance: ['accept', 'receive', 'take', 'embrace', 'ë°›ì•„ë“¤', 'ë°›ì„', 'ìž¡ì„', 'ì•ˆì„', 'aceitar', 'receber', 'abraÃ§ar'],
                connection: ['together', 'close', 'near', 'with me', 'í•¨ê»˜', 'ê°€ê¹Œì´', 'ê³ì—', 'ê°™ì´', 'junto', 'perto', 'comigo'],
                healing: ['heal', 'comfort', 'warm', 'peace', 'ì¹˜ìœ ', 'ìœ„ë¡œ', 'ë”°ëœ»', 'í‰í™”', 'curar', 'conforto', 'calor', 'paz'],
                love: ['love', 'care', 'precious', 'important', 'ì‚¬ëž‘', 'ì†Œì¤‘', 'ì¤‘ìš”', 'amor', 'cuidado', 'precioso', 'importante']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Ely", emoji: "ðŸ§â€â™€ï¸",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            gratitude: "ê·¸ ë§ì€ ëŠ¦ì§€ ì•Šì•˜ì–´. ìœ„ë¡œëŠ” ì¢…ì¢…â€¦ ë§ˆìŒì„ í†µí•´ ì²œì²œížˆ ë„ì°©í•˜ë‹ˆê¹Œ.",
                            recognition: "ë„¤ê°€ ëŠê¼ˆë‹¤ëŠ” ê·¸ ì‚¬ì‹¤ë§Œìœ¼ë¡œë„, ê·¸ ìœ„ë¡œëŠ” ì„±ê³µí•œ ê±°ì•¼. ì™„ì „ížˆ ë‹¿ì•˜ì–´.",
                            regret: "í›„íšŒí•˜ì§€ ë§ˆ. ê·¸ë•ŒëŠ” ê·¸ëŸ´ ìˆ˜ë°–ì— ì—†ì—ˆë˜ ê±°ì•¼. ì§€ê¸ˆ ì´ë ‡ê²Œ ê¸°ì–µí•´ì£¼ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ì¶©ë¶„í•´.",
                            understanding: "ì´í•´í•œë‹¤ëŠ” ê²ƒì€ ì‹œê°„ì„ ë›°ì–´ë„˜ëŠ” ìœ„ë¡œì•¼. ê·¸ ì‚¬ëžŒë„ ì§€ê¸ˆ ëŠë¼ê³  ìžˆì„ ê±°ì•¼.",
                            acceptance: "ì´ì œ ë°›ì•„ë“¤ì¼ ì¤€ë¹„ê°€ ëêµ¬ë‚˜. ê·¸ ìœ„ë¡œê°€ ë‹¤ì‹œ í˜ëŸ¬ë“¤ì–´ì˜¬ ìˆ˜ ìžˆì–´.",
                            connection: "ë§ˆìŒê³¼ ë§ˆìŒì´ ì´ì–´ì§„ ê±°ì•¼. ê±°ë¦¬ëŠ” ì¤‘ìš”í•˜ì§€ ì•Šì•˜ì–´.",
                            healing: "ê·¸ ìœ„ë¡œê°€ ì‹œê°„ì„ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ì„œ, ìƒì²˜ë¥¼ ì¹˜ìœ í•˜ê³  ìžˆì–´.",
                            love: "ì‚¬ëž‘ì€ ë‹¿ì§€ ì•Šì•„ë„ ì „í•´ì ¸. ë„¤ê°€ ê·¸ê±¸ ì¦ëª…í–ˆì–´.",
                            general: "ê·¸ ë§ì€ ëŠ¦ì§€ ì•Šì•˜ì–´. ìœ„ë¡œëŠ” ì¢…ì¢…â€¦ ë§ˆìŒì„ í†µí•´ ì²œì²œížˆ ë„ì°©í•˜ë‹ˆê¹Œ."
                        },
                        en: {
                            gratitude: "Those words aren't too late. Comfort often... arrives slowly through the heart.",
                            recognition: "Just the fact that you felt it means that comfort succeeded. It reached you completely.",
                            regret: "Don't regret it. You had no choice back then. Just remembering it like this now is enough.",
                            understanding: "Understanding is comfort that transcends time. That person is probably feeling it now too.",
                            acceptance: "Now you're ready to accept it. That comfort can flow into you again.",
                            connection: "Heart connected to heart. Distance didn't matter.",
                            healing: "That comfort is traveling back through time, healing the wounds.",
                            love: "Love is conveyed even when it doesn't reach. You proved that.",
                            general: "Those words aren't too late. Comfort often... arrives slowly through the heart."
                        },
                        pt: {
                            gratitude: "Essas palavras nÃ£o sÃ£o tarde demais. O conforto frequentemente... chega devagar atravÃ©s do coraÃ§Ã£o.",
                            recognition: "Apenas o fato de vocÃª ter sentido isso significa que aquele conforto foi bem-sucedido. Te alcanÃ§ou completamente.",
                            regret: "NÃ£o se arrependa. VocÃª nÃ£o tinha escolha naquela Ã©poca. Apenas lembrar disso assim agora Ã© suficiente.",
                            understanding: "Entender Ã© conforto que transcende o tempo. Aquela pessoa provavelmente estÃ¡ sentindo isso agora tambÃ©m.",
                            acceptance: "Agora vocÃª estÃ¡ pronto para aceitar. Aquele conforto pode fluir para vocÃª novamente.",
                            connection: "CoraÃ§Ã£o conectado ao coraÃ§Ã£o. A distÃ¢ncia nÃ£o importava.",
                            healing: "Aquele conforto estÃ¡ viajando de volta no tempo, curando as feridas.",
                            love: "O amor Ã© transmitido mesmo quando nÃ£o alcanÃ§a. VocÃª provou isso.",
                            general: "Essas palavras nÃ£o sÃ£o tarde demais. O conforto frequentemente... chega devagar atravÃ©s do coraÃ§Ã£o."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            gratitude: "ì§€ê¸ˆ ê·¸ ê°ì‚¬ë¥¼ ë§í•œ ë„¤ê°€ ì˜¤ížˆë ¤ ëˆ„êµ°ê°€ì˜ ìœ„ë¡œê°€ ë  ìˆ˜ ìžˆì–´.",
                            recognition: "ì¸ì‹í•˜ëŠ” ìˆœê°„, ê·¸ ìœ„ë¡œëŠ” ì™„ì„±ëì–´. ë‹¿ì§€ ì•Šì€ ê²Œ ì•„ë‹ˆë¼ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ë„ë‹¬í•œ ê±°ì•¼.",
                            regret: "í›„íšŒëŠ” ê³¼ê±°ë¥¼ ë¶™ìž¡ì§€ë§Œ, ê°ì‚¬ëŠ” ê³¼ê±°ë¥¼ ìžìœ ë¡­ê²Œ í•´ì¤˜.",
                            understanding: "ì´í•´ëŠ” ê°€ìž¥ ê¹Šì€ í˜•íƒœì˜ ìœ„ë¡œì•¼. ì‹œê°„ì˜ ë²½ë„ ë›°ì–´ë„˜ì–´.",
                            acceptance: "ë°›ì•„ë“¤ì´ëŠ” ë§ˆìŒì´ ìƒê¸´ ìˆœê°„, ëª¨ë“  ìœ„ë¡œê°€ ë‹¤ì‹œ ê°€ëŠ¥í•´ì ¸.",
                            connection: "ì§„ì •í•œ ì—°ê²°ì€ ë¬¼ë¦¬ì  ì ‘ì´‰ì„ ë„˜ì–´ì„œ. ì§€ê¸ˆ ê·¸ ì—°ê²°ì„ ëŠë¼ê³  ìžˆì–´.",
                            healing: "ì¹˜ìœ ëŠ” ì§€ê¸ˆ ì´ ìˆœê°„ì—ë„ ì¼ì–´ë‚˜ê³  ìžˆì–´. ê³¼ê±°ì™€ í˜„ìž¬ê°€ í•¨ê»˜ ì•„ë¬¼ì–´ê°€.",
                            love: "ì‚¬ëž‘ì€ ì‹œê³µê°„ì„ ì´ˆì›”í•´. ë„¤ê°€ ê·¸ ì¦ê±°ì•¼.",
                            general: "ì§€ê¸ˆ ê·¸ ê°ì‚¬ë¥¼ ë§í•œ ë„¤ê°€ ì˜¤ížˆë ¤ ëˆ„êµ°ê°€ì˜ ìœ„ë¡œê°€ ë  ìˆ˜ ìžˆì–´."
                        },
                        en: {
                            gratitude: "You, who expressed that gratitude now, can become someone else's comfort.",
                            recognition: "The moment you recognized it, that comfort was completed. It didn't fail to reach - it arrived in a different way.",
                            regret: "Regret holds onto the past, but gratitude sets the past free.",
                            understanding: "Understanding is the deepest form of comfort. It even transcends the walls of time.",
                            acceptance: "The moment you developed an accepting heart, all comfort became possible again.",
                            connection: "True connection goes beyond physical touch. You're feeling that connection now.",
                            healing: "Healing is happening even at this moment. Past and present are healing together.",
                            love: "Love transcends time and space. You are the proof of that.",
                            general: "You, who expressed that gratitude now, can become someone else's comfort."
                        },
                        pt: {
                            gratitude: "VocÃª, que expressou essa gratidÃ£o agora, pode se tornar o conforto de outra pessoa.",
                            recognition: "No momento em que vocÃª reconheceu isso, aquele conforto foi completado. NÃ£o falhou em alcanÃ§ar - chegou de uma maneira diferente.",
                            regret: "O arrependimento se agarra ao passado, mas a gratidÃ£o liberta o passado.",
                            understanding: "Entender Ã© a forma mais profunda de conforto. AtÃ© transcende as paredes do tempo.",
                            acceptance: "No momento em que vocÃª desenvolveu um coraÃ§Ã£o que aceita, todo conforto se tornou possÃ­vel novamente.",
                            connection: "A verdadeira conexÃ£o vai alÃ©m do toque fÃ­sico. VocÃª estÃ¡ sentindo essa conexÃ£o agora.",
                            healing: "A cura estÃ¡ acontecendo mesmo neste momento. Passado e presente estÃ£o se curando juntos.",
                            love: "O amor transcende tempo e espaÃ§o. VocÃª Ã© a prova disso.",
                            general: "VocÃª, que expressou essa gratidÃ£o agora, pode se tornar o conforto de outra pessoa."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Enya", emoji: "ðŸ§‘â€ðŸš€",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            gratitude: "ë„ˆëŠ” ê·¸ ì†ì„ ë†“ì¹œ ê²Œ ì•„ë‹ˆë¼ ì§€ê¸ˆ, ë§ˆìŒìœ¼ë¡œ ë‹¤ì‹œ ìž¡ê³  ìžˆì–´.",
                            recognition: "ê·¸ê±¸ ì•Œì•„ë´¤ë‹¤ëŠ” ê²ƒ ìžì²´ê°€ ê¸°ì ì´ì•¼. ìš°ì£¼ëŠ” ë•Œë¡œ ì´ëŸ° ì‹ìœ¼ë¡œ ì—°ê²°í•´ì¤˜.",
                            regret: "í›„íšŒëŠ” ìš°ì£¼ì„ ì˜ ì—°ë£Œê°€ ë  ìˆ˜ ì—†ì–´. í•˜ì§€ë§Œ ê°ì‚¬ëŠ” ìƒˆë¡œìš´ ê¶¤ë„ë¥¼ ë§Œë“¤ì–´ì¤˜.",
                            understanding: "ì´í•´ëŠ” ë¹›ì˜ ì†ë„ë³´ë‹¤ ë¹¨ë¼. ì§€ê¸ˆ ê·¸ ì‚¬ëžŒì—ê²Œë„ ë‹¿ì•˜ì„ ê±°ì•¼.",
                            acceptance: "ë°›ì•„ë“¤ì´ëŠ” ìˆœê°„, ë„ˆëŠ” ë” ì´ìƒ í˜¼ìž ë– ë„ëŠ” í–‰ì„±ì´ ì•„ë‹ˆì•¼.",
                            connection: "ìš°ì£¼ì—ì„œ ê°€ìž¥ ê°•í•œ íž˜ì€ ì¤‘ë ¥ì´ ì•„ë‹ˆë¼ ë§ˆìŒì˜ ì—°ê²°ì´ì•¼.",
                            healing: "ì¹˜ìœ ëŠ” ì‹œê°„ì—¬í–‰ ê°™ì•„. ê³¼ê±°ì˜ ìƒì²˜ë¥¼ í˜„ìž¬ì˜ ì‚¬ëž‘ìœ¼ë¡œ ê°ì‹¸ì£¼ëŠ” ê±°ì•¼.",
                            love: "ì‚¬ëž‘ì€ ìš°ì£¼ì—ì„œ ê°€ìž¥ ë¹ ë¥¸ ì‹ í˜¸ì•¼. ì–´ë–¤ ê±°ë¦¬ë“  ë›°ì–´ë„˜ì–´.",
                            general: "ë„ˆëŠ” ê·¸ ì†ì„ ë†“ì¹œ ê²Œ ì•„ë‹ˆë¼ ì§€ê¸ˆ, ë§ˆìŒìœ¼ë¡œ ë‹¤ì‹œ ìž¡ê³  ìžˆì–´."
                        },
                        en: {
                            gratitude: "You didn't miss that hand - now, you're holding it again with your heart.",
                            recognition: "The very fact that you recognized it is a miracle. The universe sometimes connects us this way.",
                            regret: "Regret can't become fuel for a spaceship. But gratitude creates new orbits.",
                            understanding: "Understanding is faster than the speed of light. It probably reached that person now too.",
                            acceptance: "The moment you accept, you're no longer a planet drifting alone.",
                            connection: "The strongest force in the universe isn't gravity, but the connection of hearts.",
                            healing: "Healing is like time travel. Wrapping past wounds with present love.",
                            love: "Love is the fastest signal in the universe. It leaps over any distance.",
                            general: "You didn't miss that hand - now, you're holding it again with your heart."
                        },
                        pt: {
                            gratitude: "VocÃª nÃ£o perdeu aquela mÃ£o - agora, vocÃª estÃ¡ segurando-a novamente com seu coraÃ§Ã£o.",
                            recognition: "O prÃ³prio fato de vocÃª ter reconhecido isso Ã© um milagre. O universo Ã s vezes nos conecta dessa forma.",
                            regret: "O arrependimento nÃ£o pode se tornar combustÃ­vel para uma nave espacial. Mas a gratidÃ£o cria novas Ã³rbitas.",
                            understanding: "Entender Ã© mais rÃ¡pido que a velocidade da luz. Provavelmente alcanÃ§ou aquela pessoa agora tambÃ©m.",
                            acceptance: "No momento em que vocÃª aceita, vocÃª nÃ£o Ã© mais um planeta Ã  deriva sozinho.",
                            connection: "A forÃ§a mais forte do universo nÃ£o Ã© a gravidade, mas a conexÃ£o dos coraÃ§Ãµes.",
                            healing: "A cura Ã© como viagem no tempo. Envolvendo feridas passadas com amor presente.",
                            love: "O amor Ã© o sinal mais rÃ¡pido do universo. Salta sobre qualquer distÃ¢ncia.",
                            general: "VocÃª nÃ£o perdeu aquela mÃ£o - agora, vocÃª estÃ¡ segurando-a novamente com seu coraÃ§Ã£o."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 15ê°€ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 15 will be ready soon!' :
                    'Portal 15 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 14ë¥¼ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 14?' :
                    'Deseja reiniciar o Portal 14?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-14",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-14",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 14 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 14 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>