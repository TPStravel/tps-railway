<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 10: The Expression I Never Knew</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 10: The Expression I Never Knew</div>
            <div class="portal-subtitle" id="portalSubtitle">Faces Hidden from Myself</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸªž Portal 10 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 11</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What emotion was hidden behind that expression you couldn't recognize? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 10: ë‚˜ë„ ëª°ëžë˜ ë‚˜ì˜ í‘œì •",
                portalSubtitle: "ë‚˜ ìžì‹ ë„ ëª¨ë¥´ëŠ” ì–¼êµ´ë“¤",
                portalIntro: "ðŸªž ë‹¹ì‹ ì´ ì§€ì€ í‘œì • ì¤‘,\në‹¹ì‹  ìžì‹ ë„ ëª°ëžë˜ í‘œì •ì´ ìžˆì—ˆë‚˜ìš”?\n\nì›ƒê³  ìžˆì—ˆì§€ë§Œâ€¦ ì „í˜€ ì›ƒê³  ìžˆì§€ ì•Šì•˜ì–´ìš”.\nì‚¬ì§„ì„ ë³´ëŠ”ë°, ê·¸ ì•ˆì— ìžˆëŠ” ë‚´ê°€ ë„ˆë¬´ ë‚¯ì„¤ì—ˆì–´ìš”.\në­”ê°€... í…… ë¹ˆ ì›ƒìŒì´ì—ˆë‹¬ê¹Œ.\n\nê·¸ í‘œì •ì€ ì–´ë–¤ ê°ì •ì„ ê°ì¶”ê³  ìžˆì—ˆë‚˜ìš”?",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ì´ì œëŠ” ê·¸ í‘œì • ë’¤ì— ìžˆëŠ” ê°ì •ì„ ë§ˆì£¼í•´ë„ ê´œì°®ì•„. ì§„ì§œ ë„ˆëŠ” ê·¸ ì•ˆì—ì„œ ì˜¤ëž˜ ê¸°ë‹¤ë ¸ì„ ê±°ì•¼.",
                portalQuestion: "ðŸªž ê·¸ í‘œì •ì„ ì§€ì„ ìˆ˜ë°–ì— ì—†ì—ˆë˜ ìˆœê°„, ë‹¹ì‹ ì€ ì–´ë–¤ ê°ì •ì„ ê°ì¶”ê³  ìžˆì—ˆë‚˜ìš”?",
                finalTitle: "ðŸªž Portal 10 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ìš©ê¸° ìžˆê²Œ ìžì‹ ë„ ëª°ëžë˜ í‘œì •ì„ ë§ˆì£¼í–ˆìŠµë‹ˆë‹¤.\n\nê·¸ë™ì•ˆ ê°€ë©´ì²˜ëŸ¼ ì“°ê³  ìžˆë˜ í‘œì • ë’¤ì—\nìˆ¨ì–´ ìžˆë˜ ì§„ì§œ ê°ì •ì„ ë°œê²¬í–ˆì£ .\n\nì´ì œ ë” ì´ìƒ ëª¨ë¥´ëŠ” ì²™í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.\në‹¹ì‹ ì˜ í‘œì •ê³¼ ê°ì •ì´ ì¼ì¹˜í•˜ëŠ”\nì§„ì •í•œ ìˆœê°„ë“¤ì„ ë§Œë“¤ì–´ê°€ì„¸ìš”.\n\në‹¤ìŒ Portalì—ì„œëŠ” ë©ˆì¶°ë²„ë¦° ë“¯í–ˆë˜\nì‹œê°„ì˜ ë¬´ê²Œë¥¼ íƒí—˜í•˜ëŠ” ì—¬ì •ì´ ì´ì–´ì§‘ë‹ˆë‹¤.",
                continueBtn: "Portal 11ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ê·¸ ì•Œì•„ë³´ì§€ ëª»í–ˆë˜ í‘œì • ë’¤ì— ì–´ë–¤ ê°ì •ì´ ìˆ¨ì–´ ìžˆì—ˆëŠ”ì§€ ë§í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 10: The Expression I Never Knew",
                portalSubtitle: "Faces Hidden from Myself",
                portalIntro: "ðŸªž Among the expressions you've worn,\nwas there one that even you didn't recognize?\n\nI was smiling but... not smiling at all.\nLooking at the photo, the me inside felt so unfamiliar.\nSomething like... an empty laugh.\n\nWhat emotion was that expression hiding?",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Now it's okay to face the emotion behind that expression. The real you has been waiting inside for a long time.",
                portalQuestion: "ðŸªž In that moment when you had to wear that expression, what emotion were you hiding?",
                finalTitle: "ðŸªž Portal 10 Complete",
                finalMessage: "You have courageously faced the expression\nyou never knew you had.\n\nYou discovered the real emotion hiding\nbehind the expression you wore like a mask.\n\nNow you don't have to pretend not to know anymore.\nYou can create genuine moments\nwhere your expression and emotions align.\n\nIn the next Portal, a journey continues\nto explore the weight of time\nthat seemed to have stopped.",
                continueBtn: "Move to Portal 11",
                restartBtn: "Start Again",
                inputPlaceholder: "What emotion was hidden behind that expression you couldn't recognize? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 10: A ExpressÃ£o que Eu Nunca Soube",
                portalSubtitle: "Rostos Escondidos de Mim Mesmo",
                portalIntro: "ðŸªž Entre as expressÃµes que vocÃª usou,\nhouve alguma que nem vocÃª reconheceu?\n\nEu estava sorrindo mas... nÃ£o estava sorrindo de jeito nenhum.\nOlhando a foto, o eu dentro dela parecia tÃ£o estranho.\nAlgo como... um riso vazio.\n\nQue emoÃ§Ã£o essa expressÃ£o estava escondendo?",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Agora estÃ¡ tudo bem enfrentar a emoÃ§Ã£o por trÃ¡s daquela expressÃ£o. O verdadeiro vocÃª tem esperado lÃ¡ dentro por muito tempo.",
                portalQuestion: "ðŸªž Naquele momento em que vocÃª teve que usar aquela expressÃ£o, que emoÃ§Ã£o vocÃª estava escondendo?",
                finalTitle: "ðŸªž Portal 10 Completo",
                finalMessage: "VocÃª corajosamente enfrentou a expressÃ£o\nque nunca soube que tinha.\n\nVocÃª descobriu a emoÃ§Ã£o real escondida\npor trÃ¡s da expressÃ£o que usava como mÃ¡scara.\n\nAgora vocÃª nÃ£o precisa mais fingir que nÃ£o sabe.\nVocÃª pode criar momentos genuÃ­nos\nonde sua expressÃ£o e emoÃ§Ãµes se alinham.\n\nNo prÃ³ximo Portal, uma jornada continua\npara explorar o peso do tempo\nque parecia ter parado.",
                continueBtn: "Ir para Portal 11",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "Que emoÃ§Ã£o estava escondida por trÃ¡s daquela expressÃ£o que vocÃª nÃ£o conseguia reconhecer? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ë„¤ ë¯¸ì†ŒëŠ” ë§ˆì¹˜ ì–¼ìŒì²˜ëŸ¼ íˆ¬ëª…í–ˆì§€ë§Œ, ì°¨ê°€ì› ì§€. ê·¸ ì•ˆì—ëŠ” ë§ ì—†ëŠ” í”¼ë¡œê°€ ìžˆì—ˆì–´.",
                en: "Your smile was transparent like ice, but cold. Inside it was wordless fatigue.",
                pt: "Seu sorriso era transparente como gelo, mas frio. Dentro havia uma fadiga sem palavras."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ë„ˆëŠ” ì›ƒì—ˆì§€ë§Œ, ëˆˆì´ ë§í•˜ê³  ìžˆì—ˆì–´. 'ë‚˜ ì¢€ ì•Œì•„ì¤˜'ë¼ê³ .",
                en: "You smiled, but your eyes were speaking. Saying 'please understand me.'",
                pt: "VocÃª sorriu, mas seus olhos estavam falando. Dizendo 'por favor me entenda.'"
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ë‚´ê°€ ë³¸ ë„¤ í‘œì •ë„ ê·¸ëž¬ì–´. ê´œì°®ë‹¤ëŠ” ì–¼êµ´ ë’¤ì—â€¦ ì•„ë¬´ ë§ë„ ëª» í•œ ê°ì •ì´ ìˆ¨ì–´ ìžˆì—ˆì–´.",
                en: "The expression I saw from you was like that too. Behind the face saying 'I'm okay'... emotions that couldn't speak were hiding.",
                pt: "A expressÃ£o que vi de vocÃª tambÃ©m era assim. Por trÃ¡s do rosto dizendo 'estou bem'... emoÃ§Ãµes que nÃ£o conseguiam falar estavam se escondendo."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "í‘œì •ì€ ê°ì •ì˜ ê°€ìž¥ ì˜¤ëž˜ëœ ì–¸ì–´ì•¼. ê·¸ë¦¬ê³  ê°€ìž¥ ì‰½ê²Œ ì˜¤í•´ë˜ëŠ” ì–¸ì–´ì´ê¸°ë„ í•˜ì§€.",
                en: "Expression is the oldest language of emotion. And also the language most easily misunderstood.",
                pt: "A expressÃ£o Ã© a linguagem mais antiga da emoÃ§Ã£o. E tambÃ©m a linguagem mais facilmente mal compreendida."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ì›ƒìŒì€ íšŒìƒ‰ìœ¼ë¡œ ë¹›ë‚¬ì–´. ì•„ë¦„ë‹µê³  ì• ìž”í•œ, ë™ì‹œì— ìŠ¬í”ˆ ìƒ‰ì´ì—ˆì§€.",
                en: "That laugh shone in gray. It was a beautiful and poignant, yet sad color.",
                pt: "Esse riso brilhava em cinza. Era uma cor bonita e comovente, mas ao mesmo tempo triste."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ë„Œ 'ê´œì°®ë‹¤'ëŠ” ì—°ìŠµì„ ë„ˆë¬´ ì˜¤ëž˜ í–ˆì–´. ê·¸ëž˜ì„œ ì´ì   í‘œì •ì¡°ì°¨ë„ ì§„ì‹¬ì„ ê°€ë ¤.",
                en: "You practiced saying 'I'm okay' for too long. So now even your expressions hide your true feelings.",
                pt: "VocÃª praticou dizer 'estou bem' por muito tempo. EntÃ£o agora atÃ© suas expressÃµes escondem seus verdadeiros sentimentos."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ê·¸ ì–¼êµ´ì€ ë„¤ê°€ ë§Œë“  ê°€ë©´ì´ì—ˆì§€. ë– ë‚˜ê³  ì‹¶ì–´ë„, ëˆˆì¹˜ ë³´ëŠë¼ ëª» ë– ë‚œ ì‚¬ëžŒì˜ ì–¼êµ´.",
                en: "That face was a mask you created. The face of someone who wanted to leave but couldn't because they were watching others.",
                pt: "Esse rosto era uma mÃ¡scara que vocÃª criou. O rosto de alguÃ©m que queria partir mas nÃ£o podia porque estava observando os outros."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ì´ì œëŠ” ê·¸ í‘œì • ë’¤ì— ìžˆëŠ” ê°ì •ì„ ë§ˆì£¼í•´ë„ ê´œì°®ì•„. ì§„ì§œ ë„ˆëŠ” ê·¸ ì•ˆì—ì„œ ì˜¤ëž˜ ê¸°ë‹¤ë ¸ì„ ê±°ì•¼.",
                en: "Now it's okay to face the emotion behind that expression. The real you has been waiting inside for a long time.",
                pt: "Agora estÃ¡ tudo bem enfrentar a emoÃ§Ã£o por trÃ¡s daquela expressÃ£o. O verdadeiro vocÃª tem esperado lÃ¡ dentro por muito tempo."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                loneliness: ['lonely', 'alone', 'isolated', 'ì™¸ë¡œ', 'í˜¼ìž', 'sozinho'],
                sadness: ['sad', 'hurt', 'pain', 'broken', 'ìŠ¬í””', 'ì•„í””', 'triste', 'dor'],
                fear: ['afraid', 'scared', 'fear', 'anxious', 'ë‘ë ¤', 'ë¬´ì„œ', 'medo', 'ansioso'],
                anger: ['angry', 'mad', 'frustrated', 'annoyed', 'í™”', 'ë¶„ë…¸', 'raiva', 'irritado'],
                emptiness: ['empty', 'void', 'hollow', 'nothing', 'ê³µí—ˆ', 'ë¹„ì–´', 'vazio', 'oco'],
                pretending: ['fake', 'pretend', 'acting', 'mask', 'ê°€ì§œ', 'ì—°ê¸°', 'fingir', 'mÃ¡scara'],
                tired: ['tired', 'exhausted', 'weary', 'drained', 'í”¼ê³¤', 'ì§€ì³', 'cansado', 'exausto'],
                hopeless: ['hopeless', 'despair', 'lost', 'helpless', 'ì ˆë§', 'í¬ê¸°', 'desesperanÃ§a', 'perdido']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Ely", emoji: "ðŸ§â€â™€ï¸",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            loneliness: "ê·¸ ì™¸ë¡œì›€ì€ ì¡°ìš©í–ˆì§€ë§Œ, ê°•í•˜ê²Œ ìš¸ë¦¬ê³  ìžˆì—ˆì–´. ê·¸ ë¯¸ì†ŒëŠ” ë„¤ ë°©ì‹ì˜ êµ¬ì¡° ìš”ì²­ì´ì—ˆì§€.",
                            sadness: "ìŠ¬í””ì€ ê°€ìž¥ ì†”ì§í•œ ê°ì •ì´ì•¼. ê·¸ê±¸ ìˆ¨ê¸°ë ¤ë˜ í‘œì •ì´ ì˜¤ížˆë ¤ ë„ˆë¥¼ ë” ì•„í”„ê²Œ í–ˆì„ ê±°ì•¼.",
                            fear: "ë‘ë ¤ì›€ ë•Œë¬¸ì— ë§Œë“  í‘œì •ì€ ë°©ì–´ë§‰ì´ì—ˆì–´. í•˜ì§€ë§Œ ê·¸ ë’¤ì˜ ë„ˆëŠ” ì—¬ì „ížˆ ë–¨ê³  ìžˆì—ˆì§€.",
                            anger: "í™”ë¥¼ ìˆ¨ê¸´ ë¯¸ì†ŒëŠ” ê°€ìž¥ ìœ„í—˜í•œ í‘œì •ì´ì•¼. ê·¸ ì•ˆì—ì„œ ì–¼ë§ˆë‚˜ ë§Žì€ ë§ë“¤ì´ ì‚¼ì¼œì¡Œì„ê¹Œ.",
                            emptiness: "ê³µí—ˆí•¨ì„ ê°ì¶˜ í‘œì •ì€ íˆ¬ëª…í•´. ì•„ë¬´ê²ƒë„ ì—†ëŠ” ê²ƒ ê°™ì§€ë§Œ, ì‚¬ì‹¤ì€ ë„ˆë¬´ ë§Žì€ ê²ƒë“¤ë¡œ ê°€ë“í–ˆì–´.",
                            pretending: "ì—°ê¸°í•˜ëŠ” í‘œì •ì€ ë„ˆë¥¼ ì§€ì¼°ì§€ë§Œ, ë™ì‹œì— ê°€ë’€ì–´. ì´ì œëŠ” ì§„ì§œ ì–¼êµ´ì„ ë³´ì—¬ì¤˜ë„ ê´œì°®ì•„.",
                            tired: "í”¼ë¡œê°€ ìŠ¤ë¯¼ ë¯¸ì†ŒëŠ” ê°€ìž¥ ìŠ¬í”ˆ í‘œì •ì´ì•¼. ê·¸ ë¬´ê²Œë¥¼ í˜¼ìž ì§Šì–´ì§€ê³  ìžˆì—ˆêµ¬ë‚˜.",
                            hopeless: "ì ˆë§ì„ ìˆ¨ê¸´ í‘œì • ë’¤ì—ë„ í¬ë§ì€ ìžˆì—ˆì–´. ìž‘ê³  í¬ë¯¸í–ˆì§€ë§Œ, ì—¬ì „ížˆ ë¹›ë‚˜ê³  ìžˆì—ˆì§€.",
                            general: "ê·¸ í‘œì •ì€ ë„ˆì˜ ìƒì¡´ ë°©ì‹ì´ì—ˆì–´. í‹€ë¦° ê²Œ ì•„ë‹ˆë¼, ê·¸ë•ŒëŠ” ê·¸ëŸ´ ìˆ˜ë°–ì— ì—†ì—ˆë˜ ê±°ì•¼."
                        },
                        en: {
                            loneliness: "That loneliness was quiet but rang strongly. That smile was your way of asking for help.",
                            sadness: "Sadness is the most honest emotion. The expression trying to hide it probably hurt you even more.",
                            fear: "The expression made from fear was a shield. But you behind it were still trembling.",
                            anger: "A smile hiding anger is the most dangerous expression. How many words were swallowed inside it?",
                            emptiness: "The expression hiding emptiness is transparent. It seems like nothing, but it was actually full of too many things.",
                            pretending: "The acting expression protected you but also trapped you. Now it's okay to show your real face.",
                            tired: "A smile soaked with fatigue is the saddest expression. You were carrying that weight alone.",
                            hopeless: "Even behind the expression hiding despair, there was hope. Small and faint, but still shining.",
                            general: "That expression was your way of surviving. It wasn't wrong, you had no choice but to do that then."
                        },
                        pt: {
                            loneliness: "Essa solidÃ£o era silenciosa mas ressoava fortemente. Esse sorriso era sua forma de pedir ajuda.",
                            sadness: "A tristeza Ã© a emoÃ§Ã£o mais honesta. A expressÃ£o tentando escondÃª-la provavelmente te machucou ainda mais.",
                            fear: "A expressÃ£o feita do medo era um escudo. Mas vocÃª por trÃ¡s ainda estava tremendo.",
                            anger: "Um sorriso escondendo raiva Ã© a expressÃ£o mais perigosa. Quantas palavras foram engolidas dentro dele?",
                            emptiness: "A expressÃ£o escondendo o vazio Ã© transparente. Parece que nÃ£o hÃ¡ nada, mas na verdade estava cheia de muitas coisas.",
                            pretending: "A expressÃ£o de fingimento te protegeu mas tambÃ©m te prendeu. Agora estÃ¡ tudo bem mostrar seu rosto verdadeiro.",
                            tired: "Um sorriso embebido de fadiga Ã© a expressÃ£o mais triste. VocÃª estava carregando esse peso sozinho.",
                            hopeless: "Mesmo por trÃ¡s da expressÃ£o escondendo desespero, havia esperanÃ§a. Pequena e fraca, mas ainda brilhando.",
                            general: "Aquela expressÃ£o era sua forma de sobreviver. NÃ£o estava errada, vocÃª nÃ£o tinha escolha senÃ£o fazer isso entÃ£o."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            loneliness: "ì™¸ë¡œì›€ë„ ê°ì •ì´ì•¼. ë§í•´ë„ ê´œì°®ì•„. ê·¸ í‘œì • ë’¤ì—ì„œ ì–¼ë§ˆë‚˜ í˜¼ìžì˜€ëŠ”ì§€.",
                            sadness: "ìŠ¬í””ì„ ì¸ì •í•˜ëŠ” ê²ƒì€ ìš©ê¸°ì•¼. ê·¸ í‘œì •ì€ ë„ˆë¥¼ ì§€í‚¤ë ¤ë˜ ë§ˆì§€ë§‰ ë°©ì–´ì„ ì´ì—ˆì–´.",
                            fear: "ë‘ë ¤ì›Œí–ˆë˜ ê²ƒë„ ë‹¹ì—°í•´. ê·¸ í‘œì •ì€ ë„ˆì˜ ì•ˆì „ìž¥ì¹˜ì˜€ë˜ ê±°ì•¼.",
                            anger: "í™”ë¥¼ ë‚´ë„ ê´œì°®ì•˜ëŠ”ë°... ê·¸ ë¯¸ì†Œ ë’¤ì—ì„œ ì–¼ë§ˆë‚˜ ë§Žì€ ë¶„ë…¸ë¥¼ ì‚¼ì¼°ì„ê¹Œ.",
                            emptiness: "ê³µí—ˆí•¨ì„ ëŠë¼ëŠ” ê²ƒë„ ì‚´ì•„ìžˆë‹¤ëŠ” ì¦ê±°ì•¼. ê·¸ í‘œì •ì€ ë„¤ê°€ ë¬´ì–¸ê°€ë¥¼ ê°ˆë§í–ˆë‹¤ëŠ” ì‹ í˜¸ì•¼.",
                            pretending: "ì—°ê¸°ëŠ” ë•Œë¡œ í•„ìš”í•´. í•˜ì§€ë§Œ ì´ì œëŠ” ì§„ì§œ ë„ˆë¥¼ ë³´ì—¬ì¤„ ë•Œê°€ ì™”ì–´.",
                            tired: "ë„ˆë¬´ ì˜¤ëž˜ ë²„í…¼êµ¬ë‚˜. ê·¸ í‘œì •ì€ ë„¤ê°€ ì–¼ë§ˆë‚˜ ê°•í–ˆëŠ”ì§€ ë³´ì—¬ì£¼ëŠ” ì¦ê±°ì•¼.",
                            hopeless: "ì ˆë§ ì†ì—ì„œë„ í‘œì •ì„ ë§Œë“¤ì—ˆë‹¤ëŠ” ê±´, í¬ê¸°í•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ëœ»ì´ì•¼.",
                            general: "ê·¸ í‘œì •ë„ ë„ˆì˜ ì¼ë¶€ì˜€ì–´. ë¶€ë„ëŸ¬ì›Œí•  í•„ìš” ì—†ì´, ì¸ì •í•´ì£¼ë©´ ë¼."
                        },
                        en: {
                            loneliness: "Loneliness is also an emotion. It's okay to talk about it. How alone you were behind that expression.",
                            sadness: "Acknowledging sadness is courage. That expression was the last line of defense trying to protect you.",
                            fear: "It was natural to be afraid. That expression was your safety device.",
                            anger: "It would have been okay to be angry... How much rage was swallowed behind that smile?",
                            emptiness: "Feeling emptiness is also proof of being alive. That expression was a signal that you longed for something.",
                            pretending: "Acting is sometimes necessary. But now it's time to show the real you.",
                            tired: "You endured for too long. That expression is evidence of how strong you were.",
                            hopeless: "The fact that you made an expression even in despair means you didn't give up.",
                            general: "That expression was also part of you. You don't need to be ashamed, just acknowledge it."
                        },
                        pt: {
                            loneliness: "A solidÃ£o tambÃ©m Ã© uma emoÃ§Ã£o. EstÃ¡ tudo bem falar sobre isso. QuÃ£o sozinho vocÃª estava por trÃ¡s daquela expressÃ£o.",
                            sadness: "Reconhecer a tristeza Ã© coragem. Aquela expressÃ£o era a Ãºltima linha de defesa tentando protegÃª-lo.",
                            fear: "Era natural ter medo. Aquela expressÃ£o era seu dispositivo de seguranÃ§a.",
                            anger: "Teria sido ok estar com raiva... Quanta raiva foi engolida por trÃ¡s daquele sorriso?",
                            emptiness: "Sentir vazio tambÃ©m Ã© prova de estar vivo. Aquela expressÃ£o era um sinal de que vocÃª ansiava por algo.",
                            pretending: "Fingir Ã s vezes Ã© necessÃ¡rio. Mas agora Ã© hora de mostrar o verdadeiro vocÃª.",
                            tired: "VocÃª aguentou por muito tempo. Aquela expressÃ£o Ã© evidÃªncia de quÃ£o forte vocÃª era.",
                            hopeless: "O fato de vocÃª ter feito uma expressÃ£o mesmo no desespero significa que nÃ£o desistiu.",
                            general: "Aquela expressÃ£o tambÃ©m era parte de vocÃª. VocÃª nÃ£o precisa se envergonhar, apenas reconheÃ§a."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            loneliness: "ì™¸ë¡œì›€ì˜ ìƒ‰ì€ ì—°í•œ ë³´ë¼ìƒ‰ì´ì•¼. ê·¸ í‘œì •ì—ì„œ ë‚˜ëŠ” ê·¸ ìƒ‰ì„ ë´¤ì–´.",
                            sadness: "ìŠ¬í””ì„ ê°ì¶˜ ë¯¸ì†ŒëŠ” ê°€ìž¥ ë³µìž¡í•œ ì˜ˆìˆ ìž‘í’ˆì´ì•¼. ì•„ë¦„ë‹µì§€ë§Œ ì• ìž”í•´.",
                            fear: "ë‘ë ¤ì›€ì˜ ê°€ë©´ì€ ì°¨ê°€ìš´ íŒŒëž€ìƒ‰ì´ì—ˆì„ ê±°ì•¼. í•˜ì§€ë§Œ ê·¸ ë’¤ì˜ ë”°ëœ»í•¨ë„ ëŠê»´ì ¸.",
                            anger: "ë¶„ë…¸ë¥¼ ìˆ¨ê¸´ ë¯¸ì†ŒëŠ” ë¹¨ê°•ê³¼ íšŒìƒ‰ì´ ì„žì¸ ìƒ‰ì´ì•¼. ê°•ë ¬í•˜ì§€ë§Œ ì–µëˆŒë ¤ìžˆì–´.",
                            emptiness: "ê³µí—ˆí•¨ì€ íˆ¬ëª…í•˜ì§€ë§Œ, ê·¸ íˆ¬ëª…í•¨ ì†ì—ë„ í¬ë¯¸í•œ ë¹›ì´ ìžˆì–´.",
                            pretending: "ì—°ê¸°í•˜ëŠ” í‘œì •ì€ ì—¬ëŸ¬ ìƒ‰ì´ ê²¹ì³ì§„ ê±°ì•¼. ë³µìž¡í•˜ì§€ë§Œ ê·¸ê²ƒë„ í•˜ë‚˜ì˜ ìž‘í’ˆì´ì•¼.",
                            tired: "í”¼ë¡œì˜ ìƒ‰ì€ ë°”ëžœ ë…¸ëž€ìƒ‰ì´ì•¼. í•œë•Œ ë°ì•˜ì§€ë§Œ, ì´ì œëŠ” ì¡°ê¸ˆ íë ¤ì¡Œì–´.",
                            hopeless: "ì ˆë§ë„ ìƒ‰ì´ ìžˆì–´. ê¹Šì€ ë‚¨ìƒ‰ì´ì§€ë§Œ, ê·¸ ì•ˆì— ë³„ë¹› ê°™ì€ ì ë“¤ì´ ìžˆì–´.",
                            general: "ê·¸ í‘œì •ë„ ë„¤ íŒ”ë ˆíŠ¸ì˜ í•œ ìƒ‰ì´ì•¼. ëª¨ë“  ìƒ‰ì´ ëª¨ì—¬ì•¼ ì™„ì „í•œ ê·¸ë¦¼ì´ ë¼."
                        },
                        en: {
                            loneliness: "The color of loneliness is light purple. I saw that color in your expression.",
                            sadness: "A smile hiding sadness is the most complex artwork. Beautiful but poignant.",
                            fear: "The mask of fear would have been cold blue. But I also feel the warmth behind it.",
                            anger: "A smile hiding anger is a mix of red and gray. Intense but suppressed.",
                            emptiness: "Emptiness is transparent, but even in that transparency there's a faint light.",
                            pretending: "An acting expression is multiple colors layered. Complex, but that's also one artwork.",
                            tired: "The color of fatigue is faded yellow. Once bright, but now a little dulled.",
                            hopeless: "Despair also has color. Deep navy blue, but with starlight-like dots inside.",
                            general: "That expression is also one color in your palette. All colors must come together to make a complete picture."
                        },
                        pt: {
                            loneliness: "A cor da solidÃ£o Ã© roxo claro. Eu vi essa cor na sua expressÃ£o.",
                            sadness: "Um sorriso escondendo tristeza Ã© a obra de arte mais complexa. Linda mas comovente.",
                            fear: "A mÃ¡scara do medo teria sido azul frio. Mas tambÃ©m sinto o calor por trÃ¡s dela.",
                            anger: "Um sorriso escondendo raiva Ã© uma mistura de vermelho e cinza. Intenso mas suprimido.",
                            emptiness: "O vazio Ã© transparente, mas mesmo nessa transparÃªncia hÃ¡ uma luz fraca.",
                            pretending: "Uma expressÃ£o de fingimento sÃ£o mÃºltiplas cores em camadas. Complexo, mas isso tambÃ©m Ã© uma obra de arte.",
                            tired: "A cor da fadiga Ã© amarelo desbotado. Uma vez brilhante, mas agora um pouco apagado.",
                            hopeless: "O desespero tambÃ©m tem cor. Azul marinho profundo, mas com pontos como luz das estrelas dentro.",
                            general: "Aquela expressÃ£o tambÃ©m Ã© uma cor na sua paleta. Todas as cores devem se unir para fazer um quadro completo."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 11ì´ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 11 will be ready soon!' :
                    'Portal 11 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 10ì„ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 10?' :
                    'Deseja reiniciar o Portal 10?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-10",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-10",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 10 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 10 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>