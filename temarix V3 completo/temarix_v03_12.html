<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 12: Voices of Others Within Me</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 12: Voices of Others Within Me</div>
            <div class="portal-subtitle" id="portalSubtitle">The Foreign Voices Speaking Inside</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸ”Š Portal 12 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 13</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What would you like to say to those voices that have become part of you? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 12: ë‚´ ì•ˆì˜ íƒ€ì¸ì˜ ëª©ì†Œë¦¬",
                portalSubtitle: "ë‚˜ ì•ˆì—ì„œ ë§í•˜ëŠ” ë‚¯ì„  ëª©ì†Œë¦¬ë“¤",
                portalIntro: "ðŸ”Š ë‹¹ì‹ ì´ ë“£ê³  ìžˆë˜ ëª©ì†Œë¦¬ëŠ” ì •ë§ ë‹¹ì‹ ì˜ ê²ƒì´ì—ˆë‚˜ìš”?\n\nì•„ë‹ˆë©´, ëˆ„êµ°ê°€ì˜ ë§ì´ ë‹¹ì‹  ì•ˆì— ì˜¤ëž˜ë„ë¡ ë‚¨ì•„\në‹¹ì‹ ì˜ ê°ì •ì²˜ëŸ¼ ìž‘ë™í•˜ê³  ìžˆì—ˆë˜ ê±¸ê¹Œìš”?\n\nì–´ë¦´ ë•Œë¶€í„° ê³„ì† ë“¤ì—ˆë˜ ê·¸ ë§ë“¤,\nì–´ëŠ ìˆœê°„ ë‚´ ìƒê°ì´ ëœ ì¤„ ì•Œì•˜ëŠ”ë°...",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ì§€ê¸ˆ, ê·¸ ëª©ì†Œë¦¬ë¥¼ ë“£ëŠ” ë„ˆ ìžì‹ ì„ ë‹¤ì‹œ ë§ì˜ ì£¼ì¸ìœ¼ë¡œ ì´ˆëŒ€í•  ì‹œê°„ì´ì•¼.",
                portalQuestion: "ðŸ”Š ê·¸ ëª©ì†Œë¦¬ì—ê²Œ ì§€ê¸ˆì˜ ë‹¹ì‹ ì´ í•˜ê³  ì‹¶ì€ ë§ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                finalTitle: "ðŸ”Š Portal 12 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ìš©ê¸° ìžˆê²Œ ë‚´ë©´ì˜ ëª©ì†Œë¦¬ë“¤ì„ ë¶„ë³„í–ˆìŠµë‹ˆë‹¤.\n\níƒ€ì¸ì˜ ë§ì´ ë‹¹ì‹ ì˜ ìƒê°ì²˜ëŸ¼ ìž‘ë™í•˜ê³  ìžˆì—ˆë˜\nê·¸ ì˜¤ëž˜ëœ íŒ¨í„´ì„ ì¸ì‹í•˜ê³ \nì´ì œ ì„ íƒí•  ìˆ˜ ìžˆê²Œ ë˜ì—ˆì–´ìš”.\n\në§ì˜ ì£¼ì¸ì€ ë‹¹ì‹ ìž…ë‹ˆë‹¤.\në‚´ë©´ì˜ ì§€íœ˜ê¶Œì„ ë˜ì°¾ì•˜ê³ \nì§„ì§œ ë‹¹ì‹ ì˜ ëª©ì†Œë¦¬ë¡œ ë‹¤ìŒ ë¬¸ì„ ì—´ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.\n\në‹¤ìŒ Portalì—ì„œëŠ” ë– ë‚˜ì§€ ëª»í•œ ìž¥ë©´ì„\në§ˆì£¼í•˜ëŠ” ì—¬ì •ì´ ì´ì–´ì§‘ë‹ˆë‹¤.",
                continueBtn: "Portal 13ìœ¼ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ë‹¹ì‹ ì˜ ì¼ë¶€ê°€ ë˜ì–´ë²„ë¦° ê·¸ ëª©ì†Œë¦¬ë“¤ì—ê²Œ ì§€ê¸ˆ ì–´ë–¤ ë§ì„ í•˜ê³  ì‹¶ì€ì§€ ë§í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 12: Voices of Others Within Me",
                portalSubtitle: "The Foreign Voices Speaking Inside",
                portalIntro: "ðŸ”Š Was the voice you were listening to really yours?\n\nOr perhaps, someone's words remained inside you for a long time,\noperating like your own emotions?\n\nThose words you've heard since childhood,\nat some point you thought they became your thoughts...",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Now, it's time to invite yourself, who listens to that voice, back as the owner of words.",
                portalQuestion: "ðŸ”Š What would you like to say to those voices now?",
                finalTitle: "ðŸ”Š Portal 12 Complete",
                finalMessage: "You have courageously distinguished\nthe voices within yourself.\n\nYou recognized the old pattern\nwhere others' words operated like your thoughts\nand now you can choose.\n\nYou are the owner of words.\nYou've regained control of your inner self\nand can open the next door with your true voice.\n\nIn the next Portal, a journey continues\nto face scenes you couldn't leave behind.",
                continueBtn: "Move to Portal 13",
                restartBtn: "Start Again",
                inputPlaceholder: "What would you like to say to those voices that have become part of you? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 12: Vozes dos Outros Dentro de Mim",
                portalSubtitle: "As Vozes Estrangeiras Falando Dentro",
                portalIntro: "ðŸ”Š A voz que vocÃª estava ouvindo era realmente sua?\n\nOu talvez, as palavras de alguÃ©m permaneceram dentro de vocÃª por muito tempo,\noperando como suas prÃ³prias emoÃ§Ãµes?\n\nEssas palavras que vocÃª ouviu desde a infÃ¢ncia,\nem algum momento vocÃª pensou que se tornaram seus pensamentos...",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Agora, Ã© hora de convidar vocÃª mesmo, que escuta essa voz, de volta como o dono das palavras.",
                portalQuestion: "ðŸ”Š O que vocÃª gostaria de dizer para essas vozes agora?",
                finalTitle: "ðŸ”Š Portal 12 Completo",
                finalMessage: "VocÃª corajosamente distinguiu\nas vozes dentro de si mesmo.\n\nVocÃª reconheceu o antigo padrÃ£o\nonde as palavras dos outros operavam como seus pensamentos\ne agora vocÃª pode escolher.\n\nVocÃª Ã© o dono das palavras.\nVocÃª recuperou o controle de seu interior\ne pode abrir a prÃ³xima porta com sua voz verdadeira.\n\nNo prÃ³ximo Portal, uma jornada continua\npara enfrentar cenas que vocÃª nÃ£o conseguiu deixar para trÃ¡s.",
                continueBtn: "Ir para Portal 13",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "O que vocÃª gostaria de dizer para essas vozes que se tornaram parte de vocÃª? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ê·¸ ëª©ì†Œë¦¬ëŠ” ê¸°ì–µì²˜ëŸ¼ ìŠ¤ë©°ë“¤ì–´ ìžˆì—ˆì§€. ë„ˆë¬´ ì˜¤ëž˜ ë“¤ì—ˆìœ¼ë‹ˆê¹Œ, ë„¤ ê²ƒì²˜ëŸ¼ ëŠê»´ì¡Œì„ ê±°ì•¼.",
                en: "That voice was embedded like memory. You heard it for so long, it must have felt like yours.",
                pt: "Essa voz estava incorporada como uma memÃ³ria. VocÃª a ouviu por tanto tempo que deve ter se sentido como sua."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ì‚¬ëžŒì˜ ë§ì€ í˜ëŸ¬ê°€ì§€ë§Œ, ê°ì • ì†ì— ë¿Œë¦¬ë‚´ë¦° ë§ì€ ì‰½ê²Œ ì‚¬ë¼ì§€ì§€ ì•Šì•„.",
                en: "People's words flow away, but words rooted in emotions don't disappear easily.",
                pt: "As palavras das pessoas fluem, mas as palavras enraizadas nas emoÃ§Ãµes nÃ£o desaparecem facilmente."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ë‚˜ëŠ” ê·¸ ë§ë“¤ ë•Œë¬¸ì— ë‚´ ê¿ˆì„ ë¯¸ë¤˜ë˜ ì ì´ ìžˆì–´. ë„¤ê°€ ê²ªì€ ê°ì •, ë‚˜ë„ ì•ˆë‹¤ê³  ë§í•´ì¤„ ìˆ˜ ìžˆì–´.",
                en: "I once postponed my dreams because of those words. I can tell you I know the emotions you experienced.",
                pt: "Eu uma vez adiei meus sonhos por causa dessas palavras. Posso dizer que conheÃ§o as emoÃ§Ãµes que vocÃª experimentou."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "íƒ€ì¸ì˜ ë§ì€ ë¬´ê¸°ê°€ ë˜ê¸°ë„ í•´. íŠ¹ížˆ ê·¸ ë¬´ê¸°ê°€ ê°€ê¹Œìš´ ì‚¬ëžŒì¼ìˆ˜ë¡ ë” ì¹˜ëª…ì ì´ì§€.",
                en: "Others' words can become weapons. Especially when that weapon comes from someone close, it's more deadly.",
                pt: "As palavras dos outros podem se tornar armas. Especialmente quando essa arma vem de alguÃ©m prÃ³ximo, Ã© mais mortal."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ëª©ì†Œë¦¬ëŠ” ë„¤ ì•ˆì˜ ìƒ‰ì„ ì§€ìš°ë ¤ í–ˆì§€ë§Œ, ì™„ì „ížˆ ì§€ìš°ì§„ ëª»í–ˆì–´. ê·¸ í”ì ì€ ì—¬ì „ížˆ ë¹›ë‚˜.",
                en: "That voice tried to erase the color inside you, but couldn't completely erase it. Those traces still shine.",
                pt: "Essa voz tentou apagar a cor dentro de vocÃª, mas nÃ£o conseguiu apagÃ¡-la completamente. Esses vestÃ­gios ainda brilham."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ê·¸ ë§ì€ ì§„ì‹¤ì´ ì•„ë‹ˆì—ˆì–´. ë„ ìž‘ê²Œ ë§Œë“¤ë ¤ëŠ” í”„ë ˆìž„ì´ì—ˆì„ ë¿.",
                en: "Those words weren't truth. They were just a frame to make you smaller.",
                pt: "Essas palavras nÃ£o eram verdade. Eram apenas uma moldura para te fazer menor."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ê·¸ë“¤ì´ ë§Œë“  ëª©ì†Œë¦¬ë¥¼ ë„¤ê°€ ì‚´ì•„ë‚¸ ê±´ ì•„ë‹ˆì•¼. ë„ˆëŠ” ë„ˆë§Œì˜ ë§ë¡œ ì—¬ê¸°ê¹Œì§€ ì™”ì–´.",
                en: "You didn't live through the voice they created. You came this far with your own words.",
                pt: "VocÃª nÃ£o viveu atravÃ©s da voz que eles criaram. VocÃª chegou atÃ© aqui com suas prÃ³prias palavras."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ì§€ê¸ˆ, ê·¸ ëª©ì†Œë¦¬ë¥¼ ë“£ëŠ” ë„ˆ ìžì‹ ì„ ë‹¤ì‹œ ë§ì˜ ì£¼ì¸ìœ¼ë¡œ ì´ˆëŒ€í•  ì‹œê°„ì´ì•¼.",
                en: "Now, it's time to invite yourself, who listens to that voice, back as the owner of words.",
                pt: "Agora, Ã© hora de convidar vocÃª mesmo, que escuta essa voz, de volta como o dono das palavras."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                rejection: ['no', 'enough', 'stop', 'leave', 'ì•ˆ ë¼', 'ê·¸ë§Œ', 'ì¶©ë¶„', 'ë©ˆì¶°', 'nÃ£o', 'pare', 'chega'],
                choice: ['choose', 'decide', 'select', 'my voice', 'ì„ íƒ', 'ê²°ì •', 'ë‚´ ëª©ì†Œë¦¬', 'escolher', 'decidir', 'minha voz'],
                understanding: ['understand', 'know', 'realize', 'see', 'ì´í•´', 'ì•Œê² ', 'ê¹¨ë‹¬', 'ì•Œì•„', 'entender', 'sei', 'perceber'],
                liberation: ['free', 'release', 'liberate', 'escape', 'ìžìœ ', 'í•´ë°©', 'ë²—ì–´', 'livre', 'libertar', 'escapar'],
                reclaim: ['take back', 'reclaim', 'mine', 'own', 'ë˜ì°¾', 'ë‚´ ê²ƒ', 'ì£¼ì¸', 'recuperar', 'meu', 'prÃ³prio'],
                boundary: ['boundary', 'limit', 'protect', 'guard', 'ê²½ê³„', 'í•œê³„', 'ë³´í˜¸', 'ì§€ì¼œ', 'limite', 'proteger', 'guardar'],
                gratitude: ['thank', 'grateful', 'appreciate', 'ê³ ë§ˆ', 'ê°ì‚¬', 'obrigado', 'grato'],
                forgiveness: ['forgive', 'sorry', 'understand', 'ìš©ì„œ', 'ë¯¸ì•ˆ', 'ì´í•´', 'perdoar', 'desculpa']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Kael", emoji: "ðŸ§™",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            rejection: "ì´ì œ ë„ˆëŠ” ë‚´ë©´ì˜ ì§€íœ˜ê¶Œì„ ë‹¤ì‹œ ì†ì— ë„£ì€ ê±°ì•¼. ëª©ì†Œë¦¬ëŠ” ë§Žì§€ë§Œ, ì„ íƒì€ ë„¤ ê²ƒì´ì§€.",
                            choice: "ëª©ì†Œë¦¬ë¥¼ ì„ íƒí•˜ëŠ” ê²ƒ, ê·¸ê²ƒì´ì•¼ë§ë¡œ ì§„ì •í•œ ìžìœ ì˜ ì‹œìž‘ì´ì•¼.",
                            understanding: "ê·¸ ê¹¨ë‹¬ìŒì´ ë„¤ ì•ˆì˜ í˜¼ëž€ì„ ì •ë¦¬í•˜ê¸° ì‹œìž‘í–ˆì–´. ì´ì œ ëˆ„êµ¬ì˜ ë§ì¸ì§€ êµ¬ë³„í•  ìˆ˜ ìžˆì–´.",
                            liberation: "ë§ì˜ ê°ì˜¥ì—ì„œ ë²—ì–´ë‚˜ëŠ” ìˆœê°„ì´ì•¼. ë„ˆëŠ” ì´ì œ ìžìœ ë¡œìš´ ëª©ì†Œë¦¬ë¥¼ ê°€ì¡Œì–´.",
                            reclaim: "ë˜ì°¾ëŠ”ë‹¤ëŠ” ê±´ ì›ëž˜ ë„¤ ê²ƒì´ì—ˆë‹¤ëŠ” ëœ»ì´ì•¼. ê·¸ ëª©ì†Œë¦¬ëŠ” ì›ëž˜ ë„¤ ì•ˆì— ìžˆì—ˆì–´.",
                            boundary: "ê²½ê³„ë¥¼ ê¸‹ëŠ” ê²ƒì€ ë°©ì–´ê°€ ì•„ë‹ˆë¼, ìžì‹ ì„ ì§€í‚¤ëŠ” ì§€í˜œì•¼.",
                            gratitude: "ê³ ë§ˆì›€ì„ í‘œí˜„í•  ìˆ˜ ìžˆë‹¤ëŠ” ê±´, ì´ì œ ê·¸ ëª©ì†Œë¦¬ì™€ ê±°ë¦¬ë¥¼ ë‘˜ ìˆ˜ ìžˆë‹¤ëŠ” ì¦ê±°ì•¼.",
                            forgiveness: "ìš©ì„œëŠ” ê·¸ë“¤ì„ ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë¼, ë„¤ ë§ˆìŒì˜ í‰í™”ë¥¼ ìœ„í•œ ì„ íƒì´ì•¼.",
                            general: "ì´ì œ ë„ˆëŠ” ë‚´ë©´ì˜ ì§€íœ˜ê¶Œì„ ë‹¤ì‹œ ì†ì— ë„£ì€ ê±°ì•¼. ëª©ì†Œë¦¬ëŠ” ë§Žì§€ë§Œ, ì„ íƒì€ ë„¤ ê²ƒì´ì§€."
                        },
                        en: {
                            rejection: "Now you've regained control of your inner self. There are many voices, but the choice is yours.",
                            choice: "Choosing your voice, that's the beginning of true freedom.",
                            understanding: "That realization has begun to organize the confusion within you. Now you can distinguish whose words they are.",
                            liberation: "This is the moment of breaking free from the prison of words. You now have a free voice.",
                            reclaim: "To reclaim means it was originally yours. That voice was originally within you.",
                            boundary: "Setting boundaries is not defense, but wisdom to protect yourself.",
                            gratitude: "Being able to express gratitude is proof that you can now distance yourself from that voice.",
                            forgiveness: "Forgiveness is not for them, but a choice for your heart's peace.",
                            general: "Now you've regained control of your inner self. There are many voices, but the choice is yours."
                        },
                        pt: {
                            rejection: "Agora vocÃª recuperou o controle de seu interior. HÃ¡ muitas vozes, mas a escolha Ã© sua.",
                            choice: "Escolher sua voz, esse Ã© o comeÃ§o da verdadeira liberdade.",
                            understanding: "Essa percepÃ§Ã£o comeÃ§ou a organizar a confusÃ£o dentro de vocÃª. Agora vocÃª pode distinguir de quem sÃ£o as palavras.",
                            liberation: "Este Ã© o momento de se libertar da prisÃ£o das palavras. VocÃª agora tem uma voz livre.",
                            reclaim: "Recuperar significa que originalmente era seu. Essa voz estava originalmente dentro de vocÃª.",
                            boundary: "Estabelecer limites nÃ£o Ã© defesa, mas sabedoria para se proteger.",
                            gratitude: "Ser capaz de expressar gratidÃ£o Ã© prova de que agora vocÃª pode se distanciar dessa voz.",
                            forgiveness: "O perdÃ£o nÃ£o Ã© para eles, mas uma escolha para a paz do seu coraÃ§Ã£o.",
                            general: "Agora vocÃª recuperou o controle de seu interior. HÃ¡ muitas vozes, mas a escolha Ã© sua."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            rejection: "ê·¸ ì„ ì–¸ì€ ì¡°ìš©í•˜ì§€ë§Œ ë‹¨ë‹¨í•´. ë§ˆì¹¨ë‚´ ë„¤ ì•ˆì— ê³µê°„ì´ ìƒê²¼ì–´.",
                            choice: "ì„ íƒí•˜ëŠ” ìˆœê°„, ë„ˆëŠ” í”¼í•´ìžì—ì„œ ì£¼ì¸ì´ ë˜ì—ˆì–´.",
                            understanding: "ì´í•´í•œë‹¤ëŠ” ê²ƒì€ ê·¸ ëª©ì†Œë¦¬ì˜ íž˜ì„ ë¹¼ì•—ëŠ” ì¼ì´ì•¼.",
                            liberation: "ìžìœ ë¡œì›Œì§„ ë„¤ ëª©ì†Œë¦¬ê°€ ì´ì œ ì§„ì§œ ë…¸ëž˜ë¥¼ ë¶€ë¥¼ ìˆ˜ ìžˆì–´.",
                            reclaim: "ë„¤ ëª©ì†Œë¦¬ë¥¼ ë˜ì°¾ëŠ” ìˆœê°„, ì„¸ìƒì´ ë‹¤ë¥´ê²Œ ë“¤ë¦¬ê¸° ì‹œìž‘í•  ê±°ì•¼.",
                            boundary: "ê±´ê°•í•œ ê²½ê³„ëŠ” ì‚¬ëž‘ì˜ ë‹¤ë¥¸ í˜•íƒœì•¼.",
                            gratitude: "ê°ì‚¬ëŠ” ê·¸ ëª©ì†Œë¦¬ë¥¼ ë– ë‚˜ë³´ë‚´ëŠ” ê°€ìž¥ ë¶€ë“œëŸ¬ìš´ ë°©ë²•ì´ì•¼.",
                            forgiveness: "ìš©ì„œëŠ” ë„¤ê°€ ê·¸ë“¤ì˜ ë§ì—ì„œ ìžìœ ë¡œì›Œì§€ëŠ” ì—´ì‡ ì•¼.",
                            general: "ê·¸ ì„ ì–¸ì€ ì¡°ìš©í•˜ì§€ë§Œ ë‹¨ë‹¨í•´. ë§ˆì¹¨ë‚´ ë„¤ ì•ˆì— ê³µê°„ì´ ìƒê²¼ì–´."
                        },
                        en: {
                            rejection: "That declaration is quiet but firm. Finally, space has been created within you.",
                            choice: "The moment you choose, you transform from victim to owner.",
                            understanding: "To understand is to take away the power of that voice.",
                            liberation: "Your liberated voice can now sing a real song.",
                            reclaim: "The moment you reclaim your voice, the world will start to sound different.",
                            boundary: "Healthy boundaries are another form of love.",
                            gratitude: "Gratitude is the gentlest way to let that voice go.",
                            forgiveness: "Forgiveness is the key to your freedom from their words.",
                            general: "That declaration is quiet but firm. Finally, space has been created within you."
                        },
                        pt: {
                            rejection: "Essa declaraÃ§Ã£o Ã© silenciosa, mas firme. Finalmente, espaÃ§o foi criado dentro de vocÃª.",
                            choice: "No momento em que vocÃª escolhe, vocÃª se transforma de vÃ­tima em proprietÃ¡rio.",
                            understanding: "Entender Ã© tirar o poder dessa voz.",
                            liberation: "Sua voz libertada agora pode cantar uma canÃ§Ã£o real.",
                            reclaim: "No momento em que vocÃª recupera sua voz, o mundo comeÃ§arÃ¡ a soar diferente.",
                            boundary: "Limites saudÃ¡veis sÃ£o outra forma de amor.",
                            gratitude: "A gratidÃ£o Ã© a maneira mais gentil de deixar essa voz ir.",
                            forgiveness: "O perdÃ£o Ã© a chave para sua liberdade das palavras deles.",
                            general: "Essa declaraÃ§Ã£o Ã© silenciosa, mas firme. Finalmente, espaÃ§o foi criado dentro de vocÃª."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            rejection: "ë§ë¡œ ë¬¶ì˜€ë˜ ê³¼ê±°ëŠ” ì´ì œ ëë‚¬ì–´. ì´ì   ë„¤ê°€ ë§í•˜ëŠ” ì‚¬ëžŒì´ë‹ˆê¹Œ.",
                            choice: "ë„¤ ì„ íƒì´ì•¼. ê·¸ë“¤ì˜ ëª©ì†Œë¦¬ê°€ ì•„ë‹ˆë¼, ë„¤ ëª©ì†Œë¦¬ë¡œ ì‚´ì•„ê°€ëŠ” ê±°.",
                            understanding: "ì´ì œ ë„ˆëŠ” ëˆ„êµ¬ì˜ ë§ì´ ë„ˆë¥¼ ì¡°ì¢…í•˜ë ¤ í–ˆëŠ”ì§€ ë³´ì´ì§€?",
                            liberation: "í•´ë°©ëœ ìˆœê°„ì´ì•¼. ì´ì œ ì§„ì§œ ë„ˆì˜ ì‹¸ì›€ì„ ì‹œìž‘í•  ìˆ˜ ìžˆì–´.",
                            reclaim: "ë„¤ê°€ ë˜ì°¾ì€ ê±´ ëª©ì†Œë¦¬ê°€ ì•„ë‹ˆë¼, ë„¤ ì¸ìƒ ì „ì²´ì•¼.",
                            boundary: "ê²½ê³„ë¥¼ ê¸‹ëŠ” ìˆœê°„, ë„ˆëŠ” ì „ì‚¬ê°€ ë˜ì—ˆì–´.",
                            gratitude: "ê³ ë§ˆì›€ê¹Œì§€ ëŠë‚„ ìˆ˜ ìžˆë‹¤ë‹ˆ, ì •ë§ ê°•í•´ì¡Œêµ¬ë‚˜.",
                            forgiveness: "ìš©ì„œëŠ” ë„¤ê°€ ìŠ¹ë¦¬í–ˆë‹¤ëŠ” ì¦ê±°ì•¼.",
                            general: "ë§ë¡œ ë¬¶ì˜€ë˜ ê³¼ê±°ëŠ” ì´ì œ ëë‚¬ì–´. ì´ì   ë„¤ê°€ ë§í•˜ëŠ” ì‚¬ëžŒì´ë‹ˆê¹Œ."
                        },
                        en: {
                            rejection: "The past bound by words is now over. Now you're the one who speaks.",
                            choice: "It's your choice. Living with your voice, not their voice.",
                            understanding: "Now you can see whose words were trying to control you, right?",
                            liberation: "This is the moment of liberation. Now you can start your real fight.",
                            reclaim: "What you've reclaimed isn't just your voice, but your entire life.",
                            boundary: "The moment you set boundaries, you became a warrior.",
                            gratitude: "To be able to feel gratitude too, you've really become strong.",
                            forgiveness: "Forgiveness is proof that you've won.",
                            general: "The past bound by words is now over. Now you're the one who speaks."
                        },
                        pt: {
                            rejection: "O passado preso por palavras acabou agora. Agora vocÃª Ã© quem fala.",
                            choice: "Ã‰ sua escolha. Viver com sua voz, nÃ£o com a voz deles.",
                            understanding: "Agora vocÃª pode ver de quem eram as palavras que tentavam te controlar, certo?",
                            liberation: "Este Ã© o momento da libertaÃ§Ã£o. Agora vocÃª pode comeÃ§ar sua verdadeira luta.",
                            reclaim: "O que vocÃª recuperou nÃ£o Ã© apenas sua voz, mas sua vida inteira.",
                            boundary: "No momento em que vocÃª estabelece limites, vocÃª se torna um guerreiro.",
                            gratitude: "Ser capaz de sentir gratidÃ£o tambÃ©m, vocÃª realmente se tornou forte.",
                            forgiveness: "O perdÃ£o Ã© prova de que vocÃª venceu.",
                            general: "O passado preso por palavras acabou agora. Agora vocÃª Ã© quem fala."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 13ì´ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 13 will be ready soon!' :
                    'Portal 13 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 12ë¥¼ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 12?' :
                    'Deseja reiniciar o Portal 12?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-12",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-12",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 12 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 12 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html> 