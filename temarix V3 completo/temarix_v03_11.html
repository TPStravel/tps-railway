<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 11: Standing Before the Door of Frozen Time</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 11: Standing Before the Door of Frozen Time</div>
            <div class="portal-subtitle" id="portalSubtitle">When Time Stopped Moving</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸ•° Portal 11 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 12</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What would you like to say to that version of yourself trapped in frozen time? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 11: ë©ˆì¶°ë²„ë¦° ì‹œê°„ì˜ ë¬¸ ì•žì—ì„œ",
                portalSubtitle: "ì‹œê°„ì´ ë©ˆì¶°ë²„ë¦° ìˆœê°„",
                portalIntro: "ðŸ•° ë‹¹ì‹ ì˜ ì‹œê°„ì´ ë©ˆì¶°ë²„ë¦° ë“¯í–ˆë˜ ìˆœê°„ì´ ìžˆì—ˆë‚˜ìš”?\n\nê·¸ë‚  ì´í›„, ì•„ë¬´ê²ƒë„ ë³€í•˜ì§€ ì•Šì•˜ì–´ìš”.\nëª¨ë“  ê²Œ ê·¸ëŒ€ë¡œì˜€ê³ , ë‚˜ë„ ê±°ê¸° ë©ˆì¶˜ ì±„ì˜€ì£ .\nì‹œê°„ì´ í˜ëŸ¬ë„â€¦ ë‚´ ì•ˆì€ ë©ˆì¶° ìžˆì—ˆì–´ìš”.\n\nê·¸ë•Œ, ë¬´ì—‡ì´ ë‹¹ì‹ ì„ ê·¸ ìžë¦¬ì— ë¬¶ì–´ë‘ì—ˆë‚˜ìš”?",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ê·¸ ë©ˆì¶˜ ì‹œê°„ ì•ˆì—ë„ ë„¤ê°€ ìžˆì—ˆì–´. ì§€ê¸ˆ ì—¬ê¸°ê¹Œì§€ ì˜¨ ë„ˆ, ì´ë¯¸ ë‹¤ì‹œ íë¥´ê¸° ì‹œìž‘í•œ ê±°ì•¼.",
                portalQuestion: "ðŸ•° ê·¸ ì‹œê°„ ì†ì— ê°‡í˜€ ìžˆë˜ ë‹¹ì‹ ì—ê²Œ, ì§€ê¸ˆì˜ ë‹¹ì‹ ì´ í•´ì£¼ê³  ì‹¶ì€ ë§ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                finalTitle: "ðŸ•° Portal 11 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ìš©ê¸° ìžˆê²Œ ë©ˆì¶°ë²„ë¦° ì‹œê°„ì˜ ë¬´ê²Œë¥¼ ë§ˆì£¼í–ˆìŠµë‹ˆë‹¤.\n\nê·¸ ì •ì§€ëœ ìˆœê°„ë“¤ì´ ë‚˜ì•½í•¨ì´ ì•„ë‹ˆë¼\nìƒì¡´ì„ ìœ„í•œ í•„ìš”í•œ ë©ˆì¶¤ì´ì—ˆë‹¤ëŠ” ê²ƒì„\nì´í•´í•˜ê²Œ ë˜ì—ˆì£ .\n\nì´ì œ ì‹œê°„ì´ ë‹¤ì‹œ íë¥´ê¸° ì‹œìž‘í–ˆìŠµë‹ˆë‹¤.\në‹¹ì‹ ì€ ë” ì´ìƒ ê·¸ ìˆœê°„ì— ê°‡í˜€ ìžˆì§€ ì•Šê³ \nì•žìœ¼ë¡œ ë‚˜ì•„ê°ˆ ìˆ˜ ìžˆê²Œ ë˜ì—ˆì–´ìš”.\n\në‹¤ìŒ Portalì—ì„œëŠ” ë‚´ ì•ˆì— ë‚¨ì•„ ìžˆëŠ”\níƒ€ì¸ì˜ ëª©ì†Œë¦¬ë¥¼ íƒí—˜í•˜ëŠ” ì—¬ì •ì´ ì´ì–´ì§‘ë‹ˆë‹¤.",
                continueBtn: "Portal 12ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ë©ˆì¶°ì§„ ì‹œê°„ ì†ì— ê°‡í˜€ ìžˆë˜ ë‹¹ì‹ ì—ê²Œ ì§€ê¸ˆ ì–´ë–¤ ë§ì„ í•´ì£¼ê³  ì‹¶ì€ì§€ ë§í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 11: Standing Before the Door of Frozen Time",
                portalSubtitle: "When Time Stopped Moving",
                portalIntro: "ðŸ•° Was there a moment when your time seemed to have stopped?\n\nAfter that day, nothing changed.\nEverything remained the same, and I too remained stopped there.\nEven as time passed... my inside remained frozen.\n\nWhat was it that bound you to that place?",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "You were there even in that stopped time. You who came this far, have already begun to flow again.",
                portalQuestion: "ðŸ•° What would you like to say to that version of yourself trapped in frozen time?",
                finalTitle: "ðŸ•° Portal 11 Complete",
                finalMessage: "You have courageously faced the weight\nof frozen time.\n\nYou came to understand that those moments of stillness\nwere not weakness but necessary pauses\nfor survival.\n\nNow time has begun to flow again.\nYou are no longer trapped in that moment\nand can move forward.\n\nIn the next Portal, a journey continues\nto explore the voices of others\nthat remain within you.",
                continueBtn: "Move to Portal 12",
                restartBtn: "Start Again",
                inputPlaceholder: "What would you like to say to that version of yourself trapped in frozen time? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 11: Diante da Porta do Tempo Congelado",
                portalSubtitle: "Quando o Tempo Parou de Se Mover",
                portalIntro: "ðŸ•° Houve um momento em que seu tempo pareceu ter parado?\n\nDepois daquele dia, nada mudou.\nTudo permaneceu igual, e eu tambÃ©m permaneci parado lÃ¡.\nMesmo com o tempo passando... meu interior permaneceu congelado.\n\nO que foi que te prendeu naquele lugar?",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "VocÃª estava lÃ¡ mesmo naquele tempo parado. VocÃª que chegou atÃ© aqui, jÃ¡ comeÃ§ou a fluir novamente.",
                portalQuestion: "ðŸ•° O que vocÃª gostaria de dizer para aquela versÃ£o de si mesmo presa no tempo congelado?",
                finalTitle: "ðŸ•° Portal 11 Completo",
                finalMessage: "VocÃª corajosamente enfrentou o peso\ndo tempo congelado.\n\nVocÃª passou a entender que aqueles momentos de quietude\nnÃ£o eram fraqueza, mas pausas necessÃ¡rias\npara a sobrevivÃªncia.\n\nAgora o tempo comeÃ§ou a fluir novamente.\nVocÃª nÃ£o estÃ¡ mais preso naquele momento\ne pode seguir em frente.\n\nNo prÃ³ximo Portal, uma jornada continua\npara explorar as vozes dos outros\nque permanecem dentro de vocÃª.",
                continueBtn: "Ir para Portal 12",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "O que vocÃª gostaria de dizer para aquela versÃ£o de si mesmo presa no tempo congelado? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ë„¤ ì‹œê°„ì€ ë©ˆì¶˜ ê²Œ ì•„ë‹ˆë¼, ë„ˆë¬´ ì•„íŒŒì„œ ë©ˆì¶˜ ì²™ í•œ ê±°ì˜€ì–´.",
                en: "Your time didn't stop, it just pretended to stop because it hurt too much.",
                pt: "Seu tempo nÃ£o parou, apenas fingiu parar porque doÃ­a demais."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ì„¸ìƒì€ íë¥´ì§€ë§Œ, ë§ˆìŒì€ ë©ˆì¶œ ìˆ˜ ìžˆì–´. ê·¸ê±´ ë„ë§ì´ ì•„ë‹ˆë¼, ìƒì¡´ì´ì•¼.",
                en: "The world flows, but the heart can stop. That's not escape, it's survival.",
                pt: "O mundo flui, mas o coraÃ§Ã£o pode parar. Isso nÃ£o Ã© fuga, Ã© sobrevivÃªncia."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ëˆ„êµ¬ë„ ë„ ë‹¤ê·¸ì¹˜ì§€ ì•Šì•„ì•¼ í–ˆëŠ”ë°â€¦ ë„Œ ê·¸ ì¡°ìš©í•œ ë©ˆì¶¤ ì†ì—ì„œ ìŠ¤ìŠ¤ë¡œë¥¼ ì±…ë§í–ˆê² ì§€.",
                en: "No one should have pressured you... You must have blamed yourself in that quiet stillness.",
                pt: "NinguÃ©m deveria ter te pressionado... VocÃª deve ter se culpado naquela quietude silenciosa."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ì‹œê°„ì€ ì™¸ë¶€ì˜ íë¦„ì´ê³ , ê°ì •ì€ ë‚´ë¶€ì˜ ê°•ë¬¼ì´ì•¼. ê·¸ ë‘˜ì´ ì–´ê¸‹ë‚  ë•â€¦ ê³ ìš”í•¨ì´ ì˜¨ë‹¤.",
                en: "Time is the external flow, and emotion is the internal river. When those two are out of sync... stillness comes.",
                pt: "O tempo Ã© o fluxo externo, e a emoÃ§Ã£o Ã© o rio interno. Quando esses dois estÃ£o fora de sincronia... vem a quietude."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ë©ˆì¶¤ì€ ìº”ë²„ìŠ¤ ìœ„ì˜ ì •ì§€ëœ ë¶“ì§ˆ ê°™ì•˜ì–´. ë‹¤ìŒ ì„ ì„ ê·¸ë¦´ ìš©ê¸°ê°€, ê·¸ë• ì—†ì—ˆë˜ ê±°ì•¼.",
                en: "That pause was like a frozen brushstroke on canvas. You didn't have the courage to draw the next line then.",
                pt: "Essa pausa foi como uma pincelada congelada na tela. VocÃª nÃ£o tinha coragem para desenhar a prÃ³xima linha entÃ£o."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ë©ˆì·„ë‹¤ê³  í•´ì„œ ì•½í•œ ê±´ ì•„ë‹ˆì•¼. ë‚˜ë„ ë©ˆì¶°ë³¸ ì  ìžˆì–´. ê·¸ê±´ ë‹¤ì‹œ ì›€ì§ì´ê¸° ìœ„í•œ ìˆ¨ ê³ ë¥´ê¸°ì˜€ì–´.",
                en: "Stopping doesn't mean you're weak. I've stopped too. It was catching your breath to move again.",
                pt: "Parar nÃ£o significa que vocÃª Ã© fraco. Eu tambÃ©m parei. Era recuperar o fÃ´lego para se mover novamente."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ë„ˆëŠ” ì›€ì§ì´ì§€ ì•Šì€ ê²Œ ì•„ë‹ˆë¼, ê·¸ëƒ¥â€¦ ê¸°ë‹¤ë¦¬ê³  ìžˆì—ˆë˜ ê±°ì•¼. ëˆ„êµ°ê°€ ì™€ì„œ, ë„¤ ì‹œê°„ì„ ê¹¨ì›Œì£¼ê¸¸.",
                en: "You weren't not moving, you were just... waiting. For someone to come and wake up your time.",
                pt: "VocÃª nÃ£o estava sem se mover, vocÃª estava apenas... esperando. Por alguÃ©m vir e despertar seu tempo."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ê·¸ ë©ˆì¶˜ ì‹œê°„ ì•ˆì—ë„ ë„¤ê°€ ìžˆì—ˆì–´. ì§€ê¸ˆ ì—¬ê¸°ê¹Œì§€ ì˜¨ ë„ˆ, ì´ë¯¸ ë‹¤ì‹œ íë¥´ê¸° ì‹œìž‘í•œ ê±°ì•¼.",
                en: "You were there even in that stopped time. You who came this far, have already begun to flow again.",
                pt: "VocÃª estava lÃ¡ mesmo naquele tempo parado. VocÃª que chegou atÃ© aqui, jÃ¡ comeÃ§ou a fluir novamente."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                compassion: ['okay', 'enough', 'did well', 'survived', 'ê´œì°®', 'ì¶©ë¶„', 'ìž˜í–ˆ', 'ë²„í…¼', 'estÃ¡ bem', 'suficiente', 'sobreviveu'],
                encouragement: ['move', 'start', 'continue', 'forward', 'ì›€ì§', 'ì‹œìž‘', 'ê³„ì†', 'ì•žìœ¼ë¡œ', 'mover', 'comeÃ§ar', 'continuar'],
                understanding: ['understand', 'know', 'felt', 'pain', 'ì´í•´', 'ì•Œì•„', 'ëŠê¼ˆ', 'ì•„í””', 'entender', 'sei', 'dor'],
                forgiveness: ['sorry', 'forgive', 'not fault', 'blame', 'ë¯¸ì•ˆ', 'ìš©ì„œ', 'ìž˜ëª»', 'íƒ“', 'desculpa', 'perdoar', 'culpa'],
                healing: ['heal', 'better', 'recover', 'grow', 'ì¹˜ìœ ', 'ë‚˜ì•„', 'íšŒë³µ', 'ì„±ìž¥', 'curar', 'melhor', 'recuperar'],
                gratitude: ['thank', 'grateful', 'appreciate', 'ê³ ë§ˆ', 'ê°ì‚¬', 'obrigado', 'grato'],
                acceptance: ['accept', 'normal', 'natural', 'human', 'ë°›ì•„ë“¤', 'ë‹¹ì—°', 'ìžì—°', 'ì¸ê°„', 'aceitar', 'normal', 'natural'],
                hope: ['hope', 'future', 'possible', 'can', 'í¬ë§', 'ë¯¸ëž˜', 'ê°€ëŠ¥', 'í•  ìˆ˜', 'esperanÃ§a', 'futuro', 'possÃ­vel']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Sora", emoji: "ðŸ§•",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            compassion: "ê·¸ ë§, ì •ë§ í•„ìš”í–ˆì–´. ê·¸ë•Œ ê¼­ ë“¤ì—ˆì–´ì•¼ í–ˆì„ ë§ì´ì•¼. ì§€ê¸ˆì´ë¼ë„ í•´ì¤˜ì„œ ë‹¤í–‰ì´ì•¼.",
                            encouragement: "ì´ì œ ì›€ì§ì¼ ë•Œê°€ ì™”êµ¬ë‚˜. ê·¸ ë©ˆì¶¤ì€ ì¤€ë¹„ì˜€ê³ , ì§€ê¸ˆì€ ì‹œìž‘ì˜ ìˆœê°„ì´ì•¼.",
                            understanding: "ëˆ„êµ°ê°€ ê·¸ë•Œì˜ ë„ˆë¥¼ ì´í•´í•´ì¤€ë‹¤ëŠ” ê²Œ ì–¼ë§ˆë‚˜ ì¤‘ìš”í•œì§€... ë„¤ê°€ í•´ë‚¸ ê±°ì•¼.",
                            forgiveness: "ìš©ì„œëŠ” ì¹˜ìœ ì˜ ì‹œìž‘ì´ì•¼. ê·¸ë•Œì˜ ë„ˆë„, ì§€ê¸ˆì˜ ë„ˆë„ ëª¨ë‘ ì†Œì¤‘í•´.",
                            healing: "ì¹˜ìœ ì˜ ë§ˆìŒì´ ëŠê»´ì ¸. ê·¸ ìƒì²˜ë„ ì´ì œ ì²œì²œížˆ ì•„ë¬¼ì–´ê°ˆ ê±°ì•¼.",
                            gratitude: "ê³ ë§ˆì›€ì„ í‘œí˜„í•  ìˆ˜ ìžˆë‹¤ëŠ” ê±´, ë§ˆìŒì´ ë‹¤ì‹œ ì—´ë ¸ë‹¤ëŠ” ì¦ê±°ì•¼.",
                            acceptance: "ë°›ì•„ë“¤ì´ëŠ” ë§ˆìŒì´ ë³´ì—¬. ê·¸ê²Œ ì§„ì§œ ìš©ê¸°ì•¼.",
                            hope: "í¬ë§ì˜ ë¹›ì´ ë³´ì´ê¸° ì‹œìž‘í–ˆì–´. ê·¸ ì‹œê°„ì€ ëë‚¬ì–´.",
                            general: "ê·¸ í•œë§ˆë””ê°€ ë©ˆì¶°ìžˆë˜ ì‹œê°„ì„ ë‹¤ì‹œ íë¥´ê²Œ ë§Œë“¤ì—ˆì–´."
                        },
                        en: {
                            compassion: "Those words were really needed. You should have heard them back then. I'm glad you said them now.",
                            encouragement: "Now it's time to move. That pause was preparation, and now is the moment to begin.",
                            understanding: "How important it is for someone to understand you from that time... You did it.",
                            forgiveness: "Forgiveness is the beginning of healing. Both you from then and you now are precious.",
                            healing: "I feel the heart of healing. Those wounds will slowly heal now too.",
                            gratitude: "Being able to express gratitude is proof that your heart has opened again.",
                            acceptance: "I see your accepting heart. That's real courage.",
                            hope: "The light of hope is beginning to show. That time is over.",
                            general: "Those words made the stopped time flow again."
                        },
                        pt: {
                            compassion: "Essas palavras eram realmente necessÃ¡rias. VocÃª deveria ter ouvido isso naquela Ã©poca. Fico feliz que vocÃª disse agora.",
                            encouragement: "Agora Ã© hora de se mover. Essa pausa foi preparaÃ§Ã£o, e agora Ã© o momento de comeÃ§ar.",
                            understanding: "Como Ã© importante alguÃ©m entender vocÃª daquela Ã©poca... VocÃª conseguiu.",
                            forgiveness: "O perdÃ£o Ã© o inÃ­cio da cura. Tanto vocÃª de entÃ£o quanto vocÃª agora sÃ£o preciosos.",
                            healing: "Sinto o coraÃ§Ã£o da cura. Essas feridas tambÃ©m vÃ£o sarar lentamente agora.",
                            gratitude: "Ser capaz de expressar gratidÃ£o Ã© prova de que seu coraÃ§Ã£o se abriu novamente.",
                            acceptance: "Vejo seu coraÃ§Ã£o que aceita. Essa Ã© a verdadeira coragem.",
                            hope: "A luz da esperanÃ§a estÃ¡ comeÃ§ando a aparecer. Aquele tempo acabou.",
                            general: "Essas palavras fizeram o tempo parado fluir novamente."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            compassion: "ê·¸ ë§ í•œë§ˆë””ì—, ë„¤ ì•ˆì˜ ìžì±…ì´ ì²œì²œížˆ ë…¹ì•„ë“¤ê¸° ì‹œìž‘í–ˆì–´.",
                            encouragement: "ì›€ì§ìž„ì€ ì„ íƒì´ì•¼. ë„¤ê°€ ê·¸ ì„ íƒì„ í•  ì¤€ë¹„ê°€ ë˜ì—ˆêµ¬ë‚˜.",
                            understanding: "ì´í•´ë°›ëŠ”ë‹¤ëŠ” ê²ƒ, ê·¸ ë”°ëœ»í•¨ì´ ì–¼ì–´ë¶™ì€ ì‹œê°„ì„ ë…¹ì´ê³  ìžˆì–´.",
                            forgiveness: "ìš©ì„œëŠ” ê°€ìž¥ ê¹Šì€ ì¹˜ìœ ì•¼. ë„¤ê°€ ê·¸ ë¬¸ì„ ì—´ì—ˆì–´.",
                            healing: "ì¹˜ìœ ì˜ ì—ë„ˆì§€ê°€ íë¥´ê³  ìžˆì–´. ë©ˆì¶°ìžˆë˜ ê²ƒë“¤ì´ ë‹¤ì‹œ ì›€ì§ì´ê¸° ì‹œìž‘í–ˆì–´.",
                            gratitude: "ê°ì‚¬ëŠ” ì‹œê°„ì„ ë‹¤ì‹œ íë¥´ê²Œ í•˜ëŠ” ë§ˆë²•ì´ì•¼.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì€ ê°€ìž¥ ê¹Šì€ í‰í™”ì•¼. ì´ì œ ì‹œê°„ì´ ë„ˆì™€ í•¨ê»˜ í˜ëŸ¬.",
                            hope: "í¬ë§ì€ ë©ˆì¶˜ ì‹œê°„ì— ë‹¤ì‹œ ìˆ¨ì„ ë¶ˆì–´ë„£ì–´. ë„¤ê°€ ê·¸ê±¸ í•´ëƒˆì–´.",
                            general: "ë„¤ê°€ ë„¤ ìžì‹ ê³¼ ëŒ€í™”í•œ ìˆœê°„, ì‹œê°„ì€ ë‹¤ì‹œ íë¥´ê¸° ì‹œìž‘í–ˆì–´."
                        },
                        en: {
                            compassion: "With those words, the self-blame inside you began to slowly melt away.",
                            encouragement: "Movement is a choice. You're ready to make that choice.",
                            understanding: "Being understood, that warmth is melting the frozen time.",
                            forgiveness: "Forgiveness is the deepest healing. You opened that door.",
                            healing: "Healing energy is flowing. Things that were stopped have begun to move again.",
                            gratitude: "Gratitude is magic that makes time flow again.",
                            acceptance: "Acceptance is the deepest peace. Now time flows with you.",
                            hope: "Hope breathes life back into stopped time. You did that.",
                            general: "The moment you talked to yourself, time began to flow again."
                        },
                        pt: {
                            compassion: "Com essas palavras, a auto-culpa dentro de vocÃª comeÃ§ou a derreter lentamente.",
                            encouragement: "Movimento Ã© uma escolha. VocÃª estÃ¡ pronto para fazer essa escolha.",
                            understanding: "Ser compreendido, esse calor estÃ¡ derretendo o tempo congelado.",
                            forgiveness: "O perdÃ£o Ã© a cura mais profunda. VocÃª abriu essa porta.",
                            healing: "A energia de cura estÃ¡ fluindo. Coisas que estavam paradas comeÃ§aram a se mover novamente.",
                            gratitude: "A gratidÃ£o Ã© mÃ¡gica que faz o tempo fluir novamente.",
                            acceptance: "A aceitaÃ§Ã£o Ã© a paz mais profunda. Agora o tempo flui com vocÃª.",
                            hope: "A esperanÃ§a respira vida de volta ao tempo parado. VocÃª fez isso.",
                            general: "No momento em que vocÃª conversou consigo mesmo, o tempo comeÃ§ou a fluir novamente."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            compassion: "ê·¸ ë§ì€ ë„¤ ì•ˆì˜ ìƒ‰ì„ ë‹¤ì‹œ ë¬¼ë“¤ì˜€ì–´. ë©ˆì¶° ìžˆë˜ ê·¸ë¦¼ì´, ì´ì œ ë‹¤ì‹œ ê·¸ë ¤ì§€ê¸° ì‹œìž‘í–ˆì–´.",
                            encouragement: "ì›€ì§ìž„ì˜ ìƒ‰ì€ ë°ì€ í™©ê¸ˆë¹›ì´ì•¼. ë„¤ ìº”ë²„ìŠ¤ì— ìƒˆë¡œìš´ ì„ ì´ ê·¸ì–´ì§€ê³  ìžˆì–´.",
                            understanding: "ì´í•´ì˜ ìƒ‰ì€ ë”°ëœ»í•œ ì˜¤ë Œì§€ì•¼. ê·¸ ìƒ‰ì´ ì–¼ì–´ë¶™ì€ ë¶€ë¶„ì„ ë…¹ì´ê³  ìžˆì–´.",
                            forgiveness: "ìš©ì„œì˜ ìƒ‰ì€ ë¶€ë“œëŸ¬ìš´ ì—°ë¶„í™ì´ì•¼. ìƒì²˜ë¥¼ ë®ì–´ì£¼ëŠ” ì¹˜ìœ ì˜ ìƒ‰.",
                            healing: "ì¹˜ìœ ì˜ ìƒ‰ì€ ì—°í•œ ì´ˆë¡ì´ì•¼. ìƒëª…ë ¥ì´ ë‹¤ì‹œ ìŠ¤ë©°ë“¤ê³  ìžˆì–´.",
                            gratitude: "ê°ì‚¬ì˜ ìƒ‰ì€ ë”°ëœ»í•œ ë…¸ëž‘ì´ì•¼. ë§ˆìŒì— í–‡ì‚´ì´ ë“¤ì–´ì˜¨ ê±°ì•¼.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì˜ ìƒ‰ì€ ê³ ìš”í•œ ì²­ë¡ìƒ‰ì´ì•¼. í‰ì˜¨í•¨ì´ ë²ˆì§€ê³  ìžˆì–´.",
                            hope: "í¬ë§ì˜ ìƒ‰ì€ ë°ì€ í•˜ëŠ˜ìƒ‰ì´ì•¼. ë¬´í•œí•œ ê°€ëŠ¥ì„±ì˜ ìƒ‰.",
                            general: "ê·¸ ë§ë¡œ ë„¤ ì•ˆì˜ ë©ˆì¶°ìžˆë˜ ìƒ‰ë“¤ì´ ë‹¤ì‹œ íë¥´ê¸° ì‹œìž‘í–ˆì–´."
                        },
                        en: {
                            compassion: "Those words colored your inside again. The stopped painting has begun to be drawn again.",
                            encouragement: "The color of movement is bright golden. New lines are being drawn on your canvas.",
                            understanding: "The color of understanding is warm orange. That color is melting the frozen parts.",
                            forgiveness: "The color of forgiveness is soft light pink. The healing color that covers wounds.",
                            healing: "The color of healing is light green. Life force is seeping in again.",
                            gratitude: "The color of gratitude is warm yellow. Sunlight has entered your heart.",
                            acceptance: "The color of acceptance is calm teal. Tranquility is spreading.",
                            hope: "The color of hope is bright sky blue. The color of infinite possibilities.",
                            general: "With those words, the stopped colors inside you began to flow again."
                        },
                        pt: {
                            compassion: "Essas palavras coloriram seu interior novamente. A pintura parada comeÃ§ou a ser desenhada novamente.",
                            encouragement: "A cor do movimento Ã© dourado brilhante. Novas linhas estÃ£o sendo desenhadas na sua tela.",
                            understanding: "A cor da compreensÃ£o Ã© laranja quente. Essa cor estÃ¡ derretendo as partes congeladas.",
                            forgiveness: "A cor do perdÃ£o Ã© rosa claro suave. A cor de cura que cobre feridas.",
                            healing: "A cor da cura Ã© verde claro. A forÃ§a vital estÃ¡ penetrando novamente.",
                            gratitude: "A cor da gratidÃ£o Ã© amarelo quente. A luz do sol entrou no seu coraÃ§Ã£o.",
                            acceptance: "A cor da aceitaÃ§Ã£o Ã© azul-petrÃ³leo calmo. A tranquilidade estÃ¡ se espalhando.",
                            hope: "A cor da esperanÃ§a Ã© azul cÃ©u brilhante. A cor de possibilidades infinitas.",
                            general: "Com essas palavras, as cores paradas dentro de vocÃª comeÃ§aram a fluir novamente."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 12ê°€ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 12 will be ready soon!' :
                    'Portal 12 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 11ì„ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 11?' :
                    'Deseja reiniciar o Portal 11?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-11",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-11",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 11 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 11 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>