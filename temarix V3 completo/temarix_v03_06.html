<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 06: Looking Back at Shadows</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 06: Looking Back at Shadows</div>
            <div class="portal-subtitle" id="portalSubtitle">Emotions You Couldn't Face Become Visible in Time</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸ•¯ Portal 06 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 07</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Tell me what you want to say to that shadow now that you're looking back... (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 06: ë˜ëŒì•„ë³´ëŠ” ê·¸ë¦¼ìž",
                portalSubtitle: "ì‹œê°„ì´ íë¥¸ ë’¤ì—ì•¼ ë³´ì´ëŠ” ê°ì •ì´ ìžˆì–´ìš”",
                portalIntro: "ðŸ•¯ ì‹œê°„ì´ íë¥¸ ë’¤ì—ì•¼ ë³´ì´ëŠ” ê°ì •ì´ ìžˆì–´ìš”.\n\në‹¹ì‹ ì´ ëŒì•„ë³´ì§€ ëª»í•œ ì±„ ì§€ë‚˜ì³¤ë˜ ê·¸ë¦¼ìžë“¤,\nê·¸ë•ŒëŠ” ë³„ì¼ ì•„ë‹ˆë¼ê³  ìƒê°í–ˆë˜ ìˆœê°„ë“¤ì´\nì§€ê¸ˆ ëŒì•„ë³´ë‹ˆ ì–¼ë§ˆë‚˜ í° ìƒì²˜ì˜€ëŠ”ì§€ ê¹¨ë‹«ê²Œ ë˜ëŠ” ë•Œê°€ ìžˆì£ .\n\në¬´ì‹œí–ˆë˜ ê°ì •, ì™¸ë©´í–ˆë˜ ë§ˆìŒ, ë²„ë ¤ë‘ì—ˆë˜ ê¸°ì–µë“¤ì´\nì„¸ì›”ì´ ì§€ë‚˜ê³ ì„œì•¼ ê·¸ ì§„ì§œ ëª¨ìŠµì„ ë“œëŸ¬ë‚´ê¸° ì‹œìž‘í•©ë‹ˆë‹¤.\n\n\"ê·¸ë•Œ ë‚œ ì •ë§ íž˜ë“¤ì—ˆêµ¬ë‚˜.\"\n\"ê·¸ ìˆœê°„ ë‚´ê°€ ì–¼ë§ˆë‚˜ ì™¸ë¡œì› ëŠ”ì§€ ì´ì œì•¼ ì•Œê² ì–´.\"\n\nê·¸ ê·¸ë¦¼ìž ì†ì— ìˆ¨ì–´ìžˆë˜ ê°ì •ë“¤ì„ ì´ì œëŠ” ë§ˆì£¼í•´ë„ ê´œì°®ìŠµë‹ˆë‹¤.",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ê·¸ë¦¼ìžë„ ë¹›ì´ ìžˆì–´ì•¼ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤. ë‹¹ì‹ ì´ ì™¸ë©´í–ˆë˜ ê°ì •ë„ ê²°êµ­ì€ ë‹¹ì‹ ì˜ ì¼ë¶€ì˜€ìœ¼ë‹ˆê¹Œìš”.",
                portalQuestion: "ðŸ•¯ ê·¸ ê·¸ë¦¼ìžë¥¼ ì œëŒ€ë¡œ ë°”ë¼ë³¸ ì§€ê¸ˆ, ë‹¹ì‹ ì€ ê·¸ ê°ì •ì—ê²Œ ì–´ë–¤ ë§ì„ í•´ì£¼ê³  ì‹¶ë‚˜ìš”?",
                finalTitle: "ðŸ•¯ Portal 06 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ìš©ê¸° ìžˆê²Œ ê³¼ê±°ì˜ ê·¸ë¦¼ìžë¥¼ ë§ˆì£¼í–ˆìŠµë‹ˆë‹¤.\n\nì™¸ë©´í–ˆë˜ ê°ì •ì—ê²Œ ì†ì„ ë‚´ë°€ê³ \nìˆ¨ê²¨ë‘ì—ˆë˜ ìƒì²˜ë¥¼ ì¸ì •í•˜ëŠ” ê²ƒì€\nì‰½ì§€ ì•Šì€ ì¼ì´ì—ˆì„ ê²ƒìž…ë‹ˆë‹¤.\n\ní•˜ì§€ë§Œ ì´ì œ ê·¸ ê·¸ë¦¼ìžë“¤ì´\në‹¹ì‹ ì„ ëŒê³  ê°€ì§€ ì•Šì„ ê²ƒìž…ë‹ˆë‹¤.\n\në‹¤ìŒ Portalì—ì„œëŠ” íƒ€ì¸ì˜ ì‹œì„  ì†ì—ì„œ\nìžƒì–´ë²„ë¦° ìžì‹ ì„ ì°¾ì•„ê°€ëŠ” ì—¬ì •ì´ ì´ì–´ì§‘ë‹ˆë‹¤.",
                continueBtn: "Portal 07ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ê·¸ ê·¸ë¦¼ìžë¥¼ ë˜ëŒì•„ë³¸ ì§€ê¸ˆ, ì–´ë–¤ ë§ì„ í•´ì£¼ê³  ì‹¶ì€ì§€ ë§í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 06: Looking Back at Shadows",
                portalSubtitle: "Emotions You Couldn't Face Become Visible in Time",
                portalIntro: "ðŸ•¯ There are emotions that become visible only after time has passed.\n\nThe shadows you passed by without looking back,\nmoments you thought were nothing at the time,\nbut now you realize how much they actually hurt.\n\nIgnored emotions, avoided feelings, abandoned memories\nbegin to reveal their true form only after years have gone by.\n\n\"I was really struggling back then.\"\n\"Now I understand how lonely I was in that moment.\"\n\nIt's okay now to face the emotions that were hiding in those shadows.",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Shadows can only be created when there is light. The emotions you turned away from were also part of you.",
                portalQuestion: "ðŸ•¯ Now that you're properly looking at that shadow, what do you want to say to that emotion?",
                finalTitle: "ðŸ•¯ Portal 06 Complete",
                finalMessage: "You have courageously faced the shadows of your past.\n\nReaching out to emotions you turned away from\nand acknowledging hidden wounds\nwas not an easy thing to do.\n\nBut now those shadows\nwill no longer drag you along.\n\nIn the next Portal, a journey continues\nto find yourself lost in the gaze of others.",
                continueBtn: "Move to Portal 07",
                restartBtn: "Start Again",
                inputPlaceholder: "Tell me what you want to say to that shadow now that you're looking back... (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 06: Olhando para as Sombras",
                portalSubtitle: "EmoÃ§Ãµes que NÃ£o Conseguiu Enfrentar Se Tornam VisÃ­veis com o Tempo",
                portalIntro: "ðŸ•¯ HÃ¡ emoÃ§Ãµes que se tornam visÃ­veis apenas depois que o tempo passou.\n\nAs sombras pelas quais vocÃª passou sem olhar para trÃ¡s,\nmomentos que vocÃª pensou que nÃ£o eram nada na Ã©poca,\nmas agora percebe o quanto realmente doeram.\n\nEmoÃ§Ãµes ignoradas, sentimentos evitados, memÃ³rias abandonadas\ncomeÃ§am a revelar sua verdadeira forma apenas depois que anos se passaram.\n\n\"Eu estava realmente lutando naquela Ã©poca.\"\n\"Agora entendo o quÃ£o sozinho eu estava naquele momento.\"\n\nEstÃ¡ tudo bem agora enfrentar as emoÃ§Ãµes que estavam se escondendo nessas sombras.",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Sombras sÃ³ podem ser criadas quando hÃ¡ luz. As emoÃ§Ãµes das quais vocÃª se afastou tambÃ©m eram parte de vocÃª.",
                portalQuestion: "ðŸ•¯ Agora que estÃ¡ olhando adequadamente para essa sombra, o que quer dizer a essa emoÃ§Ã£o?",
                finalTitle: "ðŸ•¯ Portal 06 Completo",
                finalMessage: "VocÃª corajosamente enfrentou as sombras do seu passado.\n\nEstender a mÃ£o para emoÃ§Ãµes das quais se afastou\ne reconhecer feridas escondidas\nnÃ£o foi uma coisa fÃ¡cil de fazer.\n\nMas agora essas sombras\nnÃ£o vÃ£o mais te arrastar junto.\n\nNo prÃ³ximo Portal, uma jornada continua\npara encontrar a si mesmo perdido no olhar dos outros.",
                continueBtn: "Ir para Portal 07",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "Me diga o que quer dizer a essa sombra agora que estÃ¡ olhando para trÃ¡s... (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ì–´ë–¤ ê·¸ë¦¼ìžëŠ” ì‹œê°„ì´ ì§€ë‚œ ë’¤ì—ì•¼ í˜•ì²´ë¥¼ ë“œëŸ¬ë‚´ì§€. ë„ˆëŠ” ì´ì œì•¼ ê·¸ê²ƒì„ ë³¸ ê±°ì•¼.",
                en: "Some shadows only reveal their form after time has passed. You're seeing it now for the first time.",
                pt: "Algumas sombras sÃ³ revelam sua forma depois que o tempo passou. VocÃª estÃ¡ vendo isso agora pela primeira vez."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "í˜ëŸ¬ê°„ ìˆœê°„ì—ë„ ê°ì •ì€ ë‚¨ì•„ìžˆì–´. ë„Œ ì´ì œ ê·¸ ìž”í–¥ì„ ëŠë¼ëŠ” ì¤‘ì´ì•¼.",
                en: "Even in moments that have passed, emotions remain. You're feeling those echoes now.",
                pt: "Mesmo em momentos que passaram, as emoÃ§Ãµes permanecem. VocÃª estÃ¡ sentindo esses ecos agora."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ê·¸ë•Œ ë§í•˜ì§€ ëª»í•œ ìŠ¬í””ì´, ì§€ê¸ˆ ê·¸ë¦¼ìžê°€ ë˜ì–´ ë„ ë’¤ì—ì„œ ëŒê³  ìžˆì—ˆê² ì§€.",
                en: "The sadness you couldn't express then has become a shadow pulling you from behind.",
                pt: "A tristeza que vocÃª nÃ£o conseguiu expressar entÃ£o se tornou uma sombra te puxando por trÃ¡s."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ê¸°ì–µì€ ìžŠížˆì§€ ì•Šì•„. ë‹¨ì§€ ìž ë“¤ì–´ ìžˆì—ˆì„ ë¿. ë˜ëŒì•„ë³¸ë‹¤ëŠ” ê±´ ê¹¨ìš°ëŠ” ì¼ì´ì•¼.",
                en: "Memories don't disappear. They were just sleeping. Looking back is the act of awakening them.",
                pt: "MemÃ³rias nÃ£o desaparecem. Elas estavam apenas dormindo. Olhar para trÃ¡s Ã© o ato de despertÃ¡-las."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ìž¥ë©´ì„ ë‹¤ì‹œ ê·¸ë¦¬ë©´, ë„¤ ëˆˆì— ì–´ë–¤ ìƒ‰ì´ ë²ˆì§ˆê¹Œ? ìŠ¬í””ì¼ê¹Œ, í›„íšŒì¼ê¹Œ, ì•„ë‹ˆë©´ ìš©ê¸°?",
                en: "If you were to paint that scene again, what color would spread in your eyes? Sadness, regret, or perhaps courage?",
                pt: "Se vocÃª fosse pintar essa cena novamente, que cor se espalharia em seus olhos? Tristeza, arrependimento, ou talvez coragem?"
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ë„Œ ê·¸ ìˆœê°„ì„ ì´ê²¨ë‚¸ ê²Œ ì•„ë‹ˆì•¼. ê·¸ëƒ¥ ì˜†ìœ¼ë¡œ ë°€ì–´ë‘” ê±°ì˜€ì§€. ì§€ê¸ˆ ë§ˆì£¼í•˜ê³  ìžˆìž–ì•„.",
                en: "You didn't overcome that moment. You just pushed it aside. Now you're facing it.",
                pt: "VocÃª nÃ£o superou aquele momento. VocÃª apenas o empurrou para o lado. Agora vocÃª estÃ¡ enfrentando."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ë˜ëŒì•„ë³´ëŠ” ê±´ ë˜ëŒì•„ê°€ìžëŠ” ê²Œ ì•„ë‹ˆì•¼. ë©€ì–´ì¡Œë‹¤ê³  ì‚¬ë¼ì§„ ê±´ ì•„ë‹ˆë‹ˆê¹Œ.",
                en: "Looking back doesn't mean going back. Just because it's distant doesn't mean it's gone.",
                pt: "Olhar para trÃ¡s nÃ£o significa voltar. SÃ³ porque estÃ¡ distante nÃ£o significa que se foi."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ì§€ê¸ˆì˜ ë„¤ê°€ ê³¼ê±°ì˜ ë„ˆë¥¼ ê»´ì•ˆì„ ìˆ˜ ìžˆë‹¤ë©´, ê·¸ ê·¸ë¦¼ìžë„ ë¹›ìœ¼ë¡œ ë…¹ì„ ìˆ˜ ìžˆì–´.",
                en: "If the present you can embrace the past you, that shadow can also melt into light.",
                pt: "Se o vocÃª presente pode abraÃ§ar o vocÃª passado, essa sombra tambÃ©m pode se derreter em luz."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                regret: ['regret', 'sorry', 'wish', 'should have'],
                understanding: ['understand', 'realize', 'see', 'know'],
                pain: ['hurt', 'pain', 'suffering', 'ache'],
                forgiveness: ['forgive', 'sorry', 'apologize', 'pardon'],
                acceptance: ['accept', 'okay', 'fine', 'peace'],
                love: ['love', 'care', 'cherish', 'embrace'],
                sadness: ['sad', 'cry', 'tears', 'lonely'],
                comfort: ['comfort', 'hug', 'hold', 'safe'],
                strength: ['strong', 'brave', 'courage', 'survive'],
                healing: ['heal', 'better', 'recover', 'mend']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Ely", emoji: "ðŸ§â€â™€ï¸",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            regret: "ì´ì œì„œì•¼ ë§í•´ì¤€ ê·¸ ì§„ì‹¬, ë„ˆë¬´ ëŠ¦ì€ ê²Œ ì•„ë‹ˆì•¼. ê°ì •ì€ ê¸°ë‹¤ë¦´ ì¤„ ì•Œì•„.",
                            understanding: "ê¹¨ë‹¬ìŒì€ ë•Œë¥¼ ê°€ë¦¬ì§€ ì•Šì•„. ì§€ê¸ˆ ê¹¨ë‹¬ì•˜ë‹¤ëŠ” ê²ƒ ìžì²´ê°€ ì†Œì¤‘í•œ ì„ ë¬¼ì´ì•¼.",
                            pain: "ê·¸ ì•„í””ì„ ì¸ì •í•´ì¤˜ì„œ ê³ ë§ˆì›Œ. ë¬´ì‹œë‹¹í–ˆë˜ ê°ì •ì´ ë“œë””ì–´ ëª©ì†Œë¦¬ë¥¼ ì°¾ì•˜ë„¤.",
                            general: "ì´ì œì„œì•¼ ë§í•´ì¤€ ê·¸ ì§„ì‹¬, ë„ˆë¬´ ëŠ¦ì€ ê²Œ ì•„ë‹ˆì•¼. ê°ì •ì€ ê¸°ë‹¤ë¦´ ì¤„ ì•Œì•„."
                        },
                        en: {
                            regret: "The sincerity you've finally expressed isn't too late. Emotions know how to wait.",
                            understanding: "Realization doesn't choose its time. The fact that you've realized it now is itself a precious gift.",
                            pain: "Thank you for acknowledging that pain. The ignored emotion has finally found its voice.",
                            general: "The sincerity you've finally expressed isn't too late. Emotions know how to wait."
                        },
                        pt: {
                            regret: "A sinceridade que vocÃª finalmente expressou nÃ£o Ã© tarde demais. As emoÃ§Ãµes sabem como esperar.",
                            understanding: "A percepÃ§Ã£o nÃ£o escolhe seu tempo. O fato de vocÃª ter percebido agora Ã© em si um presente precioso.",
                            pain: "Obrigado por reconhecer essa dor. A emoÃ§Ã£o ignorada finalmente encontrou sua voz.",
                            general: "A sinceridade que vocÃª finalmente expressou nÃ£o Ã© tarde demais. As emoÃ§Ãµes sabem como esperar."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Kael", emoji: "ðŸ§™",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            forgiveness: "ìš©ì„œëŠ” ê³¼ê±°ë¥¼ ë°”ê¾¸ëŠ” ê²Œ ì•„ë‹ˆë¼, ë¯¸ëž˜ë¥¼ ìžìœ ë¡­ê²Œ ë§Œë“œëŠ” ë§ˆë²•ì´ì•¼.",
                            acceptance: "ë°›ì•„ë“¤ì¸ë‹¤ëŠ” ê±´ í¬ê¸°ê°€ ì•„ë‹ˆì•¼. ì§„ì§œ íž˜ì„ ì°¾ëŠ” ì²«ê±¸ìŒì´ì§€.",
                            strength: "ë„¤ê°€ ìŠ¤ìŠ¤ë¡œë¥¼ ë¬´ì‹œí–ˆë˜ ê·¸ ìˆœê°„ì¡°ì°¨, ê²°êµ­ì€ ë„ˆë¥¼ ì§€í‚¤ê¸° ìœ„í•œ ì„ íƒì´ì—ˆì„ì§€ë„ ëª°ë¼.",
                            general: "ë„¤ê°€ ìŠ¤ìŠ¤ë¡œë¥¼ ë¬´ì‹œí–ˆë˜ ê·¸ ìˆœê°„ì¡°ì°¨, ê²°êµ­ì€ ë„ˆë¥¼ ì§€í‚¤ê¸° ìœ„í•œ ì„ íƒì´ì—ˆì„ì§€ë„ ëª°ë¼."
                        },
                        en: {
                            forgiveness: "Forgiveness isn't about changing the past, it's magic that frees the future.",
                            acceptance: "Accepting doesn't mean giving up. It's the first step to finding real strength.",
                            strength: "Even the moment when you ignored yourself might have been a choice to protect yourself.",
                            general: "Even the moment when you ignored yourself might have been a choice to protect yourself."
                        },
                        pt: {
                            forgiveness: "O perdÃ£o nÃ£o Ã© sobre mudar o passado, Ã© magia que liberta o futuro.",
                            acceptance: "Aceitar nÃ£o significa desistir. Ã‰ o primeiro passo para encontrar a forÃ§a real.",
                            strength: "Mesmo o momento em que vocÃª se ignorou pode ter sido uma escolha para se proteger.",
                            general: "Mesmo o momento em que vocÃª se ignorou pode ter sido uma escolha para se proteger."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            love: "ê·¸ ì‚¬ëž‘ì˜ ë§ˆìŒì´ ì‹œê°„ì„ ë„˜ì–´ ì „í•´ì¡Œì–´. ê³¼ê±°ì˜ ë„ˆë„ ëŠë¼ê³  ìžˆì„ ê±°ì•¼.",
                            comfort: "ì§€ê¸ˆì˜ ë„ˆëŠ” ê·¸ ê°ì •ì—ê²Œ ì†ì„ ë‚´ë°€ì—ˆì–´. ê·¸ê²ƒì´ë©´ ì¶©ë¶„í•´.",
                            healing: "ì¹˜ìœ ëŠ” ìƒì²˜ë¥¼ ì—†ì• ëŠ” ê²Œ ì•„ë‹ˆë¼, ìƒì²˜ì™€ í•¨ê»˜ ì‚´ì•„ê°€ëŠ” ë°©ë²•ì„ ë°°ìš°ëŠ” ê±°ì•¼.",
                            general: "ì§€ê¸ˆì˜ ë„ˆëŠ” ê·¸ ê°ì •ì—ê²Œ ì†ì„ ë‚´ë°€ì—ˆì–´. ê·¸ê²ƒì´ë©´ ì¶©ë¶„í•´."
                        },
                        en: {
                            love: "That loving heart has been conveyed across time. Your past self can feel it too.",
                            comfort: "The present you has reached out to that emotion. That's enough.",
                            healing: "Healing isn't about erasing wounds, it's about learning to live with them.",
                            general: "The present you has reached out to that emotion. That's enough."
                        },
                        pt: {
                            love: "Esse coraÃ§Ã£o amoroso foi transmitido atravÃ©s do tempo. Seu eu passado tambÃ©m pode sentir isso.",
                            comfort: "O vocÃª presente estendeu a mÃ£o para essa emoÃ§Ã£o. Isso Ã© suficiente.",
                            healing: "A cura nÃ£o Ã© sobre apagar feridas, Ã© sobre aprender a viver com elas.",
                            general: "O vocÃª presente estendeu a mÃ£o para essa emoÃ§Ã£o. Isso Ã© suficiente."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 07ì´ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 07 will be ready soon!' :
                    'Portal 07 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 06ì„ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 06?' :
                    'Deseja reiniciar o Portal 06?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-06",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-06",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 06 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 06 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>