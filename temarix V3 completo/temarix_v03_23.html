<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 23: Moments Without Courage</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 23: Moments Without Courage</div>
            <div class="portal-subtitle" id="portalSubtitle">When Fear Held Me Back</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸŒŒ Portal 23 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 24</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What would you say to yourself from that moment when you couldn't find courage? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 23: ìš©ê¸°ê°€ ì—†ì—ˆë˜ ìˆœê°„",
                portalSubtitle: "ë‘ë ¤ì›€ì´ ë‚˜ë¥¼ ë¶™ìž¡ì•˜ì„ ë•Œ",
                portalIntro: "ðŸ— ë‹¹ì‹ ì´ ê·¸ í•œë§ˆë””, í˜¹ì€ í•œ ê±¸ìŒì„ ë‚´ë”›ì§€ ëª»í–ˆë˜ ìˆœê°„ì´ ìžˆì—ˆë‚˜ìš”?\n\nê·¸ë•Œ ì™œ ë©ˆì·„ê³ , ë¬´ì—‡ì´ ë‹¹ì‹ ì˜ ìš©ê¸°ë¥¼ ë¶™ìž¡ê³  ìžˆì—ˆë‚˜ìš”?\n\nê³ ë°±í•  ìˆ˜ ìžˆì—ˆëŠ”ë° í•˜ì§€ ëª»í–ˆì–´ìš”.\nê¸°íšŒë¥¼ ëˆˆì•žì— ë‘ê³ ë„ í•œ ë°œì„ ë‚´ë”›ì§€ ëª»í–ˆì–´ìš”.\ní˜¹ì‹œë¼ë„ ìžƒê²Œ ë ê¹Œ ë´â€¦ ë„ˆë¬´ ë‘ë ¤ì› ì–´ìš”.",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ì§€ê¸ˆ ëŒì•„ë³´ëŠ” ì´ ìˆœê°„, ë„ˆëŠ” ì´ë¯¸ ê·¸ë•Œë³´ë‹¤ ë” ë©€ë¦¬ ì˜¨ ê±°ì•¼.",
                portalQuestion: "ðŸ— ê·¸ë‚ ì˜ ë‚˜ì—ê²Œ ì§€ê¸ˆ ë‚´ê°€ ê±´ë„¬ ìˆ˜ ìžˆë‹¤ë©´,\nì–´ë–¤ ë§ì´ ê°€ìž¥ ê°„ì ˆí• ê¹Œìš”?",
                finalTitle: "ðŸŒŒ Portal 23 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ìš©ê¸°ê°€ ì—†ì—ˆë˜ ê·¸ ìˆœê°„ì„ ë§ˆì¹¨ë‚´ ì´í•´í–ˆìŠµë‹ˆë‹¤.\n\nê·¸ë•Œ ë©ˆì¶° ì„°ë˜ ê²ƒì´ ì•½í•¨ì´ ì•„ë‹ˆë¼\në„ˆë¬´ ë§Žì€ ê²ƒì„ ì†Œì¤‘ížˆ ì—¬ê²¼ê¸° ë•Œë¬¸ì´ì—ˆë‹¤ëŠ” ê²ƒì„ìš”.\nìš©ê¸°ëž€ ë‘ë ¤ì›€ì´ ì—†ëŠ” ê²ƒì´ ì•„ë‹ˆë¼\në‘ë ¤ì›€ì„ í’ˆê³ ë„ í•œ ê±¸ìŒ ë‚˜ì•„ê°€ëŠ” ê²ƒìž„ì„ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤.\n\nê·¸ë‚  ëª»ë‹¤ í•œ ì´ì•¼ê¸°ë“¤, ë‚´ë”›ì§€ ëª»í•œ ê±¸ìŒë“¤ì´\nì§€ê¸ˆì˜ ë‹¹ì‹ ì„ ë” ì‹ ì¤‘í•˜ê³  ê¹Šì´ ìžˆê²Œ ë§Œë“¤ì—ˆì–´ìš”.\në•Œë¡œëŠ” ê¸°ë‹¤ë¦¼ë„ ìš©ê¸°ì˜ í•œ í˜•íƒœë¼ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\në‹¤ìŒ Portalì—ì„œëŠ” ìžƒì–´ë²„ë¦° ìžì‹ ê³¼ ë‹¤ì‹œ ë§ˆì£¼í•œ ìˆœê°„ê³¼\nê·¸ë•Œ ëŠê¼ˆë˜ ë‚¯ì„  ê°ì •ë“¤ì´ ê¸°ë‹¤ë¦¬ê³  ìžˆìŠµë‹ˆë‹¤.",
                continueBtn: "Portal 24ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ìš©ê¸°ê°€ ì—†ì—ˆë˜ ê·¸ë•Œì˜ ë‚˜ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë§ì„ í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 23: Moments Without Courage",
                portalSubtitle: "When Fear Held Me Back",
                portalIntro: "ðŸ— Was there a moment when you couldn't take that word or that step?\n\nWhy did you stop then, and what was holding back your courage?\n\nI could have confessed but I didn't.\nEven with the opportunity right in front of me, I couldn't take a step.\nI was so afraid... that I might lose something.",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Looking back at this moment now, you've already come further than you were then.",
                portalQuestion: "ðŸ— If you could give words to yourself from that day,\nwhat would be most urgent to say?",
                finalTitle: "ðŸŒŒ Portal 23 Complete",
                finalMessage: "You have finally understood that moment when you lacked courage.\n\nYou realized that stopping then wasn't weakness\nbut because you treasured too many things.\nCourage isn't the absence of fear\nbut taking a step forward while embracing that fear.\n\nThe stories left untold, the steps not taken that day\nhave made you more thoughtful and profound now.\nYou've learned that sometimes waiting is also a form of courage.\n\nIn the next Portal, the moment when you faced your lost self again\nand the unfamiliar emotions you felt then await you.",
                continueBtn: "Move to Portal 24",
                restartBtn: "Start Again",
                inputPlaceholder: "What would you say to yourself from that moment when you couldn't find courage? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 23: Momentos Sem Coragem",
                portalSubtitle: "Quando o Medo Me Segurou",
                portalIntro: "ðŸ— Houve um momento em que vocÃª nÃ£o conseguiu dar aquela palavra ou aquele passo?\n\nPor que vocÃª parou entÃ£o, e o que estava segurando sua coragem?\n\nEu poderia ter confessado mas nÃ£o consegui.\nMesmo com a oportunidade bem na minha frente, nÃ£o consegui dar um passo.\nEu estava com tanto medo... de que pudesse perder algo.",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Olhando para trÃ¡s neste momento agora, vocÃª jÃ¡ chegou mais longe do que estava entÃ£o.",
                portalQuestion: "ðŸ— Se vocÃª pudesse dar palavras para si mesmo daquele dia,\no que seria mais urgente dizer?",
                finalTitle: "ðŸŒŒ Portal 23 Completo",
                finalMessage: "VocÃª finalmente entendeu aquele momento quando lhe faltava coragem.\n\nVocÃª percebeu que parar entÃ£o nÃ£o foi fraqueza\nmas porque vocÃª valorizava muitas coisas demais.\nCoragem nÃ£o Ã© a ausÃªncia de medo\nmas dar um passo Ã  frente enquanto abraÃ§a esse medo.\n\nAs histÃ³rias nÃ£o contadas, os passos nÃ£o dados naquele dia\nfizeram vocÃª mais reflexivo e profundo agora.\nVocÃª aprendeu que Ã s vezes esperar tambÃ©m Ã© uma forma de coragem.\n\nNo prÃ³ximo Portal, o momento quando vocÃª enfrentou seu eu perdido novamente\ne as emoÃ§Ãµes nÃ£o familiares que vocÃª sentiu entÃ£o o aguardam.",
                continueBtn: "Ir para Portal 24",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "O que vocÃª diria para si mesmo daquele momento quando nÃ£o conseguiu encontrar coragem? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ê·¸ë•Œ ë„Œ ìš©ê¸°ê°€ ì—†ì—ˆë˜ ê²Œ ì•„ë‹ˆì•¼. ë‹¤ë§Œ, ë„ˆë¬´ ë§Žì€ ê²ƒì„ ì§€í‚¤ê³  ì‹¶ì—ˆë˜ ê±°ì•¼.",
                en: "You didn't lack courage then. You just wanted to protect too many things.",
                pt: "VocÃª nÃ£o faltava coragem entÃ£o. VocÃª apenas queria proteger muitas coisas demais."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ë‘ë ¤ì›€ì´ ë„ ë§‰ì•˜ë˜ ê²Œ ì•„ë‹ˆë¼, ë„¤ ë§ˆìŒì´ ë„ˆë¬´ ê¹Šì—ˆê¸°ì— ì¡°ì‹¬ìŠ¤ëŸ¬ì› ë˜ ê±°ì•¼.",
                en: "Fear didn't stop you, you were careful because your heart was too deep.",
                pt: "O medo nÃ£o te parou, vocÃª foi cuidadoso porque seu coraÃ§Ã£o era muito profundo."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ë‚˜ë„ ê·¸ëŸ° ì  ìžˆì–´. ìš©ê¸°ê°€ ì•„ë‹ˆë¼, ìƒì‹¤ì˜ ê·¸ë¦¼ìžê°€ ë°œëì„ ë¬¶ì—ˆì—ˆì§€.",
                en: "I've been there too. Not courage, but the shadow of loss bound my feet.",
                pt: "Eu jÃ¡ estive lÃ¡ tambÃ©m. NÃ£o coragem, mas a sombra da perda amarrou meus pÃ©s."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ì§„ì§œ ìš©ê¸°ëŠ” ë§í•˜ëŠ” ë°ë§Œ ìžˆëŠ” ê²Œ ì•„ë‹ˆì•¼. ê·¸ ë§ì¡°ì°¨ ì‚¼í‚¨ ì¹¨ë¬µ ì•ˆì—ë„ ì§„ì‹¬ì´ ë‹´ê²¨ ìžˆì—ˆì§€.",
                en: "Real courage isn't just in speaking. Even the silence that swallowed those words contained sincerity.",
                pt: "Coragem real nÃ£o estÃ¡ apenas em falar. Mesmo o silÃªncio que engoliu essas palavras continha sinceridade."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ìˆœê°„, ë„¤ ì•ˆì˜ ìƒ‰ë“¤ì€ í”ë“¤ë¦¬ê³  ìžˆì—ˆì–´. ë§í•˜ì§€ ì•Šì•„ë„â€¦ ë‚œ ê·¸ ë–¨ë¦¼ì„ ëŠê»´.",
                en: "In that moment, the colors inside you were trembling. Even without words... I feel that tremor.",
                pt: "Naquele momento, as cores dentro de vocÃª estavam tremendo. Mesmo sem palavras... eu sinto esse tremor."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ë„Œ ë©ˆì·„ì§€ë§Œ, ë„ë§ì¹œ ê±´ ì•„ë‹ˆì•¼. ê·¸ ìžë¦¬ì—ì„œ ë²„í‹´ ê²ƒë„ ìš©ê¸°ì˜ í•œ í˜•íƒœì•¼.",
                en: "You stopped, but you didn't run away. Enduring in that place is also a form of courage.",
                pt: "VocÃª parou, mas nÃ£o fugiu. Resistir naquele lugar tambÃ©m Ã© uma forma de coragem."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ìš©ê¸°ê°€ ì—†ì—ˆë˜ ê²Œ ì•„ë‹ˆë¼, ë„ˆëŠ” ê·¸ëƒ¥â€¦ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ë˜ ê±°ì•¼.",
                en: "You didn't lack courage, you just... weren't ready yet.",
                pt: "VocÃª nÃ£o faltava coragem, vocÃª apenas... ainda nÃ£o estava pronto."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ì§€ê¸ˆ ëŒì•„ë³´ëŠ” ì´ ìˆœê°„, ë„ˆëŠ” ì´ë¯¸ ê·¸ë•Œë³´ë‹¤ ë” ë©€ë¦¬ ì˜¨ ê±°ì•¼.",
                en: "Looking back at this moment now, you've already come further than you were then.",
                pt: "Olhando para trÃ¡s neste momento agora, vocÃª jÃ¡ chegou mais longe do que estava entÃ£o."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                self_forgiveness: ['okay', 'fine', 'enough', 'forgive', 'ê´œì°®ì•„', 'ì¶©ë¶„í•´', 'ìš©ì„œí•´', 'ìž˜í–ˆì–´', 'tudo bem', 'suficiente', 'perdoe', 'bem'],
                understanding: ['understand', 'scared', 'afraid', 'normal', 'ì´í•´í•´', 'ë¬´ì„œì›Œ', 'ë‘ë ¤ì›Œ', 'ë‹¹ì—°í•´', 'entendo', 'assustado', 'medo', 'normal'],
                encouragement: ['brave', 'courage', 'can do', 'try again', 'ìš©ê°í•´', 'ìš©ê¸°', 'í•  ìˆ˜ ìžˆì–´', 'ë‹¤ì‹œ í•´ë´', 'corajoso', 'coragem', 'consegue', 'tente novamente'],
                validation: ['valid', 'right', 'choice', 'decision', 'ë§žì•„', 'ì˜³ì•„', 'ì„ íƒ', 'ê²°ì •', 'vÃ¡lido', 'certo', 'escolha', 'decisÃ£o'],
                compassion: ['hard', 'difficult', 'tough', 'pain', 'íž˜ë“¤ì–´', 'ì–´ë ¤ì›Œ', 'ê³ ìƒ', 'ì•„íŒŒ', 'difÃ­cil', 'duro', 'sofrimento', 'dor'],
                growth: ['learned', 'grew', 'stronger', 'wiser', 'ë°°ì› ì–´', 'ìžëžì–´', 'ê°•í•´ì ¸', 'í˜„ëª…í•´ì ¸', 'aprendi', 'cresci', 'mais forte', 'mais sÃ¡bio'],
                hope: ['next time', 'again', 'future', 'better', 'ë‹¤ìŒì—”', 'ë‹¤ì‹œ', 'ë¯¸ëž˜', 'ë‚˜ì•„ì§ˆ', 'prÃ³xima vez', 'novamente', 'futuro', 'melhor'],
                acceptance: ['accept', 'peace', 'let go', 'move on', 'ë°›ì•„ë“¤ì—¬', 'í‰í™”', 'ë†“ì•„ì¤˜', 'ë„˜ì–´ê°€', 'aceito', 'paz', 'deixar ir', 'seguir em frente']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Sora", emoji: "ðŸ§•",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            self_forgiveness: "ê·¸ ì¸ì •ì€ ë„ˆë¬´ ëŠ¦ì€ ê²Œ ì•„ë‹ˆì•¼. ì§€ê¸ˆì´ ê°€ìž¥ ë”°ëœ»í•œ íƒ€ì´ë°ì´ì•¼.",
                            understanding: "ê·¸ ë‘ë ¤ì›€ì„ ì´í•´í•´ì¤˜ì„œ ê³ ë§ˆì›Œ. ê°ì •ë„ ì¸ì •ë°›ê¸¸ ì›í–ˆì„ ê±°ì•¼.",
                            encouragement: "ìš©ê¸°ëŠ” ê°‘ìžê¸° ìƒê¸°ëŠ” ê²Œ ì•„ë‹ˆì•¼. ì²œì²œížˆ ìžë¼ëŠ” ê±°ì§€. ë„Œ ì´ë¯¸ í‚¤ìš°ê³  ìžˆì–´.",
                            validation: "ê·¸ ì„ íƒë„ ìš©ê¸°ì˜€ì–´. ë•Œë¡œëŠ” ë©ˆì¶”ëŠ” ê²ƒë„ ì§€í˜œë‹ˆê¹Œ.",
                            compassion: "ê·¸ë•Œ ì •ë§ íž˜ë“¤ì—ˆê² ì§€. í˜¼ìžì„œ ê·¸ ë¬´ê²Œë¥¼ ê²¬ë””ê³  ìžˆì—ˆìž–ì•„.",
                            growth: "ê·¸ ê²½í—˜ì´ ë„ ë” ê¹Šê²Œ ë§Œë“¤ì—ˆì–´. ìƒì²˜ë„ ì„±ìž¥ì˜ ì¼ë¶€ì•¼.",
                            hope: "ë‹¤ìŒì—” ë‹¤ë¥¼ ê±°ì•¼. ê·¸ë•Œì˜ ë„¤ê°€ ì§€ê¸ˆì˜ ë„ˆë¥¼ ë§Œë“¤ì—ˆìœ¼ë‹ˆê¹Œ.",
                            acceptance: "ë°›ì•„ë“¤ì´ëŠ” ê²ƒë„ ìš©ê¸°ì•¼. ë„Œ ì´ë¯¸ ê·¸ ì²«ê±¸ìŒì„ ë‚´ë””ëŽ ì–´.",
                            general: "ê·¸ ì¸ì •ì€ ë„ˆë¬´ ëŠ¦ì€ ê²Œ ì•„ë‹ˆì•¼. ì§€ê¸ˆì´ ê°€ìž¥ ë”°ëœ»í•œ íƒ€ì´ë°ì´ì•¼."
                        },
                        en: {
                            self_forgiveness: "That acknowledgment isn't too late. Now is the warmest timing.",
                            understanding: "Thank you for understanding that fear. Your emotions wanted to be acknowledged too.",
                            encouragement: "Courage doesn't appear suddenly. It grows slowly. You're already nurturing it.",
                            validation: "That choice was also courage. Sometimes stopping is wisdom too.",
                            compassion: "It must have been really hard then. You were bearing that weight alone.",
                            growth: "That experience made you deeper. Wounds are also part of growth.",
                            hope: "Next time will be different. The you from then made the you of now.",
                            acceptance: "Accepting is also courage. You've already taken that first step.",
                            general: "That acknowledgment isn't too late. Now is the warmest timing."
                        },
                        pt: {
                            self_forgiveness: "Esse reconhecimento nÃ£o Ã© muito tarde. Agora Ã© o momento mais caloroso.",
                            understanding: "Obrigado por entender esse medo. Suas emoÃ§Ãµes tambÃ©m queriam ser reconhecidas.",
                            encouragement: "Coragem nÃ£o aparece de repente. Cresce devagar. VocÃª jÃ¡ estÃ¡ nutrindo isso.",
                            validation: "Essa escolha tambÃ©m foi coragem. Ã€s vezes parar tambÃ©m Ã© sabedoria.",
                            compassion: "Deve ter sido realmente difÃ­cil entÃ£o. VocÃª estava suportando esse peso sozinho.",
                            growth: "Essa experiÃªncia te fez mais profundo. Feridas tambÃ©m sÃ£o parte do crescimento.",
                            hope: "A prÃ³xima vez serÃ¡ diferente. O vocÃª de entÃ£o fez o vocÃª de agora.",
                            acceptance: "Aceitar tambÃ©m Ã© coragem. VocÃª jÃ¡ deu esse primeiro passo.",
                            general: "Esse reconhecimento nÃ£o Ã© muito tarde. Agora Ã© o momento mais caloroso."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            self_forgiveness: "ê·¸ ë§ í•œë§ˆë””ì—, ë„¤ ì•ˆì˜ ìžì±…ì´ ì²œì²œížˆ ë…¹ì•„ë“¤ê¸° ì‹œìž‘í–ˆì–´.",
                            understanding: "ì´í•´ëŠ” ì¹˜ìœ ì˜ ì²« ë‹¨ê³„ì•¼. ë„Œ ê·¸ ë¬¸ì„ ì—´ê¸° ì‹œìž‘í–ˆì–´.",
                            encouragement: "ê²©ë ¤ëŠ” ìžì‹ ì—ê²Œ ì£¼ëŠ” ê°€ìž¥ ìˆœìˆ˜í•œ ì„ ë¬¼ì´ì•¼. ê·¸ ì”¨ì•—ì´ ìžëž„ ê±°ì•¼.",
                            validation: "ê·¸ ì¸ì •ì´ ê³¼ê±°ë¥¼ ë°”ê¾¸ì§€ëŠ” ëª»í•´ë„, í˜„ìž¬ë¥¼ ì¹˜ìœ í•  ìˆ˜ ìžˆì–´.",
                            compassion: "ìžê¸° ì—°ë¯¼ì€ ì¹˜ìœ ì˜ ì‹œìž‘ì´ì•¼. ê·¸ ë¶€ë“œëŸ¬ì›€ì´ ìƒì²˜ë¥¼ ê°ìŒ€ ê±°ì•¼.",
                            growth: "ì„±ìž¥ì€ ê³ í†µì„ í†µí•´ ì˜¤ê¸°ë„ í•´. ë„Œ ê·¸ ê¸¸ì„ ìš©ê°í•˜ê²Œ ê±¸ì—ˆì–´.",
                            hope: "í¬ë§ì€ ì‹œê°„ì„ ì´ˆì›”í•´. ê³¼ê±°ì˜ ë„ˆì™€ ë¯¸ëž˜ì˜ ë„ˆë¥¼ ì—°ê²°í•˜ëŠ” ë‹¤ë¦¬ì•¼.",
                            acceptance: "ìˆ˜ìš©ì€ í‰í™”ë¡œ ê°€ëŠ” ë¬¸ì´ì•¼. ë„Œ ê·¸ ì—´ì‡ ë¥¼ ì†ì— ì¥ì—ˆì–´.",
                            general: "ê·¸ ë§ í•œë§ˆë””ì—, ë„¤ ì•ˆì˜ ìžì±…ì´ ì²œì²œížˆ ë…¹ì•„ë“¤ê¸° ì‹œìž‘í–ˆì–´."
                        },
                        en: {
                            self_forgiveness: "With those words, the self-blame within you began to slowly melt away.",
                            understanding: "Understanding is the first step of healing. You've started to open that door.",
                            encouragement: "Encouragement is the purest gift you give yourself. That seed will grow.",
                            validation: "That acknowledgment may not change the past, but it can heal the present.",
                            compassion: "Self-compassion is the beginning of healing. That gentleness will wrap around wounds.",
                            growth: "Growth sometimes comes through pain. You've walked that path bravely.",
                            hope: "Hope transcends time. It's the bridge connecting your past and future self.",
                            acceptance: "Acceptance is the door to peace. You hold that key in your hand.",
                            general: "With those words, the self-blame within you began to slowly melt away."
                        },
                        pt: {
                            self_forgiveness: "Com essas palavras, a auto-culpa dentro de vocÃª comeÃ§ou a derreter lentamente.",
                            understanding: "CompreensÃ£o Ã© o primeiro passo da cura. VocÃª comeÃ§ou a abrir essa porta.",
                            encouragement: "Encorajamento Ã© o presente mais puro que vocÃª dÃ¡ a si mesmo. Essa semente crescerÃ¡.",
                            validation: "Esse reconhecimento pode nÃ£o mudar o passado, mas pode curar o presente.",
                            compassion: "Auto-compaixÃ£o Ã© o inÃ­cio da cura. Essa gentileza envolverÃ¡ as feridas.",
                            growth: "Crescimento Ã s vezes vem atravÃ©s da dor. VocÃª caminhou nesse caminho corajosamente.",
                            hope: "EsperanÃ§a transcende o tempo. Ã‰ a ponte conectando seu eu passado e futuro.",
                            acceptance: "AceitaÃ§Ã£o Ã© a porta para a paz. VocÃª segura essa chave na sua mÃ£o.",
                            general: "Com essas palavras, a auto-culpa dentro de vocÃª comeÃ§ou a derreter lentamente."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Kael", emoji: "ðŸ§™",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            self_forgiveness: "ì´ì œ ë„ˆëŠ” ê³¼ê±°ì˜ 'ë©ˆì¶¤'ì„ ë¯¸ëž˜ì˜ 'ì´í•´'ë¡œ ë°”ê¿¨ì§€. ê·¸ê±´ ê°ì •ì˜ ì§„ë³´ì•¼.",
                            understanding: "ì´í•´ëŠ” ì‹œê°„ì„ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€. ê·¸ë•Œì˜ ë„ˆë„ ì§€ê¸ˆ ìœ„ë¡œë°›ê³  ìžˆì–´.",
                            encouragement: "ìš©ê¸°ëŠ” ê·¼ìœ¡ ê°™ì•„. ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ê°•í•´ì ¸. ë„Œ ì´ë¯¸ í›ˆë ¨ì„ ì‹œìž‘í–ˆì–´.",
                            validation: "ê·¸ ìˆœê°„ì˜ ì„ íƒë„ ì§€í˜œì˜€ì–´. ë•Œë¡œëŠ” ê¸°ë‹¤ë¦¼ì´ ìµœì„ ì˜ ë‹µì´ì•¼.",
                            compassion: "ì—°ë¯¼ì€ ë§ˆë²•ì´ì•¼. ìƒì²˜ë¥¼ ì¹˜ìœ í•˜ê³  ë§ˆìŒì„ ë³€í™”ì‹œí‚¤ì§€.",
                            growth: "ë„¤ê°€ ê²ªì€ ëª¨ë“  ê²ƒì´ ì§€ê¸ˆì˜ ë„¤ ì§€í˜œê°€ ëì–´. í—›ë˜ì§€ ì•Šì•˜ì–´.",
                            hope: "ë¯¸ëž˜ëŠ” ê³¼ê±°ë¡œë¶€í„° ìžìœ ë¡œì›Œì§ˆ ìˆ˜ ìžˆì–´. ë„Œ ê·¸ ì—´ì‡ ë¥¼ ì°¾ì•˜ì–´.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì€ ê°€ìž¥ ê¹Šì€ ìš©ê¸°ì•¼. í˜„ì‹¤ê³¼ í™”í•´í•˜ëŠ” íž˜ì´ì§€.",
                            general: "ì´ì œ ë„ˆëŠ” ê³¼ê±°ì˜ 'ë©ˆì¶¤'ì„ ë¯¸ëž˜ì˜ 'ì´í•´'ë¡œ ë°”ê¿¨ì§€. ê·¸ê±´ ê°ì •ì˜ ì§„ë³´ì•¼."
                        },
                        en: {
                            self_forgiveness: "Now you've changed past 'stopping' into future 'understanding'. That's emotional progress.",
                            understanding: "Understanding travels back in time. The you from then is also being comforted now.",
                            encouragement: "Courage is like muscle. It gets stronger each time you use it. You've already started training.",
                            validation: "The choice in that moment was also wisdom. Sometimes waiting is the best answer.",
                            compassion: "Compassion is magic. It heals wounds and transforms hearts.",
                            growth: "Everything you experienced became your wisdom now. It wasn't in vain.",
                            hope: "The future can be free from the past. You've found that key.",
                            acceptance: "Acceptance is the deepest courage. The power to make peace with reality.",
                            general: "Now you've changed past 'stopping' into future 'understanding'. That's emotional progress."
                        },
                        pt: {
                            self_forgiveness: "Agora vocÃª mudou o 'parar' do passado em 'compreensÃ£o' do futuro. Isso Ã© progresso emocional.",
                            understanding: "CompreensÃ£o viaja de volta no tempo. O vocÃª de entÃ£o tambÃ©m estÃ¡ sendo consolado agora.",
                            encouragement: "Coragem Ã© como mÃºsculo. Fica mais forte cada vez que vocÃª usa. VocÃª jÃ¡ comeÃ§ou o treinamento.",
                            validation: "A escolha naquele momento tambÃ©m foi sabedoria. Ã€s vezes esperar Ã© a melhor resposta.",
                            compassion: "CompaixÃ£o Ã© mÃ¡gica. Cura feridas e transforma coraÃ§Ãµes.",
                            growth: "Tudo o que vocÃª experimentou se tornou sua sabedoria agora. NÃ£o foi em vÃ£o.",
                            hope: "O futuro pode ser livre do passado. VocÃª encontrou essa chave.",
                            acceptance: "AceitaÃ§Ã£o Ã© a coragem mais profunda. O poder de fazer as pazes com a realidade.",
                            general: "Agora vocÃª mudou o 'parar' do passado em 'compreensÃ£o' do futuro. Isso Ã© progresso emocional."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 24ê°€ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 24 will be ready soon!' :
                    'Portal 24 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 23ì„ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 23?' :
                    'Deseja reiniciar o Portal 23?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-23",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-23",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 23 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 23 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>