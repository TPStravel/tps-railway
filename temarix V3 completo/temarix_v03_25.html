<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 25: Final Sentence</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 25: Final Sentence</div>
            <div class="portal-subtitle" id="portalSubtitle">The One Sentence I Finally Expressed</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸ”“ Portal 25 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Complete V3 Journey</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What is the one sentence you finally want to express? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 25: ë§ˆì¹¨ë‚´ êº¼ë‚¸ í•œ ë¬¸ìž¥",
                portalSubtitle: "ë‚´ê°€ ë§ˆì¹¨ë‚´ í‘œí˜„í•œ í•œ ë¬¸ìž¥",
                portalIntro: "ðŸ”“ ì—¬ê¸°ê¹Œì§€ ì˜¨ ë‹¹ì‹ ,\nì§€ê¸ˆ ì´ ìˆœê°„ ê°€ìž¥ êº¼ë‚´ê³  ì‹¶ì€ 'í•œ ë¬¸ìž¥'ì´ ìžˆë‹¤ë©´ ë¬´ì—‡ì¸ê°€ìš”?\n\nê·¸ ë¬¸ìž¥ì€ ëˆ„êµ¬ë¥¼ í–¥í•˜ê³  ìžˆë‚˜ìš”?\n\në‚˜í•œí…Œ í•˜ê³  ì‹¶ì€ ë§ì´ì—ìš”.\n'ë„ˆ, ìž˜ ì‚´ì•„ëƒˆì–´. ì •ë§ë¡œ.'\nê·¸ í•œë§ˆë””ë¥¼ ì´ì œëŠ” ì¸ì •í•´ì£¼ê³  ì‹¶ì–´ìš”.",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ê·¸ í•œ ë¬¸ìž¥ì€ ì¹¨ë¬µê³¼ ìš¸ìŒ, ë¶„ë…¸ì™€ ì‚¬ëž‘ì„ ëª¨ë‘ ì•ˆê³  ìžëž€ ì”¨ì•—ì´ì•¼. ì§€ê¸ˆ í”¼ì–´ë‚œ ê±°ì•¼.",
                portalQuestion: "ðŸ”“ ì´ì œ, ì´ ëª¨ë“  ì—¬ì •ì„ ë§ˆì¹œ ë‹¹ì‹ ì—ê²Œ\nì–´ë–¤ 'ì„ ì–¸'ì„ ë‚¨ê¸°ê³  ì‹¶ë‚˜ìš”?",
                finalTitle: "ðŸ”“ Portal 25 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ë§ˆì¹¨ë‚´ ê°€ìž¥ ì¤‘ìš”í•œ í•œ ë¬¸ìž¥ì„ êº¼ëƒˆìŠµë‹ˆë‹¤.\n\nê·¸ ë¬¸ìž¥ ì•ˆì—ëŠ” 25ê°œì˜ Portalì„ ì§€ë‚˜ì˜¤ë©°\në§ˆì£¼í–ˆë˜ ëª¨ë“  ê°ì •ì˜ ë¬´ê²Œì™€ ê¹Šì´ê°€ ë‹´ê²¨ ìžˆì—ˆìŠµë‹ˆë‹¤.\nì¹¨ë¬µê³¼ ìš¸ìŒ, ë¶„ë…¸ì™€ ì‚¬ëž‘, ìƒì‹¤ê³¼ ìž¬íšŒâ€¦\nëª¨ë“  ê²ƒì„ í’ˆê³  ìžëž€ ì§„ì‹¤ì˜ ì”¨ì•—ì´ ë§ˆì¹¨ë‚´ ê½ƒì„ í”¼ì› ì–´ìš”.\n\nì´ì œ ë‹¹ì‹ ì€ ìžì‹ ì˜ ê°ì •ì—ê²Œ ì£¼ë¬¸ì„ ë¶€ì—¬í–ˆìŠµë‹ˆë‹¤.\nì„¸ìƒê³¼ í•˜ê¸° ì „ì—, ìžì‹ ê³¼ í•œ ì•½ì†ì„ ì„¸ì› ìŠµë‹ˆë‹¤.\nì§„ì‹¤ì˜ ë–¨ë¦¼ì„ ìžì‹ ì´ ë§Œë“  ì§„ë™ìœ¼ë¡œ ë°”ê¾¸ê¸° ì‹œìž‘í–ˆì–´ìš”.\n\nðŸŒŸ Temarix V3 ê°ì •ì˜ ìš©ê´‘ë¡œ ì—¬ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\në‹¹ì‹ ì˜ ê°ì •ì€ ì´ì œ ìƒˆë¡œìš´ í˜•íƒœë¡œ ë‹¤ì‹œ íƒœì–´ë‚¬ìŠµë‹ˆë‹¤.\në‹¤ìŒ ì—¬ì •ì—ì„œëŠ” ë” ê¹Šì€ ë‚´ë©´ì˜ ê·¸ë¦¼ìžì™€\nìˆ¨ê²¨ì§„ ê¸°ì–µë“¤ì´ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦¬ê³  ìžˆì„ ê²ƒìž…ë‹ˆë‹¤.\n\nì¶•í•˜í•©ë‹ˆë‹¤. ë‹¹ì‹ ì€ ì§„ì •í•œ ê°ì •ì˜ ì—°ê¸ˆìˆ ì‚¬ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.",
                continueBtn: "V3 ì—¬ì • ì™„ë£Œ",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ë§ˆì¹¨ë‚´ êº¼ë‚´ê³  ì‹¶ì€ í•œ ë¬¸ìž¥ì€ ë¬´ì—‡ì¸ê°€ìš”? (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 25: Final Sentence",
                portalSubtitle: "The One Sentence I Finally Expressed",
                portalIntro: "ðŸ”“ You who have come this far,\nif there's one sentence you most want to express at this moment, what would it be?\n\nWho is that sentence directed toward?\n\nIt's something I want to say to myself.\n'You lived well. Really.'\nI want to acknowledge that one phrase now.",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "That one sentence is a seed that grew embracing silence and tears, anger and love. It has now bloomed.",
                portalQuestion: "ðŸ”“ Now, having completed this entire journey,\nwhat 'declaration' do you want to leave for yourself?",
                finalTitle: "ðŸ”“ Portal 25 Complete",
                finalMessage: "You have finally expressed the most important sentence.\n\nWithin that sentence lies the weight and depth\nof all the emotions you encountered through 25 Portals.\nSilence and tears, anger and love, loss and reunion...\nThe seed of truth that grew embracing everything has finally bloomed.\n\nNow you have cast a spell upon your emotions.\nYou made a promise with yourself before making one with the world.\nYou began to transform the trembling of truth into vibrations of your own making.\n\nðŸŒŸ Your Temarix V3 Emotional Furnace journey is complete.\nYour emotions have now been reborn in a new form.\nIn the next journey, deeper inner shadows\nand hidden memories will be waiting for you.\n\nCongratulations. You have become a true emotional alchemist.",
                continueBtn: "Complete V3 Journey",
                restartBtn: "Start Again",
                inputPlaceholder: "What is the one sentence you finally want to express? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 25: Frase Final",
                portalSubtitle: "A Ãšnica Frase Que Finalmente Expressei",
                portalIntro: "ðŸ”“ VocÃª que chegou atÃ© aqui,\nse hÃ¡ uma frase que vocÃª mais quer expressar neste momento, qual seria?\n\nPara quem essa frase Ã© direcionada?\n\nÃ‰ algo que quero dizer para mim mesmo.\n'VocÃª viveu bem. Realmente.'\nQuero reconhecer essa frase agora.",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Essa Ãºnica frase Ã© uma semente que cresceu abraÃ§ando silÃªncio e lÃ¡grimas, raiva e amor. Agora floresceu.",
                portalQuestion: "ðŸ”“ Agora, tendo completado toda esta jornada,\nque 'declaraÃ§Ã£o' vocÃª quer deixar para si mesmo?",
                finalTitle: "ðŸ”“ Portal 25 Completo",
                finalMessage: "VocÃª finalmente expressou a frase mais importante.\n\nDentro dessa frase estÃ¡ o peso e a profundidade\nde todas as emoÃ§Ãµes que vocÃª encontrou atravÃ©s de 25 Portais.\nSilÃªncio e lÃ¡grimas, raiva e amor, perda e reencontro...\nA semente da verdade que cresceu abraÃ§ando tudo finalmente floresceu.\n\nAgora vocÃª lanÃ§ou um feitiÃ§o sobre suas emoÃ§Ãµes.\nVocÃª fez uma promessa consigo mesmo antes de fazer uma com o mundo.\nVocÃª comeÃ§ou a transformar o tremor da verdade em vibraÃ§Ãµes de sua prÃ³pria criaÃ§Ã£o.\n\nðŸŒŸ Sua jornada Temarix V3 Fornalha Emocional estÃ¡ completa.\nSuas emoÃ§Ãµes agora renasceram em uma nova forma.\nNa prÃ³xima jornada, sombras internas mais profundas\ne memÃ³rias escondidas estarÃ£o esperando por vocÃª.\n\nParabÃ©ns. VocÃª se tornou um verdadeiro alquimista emocional.",
                continueBtn: "Completar Jornada V3",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "Qual Ã© a Ãºnica frase que vocÃª finalmente quer expressar? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ê·¸ ë¬¸ìž¥ì„ ë„¤ ìž…ìœ¼ë¡œ êº¼ëƒˆë‹¤ëŠ” ê±´ ì´ì œ ë„ˆ ìžì‹ ì„ ë¯¿ëŠ”ë‹¤ëŠ” ì¦ê±°ì•¼.",
                en: "The fact that you spoke that sentence means you now believe in yourself.",
                pt: "O fato de vocÃª ter falado essa frase significa que agora acredita em si mesmo."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ê·¸ ë§ í•œë§ˆë””ê°€ ë„ˆì˜ ê¸´ ì—¬ì •ì„ ê°ì‹¸ ì•ˆì•˜ì–´. ì§„ì‹¬ì€ ê°€ìž¥ ë§ˆì§€ë§‰ì— í”¼ì–´ë‚˜ëŠ” ê½ƒì´ì•¼.",
                en: "That one phrase embraced your long journey. Sincerity is the flower that blooms last.",
                pt: "Essa Ãºnica frase abraÃ§ou sua longa jornada. A sinceridade Ã© a flor que floresce por Ãºltimo."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ê·¸ í•œ ë¬¸ìž¥, ê¸°ë‹¤ë¦¼ì˜ ëì—ì„œ íƒœì–´ë‚œ ê³ ë°±ì´ì—ˆê² ì§€.",
                en: "That one sentence, it must have been a confession born at the end of waiting.",
                pt: "Essa Ãºnica frase, deve ter sido uma confissÃ£o nascida no fim da espera."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "í•œ ë¬¸ìž¥ìœ¼ë¡œ ëª¨ë“  ê²ƒì„ ë§í•  ìˆ˜ ì—†ì§€ë§Œ, ê·¸ ì§„ì‹¤ì€ ìš¸ë¦¼ìœ¼ë¡œ ë‚¨ì§€.",
                en: "One sentence cannot say everything, but that truth remains as resonance.",
                pt: "Uma frase nÃ£o pode dizer tudo, mas essa verdade permanece como ressonÃ¢ncia."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ë¬¸ìž¥ì€ ë„ˆì˜ ìƒ‰ìœ¼ë¡œ ê°€ë“í–ˆì–´. ì˜¤ëž˜ ê¸°ë‹¤ë ¤ì˜¨ ë„ˆë§Œì˜ ë¹›ì´ì—ˆì§€.",
                en: "That sentence was full of your colors. It was your own light you've long waited for.",
                pt: "Essa frase estava cheia de suas cores. Era sua prÃ³pria luz que vocÃª esperou por muito tempo."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ë„¤ê°€ ë„ˆë¥¼ ì¸ì •í–ˆë‹¤ë©´, ê·¸ ëˆ„êµ¬ì˜ ì¸ì •ë„ ë”ëŠ” í•„ìš” ì—†ì–´.",
                en: "If you have acknowledged yourself, you no longer need anyone else's acknowledgment.",
                pt: "Se vocÃª se reconheceu, nÃ£o precisa mais do reconhecimento de ninguÃ©m."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ì´ì œ ë„Œ ì‹œìž‘ì ì´ ì•„ë‹ˆë¼ ëì—ì„œ ë§í•˜ëŠ” ê±°ì•¼. ê·¸ë¦¬ê³  ì´ ëì€ ìƒˆë¡œìš´ ì‹œìž‘ì´ê¸°ë„ í•´.",
                en: "Now you're speaking from the end, not the beginning. And this end is also a new beginning.",
                pt: "Agora vocÃª estÃ¡ falando do fim, nÃ£o do comeÃ§o. E esse fim tambÃ©m Ã© um novo comeÃ§o."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ê·¸ í•œ ë¬¸ìž¥ì€ ì¹¨ë¬µê³¼ ìš¸ìŒ, ë¶„ë…¸ì™€ ì‚¬ëž‘ì„ ëª¨ë‘ ì•ˆê³  ìžëž€ ì”¨ì•—ì´ì•¼. ì§€ê¸ˆ í”¼ì–´ë‚œ ê±°ì•¼.",
                en: "That one sentence is a seed that grew embracing silence and tears, anger and love. It has now bloomed.",
                pt: "Essa Ãºnica frase Ã© uma semente que cresceu abraÃ§ando silÃªncio e lÃ¡grimas, raiva e amor. Agora floresceu."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                self_love: ['love myself', 'proud', 'well done', 'good job', 'ìž˜í–ˆì–´', 'ì‚¬ëž‘í•´', 'ìžëž‘', 'í›Œë¥­í•´', 'me amo', 'orgulhoso', 'bem feito', 'bom trabalho'],
                declaration: ['declare', 'promise', 'commit', 'will', 'ì„ ì–¸', 'ì•½ì†', 'ë‹¤ì§', 'ì˜ì§€', 'declaro', 'prometo', 'comprometo', 'vou'],
                gratitude: ['thank', 'grateful', 'appreciate', 'ê³ ë§ˆì›Œ', 'ê°ì‚¬', 'ê³ ë§™', 'obrigado', 'grato', 'agradeÃ§o'],
                courage: ['brave', 'courage', 'strong', 'face', 'ìš©ê¸°', 'ìš©ê°', 'ê°•í•´', 'ë§ˆì£¼í•´', 'corajoso', 'coragem', 'forte', 'enfrentar'],
                freedom: ['free', 'liberate', 'release', 'let go', 'ìžìœ ', 'í•´ë°©', 'ë†“ì•„', 'ìžìœ ë¡­', 'livre', 'liberar', 'soltar'],
                truth: ['truth', 'honest', 'real', 'authentic', 'ì§„ì‹¤', 'ì •ì§', 'ì§„ì§œ', 'ì§„ì‹¬', 'verdade', 'honesto', 'real', 'autÃªntico'],
                future: ['future', 'forward', 'new', 'begin', 'ë¯¸ëž˜', 'ì•žìœ¼ë¡œ', 'ìƒˆë¡œ', 'ì‹œìž‘', 'futuro', 'Ã  frente', 'novo', 'comeÃ§ar'],
                acceptance: ['accept', 'embrace', 'understand', 'forgive', 'ë°›ì•„ë“¤ì—¬', 'ì•ˆì•„ì¤˜', 'ì´í•´í•´', 'ìš©ì„œí•´', 'aceitar', 'abraÃ§ar', 'entender', 'perdoar']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Kael", emoji: "ðŸ§™",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            self_love: "ê·¸ ì„ ì–¸ì€ ì£¼ë¬¸ì´ ë˜ì—ˆì–´. ì´ì œ ë„ˆëŠ” ìžì‹ ì—ê²Œ ë§ˆë²•ì„ ë¶€ì—¬í•œ ê±°ì•¼.",
                            declaration: "ê·¸ ë‹¤ì§ì€ ì„¸ìƒê³¼ í•˜ê¸° ì „ì—, ë„ˆì™€ í•œ ì•½ì†ì´ì•¼. ê°€ìž¥ ì‹ ì„±í•œ ì„œì•½ì´ì§€.",
                            gratitude: "ê°ì‚¬ëŠ” ëª¨ë“  ê°ì •ì˜ ì™„ì„±ì´ì•¼. ë„ˆëŠ” ì—¬ì •ì˜ ì§„ì§œ ì˜ë¯¸ë¥¼ ì°¾ì•˜ì–´.",
                            courage: "ìš©ê¸°ëŠ” ëì—ì„œ í”¼ì–´ë‚˜ëŠ” ê½ƒì´ì•¼. ì´ì œ ë„ˆëŠ” ë‘ë ¤ì›€ì˜ ì£¼ì¸ì´ ë˜ì—ˆì–´.",
                            freedom: "ìžìœ ëŠ” ê°‡í˜€ìžˆìŒì„ ì¸ì •í•  ë•Œ ì‹œìž‘ë¼. ë„ˆëŠ” ëª¨ë“  ê°ì˜¥ì—ì„œ ë²—ì–´ë‚¬ì–´.",
                            truth: "ì§„ì‹¤ì€ ê°€ìž¥ ë¬´ê±°ìš´ ê¹ƒí„¸ì´ì•¼. ê°€ë³ì§€ë§Œ ëª¨ë“  ê±°ì§“ì„ ë‚ ë ¤ë²„ë¦¬ì§€.",
                            future: "ë¯¸ëž˜ëŠ” ê³¼ê±°ë¥¼ ì´í•´í•  ë•Œ ì—´ë ¤. ë„ˆëŠ” ì‹œê°„ì˜ ë¬¸ì„ ì—´ì—ˆì–´.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì€ í•­ë³µì´ ì•„ë‹ˆë¼ ì •ë³µì´ì•¼. ë„ˆëŠ” ê°ì •ì˜ ì™•ì´ ë˜ì—ˆì–´.",
                            general: "ê·¸ ì„ ì–¸ì€ ì£¼ë¬¸ì´ ë˜ì—ˆì–´. ì´ì œ ë„ˆëŠ” ìžì‹ ì—ê²Œ ë§ˆë²•ì„ ë¶€ì—¬í•œ ê±°ì•¼."
                        },
                        en: {
                            self_love: "That declaration became a spell. Now you've cast magic upon yourself.",
                            declaration: "That commitment is a promise you made with yourself before making one with the world. The most sacred vow.",
                            gratitude: "Gratitude is the completion of all emotions. You've found the true meaning of the journey.",
                            courage: "Courage is a flower that blooms at the end. Now you've become the master of fear.",
                            freedom: "Freedom begins when you acknowledge being trapped. You've escaped from all prisons.",
                            truth: "Truth is the heaviest feather. Light, yet it blows away all lies.",
                            future: "The future opens when you understand the past. You've opened the door of time.",
                            acceptance: "Acceptance isn't surrender, it's conquest. You've become the king of emotions.",
                            general: "That declaration became a spell. Now you've cast magic upon yourself."
                        },
                        pt: {
                            self_love: "Essa declaraÃ§Ã£o se tornou um feitiÃ§o. Agora vocÃª lanÃ§ou magia sobre si mesmo.",
                            declaration: "Esse compromisso Ã© uma promessa que vocÃª fez consigo mesmo antes de fazer uma com o mundo. O voto mais sagrado.",
                            gratitude: "GratidÃ£o Ã© a completude de todas as emoÃ§Ãµes. VocÃª encontrou o verdadeiro significado da jornada.",
                            courage: "Coragem Ã© uma flor que floresce no fim. Agora vocÃª se tornou o mestre do medo.",
                            freedom: "Liberdade comeÃ§a quando vocÃª reconhece estar preso. VocÃª escapou de todas as prisÃµes.",
                            truth: "Verdade Ã© a pena mais pesada. Leve, mas sopra todas as mentiras.",
                            future: "O futuro se abre quando vocÃª entende o passado. VocÃª abriu a porta do tempo.",
                            acceptance: "AceitaÃ§Ã£o nÃ£o Ã© rendiÃ§Ã£o, Ã© conquista. VocÃª se tornou o rei das emoÃ§Ãµes.",
                            general: "Essa declaraÃ§Ã£o se tornou um feitiÃ§o. Agora vocÃª lanÃ§ou magia sobre si mesmo."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            self_love: "ê·¸ ë§ì€ ì•½ì†ì´ì•¼. ì„¸ìƒê³¼ í•˜ê¸° ì „ì—, ë„ˆì™€ í•œ ì•½ì†.",
                            declaration: "ì„ ì–¸ì€ ê¹ƒë°œì„ ì„¸ìš°ëŠ” ì¼ì´ì•¼. ì´ì œ ë„ˆëŠ” ë„¤ ì˜í† ë¥¼ ê°€ì¡Œì–´.",
                            gratitude: "ê³ ë§ˆì›€ì€ ê°€ìž¥ ìˆœìˆ˜í•œ íž˜ì´ì•¼. ê·¸ íž˜ìœ¼ë¡œ ëª¨ë“  ê±¸ ë³€í™”ì‹œí‚¬ ìˆ˜ ìžˆì–´.",
                            courage: "ìš©ê¸°ëŠ” íƒœì–´ë‚˜ëŠ” ê²Œ ì•„ë‹ˆë¼ ê¸°ë¥´ëŠ” ê±°ì•¼. ë„ˆëŠ” ê·¸ê²ƒì„ ì™„ì„±í–ˆì–´.",
                            freedom: "ìžìœ ëŠ” í—ˆë½ë°›ëŠ” ê²Œ ì•„ë‹ˆë¼ ì„ íƒí•˜ëŠ” ê±°ì•¼. ë„ˆëŠ” ê·¸ ì„ íƒì„ í–ˆì–´.",
                            truth: "ì§„ì‹¤ì€ ë¬´ê¸°ê°€ ì•„ë‹ˆë¼ ë„êµ¬ì•¼. ë„ˆëŠ” ê·¸ê±¸ í˜„ëª…í•˜ê²Œ ì‚¬ìš©í•˜ê³  ìžˆì–´.",
                            future: "ë¯¸ëž˜ëŠ” ê³¼ê±°ì˜ ì„ ë¬¼ì´ì•¼. ë„ˆëŠ” ê·¸ ì„ ë¬¼ì„ ìž˜ ë°›ì•˜ì–´.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì€ ëì´ ì•„ë‹ˆë¼ ì‹œìž‘ì´ì•¼. ë„ˆëŠ” ìƒˆë¡œìš´ ì¶œë°œì„ ì— ì„œ ìžˆì–´.",
                            general: "ê·¸ ë§ì€ ì•½ì†ì´ì•¼. ì„¸ìƒê³¼ í•˜ê¸° ì „ì—, ë„ˆì™€ í•œ ì•½ì†."
                        },
                        en: {
                            self_love: "Those words are a promise. A promise you made with yourself before making one with the world.",
                            declaration: "Declaration is planting a flag. Now you have your own territory.",
                            gratitude: "Gratitude is the purest power. With that power, you can transform everything.",
                            courage: "Courage isn't born, it's cultivated. You've perfected it.",
                            freedom: "Freedom isn't permitted, it's chosen. You've made that choice.",
                            truth: "Truth isn't a weapon, it's a tool. You're using it wisely.",
                            future: "The future is a gift from the past. You've received that gift well.",
                            acceptance: "Acceptance isn't an end, it's a beginning. You're standing at a new starting line.",
                            general: "Those words are a promise. A promise you made with yourself before making one with the world."
                        },
                        pt: {
                            self_love: "Essas palavras sÃ£o uma promessa. Uma promessa que vocÃª fez consigo mesmo antes de fazer uma com o mundo.",
                            declaration: "DeclaraÃ§Ã£o Ã© plantar uma bandeira. Agora vocÃª tem seu prÃ³prio territÃ³rio.",
                            gratitude: "GratidÃ£o Ã© o poder mais puro. Com esse poder, vocÃª pode transformar tudo.",
                            courage: "Coragem nÃ£o nasce, Ã© cultivada. VocÃª a aperfeiÃ§oou.",
                            freedom: "Liberdade nÃ£o Ã© permitida, Ã© escolhida. VocÃª fez essa escolha.",
                            truth: "Verdade nÃ£o Ã© arma, Ã© ferramenta. VocÃª estÃ¡ usando sabiamente.",
                            future: "O futuro Ã© um presente do passado. VocÃª recebeu bem esse presente.",
                            acceptance: "AceitaÃ§Ã£o nÃ£o Ã© fim, Ã© comeÃ§o. VocÃª estÃ¡ numa nova linha de partida.",
                            general: "Essas palavras sÃ£o uma promessa. Uma promessa que vocÃª fez consigo mesmo antes de fazer uma com o mundo."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            self_love: "ì´ì œ ë„ˆëŠ” ì§„ì‹¤ì˜ ë–¨ë¦¼ì„ ìžì‹ ì´ ë§Œë“  ì§„ë™ìœ¼ë¡œ ë°”ê¾¸ê¸° ì‹œìž‘í–ˆì–´.",
                            declaration: "ì„ ì–¸ì€ ì¡´ìž¬ì˜ ì¦ëª…ì´ì•¼. ë„ˆëŠ” ì´ì œ í™•ì‹¤ížˆ ì—¬ê¸°ì— ìžˆì–´.",
                            gratitude: "ê°ì‚¬ëŠ” ëª¨ë“  ë¬¸ì„ ì—¬ëŠ” ì—´ì‡ ì•¼. ë„ˆëŠ” ê·¸ ì—´ì‡ ë¥¼ ì†ì— ì¥ì—ˆì–´.",
                            courage: "ìš©ê¸°ëŠ” ë‘ë ¤ì›€ì„ ì—†ì• ëŠ” ê²Œ ì•„ë‹ˆë¼ í•¨ê»˜ ê±·ëŠ” ê±°ì•¼. ë„ˆëŠ” ë™í–‰ì„ ë°°ì› ì–´.",
                            freedom: "ìžìœ ëŠ” ì™¸ë¶€ê°€ ì•„ë‹ˆë¼ ë‚´ë¶€ì—ì„œ ì°¾ëŠ” ê±°ì•¼. ë„ˆëŠ” ê·¸ ìž¥ì†Œë¥¼ ë°œê²¬í–ˆì–´.",
                            truth: "ì§„ì‹¤ì€ ì™„ì„±ì´ ì•„ë‹ˆë¼ ê³¼ì •ì´ì•¼. ë„ˆëŠ” ê·¸ ì—¬í–‰ì„ ì‹œìž‘í–ˆì–´.",
                            future: "ë¯¸ëž˜ëŠ” ìƒìƒì´ ì•„ë‹ˆë¼ ì°½ì¡°ì•¼. ë„ˆëŠ” ì§€ê¸ˆ ë§Œë“¤ê³  ìžˆì–´.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì€ í‰í™”ì˜ ë‹¤ë¥¸ ì´ë¦„ì´ì•¼. ë„ˆëŠ” ê·¸ í‰í™”ë¥¼ ì°¾ì•˜ì–´.",
                            general: "ì´ì œ ë„ˆëŠ” ì§„ì‹¤ì˜ ë–¨ë¦¼ì„ ìžì‹ ì´ ë§Œë“  ì§„ë™ìœ¼ë¡œ ë°”ê¾¸ê¸° ì‹œìž‘í–ˆì–´."
                        },
                        en: {
                            self_love: "Now you've begun to transform the trembling of truth into vibrations of your own making.",
                            declaration: "Declaration is proof of existence. You are now definitely here.",
                            gratitude: "Gratitude is the key that opens all doors. You hold that key in your hand.",
                            courage: "Courage isn't eliminating fear, it's walking together with it. You've learned companionship.",
                            freedom: "Freedom is found not outside but inside. You've discovered that place.",
                            truth: "Truth isn't completion, it's process. You've started that journey.",
                            future: "The future isn't imagination, it's creation. You're creating it now.",
                            acceptance: "Acceptance is another name for peace. You've found that peace.",
                            general: "Now you've begun to transform the trembling of truth into vibrations of your own making."
                        },
                        pt: {
                            self_love: "Agora vocÃª comeÃ§ou a transformar o tremor da verdade em vibraÃ§Ãµes de sua prÃ³pria criaÃ§Ã£o.",
                            declaration: "DeclaraÃ§Ã£o Ã© prova de existÃªncia. VocÃª estÃ¡ definitivamente aqui agora.",
                            gratitude: "GratidÃ£o Ã© a chave que abre todas as portas. VocÃª segura essa chave na sua mÃ£o.",
                            courage: "Coragem nÃ£o Ã© eliminar o medo, Ã© caminhar junto com ele. VocÃª aprendeu companheirismo.",
                            freedom: "Liberdade Ã© encontrada nÃ£o fora, mas dentro. VocÃª descobriu esse lugar.",
                            truth: "Verdade nÃ£o Ã© completude, Ã© processo. VocÃª comeÃ§ou essa jornada.",
                            future: "O futuro nÃ£o Ã© imaginaÃ§Ã£o, Ã© criaÃ§Ã£o. VocÃª estÃ¡ criando agora.",
                            acceptance: "AceitaÃ§Ã£o Ã© outro nome para paz. VocÃª encontrou essa paz.",
                            general: "Agora vocÃª comeÃ§ou a transformar o tremor da verdade em vibraÃ§Ãµes de sua prÃ³pria criaÃ§Ã£o."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                // Mark V3 as complete
                localStorage.setItem('temarix_v3_complete', 'true');
                localStorage.setItem('temarix_v3_end_date', new Date().toISOString());
                
                const completeMessage = currentLanguage === 'ko' ? 
                    'Temarix V3 ê°ì •ì˜ ìš©ê´‘ë¡œ ì—¬ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n7ì¼ê°„ì˜ ê°ì • í†µí•© ê¸°ê°„ì„ ê±°ì³ V4ë¡œ ì´ë™í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.' :
                    currentLanguage === 'en' ? 
                    'Temarix V3 Emotional Furnace journey is complete!\nAfter 7 days of emotional integration, you can move to V4.' :
                    'A jornada Temarix V3 Fornalha Emocional estÃ¡ completa!\nApÃ³s 7 dias de integraÃ§Ã£o emocional, vocÃª pode ir para V4.';
                alert(completeMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 25ë¥¼ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 25?' :
                    'Deseja reiniciar o Portal 25?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-25",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-25",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 25 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 25 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>