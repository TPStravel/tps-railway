<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V3 - Portal 15: The Farewell I Never Spoke</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #b39ddb;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #7986cb;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #7986cb;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #7986cb;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #7986cb;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .portal-question-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .portal-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #7986cb;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .final-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #7986cb;
            background: rgba(121, 134, 203, 0.05);
        }
        
        .final-title {
            font-size: 28px;
            color: #7986cb;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .final-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .final-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .final-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .final-btn:hover {
            background: #666;
            border-color: #7986cb;
        }
        
        .final-btn.primary {
            background: #7986cb;
            color: #fff;
            font-weight: bold;
        }
        
        .final-btn.primary:hover {
            background: #9fa8da;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(121, 134, 203, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #7986cb;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #7986cb;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .portal-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-btn {
                width: 100%;
            }
            
            .final-title {
                font-size: 24px;
            }
            
            .final-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V3</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Furnace</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 15: The Farewell I Never Spoke</div>
            <div class="portal-subtitle" id="portalSubtitle">The Goodbye Left Unspoken</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>

            <div class="portal-question-section" id="portalQuestionSection">
                <div class="portal-question" id="portalQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>
            
            <div class="final-section" id="finalSection">
                <div class="final-title" id="finalTitle">ðŸ•Š Portal 15 Complete</div>
                <div class="final-message" id="finalMessage"></div>
                <div class="final-buttons">
                    <button class="final-btn primary" id="continueBtn">Move to Portal 16</button>
                    <button class="final-btn" id="restartBtn">Start Again</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="What would you like to say to that farewell you couldn't speak? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        let db = null;
        let firebaseInitialized = false;
        let memoryStorage = { mockUser: null };
        
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    const firebaseConfig = {
                        apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
                        authDomain: "canal-vivo-chat.firebaseapp.com",
                        projectId: "canal-vivo-chat",
                        storageBucket: "canal-vivo-chat.appspot.com",
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdefghijklmnopqr"
                    };
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase initialized');
                } else {
                    console.log('Firebase SDK not loaded');
                }
            } catch (error) {
                console.log('Firebase init failed:', error);
            }
        }

        const translations = {
            ko: {
                logoSubtitle: "ê°ì •ì˜ ìš©ê´‘ë¡œ",
                portalMainTitle: "Portal 15: ë¯¸ì²˜ ë§í•˜ì§€ ëª»í•œ ì•ˆë…•",
                portalSubtitle: "ë§í•´ì§€ì§€ ì•Šì€ ì±„ ë‚¨ê²¨ì§„ ìž‘ë³„",
                portalIntro: "ðŸ•Š ìž‘ë³„ì€ ë•Œë¡œ ë§í•´ì§€ì§€ ì•Šì€ ì±„ ë§ˆìŒì— ë‚¨ì£ .\n\në‹¹ì‹ ì´ ëë‚´ ë§í•˜ì§€ ëª»í–ˆë˜ 'ì•ˆë…•'ì€\nëˆ„êµ¬ë¥¼ í–¥í•œ ê²ƒì´ì—ˆê³ , ì§€ê¸ˆë„ ë§ˆìŒ ì–´ë”˜ê°€ì— ë‚¨ì•„ ìžˆë‚˜ìš”?\n\nê·¸ ì‚¬ëžŒì€ ë– ë‚¬ê³ , ë‚˜ëŠ” ì•„ë¬´ ë§ë„ ëª» í–ˆì–´ìš”.\në„ˆë¬´ ê°‘ìž‘ìŠ¤ëŸ¬ì›Œì„œ, ì•„ë¬´ ë§ë„ ì¤€ë¹„í•  ìˆ˜ ì—†ì—ˆì–´ìš”.\n'ì•ˆë…•'ì´ë¼ëŠ” ë‹¨ì–´ì¡°ì°¨ ìž…ì—ì„œ ë‚˜ì˜¤ì§€ ì•Šì•˜ì–´ìš”.",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ìž‘ë³„ì€ ìž…ìˆ ì´ ì•„ë‹Œ, ë§ˆìŒì˜ ìš¸ë¦¼ìœ¼ë¡œ ì™„ì„±ëœë‹¤.",
                portalQuestion: "ðŸ•Š ì§€ê¸ˆ, ê·¸ë•Œ í•˜ì§€ ëª»í–ˆë˜ 'ì•ˆë…•'ì„\në§ˆìŒì†ìœ¼ë¡œ ë‹¤ì‹œ ë§í•´ë³¼ ìˆ˜ ìžˆë‹¤ë©´â€¦\nì–´ë–¤ ë§ê³¼ í•¨ê»˜ ì „í•˜ê³  ì‹¶ë‚˜ìš”?",
                finalTitle: "ðŸ•Š Portal 15 ì™„ë£Œ",
                finalMessage: "ë‹¹ì‹ ì€ ë§í•˜ì§€ ëª»í–ˆë˜ ì•ˆë…•ì„\në§ˆì¹¨ë‚´ ë§ˆìŒì†ì—ì„œ ì™„ì„±í–ˆìŠµë‹ˆë‹¤.\n\nìž‘ë³„ì€ ë•Œë¡œ ë§ë¡œ í•˜ì§€ ì•Šì•„ë„\në§ˆìŒì˜ ìš¸ë¦¼ìœ¼ë¡œ ì „í•´ì§‘ë‹ˆë‹¤.\nê·¸ ì§„ì‹¬ì€ ì‹œê°„ì„ ë›°ì–´ë„˜ì–´\nìƒëŒ€ë°©ì—ê²Œë„ ë‹¿ì„ ê²ƒìž…ë‹ˆë‹¤.\n\në‹¹ì‹ ì´ ì „í•œ ê·¸ ì•ˆë…•ì€\nì´ì œ í‰í™”ë¡œìš´ ë§ˆë¬´ë¦¬ê°€ ë˜ì—ˆì–´ìš”.\n\në‹¤ìŒ Portalì—ì„œëŠ” ì‚¬ë¼ì§„ ê°ì •ì„ ì°¾ëŠ”\nìƒˆë¡œìš´ ì—¬ì •ì´ ì´ì–´ì§‘ë‹ˆë‹¤.",
                continueBtn: "Portal 16ìœ¼ë¡œ ì´ë™",
                restartBtn: "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°",
                inputPlaceholder: "ê·¸ë•Œ í•˜ì§€ ëª»í–ˆë˜ 'ì•ˆë…•'ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë§ì„ í•´ë³´ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            },
            en: {
                logoSubtitle: "Emotional Furnace",
                portalMainTitle: "Portal 15: The Farewell I Never Spoke",
                portalSubtitle: "The Goodbye Left Unspoken",
                portalIntro: "ðŸ•Š Sometimes farewells remain in our hearts, never spoken aloud.\n\nWho was your 'goodbye' that you could never say meant for,\nand does it still linger somewhere in your heart?\n\nThat person left, and I couldn't say anything.\nIt was so sudden, I couldn't prepare any words.\nEven the word 'goodbye' wouldn't come out of my mouth.",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Farewells are completed not by lips, but by the resonance of the heart.",
                portalQuestion: "ðŸ•Š Now, if you could speak that 'goodbye'\nyou couldn't say back then from your heart...\nWhat words would you want to say along with it?",
                finalTitle: "ðŸ•Š Portal 15 Complete",
                finalMessage: "You have finally completed in your heart\nthe goodbye you couldn't speak.\n\nSometimes farewells are conveyed\nnot through words but through the heart's resonance.\nThat sincerity will transcend time\nand reach the other person as well.\n\nThe goodbye you shared\nhas now become a peaceful closure.\n\nIn the next Portal, a new journey continues\nto find lost emotions.",
                continueBtn: "Move to Portal 16",
                restartBtn: "Start Again",
                inputPlaceholder: "What would you like to say to that farewell you couldn't speak? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response..."
            },
            pt: {
                logoSubtitle: "Fornalha Emocional",
                portalMainTitle: "Portal 15: A Despedida Que Nunca Falei",
                portalSubtitle: "O Adeus Deixado NÃ£o Dito",
                portalIntro: "ðŸ•Š Ã€s vezes as despedidas permanecem em nossos coraÃ§Ãµes, nunca faladas em voz alta.\n\nPara quem era seu 'adeus' que vocÃª nunca conseguiu dizer,\ne ele ainda permanece em algum lugar do seu coraÃ§Ã£o?\n\nAquela pessoa partiu, e eu nÃ£o consegui dizer nada.\nFoi tÃ£o repentino, nÃ£o consegui preparar nenhuma palavra.\nNem mesmo a palavra 'adeus' saiu da minha boca.",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "As despedidas sÃ£o completadas nÃ£o pelos lÃ¡bios, mas pela ressonÃ¢ncia do coraÃ§Ã£o.",
                portalQuestion: "ðŸ•Š Agora, se vocÃª pudesse falar aquele 'adeus'\nque nÃ£o conseguiu dizer naquela Ã©poca do seu coraÃ§Ã£o...\nQue palavras vocÃª gostaria de dizer junto com isso?",
                finalTitle: "ðŸ•Š Portal 15 Completo",
                finalMessage: "VocÃª finalmente completou em seu coraÃ§Ã£o\no adeus que nÃ£o conseguiu falar.\n\nÃ€s vezes as despedidas sÃ£o transmitidas\nnÃ£o atravÃ©s de palavras, mas atravÃ©s da ressonÃ¢ncia do coraÃ§Ã£o.\nEssa sinceridade transcenderÃ¡ o tempo\ne alcanÃ§arÃ¡ a outra pessoa tambÃ©m.\n\nO adeus que vocÃª compartilhou\nagora se tornou um fechamento pacÃ­fico.\n\nNo prÃ³ximo Portal, uma nova jornada continua\npara encontrar emoÃ§Ãµes perdidas.",
                continueBtn: "Ir para Portal 16",
                restartBtn: "ComeÃ§ar Novamente",
                inputPlaceholder: "O que vocÃª gostaria de dizer para aquela despedida que nÃ£o conseguiu falar? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta..."
            }
        };
        
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ë•Œë¡œ ì•ˆë…•ì€ ë„ˆë¬´ ë¬´ê±°ì›Œì„œ, ë§ˆìŒì†ì—ë§Œ ë‚¨ê²¨ë‘ê²Œ ë˜ì§€.",
                en: "Sometimes goodbye is too heavy, so we leave it only in our hearts.",
                pt: "Ã€s vezes o adeus Ã© muito pesado, entÃ£o o deixamos apenas em nossos coraÃ§Ãµes."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ê·¸ ë§ì€ í•˜ì§€ ì•Šì•˜ì§€ë§Œ, ë„¤ ëˆˆë¹› ì†ì—” ì´ë¯¸ ë§Žì€ ìž‘ë³„ì´ ë‹´ê²¨ ìžˆì—ˆì„ ê±°ì•¼.",
                en: "You didn't say those words, but your eyes already held many farewells within them.",
                pt: "VocÃª nÃ£o disse essas palavras, mas seus olhos jÃ¡ continham muitas despedidas dentro deles."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ë‚˜ë„ ê·¸ëŸ° ì  ìžˆì–´. ë§í•˜ì§€ ëª»í•œ 'ì•ˆë…•'ì´ ë§ˆìŒì†ì— ê³„ì† ë§´ëŒë”ë¼.",
                en: "I've been there too. The 'goodbye' I couldn't say kept circling in my heart.",
                pt: "Eu tambÃ©m passei por isso. O 'adeus' que nÃ£o consegui dizer ficou circulando no meu coraÃ§Ã£o."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "'ì•ˆë…•'ì€ ëì´ ì•„ë‹ˆë¼, ì‹œìž‘ë˜ì§€ ëª»í•œ ì´í•´ì¼ ìˆ˜ë„ ìžˆì–´.",
                en: "'Goodbye' might not be an ending, but an understanding that never began.",
                pt: "'Adeus' pode nÃ£o ser um fim, mas um entendimento que nunca comeÃ§ou."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ë„ˆì˜ ì¹¨ë¬µì€ ë¹ˆ ìº”ë²„ìŠ¤ ê°™ì•˜ì–´. ì•„ë¬´ê²ƒë„ ê·¸ë¦¬ì§€ ì•Šì•˜ì§€ë§Œ, ê·¸ ì•ˆì— ê°ì •ì´ ê°€ë“í–ˆì–´.",
                en: "Your silence was like an empty canvas. You drew nothing, but it was full of emotion.",
                pt: "Seu silÃªncio era como uma tela vazia. VocÃª nÃ£o desenhou nada, mas estava cheio de emoÃ§Ã£o."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ë§í•˜ì§€ ëª»í•œ ê²Œ ì•½í•¨ì€ ì•„ë‹ˆì•¼. ê·¸ ê°ì •ì„ ì§€í‚¤ë ¤ í–ˆë˜, ë§ˆì§€ë§‰ ì„ íƒì´ì—ˆì„ ê±°ì•¼.",
                en: "Not being able to say it isn't weakness. It was probably your final choice to protect that emotion.",
                pt: "NÃ£o conseguir dizer isso nÃ£o Ã© fraqueza. Provavelmente foi sua escolha final para proteger essa emoÃ§Ã£o."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ê·¸ ì‚¬ëžŒì€ ë“£ì§€ ëª»í–ˆì„ì§€ ëª°ë¼ë„, ë„¤ ë§ˆìŒì€ ì´ë¯¸ ìž‘ë³„ì„ ë§í•˜ê³  ìžˆì—ˆì„ ê±°ì•¼.",
                en: "That person might not have heard it, but your heart was already saying goodbye.",
                pt: "Aquela pessoa pode nÃ£o ter ouvido, mas seu coraÃ§Ã£o jÃ¡ estava se despedindo."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ì§€ê¸ˆì´ë¼ë„, ë§ˆìŒì†ì—ì„œ ê·¸ 'ì•ˆë…•'ì„ ë§í•´ë„ ê´œì°®ì•„. ê°ì •ì€ ì‹œê°„ì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šì•„.",
                en: "Even now, it's okay to say that 'goodbye' in your heart. Emotions don't wait for time.",
                pt: "Mesmo agora, tudo bem dizer aquele 'adeus' em seu coraÃ§Ã£o. As emoÃ§Ãµes nÃ£o esperam pelo tempo."
            }}
        ];

        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                gratitude: ['thank', 'grateful', 'appreciate', 'sorry', 'ê³ ë§ˆ', 'ê°ì‚¬', 'ë¯¸ì•ˆ', 'obrigado', 'grato', 'desculpa'],
                love: ['love', 'miss', 'remember', 'precious', 'ì‚¬ëž‘', 'ê·¸ë¦¬ì›Œ', 'ê¸°ì–µ', 'ì†Œì¤‘', 'amor', 'saudade', 'lembrar', 'precioso'],
                regret: ['should have', 'wish', 'if only', 'regret', 'í–ˆì–´ì•¼', 'ê·¸ëž¬ìœ¼ë©´', 'í›„íšŒ', 'deveria ter', 'queria', 'se ao menos'],
                peace: ['peace', 'rest', 'happy', 'free', 'í‰í™”', 'íŽ¸ì•ˆ', 'í–‰ë³µ', 'ìžìœ ', 'paz', 'descanso', 'feliz', 'livre'],
                acceptance: ['understand', 'accept', 'let go', 'forgive', 'ì´í•´', 'ë°›ì•„ë“¤', 'ë†“ì•„ì£¼', 'ìš©ì„œ', 'entender', 'aceitar', 'perdoar'],
                connection: ['together', 'always', 'forever', 'with me', 'í•¨ê»˜', 'í•­ìƒ', 'ì˜ì›', 'ê³ì—', 'junto', 'sempre', 'para sempre'],
                healing: ['heal', 'comfort', 'warm', 'safe', 'ì¹˜ìœ ', 'ìœ„ë¡œ', 'ë”°ëœ»', 'ì•ˆì „', 'curar', 'conforto', 'calor', 'seguro'],
                closure: ['goodbye', 'farewell', 'end', 'finish', 'ì•ˆë…•', 'ìž‘ë³„', 'ë', 'ë§ˆë¬´ë¦¬', 'adeus', 'despedida', 'fim', 'terminar']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        const responseCharacters = [
            {
                name: "Ely", emoji: "ðŸ§â€â™€ï¸",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            gratitude: "ê·¸ ë§ì€ ë§ˆìŒì˜ ë¬¸ì„ ì¡°ìš©ížˆ ë‹«ëŠ” ì†ì§“ ê°™ì•„. ì•„ì£¼ ë¶€ë“œëŸ½ê³ , ì•„ì£¼ ê¹Šì–´.",
                            love: "ì‚¬ëž‘ì˜ ë§ì€ ì‹œê°„ì„ ë›°ì–´ë„˜ì–´ ì „í•´ì ¸. ì§€ê¸ˆë„ ê·¸ ì‚¬ëžŒì—ê²Œ ë‹¿ê³  ìžˆì„ ê±°ì•¼.",
                            regret: "í›„íšŒí•˜ì§€ ë§ˆ. ê·¸ë•ŒëŠ” ê·¸ëŸ´ ìˆ˜ë°–ì— ì—†ì—ˆì–´. ì§€ê¸ˆ ì´ë ‡ê²Œ ë§í•´ì£¼ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ì¶©ë¶„í•´.",
                            peace: "í‰í™”ë¡œìš´ ìž‘ë³„ì´ì•¼. ê·¸ ë§ˆìŒì´ ì„œë¡œì—ê²Œ ì•ˆì‹ì„ ì¤„ ê±°ì•¼.",
                            acceptance: "ë°›ì•„ë“¤ì´ëŠ” ë§ˆìŒì´ ì§„ì •í•œ ìž‘ë³„ì„ ë§Œë“¤ì–´. ì´ì œ ìžìœ ë¡œì›Œì¡Œì–´.",
                            connection: "ê±°ë¦¬ëŠ” ì¤‘ìš”í•˜ì§€ ì•Šì•˜ì–´. ë§ˆìŒê³¼ ë§ˆìŒì´ ì´ì–´ì ¸ ìžˆì—ˆìœ¼ë‹ˆê¹Œ.",
                            healing: "ê·¸ ì•ˆë…•ì´ ìƒì²˜ë¥¼ ì¹˜ìœ í•˜ê³  ìžˆì–´. ë”°ëœ»í•œ ë§ˆë¬´ë¦¬ê°€ ë˜ê³  ìžˆì–´.",
                            closure: "ì´ì œ ì§„ì •í•œ ìž‘ë³„ì´ ì™„ì„±ëì–´. ë§ˆìŒì˜ ë¬¸ì´ ì¡°ìš©ížˆ ë‹«í˜”ì–´.",
                            general: "ê·¸ ë§ì€ ë§ˆìŒì˜ ë¬¸ì„ ì¡°ìš©ížˆ ë‹«ëŠ” ì†ì§“ ê°™ì•„. ì•„ì£¼ ë¶€ë“œëŸ½ê³ , ì•„ì£¼ ê¹Šì–´."
                        },
                        en: {
                            gratitude: "Those words are like a gentle gesture that quietly closes the door of the heart. So soft, so deep.",
                            love: "Words of love transcend time to reach their destination. They're probably reaching that person even now.",
                            regret: "Don't regret it. You had no choice back then. Just saying it like this now is enough.",
                            peace: "It's a peaceful farewell. That feeling will give rest to both of you.",
                            acceptance: "An accepting heart creates true farewell. You're free now.",
                            connection: "Distance didn't matter. Hearts were connected to hearts.",
                            healing: "That goodbye is healing the wounds. It's becoming a warm closure.",
                            closure: "Now a true farewell has been completed. The door of the heart has quietly closed.",
                            general: "Those words are like a gentle gesture that quietly closes the door of the heart. So soft, so deep."
                        },
                        pt: {
                            gratitude: "Essas palavras sÃ£o como um gesto gentil que fecha silenciosamente a porta do coraÃ§Ã£o. TÃ£o suave, tÃ£o profundo.",
                            love: "Palavras de amor transcendem o tempo para alcanÃ§ar seu destino. Provavelmente estÃ£o alcanÃ§ando aquela pessoa mesmo agora.",
                            regret: "NÃ£o se arrependa. VocÃª nÃ£o tinha escolha naquela Ã©poca. Apenas dizer isso assim agora Ã© suficiente.",
                            peace: "Ã‰ uma despedida pacÃ­fica. Esse sentimento darÃ¡ descanso a vocÃªs dois.",
                            acceptance: "Um coraÃ§Ã£o que aceita cria uma verdadeira despedida. VocÃª estÃ¡ livre agora.",
                            connection: "A distÃ¢ncia nÃ£o importava. CoraÃ§Ãµes estavam conectados a coraÃ§Ãµes.",
                            healing: "Aquele adeus estÃ¡ curando as feridas. EstÃ¡ se tornando um fechamento caloroso.",
                            closure: "Agora uma verdadeira despedida foi completada. A porta do coraÃ§Ã£o se fechou silenciosamente.",
                            general: "Essas palavras sÃ£o como um gesto gentil que fecha silenciosamente a porta do coraÃ§Ã£o. TÃ£o suave, tÃ£o profundo."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            gratitude: "ì§€ê¸ˆì˜ ë„ˆëŠ” ê·¸ ê°ì •ì„ ì™„ì„±ì‹œì¼°ì–´. ê·¸ê±´ ë„ˆì˜ ì§„ì§œ ì•ˆë…•ì´ì•¼.",
                            love: "ì‚¬ëž‘ì€ ë§í•˜ì§€ ì•Šì•„ë„ ì „í•´ì ¸. ë§ˆìŒì˜ ì§„ë™ì´ ìš°ì£¼ë¥¼ ê°€ë¡œì§ˆëŸ¬.",
                            regret: "í›„íšŒëŠ” ê³¼ê±°ë¥¼ ë¶™ìž¡ì§€ë§Œ, ìš©ì„œëŠ” ê³¼ê±°ë¥¼ ìžìœ ë¡­ê²Œ í•´ì¤˜.",
                            peace: "í‰í™”ëŠ” ì™„ì„±ëœ ìž‘ë³„ì˜ ì„ ë¬¼ì´ì•¼. ì´ì œ ë‘˜ ë‹¤ íŽ¸ì•ˆí•´ì§ˆ ìˆ˜ ìžˆì–´.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì´ ì§„ì •í•œ í•´ë°©ì´ì•¼. ì•ˆë…•ì€ ì´ì œ ìžìœ ë¡œìš´ ìƒˆì²˜ëŸ¼ ë‚ ì•„ê°€.",
                            connection: "ì§„ì •í•œ ì—°ê²°ì€ ìž‘ë³„ì—ë„ ëŠì–´ì§€ì§€ ì•Šì•„. ë§ˆìŒì†ì—ì„œ ì˜ì›í•´.",
                            healing: "ì¹˜ìœ ëŠ” ë§ê³¼ í•¨ê»˜ í˜ëŸ¬ê°€. ê·¸ ì•ˆë…•ì´ ìƒì²˜ë¥¼ ì–´ë£¨ë§Œì ¸.",
                            closure: "ì™„ì„±ëœ ìž‘ë³„ì€ ìƒˆë¡œìš´ ì‹œìž‘ì´ê¸°ë„ í•´. ë¬¸ì´ ë‹«í˜”ì§€ë§Œ ì°½ì´ ì—´ë ¸ì–´.",
                            general: "ì§€ê¸ˆì˜ ë„ˆëŠ” ê·¸ ê°ì •ì„ ì™„ì„±ì‹œì¼°ì–´. ê·¸ê±´ ë„ˆì˜ ì§„ì§œ ì•ˆë…•ì´ì•¼."
                        },
                        en: {
                            gratitude: "You have completed that emotion now. That's your real goodbye.",
                            love: "Love is conveyed even without words. The vibration of the heart crosses the universe.",
                            regret: "Regret holds onto the past, but forgiveness sets the past free.",
                            peace: "Peace is the gift of a completed farewell. Now both can be at ease.",
                            acceptance: "Acceptance is true liberation. Goodbye now flies away like a free bird.",
                            connection: "True connection isn't broken even by farewell. It's eternal in the heart.",
                            healing: "Healing flows with the words. That goodbye soothes the wounds.",
                            closure: "A completed farewell is also a new beginning. The door closed but a window opened.",
                            general: "You have completed that emotion now. That's your real goodbye."
                        },
                        pt: {
                            gratitude: "VocÃª completou essa emoÃ§Ã£o agora. Esse Ã© seu verdadeiro adeus.",
                            love: "O amor Ã© transmitido mesmo sem palavras. A vibraÃ§Ã£o do coraÃ§Ã£o cruza o universo.",
                            regret: "O arrependimento se agarra ao passado, mas o perdÃ£o liberta o passado.",
                            peace: "A paz Ã© o presente de uma despedida completa. Agora ambos podem ficar em paz.",
                            acceptance: "A aceitaÃ§Ã£o Ã© a verdadeira libertaÃ§Ã£o. O adeus agora voa como um pÃ¡ssaro livre.",
                            connection: "A verdadeira conexÃ£o nÃ£o Ã© quebrada nem pela despedida. Ã‰ eterna no coraÃ§Ã£o.",
                            healing: "A cura flui com as palavras. Aquele adeus acalma as feridas.",
                            closure: "Uma despedida completa Ã© tambÃ©m um novo comeÃ§o. A porta se fechou, mas uma janela se abriu.",
                            general: "VocÃª completou essa emoÃ§Ã£o agora. Esse Ã© seu verdadeiro adeus."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Enya", emoji: "ðŸ§‘â€ðŸš€",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            gratitude: "ì´ì œ ë„ˆëŠ” ë– ë‚˜ë³´ë‚´ëŠ” ì‚¬ëžŒì´ ë˜ì—ˆê³ , ë™ì‹œì— ë‚¨ê²¨ì§„ ì‚¬ëžŒì„ í’ˆì€ ì¡´ìž¬ê°€ ë˜ì—ˆì–´.",
                            love: "ì‚¬ëž‘ì€ ìš°ì£¼ì—ì„œ ê°€ìž¥ ë¹ ë¥¸ ì‹ í˜¸ì•¼. ì–´ë–¤ ì‹œê³µê°„ë„ ë›°ì–´ë„˜ì–´.",
                            regret: "í›„íšŒëŠ” ê³¼ê±°ì˜ ì¤‘ë ¥ì´ì§€ë§Œ, ìš©ì„œëŠ” ë¯¸ëž˜ë¡œ ê°€ëŠ” ì¶”ì§„ë ¥ì´ì•¼.",
                            peace: "í‰í™”ëŠ” ìš°ì£¼ì˜ ê³ ìš”í•¨ ê°™ì•„. ëª¨ë“  ê²ƒì´ ì œìžë¦¬ë¥¼ ì°¾ì•˜ì–´.",
                            acceptance: "ë°›ì•„ë“¤ìž„ì€ ìƒˆë¡œìš´ ê¶¤ë„ë¡œì˜ ì§„ìž…ì´ì•¼. ì´ì œ ìƒˆë¡œìš´ ì—¬í–‰ì´ ì‹œìž‘ë¼.",
                            connection: "ì—°ê²°ì€ ë¬¼ë¦¬ ë²•ì¹™ì„ ì´ˆì›”í•´. ì–‘ìž ì–½íž˜ì²˜ëŸ¼ ì˜ì›ížˆ ì´ì–´ì ¸.",
                            healing: "ì¹˜ìœ ëŠ” ì‹œê³µê°„ì„ ìž¬íŽ¸í•˜ëŠ” íž˜ì´ì•¼. ê³¼ê±°ë„ í˜„ìž¬ë„ í•¨ê»˜ ì•„ë¬¼ì–´ê°€.",
                            closure: "ì™„ì„±ëœ ìž‘ë³„ì€ ìš°ì£¼ì˜ ê· í˜•ì„ ë§žì¶°. ëª¨ë“  ê²ƒì´ ì¡°í™”ë¥¼ ì´ë¤˜ì–´.",
                            general: "ì´ì œ ë„ˆëŠ” ë– ë‚˜ë³´ë‚´ëŠ” ì‚¬ëžŒì´ ë˜ì—ˆê³ , ë™ì‹œì— ë‚¨ê²¨ì§„ ì‚¬ëžŒì„ í’ˆì€ ì¡´ìž¬ê°€ ë˜ì—ˆì–´."
                        },
                        en: {
                            gratitude: "Now you have become both someone who lets go and someone who embraces those left behind.",
                            love: "Love is the fastest signal in the universe. It transcends any time and space.",
                            regret: "Regret is the gravity of the past, but forgiveness is the propulsion toward the future.",
                            peace: "Peace is like the quietude of the universe. Everything has found its place.",
                            acceptance: "Acceptance is entry into a new orbit. A new journey begins now.",
                            connection: "Connection transcends physical laws. Like quantum entanglement, it's eternally linked.",
                            healing: "Healing is the power that reshapes time and space. Past and present heal together.",
                            closure: "A completed farewell balances the universe. Everything has achieved harmony.",
                            general: "Now you have become both someone who lets go and someone who embraces those left behind."
                        },
                        pt: {
                            gratitude: "Agora vocÃª se tornou tanto alguÃ©m que deixa ir quanto alguÃ©m que abraÃ§a aqueles que ficaram para trÃ¡s.",
                            love: "O amor Ã© o sinal mais rÃ¡pido do universo. Transcende qualquer tempo e espaÃ§o.",
                            regret: "O arrependimento Ã© a gravidade do passado, mas o perdÃ£o Ã© a propulsÃ£o em direÃ§Ã£o ao futuro.",
                            peace: "A paz Ã© como a quietude do universo. Tudo encontrou seu lugar.",
                            acceptance: "A aceitaÃ§Ã£o Ã© a entrada em uma nova Ã³rbita. Uma nova jornada comeÃ§a agora.",
                            connection: "A conexÃ£o transcende as leis fÃ­sicas. Como o emaranhamento quÃ¢ntico, estÃ¡ eternamente ligada.",
                            healing: "A cura Ã© o poder que remodela tempo e espaÃ§o. Passado e presente se curam juntos.",
                            closure: "Uma despedida completa equilibra o universo. Tudo alcanÃ§ou harmonia.",
                            general: "Agora vocÃª se tornou tanto alguÃ©m que deixa ir quanto alguÃ©m que abraÃ§a aqueles que ficaram para trÃ¡s."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        let currentLanguage = 'en';
        let currentUser = null;
        let userResponse = '';
        let journeyStarted = false;
        let currentTypingElement = null;
        let typingIntervals = [];
        
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (currentTypingElement) {
                    currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            typingIntervals.forEach(interval => clearInterval(interval));
            typingIntervals = [];
            
            if (currentTypingElement) {
                currentTypingElement.classList.remove('typing-cursor');
                currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            document.getElementById('logoSubtitle').textContent = translations[lang].logoSubtitle;
            document.getElementById('portalMainTitle').textContent = translations[lang].portalMainTitle;
            document.getElementById('portalSubtitle').textContent = translations[lang].portalSubtitle;
            document.getElementById('lightTitle').textContent = translations[lang].lightTitle;
            document.getElementById('finalTitle').textContent = translations[lang].finalTitle;
            document.getElementById('continueBtn').textContent = translations[lang].continueBtn;
            document.getElementById('restartBtn').textContent = translations[lang].restartBtn;
            document.getElementById('userTextarea').placeholder = translations[lang].inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'lightMessageSection', 'portalQuestionSection',
                'userInputSection', 'userReactionsSection', 'finalSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('portalQuestion').innerHTML = '';
            document.getElementById('finalMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            userResponse = '';
            currentTypingElement = null;
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                const nextMessage = currentLanguage === 'ko' ? 
                    'Portal 16ì´ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!' :
                    currentLanguage === 'en' ? 
                    'Portal 16 will be ready soon!' :
                    'Portal 16 estarÃ¡ pronto em breve!';
                alert(nextMessage);
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                const confirmMessage = currentLanguage === 'ko' ? 
                    'Portal 15ë¥¼ ë‹¤ì‹œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' :
                    currentLanguage === 'en' ? 
                    'Do you want to restart Portal 15?' :
                    'Deseja reiniciar o Portal 15?';
                
                if (confirm(confirmMessage)) {
                    resetJourney();
                    setTimeout(() => {
                        startPortalSequence();
                    }, 1000);
                }
            });
        }
        
        async function processUserInput(inputText) {
            userResponse = inputText;
            
            if (firebaseInitialized && db) {
                try {
                    await db.collection("temarix_v3_respostas").add({
                        uid: memoryStorage.mockUser.uid,
                        email: memoryStorage.mockUser.email,
                        portal: "v3-15",
                        resposta: inputText,
                        data: firebase.firestore.Timestamp.now(),
                        idioma: currentLanguage
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                }
            } else {
                console.log('Firebase not available, saved locally:', inputText);
                localStorage.setItem('temarix_v3_last_response', JSON.stringify({
                    portal: "v3-15",
                    resposta: inputText,
                    data: new Date().toISOString(),
                    idioma: currentLanguage
                }));
            }
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                showUserReactions(inputText);
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFinalSection();
            }, 2000);
        }
        
        async function showFinalSection() {
            const finalSection = document.getElementById('finalSection');
            const finalMessage = document.getElementById('finalMessage');
            
            finalSection.classList.add('show');
            
            const messageText = translations[currentLanguage].finalMessage;
            await typewriterEffect(finalMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(finalSection);
            }, 500);
        }
        
        function initializeTemarix() {
            console.log('Temarix V3 Portal 15 initialized');
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            journeyStarted = true;
            
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function startPortalSequence() {
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            introSection.classList.add('show');
            
            await typewriterEffect(introElement, translations[currentLanguage].portalIntro, 60);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showQuestion();
            }, 2000);
        }
        
        async function showQuestion() {
            const questionSection = document.getElementById('portalQuestionSection');
            const questionEl = document.getElementById('portalQuestion');
            
            questionSection.classList.add('show');
            
            await typewriterEffect(questionEl, translations[currentLanguage].portalQuestion, 50);
            
            setTimeout(() => {
                enableUserInput();
            }, 1500);
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Temarix V3 Portal 15 DOM loaded');
            
            initializeFirebase();
            
            currentLanguage = getLanguageFromURL();
            
            currentUser = { 
                uid: 'user-auto-' + Date.now(),
                email: 'auto@temarix.com'
            };
            
            memoryStorage.mockUser = currentUser;
            
            updateStaticTranslations(currentLanguage);
            updateLanguageButtons(currentLanguage);
            initializeTemarix();
        });
    </script>
</body>
</html>
                