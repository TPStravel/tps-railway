<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V5 - Portal 14: Compassion Was Not Weakness</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .navigation-title {
                font-size: 24px;
            }
            
            .navigation-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V5</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 14: Compassion Was Not Weakness</div>
            <div class="portal-subtitle" id="portalSubtitle">When did I realize that being gentle was actually strength?</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">ğŸ•Š Portal 14 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 15</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with this strength</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Tell me about a time you showed compassion... (Press Enter to send)"
                      rows="1"
                      maxlength="800"></textarea>
        </div>
    </div>

    <script>
        // Global state management
        let state = {
            db: null,
            auth: null,
            firebaseInitialized: false,
            currentUser: null,
            currentLanguage: 'en',
            userResponse: '',
            journeyStarted: false,
            currentTypingElement: null,
            typingIntervals: [],
            awaitingSecondResponse: false,
            userResponses: []
        };
        
        // Portal navigation configuration
        const portalConfig = {
            currentPortal: "v5-14",
            nextPortal: "v5-15",
            nextPortalFile: "temarix_v05_15.html"
        };
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
            authDomain: "canal-vivo-chat.firebaseapp.com",
            projectId: "canal-vivo-chat",
            storageBucket: "canal-vivo-chat.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdefghijklmnopqr"
        };
        
        // Initialize Firebase with error handling
        function initializeFirebase() {
            return new Promise((resolve) => {
                try {
                    if (typeof firebase !== 'undefined') {
                        firebase.initializeApp(firebaseConfig);
                        state.db = firebase.firestore();
                        state.auth = firebase.auth();
                        state.firebaseInitialized = true;
                        
                        state.auth.onAuthStateChanged((user) => {
                            if (user) {
                                state.currentUser = user;
                            } else {
                                state.currentUser = {
                                    uid: 'anonymous-' + Date.now(),
                                    email: 'anonymous@temarix.com',
                                    isAnonymous: true
                                };
                            }
                            showConnectionStatus(true);
                        });
                        
                        console.log('Firebase initialized successfully');
                    } else {
                        console.log('Firebase SDK not loaded');
                        state.currentUser = {
                            uid: 'anonymous-' + Date.now(),
                            email: 'anonymous@temarix.com',
                            isAnonymous: true
                        };
                        showConnectionStatus(false);
                    }
                } catch (error) {
                    console.error('Firebase initialization failed:', error);
                    state.currentUser = {
                        uid: 'anonymous-' + Date.now(),
                        email: 'anonymous@temarix.com',
                        isAnonymous: true
                    };
                    showConnectionStatus(false);
                }
                resolve();
            });
        }
        
        // Show connection status to user
        function showConnectionStatus(isOnline) {
            const existingStatus = document.querySelector('.connection-status');
            if (existingStatus) {
                existingStatus.remove();
            }
            
            if (!isOnline) {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'connection-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: rgba(255, 107, 107, 0.9);
                    color: white;
                    padding: 8px 15px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-family: 'Courier New', monospace;
                    z-index: 1000;
                    opacity: 0.8;
                `;
                statusDiv.textContent = state.currentLanguage === 'ko' ? 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ' : 
                                       state.currentLanguage === 'pt' ? 'Modo offline' : 'Offline mode';
                document.body.appendChild(statusDiv);
                
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.remove();
                    }
                }, 5000);
            }
        }

        // Translations object
        const translations = {
            ko: {
                title: "Temarix V5 - Portal 14: ìë¹„ëŠ” ì—°ì•½í•¨ì´ ì•„ë‹ˆì—ˆë‹¤",
                logoSubtitle: "ê°ì • ì—°ê¸ˆìˆ ",
                portalMainTitle: "Portal 14: ìë¹„ëŠ” ì—°ì•½í•¨ì´ ì•„ë‹ˆì—ˆë‹¤",
                portalSubtitle: "ì–¸ì œ ë‚˜ëŠ” ë‹¤ì •í•¨ì´ ì‚¬ì‹¤ í˜ì´ë¼ëŠ” ê±¸ ê¹¨ë‹¬ì•˜ì„ê¹Œ?",
                portalIntro: "ğŸ•Š \"ì‚´ë©´ì„œ 'ìë¹„'ë¥¼ ë² í’€ì—ˆë˜ ê¸°ì–µì´ ìˆë‚˜ìš”?\ní˜¹ì€ ìš©ì„œí•˜ê±°ë‚˜ ì´í•´í•˜ë ¤ í–ˆë˜ ìˆœê°„ì´ ìˆì—ˆë‚˜ìš”?\"\n\n\"ê·¸ë•Œ, ìë¹„ë¥¼ ë² í‘¼ ë‹¹ì‹ ì€ ì–´ë–»ê²Œ ëŠê¼ˆë‚˜ìš”?\nì•½í•´ ë³´ì¸ë‹¤ê³  ëŠë¼ì§„ ì•Šì•˜ë‚˜ìš”?\"",
                emotionalBridge: "ì„¸ìƒì€ ìë¹„ë¥¼ ë¬´ê¸°ì²˜ëŸ¼ ë³´ì§€ ì•Šì§€ë§Œ, ìë¹„ëŠ” ê°ì •ì„ ì§€ë°°í•˜ëŠ” ê°€ì¥ ê°•í•œ í˜ì…ë‹ˆë‹¤.\n\nìë¹„ëŠ” ì„ íƒì´ê³ , ê·¸ ì„ íƒì„ í•˜ëŠ” ìëŠ” ì—°ì•½í•œ ê²Œ ì•„ë‹ˆë¼ ì£¼ì²´ì ì¸ ì¡´ì¬ì…ë‹ˆë‹¤.\nìë¹„ëŠ” í•œê³„ë¥¼ í—ˆë¬¼ê³ , ê·¸ ìˆœê°„ ë‹¹ì‹ ì€ ìì‹ ì„ ë” í¬ê²Œ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤.",
                followUpQuestion: "ì´ì œ, ìë¹„ëŠ” ë‹¹ì‹ ì—ê²Œ ì–´ë–¤ ì˜ë¯¸ì¸ê°€ìš”?\ní•œ ë¬¸ì¥ìœ¼ë¡œ ìë¹„ì˜ ì •ì˜ë¥¼ ë‹¤ì‹œ ì¨ì¤€ë‹¤ë©´,\në‹¹ì‹ ì€ ì–´ë–»ê²Œ ë§í•˜ê³  ì‹¶ë‚˜ìš”?",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ë‹¹ì‹ ì€ ìë¹„ë¥¼ ì—°ì•½í•¨ì´ ì•„ë‹Œ ì¡´ì—„ìœ¼ë¡œ ë°”ê¾¼ ì‚¬ëŒì´ì—ìš”.\nì´ì œ ìë¹„ëŠ” ë‹¹ì‹ ì˜ ì„ íƒì´ì ë¬´ê¸°ì˜ˆìš”.\nìƒì²˜ë¥¼ ëŠëŠ” í˜, ê·¸ë¦¬ê³  ì´ì–´ì£¼ëŠ” ë‹¤ë¦¬.",
                navigationTitle: "ğŸ•Š Portal 14 ì™„ë£Œ",
                navigationMessage: "ë‹¹ì‹ ì€ ìë¹„ë¥¼ ì—°ì•½í•¨ì´ ì•„ë‹Œ ë‚´ ì‚¶ì˜ ì¤‘ì‹¬ ì–¸ì–´ë¡œ ë°›ì•„ë“¤ì˜€ìŠµë‹ˆë‹¤.\n\nìë¹„ëŠ” ë©ˆì¶”ëŠ” í˜ì´ë©°, ìƒì²˜ê°€ ë²ˆì§€ì§€ ì•Šë„ë¡ ë‚´ê°€ ë¨¼ì € ë©ˆì¶”ëŠ” ìš©ê¸°ì…ë‹ˆë‹¤. ê·¸ ì •ì˜ëŠ” ë‹¹ì‹ ì´ ìë¹„ë¥¼ ë§ë¡œë§Œì´ ì•„ë‹ˆë¼ ì‚¶ìœ¼ë¡œ ì‚´ì•˜ë‹¤ëŠ” ì¦ê±°ì…ë‹ˆë‹¤.\n\nì´ì œ ìë¹„ëŠ” ë‹¹ì‹ ì˜ ì„ íƒì´ì ë¬´ê¸°ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒì²˜ë¥¼ ëŠëŠ” í˜, ê·¸ë¦¬ê³  ì´ì–´ì£¼ëŠ” ë‹¤ë¦¬ë¡œì„œ ë§ì…ë‹ˆë‹¤.\n\në‹¹ì‹ ì€ ìë¹„ë¡œ ê°•í•´ì§„ ì‚¬ëŒì…ë‹ˆë‹¤.",
                nextPortalBtn: "Portal 15ë¡œ ì´ì–´ê°€ê¸°",
                stayPortalBtn: "ì´ í˜ê³¼ ë¨¸ë¬¼ê¸°",
                inputPlaceholder: "ìë¹„ë¥¼ ë² í’€ì—ˆë˜ ê¸°ì–µì— ëŒ€í•´ ë§í•´ì£¼ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...",
                confirmNextPortal: "Portal 15: ë‚˜ëŠ” ë‚˜ë¥¼ ì•ˆì•„ì£¼ê¸°ë¡œ í–ˆë‹¤ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                confirmStay: "ìë¹„ì˜ í˜ê³¼ ë” ë¨¸ë¬¼ë©° ê·¸ ì˜ë¯¸ë¥¼ ë” ê¹Šì´ ëŠë¼ì‹œê² ìŠµë‹ˆê¹Œ?",
                transitionMessage: "ìƒˆë¡œìš´ ì—¬ì •ì´ ì‹œì‘ë©ë‹ˆë‹¤..."
            },
            en: {
                title: "Temarix V5 - Portal 14: Compassion Was Not Weakness",
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 14: Compassion Was Not Weakness",
                portalSubtitle: "When did I realize that being gentle was actually strength?",
                portalIntro: "ğŸ•Š \"Have you ever shown 'compassion' in your life?\nOr was there a moment when you tried to forgive or understand?\"\n\n\"How did you feel when you showed compassion?\nDid you ever think you looked weak?\"",
                emotionalBridge: "The world doesn't see compassion as a weapon, but compassion is the strongest force that governs emotions.\n\nCompassion is a choice, and those who make that choice are not weak but autonomous beings.\nCompassion breaks down barriers, and in that moment you make yourself greater.",
                followUpQuestion: "Now, what does compassion mean to you?\nIf you could redefine compassion in one sentence,\nhow would you like to say it?",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "You are someone who transformed compassion from weakness into dignity.\nNow compassion is both your choice and your weapon.\nThe power to stop wounds, and the bridge that connects.",
                navigationTitle: "ğŸ•Š Portal 14 Complete",
                navigationMessage: "You have accepted compassion not as weakness but as the central language of your life.\n\nCompassion is the power to stop, the courage to stop first so that wounds don't spread. That definition is proof that you have lived compassion not just in words but in life.\n\nNow compassion has become both your choice and your weapon. The power to stop wounds, and the bridge that connects.\n\nYou are someone who has become strong through compassion.",
                nextPortalBtn: "Continue to Portal 15",
                stayPortalBtn: "Stay with this strength",
                inputPlaceholder: "Tell me about a time you showed compassion... (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response...",
                confirmNextPortal: "Do you want to continue to Portal 15: I Decided to Embrace Myself?",
                confirmStay: "Do you want to stay longer with the power of compassion and feel its meaning more deeply?",
                transitionMessage: "A new journey begins..."
            },
            pt: {
                title: "Temarix V5 - Portal 14: Compaixao Nao Era Fraqueza",
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 14: Compaixao Nao Era Fraqueza",
                portalSubtitle: "Quando percebi que ser gentil era na verdade forca?",
                portalIntro: "ğŸ•Š \"Voce ja mostrou 'compaixao' em sua vida?\nOu houve um momento em que tentou perdoar ou entender?\"\n\n\"Como se sentiu quando mostrou compaixao?\nJa pensou que parecia fraco?\"",
                emotionalBridge: "O mundo nao ve compaixao como arma, mas compaixao e a forca mais forte que governa emocoes.\n\nCompaixao e uma escolha, e aqueles que fazem essa escolha nao sao fracos, mas seres autonomos.\nCompaixao derruba barreiras, e naquele momento voce se torna maior.",
                followUpQuestion: "Agora, o que compaixao significa para voce?\nSe pudesse redefinir compaixao em uma frase,\ncomo gostaria de dizer?",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Voce e alguem que transformou compaixao de fraqueza em dignidade.\nAgora compaixao e tanto sua escolha quanto sua arma.\nO poder de parar feridas, e a ponte que conecta.",
                navigationTitle: "ğŸ•Š Portal 14 Completo",
                navigationMessage: "Voce aceitou compaixao nao como fraqueza, mas como linguagem central de sua vida.\n\nCompaixao e o poder de parar, a coragem de parar primeiro para que feridas nao se espalhem. Essa definicao e prova de que voce viveu compaixao nao apenas em palavras, mas na vida.\n\nAgora compaixao se tornou tanto sua escolha quanto sua arma. O poder de parar feridas, e a ponte que conecta.\n\nVoce e alguem que se tornou forte atraves da compaixao.",
                nextPortalBtn: "Continuar para Portal 15",
                stayPortalBtn: "Ficar com esta forca",
                inputPlaceholder: "Conte-me sobre uma vez que mostrou compaixao... (Enter para enviar)",
                youLabel: "Voce",
                waitingMessage: "Aguardando resposta...",
                confirmNextPortal: "Deseja continuar para Portal 15: Decidi Me Abracar?",
                confirmStay: "Deseja ficar mais tempo com o poder da compaixao e sentir seu significado mais profundamente?",
                transitionMessage: "Uma nova jornada comeca..."
            }
        };
        
        // Character definitions
        const characters = [
            { name: "Noah", emoji: "ğŸ§‘â€ğŸ¦±", text: {
                ko: "ìë¹„ëŠ” í˜ì´ì•¼.\në³µìˆ˜ ëŒ€ì‹  ë©ˆì¶˜ ìš©ê¸°, ê·¸ê²Œ ì§„ì§œ ê°•í•¨ì´ì•¼.",
                en: "Compassion is strength.\nThe courage to stop instead of revenge, that's real strength.",
                pt: "Compaixao e forca.\nA coragem de parar em vez de vinganca, essa e a verdadeira forca."
            }},
            { name: "Ely", emoji: "ğŸ§â€â™€ï¸", text: {
                ko: "ì„¸ìƒì€ ìë¹„ë¥¼ ë¬´ê¸°ì²˜ëŸ¼ ë³´ì§€ ì•Šì§€ë§Œ,\nìë¹„ëŠ” ê°ì •ì„ ì§€ë°°í•˜ëŠ” ê°€ì¥ ê°•í•œ í˜ì´ì—ìš”.",
                en: "The world doesn't see compassion as a weapon,\nbut compassion is the strongest force that governs emotions.",
                pt: "O mundo nao ve compaixao como arma,\nmas compaixao e a forca mais forte que governa emocoes."
            }},
            { name: "Sora", emoji: "ğŸ§•", text: {
                ko: "ìë¹„ë¥¼ ë² í‘¼ ë‹¹ì‹ ì€,\nëˆ„êµ¬ë³´ë‹¤ ê°ì •ì„ ë‹¤ë£° ì¤„ ì•„ëŠ” ì‚¬ëŒì´ì—ìš”.",
                en: "You who showed compassion\nare someone who knows how to handle emotions better than anyone.",
                pt: "Voce que mostrou compaixao\ne alguem que sabe lidar com emocoes melhor que qualquer um."
            }},
            { name: "Kael", emoji: "ğŸ§™", text: {
                ko: "ìë¹„ëŠ” ì„ íƒì´ê³ ,\nê·¸ ì„ íƒì„ í•˜ëŠ” ìëŠ” ì—°ì•½í•œ ê²Œ ì•„ë‹ˆë¼ ì£¼ì²´ì ì¸ ê±°ì˜ˆìš”.",
                en: "Compassion is a choice,\nand those who make that choice are not weak but autonomous.",
                pt: "Compaixao e uma escolha,\ne aqueles que fazem essa escolha nao sao fracos, mas autonomos."
            }},
            { name: "Mira", emoji: "ğŸ§‘â€ğŸ¨", text: {
                ko: "ê·¸ ìš©ì„œëŠ” íë ¤ì§„ ê²ƒì´ ì•„ë‹ˆë¼,\në‹¹ì‹ ì˜ ìƒ‰ì´ ë”ìš± ëšœë ·í•´ì§„ ìˆœê°„ì´ì—ˆì–´ìš”.",
                en: "That forgiveness wasn't blurred,\nbut the moment your colors became clearer.",
                pt: "Aquele perdao nao foi borrado,\nmas o momento em que suas cores se tornaram mais claras."
            }},
            { name: "Cris", emoji: "ğŸ¦¸â€â™‚ï¸", text: {
                ko: "ì°¸ëŠ” ê²Œ ì•„ë‹ˆë¼,\nê·¸ ìƒí™©ì„ ì´ˆì›”í•œ ê±°ì•¼.\nê·¸ë¦¬ê³  ê·¸ê±´ ì ˆëŒ€ ì—°ì•½í•¨ì´ ì•„ë‹ˆì•¼.",
                en: "It wasn't enduring,\nbut transcending that situation.\nAnd that's definitely not weakness.",
                pt: "Nao foi suportar,\nmas transcender aquela situacao.\nE isso definitivamente nao e fraqueza."
            }},
            { name: "Enya", emoji: "ğŸ§‘â€ğŸš€", text: {
                ko: "ìë¹„ëŠ” í•œê³„ë¥¼ í—ˆë¬¼ê³ ,\nê·¸ ìˆœê°„ ë‹¹ì‹ ì€ ìì‹ ì„ ë” í¬ê²Œ ë§Œë“  ê±°ì˜ˆìš”.",
                en: "Compassion breaks down barriers,\nand in that moment you made yourself greater.",
                pt: "Compaixao derruba barreiras,\ne naquele momento voce se tornou maior."
            }},
            { name: "Lian", emoji: "ğŸ§˜", text: {
                ko: "ë‹¹ì‹ ì˜ ìë¹„ëŠ” íƒ€ì¸ì„ ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë¼,\nìì‹ ì„ ë³´í˜¸í•˜ëŠ” ë°©ì‹ì´ê¸°ë„ í–ˆì–´ìš”.",
                en: "Your compassion wasn't just for others,\nbut also a way to protect yourself.",
                pt: "Sua compaixao nao foi apenas para outros,\nmas tambem uma forma de se proteger."
            }}
        ];

        // Compassion type analysis function
        function analyzeCompassionType(userInput) {
            const input = userInput.toLowerCase();
            
            const compassionKeywords = {
                forgiveness: ['forgave', 'forgive', 'let it go', 'moved on', 'ìš©ì„œ', 'ë„˜ì–´ê°”', 'perdoou', 'perdoar', 'deixou passar'],
                understanding: ['understood', 'tried to understand', 'listened', 'empathy', 'ì´í•´', 'ë“¤ì–´ì¤¬', 'entendeu', 'tentou entender', 'ouviu'],
                helping: ['helped', 'supported', 'was there', 'assisted', 'ë„ì™€ì¤¬', 'ì§€ì§€í•´', 'ìˆì–´ì¤¬', 'ajudou', 'apoiou', 'esteve la'],
                patience: ['patient', 'waited', 'gave time', 'stayed calm', 'ì°¸ì•˜', 'ê¸°ë‹¤ë ¤', 'ì¹¨ì°©í•˜ê²Œ', 'paciente', 'esperou', 'deu tempo'],
                kindness: ['kind', 'gentle', 'soft words', 'caring', 'ì¹œì ˆ', 'ë¶€ë“œëŸ½ê²Œ', 'ë”°ëœ»í•˜ê²Œ', 'gentil', 'carinhoso', 'palavras suaves'],
                sacrifice: ['gave up', 'sacrificed', 'put them first', 'í¬ê¸°í•˜ê³ ', 'í¬ìƒí•˜ê³ ', 'ìš°ì„ ì‹œ', 'desistiu', 'sacrificou', 'colocou primeiro'],
                protection: ['protected', 'defended', 'stood up for', 'ë³´í˜¸í•´', 'ì§€ì¼œì¤¬', 'í¸ë“¤ì–´', 'protegeu', 'defendeu', 'ficou do lado'],
                acceptance: ['accepted', 'embraced', 'welcomed', 'ë°›ì•„ë“¤ì˜€', 'í¬ìš©í–ˆ', 'aceitou', 'abraÃ§ou', 'acolheu'],
                generosity: ['gave', 'shared', 'offered', 'ë‚˜ëˆ ì¤¬', 'ë² í’€ì—ˆ', 'deu', 'compartilhou', 'ofereceu'],
                mercy: ['mercy', 'showed grace', 'compassionate', 'ìë¹„', 'ì€í˜œ', 'misericordia', 'mostrou graca', 'compassivo'],
                comfort: ['comforted', 'consoled', 'soothed', 'ìœ„ë¡œí•´', 'ë‹¬ë˜ì¤¬', 'consolou', 'acalmou'],
                general: ['compassion', 'love', 'care', 'ìë¹„', 'ì‚¬ë‘', 'ëŒë´„', 'compaixao', 'amor', 'cuidado']
            };
            
            let detectedTypes = [];
            for (const [type, keywords] of Object.entries(compassionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedTypes.push(type);
                        break;
                    }
                }
            }
            
            if (detectedTypes.length === 0) {
                detectedTypes = ['general'];
            }
            
            return detectedTypes[0];
        }
        
        // Response characters with compassion-based responses
        const responseCharacters = [
            {
                name: "Sora", emoji: "ğŸ§•",
                getResponse: (userInput, lang) => {
                    const compassionType = analyzeCompassionType(userInput);
                    
                    const responses = {
                        ko: {
                            forgiveness: "ìš©ì„œëŠ” ìƒëŒ€ë¥¼ ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë¼ ìì‹ ì„ ìœ„í•œ ì„ íƒì´ì—ˆì–´ìš”.\nê·¸ ìš©ì„œë¡œ ë‹¹ì‹ ì€ ììœ ë¡œì›Œì¡Œê³ , ë” í° ì‚¬ëŒì´ ë˜ì—ˆì–´ìš”.\nìš©ì„œí•  ìˆ˜ ìˆëŠ” ë§ˆìŒì´ì•¼ë§ë¡œ ì§„ì •í•œ ê°•í•¨ì´ì—ìš”.",
                            understanding: "ì´í•´í•˜ë ¤ ë…¸ë ¥í–ˆë˜ ë‹¹ì‹ ì˜ ë§ˆìŒì´ ì•„ë¦„ë‹¤ì›Œìš”.\nê·¸ ì´í•´ëŠ” ìƒëŒ€ë°©ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¹ì‹  ìì‹ ë„ ì„±ì¥ì‹œì¼°ì–´ìš”.\nì´í•´ëŠ” ì—°ê²°ì˜ ë‹¤ë¦¬ë¥¼ ë†“ëŠ” ìš©ê¸°ì˜ˆìš”.",
                            helping: "ë„ì›€ì„ ì¤€ ìˆœê°„, ë‹¹ì‹ ì€ ì„¸ìƒì„ ì¡°ê¸ˆ ë” ë”°ëœ»í•˜ê²Œ ë§Œë“¤ì—ˆì–´ìš”.\nê·¸ ë„ì›€ì€ ìƒëŒ€ì—ê²Œë§Œ ì˜ë¯¸ê°€ ìˆëŠ” ê²Œ ì•„ë‹ˆë¼\në‹¹ì‹ ì˜ ë§ˆìŒë„ í’ìš”ë¡­ê²Œ ë§Œë“¤ì—ˆì–´ìš”.",
                            patience: "ê¸°ë‹¤ë ¤ì£¼ê³  ì°¸ì•„ì¤€ ê·¸ ì‹œê°„ì´ ì–¼ë§ˆë‚˜ ì†Œì¤‘í–ˆì„ê¹Œìš”.\nì¸ë‚´ëŠ” ì•½í•¨ì´ ì•„ë‹ˆë¼ ê¹Šì€ ì‚¬ë‘ì˜ í‘œí˜„ì´ì—ìš”.\nê·¸ ê¸°ë‹¤ë¦¼ì´ ê¸°ì ì„ ë§Œë“¤ì–´ëƒˆì–´ìš”.",
                            kindness: "ë‹¹ì‹ ì˜ ì¹œì ˆì€ ì‘ì€ í–‰ë™ì´ì—ˆì„ì§€ ëª¨ë¥´ì§€ë§Œ\nëˆ„êµ°ê°€ì˜ í•˜ë£¨ë¥¼ ì™„ì „íˆ ë°”ê¿”ë†“ì•˜ì„ ê±°ì˜ˆìš”.\nì¹œì ˆì€ ì„¸ìƒì— í¼ì ¸ë‚˜ê°€ëŠ” ë¹›ì´ì—ìš”.",
                            sacrifice: "ìì‹ ì„ ë‚´ë ¤ë†“ê³  ë‹¤ë¥¸ ì‚¬ëŒì„ ë¨¼ì € ìƒê°í•œ ê·¸ ë§ˆìŒ,\nê·¸ê²ƒì€ ì´ê¸°ì‹¬ì´ ì•„ë‹Œ ì§„ì •í•œ ì‚¬ë‘ì´ì—ˆì–´ìš”.\ní¬ìƒì€ ê°€ì¥ ìˆ­ê³ í•œ ì‚¬ë‘ì˜ í˜•íƒœì˜ˆìš”.",
                            protection: "ëˆ„êµ°ê°€ë¥¼ ì§€ì¼œì£¼ë ¤ í–ˆë˜ ê·¸ ë§ˆìŒì´ ì–¼ë§ˆë‚˜ ìš©ê°í–ˆì„ê¹Œìš”.\në³´í˜¸í•˜ë ¤ëŠ” ë§ˆìŒì€ ë³¸ëŠ¥ì ì¸ ì‚¬ë‘ì—ì„œ ë‚˜ì™€ìš”.\në‹¹ì‹ ì€ ëˆ„êµ°ê°€ì—ê²Œ ì•ˆì „í•œ í•­êµ¬ì˜€ì–´ìš”.",
                            acceptance: "ìˆëŠ” ê·¸ëŒ€ë¡œ ë°›ì•„ë“¤ì—¬ì¤€ ë‹¹ì‹ ì˜ ë§ˆìŒì´\nê·¸ ì‚¬ëŒì—ê²ŒëŠ” ì„¸ìƒì—ì„œ ê°€ì¥ í° ì„ ë¬¼ì´ì—ˆì„ ê±°ì˜ˆìš”.\nìˆ˜ìš©ì€ ê°€ì¥ ê¹Šì€ ì‚¬ë‘ì˜ ì–¸ì–´ì˜ˆìš”.",
                            generosity: "ë‚˜ëˆ„ì–´ì¤€ ê·¸ ë§ˆìŒì´ ì§„ì •í•œ í’ìš”ë¡œì›€ì„ ë§Œë“¤ì–´ëƒˆì–´ìš”.\në² í‘¸ëŠ” ë§ˆìŒì€ ë°›ëŠ” ì‚¬ëŒë³´ë‹¤ ì£¼ëŠ” ì‚¬ëŒì„ ë” í–‰ë³µí•˜ê²Œ í•´ìš”.\nê´€ëŒ€í•¨ì€ ë§ˆìŒì˜ ì—¬ìœ ì—ì„œ ë‚˜ì™€ìš”.",
                            mercy: "ìë¹„ë¥¼ ë² í‘¼ ìˆœê°„, ë‹¹ì‹ ì€ ì²œì‚¬ê°€ ë˜ì—ˆì–´ìš”.\nê·¸ ìë¹„ëŠ” ìƒì²˜ë¥¼ ì¹˜ìœ í•˜ê³  í¬ë§ì„ ì‹¬ì–´ì£¼ì—ˆì–´ìš”.\nìë¹„ë¡œìš´ ë§ˆìŒì´ì•¼ë§ë¡œ ê°€ì¥ ì•„ë¦„ë‹¤ìš´ í˜ì´ì—ìš”.",
                            comfort: "ìœ„ë¡œí•´ì¤€ ê·¸ ì†ê¸¸ì´ ì–¼ë§ˆë‚˜ ë”°ëœ»í–ˆì„ê¹Œìš”.\nìœ„ë¡œëŠ” ë§ì´ ì•„ë‹ˆë¼ ë§ˆìŒìœ¼ë¡œ ì „í•´ì§€ëŠ” ê±°ì˜ˆìš”.\në‹¹ì‹ ì˜ ìœ„ë¡œê°€ ëˆ„êµ°ê°€ì˜ ìƒì²˜ë¥¼ ì•„ë¬¼ê²Œ í–ˆì–´ìš”.",
                            general: "ê·¸ ì •ì˜ëŠ” ë‹¹ì‹ ì´ ìë¹„ë¥¼ ë§ë¡œë§Œì´ ì•„ë‹ˆë¼ ì‚¶ìœ¼ë¡œ ì‚´ì•˜ë‹¤ëŠ” ì¦ê±°ì˜ˆìš”."
                        },
                        en: {
                            forgiveness: "Forgiveness was not for others but a choice for yourself.\nThrough that forgiveness you became free and became a greater person.\nThe ability to forgive is true strength.",
                            understanding: "Your heart that tried to understand is beautiful.\nThat understanding helped not only the other person but also yourself grow.\nUnderstanding is the courage to build bridges of connection.",
                            helping: "In the moment you helped, you made the world a little warmer.\nThat help was meaningful not only to the other person\nbut also enriched your own heart.",
                            patience: "How precious was that time you waited and endured.\nPatience is not weakness but an expression of deep love.\nThat waiting created miracles.",
                            kindness: "Your kindness might have been a small action\nbut it completely changed someone's day.\nKindness is light that spreads throughout the world.",
                            sacrifice: "That heart that put yourself aside and thought of others first,\nthat was true love, not selfishness.\nSacrifice is the most noble form of love.",
                            protection: "How brave was that heart that tried to protect someone.\nThe desire to protect comes from instinctive love.\nYou were a safe harbor for someone.",
                            acceptance: "Your heart that accepted them as they were\nwas probably the greatest gift in the world for that person.\nAcceptance is the deepest language of love.",
                            generosity: "That heart that shared created true abundance.\nA giving heart makes the giver happier than the receiver.\nGenerosity comes from abundance of heart.",
                            mercy: "In the moment you showed mercy, you became an angel.\nThat mercy healed wounds and planted hope.\nA merciful heart is the most beautiful power.",
                            comfort: "How warm was that touch of comfort you gave.\nComfort is conveyed not through words but through heart.\nYour comfort helped heal someone's wounds.",
                            general: "That definition is proof that you have lived compassion not just in words but in life."
                        },
                        pt: {
                            forgiveness: "Perdao nao foi para outros, mas uma escolha para voce mesmo.\nAtravÃ©s daquele perdao voce se libertou e se tornou pessoa maior.\nA capacidade de perdoar e verdadeira forca.",
                            understanding: "Seu coracao que tentou entender e belo.\nAquela compreensao ajudou nao apenas a outra pessoa mas tambem voce a crescer.\nCompreender e a coragem de construir pontes de conexao.",
                            helping: "No momento em que ajudou, voce tornou o mundo um pouco mais caloroso.\nAquela ajuda foi significativa nao apenas para a outra pessoa\nmas tambem enriqueceu seu proprio coracao.",
                            patience: "Quao precioso foi aquele tempo que esperou e suportou.\nPaciencia nao e fraqueza mas expressao de amor profundo.\nAquela espera criou milagres.",
                            kindness: "Sua gentileza pode ter sido pequena acao\nmas mudou completamente o dia de alguem.\nGentileza e luz que se espalha pelo mundo.",
                            sacrifice: "Aquele coracao que se colocou de lado e pensou nos outros primeiro,\naquilo foi amor verdadeiro, nao egoismo.\nSacrificio e a forma mais nobre de amor.",
                            protection: "Quao corajoso foi aquele coracao que tentou proteger alguem.\nO desejo de proteger vem do amor instintivo.\nVoce foi porto seguro para alguem.",
                            acceptance: "Seu coracao que os aceitou como eram\nfoi provavelmente o maior presente do mundo para aquela pessoa.\nAceitacao e a linguagem mais profunda do amor.",
                            generosity: "Aquele coracao que compartilhou criou verdadeira abundancia.\nCoracao generoso faz o doador mais feliz que o receptor.\nGenerosidade vem da abundancia do coracao.",
                            mercy: "No momento em que mostrou misericordia, voce se tornou anjo.\nAquela misericordia curou feridas e plantou esperanca.\nCoracao misericordioso e o poder mais belo.",
                            comfort: "Quao caloroso foi aquele toque de conforto que deu.\nConforto e transmitido nao atraves de palavras mas do coracao.\nSeu conforto ajudou a curar as feridas de alguem.",
                            general: "Essa definicao e prova de que voce viveu compaixao nao apenas em palavras mas na vida."
                        }
                    };
                    
                    return responses[lang][compassionType] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ğŸ§˜",
                getResponse: (userInput, lang) => {
                    const compassionType = analyzeCompassionType(userInput);
                    
                    const responses = {
                        ko: {
                            forgiveness: "ìš©ì„œëŠ” ê³¼ê±°ë¥¼ ì§€ìš°ëŠ” ê²ƒì´ ì•„ë‹ˆë¼\nê·¸ ê²½í—˜ì„ ì§€í˜œë¡œ ë³€í™”ì‹œí‚¤ëŠ” ì—°ê¸ˆìˆ ì´ì—ìš”.\në‹¹ì‹ ì€ ìš©ì„œë¥¼ í†µí•´ ììœ ë¡œì›Œì¡Œì–´ìš”.",
                            understanding: "ì´í•´ëŠ” íŒë‹¨ì„ ë©ˆì¶”ëŠ” ìš©ê¸°ì—ìš”.\nê·¸ ìˆœê°„ ë‹¹ì‹ ì€ ì§„ë¦¬ì— í•œ ê±¸ìŒ ë” ê°€ê¹Œì›Œì¡Œì–´ìš”.\nì´í•´í•˜ëŠ” ë§ˆìŒì´ ì„¸ìƒì„ ë°”ê¿”ìš”.",
                            helping: "ë„ì›€ì€ ì£¼ê³ ë°›ëŠ” ê²ƒì´ ì•„ë‹ˆë¼\nì„œë¡œ ì—°ê²°ë˜ì–´ ìˆìŒì„ í™•ì¸í•˜ëŠ” ì¼ì´ì—ìš”.\nê·¸ ìˆœê°„ ë‹¹ì‹ ë„ ë„ì›€ì„ ë°›ì•˜ì–´ìš”.",
                            patience: "ì¸ë‚´ëŠ” ì‹œê°„ì„ ê²¬ë””ëŠ” ê²ƒì´ ì•„ë‹ˆë¼\nì‹œê°„ì„ ì´ˆì›”í•˜ëŠ” ì‚¬ë‘ì´ì—ìš”.\nê·¸ ê¸°ë‹¤ë¦¼ ì†ì—ì„œ ì§„ì •í•œ ë³€í™”ê°€ ì¼ì–´ë‚¬ì–´ìš”.",
                            kindness: "ì¹œì ˆì€ ê³„ì‚° ì—†ëŠ” ë§ˆìŒì˜ ìì—°ìŠ¤ëŸ¬ìš´ íë¦„ì´ì—ìš”.\nê·¸ ì¹œì ˆì´ ì„¸ìƒì— ì„ í•œ ì—ë„ˆì§€ë¥¼ ë”í–ˆì–´ìš”.\nì‘ì€ ì¹œì ˆì´ í° ë³€í™”ë¥¼ ë§Œë“¤ì–´ìš”.",
                            sacrifice: "ì§„ì •í•œ í¬ìƒì€ ìƒëŠ” ê²ƒì´ ì•„ë‹ˆë¼\në” í° ì‚¬ë‘ì„ ë°œê²¬í•˜ëŠ” ì¼ì´ì—ìš”.\nê·¸ í¬ìƒì„ í†µí•´ ë‹¹ì‹ ì€ ë” ê¹Šì–´ì¡Œì–´ìš”.",
                            protection: "ë³´í˜¸í•˜ëŠ” ë§ˆìŒì€ ìƒëª…ì— ëŒ€í•œ ê²½ì™¸ì—ì„œ ë‚˜ì™€ìš”.\nê·¸ ë³´í˜¸ê°€ ëˆ„êµ°ê°€ì˜ ìƒëª…ì„ ì‚´ë ¸ì„ì§€ë„ ëª°ë¼ìš”.\në³´í˜¸ëŠ” ê°€ì¥ ì›ì´ˆì ì¸ ì‚¬ë‘ì´ì—ìš”.",
                            acceptance: "ìˆ˜ìš©ì€ ì €í•­ì„ ë©ˆì¶”ëŠ” í‰í™”ë¡œìš´ í•­ë³µì´ì—ìš”.\nê·¸ ìˆ˜ìš©ì´ ìƒì²˜ë¥¼ ì¹˜ìœ í•˜ê³  ì„±ì¥ì„ ê°€ëŠ¥í•˜ê²Œ í–ˆì–´ìš”.\nìˆ˜ìš©í•˜ëŠ” ë§ˆìŒì´ ê¸°ì ì„ ë§Œë“¤ì–´ìš”.",
                            generosity: "ê´€ëŒ€í•¨ì€ ë§ˆìŒì˜ ì—¬ìœ ì—ì„œ ë‚˜ì˜¤ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ íë¦„ì´ì—ìš”.\nê·¸ ê´€ëŒ€í•¨ì´ í’ìš”ë¡œìš´ ìˆœí™˜ì„ ë§Œë“¤ì–´ëƒˆì–´ìš”.\në² í‘¸ëŠ” ë§ˆìŒì´ ë°›ëŠ” ë§ˆìŒì„ í‚¤ì›Œìš”.",
                            mercy: "ìë¹„ëŠ” ëª¨ë“  ì¡´ì¬ì— ëŒ€í•œ ê¹Šì€ ì—°ë¯¼ì—ì„œ ì‹œì‘ë¼ìš”.\nê·¸ ìë¹„ê°€ ì„¸ìƒì˜ ê³ í†µì„ ì¤„ì˜€ì–´ìš”.\nìë¹„ë¡œìš´ ë§ˆìŒì´ í‰í™”ë¥¼ ë§Œë“¤ì–´ìš”.",
                            comfort: "ìœ„ë¡œëŠ” ìƒì²˜ë°›ì€ ì˜í˜¼ì—ê²Œ ì „í•˜ëŠ” ì¹˜ìœ ì˜ ì—ë„ˆì§€ì˜ˆìš”.\nê·¸ ìœ„ë¡œê°€ ì ˆë§ì„ í¬ë§ìœ¼ë¡œ ë°”ê¿¨ì–´ìš”.\nìœ„ë¡œí•˜ëŠ” ë§ˆìŒì´ ìƒëª…ì„ êµ¬í•´ìš”.",
                            general: "ì´ì œ ìë¹„ëŠ” ë‹¹ì‹ ì˜ ì„ íƒì´ì ë¬´ê¸°ì˜ˆìš”.\nìƒì²˜ë¥¼ ëŠëŠ” í˜, ê·¸ë¦¬ê³  ì´ì–´ì£¼ëŠ” ë‹¤ë¦¬."
                        },
                        en: {
                            forgiveness: "Forgiveness is not erasing the past\nbut alchemy that transforms experience into wisdom.\nYou became free through forgiveness.",
                            understanding: "Understanding is the courage to stop judging.\nIn that moment you came one step closer to truth.\nAn understanding heart changes the world.",
                            helping: "Help is not giving and receiving\nbut confirming that we are connected to each other.\nIn that moment you also received help.",
                            patience: "Patience is not enduring time\nbut love that transcends time.\nTrue change happened in that waiting.",
                            kindness: "Kindness is the natural flow of an uncalculating heart.\nThat kindness added good energy to the world.\nSmall kindness creates big change.",
                            sacrifice: "True sacrifice is not losing\nbut discovering greater love.\nThrough that sacrifice you became deeper.",
                            protection: "A protective heart comes from reverence for life.\nThat protection might have saved someone's life.\nProtection is the most primal love.",
                            acceptance: "Acceptance is peaceful surrender that stops resistance.\nThat acceptance healed wounds and enabled growth.\nAn accepting heart creates miracles.",
                            generosity: "Generosity is natural flow from abundance of heart.\nThat generosity created abundant circulation.\nA giving heart nurtures a receiving heart.",
                            mercy: "Mercy begins with deep compassion for all beings.\nThat mercy reduced the world's suffering.\nA merciful heart creates peace.",
                            comfort: "Comfort is healing energy conveyed to wounded souls.\nThat comfort turned despair into hope.\nA comforting heart saves lives.",
                            general: "Now compassion is both your choice and your weapon.\nThe power to stop wounds, and the bridge that connects."
                        },
                        pt: {
                            forgiveness: "Perdao nao e apagar o passado\nmas alquimia que transforma experiencia em sabedoria.\nVoce se libertou atraves do perdao.",
                            understanding: "Compreensao e a coragem de parar de julgar.\nNaquele momento voce chegou um passo mais perto da verdade.\nCoracao compreensivo muda o mundo.",
                            helping: "Ajuda nao e dar e receber\nmas confirmar que estamos conectados uns aos outros.\nNaquele momento voce tambem recebeu ajuda.",
                            patience: "Paciencia nao e suportar tempo\nmas amor que transcende tempo.\nMudanca verdadeira aconteceu naquela espera.",
                            kindness: "Gentileza e fluxo natural de coracao que nao calcula.\nAquela gentileza adicionou energia boa ao mundo.\nPequena gentileza cria grande mudanca.",
                            sacrifice: "Sacrificio verdadeiro nao e perder\nmas descobrir amor maior.\nAtravÃ©s daquele sacrificio voce se tornou mais profundo.",
                            protection: "Coracao protetor vem da reverencia pela vida.\nAquela protecao pode ter salvado a vida de alguem.\nProtecao e o amor mais primitivo.",
                            acceptance: "Aceitacao e rendiÃ§Ã£o pacifica que para resistencia.\nAquela aceitacao curou feridas e possibilitou crescimento.\nCoracao que aceita cria milagres.",
                            generosity: "Generosidade e fluxo natural da abundancia do coracao.\nAquela generosidade criou circulacao abundante.\nCoracao generoso nutre coracao receptivo.",
                            mercy: "Misericordia comeca com compaixao profunda por todos os seres.\nAquela misericordia reduziu o sofrimento do mundo.\nCoracao misericordioso cria paz.",
                            comfort: "Conforto e energia curativa transmitida a almas feridas.\nAquele conforto transformou desespero em esperanca.\nCoracao consolador salva vidas.",
                            general: "Agora compaixao e tanto sua escolha quanto sua arma.\nO poder de parar feridas, e a ponte que conecta."
                        }
                    };
                    
                    return responses[lang][compassionType] || responses[lang]['general'];
                }
            },
            {
                name: "Ely", emoji: "ğŸ§â€â™€ï¸",
                getResponse: (userInput, lang) => {
                    const compassionType = analyzeCompassionType(userInput);
                    
                    const responses = {
                        ko: {
                            forgiveness: "ìš©ì„œëŠ” ë§ˆìŒì— í•€ ê½ƒ ê°™ì•„ìš”.\nê·¸ ê½ƒì´ ìƒì²˜ë‚œ ë•…ì„ ë‹¤ì‹œ ì•„ë¦„ë‹µê²Œ ë§Œë“¤ì—ˆì–´ìš”.\nìš©ì„œí•˜ëŠ” ë§ˆìŒì´ì•¼ë§ë¡œ ê°€ì¥ ìš°ì•„í•œ í˜ì´ì—ìš”.",
                            understanding: "ì´í•´ëŠ” ë§ˆìŒì˜ ë‹¤ë¦¬ë¥¼ ë†“ëŠ” ì¼ì´ì—ìš”.\nê·¸ ë‹¤ë¦¬ë¥¼ í†µí•´ ë‘ ë§ˆìŒì´ ë§Œë‚¬ì–´ìš”.\nì´í•´í•˜ëŠ” ìˆœê°„, ì„¸ìƒì´ ì¡°ê¸ˆ ë” ë”°ëœ»í•´ì ¸ìš”.",
                            helping: "ë„ì›€ì˜ ì†ê¸¸ì€ ì²œì‚¬ì˜ ë‚ ê°œ ê°™ì•„ìš”.\nê·¸ ë‚ ê°œê°€ ëˆ„êµ°ê°€ë¥¼ ìœ„ë¡œì˜ í•˜ëŠ˜ë¡œ ë°ë ¤ê°”ì–´ìš”.\nì‘ì€ ë„ì›€ì´ í° ê¸°ì ì„ ë§Œë“¤ì–´ë‚´ìš”.",
                            patience: "ê¸°ë‹¤ë¦¼ì€ ì‚¬ë‘ì˜ ê°€ì¥ ì•„ë¦„ë‹¤ìš´ í‘œí˜„ì´ì—ìš”.\nê·¸ ê¸°ë‹¤ë¦¼ì´ ì™„ë²½í•œ íƒ€ì´ë°ì„ ë§Œë“¤ì–´ëƒˆì–´ìš”.\nì¸ë‚´í•˜ëŠ” ë§ˆìŒì´ ê°€ì¥ ê¹Šì€ ì‚¬ë‘ì´ì—ìš”.",
                            kindness: "ì¹œì ˆì€ ë§ˆìŒì—ì„œ í”¼ì–´ë‚˜ëŠ” í–¥ê¸° ê°™ì•„ìš”.\nê·¸ í–¥ê¸°ê°€ ì£¼ë³€ì„ í–¥ê¸°ë¡­ê²Œ ë§Œë“¤ì—ˆì–´ìš”.\nì¹œì ˆí•œ ë§ˆìŒì€ ì„¸ìƒì˜ ë³´ë¬¼ì´ì—ìš”.",
                            sacrifice: "í¬ìƒì€ ì‚¬ë‘ì˜ ê°€ì¥ ìˆ­ê³ í•œ ì‹œ ê°™ì•„ìš”.\nê·¸ ì‹œê°€ ëˆ„êµ°ê°€ì˜ ë§ˆìŒì— ì˜ì›íˆ ìƒˆê²¨ì¡Œì–´ìš”.\nìì‹ ì„ ë‚´ì–´ì£¼ëŠ” ë§ˆìŒì´ ê°€ì¥ ì•„ë¦„ë‹¤ì›Œìš”.",
                            protection: "ë³´í˜¸í•˜ëŠ” ë§ˆìŒì€ ë”°ëœ»í•œ ë‘¥ì§€ ê°™ì•„ìš”.\nê·¸ ë‘¥ì§€ê°€ ëˆ„êµ°ê°€ì—ê²Œ ì•ˆì „í•œ ì‰¼í„°ê°€ ë˜ì—ˆì–´ìš”.\nì§€ì¼œì£¼ëŠ” ë§ˆìŒì´ ê°€ì¥ ë“ ë“ í•œ ì‚¬ë‘ì´ì—ìš”.",
                            acceptance: "ë°›ì•„ë“¤ì´ëŠ” ë§ˆìŒì€ ë„“ì€ ë°”ë‹¤ ê°™ì•„ìš”.\nê·¸ ë°”ë‹¤ê°€ ëª¨ë“  ê²ƒì„ í’ˆì–´ì£¼ì—ˆì–´ìš”.\nìˆ˜ìš©í•˜ëŠ” ë§ˆìŒì´ ê°€ì¥ ê¹Šì€ ìë¹„ì˜ˆìš”.",
                            generosity: "ë² í‘¸ëŠ” ë§ˆìŒì€ ìƒ˜ë¬¼ ê°™ì•„ìš”.\nê·¸ ìƒ˜ë¬¼ì´ ë§ˆë¥¸ ë•…ì„ ì ì…”ì£¼ì—ˆì–´ìš”.\në‚˜ëˆ„ëŠ” ë§ˆìŒì´ í’ìš”ë¡œì›€ì„ ë§Œë“¤ì–´ìš”.",
                            mercy: "ìë¹„ëŠ” ë‹¬ë¹› ê°™ì€ ë¶€ë“œëŸ¬ìš´ ë¹›ì´ì—ìš”.\nê·¸ ë¹›ì´ ì–´ë‘  ì†ì„ ê±·ëŠ” ì´ì—ê²Œ ê¸¸ì„ ë¹„ì¶°ì£¼ì—ˆì–´ìš”.\nìë¹„ë¡œìš´ ë§ˆìŒì´ í¬ë§ì„ ë§Œë“¤ì–´ìš”.",
                            comfort: "ìœ„ë¡œëŠ” ë”°ëœ»í•œ í¬ì˜¹ ê°™ì•„ìš”.\nê·¸ í¬ì˜¹ì´ ìƒì²˜ë°›ì€ ë§ˆìŒì„ ë‹¬ë˜ì£¼ì—ˆì–´ìš”.\nìœ„ë¡œí•˜ëŠ” ë§ˆìŒì´ ì¹˜ìœ ë¥¼ ê°€ì ¸ì™€ìš”.",
                            general: "ë‹¹ì‹ ì€ ìë¹„ë¥¼ ì—°ì•½í•¨ì´ ì•„ë‹Œ ì¡´ì—„ìœ¼ë¡œ ë°”ê¾¼ ì‚¬ëŒì´ì—ìš”."
                        },
                        en: {
                            forgiveness: "Forgiveness is like a flower blooming in the heart.\nThat flower made the wounded ground beautiful again.\nA forgiving heart is the most graceful power.",
                            understanding: "Understanding is building bridges of the heart.\nThrough that bridge, two hearts met.\nIn the moment of understanding, the world becomes a little warmer.",
                            helping: "Helping hands are like angel wings.\nThose wings carried someone to the sky of comfort.\nSmall help creates big miracles.",
                            patience: "Waiting is the most beautiful expression of love.\nThat waiting created perfect timing.\nA patient heart is the deepest love.",
                            kindness: "Kindness is like fragrance blooming from the heart.\nThat fragrance made the surroundings fragrant.\nA kind heart is the world's treasure.",
                            sacrifice: "Sacrifice is like the most sublime poem of love.\nThat poem was forever engraved in someone's heart.\nA heart that gives itself is the most beautiful.",
                            protection: "A protective heart is like a warm nest.\nThat nest became a safe shelter for someone.\nA guarding heart is the most reliable love.",
                            acceptance: "An accepting heart is like a vast ocean.\nThat ocean embraced everything.\nAn accepting heart is the deepest mercy.",
                            generosity: "A giving heart is like spring water.\nThat spring water moistened dry land.\nA sharing heart creates abundance.",
                            mercy: "Mercy is soft light like moonlight.\nThat light illuminated the path for those walking in darkness.\nA merciful heart creates hope.",
                            comfort: "Comfort is like a warm embrace.\nThat embrace soothed the wounded heart.\nA comforting heart brings healing.",
                            general: "You are someone who transformed compassion from weakness into dignity."
                        },
                        pt: {
                            forgiveness: "Perdao e como flor florescendo no coracao.\nAquela flor fez a terra ferida bela novamente.\nCoracao que perdoa e o poder mais gracioso.",
                            understanding: "Compreensao e construir pontes do coracao.\nAtravÃ©s daquela ponte, dois coracoes se encontraram.\nNo momento da compreensao, o mundo fica um pouco mais caloroso.",
                            helping: "Maos que ajudam sao como asas de anjo.\nAquelas asas levaram alguem ao ceu do conforto.\nPequena ajuda cria grandes milagres.",
                            patience: "Esperar e a expressao mais bela do amor.\nAquela espera criou timing perfeito.\nCoracao paciente e o amor mais profundo.",
                            kindness: "Gentileza e como fragrancia florescendo do coracao.\nAquela fragrancia tornou os arredores perfumados.\nCoracao gentil e tesouro do mundo.",
                            sacrifice: "Sacrificio e como poema mais sublime do amor.\nAquele poema foi gravado para sempre no coracao de alguem.\nCoracao que se da e o mais belo.",
                            protection: "Coracao protetor e como ninho caloroso.\nAquele ninho se tornou abrigo seguro para alguem.\nCoracao guardiao e o amor mais confiavel.",
                            acceptance: "Coracao que aceita e como oceano vasto.\nAquele oceano abracou tudo.\nCoracao que aceita e a misericordia mais profunda.",
                            generosity: "Coracao generoso e como agua de nascente.\nAquela agua de nascente umedeceu terra seca.\nCoracao que compartilha cria abundancia.",
                            mercy: "Misericordia e luz suave como luar.\nAquela luz iluminou o caminho para aqueles andando na escuridao.\nCoracao misericordioso cria esperanca.",
                            comfort: "Conforto e como abraco caloroso.\nAquele abraco acalmou o coracao ferido.\nCoracao consolador traz cura.",
                            general: "Voce e alguem que transformou compaixao de fraqueza em dignidade."
                        }
                    };
                    
                    return responses[lang][compassionType] || responses[lang]['general'];
                }
            }
        ];
        
        // Rest of the JavaScript functions remain the same as Portal 13
        // Typewriter effect
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (state.currentTypingElement) {
                    state.currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                state.currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                state.typingIntervals.push(typingInterval);
            });
        }
        
        // Clear all typing effects
        function clearAllTypingEffects() {
            state.typingIntervals.forEach(interval => clearInterval(interval));
            state.typingIntervals = [];
            
            if (state.currentTypingElement) {
                state.currentTypingElement.classList.remove('typing-cursor');
                state.currentTypingElement = null;
            }
        }
        
        // Scroll functions
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        // Language management
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            const t = translations[lang];
            document.title = t.title;
            document.getElementById('logoSubtitle').textContent = t.logoSubtitle;
            document.getElementById('portalMainTitle').textContent = t.portalMainTitle;
            document.getElementById('portalSubtitle').textContent = t.portalSubtitle;
            document.getElementById('lightTitle').textContent = t.lightTitle;
            document.getElementById('navigationTitle').textContent = t.navigationTitle;
            document.getElementById('nextPortalBtn').textContent = t.nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = t.stayPortalBtn;
            document.getElementById('userTextarea').placeholder = t.inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (state.currentLanguage === lang) return;
            
            state.currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            resetJourney();
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        // Journey management
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            state.userResponse = '';
            state.currentTypingElement = null;
            state.awaitingSecondResponse = false;
        }
        
        // Save response to database or memory
        async function saveResponse(inputText, step) {
            const responseData = {
                portal: portalConfig.currentPortal,
                resposta: inputText,
                step: step,
                data: new Date().toISOString(),
                idioma: state.currentLanguage,
                userId: state.currentUser ? state.currentUser.uid : 'anonymous',
                userEmail: state.currentUser ? state.currentUser.email : 'anonymous@temarix.com'
            };
            
            if (state.firebaseInitialized && state.db) {
                try {
                    await state.db.collection("temarix_v5_respostas").add({
                        ...responseData,
                        timestamp: firebase.firestore.Timestamp.now()
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                    state.userResponses.push(responseData);
                    showConnectionStatus(false);
                }
            } else {
                state.userResponses.push(responseData);
                console.log('Response stored in memory:', responseData);
            }
        }
        
        // User input processing
        async function processUserInput(inputText) {
            state.userResponse = inputText;
            
            await saveResponse(inputText, state.awaitingSecondResponse ? "second" : "first");
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!state.awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[state.currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        // Show character reactions
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[state.currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                state.awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, state.currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[state.currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[state.currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        // Portal sequence
        async function startPortalSequence() {
            console.log('Starting portal sequence...');
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            console.log('Showing intro...');
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            if (!introSection || !introElement) {
                console.error('Intro elements not found!');
                return;
            }
            
            introSection.classList.add('show');
            
            const introText = translations[state.currentLanguage].portalIntro;
            console.log('Intro text:', introText);
            
            await typewriterEffect(introElement, introText, 60);
            
            setTimeout(async () => {
                await showEmotionalBridge();
            }, 2000);
        }
        
        async function showEmotionalBridge() {
            const introElement = document.getElementById('portalIntro');
            const bridgeText = '\n\n' + translations[state.currentLanguage].emotionalBridge;
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const bridgeP = document.createElement('p');
            bridgeP.style.cssText = `
                margin-top: 30px;
                font-style: italic;
                color: #ff9999;
                font-size: 18px;
                line-height: 1.8;
            `;
            introElement.appendChild(bridgeP);
            
            await typewriterEffect(bridgeP, bridgeText.trim(), 50);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        // Custom confirm dialog
        function showConfirmDialog(message, callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                font-family: 'Courier New', monospace;
            `;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: #222;
                border: 2px solid #ff6b6b;
                padding: 30px;
                max-width: 400px;
                text-align: center;
                color: white;
            `;
            
            const messageP = document.createElement('p');
            messageP.textContent = message;
            messageP.style.cssText = `
                margin-bottom: 20px;
                line-height: 1.6;
                font-size: 16px;
            `;
            
            const buttonContainer = document.createElement('div');
            buttonContainer.style.cssText = `
                display: flex;
                gap: 15px;
                justify-content: center;
            `;
            
            const yesBtn = document.createElement('button');
            const noBtn = document.createElement('button');
            
            const buttonStyle = `
                background: #444;
                color: white;
                border: 1px solid #ff6b6b;
                padding: 10px 20px;
                cursor: pointer;
                font-family: 'Courier New', monospace;
                font-size: 14px;
            `;
            
            yesBtn.style.cssText = buttonStyle + 'background: #ff6b6b;';
            noBtn.style.cssText = buttonStyle;
            
            yesBtn.textContent = state.currentLanguage === 'ko' ? 'ì˜ˆ' : 
                                state.currentLanguage === 'pt' ? 'Sim' : 'Yes';
            noBtn.textContent = state.currentLanguage === 'ko' ? 'ì•„ë‹ˆì˜¤' : 
                               state.currentLanguage === 'pt' ? 'Nao' : 'No';
            
            yesBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(true);
            };
            
            noBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(false);
            };
            
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                    callback(false);
                }
            };
            
            buttonContainer.appendChild(yesBtn);
            buttonContainer.appendChild(noBtn);
            modal.appendChild(messageP);
            modal.appendChild(buttonContainer);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            yesBtn.focus();
        }
        
        // Event setup
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function createPortalTransition(callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, #000 0%, #111 50%, #000 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 20000;
                opacity: 0;
                transition: opacity 1s ease-in-out;
                font-family: 'Courier New', monospace;
            `;
            
            const message = document.createElement('div');
            message.style.cssText = `
                color: #ff6b6b;
                font-size: 24px;
                text-align: center;
                margin-bottom: 30px;
                opacity: 0;
                transform: translateY(20px);
                transition: all 0.8s ease-out;
            `;
            message.textContent = translations[state.currentLanguage].transitionMessage;
            
            const loader = document.createElement('div');
            loader.style.cssText = `
                width: 60px;
                height: 60px;
                border: 3px solid #333;
                border-top: 3px solid #ff6b6b;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                opacity: 0;
                transition: opacity 0.8s ease-out 0.3s;
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            overlay.appendChild(message);
            overlay.appendChild(loader);
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                overlay.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                message.style.opacity = '1';
                message.style.transform = 'translateY(0)';
                loader.style.opacity = '1';
            }, 300);
            
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(overlay);
                    document.head.removeChild(style);
                    callback();
                }, 1000);
            }, 2500);
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmNextPortal, (confirmed) => {
                    if (confirmed) {
                        if (state.firebaseInitialized && state.db) {
                            state.db.collection("temarix_v5_progress").add({
                                userId: state.currentUser.uid,
                                portal: portalConfig.currentPortal,
                                status: "complete",
                                timestamp: firebase.firestore.Timestamp.now()
                            }).catch(error => console.error('Error saving progress:', error));
                        }
                        
                        createPortalTransition(() => {
                            window.location.href = `${portalConfig.nextPortalFile}?lang=${state.currentLanguage}`;
                        });
                    }
                });
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmStay, (confirmed) => {
                    if (confirmed) {
                        resetJourney();
                        setTimeout(() => {
                            startPortalSequence();
                        }, 1000);
                    }
                });
            });
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        function initializeTemarix() {
            console.log('Initializing Temarix V5 Portal 14...');
            console.log('Current state:', state);
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            state.journeyStarted = true;
            console.log('Journey started:', state.journeyStarted);
            
            console.log('Starting portal sequence in 1 second...');
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Temarix V5 Portal 14 DOM loaded');
            
            state.currentLanguage = getLanguageFromURL();
            
            updateStaticTranslations(state.currentLanguage);
            updateLanguageButtons(state.currentLanguage);
            
            await initializeFirebase();
            
            initializeTemarix();
        });
    </script>
</body>
</html>