<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V5 - Portal 13: The Day I Decided to Stop Hating Myself</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .navigation-title {
                font-size: 24px;
            }
            
            .navigation-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V5</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 13: The Day I Decided to Stop Hating Myself</div>
            <div class="portal-subtitle" id="portalSubtitle">When did I finally stop being cold to myself?</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">ğŸª Portal 13 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 14</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with this peace</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Tell me about when you hated yourself the most... (Press Enter to send)"
                      rows="1"
                      maxlength="800"></textarea>
        </div>
    </div>

    <script>
        // Global state management
        let state = {
            db: null,
            auth: null,
            firebaseInitialized: false,
            currentUser: null,
            currentLanguage: 'en',
            userResponse: '',
            journeyStarted: false,
            currentTypingElement: null,
            typingIntervals: [],
            awaitingSecondResponse: false,
            userResponses: []
        };
        
        // Portal navigation configuration
        const portalConfig = {
            currentPortal: "v5-13",
            nextPortal: "v5-14",
            nextPortalFile: "temarix_v05_14.html"
        };
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
            authDomain: "canal-vivo-chat.firebaseapp.com",
            projectId: "canal-vivo-chat",
            storageBucket: "canal-vivo-chat.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdefghijklmnopqr"
        };
        
        // Initialize Firebase with error handling
        function initializeFirebase() {
            return new Promise((resolve) => {
                try {
                    if (typeof firebase !== 'undefined') {
                        firebase.initializeApp(firebaseConfig);
                        state.db = firebase.firestore();
                        state.auth = firebase.auth();
                        state.firebaseInitialized = true;
                        
                        state.auth.onAuthStateChanged((user) => {
                            if (user) {
                                state.currentUser = user;
                            } else {
                                state.currentUser = {
                                    uid: 'anonymous-' + Date.now(),
                                    email: 'anonymous@temarix.com',
                                    isAnonymous: true
                                };
                            }
                            showConnectionStatus(true);
                        });
                        
                        console.log('Firebase initialized successfully');
                    } else {
                        console.log('Firebase SDK not loaded');
                        state.currentUser = {
                            uid: 'anonymous-' + Date.now(),
                            email: 'anonymous@temarix.com',
                            isAnonymous: true
                        };
                        showConnectionStatus(false);
                    }
                } catch (error) {
                    console.error('Firebase initialization failed:', error);
                    state.currentUser = {
                        uid: 'anonymous-' + Date.now(),
                        email: 'anonymous@temarix.com',
                        isAnonymous: true
                    };
                    showConnectionStatus(false);
                }
                resolve();
            });
        }
        
        // Show connection status to user
        function showConnectionStatus(isOnline) {
            const existingStatus = document.querySelector('.connection-status');
            if (existingStatus) {
                existingStatus.remove();
            }
            
            if (!isOnline) {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'connection-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: rgba(255, 107, 107, 0.9);
                    color: white;
                    padding: 8px 15px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-family: 'Courier New', monospace;
                    z-index: 1000;
                    opacity: 0.8;
                `;
                statusDiv.textContent = state.currentLanguage === 'ko' ? 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ' : 
                                       state.currentLanguage === 'pt' ? 'Modo offline' : 'Offline mode';
                document.body.appendChild(statusDiv);
                
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.remove();
                    }
                }, 5000);
            }
        }

        // Translations object
        const translations = {
            ko: {
                title: "Temarix V5 - Portal 13: ë”ëŠ” ë‚˜ë¥¼ ë¯¸ì›Œí•˜ì§€ ì•Šê¸°ë¡œ í•œ ë‚ ",
                logoSubtitle: "ê°ì • ì—°ê¸ˆìˆ ",
                portalMainTitle: "Portal 13: ë”ëŠ” ë‚˜ë¥¼ ë¯¸ì›Œí•˜ì§€ ì•Šê¸°ë¡œ í•œ ë‚ ",
                portalSubtitle: "ì–¸ì œ ë‚˜ëŠ” ë“œë””ì–´ ë‚˜ì—ê²Œ ì°¨ê°‘ê²Œ ëŒ€í•˜ì§€ ì•Šê¸°ë¡œ í–ˆì„ê¹Œ?",
                portalIntro: "ğŸª \"ë‹¹ì‹ ì€ ì–¸ì œ, ìŠ¤ìŠ¤ë¡œë¥¼ ê°€ì¥ ë¯¸ì›Œí–ˆë˜ ì ì´ ìˆì—ˆë‚˜ìš”?\"\n\n\"ê·¸ ìˆœê°„, ì™œ ê·¸ë ‡ê²Œ ìì‹ ì—ê²Œ ì°¨ê°‘ê²Œ ëŒ€í–ˆì„ê¹Œìš”?\"\n\n\"ê·¸ë¦¬ê³ â€¦ ì§€ê¸ˆì€ ê·¸ ê°ì •ì„ ì–´ë–»ê²Œ ë°”ë¼ë³´ì‹œë‚˜ìš”?\"",
                emotionalBridge: "ìê¸° í˜ì˜¤ëŠ” ë•Œë¡œëŠ” ë³€í™”í•˜ì§€ ëª»í•œ ë‚˜ë¥¼ í–¥í•œ ì ˆë§ì´ì—ˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.\n\ní•˜ì§€ë§Œ ìì‹ ì„ ë¯¸ì›Œí•˜ëŠ” ì‚¬ëŒì€ ëˆ„êµ¬ë³´ë‹¤ë„ 'ë‚˜'ì—ê²Œ ê°„ì ˆí•œ ê¸°ëŒ€ê°€ ìˆì—ˆë˜ ì‚¬ëŒì…ë‹ˆë‹¤.\nìš©ì„œëŠ” íƒ€ì¸ì„ í–¥í•˜ê¸° ì „ì—, ê·¸ë ‡ê²Œ ë‚˜ë¥¼ ë¯¸ì›Œí•˜ë˜ ë‚˜ë¥¼ ë°›ì•„ë“¤ì´ëŠ” ì¼ë¶€í„° ì‹œì‘ë©ë‹ˆë‹¤.",
                followUpQuestion: "ì§€ê¸ˆ ê·¸ë•Œì˜ 'ë‚˜'ì—ê²Œ ì´ë ‡ê²Œ ë§í•  ìˆ˜ ìˆë‚˜ìš”?\n'ë‚˜ëŠ” ì´ì œ ë„ˆë¥¼ ë¯¸ì›Œí•˜ì§€ ì•Šì„ ê±°ì•¼.'\nê·¸ ë§ì„, ì–´ë–¤ ë§ˆìŒìœ¼ë¡œ ì „í•˜ê² ìŠµë‹ˆê¹Œ?",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ê·¸ ì„ ì–¸ í•˜ë‚˜ë¡œ,\në‹¹ì‹ ì€ ìì‹  ì•ˆì˜ ì „ìŸì„ ë©ˆì¶˜ ì‚¬ëŒì´ ë˜ì—ˆì–´ìš”.\nê·¸ë ‡ê²Œ ë‹¹ì‹ ì´ ìì‹ ì—ê²Œ ë‹¤ì •í•´ì§ˆ ìˆ˜ ìˆì„ ë•Œ,\nì„¸ìƒë„ ë‹¹ì‹ ì„ ë‹¤ë¥´ê²Œ ëŒ€í•˜ê¸° ì‹œì‘í•  ê±°ì˜ˆìš”.",
                navigationTitle: "ğŸª Portal 13 ì™„ë£Œ",
                navigationMessage: "ë‹¹ì‹ ì€ ë” ì´ìƒ ìŠ¤ìŠ¤ë¡œë¥¼ ë¯¸ì›Œí•˜ì§€ ì•Šê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.\n\nê·¸ ì„ ì–¸ì€ ìš©ì„œì˜ ëì´ ì•„ë‹ˆë¼, ìê¸° ì¡´ì¤‘ì˜ ì‹œì‘ì…ë‹ˆë‹¤. ìì‹ ê³¼ì˜ ì „ìŸì„ ë©ˆì¶˜ ë‹¹ì‹ ì€ ì´ì œ í‰í™”ë¡œìš´ ë§ˆìŒìœ¼ë¡œ ì‚´ì•„ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nê·¸ ë‹¤ì •í•¨ì´ ë‹¹ì‹ ì˜ ì¼ìƒì„ ë°”ê¾¸ê³ , ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ì˜ ê´€ê³„ë„ ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ê°ˆ ê²ƒì…ë‹ˆë‹¤.\n\në‹¹ì‹ ì€ ìì‹ ì—ê²Œ ìë¹„ë¡œìš´ ì‚¬ëŒì´ ë˜ì—ˆìŠµë‹ˆë‹¤.",
                nextPortalBtn: "Portal 14ë¡œ ì´ì–´ê°€ê¸°",
                stayPortalBtn: "ì´ í‰í™”ì™€ ë¨¸ë¬¼ê¸°",
                inputPlaceholder: "ë‹¹ì‹ ì´ ìì‹ ì„ ê°€ì¥ ë¯¸ì›Œí–ˆë˜ ë•Œì— ëŒ€í•´ ë§í•´ì£¼ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...",
                confirmNextPortal: "Portal 14: ìë¹„ëŠ” ì—°ì•½í•¨ì´ ì•„ë‹ˆì—ˆë‹¤ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                confirmStay: "ì´ ë‚´ì  í‰í™”ì™€ ë” ë¨¸ë¬¼ë©° ìê¸° ìˆ˜ìš©ì˜ ê°ì •ì„ ë” ê¹Šì´ ëŠë¼ì‹œê² ìŠµë‹ˆê¹Œ?",
                transitionMessage: "ìƒˆë¡œìš´ ì—¬ì •ì´ ì‹œì‘ë©ë‹ˆë‹¤..."
            },
            en: {
                title: "Temarix V5 - Portal 13: The Day I Decided to Stop Hating Myself",
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 13: The Day I Decided to Stop Hating Myself",
                portalSubtitle: "When did I finally stop being cold to myself?",
                portalIntro: "ğŸª \"When was the time you hated yourself the most?\"\n\n\"In that moment, why were you so cold to yourself?\"\n\n\"Andâ€¦ how do you view that feeling now?\"",
                emotionalBridge: "Self-hatred might have been despair toward a self that couldn't change.\n\nBut someone who hates themselves is someone who had the most earnest expectations for 'me.'\nForgiveness starts not with others, but with accepting the me who used to hate myself.",
                followUpQuestion: "Can you say this to that past 'me' now?\n'I will no longer hate you.'\nWith what heart would you convey those words?",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "With that one declaration,\nyou became someone who stopped the war within yourself.\nWhen you can be gentle with yourself like this,\nthe world will also begin to treat you differently.",
                navigationTitle: "ğŸª Portal 13 Complete",
                navigationMessage: "You have decided to no longer hate yourself.\n\nThat declaration is not the end of forgiveness, but the beginning of self-respect. Having stopped the war with yourself, you can now live with a peaceful heart.\n\nThat gentleness will transform your daily life and create new relationships with others.\n\nYou have become someone who is compassionate to yourself.",
                nextPortalBtn: "Continue to Portal 14",
                stayPortalBtn: "Stay with this peace",
                inputPlaceholder: "Tell me about when you hated yourself the most... (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response...",
                confirmNextPortal: "Do you want to continue to Portal 14: Compassion Was Not Weakness?",
                confirmStay: "Do you want to stay longer with this inner peace and feel self-acceptance more deeply?",
                transitionMessage: "A new journey begins..."
            },
            pt: {
                title: "Temarix V5 - Portal 13: O Dia em que Decidi Parar de Me Odiar",
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 13: O Dia em que Decidi Parar de Me Odiar",
                portalSubtitle: "Quando finalmente parei de ser frio comigo mesmo?",
                portalIntro: "ğŸª \"Quando foi a epoca em que mais se odiou?\"\n\n\"Naquele momento, por que foi tao frio consigo mesmo?\"\n\n\"Eâ€¦ como ve esse sentimento agora?\"",
                emotionalBridge: "O auto-odio pode ter sido desespero em relacao a um eu que nao conseguia mudar.\n\nMas alguem que se odeia e alguem que tinha as expectativas mais sinceras para 'mim.'\nO perdao comeca nao com outros, mas aceitando o eu que costumava me odiar.",
                followUpQuestion: "Pode dizer isto ao 'eu' do passado agora?\n'Nao vou mais te odiar.'\nCom que coracao transmitiria essas palavras?",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Com essa unica declaracao,\nvoce se tornou alguem que parou a guerra dentro de si mesmo.\nQuando conseguir ser gentil consigo mesmo assim,\no mundo tambem comecara a trata-lo de forma diferente.",
                navigationTitle: "ğŸª Portal 13 Completo",
                navigationMessage: "Voce decidiu nao mais se odiar.\n\nEssa declaracao nao e o fim do perdao, mas o inicio do auto-respeito. Tendo parado a guerra consigo mesmo, agora pode viver com um coracao pacifico.\n\nEssa gentileza transformara sua vida diaria e criara novos relacionamentos com outros.\n\nVoce se tornou alguem que e compassivo consigo mesmo.",
                nextPortalBtn: "Continuar para Portal 14",
                stayPortalBtn: "Ficar com esta paz",
                inputPlaceholder: "Conte-me sobre quando mais se odiou... (Enter para enviar)",
                youLabel: "Voce",
                waitingMessage: "Aguardando resposta...",
                confirmNextPortal: "Deseja continuar para Portal 14: Compaixao Nao Era Fraqueza?",
                confirmStay: "Deseja ficar mais tempo com esta paz interior e sentir a auto-aceitacao mais profundamente?",
                transitionMessage: "Uma nova jornada comeca..."
            }
        };
        
        // Character definitions
        const characters = [
            { name: "Noah", emoji: "ğŸ§‘â€ğŸ¦±", text: {
                ko: "ê·¸ ë§, ë‚˜ë„ í•´ë´¤ì–´.\nê·¼ë° ì§„ì§œë¡œ ê·¸ ë§ì´ í•„ìš”í–ˆì„ê¹Œ?\nì•„ë‹ˆì•¼. ë„Œ ê·¸ì € ì§€ì³ ìˆì—ˆë˜ ê±°ì•¼.",
                en: "I've said those words too.\nBut did you really need to say them?\nNo. You were just exhausted.",
                pt: "Eu disse essas palavras tambem.\nMas voce realmente precisava dize-las?\nNao. Voce estava apenas exausto."
            }},
            { name: "Ely", emoji: "ğŸ§â€â™€ï¸", text: {
                ko: "ìê¸° í˜ì˜¤ëŠ”,\nì‚¬ì‹¤ ë³€í™”í•˜ì§€ ëª»í•œ ë‚˜ë¥¼ í–¥í•œ ì ˆë§ì´ì—ˆì„ì§€ë„ ëª°ë¼ìš”.",
                en: "Self-hatred\nmight have been despair toward a self that couldn't change.",
                pt: "Auto-odio\npode ter sido desespero em relacao a um eu que nao conseguia mudar."
            }},
            { name: "Sora", emoji: "ğŸ§•", text: {
                ko: "ê·¸ë‚ ì˜ ë‹¹ì‹ ì€â€¦ ë¯¸ì›Œí•œ ê²Œ ì•„ë‹ˆë¼ ë‹¤ í¬ê¸°í•˜ê³  ì‹¶ì—ˆë˜ ê±°ì˜€ì–´ìš”.",
                en: "That day you... didn't hate, but wanted to give up on everything.",
                pt: "Naquele dia voce... nao odiava, mas queria desistir de tudo."
            }},
            { name: "Kael", emoji: "ğŸ§™", text: {
                ko: "ìì‹ ì„ ë¯¸ì›Œí•˜ëŠ” ì‚¬ëŒì€\nëˆ„êµ¬ë³´ë‹¤ë„ 'ë‚˜'ì—ê²Œ ê°„ì ˆí•œ ê¸°ëŒ€ê°€ ìˆì—ˆë˜ ì‚¬ëŒì´ì£ .",
                en: "Someone who hates themselves\nis someone who had the most earnest expectations for 'me.'",
                pt: "Alguem que se odeia\ne alguem que tinha as expectativas mais sinceras para 'mim'."
            }},
            { name: "Mira", emoji: "ğŸ§‘â€ğŸ¨", text: {
                ko: "ê·¸ ë¯¸ì›€ì¡°ì°¨ë„ ì‚¬ì‹¤ì€ ì‚¬ë‘ì˜ ë°˜ëŒ€ë§ì´ ì•„ë‹ˆë¼,\nì‚¬ë‘ì„ ìƒì€ ì±„ ë°©í™©í•˜ëŠ” ê°ì •ì´ì—ˆì–´ìš”.",
                en: "Even that hatred wasn't really the opposite of love,\nbut an emotion wandering after losing love.",
                pt: "Mesmo aquele odio nao era realmente o oposto do amor,\nmas uma emocao vagando depois de perder o amor."
            }},
            { name: "Cris", emoji: "ğŸ¦¸â€â™‚ï¸", text: {
                ko: "ë•Œë•Œë¡œ ìš°ë¦° ìŠ¤ìŠ¤ë¡œë¥¼ ê°€ì¥ ê°€í˜¹í•˜ê²Œ ëŒ€í•´.\nê·¸ê±´, ë‚¨ë“¤ì´ ê·¸ëŸ¬ê¸° ì „ì— ë‚´ê°€ ë‚˜ë¥¼ ë‹¤ê·¸ì¹˜ë ¤ëŠ” ë°©ì–´ì•¼.",
                en: "Sometimes we treat ourselves most harshly.\nIt's a defense - scolding myself before others do.",
                pt: "As vezes nos tratamos mais duramente.\nE uma defesa - me repreendendo antes que outros o facam."
            }},
            { name: "Enya", emoji: "ğŸ§‘â€ğŸš€", text: {
                ko: "ë„ˆëŠ” ê·¸ë‚  ë„ˆë¥¼ ë¯¸ì›Œí–ˆì§€ë§Œ,\nì˜¤ëŠ˜ ë„ˆëŠ” ê·¸ë•Œì˜ ë„ˆë¥¼ ê¸°ì–µí•˜ê³  ìˆì–´.\nê·¸ê±´ ì´ë¯¸ ìë¹„ì˜ ì‹œì‘ì´ì•¼.",
                en: "You hated yourself that day,\nbut today you remember that you.\nThat's already the beginning of compassion.",
                pt: "Voce se odiou naquele dia,\nmas hoje voce se lembra daquele voce.\nIsso ja e o inicio da compaixao."
            }},
            { name: "Lian", emoji: "ğŸ§˜", text: {
                ko: "ìš©ì„œëŠ” íƒ€ì¸ì„ í–¥í•œ ê²Œ ì•„ë‹ˆë¼,\nê·¸ë ‡ê²Œ ë‚˜ë¥¼ ë¯¸ì›Œí•˜ë˜ ë‚˜ë¥¼ ë°›ì•„ë“¤ì´ëŠ” ì¼ë¶€í„° ì‹œì‘ë¼ìš”.",
                en: "Forgiveness doesn't start with others,\nbut with accepting the me who used to hate myself.",
                pt: "O perdao nao comeca com outros,\nmas aceitando o eu que costumava me odiar."
            }}
        ];

        // Support type analysis function
        function analyzeSelfHatredType(userInput) {
            const input = userInput.toLowerCase();
            
            const hatredKeywords = {
                perfectionism: ['perfect', 'failed', 'mistake', 'not good enough', 'ì™„ë²½', 'ì‹¤íŒ¨', 'ì‹¤ìˆ˜', 'ë¶€ì¡±', 'perfeito', 'falhou', 'erro', 'nao bom o suficiente'],
                comparison: ['others', 'everyone else', 'better than', 'comparing', 'ë‹¤ë¥¸ ì‚¬ëŒ', 'ë‚¨ë“¤', 'ë¹„êµ', 'outros', 'todos os outros', 'melhor que', 'comparando'],
                appearance: ['ugly', 'fat', 'look', 'body', 'ëª»ìƒê²¼', 'ëš±ëš±', 'ì™¸ëª¨', 'ëª¸', 'feio', 'gordo', 'aparencia', 'corpo'],
                achievement: ['stupid', 'dumb', 'smart enough', 'grades', 'ë°”ë³´', 'ë©ì²­', 'ì„±ì ', 'estupido', 'burro', 'inteligente o suficiente', 'notas'],
                social: ['alone', 'friends', 'rejected', 'nobody likes', 'í˜¼ì', 'ì¹œêµ¬', 'ê±°ì ˆ', 'ì•„ë¬´ë„ ì¢‹ì•„í•˜ì§€', 'sozinho', 'amigos', 'rejeitado', 'ninguem gosta'],
                emotional: ['weak', 'sensitive', 'cry', 'emotional', 'ì•½í•´', 'ì˜ˆë¯¼', 'ìš¸ì–´', 'ê°ì •ì ', 'fraco', 'sensivel', 'chorar', 'emocional'],
                family: ['disappoint', 'parents', 'family', 'expectations', 'ì‹¤ë§', 'ë¶€ëª¨', 'ê°€ì¡±', 'ê¸°ëŒ€', 'decepcionar', 'pais', 'familia', 'expectativas'],
                self_worth: ['worthless', 'useless', 'burden', 'waste', 'ì“¸ëª¨ì—†', 'ì§', 'ë‚­ë¹„', 'inutil', 'fardo', 'desperdicio'],
                guilt: ['guilty', 'wrong', 'bad person', 'hurt others', 'ì£„ì±…ê°', 'ì˜ëª»', 'ë‚˜ìœ ì‚¬ëŒ', 'ìƒì²˜ì¤¬', 'culpado', 'errado', 'pessoa ma', 'machucar outros'],
                past: ['regret', 'should have', 'if only', 'past mistakes', 'í›„íšŒ', 'ê·¸ë¬ì–´ì•¼', 'ë§Œì•½ì—', 'ê³¼ê±° ì‹¤ìˆ˜', 'arrependimento', 'deveria ter', 'se apenas', 'erros passados'],
                control: ['helpless', 'powerless', 'can\'t control', 'overwhelmed', 'ë¬´ë ¥', 'í†µì œí•  ìˆ˜ ì—†', 'ì••ë„', 'desamparado', 'impotente', 'nao posso controlar', 'sobrecarregado'],
                general: ['hate myself', 'disgusted', 'ashamed', 'pathetic', 'ìì‹ ì´ ì‹«ì–´', 'í˜ì˜¤', 'ë¶€ë„ëŸ¬ì›Œ', 'í•œì‹¬', 'me odeio', 'nojento', 'envergonhado', 'patetico']
            };
            
            let detectedTypes = [];
            for (const [type, keywords] of Object.entries(hatredKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedTypes.push(type);
                        break;
                    }
                }
            }
            
            if (detectedTypes.length === 0) {
                detectedTypes = ['general'];
            }
            
            return detectedTypes[0];
        }
        
        // Response characters with hatred-based responses
        const responseCharacters = [
            {
                name: "Sora", emoji: "ğŸ§•",
                getResponse: (userInput, lang) => {
                    const hatredType = analyzeSelfHatredType(userInput);
                    
                    const responses = {
                        ko: {
                            perfectionism: "ì™„ë²½í•˜ì§€ ì•Šë‹¤ê³  ìì‹ ì„ ë¯¸ì›Œí–ˆêµ°ìš”.\ní•˜ì§€ë§Œ ì™„ë²½í•¨ì´ë€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê¸°ì¤€ì´ì—ìš”.\në‹¹ì‹ ì€ ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ì¶©ë¶„íˆ ì†Œì¤‘í•œ ì‚¬ëŒì…ë‹ˆë‹¤.",
                            comparison: "ë‹¤ë¥¸ ì‚¬ëŒê³¼ ë¹„êµí•˜ë©° ìì‹ ì„ ê¹ì•„ë‚´ë ¸êµ°ìš”.\ní•˜ì§€ë§Œ ëª¨ë“  ì‚¬ëŒì€ ë‹¤ë¥¸ ì†ë„ë¡œ, ë‹¤ë¥¸ ë°©í–¥ìœ¼ë¡œ ì„±ì¥í•´ìš”.\në‹¹ì‹ ë§Œì˜ ê¸¸ì´ ìˆì–´ìš”.",
                            appearance: "ì™¸ëª¨ ë•Œë¬¸ì— ìì‹ ì„ ë¯¸ì›Œí–ˆë‚˜ìš”?\ní•˜ì§€ë§Œ ë‹¹ì‹ ì˜ ê°€ì¹˜ëŠ” ê²‰ëª¨ìŠµì— ìˆì§€ ì•Šì•„ìš”.\në‹¹ì‹ ì˜ ë§ˆìŒê³¼ ì¡´ì¬ ìì²´ê°€ ì•„ë¦„ë‹¤ì›Œìš”.",
                            achievement: "ì„±ê³¼ë‚˜ ì„±ì  ë•Œë¬¸ì— ìŠ¤ìŠ¤ë¡œë¥¼ íƒ“í–ˆêµ°ìš”.\ní•˜ì§€ë§Œ ë‹¹ì‹ ì˜ ê°€ì¹˜ëŠ” ì„±ì·¨ë¡œ ì¦ëª…ë˜ëŠ” ê²Œ ì•„ë‹ˆì—ìš”.\në‹¹ì‹ ì€ ì¡´ì¬í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ì˜ë¯¸ ìˆëŠ” ì‚¬ëŒì´ì—ìš”.",
                            social: "í˜¼ìë¼ê³  ëŠë¼ë©° ìì‹ ì„ ë¯¸ì›Œí–ˆë‚˜ìš”?\ní•˜ì§€ë§Œ ì™¸ë¡œì›€ì€ ë‹¹ì‹ ì˜ ì˜ëª»ì´ ì•„ë‹ˆì—ìš”.\nì§„ì •í•œ ì—°ê²°ì„ ì°¾ì•„ê°€ëŠ” ê³¼ì •ì¼ ë¿ì´ì—ìš”.",
                            emotional: "ê°ì •ì ì´ë¼ê³  ìì‹ ì„ íƒ“í–ˆêµ°ìš”.\ní•˜ì§€ë§Œ ê°ì •ì€ ë‹¹ì‹ ì˜ ì•½ì ì´ ì•„ë‹ˆë¼ ê°•ì ì´ì—ìš”.\nì„¸ìƒì„ ê¹Šì´ ëŠë‚„ ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì´ì£ .",
                            family: "ê°€ì¡±ì„ ì‹¤ë§ì‹œì¼°ë‹¤ê³  ìì‹ ì„ ë¯¸ì›Œí–ˆë‚˜ìš”?\ní•˜ì§€ë§Œ ë‹¹ì‹ ì€ ë‹¤ë¥¸ ì‚¬ëŒì˜ ê¸°ëŒ€ê°€ ì•„ë‹Œ,\nìì‹ ì˜ ì‚¶ì„ ì‚´ì•„ê°ˆ ê¶Œë¦¬ê°€ ìˆì–´ìš”.",
                            self_worth: "ìì‹ ì´ ì“¸ëª¨ì—†ë‹¤ê³  ëŠê¼ˆêµ°ìš”.\ní•˜ì§€ë§Œ ë‹¹ì‹ ì˜ ì¡´ì¬ ìì²´ê°€ ì´ ì„¸ìƒì— ì˜ë¯¸ë¥¼ ì¤˜ìš”.\në‹¹ì‹ ì´ ì—†ì—ˆë‹¤ë©´ ì§€ê¸ˆì˜ ì´ ìˆœê°„ë„ ì—†ì—ˆì„ ê±°ì˜ˆìš”.",
                            guilt: "ì£„ì±…ê°ì— ì‹œë‹¬ë¦¬ë©° ìì‹ ì„ ë¯¸ì›Œí–ˆêµ°ìš”.\ní•˜ì§€ë§Œ ì‹¤ìˆ˜ëŠ” ì¸ê°„ì´ê¸°ì— í•˜ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ì¼ì´ì—ìš”.\nê·¸ ì‹¤ìˆ˜ë“¤ì´ ë‹¹ì‹ ì„ ë” ì§€í˜œë¡­ê²Œ ë§Œë“¤ì—ˆì–´ìš”.",
                            past: "ê³¼ê±°ë¥¼ í›„íšŒí•˜ë©° ìì‹ ì„ íƒ“í–ˆë‚˜ìš”?\ní•˜ì§€ë§Œ ê³¼ê±°ëŠ” ë°”ê¿€ ìˆ˜ ì—†ê³ , ë¯¸ë˜ëŠ” ì•„ì§ ì™€ìˆì§€ ì•Šì•˜ì–´ìš”.\nì§€ê¸ˆ ì´ ìˆœê°„, ë‹¹ì‹ ì€ ìƒˆë¡­ê²Œ ì‹œì‘í•  ìˆ˜ ìˆì–´ìš”.",
                            control: "í†µì œí•  ìˆ˜ ì—†ëŠ” ìƒí™©ì— ì¢Œì ˆí–ˆêµ°ìš”.\ní•˜ì§€ë§Œ ëª¨ë“  ê²ƒì„ í†µì œí•  í•„ìš”ëŠ” ì—†ì–´ìš”.\në‹¹ì‹ ì€ ì£¼ì–´ì§„ ìƒí™©ì—ì„œ ìµœì„ ì„ ë‹¤í–ˆì–´ìš”.",
                            general: "ê·¸ ì„ ì–¸ì€ ìš©ì„œì˜ ëì´ ì•„ë‹ˆë¼,\nìê¸° ì¡´ì¤‘ì˜ ì‹œì‘ì´ì—ìš”."
                        },
                        en: {
                            perfectionism: "You hated yourself for not being perfect.\nBut perfection is a standard that doesn't exist.\nYou are precious enough even without being perfect.",
                            comparison: "You put yourself down by comparing with others.\nBut everyone grows at different speeds, in different directions.\nYou have your own path.",
                            appearance: "Did you hate yourself because of your appearance?\nBut your value isn't in your looks.\nYour heart and very existence are beautiful.",
                            achievement: "You blamed yourself for performance or grades.\nBut your value isn't proven by achievements.\nYou are meaningful just by existing.",
                            social: "Did you hate yourself feeling alone?\nBut loneliness isn't your fault.\nIt's just part of the process of finding true connection.",
                            emotional: "You blamed yourself for being emotional.\nBut emotions aren't your weakness but your strength.\nIt's the ability to feel the world deeply.",
                            family: "Did you hate yourself for disappointing family?\nBut you have the right to live your own life,\nnot according to others' expectations.",
                            self_worth: "You felt you were worthless.\nBut your very existence gives meaning to this world.\nWithout you, this moment wouldn't exist either.",
                            guilt: "You hated yourself tormented by guilt.\nBut mistakes are natural things humans make.\nThose mistakes made you wiser.",
                            past: "Did you blame yourself regretting the past?\nBut the past can't be changed, and the future hasn't come yet.\nRight now, in this moment, you can start anew.",
                            control: "You were frustrated by uncontrollable situations.\nBut you don't need to control everything.\nYou did your best in the given circumstances.",
                            general: "That declaration is not the end of forgiveness,\nbut the beginning of self-respect."
                        },
                        pt: {
                            perfectionism: "Voce se odiou por nao ser perfeito.\nMas perfeicao e um padrao que nao existe.\nVoce e precioso o suficiente mesmo sem ser perfeito.",
                            comparison: "Voce se diminuiu comparando com outros.\nMas todos crescem em velocidades diferentes, em direcoes diferentes.\nVoce tem seu proprio caminho.",
                            appearance: "Voce se odiou por causa da aparencia?\nMas seu valor nao esta na sua aparencia.\nSeu coracao e propria existencia sao belos.",
                            achievement: "Voce se culpou por desempenho ou notas.\nMas seu valor nao e provado por conquistas.\nVoce e significativo apenas por existir.",
                            social: "Voce se odiou se sentindo sozinho?\nMas solidao nao e sua culpa.\nE apenas parte do processo de encontrar conexao verdadeira.",
                            emotional: "Voce se culpou por ser emocional.\nMas emocoes nao sao sua fraqueza, mas sua forca.\nE a habilidade de sentir o mundo profundamente.",
                            family: "Voce se odiou por decepcionar a familia?\nMas voce tem o direito de viver sua propria vida,\nnao de acordo com expectativas dos outros.",
                            self_worth: "Voce se sentiu inutil.\nMas sua propria existencia da significado a este mundo.\nSem voce, este momento tambem nao existiria.",
                            guilt: "Voce se odiou atormentado pela culpa.\nMas erros sao coisas naturais que humanos cometem.\nEsses erros te fizeram mais sabio.",
                            past: "Voce se culpou lamentando o passado?\nMas o passado nao pode ser mudado, e o futuro ainda nao chegou.\nAgora mesmo, neste momento, voce pode comecar de novo.",
                            control: "Voce ficou frustrado com situacoes incontrolaveis.\nMas voce nao precisa controlar tudo.\nVoce fez o seu melhor nas circunstancias dadas.",
                            general: "Essa declaracao nao e o fim do perdao,\nmas o inicio do auto-respeito."
                        }
                    };
                    
                    return responses[lang][hatredType] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ğŸ§˜",
                getResponse: (userInput, lang) => {
                    const hatredType = analyzeSelfHatredType(userInput);
                    
                    const responses = {
                        ko: {
                            perfectionism: "ì™„ë²½ì£¼ì˜ëŠ” ìì‹ ì„ ì‚¬ë‘í•˜ëŠ” ë‹¤ë¥¸ ë°©ì‹ì´ì—ˆì„ì§€ë„ ëª°ë¼ìš”.\ní•˜ì§€ë§Œ ì´ì œëŠ” ë¶ˆì™„ì „í•œ ìì‹ ë„ ì‚¬ë‘í•  ìˆ˜ ìˆì–´ìš”.\nì™„ë²½í•˜ì§€ ì•Šì€ ê²ƒì´ ì¸ê°„ë‹¤ìš´ ê±°ì˜ˆìš”.",
                            comparison: "ë¹„êµëŠ” ìì‹ ì„ ì„±ì¥ì‹œí‚¤ë ¤ëŠ” ì˜ë„ì˜€ì„ ê±°ì˜ˆìš”.\ní•˜ì§€ë§Œ ì§„ì •í•œ ì„±ì¥ì€ ë‚¨ê³¼ ë¹„êµê°€ ì•„ë‹Œ,\nì–´ì œì˜ ìì‹ ë³´ë‹¤ ë‚˜ì•„ì§€ëŠ” ê²ƒì—ì„œ ì‹œì‘ë¼ìš”.",
                            appearance: "ì™¸ëª¨ì— ëŒ€í•œ ë¶ˆë§Œì€ ì‚¬ì‹¤ ìì‹ ì„ ë” ì•„ë¦„ë‹µê²Œ ë§Œë“¤ê³  ì‹¶ì€ ìš•êµ¬ì˜€ì–´ìš”.\ní•˜ì§€ë§Œ ì§„ì •í•œ ì•„ë¦„ë‹¤ì›€ì€ ìì‹ ì„ ë°›ì•„ë“¤ì´ëŠ” ë§ˆìŒì—ì„œ ë‚˜ì™€ìš”.",
                            achievement: "ì„±ì·¨ì— ëŒ€í•œ ì••ë°•ì€ ë” ë‚˜ì€ ì‚¬ëŒì´ ë˜ê³  ì‹¶ì€ ì—´ë§ì´ì—ˆì–´ìš”.\ní•˜ì§€ë§Œ ë‹¹ì‹ ì€ ì´ë¯¸ ì¶©ë¶„íˆ ê´œì°®ì€ ì‚¬ëŒì´ì—ìš”.\në” ì¦ëª…í•  í•„ìš”ê°€ ì—†ì–´ìš”.",
                            social: "ì™¸ë¡œì›€ì€ ê¹Šì€ ì—°ê²°ì„ ê°ˆë§í•˜ëŠ” ë§ˆìŒì˜ ì‹ í˜¸ì˜€ì–´ìš”.\ní•˜ì§€ë§Œ ì§„ì •í•œ ì—°ê²°ì€ ë¨¼ì € ìì‹ ê³¼ ì—°ê²°ë  ë•Œ ì‹œì‘ë¼ìš”.",
                            emotional: "ê°ì •ì„ ì–µëˆ„ë¥´ë ¤ í–ˆë˜ ê±´ ìƒì²˜ë°›ê¸° ì‹«ì–´ì„œì˜€ê² ì£ .\ní•˜ì§€ë§Œ ê°ì •ì€ ë‹¹ì‹ ì˜ ì§„ì‹¤í•œ ëª©ì†Œë¦¬ì˜ˆìš”.\nê·¸ ëª©ì†Œë¦¬ë¥¼ ë“¤ì–´ì£¼ì„¸ìš”.",
                            family: "ê°€ì¡±ì˜ ê¸°ëŒ€ëŠ” ì‚¬ë‘ì˜ ë‹¤ë¥¸ í‘œí˜„ì´ì—ˆì„ ê±°ì˜ˆìš”.\ní•˜ì§€ë§Œ ì§„ì •í•œ ì‚¬ë‘ì€ ìˆëŠ” ê·¸ëŒ€ë¡œì˜ ë‹¹ì‹ ì„ ë°›ì•„ë“¤ì´ëŠ” ê²ƒì´ì—ìš”.",
                            self_worth: "ìì‹ ì˜ ê°€ì¹˜ë¥¼ ì˜ì‹¬í–ˆë˜ ê±´ ë” ì˜ë¯¸ ìˆëŠ” ì‚¶ì„ ì›í–ˆê¸° ë•Œë¬¸ì´ì—ìš”.\ní•˜ì§€ë§Œ ë‹¹ì‹ ì˜ ì¡´ì¬ ìì²´ê°€ ì´ë¯¸ ì¶©ë¶„í•œ ì˜ë¯¸ì˜ˆìš”.",
                            guilt: "ì£„ì±…ê°ì€ ì–‘ì‹¬ì´ ìˆë‹¤ëŠ” ì¦ê±°ì˜€ì–´ìš”.\ní•˜ì§€ë§Œ ì™„ë²½í•œ ì‚¬ëŒì€ ì—†ê³ , ì‹¤ìˆ˜ë¡œë¶€í„° ë°°ìš°ëŠ” ê²ƒì´ ì„±ì¥ì´ì—ìš”.",
                            past: "ê³¼ê±°ë¥¼ í›„íšŒí•˜ëŠ” ê±´ ë” ë‚˜ì€ ì„ íƒì„ í•  ìˆ˜ ìˆì—ˆë‹¤ê³  ë¯¿ê¸° ë•Œë¬¸ì´ì—ìš”.\nê·¸ í›„íšŒê°€ ì§€ê¸ˆì˜ ì§€í˜œë¡œìš´ ë‹¹ì‹ ì„ ë§Œë“¤ì—ˆì–´ìš”.",
                            control: "í†µì œí•˜ë ¤ í–ˆë˜ ê±´ ì•ˆì „í•˜ê³  ì‹¶ì—ˆê¸° ë•Œë¬¸ì´ì—ìš”.\ní•˜ì§€ë§Œ ì§„ì •í•œ ì•ˆì „ì€ ë³€í™”ë¥¼ ë°›ì•„ë“¤ì¼ ë•Œ ì°¾ì„ ìˆ˜ ìˆì–´ìš”.",
                            general: "ê·¸ë ‡ê²Œ ë‹¹ì‹ ì´ ìì‹ ì—ê²Œ ë‹¤ì •í•´ì§ˆ ìˆ˜ ìˆì„ ë•Œ,\nì„¸ìƒë„ ë‹¹ì‹ ì„ ë‹¤ë¥´ê²Œ ëŒ€í•˜ê¸° ì‹œì‘í•  ê±°ì˜ˆìš”."
                        },
                        en: {
                            perfectionism: "Perfectionism might have been another way of loving yourself.\nBut now you can love your imperfect self too.\nBeing imperfect is what makes us human.",
                            comparison: "Comparison was probably intended to help you grow.\nBut true growth doesn't start from comparing with others,\nbut from becoming better than yesterday's you.",
                            appearance: "Dissatisfaction with appearance was actually a desire to make yourself more beautiful.\nBut true beauty comes from a heart that accepts itself.",
                            achievement: "Pressure about achievement was a yearning to become a better person.\nBut you're already a good enough person.\nYou don't need to prove anything more.",
                            social: "Loneliness was your heart's signal craving deep connection.\nBut true connection starts when you first connect with yourself.",
                            emotional: "You tried to suppress emotions because you didn't want to get hurt.\nBut emotions are your truthful voice.\nPlease listen to that voice.",
                            family: "Family expectations were probably another expression of love.\nBut true love is accepting you just as you are.",
                            self_worth: "You doubted your value because you wanted a more meaningful life.\nBut your very existence is already sufficient meaning.",
                            guilt: "Guilt was proof that you have a conscience.\nBut no one is perfect, and learning from mistakes is growth.",
                            past: "You regret the past because you believe you could have made better choices.\nThat regret created the wise you of today.",
                            control: "You tried to control because you wanted to feel safe.\nBut true safety can be found when you accept change.",
                            general: "When you can be gentle with yourself like this,\nthe world will also begin to treat you differently."
                        },
                        pt: {
                            perfectionism: "Perfeccionismo pode ter sido outra forma de se amar.\nMas agora voce pode amar seu eu imperfeito tambem.\nSer imperfeito e o que nos torna humanos.",
                            comparison: "Comparacao provavelmente pretendia ajudar voce a crescer.\nMas crescimento verdadeiro nao comeca comparando com outros,\nmas sendo melhor que o voce de ontem.",
                            appearance: "Insatisfacao com aparencia era na verdade desejo de se fazer mais belo.\nMas verdadeira beleza vem de um coracao que se aceita.",
                            achievement: "Pressao sobre conquistas era anseio de se tornar pessoa melhor.\nMas voce ja e pessoa boa o suficiente.\nNao precisa provar nada mais.",
                            social: "Solidao era sinal do seu coracao desejando conexao profunda.\nMas conexao verdadeira comeca quando primeiro se conecta consigo mesmo.",
                            emotional: "Voce tentou suprimir emocoes porque nao queria se machucar.\nMas emocoes sao sua voz verdadeira.\nPor favor escute essa voz.",
                            family: "Expectativas familiares eram provavelmente outra expressao de amor.\nMas amor verdadeiro e aceitar voce como voce e.",
                            self_worth: "Voce duvidou do seu valor porque queria vida mais significativa.\nMas sua propria existencia ja e significado suficiente.",
                            guilt: "Culpa era prova de que voce tem consciencia.\nMas ninguem e perfeito, e aprender com erros e crescimento.",
                            past: "Voce lamenta o passado porque acredita que poderia ter feito escolhas melhores.\nEsse arrependimento criou o voce sabio de hoje.",
                            control: "Voce tentou controlar porque queria se sentir seguro.\nMas seguranca verdadeira pode ser encontrada quando aceita mudanca.",
                            general: "Quando conseguir ser gentil consigo mesmo assim,\no mundo tambem comecara a trata-lo de forma diferente."
                        }
                    };
                    
                    return responses[lang][hatredType] || responses[lang]['general'];
                }
            },
            {
                name: "Ely", emoji: "ğŸ§â€â™€ï¸",
                getResponse: (userInput, lang) => {
                    const hatredType = analyzeSelfHatredType(userInput);
                    
                    const responses = {
                        ko: {
                            perfectionism: "ì™„ë²½ì„ ì¶”êµ¬í–ˆë˜ ê±´ ë” ë‚˜ì€ ì‚¬ëŒì´ ë˜ê³  ì‹¶ì—ˆê¸° ë•Œë¬¸ì´ì—ìš”.\nê·¸ ë§ˆìŒ ìì²´ê°€ ì´ë¯¸ ì•„ë¦„ë‹¤ì›Œìš”.\nì´ì œëŠ” ê·¸ ë§ˆìŒìœ¼ë¡œ ë¶ˆì™„ì „í•œ ìì‹ ì„ ì‚¬ë‘í•´ë³´ì„¸ìš”.",
                            comparison: "ë‹¤ë¥¸ ì‚¬ëŒì„ ë³´ë©° ë°°ìš°ë ¤ í–ˆë˜ ê±°ì˜ˆìš”.\ní•˜ì§€ë§Œ ë‹¹ì‹ ë§Œì˜ ë…íŠ¹í•œ ë¹›ì´ ìˆì–´ìš”.\nê·¸ ë¹›ì„ ë¯¿ê³  í‚¤ì›Œë‚˜ê°€ì„¸ìš”.",
                            appearance: "ì•„ë¦„ë‹¤ì›Œì§€ê³  ì‹¶ì—ˆë˜ ë§ˆìŒì€ ìì—°ìŠ¤ëŸ¬ì›Œìš”.\ní•˜ì§€ë§Œ ë‹¹ì‹ ì˜ ì§„ì •í•œ ì•„ë¦„ë‹¤ì›€ì€ ì´ë¯¸ ê±°ê¸° ìˆì–´ìš”.\nìì‹ ì„ ì‚¬ë‘í•˜ëŠ” ëˆˆìœ¼ë¡œ ë°”ë¼ë³´ì„¸ìš”.",
                            achievement: "ì„±ì·¨í•˜ê³  ì‹¶ì—ˆë˜ ê±´ ì˜ë¯¸ ìˆëŠ” ì‚¶ì„ ì›í–ˆê¸° ë•Œë¬¸ì´ì—ìš”.\ní•˜ì§€ë§Œ ë‹¹ì‹ ì˜ ë…¸ë ¥ ìì²´ê°€ ì´ë¯¸ ì„±ì·¨ì˜ˆìš”.\nê²°ê³¼ë³´ë‹¤ ê³¼ì •ì„ ì¸ì •í•´ì£¼ì„¸ìš”.",
                            social: "ì‚¬ëŒë“¤ê³¼ ì—°ê²°ë˜ê³  ì‹¶ì—ˆë˜ ë§ˆìŒì€ ì‚¬ë‘ì˜ ìš•êµ¬ì˜ˆìš”.\ní•˜ì§€ë§Œ ì§„ì •í•œ ì—°ê²°ì€ ìì‹ ì„ ì‚¬ë‘í•  ë•Œ ì‹œì‘ë¼ìš”.\në¨¼ì € ìì‹ ì˜ ì¹œêµ¬ê°€ ë˜ì–´ì£¼ì„¸ìš”.",
                            emotional: "ê°ì •ì„ ëŠë¼ëŠ” ê±´ ì‚´ì•„ìˆë‹¤ëŠ” ì¦ê±°ì˜ˆìš”.\nê·¸ ê°ì •ë“¤ì´ ë‹¹ì‹ ì„ í’ë¶€í•˜ê²Œ ë§Œë“¤ì–´ìš”.\nê°ì •ì„ ìˆ¨ê¸°ì§€ ë§ê³  ì¡´ì¤‘í•´ì£¼ì„¸ìš”.",
                            family: "ì‚¬ë‘ë°›ê³  ì‹¶ì—ˆë˜ ë§ˆìŒì€ ë‹¹ì—°í•´ìš”.\ní•˜ì§€ë§Œ ì¡°ê±´ ì—†ëŠ” ì‚¬ë‘ì€ ìì‹ ì—ê²Œì„œ ì‹œì‘ë¼ìš”.\në‹¹ì‹ ì´ ë‹¹ì‹ ì˜ ì²« ë²ˆì§¸ ì‘ì›ìê°€ ë˜ì–´ì£¼ì„¸ìš”.",
                            self_worth: "ìì‹ ì˜ ê°€ì¹˜ë¥¼ ì°¾ê³  ì‹¶ì—ˆë˜ ê±°ì˜ˆìš”.\ní•˜ì§€ë§Œ ë‹¹ì‹ ì€ ì´ë¯¸ ì†Œì¤‘í•œ ì¡´ì¬ì˜ˆìš”.\nì¡´ì¬í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ ì¶©ë¶„íˆ ê°€ì¹˜ ìˆì–´ìš”.",
                            guilt: "ì˜¬ë°”ë¥´ê²Œ ì‚´ê³  ì‹¶ì—ˆë˜ ë§ˆìŒì—ì„œ ì˜¨ ê±°ì˜ˆìš”.\ní•˜ì§€ë§Œ ì‹¤ìˆ˜ëŠ” ì¸ê°„ì˜ ìì—°ìŠ¤ëŸ¬ìš´ ë¶€ë¶„ì´ì—ìš”.\nìì‹ ì—ê²Œ ìë¹„ë¥¼ ë² í’€ì–´ì£¼ì„¸ìš”.",
                            past: "ë” ë‚˜ì€ ì„ íƒì„ í•  ìˆ˜ ìˆì—ˆë‹¤ê³  ë¯¿ê³  ìˆì–´ìš”.\nê·¸ í›„íšŒê°€ ì§€ê¸ˆì˜ í˜„ëª…í•œ ë‹¹ì‹ ì„ ë§Œë“¤ì—ˆì–´ìš”.\nê³¼ê±°ì˜ ìì‹ ì—ê²Œë„ ê³ ë§ˆì›Œí•´ì£¼ì„¸ìš”.",
                            control: "ì•ˆì •ê°ì„ ì›í–ˆë˜ ê±°ì˜ˆìš”.\ní•˜ì§€ë§Œ ì§„ì •í•œ ì•ˆì •ì€ ìì‹ ì„ ì‹ ë¢°í•  ë•Œ ì™€ìš”.\në³€í™” ì†ì—ì„œë„ í”ë“¤ë¦¬ì§€ ì•ŠëŠ” ìì‹ ì„ ë¯¿ì–´ì£¼ì„¸ìš”.",
                            general: "ê·¸ ì„ ì–¸ í•˜ë‚˜ë¡œ,\në‹¹ì‹ ì€ ìì‹  ì•ˆì˜ ì „ìŸì„ ë©ˆì¶˜ ì‚¬ëŒì´ ë˜ì—ˆì–´ìš”."
                        },
                        en: {
                            perfectionism: "You pursued perfection because you wanted to be a better person.\nThat heart itself is already beautiful.\nNow try loving your imperfect self with that same heart.",
                            comparison: "You tried to learn by looking at others.\nBut you have your own unique light.\nBelieve in that light and nurture it.",
                            appearance: "Wanting to be beautiful is natural.\nBut your true beauty is already there.\nLook at yourself with loving eyes.",
                            achievement: "You wanted to achieve because you wanted a meaningful life.\nBut your effort itself is already achievement.\nAcknowledge the process more than results.",
                            social: "Wanting to connect with people is a desire for love.\nBut true connection starts when you love yourself.\nFirst become your own friend.",
                            emotional: "Feeling emotions is proof you're alive.\nThose emotions make you rich.\nDon't hide emotions, respect them.",
                            family: "Wanting to be loved is natural.\nBut unconditional love starts with yourself.\nBe your own first cheerleader.",
                            self_worth: "You wanted to find your value.\nBut you're already a precious being.\nJust existing is valuable enough.",
                            guilt: "It came from wanting to live righteously.\nBut mistakes are a natural part of being human.\nShow compassion to yourself.",
                            past: "You believe you could have made better choices.\nThat regret created the wise you of today.\nBe grateful to your past self too.",
                            control: "You wanted stability.\nBut true stability comes when you trust yourself.\nBelieve in yourself who doesn't waver even in change.",
                            general: "With that one declaration,\nyou became someone who stopped the war within yourself."
                        },
                        pt: {
                            perfectionism: "Voce buscou perfeicao porque queria ser pessoa melhor.\nEsse coracao em si ja e belo.\nAgora tente amar seu eu imperfeito com esse mesmo coracao.",
                            comparison: "Voce tentou aprender olhando outros.\nMas voce tem sua propria luz unica.\nAcredite nessa luz e a cultive.",
                            appearance: "Querer ser belo e natural.\nMas sua verdadeira beleza ja esta la.\nOlhe para si mesmo com olhos amorosos.",
                            achievement: "Voce quis conquistar porque queria vida significativa.\nMas seu esforco em si ja e conquista.\nReconheca o processo mais que resultados.",
                            social: "Querer se conectar com pessoas e desejo por amor.\nMas conexao verdadeira comeca quando voce se ama.\nPrimeiro torne-se seu proprio amigo.",
                            emotional: "Sentir emocoes e prova de que voce esta vivo.\nEssas emocoes te fazem rico.\nNao esconda emocoes, as respeite.",
                            family: "Querer ser amado e natural.\nMas amor incondicional comeca com voce mesmo.\nSeja seu proprio primeiro torcedor.",
                            self_worth: "Voce quis encontrar seu valor.\nMas voce ja e ser precioso.\nApenas existir ja e valioso o suficiente.",
                            guilt: "Veio de querer viver corretamente.\nMas erros sao parte natural de ser humano.\nMostre compaixao a si mesmo.",
                            past: "Voce acredita que poderia ter feito escolhas melhores.\nEsse arrependimento criou o voce sabio de hoje.\nSeja grato ao seu eu passado tambem.",
                            control: "Voce quis estabilidade.\nMas estabilidade verdadeira vem quando confia em si mesmo.\nAcredite em si mesmo que nao vacila mesmo na mudanca.",
                            general: "Com essa unica declaracao,\nvoce se tornou alguem que parou a guerra dentro de si mesmo."
                        }
                    };
                    
                    return responses[lang][hatredType] || responses[lang]['general'];
                }
            }
        ];
        
        // Rest of the JavaScript functions remain the same as Portal 12
        // Typewriter effect
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (state.currentTypingElement) {
                    state.currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                state.currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                state.typingIntervals.push(typingInterval);
            });
        }
        
        // Clear all typing effects
        function clearAllTypingEffects() {
            state.typingIntervals.forEach(interval => clearInterval(interval));
            state.typingIntervals = [];
            
            if (state.currentTypingElement) {
                state.currentTypingElement.classList.remove('typing-cursor');
                state.currentTypingElement = null;
            }
        }
        
        // Scroll functions
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        // Language management
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            const t = translations[lang];
            document.title = t.title;
            document.getElementById('logoSubtitle').textContent = t.logoSubtitle;
            document.getElementById('portalMainTitle').textContent = t.portalMainTitle;
            document.getElementById('portalSubtitle').textContent = t.portalSubtitle;
            document.getElementById('lightTitle').textContent = t.lightTitle;
            document.getElementById('navigationTitle').textContent = t.navigationTitle;
            document.getElementById('nextPortalBtn').textContent = t.nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = t.stayPortalBtn;
            document.getElementById('userTextarea').placeholder = t.inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (state.currentLanguage === lang) return;
            
            state.currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            resetJourney();
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        // Journey management
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            state.userResponse = '';
            state.currentTypingElement = null;
            state.awaitingSecondResponse = false;
        }
        
        // Save response to database or memory
        async function saveResponse(inputText, step) {
            const responseData = {
                portal: portalConfig.currentPortal,
                resposta: inputText,
                step: step,
                data: new Date().toISOString(),
                idioma: state.currentLanguage,
                userId: state.currentUser ? state.currentUser.uid : 'anonymous',
                userEmail: state.currentUser ? state.currentUser.email : 'anonymous@temarix.com'
            };
            
            if (state.firebaseInitialized && state.db) {
                try {
                    await state.db.collection("temarix_v5_respostas").add({
                        ...responseData,
                        timestamp: firebase.firestore.Timestamp.now()
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                    state.userResponses.push(responseData);
                    showConnectionStatus(false);
                }
            } else {
                state.userResponses.push(responseData);
                console.log('Response stored in memory:', responseData);
            }
        }
        
        // User input processing
        async function processUserInput(inputText) {
            state.userResponse = inputText;
            
            await saveResponse(inputText, state.awaitingSecondResponse ? "second" : "first");
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!state.awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[state.currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        // Show character reactions
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[state.currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                state.awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, state.currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[state.currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[state.currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        // Portal sequence
        async function startPortalSequence() {
            console.log('Starting portal sequence...');
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            console.log('Showing intro...');
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            if (!introSection || !introElement) {
                console.error('Intro elements not found!');
                return;
            }
            
            introSection.classList.add('show');
            
            const introText = translations[state.currentLanguage].portalIntro;
            console.log('Intro text:', introText);
            
            await typewriterEffect(introElement, introText, 60);
            
            setTimeout(async () => {
                await showEmotionalBridge();
            }, 2000);
        }
        
        async function showEmotionalBridge() {
            const introElement = document.getElementById('portalIntro');
            const bridgeText = '\n\n' + translations[state.currentLanguage].emotionalBridge;
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const bridgeP = document.createElement('p');
            bridgeP.style.cssText = `
                margin-top: 30px;
                font-style: italic;
                color: #ff9999;
                font-size: 18px;
                line-height: 1.8;
            `;
            introElement.appendChild(bridgeP);
            
            await typewriterEffect(bridgeP, bridgeText.trim(), 50);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        // Custom confirm dialog
        function showConfirmDialog(message, callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                font-family: 'Courier New', monospace;
            `;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: #222;
                border: 2px solid #ff6b6b;
                padding: 30px;
                max-width: 400px;
                text-align: center;
                color: white;
            `;
            
            const messageP = document.createElement('p');
            messageP.textContent = message;
            messageP.style.cssText = `
                margin-bottom: 20px;
                line-height: 1.6;
                font-size: 16px;
            `;
            
            const buttonContainer = document.createElement('div');
            buttonContainer.style.cssText = `
                display: flex;
                gap: 15px;
                justify-content: center;
            `;
            
            const yesBtn = document.createElement('button');
            const noBtn = document.createElement('button');
            
            const buttonStyle = `
                background: #444;
                color: white;
                border: 1px solid #ff6b6b;
                padding: 10px 20px;
                cursor: pointer;
                font-family: 'Courier New', monospace;
                font-size: 14px;
            `;
            
            yesBtn.style.cssText = buttonStyle + 'background: #ff6b6b;';
            noBtn.style.cssText = buttonStyle;
            
            yesBtn.textContent = state.currentLanguage === 'ko' ? 'ì˜ˆ' : 
                                state.currentLanguage === 'pt' ? 'Sim' : 'Yes';
            noBtn.textContent = state.currentLanguage === 'ko' ? 'ì•„ë‹ˆì˜¤' : 
                               state.currentLanguage === 'pt' ? 'Nao' : 'No';
            
            yesBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(true);
            };
            
            noBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(false);
            };
            
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                    callback(false);
                }
            };
            
            buttonContainer.appendChild(yesBtn);
            buttonContainer.appendChild(noBtn);
            modal.appendChild(messageP);
            modal.appendChild(buttonContainer);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            yesBtn.focus();
        }
        
        // Event setup
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function createPortalTransition(callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, #000 0%, #111 50%, #000 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 20000;
                opacity: 0;
                transition: opacity 1s ease-in-out;
                font-family: 'Courier New', monospace;
            `;
            
            const message = document.createElement('div');
            message.style.cssText = `
                color: #ff6b6b;
                font-size: 24px;
                text-align: center;
                margin-bottom: 30px;
                opacity: 0;
                transform: translateY(20px);
                transition: all 0.8s ease-out;
            `;
            message.textContent = translations[state.currentLanguage].transitionMessage;
            
            const loader = document.createElement('div');
            loader.style.cssText = `
                width: 60px;
                height: 60px;
                border: 3px solid #333;
                border-top: 3px solid #ff6b6b;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                opacity: 0;
                transition: opacity 0.8s ease-out 0.3s;
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            overlay.appendChild(message);
            overlay.appendChild(loader);
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                overlay.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                message.style.opacity = '1';
                message.style.transform = 'translateY(0)';
                loader.style.opacity = '1';
            }, 300);
            
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(overlay);
                    document.head.removeChild(style);
                    callback();
                }, 1000);
            }, 2500);
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmNextPortal, (confirmed) => {
                    if (confirmed) {
                        if (state.firebaseInitialized && state.db) {
                            state.db.collection("temarix_v5_progress").add({
                                userId: state.currentUser.uid,
                                portal: portalConfig.currentPortal,
                                status: "complete",
                                timestamp: firebase.firestore.Timestamp.now()
                            }).catch(error => console.error('Error saving progress:', error));
                        }
                        
                        createPortalTransition(() => {
                            window.location.href = `${portalConfig.nextPortalFile}?lang=${state.currentLanguage}`;
                        });
                    }
                });
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmStay, (confirmed) => {
                    if (confirmed) {
                        resetJourney();
                        setTimeout(() => {
                            startPortalSequence();
                        }, 1000);
                    }
                });
            });
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        function initializeTemarix() {
            console.log('Initializing Temarix V5 Portal 13...');
            console.log('Current state:', state);
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            state.journeyStarted = true;
            console.log('Journey started:', state.journeyStarted);
            
            console.log('Starting portal sequence in 1 second...');
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Temarix V5 Portal 13 DOM loaded');
            
            state.currentLanguage = getLanguageFromURL();
            
            updateStaticTranslations(state.currentLanguage);
            updateLanguageButtons(state.currentLanguage);
            
            await initializeFirebase();
            
            initializeTemarix();
        });
    </script>
</body>
</html>