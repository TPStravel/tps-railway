<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V5 - Portal 11: The Day I Lifted My Diminished Self</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .navigation-title {
                font-size: 24px;
            }
            
            .navigation-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V5</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 11: The Day I Lifted My Diminished Self</div>
            <div class="portal-subtitle" id="portalSubtitle">When did I stop making myself smaller?</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">ğŸª„ Portal 11 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 12</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with this strength</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Tell me about a time when you felt small and what helped you stand up again... (Press Enter to send)"
                      rows="1"
                      maxlength="800"></textarea>
        </div>
    </div>

    <script>
        // Global state management
        let state = {
            db: null,
            auth: null,
            firebaseInitialized: false,
            currentUser: null,
            currentLanguage: 'en',
            userResponse: '',
            journeyStarted: false,
            currentTypingElement: null,
            typingIntervals: [],
            awaitingSecondResponse: false,
            userResponses: []
        };
        
        // Portal navigation configuration
        const portalConfig = {
            currentPortal: "v5-11",
            nextPortal: "v5-12",
            nextPortalFile: "temarix_v05_12.html"
        };
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
            authDomain: "canal-vivo-chat.firebaseapp.com",
            projectId: "canal-vivo-chat",
            storageBucket: "canal-vivo-chat.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdefghijklmnopqr"
        };
        
        // Initialize Firebase with error handling
        function initializeFirebase() {
            return new Promise((resolve) => {
                try {
                    if (typeof firebase !== 'undefined') {
                        firebase.initializeApp(firebaseConfig);
                        state.db = firebase.firestore();
                        state.auth = firebase.auth();
                        state.firebaseInitialized = true;
                        
                        state.auth.onAuthStateChanged((user) => {
                            if (user) {
                                state.currentUser = user;
                            } else {
                                state.currentUser = {
                                    uid: 'anonymous-' + Date.now(),
                                    email: 'anonymous@temarix.com',
                                    isAnonymous: true
                                };
                            }
                            showConnectionStatus(true);
                        });
                        
                        console.log('Firebase initialized successfully');
                    } else {
                        console.log('Firebase SDK not loaded');
                        state.currentUser = {
                            uid: 'anonymous-' + Date.now(),
                            email: 'anonymous@temarix.com',
                            isAnonymous: true
                        };
                        showConnectionStatus(false);
                    }
                } catch (error) {
                    console.error('Firebase initialization failed:', error);
                    state.currentUser = {
                        uid: 'anonymous-' + Date.now(),
                        email: 'anonymous@temarix.com',
                        isAnonymous: true
                    };
                    showConnectionStatus(false);
                }
                resolve();
            });
        }
        
        // Show connection status to user
        function showConnectionStatus(isOnline) {
            const existingStatus = document.querySelector('.connection-status');
            if (existingStatus) {
                existingStatus.remove();
            }
            
            if (!isOnline) {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'connection-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: rgba(255, 107, 107, 0.9);
                    color: white;
                    padding: 8px 15px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-family: 'Courier New', monospace;
                    z-index: 1000;
                    opacity: 0.8;
                `;
                statusDiv.textContent = state.currentLanguage === 'ko' ? 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ' : 
                                       state.currentLanguage === 'pt' ? 'Modo offline' : 'Offline mode';
                document.body.appendChild(statusDiv);
                
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.remove();
                    }
                }, 5000);
            }
        }

        // Translations object
        const translations = {
            ko: {
                title: "Temarix V5 - Portal 11: ì‘ì•„ì§€ë˜ ë‚˜ë¥¼ ì¼ìœ¼ì¼œ ì„¸ìš´ ë‚ ",
                logoSubtitle: "ê°ì • ì—°ê¸ˆìˆ ",
                portalMainTitle: "Portal 11: ì‘ì•„ì§€ë˜ ë‚˜ë¥¼ ì¼ìœ¼ì¼œ ì„¸ìš´ ë‚ ",
                portalSubtitle: "ì–¸ì œë¶€í„° ë‚˜ë¥¼ ì‘ê²Œ ë§Œë“¤ì§€ ì•Šê¸° ì‹œì‘í–ˆì„ê¹Œ?",
                portalIntro: "ğŸª„ \"ë‹¹ì‹ ì´ ìŠ¤ìŠ¤ë¡œë¥¼ ì‘ê³  ë³´ì˜ê²ƒì—†ëŠ” ì¡´ì¬ì²˜ëŸ¼ ëŠê¼ˆë˜ ìˆœê°„ì´ ìˆì—ˆë‚˜ìš”?\"\n\n\"ê·¸ë•Œ, ì–´ë–¤ ê³„ê¸°ë¡œ ìì‹ ì„ ë‹¤ì‹œ ì¼ìœ¼ì¼œ ì„¸ìš¸ ìˆ˜ ìˆì—ˆë‚˜ìš”?\"\n\n\"ê·¸ ì‘ì€ ë‚˜ë¥¼ ì§€ê¸ˆ, ì–´ë–»ê²Œ ê¸°ì–µí•˜ê³  ìˆë‚˜ìš”?\"",
                emotionalBridge: "ì‘ì•„ì§„ë‹¤ëŠ” ê²ƒì€ ì‚¬ë¼ì§€ëŠ” ê²ƒì´ ì•„ë‹ˆë¼,\nìŠ¤ìŠ¤ë¡œë¥¼ ë³´í˜¸í•˜ë ¤ëŠ” ë§ˆìŒì˜ ë°©ì‹ì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\n\ní•˜ì§€ë§Œ ì–´ëŠ ìˆœê°„, ìš°ë¦¬ëŠ” ë‹¤ì‹œ ì¼ì–´ì„¤ ìš©ê¸°ë¥¼ ì°¾ê²Œ ë©ë‹ˆë‹¤.\nê·¸ ìˆœê°„ì´ ë°”ë¡œ ì§„ì •í•œ ì„±ì¥ì˜ ì‹œì‘ì…ë‹ˆë‹¤.",
                followUpQuestion: "ì§€ê¸ˆ ê·¸ ì‘ì•„ì¡Œë˜ 'ë‚˜'ì—ê²Œ,\ní•œ ë¬¸ì¥ìœ¼ë¡œ ë§ì„ ê±´ë„¨ë‹¤ë©´ ë­ë¼ê³  í• ê¹Œìš”?",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ì‘ë‹¤ê³  ëŠê»´ì¡Œë˜ ë„ˆ,\nì‚¬ì‹¤ ë„Œ ëŠ˜ ì¶©ë¶„í–ˆì–´.\në‹¨ì§€ ìŠ¤ìŠ¤ë¡œë¥¼ ì‘ê²Œ ë§Œë“¤ì—ˆë˜ ê±°ì•¼.\nì´ì œ, ë„ˆë¥¼ ë˜‘ë°”ë¡œ ë°”ë¼ë³¼ê²Œ.",
                navigationTitle: "ğŸª„ Portal 11 ì™„ë£Œ",
                navigationMessage: "ë‹¹ì‹ ì€ ìŠ¤ìŠ¤ë¡œë¥¼ ì‘ê²Œ ë§Œë“¤ì—ˆë˜ ìˆœê°„ë“¤ì„ ëŒì•„ë³´ê³ , ë‹¤ì‹œ ì¼ì–´ì„¤ ìˆ˜ ìˆëŠ” í˜ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.\n\nì‘ì•„ì¡Œë‹¤ê³  ëŠê¼ˆë˜ ê·¸ ì‹œê°„ë“¤ë„ ë‹¹ì‹ ì˜ ì¼ë¶€ì˜€ìœ¼ë©°, ì§€ê¸ˆì˜ ê°•í•¨ì„ ë§Œë“  ì†Œì¤‘í•œ ê³¼ì •ì´ì—ˆìŠµë‹ˆë‹¤.\në‹¹ì‹ ì€ ì´ì œ ìì‹ ì˜ í¬ê¸°ë¥¼ íƒ€ì¸ì´ ì•„ë‹Œ ìŠ¤ìŠ¤ë¡œ ì •ì˜í•  ìˆ˜ ìˆëŠ” ì‚¬ëŒì…ë‹ˆë‹¤.\n\në” ì´ìƒ ìì‹ ì„ ì‘ê²Œ ì¤„ì´ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.",
                nextPortalBtn: "Portal 12ë¡œ ì´ì–´ê°€ê¸°",
                stayPortalBtn: "ì´ í˜ê³¼ ë¨¸ë¬¼ê¸°",
                inputPlaceholder: "ì‘ë‹¤ê³  ëŠê¼ˆë˜ ìˆœê°„ê³¼ ë‹¤ì‹œ ì¼ì–´ì„  ê³„ê¸°ì— ëŒ€í•´ ë§í•´ì£¼ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...",
                confirmNextPortal: "Portal 12: ëˆ„êµ¬ë„ ëª°ëë˜ ë‚´ í¸ì˜ ì¡´ì¬ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                confirmStay: "ì´ í˜ê³¼ ë” ë¨¸ë¬¼ë©° ìì‹ ì˜ ì§„ì •í•œ í¬ê¸°ë¥¼ ëŠë¼ì‹œê² ìŠµë‹ˆê¹Œ?",
                transitionMessage: "ìƒˆë¡œìš´ ì—¬ì •ì´ ì‹œì‘ë©ë‹ˆë‹¤..."
            },
            en: {
                title: "Temarix V5 - Portal 11: The Day I Lifted My Diminished Self",
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 11: The Day I Lifted My Diminished Self",
                portalSubtitle: "When did I stop making myself smaller?",
                portalIntro: "ğŸª„ \"Was there a moment when you felt like a small, insignificant being?\"\n\n\"What was the turning point that helped you lift yourself up again?\"\n\n\"How do you remember that small version of yourself now?\"",
                emotionalBridge: "Becoming small is not about disappearing,\nbut might be the heart's way of protecting itself.\n\nBut at some moment, we find the courage to stand again.\nThat moment is the true beginning of growth.",
                followUpQuestion: "If you could say one sentence to that 'smaller you' now,\nwhat would you tell them?",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "You who felt small,\nyou were always enough.\nYou just made yourself smaller.\nNow, I will see you clearly.",
                navigationTitle: "ğŸª„ Portal 11 Complete",
                navigationMessage: "You have looked back at the moments when you made yourself small and discovered the strength to rise again.\n\nThose times when you felt diminished were also part of you, and they were precious processes that created your current strength.\nYou are now someone who can define your own size, not by others but by yourself.\n\nYou no longer need to make yourself smaller.",
                nextPortalBtn: "Continue to Portal 12",
                stayPortalBtn: "Stay with this strength",
                inputPlaceholder: "Tell me about a time when you felt small and what helped you stand up again... (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response...",
                confirmNextPortal: "Do you want to continue to Portal 12: The Existence of My Ally That No One Knew?",
                confirmStay: "Do you want to stay longer with this strength and feel your true size?",
                transitionMessage: "A new journey begins..."
            },
            pt: {
                title: "Temarix V5 - Portal 11: O Dia em que Levantei Meu Eu DiminuÃ­do",
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 11: O Dia em que Levantei Meu Eu DiminuÃ­do",
                portalSubtitle: "Quando parei de me diminuir?",
                portalIntro: "ğŸª„ \"Houve um momento em que vocÃª se sentiu como um ser pequeno e insignificante?\"\n\n\"Qual foi o ponto de virada que te ajudou a se levantar novamente?\"\n\n\"Como vocÃª se lembra daquela versÃ£o pequena de si mesmo agora?\"",
                emotionalBridge: "Tornar-se pequeno nÃ£o Ã© sobre desaparecer,\nmas pode ser a forma do coraÃ§Ã£o se proteger.\n\nMas em algum momento, encontramos a coragem para nos levantar novamente.\nEsse momento Ã© o verdadeiro comeÃ§o do crescimento.",
                followUpQuestion: "Se vocÃª pudesse dizer uma frase para aquele 'eu menor' agora,\no que diria?",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "VocÃª que se sentiu pequeno,\nvocÃª sempre foi suficiente.\nApenas se fez menor.\nAgora, vou te ver claramente.",
                navigationTitle: "ğŸª„ Portal 11 Completo",
                navigationMessage: "VocÃª olhou para trÃ¡s nos momentos em que se fez pequeno e descobriu a forÃ§a para se levantar novamente.\n\nAqueles tempos em que se sentiu diminuÃ­do tambÃ©m eram parte de vocÃª, e foram processos preciosos que criaram sua forÃ§a atual.\nVocÃª Ã© agora alguÃ©m que pode definir seu prÃ³prio tamanho, nÃ£o pelos outros, mas por si mesmo.\n\nVocÃª nÃ£o precisa mais se fazer menor.",
                nextPortalBtn: "Continuar para Portal 12",
                stayPortalBtn: "Ficar com esta forÃ§a",
                inputPlaceholder: "Conte-me sobre um momento em que se sentiu pequeno e o que te ajudou a se levantar... (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta...",
                confirmNextPortal: "Deseja continuar para Portal 12: A ExistÃªncia do Meu Aliado que NinguÃ©m Conhecia?",
                confirmStay: "Deseja ficar mais tempo com esta forÃ§a e sentir seu verdadeiro tamanho?",
                transitionMessage: "Uma nova jornada comeÃ§a..."
            }
        };
        
        // Character definitions
        const characters = [
            { name: "Noah", emoji: "ğŸ§‘â€ğŸ¦±", text: {
                ko: "ê·¸ë•Œì˜ ë„ˆëŠ” ê²¬ë””ê³  ìˆì—ˆì–´.\nê·¸ë¦¬ê³  ì§€ê¸ˆì˜ ë„ˆëŠ”, ê·¸ê±¸ ë°”ë¼ë³´ê³  ìˆêµ¬ë‚˜.",
                en: "You were enduring back then.\nAnd now you're looking back at that.",
                pt: "VocÃª estava resistindo naquela Ã©poca.\nE agora vocÃª estÃ¡ olhando para trÃ¡s para isso."
            }},
            { name: "Ely", emoji: "ğŸ§â€â™€ï¸", text: {
                ko: "ì‘ì•„ì§„ ì¡´ì¬ëŠ” ì‚¬ë¼ì§„ ê²ƒì´ ì•„ë‹ˆì—ìš”.\nì˜¤íˆë ¤ ë” ë‹¨ë‹¨í•˜ê²Œ ìì‹ ì„ ì¶•ì†Œí•˜ê³  ìˆì—ˆë˜ ê±°ì˜ˆìš”.",
                en: "A diminished being hasn't disappeared.\nRather, they were compacting themselves more solidly.",
                pt: "Um ser diminuÃ­do nÃ£o desapareceu.\nAntes, estava se compactando mais solidamente."
            }},
            { name: "Sora", emoji: "ğŸ§•", text: {
                ko: "ê·¸ ê³ ë§™ë‹¨ ë§ í•œ ë§ˆë””ê°€,\në‹¹ì‹  ì¡´ì¬ì˜ ê°€ì¹˜ ì „ì²´ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ëƒˆêµ°ìš”.",
                en: "That one word of gratitude\nbrought back the entire value of your existence.",
                pt: "Aquela Ãºnica palavra de gratidÃ£o\ntrouxe de volta todo o valor da sua existÃªncia."
            }},
            { name: "Kael", emoji: "ğŸ§™", text: {
                ko: "ì‘ì•„ì¡Œë‹¤ëŠ” ê±´, ë¬´ê²Œê°€ ê°€ë²¼ì› ë‹¤ëŠ” ëœ»ì´ ì•„ë‹ˆì•¼.\nìˆ¨ê¸°ê³  ìˆë˜ ì§„ì‹¬ì´ ìˆì—ˆë‹¤ëŠ” ëœ»ì´ì§€.",
                en: "Being small doesn't mean you were lightweight.\nIt means there was sincerity you were hiding.",
                pt: "Ser pequeno nÃ£o significa que vocÃª era leve.\nSignifica que havia sinceridade que vocÃª estava escondendo."
            }},
            { name: "Mira", emoji: "ğŸ§‘â€ğŸ¨", text: {
                ko: "ë‹¹ì‹ ì˜ ì‘ìŒì€ ë¯¸ì•½í•¨ì´ ì•„ë‹ˆë¼,\nì„¸ìƒì„ ì¡°ìš©íˆ ê´€ì°°í•˜ë˜ ìƒ‰ê¹”ì´ì—ìš”.",
                en: "Your smallness wasn't weakness,\nbut the color of quietly observing the world.",
                pt: "Sua pequenez nÃ£o era fraqueza,\nmas a cor de observar silenciosamente o mundo."
            }},
            { name: "Cris", emoji: "ğŸ¦¸â€â™‚ï¸", text: {
                ko: "ì‘ì•„ì§€ëŠ” ê±¸ ì°¸ëŠ” ê²ƒë„ ì¼ì¢…ì˜ ê°•í•¨ì´ì•¼.\nê·¼ë° ì´ì œëŠ”, ë“œëŸ¬ë‚˜ëŠ” ê°•í•¨ë„ ì„ íƒí•´ë„ ë¼.",
                en: "Enduring becoming small is also a kind of strength.\nBut now, you can also choose visible strength.",
                pt: "Suportar tornar-se pequeno tambÃ©m Ã© um tipo de forÃ§a.\nMas agora, vocÃª tambÃ©m pode escolher forÃ§a visÃ­vel."
            }},
            { name: "Enya", emoji: "ğŸ§‘â€ğŸš€", text: {
                ko: "ì‚¬ëŒì€ ë§ í•œ ë§ˆë””ë¡œ ë¬´ë„ˆì§€ê³ ,\në§ í•œ ë§ˆë””ë¡œ ë‹¤ì‹œ ì¼ì–´ì„¤ ìˆ˜ ìˆì–´ìš”.\nê·¸ë¦¬ê³  ë‹¹ì‹ ì€ ê·¸ê±¸ ê²½í—˜í–ˆì–´ìš”.",
                en: "People can fall with one word,\nand rise again with one word.\nAnd you have experienced that.",
                pt: "As pessoas podem cair com uma palavra,\ne se levantar novamente com uma palavra.\nE vocÃª experimentou isso."
            }},
            { name: "Lian", emoji: "ğŸ§˜", text: {
                ko: "ë‹¹ì‹ ì€ ì‚¬ë¼ì¡Œë˜ ê²Œ ì•„ë‹ˆë¼, ìˆ¨ê²¨ì¡Œë˜ ìì‹ ì„ ì´ì œ êº¼ë‚¸ ê±°ì˜ˆìš”.",
                en: "You didn't disappear, you've now brought out the self that was hidden.",
                pt: "VocÃª nÃ£o desapareceu, agora trouxe para fora o eu que estava escondido."
            }}
        ];

        // Empowerment type analysis function
        function analyzeEmpowermentType(userInput) {
            const input = userInput.toLowerCase();
            
            const empowermentKeywords = {
                recognition: ['recognized', 'noticed', 'saw', 'acknowledged', 'ì¸ì •', 'ì•Œì•„ë´', 'ë³´ì—¬', 'reconhecido', 'notado', 'viu'],
                support: ['helped', 'supported', 'stood by', 'encouraged', 'ë„ì™€', 'ì§€ì§€', 'ì‘ì›', 'ajudou', 'apoiou', 'encorajou'],
                achievement: ['accomplished', 'succeeded', 'won', 'achieved', 'ì„±ê³µ', 'ì´ë¤„', 'í•´ëƒˆ', 'realizou', 'conseguiu', 'venceu'],
                voice: ['spoke up', 'said no', 'expressed', 'voiced', 'ë§í–ˆ', 'í‘œí˜„', 'ëª©ì†Œë¦¬', 'falou', 'expressou', 'disse nÃ£o'],
                boundary: ['set limits', 'said no', 'stood ground', 'refused', 'ê²½ê³„', 'ê±°ì ˆ', 'í•œê³„', 'estabeleceu limites', 'recusou'],
                kindness: ['kind words', 'gentle', 'compassion', 'understanding', 'ë”°ëœ»', 'ì¹œì ˆ', 'ì´í•´', 'palavras gentis', 'compreensÃ£o'],
                realization: ['realized', 'understood', 'discovered', 'learned', 'ê¹¨ë‹¬', 'ì•Œê²Œ', 'ë°œê²¬', 'percebeu', 'descobriu', 'aprendeu'],
                independence: ['alone', 'myself', 'own strength', 'self reliant', 'í˜¼ì', 'ìŠ¤ìŠ¤ë¡œ', 'ë…ë¦½', 'sozinho', 'prÃ³pria forÃ§a'],
                courage: ['brave', 'courage', 'faced', 'confronted', 'ìš©ê¸°', 'ìš©ê°', 'ë§ì„œ', 'coragem', 'corajoso', 'enfrentou'],
                acceptance: ['accepted', 'embraced', 'welcomed', 'received', 'ë°›ì•„ë“¤', 'í¬ìš©', 'í™˜ì˜', 'aceitou', 'abraÃ§ou', 'recebeu'],
                love: ['loved', 'cared', 'valued', 'cherished', 'ì‚¬ë‘', 'ì†Œì¤‘', 'ì•„ê»´', 'amou', 'cuidou', 'valorizou'],
                change: ['changed', 'transformed', 'grew', 'evolved', 'ë³€í™”', 'ì„±ì¥', 'ë°œì „', 'mudou', 'transformou', 'cresceu']
            };
            
            let detectedTypes = [];
            for (const [type, keywords] of Object.entries(empowermentKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedTypes.push(type);
                        break;
                    }
                }
            }
            
            if (detectedTypes.length === 0) {
                detectedTypes = ['general'];
            }
            
            return detectedTypes[0];
        }
        
        // Response characters with empowerment-based responses
        const responseCharacters = [
            {
                name: "Sora", emoji: "ğŸ§•",
                getResponse: (userInput, lang) => {
                    const empowermentType = analyzeEmpowermentType(userInput);
                    
                    const responses = {
                        ko: {
                            recognition: "ê·¸ ì¸ì •ì˜ ë§ì´,\në‹¹ì‹  ì•ˆì— ìˆ¨ì–´ìˆë˜ ì§„ì§œ í¬ê¸°ë¥¼ ë“œëŸ¬ë‚´ ì£¼ì—ˆêµ°ìš”.\në‹¹ì‹ ì€ í•­ìƒ ê·¸ë§Œí¼ ì»¸ì–´ìš”.",
                            support: "ëˆ„êµ°ê°€ì˜ ì§€ì§€ê°€ ìˆì—ˆê¸°ì—,\në‹¹ì‹ ì€ ìŠ¤ìŠ¤ë¡œë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆì—ˆì–´ìš”.\nê·¸ë¦¬ê³  ê·¸ ì§€ì§€ëŠ” ë‹¹ì‹ ì´ ë°›ì„ ìê²©ì´ ìˆë˜ ê²ƒì´ì—ìš”.",
                            achievement: "ê·¸ ì„±ì·¨ëŠ” ìš°ì—°ì´ ì•„ë‹ˆì—ˆì–´ìš”.\nì‘ì•„ì¡Œë‹¤ê³  ëŠê¼ˆë˜ ë‹¹ì‹  ì•ˆì—ë„\nëŠ˜ ê·¸ë§Œí•œ í˜ì´ ìˆì—ˆë˜ ê±°ì˜ˆìš”.",
                            voice: "ë‹¹ì‹ ì˜ ëª©ì†Œë¦¬ê°€ ë‚˜ì˜¨ ìˆœê°„,\nì„¸ìƒì€ ë‹¹ì‹ ì˜ ì§„ì§œ í¬ê¸°ë¥¼ ì•Œê²Œ ë˜ì—ˆì–´ìš”.\nëª©ì†Œë¦¬ëŠ” ì¡´ì¬ì˜ ì¦ëª…ì´ì—ìš”.",
                            boundary: "ê²½ê³„ë¥¼ ê·¸ì—ˆë‹¤ëŠ” ê±´,\nìì‹ ì˜ ê³µê°„ì„ ì¸ì •í–ˆë‹¤ëŠ” ëœ»ì´ì—ìš”.\nì‘ì€ ì¡´ì¬ëŠ” ê²½ê³„ë¥¼ ê·¸ì„ ìˆ˜ ì—†ê±°ë“ ìš”.",
                            kindness: "ê·¸ ë”°ëœ»í•¨ì´ ë‹¹ì‹ ì„ ë…¹ì—¬ì£¼ì—ˆêµ°ìš”.\nì–¼ì–´ìˆë˜ ë§ˆìŒì´ ë‹¤ì‹œ ì›€ì§ì´ê¸° ì‹œì‘í•œ ìˆœê°„ì´ì—ˆì–´ìš”.",
                            realization: "ê·¸ ê¹¨ë‹¬ìŒì´ ë‹¹ì‹ ì„ êµ¬í–ˆì–´ìš”.\nì‘ë‹¤ê³  ëŠë‚€ ê±´ ì°©ê°ì´ì—ˆë‹¤ëŠ” ê±¸\në§ˆì¹¨ë‚´ ì•Œì•„ì°¨ë¦° ê±°ì˜ˆìš”.",
                            independence: "í˜¼ìì„œë„ ì¼ì–´ì„¤ ìˆ˜ ìˆë‹¤ëŠ” ê±¸ ì•ˆ ìˆœê°„,\në‹¹ì‹ ì€ ì§„ì§œ ìì‹ ì˜ í¬ê¸°ë¥¼ ë°œê²¬í•œ ê±°ì˜ˆìš”.",
                            courage: "ê·¸ ìš©ê¸° í•˜ë‚˜ê°€\nì‘ì•„ì§„ ë‹¹ì‹ ì„ ë‹¤ì‹œ ì›ë˜ í¬ê¸°ë¡œ ëŒë ¤ë†“ì•˜ì–´ìš”.\nìš©ê¸°ëŠ” ì¡´ì¬ë¥¼ íšŒë³µì‹œí‚¤ëŠ” ë§ˆë²•ì´ì—ìš”.",
                            acceptance: "ìì‹ ì„ ë°›ì•„ë“¤ì¸ ìˆœê°„,\në‹¹ì‹ ì€ ë” ì´ìƒ ì‘ì•„ì§ˆ í•„ìš”ê°€ ì—†ì–´ì¡Œì–´ìš”.\në°›ì•„ë“¤ì„ì€ ì„±ì¥ì˜ ì‹œì‘ì´ì—ìš”.",
                            love: "ì‚¬ë‘ë°›ëŠ”ë‹¤ëŠ” ê±¸ ì•ˆ ìˆœê°„,\në‹¹ì‹ ì€ ì‚¬ë‘ë°›ì„ ë§Œí•œ í¬ê¸°ì˜ ì¡´ì¬ë¼ëŠ” ê±¸ ê¹¨ë‹¬ì•˜ì–´ìš”.",
                            change: "ë³€í™”ë¥¼ ì„ íƒí•œ ìˆœê°„,\në‹¹ì‹ ì€ ì‘ì€ ìì‹ ì—ê²Œì„œ ë²—ì–´ë‚˜ê¸° ì‹œì‘í–ˆì–´ìš”.\në³€í™”ëŠ” ìš©ê¸°ì˜ ë‹¤ë¥¸ ì´ë¦„ì´ì—ìš”.",
                            general: "ê·¸ ì„ ì–¸ì€ ì„ ì–¸ì´ì—ìš”.\në‹¹ì‹ ì´ ì´ì œ ìì‹ ì„ ë” ì´ìƒ ì‘ê²Œ ë³´ì§€ ì•Šê² ë‹¤ëŠ” ì„ ì–¸."
                        },
                        en: {
                            recognition: "Those words of recognition\nrevealed the true size that was hidden within you.\nYou were always that big.",
                            support: "Because of someone's support,\nyou were able to lift yourself up.\nAnd that support was something you deserved.",
                            achievement: "That achievement wasn't accidental.\nEven within you who felt small,\nthere was always that much strength.",
                            voice: "The moment your voice emerged,\nthe world came to know your true size.\nVoice is proof of existence.",
                            boundary: "Drawing boundaries means\nyou acknowledged your own space.\nSmall beings cannot draw boundaries.",
                            kindness: "That warmth melted you.\nIt was the moment your frozen heart began to move again.",
                            realization: "That realization saved you.\nYou finally noticed that feeling small\nwas an illusion.",
                            independence: "The moment you knew you could stand alone,\nyou discovered your true size.\nIndependence reveals authentic strength.",
                            courage: "That one act of courage\nrestored your diminished self to original size.\nCourage is magic that recovers existence.",
                            acceptance: "The moment you accepted yourself,\nyou no longer needed to become smaller.\nAcceptance is the beginning of growth.",
                            love: "The moment you knew you were loved,\nyou realized you were a being worthy of love.",
                            change: "The moment you chose change,\nyou began to escape from your small self.\nChange is another name for courage.",
                            general: "That declaration is a declaration.\nThat you will no longer see yourself as small."
                        },
                        pt: {
                            recognition: "Aquelas palavras de reconhecimento\nrevelaram o verdadeiro tamanho que estava escondido dentro de vocÃª.\nVocÃª sempre foi assim tÃ£o grande.",
                            support: "Por causa do apoio de alguÃ©m,\nvocÃª conseguiu se levantar.\nE esse apoio era algo que vocÃª merecia.",
                            achievement: "Essa conquista nÃ£o foi acidental.\nMesmo dentro de vocÃª que se sentiu pequeno,\nsempre houve essa forÃ§a.",
                            voice: "No momento em que sua voz emergiu,\no mundo passou a conhecer seu verdadeiro tamanho.\nVoz Ã© prova de existÃªncia.",
                            boundary: "Estabelecer limites significa\nque vocÃª reconheceu seu prÃ³prio espaÃ§o.\nSeres pequenos nÃ£o conseguem estabelecer limites.",
                            kindness: "Aquela gentileza te derreteu.\nFoi o momento em que seu coraÃ§Ã£o congelado comeÃ§ou a se mover novamente.",
                            realization: "Aquela percepÃ§Ã£o te salvou.\nVocÃª finalmente notou que se sentir pequeno\nera uma ilusÃ£o.",
                            independence: "No momento em que soube que podia ficar em pÃ© sozinho,\nvocÃª descobriu seu verdadeiro tamanho.\nIndependÃªncia revela forÃ§a autÃªntica.",
                            courage: "Aquele ato de coragem\nrestaurou seu eu diminuÃ­do ao tamanho original.\nCoragem Ã© magia que recupera a existÃªncia.",
                            acceptance: "No momento em que se aceitou,\nvocÃª nÃ£o precisou mais se tornar menor.\nAceitaÃ§Ã£o Ã© o comeÃ§o do crescimento.",
                            love: "No momento em que soube que era amado,\nvocÃª percebeu que era um ser digno de amor.",
                            change: "No momento em que escolheu a mudanÃ§a,\nvocÃª comeÃ§ou a escapar do seu eu pequeno.\nMudanÃ§a Ã© outro nome para coragem.",
                            general: "Aquela declaraÃ§Ã£o Ã© uma declaraÃ§Ã£o.\nQue vocÃª nÃ£o se verÃ¡ mais como pequeno."
                        }
                    };
                    
                    return responses[lang][empowermentType] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ğŸ§˜",
                getResponse: (userInput, lang) => {
                    const empowermentType = analyzeEmpowermentType(userInput);
                    
                    const responses = {
                        ko: {
                            recognition: "ì¸ì •ë°›ëŠ”ë‹¤ëŠ” ê±´,\nì´ë¯¸ ê±°ê¸° ìˆë˜ ê²ƒì„ ë“œëŸ¬ë‚´ëŠ” ì¼ì´ì—ìš”.\në‹¹ì‹ ì€ ëŠ˜ ì¸ì •ë°›ì„ ë§Œí•œ ì¡´ì¬ì˜€ì–´ìš”.",
                            support: "ì§„ì •í•œ ì§€ì§€ëŠ” ì˜ì¡´ì„ ë§Œë“œëŠ” ê²Œ ì•„ë‹ˆë¼,\në…ë¦½ì„ ë„ì™€ì£¼ëŠ” ê±°ì˜ˆìš”.\në‹¹ì‹ ì€ ê·¸ëŸ° ì§€ì§€ë¥¼ ë°›ì•˜ì–´ìš”.",
                            achievement: "ì„±ì·¨ëŠ” ì¦ëª…ì´ ì•„ë‹ˆë¼ í™•ì¸ì´ì—ìš”.\nì´ë¯¸ ìˆë˜ ëŠ¥ë ¥ì„ í™•ì¸í•˜ëŠ” ìˆœê°„ì´ì—ˆì–´ìš”.",
                            voice: "ëª©ì†Œë¦¬ë¥¼ ë‚¸ë‹¤ëŠ” ê±´,\nì¡´ì¬ë¥¼ ì„ ì–¸í•˜ëŠ” ì¼ì´ì—ìš”.\në‹¹ì‹ ì€ ë§ˆì¹¨ë‚´ ì¡´ì¬ë¥¼ ì„ ì–¸í–ˆì–´ìš”.",
                            boundary: "ê²½ê³„ëŠ” ê±°ë¶€ê°€ ì•„ë‹ˆë¼ ì •ì˜ì˜ˆìš”.\nìì‹ ì„ ì •ì˜í•  ìˆ˜ ìˆëŠ” ì‚¬ëŒë§Œì´\nì§„ì •ìœ¼ë¡œ í´ ìˆ˜ ìˆì–´ìš”.",
                            kindness: "ë”°ëœ»í•¨ì€ ë§ˆìŒì˜ í•´ë¹™ì´ì—ìš”.\nì–¼ì–´ìˆë˜ ìì‹ ê°ì´ ë‹¤ì‹œ íë¥´ê¸° ì‹œì‘í•œ ê±°ì˜ˆìš”.",
                            realization: "ê¹¨ë‹¬ìŒì€ ê¸°ì–µì˜ íšŒë³µì´ì—ìš”.\nìŠê³  ìˆë˜ ìì‹ ì˜ ì§„ì§œ ëª¨ìŠµì„\në‹¤ì‹œ ê¸°ì–µí•´ë‚¸ ìˆœê°„ì´ì—ìš”.",
                            independence: "í˜¼ì ì„¤ ìˆ˜ ìˆë‹¤ëŠ” ê±´,\nëˆ„êµ¬ì˜ í—ˆë½ë„ í•„ìš” ì—†ë‹¤ëŠ” ëœ»ì´ì—ìš”.\në‹¹ì‹ ì€ ìŠ¤ìŠ¤ë¡œë¥¼ í—ˆë½í–ˆì–´ìš”.",
                            courage: "ìš©ê¸°ëŠ” í¬ê¸°ë¥¼ ê²°ì •í•´ìš”.\nìš©ê¸° ìˆëŠ” ë§ˆìŒì€ ì ˆëŒ€ ì‘ì•„ì§€ì§€ ì•Šì•„ìš”.",
                            acceptance: "ìê¸° ìˆ˜ìš©ì€ ì„±ì¥ì˜ í† ëŒ€ì˜ˆìš”.\në°›ì•„ë“¤ì¸ ìë¦¬ì—ì„œ ì§„ì§œ ì„±ì¥ì´ ì‹œì‘ë¼ìš”.",
                            love: "ì‚¬ë‘ì€ ì¡´ì¬ì˜ í™•ì¸ì´ì—ìš”.\nì‚¬ë‘ë°›ëŠ” ì¡´ì¬ëŠ” ê²°ì½” ì‘ì§€ ì•Šì•„ìš”.",
                            change: "ë³€í™”ë¥¼ ì„ íƒí•œë‹¤ëŠ” ê±´,\ní˜„ì¬ì— ë¨¸ë¬¼ì§€ ì•Šê² ë‹¤ëŠ” ì˜ì§€ì˜ˆìš”.\nê·¸ ì˜ì§€ê°€ ë‹¹ì‹ ì„ í¬ê²Œ ë§Œë“¤ì—ˆì–´ìš”.",
                            general: "ë‹¹ì‹ ì€ ì§€ê¸ˆ, ìë¹„ì™€ í™•ì‹  ì‚¬ì´ì—ì„œ\nì§„ì§œ ìì‹ ì˜ í¬ê¸°ë¥¼ íšŒë³µí•˜ê³  ìˆì–´ìš”."
                        },
                        en: {
                            recognition: "Being recognized is about\nrevealing what was already there.\nYou were always worthy of recognition.",
                            support: "True support doesn't create dependence,\nbut helps independence.\nYou received that kind of support.",
                            achievement: "Achievement is confirmation, not proof.\nIt was a moment of confirming abilities that were already there.",
                            voice: "Using your voice is\ndeclaring your existence.\nYou finally declared your existence.",
                            boundary: "Boundaries are not rejection but definition.\nOnly those who can define themselves\ncan truly be great.",
                            kindness: "Warmth is the thawing of the heart.\nYour frozen confidence began to flow again.",
                            realization: "Realization is the recovery of memory.\nIt was the moment you remembered\nyour true self that you had forgotten.",
                            independence: "Being able to stand alone means\nyou don't need anyone's permission.\nYou gave yourself permission.",
                            courage: "Courage determines size.\nA courageous heart never becomes small.",
                            acceptance: "Self-acceptance is the foundation of growth.\nTrue growth begins from the place of acceptance.",
                            love: "Love is confirmation of existence.\nA loved being is never small.",
                            change: "Choosing change means\nthe will not to remain in the present.\nThat will made you great.",
                            general: "You are now, between compassion and conviction,\nrecovering your true size."
                        },
                        pt: {
                            recognition: "Ser reconhecido Ã© sobre\nrevelar o que jÃ¡ estava lÃ¡.\nVocÃª sempre foi digno de reconhecimento.",
                            support: "O verdadeiro apoio nÃ£o cria dependÃªncia,\nmas ajuda a independÃªncia.\nVocÃª recebeu esse tipo de apoio.",
                            achievement: "Conquista Ã© confirmaÃ§Ã£o, nÃ£o prova.\nFoi um momento de confirmar habilidades que jÃ¡ estavam lÃ¡.",
                            voice: "Usar sua voz Ã©\ndeclarar sua existÃªncia.\nVocÃª finalmente declarou sua existÃªncia.",
                            boundary: "Limites nÃ£o sÃ£o rejeiÃ§Ã£o, mas definiÃ§Ã£o.\nApenas aqueles que podem se definir\npodem verdadeiramente ser grandes.",
                            kindness: "Gentileza Ã© o degelo do coraÃ§Ã£o.\nSua confianÃ§a congelada comeÃ§ou a fluir novamente.",
                            realization: "PercepÃ§Ã£o Ã© a recuperaÃ§Ã£o da memÃ³ria.\nFoi o momento em que vocÃª se lembrou\ndo seu verdadeiro eu que havia esquecido.",
                            independence: "Ser capaz de ficar em pÃ© sozinho significa\nque vocÃª nÃ£o precisa da permissÃ£o de ninguÃ©m.\nVocÃª se deu permissÃ£o.",
                            courage: "Coragem determina tamanho.\nUm coraÃ§Ã£o corajoso nunca se torna pequeno.",
                            acceptance: "Auto-aceitaÃ§Ã£o Ã© a fundaÃ§Ã£o do crescimento.\nVerdadeiro crescimento comeÃ§a do lugar da aceitaÃ§Ã£o.",
                            love: "Amor Ã© confirmaÃ§Ã£o de existÃªncia.\nUm ser amado nunca Ã© pequeno.",
                            change: "Escolher mudanÃ§a significa\na vontade de nÃ£o permanecer no presente.\nEssa vontade te fez grande.",
                            general: "VocÃª estÃ¡ agora, entre compaixÃ£o e convicÃ§Ã£o,\nrecuperando seu verdadeiro tamanho."
                        }
                    };
                    
                    return responses[lang][empowermentType] || responses[lang]['general'];
                }
            },
            {
                name: "Kael", emoji: "ğŸ§™",
                getResponse: (userInput, lang) => {
                    const empowermentType = analyzeEmpowermentType(userInput);
                    
                    const responses = {
                        ko: {
                            recognition: "ê·¸ ì¸ì •ì€ ë°œê²¬ì´ì—ˆì–´ìš”.\në‹¹ì‹ ì´ ìˆ¨ê²¨ë†“ì€ ë³´ì„ì„\nëˆ„êµ°ê°€ ë“œë””ì–´ ì°¾ì•„ë‚¸ ìˆœê°„ì´ì—ˆì–´ìš”.",
                            support: "ì§„ì •í•œ ë™ë§¹ì€ ë‹¹ì‹ ì„ ëŒ€ì‹ í•˜ì§€ ì•Šì•„ìš”.\në‹¹ì‹ ì´ ìŠ¤ìŠ¤ë¡œ ì„¤ ìˆ˜ ìˆë„ë¡ ê³ì— ì„œëŠ” ê±°ì£ .",
                            achievement: "ê·¸ ì„±ì·¨ëŠ” ë§ˆë²• ê°™ì•˜ê² ì§€ë§Œ,\në§ˆë²•ì€ ì´ë¯¸ ë‹¹ì‹  ì•ˆì— ìˆì—ˆì–´ìš”.\në‹¨ì§€ ë°œë™ëœ ê²ƒë¿ì´ì—ìš”.",
                            voice: "ëª©ì†Œë¦¬ëŠ” ì£¼ë¬¸ì´ì—ìš”.\në‹¹ì‹ ì€ ìŠ¤ìŠ¤ë¡œì—ê²Œ 'ì¡´ì¬í•˜ë¼'ëŠ” ì£¼ë¬¸ì„ ê±¸ì—ˆì–´ìš”.",
                            boundary: "ê²½ê³„ëŠ” ë°©ì–´ë§‰ì´ ì•„ë‹ˆë¼ ì •ì˜ì˜ˆìš”.\nìì‹ ì„ ì •ì˜í•˜ëŠ” ìˆœê°„,\nì„¸ìƒë„ ë‹¹ì‹ ì„ ìƒˆë¡­ê²Œ ë´…ë‹ˆë‹¤.",
                            kindness: "ê·¸ ì¹œì ˆì€ í•´ë…ì œì˜€ì–´ìš”.\në…ì²˜ëŸ¼ í¼ì ¸ìˆë˜ ìê¸° ë¹„í•˜ë¥¼\nì¤‘í™”ì‹œí‚¨ í•´ë…ì œ.",
                            realization: "ê¹¨ë‹¬ìŒì€ ê¸°ì–µì˜ ë§ˆë²•ì´ì—ìš”.\nìƒì–´ë²„ë¦° ìì‹ ì„ ë‹¤ì‹œ ì†Œí™˜í•œ ìˆœê°„ì´ì—ˆì–´ìš”.",
                            independence: "ë…ë¦½ì€ ê°€ì¥ ê°•ë ¥í•œ ë§ˆë²•ì´ì—ìš”.\nìì‹ ì˜ í˜ìœ¼ë¡œ ì„œëŠ” ìˆœê°„,\në‹¹ì‹ ì€ ë§ˆë²•ì‚¬ê°€ ë©ë‹ˆë‹¤.",
                            courage: "ìš©ê¸°ëŠ” ë³€ì‹ ìˆ ì´ì—ìš”.\nì‘ì€ ì¡´ì¬ì—ì„œ ì§„ì§œ ìì‹ ìœ¼ë¡œ\në³€ì‹ í•˜ê²Œ í•´ì£¼ëŠ” ë§ˆë²•ì´ì—ìš”.",
                            acceptance: "ë°›ì•„ë“¤ì„ì€ ì™„ì „í•œ ë§ˆë²•ì´ì—ìš”.\nëª¨ë“  ê²ƒì„ ìˆëŠ” ê·¸ëŒ€ë¡œ ë³´ëŠ” í˜,\nê·¸ê²ƒì´ ì§„ì •í•œ ë§ˆë²•ì…ë‹ˆë‹¤.",
                            love: "ì‚¬ë‘ì€ ë¶€í™œ ì£¼ë¬¸ì´ì—ìš”.\nì£½ì–´ìˆë˜ ìì¡´ê°ì„ ë‹¤ì‹œ ì‚´ë ¤ë‚´ëŠ”\nê°€ì¥ ê°•ë ¥í•œ ë§ˆë²•ì´ì—ìš”.",
                            change: "ë³€í™”ëŠ” ì—°ê¸ˆìˆ ì´ì—ìš”.\në‚© ê°™ë˜ ìì‹ ì„ ê¸ˆìœ¼ë¡œ ë°”ê¾¸ëŠ”\në§ˆë²•ì‚¬ì˜ ê¸°ìˆ ì´ì—ˆì–´ìš”.",
                            general: "ì´ì œ ë‹¹ì‹ ì€ ì¡°ìš©í•œ ëª©ì†Œë¦¬ë¡œë„\nì¶©ë¶„íˆ ì„¸ìƒì„ í”ë“¤ ìˆ˜ ìˆì–´ìš”."
                        },
                        en: {
                            recognition: "That recognition was a discovery.\nIt was the moment someone finally found\nthe gem you had hidden.",
                            support: "True allies don't replace you.\nThey stand beside you so you can stand on your own.",
                            achievement: "That achievement might have seemed magical,\nbut the magic was already within you.\nIt was simply activated.",
                            voice: "Voice is a spell.\nYou cast a spell on yourself to 'exist'.",
                            boundary: "Boundaries are not shields but definitions.\nThe moment you define yourself,\nthe world sees you anew.",
                            kindness: "That kindness was an antidote.\nAn antidote that neutralized\nthe self-deprecation spreading like poison.",
                            realization: "Realization is the magic of memory.\nIt was the moment you summoned your lost self back.",
                            independence: "Independence is the most powerful magic.\nThe moment you stand by your own strength,\nyou become a magician.",
                            courage: "Courage is transformation magic.\nMagic that transforms you from a small being\ninto your true self.",
                            acceptance: "Acceptance is complete magic.\nThe power to see everything as it is,\nthat is true magic.",
                            love: "Love is a resurrection spell.\nThe most powerful magic that revives\ndead self-esteem.",
                            change: "Change is alchemy.\nIt was the magician's skill of transforming\nyour lead-like self into gold.",
                            general: "Now you can shake the world sufficiently\neven with a quiet voice."
                        },
                        pt: {
                            recognition: "Aquele reconhecimento foi uma descoberta.\nFoi o momento em que alguÃ©m finalmente encontrou\na joia que vocÃª havia escondido.",
                            support: "Verdadeiros aliados nÃ£o te substituem.\nEles ficam ao seu lado para que vocÃª possa ficar em pÃ© sozinho.",
                            achievement: "Aquela conquista pode ter parecido mÃ¡gica,\nmas a magia jÃ¡ estava dentro de vocÃª.\nFoi simplesmente ativada.",
                            voice: "Voz Ã© um feitiÃ§o.\nVocÃª lanÃ§ou um feitiÃ§o em si mesmo para 'existir'.",
                            boundary: "Limites nÃ£o sÃ£o escudos, mas definiÃ§Ãµes.\nNo momento em que vocÃª se define,\no mundo te vÃª de novo.",
                            kindness: "Aquela gentileza foi um antÃ­doto.\nUm antÃ­doto que neutralizou\na autodepreciaÃ§Ã£o se espalhando como veneno.",
                            realization: "PercepÃ§Ã£o Ã© a magia da memÃ³ria.\nFoi o momento em que vocÃª invocou seu eu perdido de volta.",
                            independence: "IndependÃªncia Ã© a magia mais poderosa.\nNo momento em que vocÃª fica em pÃ© pela prÃ³pria forÃ§a,\nvocÃª se torna um mÃ¡gico.",
                            courage: "Coragem Ã© magia de transformaÃ§Ã£o.\nMagia que te transforma de um ser pequeno\nem seu verdadeiro eu.",
                            acceptance: "AceitaÃ§Ã£o Ã© magia completa.\nO poder de ver tudo como Ã©,\nessa Ã© a verdadeira magia.",
                            love: "Amor Ã© um feitiÃ§o de ressurreiÃ§Ã£o.\nA magia mais poderosa que revive\na autoestima morta.",
                            change: "MudanÃ§a Ã© alquimia.\nFoi a habilidade do mÃ¡gico de transformar\nseu eu como chumbo em ouro.",
                            general: "Agora vocÃª pode abalar o mundo suficientemente\nmesmo com uma voz silenciosa."
                        }
                    };
                    
                    return responses[lang][empowermentType] || responses[lang]['general'];
                }
            }
        ];
        
        // Typewriter effect
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (state.currentTypingElement) {
                    state.currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                state.currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                state.typingIntervals.push(typingInterval);
            });
        }
        
        // Clear all typing effects
        function clearAllTypingEffects() {
            state.typingIntervals.forEach(interval => clearInterval(interval));
            state.typingIntervals = [];
            
            if (state.currentTypingElement) {
                state.currentTypingElement.classList.remove('typing-cursor');
                state.currentTypingElement = null;
            }
        }
        
        // Scroll functions
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        // Language management
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            const t = translations[lang];
            document.title = t.title;
            document.getElementById('logoSubtitle').textContent = t.logoSubtitle;
            document.getElementById('portalMainTitle').textContent = t.portalMainTitle;
            document.getElementById('portalSubtitle').textContent = t.portalSubtitle;
            document.getElementById('lightTitle').textContent = t.lightTitle;
            document.getElementById('navigationTitle').textContent = t.navigationTitle;
            document.getElementById('nextPortalBtn').textContent = t.nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = t.stayPortalBtn;
            document.getElementById('userTextarea').placeholder = t.inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (state.currentLanguage === lang) return;
            
            state.currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            resetJourney();
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        // Journey management
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            state.userResponse = '';
            state.currentTypingElement = null;
            state.awaitingSecondResponse = false;
        }
        
        // Save response to database or memory
        async function saveResponse(inputText, step) {
            const responseData = {
                portal: portalConfig.currentPortal,
                resposta: inputText,
                step: step,
                data: new Date().toISOString(),
                idioma: state.currentLanguage,
                userId: state.currentUser ? state.currentUser.uid : 'anonymous',
                userEmail: state.currentUser ? state.currentUser.email : 'anonymous@temarix.com'
            };
            
            if (state.firebaseInitialized && state.db) {
                try {
                    await state.db.collection("temarix_v5_respostas").add({
                        ...responseData,
                        timestamp: firebase.firestore.Timestamp.now()
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                    state.userResponses.push(responseData);
                    showConnectionStatus(false);
                }
            } else {
                state.userResponses.push(responseData);
                console.log('Response stored in memory:', responseData);
            }
        }
        
        // User input processing
        async function processUserInput(inputText) {
            state.userResponse = inputText;
            
            await saveResponse(inputText, state.awaitingSecondResponse ? "second" : "first");
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!state.awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[state.currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        // Show character reactions
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[state.currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                state.awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, state.currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[state.currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[state.currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        // Portal sequence
        async function startPortalSequence() {
            console.log('Starting portal sequence...');
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            console.log('Showing intro...');
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            if (!introSection || !introElement) {
                console.error('Intro elements not found!');
                return;
            }
            
            introSection.classList.add('show');
            
            const introText = translations[state.currentLanguage].portalIntro;
            console.log('Intro text:', introText);
            
            await typewriterEffect(introElement, introText, 60);
            
            setTimeout(async () => {
                await showEmotionalBridge();
            }, 2000);
        }
        
        async function showEmotionalBridge() {
            const introElement = document.getElementById('portalIntro');
            const bridgeText = '\n\n' + translations[state.currentLanguage].emotionalBridge;
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const bridgeP = document.createElement('p');
            bridgeP.style.cssText = `
                margin-top: 30px;
                font-style: italic;
                color: #ff9999;
                font-size: 18px;
                line-height: 1.8;
            `;
            introElement.appendChild(bridgeP);
            
            await typewriterEffect(bridgeP, bridgeText.trim(), 50);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        // Custom confirm dialog
        function showConfirmDialog(message, callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                font-family: 'Courier New', monospace;
            `;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: #222;
                border: 2px solid #ff6b6b;
                padding: 30px;
                max-width: 400px;
                text-align: center;
                color: white;
            `;
            
            const messageP = document.createElement('p');
            messageP.textContent = message;
            messageP.style.cssText = `
                margin-bottom: 20px;
                line-height: 1.6;
                font-size: 16px;
            `;
            
            const buttonContainer = document.createElement('div');
            buttonContainer.style.cssText = `
                display: flex;
                gap: 15px;
                justify-content: center;
            `;
            
            const yesBtn = document.createElement('button');
            const noBtn = document.createElement('button');
            
            const buttonStyle = `
                background: #444;
                color: white;
                border: 1px solid #ff6b6b;
                padding: 10px 20px;
                cursor: pointer;
                font-family: 'Courier New', monospace;
                font-size: 14px;
            `;
            
            yesBtn.style.cssText = buttonStyle + 'background: #ff6b6b;';
            noBtn.style.cssText = buttonStyle;
            
            yesBtn.textContent = state.currentLanguage === 'ko' ? 'ì˜ˆ' : 
                                state.currentLanguage === 'pt' ? 'Sim' : 'Yes';
            noBtn.textContent = state.currentLanguage === 'ko' ? 'ì•„ë‹ˆì˜¤' : 
                               state.currentLanguage === 'pt' ? 'NÃ£o' : 'No';
            
            yesBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(true);
            };
            
            noBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(false);
            };
            
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                    callback(false);
                }
            };
            
            buttonContainer.appendChild(yesBtn);
            buttonContainer.appendChild(noBtn);
            modal.appendChild(messageP);
            modal.appendChild(buttonContainer);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            yesBtn.focus();
        }
        
        // Event setup
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function createPortalTransition(callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, #000 0%, #111 50%, #000 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 20000;
                opacity: 0;
                transition: opacity 1s ease-in-out;
                font-family: 'Courier New', monospace;
            `;
            
            const message = document.createElement('div');
            message.style.cssText = `
                color: #ff6b6b;
                font-size: 24px;
                text-align: center;
                margin-bottom: 30px;
                opacity: 0;
                transform: translateY(20px);
                transition: all 0.8s ease-out;
            `;
            message.textContent = translations[state.currentLanguage].transitionMessage;
            
            const loader = document.createElement('div');
            loader.style.cssText = `
                width: 60px;
                height: 60px;
                border: 3px solid #333;
                border-top: 3px solid #ff6b6b;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                opacity: 0;
                transition: opacity 0.8s ease-out 0.3s;
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            overlay.appendChild(message);
            overlay.appendChild(loader);
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                overlay.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                message.style.opacity = '1';
                message.style.transform = 'translateY(0)';
                loader.style.opacity = '1';
            }, 300);
            
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(overlay);
                    document.head.removeChild(style);
                    callback();
                }, 1000);
            }, 2500);
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmNextPortal, (confirmed) => {
                    if (confirmed) {
                        if (state.firebaseInitialized && state.db) {
                            state.db.collection("temarix_v5_progress").add({
                                userId: state.currentUser.uid,
                                portal: portalConfig.currentPortal,
                                status: "complete",
                                timestamp: firebase.firestore.Timestamp.now()
                            }).catch(error => console.error('Error saving progress:', error));
                        }
                        
                        createPortalTransition(() => {
                            window.location.href = `${portalConfig.nextPortalFile}?lang=${state.currentLanguage}`;
                        });
                    }
                });
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmStay, (confirmed) => {
                    if (confirmed) {
                        resetJourney();
                        setTimeout(() => {
                            startPortalSequence();
                        }, 1000);
                    }
                });
            });
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        function initializeTemarix() {
            console.log('Initializing Temarix V5 Portal 11...');
            console.log('Current state:', state);
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            state.journeyStarted = true;
            console.log('Journey started:', state.journeyStarted);
            
            console.log('Starting portal sequence in 1 second...');
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Temarix V5 Portal 11 DOM loaded');
            
            state.currentLanguage = getLanguageFromURL();
            
            updateStaticTranslations(state.currentLanguage);
            updateLanguageButtons(state.currentLanguage);
            
            await initializeFirebase();
            
            initializeTemarix();
        });
    </script>
</body>
</html>