<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V5 - Portal 10: The Truth in My Soliloquy</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .navigation-title {
                font-size: 24px;
            }
            
            .navigation-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V5</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 10: The Truth in My Soliloquy</div>
            <div class="portal-subtitle" id="portalSubtitle">When no one was listening, what did I really say?</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">ğŸ—£ Portal 10 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 11</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with this truth</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Tell me about a time when you spoke your deepest truth to yourself... (Press Enter to send)"
                      rows="1"
                      maxlength="800"></textarea>
        </div>
    </div>

    <script>
        // Global state management
        let state = {
            db: null,
            auth: null,
            firebaseInitialized: false,
            currentUser: null,
            currentLanguage: 'en',
            userResponse: '',
            journeyStarted: false,
            currentTypingElement: null,
            typingIntervals: [],
            awaitingSecondResponse: false,
            userResponses: []
        };
        
        // Portal navigation configuration
        const portalConfig = {
            currentPortal: "v5-10",
            nextPortal: "v5-11",
            nextPortalFile: "temarix_v05_11.html"
        };
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
            authDomain: "canal-vivo-chat.firebaseapp.com",
            projectId: "canal-vivo-chat",
            storageBucket: "canal-vivo-chat.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdefghijklmnopqr"
        };
        
        // Initialize Firebase with error handling
        function initializeFirebase() {
            return new Promise((resolve) => {
                try {
                    if (typeof firebase !== 'undefined') {
                        firebase.initializeApp(firebaseConfig);
                        state.db = firebase.firestore();
                        state.auth = firebase.auth();
                        state.firebaseInitialized = true;
                        
                        state.auth.onAuthStateChanged((user) => {
                            if (user) {
                                state.currentUser = user;
                            } else {
                                state.currentUser = {
                                    uid: 'anonymous-' + Date.now(),
                                    email: 'anonymous@temarix.com',
                                    isAnonymous: true
                                };
                            }
                            showConnectionStatus(true);
                        });
                        
                        console.log('Firebase initialized successfully');
                    } else {
                        console.log('Firebase SDK not loaded');
                        state.currentUser = {
                            uid: 'anonymous-' + Date.now(),
                            email: 'anonymous@temarix.com',
                            isAnonymous: true
                        };
                        showConnectionStatus(false);
                    }
                } catch (error) {
                    console.error('Firebase initialization failed:', error);
                    state.currentUser = {
                        uid: 'anonymous-' + Date.now(),
                        email: 'anonymous@temarix.com',
                        isAnonymous: true
                    };
                    showConnectionStatus(false);
                }
                resolve();
            });
        }
        
        // Show connection status to user
        function showConnectionStatus(isOnline) {
            const existingStatus = document.querySelector('.connection-status');
            if (existingStatus) {
                existingStatus.remove();
            }
            
            if (!isOnline) {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'connection-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: rgba(255, 107, 107, 0.9);
                    color: white;
                    padding: 8px 15px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-family: 'Courier New', monospace;
                    z-index: 1000;
                    opacity: 0.8;
                `;
                statusDiv.textContent = state.currentLanguage === 'ko' ? 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ' : 
                                       state.currentLanguage === 'pt' ? 'Modo offline' : 'Offline mode';
                document.body.appendChild(statusDiv);
                
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.remove();
                    }
                }, 5000);
            }
        }

        // Translations object
        const translations = {
            ko: {
                title: "Temarix V5 - Portal 10: í˜¼ì£ë§ ì†ì˜ ì§„ì‹¬",
                logoSubtitle: "ê°ì • ì—°ê¸ˆìˆ ",
                portalMainTitle: "Portal 10: í˜¼ì£ë§ ì†ì˜ ì§„ì‹¬",
                portalSubtitle: "ì•„ë¬´ë„ ë“£ì§€ ëª»í–ˆì§€ë§Œ, ë‚˜ëŠ” ë¬´ì—‡ì„ ë§í–ˆëŠ”ê°€?",
                portalIntro: "ğŸ—£ \"ì•„ë¬´ë„ ë“£ì§€ ëª»í–ˆì§€ë§Œ,\në‹¹ì‹  í˜¼ì ì¤‘ì–¼ê±°ë ¸ë˜ ë§ ì¤‘ì—\nê°€ì¥ ì§„ì‹¬ì´ ë‹´ê²¨ ìˆì—ˆë˜ ìˆœê°„ì€ ì–¸ì œì˜€ë‚˜ìš”?\"\n\n\"ê·¸ ë§ì€ ì™œ, ëˆ„êµ¬ì—ê²Œ í•˜ê³  ì‹¶ì—ˆë˜ ê±¸ê¹Œìš”?\"",
                emotionalBridge: "í˜¼ì£ë§ì€ ë•Œë¡œ ê°€ì¥ ì •ì§í•œ ê¸°ë„ì…ë‹ˆë‹¤.\në§ˆìŒ ê¹Šìˆ™í•œ ê³³ì—ì„œ ë‚˜ì˜¨ ê·¸ ë§ë“¤ì€ ë‹¹ì‹ ì˜ ì§„ì§œ ëª©ì†Œë¦¬ì˜€ì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.\n\nì§€ê¸ˆ, ê·¸ ì§„ì‹¬ì„ ë‹¤ì‹œ ë“¤ì–´ë³¼ ìˆ˜ ìˆë‚˜ìš”?",
                followUpQuestion: "ê·¸ë•Œì˜ ì†ì‚­ì„ì„ ì§€ê¸ˆ ë‹¤ì‹œ í•  ìˆ˜ ìˆë‹¤ë©´...\nì–´ë–¤ ë§ˆìŒìœ¼ë¡œ, ì–´ë–¤ ì–´ì¡°ë¡œ ì „í•˜ê³  ì‹¶ë‚˜ìš”?",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ì´ì œ í˜¼ì£ë§ì€ í˜¼ìì˜ ë§ì´ ì•„ë‹ˆì—ìš”.\nì§„ì‹¬ì´ ì¡´ì¬ë¥¼ ë°í˜”ì–´ìš”.",
                navigationTitle: "ğŸ—£ Portal 10 ì™„ë£Œ",
                navigationMessage: "ë‹¹ì‹ ì€ ì¹¨ë¬µ ì†ì— ìˆ¨ì–´ìˆë˜ ì§„ì‹¬ì„ êº¼ëƒˆìŠµë‹ˆë‹¤.\n\nê·¸ í˜¼ì£ë§ë“¤ì€ ë” ì´ìƒ í˜¼ìë§Œì˜ ì†ì‚­ì„ì´ ì•„ë‹ˆë¼, ì„¸ìƒì„ í–¥í•œ ì§„ì‹¤í•œ ëª©ì†Œë¦¬ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.\në§í•˜ì§€ ëª»í–ˆë˜ ì§„ì‹¬ì´ ì´ì œëŠ” ë‹¹ì‹ ì„ ëŒ€ë³€í•˜ëŠ” ì–¸ì–´ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\në‹¹ì‹ ì€ ì´ì œ ìì‹ ì˜ ëª©ì†Œë¦¬ë¥¼ ë¯¿ê³  ë§í•  ìˆ˜ ìˆëŠ” ì‚¬ëŒì…ë‹ˆë‹¤.",
                nextPortalBtn: "Portal 11ë¡œ ì´ì–´ê°€ê¸°",
                stayPortalBtn: "ì´ ì§„ì‹¬ê³¼ ë¨¸ë¬¼ê¸°",
                inputPlaceholder: "ê°€ì¥ ì§„ì‹¬ì´ ë‹´ê¸´ í˜¼ì£ë§ì— ëŒ€í•´ ë§í•´ì£¼ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...",
                confirmNextPortal: "Portal 11: ì‘ì•„ì§€ë˜ ë‚˜ë¥¼ ì¼ìœ¼ì¼œ ì„¸ìš´ ë‚ ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                confirmStay: "ì´ ì§„ì‹¬ê³¼ ë” ë¨¸ë¬¼ë©° ìì‹ ì˜ ëª©ì†Œë¦¬ë¥¼ ê¹Šì´ ëŠë¼ì‹œê² ìŠµë‹ˆê¹Œ?",
                transitionMessage: "ìƒˆë¡œìš´ ì—¬ì •ì´ ì‹œì‘ë©ë‹ˆë‹¤..."
            },
            en: {
                title: "Temarix V5 - Portal 10: The Truth in My Soliloquy",
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 10: The Truth in My Soliloquy",
                portalSubtitle: "When no one was listening, what did I really say?",
                portalIntro: "ğŸ—£ \"Among the words you muttered to yourself\nwhen no one could hear,\nwhen was the moment that carried the deepest truth?\"\n\n\"Why did you want to say those words, and to whom?\"",
                emotionalBridge: "Soliloquies are sometimes the most honest prayers.\nThose words from deep within your heart might have been your true voice.\n\nNow, can you listen to that sincerity again?",
                followUpQuestion: "If you could speak that whisper again now...\nwith what heart and in what tone would you want to convey it?",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Now soliloquy is no longer a solitary word.\nSincerity has illuminated existence.",
                navigationTitle: "ğŸ—£ Portal 10 Complete",
                navigationMessage: "You have brought out the sincerity hidden in silence.\n\nThose soliloquies are no longer whispers meant for you alone, but have become a truthful voice toward the world.\nThe sincerity you couldn't express has now become the language that represents you.\n\nYou are now someone who can trust and speak with your own voice.",
                nextPortalBtn: "Continue to Portal 11",
                stayPortalBtn: "Stay with this truth",
                inputPlaceholder: "Tell me about a time when you spoke your deepest truth to yourself... (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response...",
                confirmNextPortal: "Do you want to continue to Portal 11: The Day I Lifted My Diminished Self?",
                confirmStay: "Do you want to stay longer with this sincerity to deeply feel your own voice?",
                transitionMessage: "A new journey begins..."
            },
            pt: {
                title: "Temarix V5 - Portal 10: A Verdade no Meu SolilÃ³quio",
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 10: A Verdade no Meu SolilÃ³quio",
                portalSubtitle: "Quando ninguÃ©m estava ouvindo, o que eu realmente disse?",
                portalIntro: "ğŸ—£ \"Entre as palavras que vocÃª murmurou para si mesmo\nquando ninguÃ©m podia ouvir,\nquando foi o momento que carregou a verdade mais profunda?\"\n\n\"Por que vocÃª queria dizer essas palavras, e para quem?\"",
                emotionalBridge: "SolilÃ³quios sÃ£o Ã s vezes as oraÃ§Ãµes mais honestas.\nEssas palavras do fundo do seu coraÃ§Ã£o podem ter sido sua verdadeira voz.\n\nAgora, vocÃª pode ouvir essa sinceridade novamente?",
                followUpQuestion: "Se vocÃª pudesse falar esse sussurro novamente agora...\ncom que coraÃ§Ã£o e em que tom gostaria de transmiti-lo?",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Agora o solilÃ³quio nÃ£o Ã© mais uma palavra solitÃ¡ria.\nA sinceridade iluminou a existÃªncia.",
                navigationTitle: "ğŸ—£ Portal 10 Completo",
                navigationMessage: "VocÃª trouxe para fora a sinceridade escondida no silÃªncio.\n\nEsses solilÃ³quios nÃ£o sÃ£o mais sussurros destinados apenas a vocÃª, mas se tornaram uma voz verdadeira em direÃ§Ã£o ao mundo.\nA sinceridade que vocÃª nÃ£o conseguia expressar agora se tornou a linguagem que te representa.\n\nVocÃª Ã© agora alguÃ©m que pode confiar e falar com sua prÃ³pria voz.",
                nextPortalBtn: "Continuar para Portal 11",
                stayPortalBtn: "Ficar com esta verdade",
                inputPlaceholder: "Conte-me sobre um momento em que falou sua verdade mais profunda para si mesmo... (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta...",
                confirmNextPortal: "Deseja continuar para Portal 11: O Dia em que Levantei Meu Eu DiminuÃ­do?",
                confirmStay: "Deseja ficar mais tempo com esta sinceridade para sentir profundamente sua prÃ³pria voz?",
                transitionMessage: "Uma nova jornada comeÃ§a..."
            }
        };
        
        // Character definitions
        const characters = [
            { name: "Noah", emoji: "ğŸ§‘â€ğŸ¦±", text: {
                ko: "ê·¸ í•œë§ˆë””ëŠ”â€¦\nì–´ë–¤ ì™¸ì¹¨ë³´ë‹¤ ë” í° ìš¸ë¦¼ì´ì—ˆì„ ê±°ì•¼.",
                en: "That one sentence...\nwould have had a greater resonance than any shout.",
                pt: "Essa Ãºnica frase...\nteria tido uma ressonÃ¢ncia maior que qualquer grito."
            }},
            { name: "Ely", emoji: "ğŸ§â€â™€ï¸", text: {
                ko: "í˜¼ì£ë§ì€ ë•Œë¡œ ê°€ì¥ ì •ì§í•œ ê¸°ë„ì˜ˆìš”.\në‹¹ì‹ ì€ ê·¸ ê¸°ë„ë¥¼ ë“¤ì€ ì²« ë²ˆì§¸ ì‚¬ëŒì´ì—ìš”.",
                en: "Soliloquies are sometimes the most honest prayers.\nYou are the first person to hear that prayer.",
                pt: "SolilÃ³quios sÃ£o Ã s vezes as oraÃ§Ãµes mais honestas.\nVocÃª Ã© a primeira pessoa a ouvir essa oraÃ§Ã£o."
            }},
            { name: "Sora", emoji: "ğŸ§•", text: {
                ko: "ê·¸ ì†ì‚­ì„ì€ ì™¸ë¡œì›€ì´ ì•„ë‹ˆë¼,\nìì‹ ì„ í–¥í•œ ë§ˆì§€ë§‰ êµ¬ì¡°ì‹ í˜¸ì˜€ì–´ìš”.",
                en: "That whisper wasn't loneliness,\nbut a final rescue signal to yourself.",
                pt: "Esse sussurro nÃ£o era solidÃ£o,\nmas um sinal de resgate final para si mesmo."
            }},
            { name: "Kael", emoji: "ğŸ§™", text: {
                ko: "ë§í•˜ì§€ ëª»í–ˆë˜ ì§„ì‹¬ì€,\nì˜¤ëŠ˜ì—ì„œì•¼ ì˜ë¯¸ë¥¼ ì–»ì—ˆêµ°ìš”.",
                en: "The sincerity you couldn't express\nhas finally gained meaning today.",
                pt: "A sinceridade que vocÃª nÃ£o conseguia expressar\nfinalmente ganhou significado hoje."
            }},
            { name: "Mira", emoji: "ğŸ§‘â€ğŸ¨", text: {
                ko: "ê·¸ ë§ì€ ìŠíŒ ë©”ëª¨ ê°™ì•˜ì§€ë§Œ,\nì§€ê¸ˆì€ ë‹¹ì‹  ì•ˆì—ì„œ ë‹¤ì‹œ ì½íˆê³  ìˆì–´ìš”.",
                en: "Those words were like a forgotten memo,\nbut now they're being read again within you.",
                pt: "Essas palavras eram como um memorando esquecido,\nmas agora estÃ£o sendo lidas novamente dentro de vocÃª."
            }},
            { name: "Cris", emoji: "ğŸ¦¸â€â™‚ï¸", text: {
                ko: "ì‘ì€ ëª©ì†Œë¦¬ëŠ” ë¬´ì‹œë‹¹í•˜ê¸° ì‰¬ì›Œ.\ní•˜ì§€ë§Œ ë„¤ê°€ ê·¸ê±¸ ê¸°ì–µí–ˆë‹¤ë©´, ê·¸ê±´ ì´ë¯¸ í˜ì´ì•¼.",
                en: "Small voices are easily ignored.\nBut if you remembered it, that's already power.",
                pt: "Vozes pequenas sÃ£o facilmente ignoradas.\nMas se vocÃª se lembrou dela, isso jÃ¡ Ã© poder."
            }},
            { name: "Enya", emoji: "ğŸ§‘â€ğŸš€", text: {
                ko: "í˜¼ì£ë§ì€ ê³µê°„ì„ ë„˜ì§€ ì•Šì§€ë§Œ,\nì˜í˜¼ì€ ê·¸ ë§ì„ ìŠì§€ ì•Šì•„ìš”.",
                en: "Soliloquies don't cross space,\nbut the soul never forgets those words.",
                pt: "SolilÃ³quios nÃ£o cruzam o espaÃ§o,\nmas a alma nunca esquece essas palavras."
            }},
            { name: "Lian", emoji: "ğŸ§˜", text: {
                ko: "ê·¸ ë§ì€ ë‹¹ì‹ ì˜ ê°€ì¥ ê¹Šì€ ì§„ì‹¬ì´ì—ˆê³ ,\nì˜¤ëŠ˜ ë‹¹ì‹ ì´ ê·¸ê²ƒì„ êº¼ë‚´ ì£¼ì—ˆì–´ìš”.",
                en: "Those words were your deepest sincerity,\nand today you brought them out.",
                pt: "Essas palavras eram sua sinceridade mais profunda,\ne hoje vocÃª as trouxe para fora."
            }}
        ];

        // Soliloquy type analysis function
        function analyzeSoliloquyType(userInput) {
            const input = userInput.toLowerCase();
            
            const soliloquyKeywords = {
                longing: ['want', 'need', 'wish', 'hope', 'dream', 'ì›í•´', 'í•„ìš”í•´', 'ë°”ë¼', 'í¬ë§', 'ê¿ˆ', 'quero', 'preciso', 'desejo', 'espero', 'sonho'],
                pain: ['hurt', 'pain', 'sad', 'cry', 'broken', 'ì•„íŒŒ', 'ìŠ¬í¼', 'ìš¸ì–´', 'ì•„í””', 'ìƒì²˜', 'dÃ³i', 'dor', 'triste', 'choro', 'quebrado'],
                love: ['love', 'miss', 'care', 'heart', 'dear', 'ì‚¬ë‘', 'ê·¸ë¦¬ì›Œ', 'ë§ˆìŒ', 'ì†Œì¤‘', 'amor', 'saudade', 'coraÃ§Ã£o', 'querido'],
                fear: ['scared', 'afraid', 'worried', 'anxious', 'fear', 'ë¬´ì„œì›Œ', 'ë‘ë ¤ì›Œ', 'ê±±ì •', 'ë¶ˆì•ˆ', 'medo', 'assustado', 'preocupado', 'ansioso'],
                anger: ['angry', 'mad', 'hate', 'frustrated', 'rage', 'í™”ë‚˜', 'ì§œì¦', 'ë¯¸ì›Œ', 'ë¶„ë…¸', 'raiva', 'bravo', 'Ã³dio', 'frustrado'],
                apology: ['sorry', 'forgive', 'mistake', 'wrong', 'regret', 'ë¯¸ì•ˆ', 'ìš©ì„œ', 'ì‹¤ìˆ˜', 'ì˜ëª»', 'í›„íšŒ', 'desculpa', 'perdÃ£o', 'erro', 'arrependimento'],
                gratitude: ['thank', 'grateful', 'appreciate', 'blessed', 'ê³ ë§ˆì›Œ', 'ê°ì‚¬', 'ê³ ë§™', 'obrigado', 'grato', 'agradeÃ§o'],
                encouragement: ['can do', 'strong', 'brave', 'fight', 'keep going', 'í•  ìˆ˜ ìˆì–´', 'ê°•í•´', 'ìš©ê¸°', 'ì‹¸ì›Œ', 'ê³„ì†', 'posso', 'forte', 'corajoso', 'luta', 'continuar'],
                despair: ['give up', 'tired', 'enough', 'cant anymore', 'helpless', 'í¬ê¸°', 'ì§€ì³', 'ì¶©ë¶„í•´', 'ë” ì´ìƒ', 'ë¬´ë ¥', 'desistir', 'cansado', 'suficiente', 'nÃ£o aguento'],
                identity: ['who am i', 'myself', 'identity', 'real me', 'true self', 'ë‚˜ëŠ” ëˆ„êµ¬', 'ì§„ì§œ ë‚˜', 'ì •ì²´ì„±', 'quem sou', 'eu mesmo', 'identidade', 'verdadeiro eu'],
                guidance: ['what should i do', 'help me', 'show me', 'guide me', 'ì–´ë–¡í•˜ì§€', 'ë„ì™€ì¤˜', 'ì•Œë ¤ì¤˜', 'o que devo fazer', 'me ajude', 'me mostre', 'me guie'],
                acceptance: ['okay', 'accept', 'let go', 'peace', 'enough', 'ê´œì°®ì•„', 'ë°›ì•„ë“¤ì—¬', 'ë†“ì•„ì¤˜', 'í‰í™”', 'ok', 'aceitar', 'deixar ir', 'paz']
            };
            
            let detectedTypes = [];
            for (const [type, keywords] of Object.entries(soliloquyKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedTypes.push(type);
                        break;
                    }
                }
            }
            
            if (detectedTypes.length === 0) {
                detectedTypes = ['general'];
            }
            
            return detectedTypes[0];
        }
        
        // Response characters with soliloquy-based responses
        const responseCharacters = [
            {
                name: "Sora", emoji: "ğŸ§•",
                getResponse: (userInput, lang) => {
                    const soliloquyType = analyzeSoliloquyType(userInput);
                    
                    const responses = {
                        ko: {
                            longing: "ê·¸ ê°„ì ˆí•œ ì†ì‚­ì„ ì†ì—ëŠ”\në‹¹ì‹ ì˜ ê°€ì¥ ìˆœìˆ˜í•œ ì†Œë§ì´ ë‹´ê²¨ ìˆì—ˆì–´ìš”.\nê·¸ ì†Œë§ì€ ì§€ê¸ˆë„ ìœ íš¨í•´ìš”.",
                            pain: "ê³ í†µì„ í˜¼ì ì‚­ì˜€ë˜ ê·¸ ìˆœê°„,\në‹¹ì‹ ì€ ìì‹ ì—ê²Œ ê°€ì¥ ì†”ì§í–ˆì–´ìš”.\nê·¸ ì†”ì§í•¨ì´ ì§€ê¸ˆì˜ í˜ì´ ë˜ì—ˆì–´ìš”.",
                            love: "ì‚¬ë‘ì„ í˜¼ì£ë§ë¡œ ê³ ë°±í–ˆë˜ ê·¸ ë§ˆìŒ,\nì„¸ìƒì—ì„œ ê°€ì¥ ìˆœìˆ˜í•œ ì‚¬ë‘ì´ì—ˆì–´ìš”.\nê·¸ ì‚¬ë‘ì€ ì—¬ì „íˆ ë‹¹ì‹  ì•ˆì— ì‚´ì•„ìˆì–´ìš”.",
                            fear: "ë‘ë ¤ì›€ì„ ë§ë¡œ êº¼ë‚¸ ìˆœê°„,\nì´ë¯¸ ê·¸ ë‘ë ¤ì›€ê³¼ ë§ˆì£¼í•  ì¤€ë¹„ê°€ ëœ ê±°ì˜€ì–´ìš”.\në‹¹ì‹ ì€ ìš©ê°í–ˆì–´ìš”.",
                            anger: "ë¶„ë…¸ë¥¼ ì†ìœ¼ë¡œ ì‚­ì˜€ë˜ ê·¸ë•Œ,\në‹¹ì‹ ì€ ìì‹ ì„ ë³´í˜¸í•˜ê³  ìˆì—ˆì–´ìš”.\nê·¸ ë¶„ë…¸ì—ë„ ì´ìœ ê°€ ìˆì—ˆì–´ìš”.",
                            apology: "í˜¼ì ì¤‘ì–¼ê±°ë¦° ì‚¬ê³¼ì˜ ë§ë“¤,\nê·¸ ì•ˆì—ëŠ” ì§„ì •í•œ ë‰˜ìš°ì¹¨ì´ ìˆì—ˆì–´ìš”.\nê·¸ ë§ˆìŒì´ ë‹¹ì‹ ì„ ì„±ì¥ì‹œì¼°ì–´ìš”.",
                            gratitude: "í˜¼ìì„œ ê³ ë§ˆì›Œí–ˆë˜ ê·¸ ìˆœê°„ë“¤,\në‹¹ì‹ ì€ ì‚¶ì˜ ì‘ì€ ê¸°ì ë“¤ì„ ì•Œì•„ë³´ëŠ” ì‚¬ëŒì´ì—ˆì–´ìš”.",
                            encouragement: "ìì‹ ì„ ê²©ë ¤í–ˆë˜ ê·¸ ë§ë“¤,\nê°€ì¥ í˜ë“  ìˆœê°„ì—ë„ í¬ê¸°í•˜ì§€ ì•Šìœ¼ë ¤ëŠ” ì˜ì§€ì˜€ì–´ìš”.",
                            despair: "ì ˆë§ì„ í† ë¡œí–ˆë˜ ê·¸ ë°¤,\nì‚¬ì‹¤ì€ ì‚´ê³  ì‹¶ì€ ë§ˆìŒì˜ ë‹¤ë¥¸ í‘œí˜„ì´ì—ˆì–´ìš”.",
                            identity: "ìì‹ ì—ê²Œ ë¬¼ì—ˆë˜ ê·¸ ì§ˆë¬¸ë“¤,\nì§„ì§œ ìì‹ ì„ ì°¾ì•„ê°€ëŠ” ì—¬ì •ì˜ ì‹œì‘ì´ì—ˆì–´ìš”.",
                            guidance: "ê¸¸ì„ ë¬»ëŠ” ê·¸ í˜¼ì£ë§ë“¤,\nì´ë¯¸ ë‹µì„ ì°¾ê³  ì‹¶ì–´ í•˜ëŠ” ë§ˆìŒì´ ìˆì—ˆê¸° ë•Œë¬¸ì´ì—ìš”.",
                            acceptance: "ë°›ì•„ë“¤ì´ë ¤ í–ˆë˜ ê·¸ ë§ë“¤,\ní‰í™”ë¥¼ í–¥í•œ ì²« ê±¸ìŒì´ì—ˆì–´ìš”.",
                            general: "ë‹¹ì‹ ì´ ìì‹ ì—ê²Œ ê±´ë„¨ ê·¸ ë§,\nì„¸ìƒì—ì„œ ê°€ì¥ ì§„ì‹¤í•œ ëŒ€í™”ì˜€ì–´ìš”."
                        },
                        en: {
                            longing: "In that earnest whisper\nwas contained your purest wish.\nThat wish is still valid now.",
                            pain: "In that moment when you swallowed pain alone,\nyou were most honest with yourself.\nThat honesty became your current strength.",
                            love: "That heart that confessed love in soliloquy,\nit was the purest love in the world.\nThat love still lives within you.",
                            fear: "The moment you spoke your fear out loud,\nyou were already ready to face that fear.\nYou were brave.",
                            anger: "When you swallowed anger inside,\nyou were protecting yourself.\nThere was a reason for that anger too.",
                            apology: "Those apologetic words you muttered alone,\nthere was genuine remorse in them.\nThat heart helped you grow.",
                            gratitude: "Those moments you gave thanks alone,\nyou were someone who could recognize life's small miracles.",
                            encouragement: "Those words you used to encourage yourself,\nit was the will to not give up even in the hardest moments.",
                            despair: "That night you expressed despair,\nit was actually another expression of wanting to live.",
                            identity: "Those questions you asked yourself,\nwere the beginning of a journey to find your true self.",
                            guidance: "Those soliloquies asking for direction,\nwere because you already had the heart wanting to find answers.",
                            acceptance: "Those words trying to accept,\nwere the first steps toward peace.",
                            general: "Those words you gave to yourself\nwere the most truthful conversation in the world."
                        },
                        pt: {
                            longing: "Naquele sussurro fervoroso\nestava contido seu desejo mais puro.\nEsse desejo ainda Ã© vÃ¡lido agora.",
                            pain: "Naquele momento quando engoliu a dor sozinho,\nvocÃª foi mais honesto consigo mesmo.\nEssa honestidade se tornou sua forÃ§a atual.",
                            love: "Aquele coraÃ§Ã£o que confessou amor em solilÃ³quio,\nfoi o amor mais puro do mundo.\nEsse amor ainda vive dentro de vocÃª.",
                            fear: "O momento em que falou seu medo em voz alta,\nvocÃª jÃ¡ estava pronto para enfrentar esse medo.\nVocÃª foi corajoso.",
                            anger: "Quando engoliu a raiva por dentro,\nvocÃª estava se protegendo.\nTambÃ©m havia uma razÃ£o para aquela raiva.",
                            apology: "Aquelas palavras de desculpa que murmurou sozinho,\nhavia remorso genuÃ­no nelas.\nEsse coraÃ§Ã£o te ajudou a crescer.",
                            gratitude: "Aqueles momentos que agradeceu sozinho,\nvocÃª era alguÃ©m que podia reconhecer os pequenos milagres da vida.",
                            encouragement: "Aquelas palavras que usou para se encorajar,\nfoi a vontade de nÃ£o desistir mesmo nos momentos mais difÃ­ceis.",
                            despair: "Aquela noite que expressou desespero,\nfoi na verdade outra expressÃ£o de querer viver.",
                            identity: "Aquelas perguntas que fez a si mesmo,\nforam o inÃ­cio de uma jornada para encontrar seu verdadeiro eu.",
                            guidance: "Aqueles solilÃ³quios pedindo direÃ§Ã£o,\nforam porque vocÃª jÃ¡ tinha o coraÃ§Ã£o querendo encontrar respostas.",
                            acceptance: "Aquelas palavras tentando aceitar,\nforam os primeiros passos em direÃ§Ã£o Ã  paz.",
                            general: "Aquelas palavras que deu a si mesmo\nforam a conversa mais verdadeira do mundo."
                        }
                    };
                    
                    return responses[lang][soliloquyType] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ğŸ§˜",
                getResponse: (userInput, lang) => {
                    const soliloquyType = analyzeSoliloquyType(userInput);
                    
                    const responses = {
                        ko: {
                            longing: "ê·¸ ê°„ì ˆí•¨ì´ í˜¼ì£ë§ë¡œ ë‚˜ì˜¨ ìˆœê°„,\nì´ë¯¸ ë‹¹ì‹ ì€ ê·¸ê²ƒì„ ì´ë£° ì¤€ë¹„ê°€ ë˜ì–´ ìˆì—ˆì–´ìš”.",
                            pain: "ê³ í†µì„ ë§ë¡œ í‘œí˜„í•œ ê·¸ ìˆœê°„,\nì¹˜ìœ ê°€ ì‹œì‘ë˜ì—ˆì–´ìš”.\në§ì€ ê³ í†µì„ ë³€í™”ì‹œí‚¤ëŠ” ì²« ë‹¨ê³„ì˜ˆìš”.",
                            love: "ì‚¬ë‘ì˜ ê³ ë°±ì„ í˜¼ì ì—°ìŠµí–ˆë˜ ê·¸ ì‹œê°„ë“¤,\nì‚¬ë‘í•˜ëŠ” ë²•ì„ ë°°ìš°ëŠ” ê³¼ì •ì´ì—ˆì–´ìš”.",
                            fear: "ë‘ë ¤ì›€ì„ ì¸ì •í•œ ê·¸ ìˆœê°„,\nìš©ê¸°ì˜ ë¬¸ì´ ì—´ë ¸ì–´ìš”.\nìš©ê¸°ëŠ” ë‘ë ¤ì›€ ì—†ìŒì´ ì•„ë‹ˆë¼ ì¸ì •í•¨ì—ì„œ ì‹œì‘ë¼ìš”.",
                            anger: "ë¶„ë…¸ë¥¼ ì‚­ì´ë©° í–ˆë˜ ê·¸ ë§ë“¤,\nìì‹ ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ì§€í˜œì˜ ì—°ìŠµì´ì—ˆì–´ìš”.",
                            apology: "í˜¼ìì„œ í•œ ì‚¬ê³¼ì˜ ë§ë“¤,\nì§„ì •í•œ ìš©ì„œëŠ” ìê¸° ìì‹ ë¶€í„° ì‹œì‘ëœë‹¤ëŠ” ê±¸ ì•Œê³  ìˆì—ˆì–´ìš”.",
                            gratitude: "ê°ì‚¬ë¥¼ í˜¼ì£ë§ë¡œ í‘œí˜„í–ˆë˜ ìˆœê°„ë“¤,\në‹¹ì‹ ì€ ì´ë¯¸ í’ìš”ë¡œìš´ ë§ˆìŒì„ ê°€ì§„ ì‚¬ëŒì´ì—ˆì–´ìš”.",
                            encouragement: "ìì‹ ì„ ê²©ë ¤í–ˆë˜ ê·¸ ë§ë“¤,\nê°€ì¥ ì¢‹ì€ ìŠ¤ìŠ¹ì€ ìê¸° ìì‹ ì´ë¼ëŠ” ê±¸ ì•Œê³  ìˆì—ˆì–´ìš”.",
                            despair: "ì ˆë§ì„ í† ë¡œí–ˆë˜ ê·¸ ìˆœê°„ì¡°ì°¨,\nê°ì •ì„ ì–µëˆ„ë¥´ì§€ ì•Šê³  í˜ë ¤ë³´ë‚´ëŠ” ì§€í˜œì˜€ì–´ìš”.",
                            identity: "ì •ì²´ì„±ì— ëŒ€í•´ ë¬»ë˜ ê·¸ ì§ˆë¬¸ë“¤,\nì§„ì •í•œ ìì•„ë¥¼ ì°¾ëŠ” ì² í•™ìì˜ ë§ˆìŒì´ì—ˆì–´ìš”.",
                            guidance: "ê¸¸ì„ ë¬»ëŠ” í˜¼ì£ë§ë“¤,\nì´ë¯¸ ë‹µì€ ìì‹  ì•ˆì— ìˆë‹¤ëŠ” ê±¸ ì§ê°í•˜ê³  ìˆì—ˆì–´ìš”.",
                            acceptance: "ë°›ì•„ë“¤ì´ë ¤ ë…¸ë ¥í–ˆë˜ ê·¸ ë§ë“¤,\ní‰í™”ë¡œ ê°€ëŠ” ìœ ì¼í•œ ê¸¸ì„ ì•Œê³  ìˆì—ˆì–´ìš”.",
                            general: "ê·¸ í˜¼ì£ë§ì€ ë‚´ë©´ì˜ ì§€í˜œì™€ ë‚˜ëˆˆ ëŒ€í™”ì˜€ì–´ìš”.\në‹¹ì‹ ì€ ìì‹ ì˜ ê°€ì¥ ì¢‹ì€ ì¡°ì–¸ìì˜ˆìš”."
                        },
                        en: {
                            longing: "The moment that earnestness came out as soliloquy,\nyou were already ready to achieve it.",
                            pain: "The moment you expressed pain in words,\nhealing began.\nWords are the first step in transforming pain.",
                            love: "Those times you practiced confessions of love alone,\nwere the process of learning how to love.",
                            fear: "The moment you acknowledged fear,\nthe door to courage opened.\nCourage doesn't start from fearlessness but from acknowledgment.",
                            anger: "Those words you spoke while swallowing anger,\nwere practice in the wisdom of self-control.",
                            apology: "Those apologetic words you said alone,\nyou knew that true forgiveness starts with oneself.",
                            gratitude: "Those moments you expressed gratitude in soliloquy,\nyou were already someone with an abundant heart.",
                            encouragement: "Those words you used to encourage yourself,\nyou knew that the best teacher is oneself.",
                            despair: "Even that moment you expressed despair,\nwas the wisdom of letting emotions flow without suppressing them.",
                            identity: "Those questions you asked about identity,\nwere the heart of a philosopher seeking true self.",
                            guidance: "Those soliloquies asking for direction,\nyou were already intuiting that the answer was within yourself.",
                            acceptance: "Those words trying to accept,\nyou knew the only path to peace.",
                            general: "That soliloquy was a conversation with inner wisdom.\nYou are your own best advisor."
                        },
                        pt: {
                            longing: "O momento em que essa fervorosidade saiu como solilÃ³quio,\nvocÃª jÃ¡ estava pronto para alcanÃ§Ã¡-la.",
                            pain: "O momento em que expressou dor em palavras,\na cura comeÃ§ou.\nPalavras sÃ£o o primeiro passo para transformar a dor.",
                            love: "Aqueles momentos que praticou confissÃµes de amor sozinho,\nforam o processo de aprender como amar.",
                            fear: "O momento em que reconheceu o medo,\na porta da coragem se abriu.\nCoragem nÃ£o comeÃ§a da ausÃªncia de medo, mas do reconhecimento.",
                            anger: "Aquelas palavras que falou enquanto engolia raiva,\nforam prÃ¡tica na sabedoria do autocontrole.",
                            apology: "Aquelas palavras de desculpa que disse sozinho,\nvocÃª sabia que o verdadeiro perdÃ£o comeÃ§a consigo mesmo.",
                            gratitude: "Aqueles momentos que expressou gratidÃ£o em solilÃ³quio,\nvocÃª jÃ¡ era alguÃ©m com um coraÃ§Ã£o abundante.",
                            encouragement: "Aquelas palavras que usou para se encorajar,\nvocÃª sabia que o melhor professor Ã© a prÃ³pria pessoa.",
                            despair: "Mesmo aquele momento que expressou desespero,\nfoi a sabedoria de deixar as emoÃ§Ãµes fluÃ­rem sem suprimi-las.",
                            identity: "Aquelas perguntas que fez sobre identidade,\nforam o coraÃ§Ã£o de um filÃ³sofo buscando o verdadeiro eu.",
                            guidance: "Aqueles solilÃ³quios pedindo direÃ§Ã£o,\nvocÃª jÃ¡ estava intuindo que a resposta estava dentro de si.",
                            acceptance: "Aquelas palavras tentando aceitar,\nvocÃª conhecia o Ãºnico caminho para a paz.",
                            general: "Aquele solilÃ³quio foi uma conversa com a sabedoria interior.\nVocÃª Ã© seu prÃ³prio melhor conselheiro."
                        }
                    };
                    
                    return responses[lang][soliloquyType] || responses[lang]['general'];
                }
            },
            {
                name: "Mira", emoji: "ğŸ§‘â€ğŸ¨",
                getResponse: (userInput, lang) => {
                    const soliloquyType = analyzeSoliloquyType(userInput);
                    
                    const responses = {
                        ko: {
                            longing: "ê·¸ ê°„ì ˆí•œ í˜¼ì£ë§ì€\në§ˆìŒ ì† ìº”ë²„ìŠ¤ì— ê·¸ë ¤ì§„ ì²« ë²ˆì§¸ ìŠ¤ì¼€ì¹˜ì˜€ì–´ìš”.\nì´ì œ ê·¸ ìŠ¤ì¼€ì¹˜ë¥¼ ì™„ì„±í•  ì‹œê°„ì´ì—ìš”.",
                            pain: "ê³ í†µì˜ ë§ë“¤ì€ ì–´ë‘ìš´ ìƒ‰ê°ì´ì—ˆì§€ë§Œ,\nê·¸ ìƒ‰ ì—†ì´ëŠ” ì§„ì§œ ê·¸ë¦¼ì´ ë‚˜ì˜¬ ìˆ˜ ì—†ì–´ìš”.\në‹¹ì‹ ì˜ ê·¸ë¦¼ì´ ë” ê¹Šì–´ì¡Œì–´ìš”.",
                            love: "ì‚¬ë‘ì˜ í˜¼ì£ë§ë“¤ì€\nê°€ì¥ ë”°ëœ»í•œ ìƒ‰ë“¤ì´ì—ˆì–´ìš”.\nê·¸ ìƒ‰ë“¤ì´ ë‹¹ì‹ ì˜ ë§ˆìŒì„ ë¬¼ë“¤ì˜€ì–´ìš”.",
                            fear: "ë‘ë ¤ì›€ì˜ ëª©ì†Œë¦¬ëŠ” ì–´ë‘ì› ì§€ë§Œ,\nê·¸ ì–´ë‘ ì´ ìˆì–´ì•¼ ë¹›ë„ ë” ë°ê²Œ ë³´ì—¬ìš”.\në‹¹ì‹ ì€ ëª…ì•”ì„ ë°°ì› ì–´ìš”.",
                            anger: "ë¶„ë…¸ì˜ ìƒ‰ì€ ê°•ë ¬í–ˆì§€ë§Œ,\nê·¸ ê°•ë ¬í•¨ì´ ë‹¹ì‹ ì˜ ê·¸ë¦¼ì— í˜ì„ ì£¼ì—ˆì–´ìš”.\nê°ì •ë„ ìƒ‰ê¹”ì´ì—ìš”.",
                            apology: "ì‚¬ê³¼ì˜ ë§ë“¤ì€ ë¶€ë“œëŸ¬ìš´ íŒŒìŠ¤í…” ìƒ‰ì´ì—ˆì–´ìš”.\nìƒì²˜ë¥¼ ë®ëŠ” ì˜¨í™”í•œ ìƒ‰ì¹ ì´ì—ˆì–´ìš”.",
                            gratitude: "ê°ì‚¬ì˜ í˜¼ì£ë§ë“¤ì€\ní™©ê¸ˆë¹› í•˜ì´ë¼ì´íŠ¸ ê°™ì•˜ì–´ìš”.\ní‰ë²”í•œ ì¼ìƒì„ ë¹›ë‚˜ê²Œ ë§Œë“œëŠ” ìƒ‰ì´ì—ìš”.",
                            encouragement: "ê²©ë ¤ì˜ ë§ë“¤ì€\ní¬ë§ì˜ ì´ˆë¡ìƒ‰ì´ì—ˆì–´ìš”.\nìŠ¤ìŠ¤ë¡œë¥¼ ë‹¤ì‹œ ì‚´ì•„ë‚˜ê²Œ í•˜ëŠ” ìƒ‰ì´ì—ìš”.",
                            despair: "ì ˆë§ì˜ ìƒ‰ì¡°ì°¨ë„\në‹¹ì‹  ê·¸ë¦¼ì˜ ê¹Šì´ë¥¼ ë§Œë“¤ì–´ì£¼ì—ˆì–´ìš”.\nëª¨ë“  ìƒ‰ì—ëŠ” ì˜ë¯¸ê°€ ìˆì–´ìš”.",
                            identity: "ì •ì²´ì„±ì„ ì°¾ëŠ” í˜¼ì£ë§ë“¤ì€\nìí™”ìƒì„ ê·¸ë¦¬ëŠ” ê³¼ì •ì´ì—ˆì–´ìš”.\në‹¹ì‹ ì€ ìì‹ ì„ ê·¸ë ¤ë‚´ê³  ìˆì—ˆì–´ìš”.",
                            guidance: "ê¸¸ì„ ë¬»ëŠ” ë§ë“¤ì€\nì§€ë„ë¥¼ ê·¸ë¦¬ëŠ” ê²ƒê³¼ ê°™ì•˜ì–´ìš”.\në‹¹ì‹ ì€ ìŠ¤ìŠ¤ë¡œì˜ ê¸¸ì„ ê·¸ë ¤ê°€ê³  ìˆì–´ìš”.",
                            acceptance: "ë°›ì•„ë“¤ì´ëŠ” ë§ë“¤ì€\nì™„ì„±ëœ ê·¸ë¦¼ì— ë§ˆì§€ë§‰ í„°ì¹˜ë¥¼ í•˜ëŠ” ê²ƒ ê°™ì•˜ì–´ìš”.\nì´ì œ ë‹¹ì‹ ì˜ ì‘í’ˆì´ ì™„ì„±ë˜ì–´ê°€ìš”.",
                            general: "ê·¸ í˜¼ì£ë§ë“¤ì€ ëª¨ë‘ ë‹¹ì‹ ë§Œì˜ ìƒ‰ê¹”ì´ì—ˆì–´ìš”.\nì´ì œ ê·¸ ìƒ‰ë“¤ë¡œ ì„¸ìƒì„ ì¹ í•  ìˆ˜ ìˆì–´ìš”."
                        },
                        en: {
                            longing: "That earnest soliloquy was\nthe first sketch drawn on the canvas of your heart.\nNow it's time to complete that sketch.",
                            pain: "The words of pain were dark tones,\nbut without those colors, no real painting can emerge.\nYour painting became deeper.",
                            love: "The soliloquies of love were\nthe warmest colors.\nThose colors painted your heart.",
                            fear: "The voice of fear was dark,\nbut that darkness makes light appear brighter.\nYou learned about contrast.",
                            anger: "The color of anger was intense,\nbut that intensity gave strength to your painting.\nEmotions are also colors.",
                            apology: "The words of apology were soft pastel colors.\nGentle coloring that covers wounds.",
                            gratitude: "The soliloquies of gratitude were\nlike golden highlights.\nColors that make ordinary days shine.",
                            encouragement: "The words of encouragement were\nthe green of hope.\nColors that bring yourself back to life.",
                            despair: "Even the hues of despair\ncreated depth in your painting.\nEvery color has meaning.",
                            identity: "The soliloquies seeking identity were\nthe process of drawing a self-portrait.\nYou were drawing yourself out.",
                            guidance: "The words asking for direction were\nlike drawing a map.\nYou are drawing your own path.",
                            acceptance: "The words of acceptance were\nlike adding the final touch to a completed painting.\nNow your artwork is being completed.",
                            general: "All those soliloquies were your unique colors.\nNow you can paint the world with those colors."
                        },
                        pt: {
                            longing: "Aquele solilÃ³quio fervoroso foi\no primeiro esboÃ§o desenhado na tela do seu coraÃ§Ã£o.\nAgora Ã© hora de completar esse esboÃ§o.",
                            pain: "As palavras de dor eram tons escuros,\nmas sem essas cores, nenhuma pintura real pode emergir.\nSua pintura se tornou mais profunda.",
                            love: "Os solilÃ³quios de amor eram\nas cores mais quentes.\nEssas cores pintaram seu coraÃ§Ã£o.",
                            fear: "A voz do medo era escura,\nmas essa escuridÃ£o faz a luz parecer mais brilhante.\nVocÃª aprendeu sobre contraste.",
                            anger: "A cor da raiva era intensa,\nmas essa intensidade deu forÃ§a Ã  sua pintura.\nEmoÃ§Ãµes tambÃ©m sÃ£o cores.",
                            apology: "As palavras de desculpa eram cores pastel suaves.\nColoraÃ§Ã£o gentil que cobre feridas.",
                            gratitude: "Os solilÃ³quios de gratidÃ£o eram\ncomo destaques dourados.\nCores que fazem dias comuns brilharem.",
                            encouragement: "As palavras de encorajamento eram\no verde da esperanÃ§a.\nCores que trazem vocÃª de volta Ã  vida.",
                            despair: "Mesmo os matizes do desespero\ncriaram profundidade em sua pintura.\nToda cor tem significado.",
                            identity: "Os solilÃ³quios buscando identidade eram\no processo de desenhar um autorretrato.\nVocÃª estava se desenhando.",
                            guidance: "As palavras pedindo direÃ§Ã£o eram\ncomo desenhar um mapa.\nVocÃª estÃ¡ desenhando seu prÃ³prio caminho.",
                            acceptance: "As palavras de aceitaÃ§Ã£o eram\ncomo adicionar o toque final a uma pintura completa.\nAgora sua obra de arte estÃ¡ sendo completada.",
                            general: "Todos aqueles solilÃ³quios eram suas cores Ãºnicas.\nAgora vocÃª pode pintar o mundo com essas cores."
                        }
                    };
                    
                    return responses[lang][soliloquyType] || responses[lang]['general'];
                }
            }
        ];
        
        // Continue with the rest of the JavaScript functions...
        // [The rest of the JavaScript code remains the same as in previous portals]
        
        // Typewriter effect
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (state.currentTypingElement) {
                    state.currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                state.currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                state.typingIntervals.push(typingInterval);
            });
        }
        
        // Clear all typing effects
        function clearAllTypingEffects() {
            state.typingIntervals.forEach(interval => clearInterval(interval));
            state.typingIntervals = [];
            
            if (state.currentTypingElement) {
                state.currentTypingElement.classList.remove('typing-cursor');
                state.currentTypingElement = null;
            }
        }
        
        // Scroll functions
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        // Language management
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            const t = translations[lang];
            document.title = t.title;
            document.getElementById('logoSubtitle').textContent = t.logoSubtitle;
            document.getElementById('portalMainTitle').textContent = t.portalMainTitle;
            document.getElementById('portalSubtitle').textContent = t.portalSubtitle;
            document.getElementById('lightTitle').textContent = t.lightTitle;
            document.getElementById('navigationTitle').textContent = t.navigationTitle;
            document.getElementById('nextPortalBtn').textContent = t.nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = t.stayPortalBtn;
            document.getElementById('userTextarea').placeholder = t.inputPlaceholder;
        }
        
        
        // Journey management
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            state.userResponse = '';
            state.currentTypingElement = null;
            state.awaitingSecondResponse = false;
        }
        
        // Save response to database or memory
        async function saveResponse(inputText, step) {
            const responseData = {
                portal: portalConfig.currentPortal,
                resposta: inputText,
                step: step,
                data: new Date().toISOString(),
                idioma: state.currentLanguage,
                userId: state.currentUser ? state.currentUser.uid : 'anonymous',
                userEmail: state.currentUser ? state.currentUser.email : 'anonymous@temarix.com'
            };
            
            if (state.firebaseInitialized && state.db) {
                try {
                    await state.db.collection("temarix_v5_respostas").add({
                        ...responseData,
                        timestamp: firebase.firestore.Timestamp.now()
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                    state.userResponses.push(responseData);
                    showConnectionStatus(false);
                }
            } else {
                state.userResponses.push(responseData);
                console.log('Response stored in memory:', responseData);
            }
        }
        
        // User input processing
        async function processUserInput(inputText) {
            state.userResponse = inputText;
            
            await saveResponse(inputText, state.awaitingSecondResponse ? "second" : "first");
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!state.awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[state.currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        // Show character reactions
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[state.currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                state.awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, state.currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[state.currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[state.currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        // Portal sequence
        async function startPortalSequence() {
            console.log('Starting portal sequence...');
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            console.log('Showing intro...');
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            if (!introSection || !introElement) {
                console.error('Intro elements not found!');
                return;
            }
            
            introSection.classList.add('show');
            
            const introText = translations[state.currentLanguage].portalIntro;
            console.log('Intro text:', introText);
            
            await typewriterEffect(introElement, introText, 60);
            
            setTimeout(async () => {
                await showEmotionalBridge();
            }, 2000);
        }
        
        async function showEmotionalBridge() {
            const introElement = document.getElementById('portalIntro');
            const bridgeText = '\n\n' + translations[state.currentLanguage].emotionalBridge;
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const bridgeP = document.createElement('p');
            bridgeP.style.cssText = `
                margin-top: 30px;
                font-style: italic;
                color: #ff9999;
                font-size: 18px;
                line-height: 1.8;
            `;
            introElement.appendChild(bridgeP);
            
            await typewriterEffect(bridgeP, bridgeText.trim(), 50);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        // Custom confirm dialog
        function showConfirmDialog(message, callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                font-family: 'Courier New', monospace;
            `;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: #222;
                border: 2px solid #ff6b6b;
                padding: 30px;
                max-width: 400px;
                text-align: center;
                color: white;
            `;
            
            const messageP = document.createElement('p');
            messageP.textContent = message;
            messageP.style.cssText = `
                margin-bottom: 20px;
                line-height: 1.6;
                font-size: 16px;
            `;
            
            const buttonContainer = document.createElement('div');
            buttonContainer.style.cssText = `
                display: flex;
                gap: 15px;
                justify-content: center;
            `;
            
            const yesBtn = document.createElement('button');
            const noBtn = document.createElement('button');
            
            const buttonStyle = `
                background: #444;
                color: white;
                border: 1px solid #ff6b6b;
                padding: 10px 20px;
                cursor: pointer;
                font-family: 'Courier New', monospace;
                font-size: 14px;
            `;
            
            yesBtn.style.cssText = buttonStyle + 'background: #ff6b6b;';
            noBtn.style.cssText = buttonStyle;
            
            yesBtn.textContent = state.currentLanguage === 'ko' ? 'ì˜ˆ' : 
                                state.currentLanguage === 'pt' ? 'Sim' : 'Yes';
            noBtn.textContent = state.currentLanguage === 'ko' ? 'ì•„ë‹ˆì˜¤' : 
                               state.currentLanguage === 'pt' ? 'NÃ£o' : 'No';
            
            yesBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(true);
            };
            
            noBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(false);
            };
            
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                    callback(false);
                }
            };
            
            buttonContainer.appendChild(yesBtn);
            buttonContainer.appendChild(noBtn);
            modal.appendChild(messageP);
            modal.appendChild(buttonContainer);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            yesBtn.focus();
        }
        
        // Event setup
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function createPortalTransition(callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, #000 0%, #111 50%, #000 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 20000;
                opacity: 0;
                transition: opacity 1s ease-in-out;
                font-family: 'Courier New', monospace;
            `;
            
            const message = document.createElement('div');
            message.style.cssText = `
                color: #ff6b6b;
                font-size: 24px;
                text-align: center;
                margin-bottom: 30px;
                opacity: 0;
                transform: translateY(20px);
                transition: all 0.8s ease-out;
            `;
            message.textContent = translations[state.currentLanguage].transitionMessage;
            
            const loader = document.createElement('div');
            loader.style.cssText = `
                width: 60px;
                height: 60px;
                border: 3px solid #333;
                border-top: 3px solid #ff6b6b;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                opacity: 0;
                transition: opacity 0.8s ease-out 0.3s;
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            overlay.appendChild(message);
            overlay.appendChild(loader);
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                overlay.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                message.style.opacity = '1';
                message.style.transform = 'translateY(0)';
                loader.style.opacity = '1';
            }, 300);
            
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(overlay);
                    document.head.removeChild(style);
                    callback();
                }, 1000);
            }, 2500);
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmNextPortal, (confirmed) => {
                    if (confirmed) {
                        if (state.firebaseInitialized && state.db) {
                            state.db.collection("temarix_v5_progress").add({
                                userId: state.currentUser.uid,
                                portal: portalConfig.currentPortal,
                                status: "complete",
                                timestamp: firebase.firestore.Timestamp.now()
                            }).catch(error => console.error('Error saving progress:', error));
                        }
                        
                        createPortalTransition(() => {
                            window.location.href = `${portalConfig.nextPortalFile}?lang=${state.currentLanguage}`;
                        });
                    }
                });
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmStay, (confirmed) => {
                    if (confirmed) {
                        resetJourney();
                        setTimeout(() => {
                            startPortalSequence();
                        }, 1000);
                    }
                });
            });
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        function initializeTemarix() {
            console.log('Initializing Temarix V5 Portal 10...');
            console.log('Current state:', state);
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            state.journeyStarted = true;
            console.log('Journey started:', state.journeyStarted);
            
            console.log('Starting portal sequence in 1 second...');
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Temarix V5 Portal 10 DOM loaded');
            
            state.currentLanguage = getLanguageFromURL();
            
            updateStaticTranslations(state.currentLanguage);
            updateLanguageButtons(state.currentLanguage);
            
            await initializeFirebase();
            
            initializeTemarix();
        });
    </script>
</body>
</html>