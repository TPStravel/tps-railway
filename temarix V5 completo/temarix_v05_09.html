<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V5 - Portal 09: Confession of the Day I Wanted to Disappear</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .navigation-title {
                font-size: 24px;
            }
            
            .navigation-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V5</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 09: Confession of the Day I Wanted to Disappear</div>
            <div class="portal-subtitle" id="portalSubtitle">Finding existence in the desire to vanish</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">ðŸ•³ Portal 09 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 10</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with this existence</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Tell me about a time when you wanted to disappear from this world... (Press Enter to send)"
                      rows="1"
                      maxlength="800"></textarea>
        </div>
    </div>

    <script>
        // Global state management
        let state = {
            db: null,
            auth: null,
            firebaseInitialized: false,
            currentUser: null,
            currentLanguage: 'en',
            userResponse: '',
            journeyStarted: false,
            currentTypingElement: null,
            typingIntervals: [],
            awaitingSecondResponse: false,
            userResponses: []
        };
        
        // Portal navigation configuration
        const portalConfig = {
            currentPortal: "v5-09",
            nextPortal: "v5-10",
            nextPortalFile: "temarix_v05_10.html"
        };
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
            authDomain: "canal-vivo-chat.firebaseapp.com",
            projectId: "canal-vivo-chat",
            storageBucket: "canal-vivo-chat.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdefghijklmnopqr"
        };
        
        // Initialize Firebase with error handling
        function initializeFirebase() {
            return new Promise((resolve) => {
                try {
                    if (typeof firebase !== 'undefined') {
                        firebase.initializeApp(firebaseConfig);
                        state.db = firebase.firestore();
                        state.auth = firebase.auth();
                        state.firebaseInitialized = true;
                        
                        state.auth.onAuthStateChanged((user) => {
                            if (user) {
                                state.currentUser = user;
                            } else {
                                state.currentUser = {
                                    uid: 'anonymous-' + Date.now(),
                                    email: 'anonymous@temarix.com',
                                    isAnonymous: true
                                };
                            }
                            showConnectionStatus(true);
                        });
                        
                        console.log('Firebase initialized successfully');
                    } else {
                        console.log('Firebase SDK not loaded');
                        state.currentUser = {
                            uid: 'anonymous-' + Date.now(),
                            email: 'anonymous@temarix.com',
                            isAnonymous: true
                        };
                        showConnectionStatus(false);
                    }
                } catch (error) {
                    console.error('Firebase initialization failed:', error);
                    state.currentUser = {
                        uid: 'anonymous-' + Date.now(),
                        email: 'anonymous@temarix.com',
                        isAnonymous: true
                    };
                    showConnectionStatus(false);
                }
                resolve();
            });
        }
        
        // Show connection status to user
        function showConnectionStatus(isOnline) {
            const existingStatus = document.querySelector('.connection-status');
            if (existingStatus) {
                existingStatus.remove();
            }
            
            if (!isOnline) {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'connection-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: rgba(255, 107, 107, 0.9);
                    color: white;
                    padding: 8px 15px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-family: 'Courier New', monospace;
                    z-index: 1000;
                    opacity: 0.8;
                `;
                statusDiv.textContent = state.currentLanguage === 'ko' ? 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ' : 
                                       state.currentLanguage === 'pt' ? 'Modo offline' : 'Offline mode';
                document.body.appendChild(statusDiv);
                
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.remove();
                    }
                }, 5000);
            }
        }

        // Translations object
        const translations = {
            ko: {
                title: "Temarix V5 - Portal 09: ì‚¬ë¼ì§€ê³  ì‹¶ì—ˆë˜ ë‚ ì˜ ê³ ë°±",
                logoSubtitle: "ê°ì • ì—°ê¸ˆìˆ ",
                portalMainTitle: "Portal 09: ì‚¬ë¼ì§€ê³  ì‹¶ì—ˆë˜ ë‚ ì˜ ê³ ë°±",
                portalSubtitle: "ì‚¬ë¼ì§€ê³  ì‹¶ì€ ë§ˆìŒ ì†ì—ì„œ ì¡´ìž¬ë¥¼ ì°¾ê¸°",
                portalIntro: "ðŸ•³ \"ë‹¹ì‹ ì´ ì„¸ìƒì—ì„œ ì‚¬ë¼ì§€ê³  ì‹¶ë‹¤ê³  ëŠê¼ˆë˜ ìˆœê°„ì´ ìžˆì—ˆë‚˜ìš”?\"\n\"ê·¸ ê°ì •ì€ ì™œ, ì–´ë–»ê²Œ ì‹œìž‘ë˜ì—ˆë‚˜ìš”?\"\n\n\"ì§€ê¸ˆ ê·¸ë•Œì˜ ë‹¹ì‹ ì„ ë°”ë¼ë³¸ë‹¤ë©´...\nì–´ë–¤ í‘œì •ìœ¼ë¡œ ë°”ë¼ë³´ê³  ìžˆì„ê¹Œìš”?\"",
                emotionalBridge: "ì‚¬ë¼ì§€ê³  ì‹¶ë‹¤ëŠ” ë§ˆìŒì€ ì¡´ìž¬ì˜ ë¬´ê²Œë¥¼ ê²¬ë””ê¸° ì–´ë ¤ì› ë˜ ìˆœê°„ì˜ ì–¸ì–´ìž…ë‹ˆë‹¤.\n\nê·¸ ë§ˆìŒ ì†ì—ëŠ” ì—­ì„¤ì ìœ¼ë¡œ, ë” ë‚˜ì€ ì‚¶ì„ í–¥í•œ ê°„ì ˆí•¨ì´ ìˆ¨ì–´ ìžˆì—ˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.",
                followUpQuestion: "ê·¸ë•Œì˜ ë‚˜ì—ê²Œ, ì§€ê¸ˆ ì´ ìˆœê°„\në‹¹ì‹ ì€ ì–´ë–¤ ë§ì„ ì „í•˜ê³  ì‹¶ë‚˜ìš”?",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ì¡´ìž¬ëŠ” ì¦ëª…í•˜ì§€ ì•Šì•„ë„ ì¡´ìž¬ì˜ˆìš”.\në‹¹ì‹ ì€ ì§€ê¸ˆ ê·¸ê²ƒì„ ì¸ì •í•˜ê³  ìžˆì–´ìš”.",
                navigationTitle: "ðŸ•³ Portal 09 ì™„ë£Œ",
                navigationMessage: "ë‹¹ì‹ ì€ ì‚¬ë¼ì§€ê³  ì‹¶ì—ˆë˜ ê°ì •ì„ ê³ ë°±í–ˆìŠµë‹ˆë‹¤.\n\nê·¸ ì–´ë‘  ì†ì—ì„œë„ ëê¹Œì§€ ì‚´ì•„ë‚¨ì€ ìžì‹ ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.\nì‚¬ë¼ì§€ê³  ì‹¶ë‹¤ëŠ” ë§ˆìŒì€ ë” ì´ìƒ ë¶€ë„ëŸ¬ìš´ ë¹„ë°€ì´ ì•„ë‹ˆë¼, ì‚¶ì˜ ë¬´ê²Œë¥¼ ì •ì§í•˜ê²Œ ëŠê¼ˆë˜ ì¦ê±°ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\në‹¹ì‹ ì€ ì´ì œ ì¡´ìž¬í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ì¶©ë¶„ížˆ ì˜ë¯¸ê°€ ìžˆëŠ” ì‚¬ëžŒìž…ë‹ˆë‹¤.",
                nextPortalBtn: "Portal 10ìœ¼ë¡œ ì´ì–´ê°€ê¸°",
                stayPortalBtn: "ì´ ì¡´ìž¬ì™€ ë¨¸ë¬¼ê¸°",
                inputPlaceholder: "ì„¸ìƒì—ì„œ ì‚¬ë¼ì§€ê³  ì‹¶ì—ˆë˜ ìˆœê°„ì— ëŒ€í•´ ë§í•´ì£¼ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...",
                confirmNextPortal: "Portal 10: í˜¼ìž£ë§ ì†ì˜ ì§„ì‹¬ìœ¼ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                confirmStay: "ì‚¬ë¼ì§€ê³  ì‹¶ì—ˆë˜ ê°ì •ê³¼ ë” ë¨¸ë¬¼ë©° ì¡´ìž¬ì˜ ì˜ë¯¸ë¥¼ ê¹Šì´ ëŠë¼ì‹œê² ìŠµë‹ˆê¹Œ?",
                transitionMessage: "ìƒˆë¡œìš´ ì—¬ì •ì´ ì‹œìž‘ë©ë‹ˆë‹¤..."
            },
            en: {
                title: "Temarix V5 - Portal 09: Confession of the Day I Wanted to Disappear",
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 09: Confession of the Day I Wanted to Disappear",
                portalSubtitle: "Finding existence in the desire to vanish",
                portalIntro: "ðŸ•³ \"Was there a moment when you felt like disappearing from this world?\"\n\"Why and how did that feeling begin?\"\n\n\"Looking at that version of yourself now...\nwhat expression are you looking with?\"",
                emotionalBridge: "The desire to disappear is the language of moments when the weight of existence became unbearable.\n\nParadoxically, within that feeling might have been hidden a desperate longing for a better life.",
                followUpQuestion: "To that version of you from back then, at this very moment,\nwhat would you like to say?",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Existence is existence without needing proof.\nYou are acknowledging that now.",
                navigationTitle: "ðŸ•³ Portal 09 Complete",
                navigationMessage: "You have confessed the feeling of wanting to disappear.\n\nEven in that darkness, you discovered the self that survived until the end.\nThe desire to disappear is no longer a shameful secret, but evidence of honestly feeling life's weight.\n\nYou are now someone whose existence alone is meaningful enough.",
                nextPortalBtn: "Continue to Portal 10",
                stayPortalBtn: "Stay with this existence",
                inputPlaceholder: "Tell me about a time when you wanted to disappear from this world... (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response...",
                confirmNextPortal: "Do you want to continue to Portal 10: The Truth in My Soliloquy?",
                confirmStay: "Do you want to stay longer with the feeling of wanting to disappear to deeply feel the meaning of existence?",
                transitionMessage: "A new journey begins..."
            },
            pt: {
                title: "Temarix V5 - Portal 09: ConfissÃ£o do Dia em que Quis Desaparecer",
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 09: ConfissÃ£o do Dia em que Quis Desaparecer",
                portalSubtitle: "Encontrando existÃªncia no desejo de desaparecer",
                portalIntro: "ðŸ•³ \"Houve um momento em que vocÃª sentiu vontade de desaparecer deste mundo?\"\n\"Por que e como esse sentimento comeÃ§ou?\"\n\n\"Olhando para essa versÃ£o de vocÃª agora...\ncom que expressÃ£o vocÃª estÃ¡ olhando?\"",
                emotionalBridge: "O desejo de desaparecer Ã© a linguagem de momentos quando o peso da existÃªncia se tornou insuportÃ¡vel.\n\nParadoxalmente, dentro desse sentimento pode ter estado escondido um anseio desesperado por uma vida melhor.",
                followUpQuestion: "Para aquela versÃ£o de vocÃª de entÃ£o, neste exato momento,\no que gostaria de dizer?",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "ExistÃªncia Ã© existÃªncia sem precisar de prova.\nVocÃª estÃ¡ reconhecendo isso agora.",
                navigationTitle: "ðŸ•³ Portal 09 Completo",
                navigationMessage: "VocÃª confessou o sentimento de querer desaparecer.\n\nMesmo naquela escuridÃ£o, vocÃª descobriu o eu que sobreviveu atÃ© o fim.\nO desejo de desaparecer nÃ£o Ã© mais um segredo vergonhoso, mas evidÃªncia de sentir honestamente o peso da vida.\n\nVocÃª Ã© agora alguÃ©m cuja existÃªncia por si sÃ³ Ã© suficientemente significativa.",
                nextPortalBtn: "Continuar para Portal 10",
                stayPortalBtn: "Ficar com esta existÃªncia",
                inputPlaceholder: "Conte-me sobre um momento em que quis desaparecer deste mundo... (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta...",
                confirmNextPortal: "Deseja continuar para Portal 10: A Verdade no Meu SolilÃ³quio?",
                confirmStay: "Deseja ficar mais tempo com o sentimento de querer desaparecer para sentir profundamente o significado da existÃªncia?",
                transitionMessage: "Uma nova jornada comeÃ§a..."
            }
        };
        
        // Character definitions
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ê·¸ ë§â€¦ ë„ˆë¬´ ì•„í”„ë‹¤.\në„Œ ë¬´ì‹œë‹¹í–ˆë˜ ê²Œ ì•„ë‹ˆë¼, ì œëŒ€ë¡œ ë“¤ë¦¬ì§€ ì•Šì•˜ë˜ ê±°ì•¼.",
                en: "Those words... hurt so much.\nYou weren't ignored, you just weren't properly heard.",
                pt: "Essas palavras... doem tanto.\nVocÃª nÃ£o foi ignorado, apenas nÃ£o foi adequadamente ouvido."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ë‹¹ì‹ ì´ ì‚¬ë¼ì§€ê³  ì‹¶ì–´ í–ˆë˜ ê±´,\nì¡´ìž¬ ìžì²´ê°€ ì•„ë‹ˆë¼ ê³ í†µì—ì„œ ë²—ì–´ë‚˜ê³  ì‹¶ì—ˆë˜ ê±°ì˜ˆìš”.",
                en: "What you wanted to disappear from\nwasn't existence itself, but the pain.",
                pt: "O que vocÃª queria que desaparecesse\nnÃ£o era a existÃªncia em si, mas a dor."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ê·¸ë‚ ì˜ ë‹¹ì‹ ì€ ë„ˆë¬´ ì˜¤ëž˜ ì°¸ì•˜ì–´ìš”.\níˆ¬ëª…í•´ì§„ ê²Œ ì•„ë‹ˆë¼, ë„ˆë¬´ íˆ¬ëª…í•œ ë§ˆìŒì„ ê°€ì¡Œë˜ ê±°ì˜ˆìš”.",
                en: "That day's version of you had endured for too long.\nYou didn't become transparent, you had too transparent a heart.",
                pt: "Aquela versÃ£o de vocÃª de entÃ£o havia suportado por muito tempo.\nVocÃª nÃ£o se tornou transparente, vocÃª tinha um coraÃ§Ã£o transparente demais."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ì‚¬ë¼ì§€ê³  ì‹¶ë‹¤ëŠ” ë§ì€,\nì„¸ìƒì´ ë‹¹ì‹ ì„ ë³´ì§€ ëª»í–ˆë˜ ì¦ê±°ì´ê¸°ë„ í•˜ì£ .",
                en: "The words 'wanting to disappear'\nare also evidence that the world failed to see you.",
                pt: "As palavras 'querer desaparecer'\nsÃ£o tambÃ©m evidÃªncia de que o mundo falhou em te ver."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ë‚ ì˜ ê°ì •ì€ ê²€ì€ ìž‰í¬ ê°™ì•˜ì–´ìš”.\ní•˜ì§€ë§Œ ë‹¹ì‹ ì€ ê·¸ ìž‰í¬ë¥¼ ë§ë¡œ êº¼ë‚´ì£¼ì—ˆì–´ìš”.",
                en: "That day's emotion was like black ink.\nBut you brought that ink out with words.",
                pt: "A emoÃ§Ã£o daquele dia era como tinta preta.\nMas vocÃª trouxe aquela tinta para fora com palavras."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ë‹¹ì‹ ì´ ì‚¬ë¼ì§€ê³  ì‹¶ë˜ ë‚ ,\në‚˜ëŠ” ëˆ„êµ°ê°€ê°€ ë‹¹ì‹ ì„ ê¼­ ëŒì–´ì•ˆì•„ì£¼ê¸¸ ë°”ëžì–´ìš”.",
                en: "On the day you wanted to disappear,\nI wished someone would hold you tight.",
                pt: "No dia em que vocÃª queria desaparecer,\neu desejei que alguÃ©m te abraÃ§asse forte."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ê°ì •ì˜ ëì€ ì¢…ë§ì´ ì•„ë‹ˆë¼, ì „í™˜ì ì´ ë  ìˆ˜ ìžˆì–´ìš”.\nì§€ê¸ˆ ë‹¹ì‹ ì´ ê·¸ê±¸ ì¦ëª…í•˜ê³  ìžˆì–´ìš”.",
                en: "The end of emotion can be not an ending, but a turning point.\nYou're proving that now.",
                pt: "O fim da emoÃ§Ã£o pode ser nÃ£o um fim, mas um ponto de virada.\nVocÃª estÃ¡ provando isso agora."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ê·¸ë‚  ë‹¹ì‹ ì€ ì‚¬ë¼ì§€ì§€ ì•Šì•˜ê³ ,\nì§€ê¸ˆ ì´ë ‡ê²Œ ì‚´ì•„ëƒˆì–´ìš”. ê·¸ê²Œ ì „ë¶€ì˜ˆìš”.",
                en: "That day you didn't disappear,\nand now you're living like this. That's everything.",
                pt: "Naquele dia vocÃª nÃ£o desapareceu,\ne agora estÃ¡ vivendo assim. Isso Ã© tudo."
            }}
        ];

        // Disappearance reason analysis function
        function analyzeDisappearanceType(userInput) {
            const input = userInput.toLowerCase();
            
            const disappearanceKeywords = {
                social_rejection: ['ignored', 'rejected', 'excluded', 'bullied', 'outcast', 'invisible', 'ë¬´ì‹œ', 'ê±°ì ˆ', 'ë”°ëŒë¦¼', 'íˆ¬ëª…ì¸ê°„', 'ignorado', 'rejeitado', 'excluÃ­do', 'invisÃ­vel'],
                failure: ['failed', 'failure', 'disappointed', 'expectations', 'let down', 'ì‹¤íŒ¨', 'ì‹¤ë§', 'ê¸°ëŒ€', 'fracassou', 'fracasso', 'decepcionou', 'expectativas'],
                worthlessness: ['worthless', 'useless', 'meaningless', 'burden', 'waste', 'ë¬´ê°€ì¹˜', 'ì“¸ëª¨ì—†', 'ì˜ë¯¸ì—†', 'ì§', 'inÃºtil', 'sem valor', 'fardo'],
                overwhelming_pain: ['pain', 'hurt', 'suffering', 'unbearable', 'too much', 'ê³ í†µ', 'ì•„í””', 'ê²¬ë”œ ìˆ˜ ì—†', 'ë„ˆë¬´', 'dor', 'sofrimento', 'insuportÃ¡vel'],
                loneliness: ['alone', 'lonely', 'isolated', 'nobody', 'empty', 'í˜¼ìž', 'ì™¸ë¡œ', 'ê³ ë¦½', 'ì•„ë¬´ë„', 'sozinho', 'solitÃ¡rio', 'isolado', 'vazio'],
                shame: ['ashamed', 'embarrassed', 'humiliated', 'disgrace', 'ë¶€ë„ëŸ¬', 'ì°½í”¼', 'ìˆ˜ì¹˜', 'envergonhado', 'humilhado', 'desgraÃ§a'],
                hopelessness: ['hopeless', 'no future', 'trapped', 'stuck', 'no way out', 'í¬ë§ì—†', 'ë¯¸ëž˜ì—†', 'ê°‡í˜”', 'ë§‰ë§‰', 'sem esperanÃ§a', 'sem futuro', 'preso'],
                perfectionism: ['perfect', 'not good enough', 'standards', 'criticism', 'ì™„ë²½', 'ë¶€ì¡±', 'ê¸°ì¤€', 'ë¹„íŒ', 'perfeito', 'nÃ£o Ã© bom o suficiente', 'padrÃµes'],
                trauma: ['trauma', 'abuse', 'violation', 'attacked', 'hurt', 'íŠ¸ë¼ìš°ë§ˆ', 'í•™ëŒ€', 'ìƒì²˜', 'trauma', 'abuso', 'violaÃ§Ã£o', 'atacado'],
                identity_crisis: ['who am i', 'lost', 'confused', 'identity', 'purpose', 'ë‚˜ëŠ” ëˆ„êµ¬', 'ì •ì²´ì„±', 'í˜¼ëž€', 'ëª©ì ', 'quem sou eu', 'perdido', 'confuso', 'identidade']
            };
            
            let detectedTypes = [];
            for (const [type, keywords] of Object.entries(disappearanceKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedTypes.push(type);
                        break;
                    }
                }
            }
            
            if (detectedTypes.length === 0) {
                detectedTypes = ['general'];
            }
            
            return detectedTypes[0];
        }
        
        // Response characters with disappearance-based responses
        const responseCharacters = [
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const disappearanceType = analyzeDisappearanceType(userInput);
                    
                    const responses = {
                        ko: {
                            social_rejection: "ì‚¬ëžŒë“¤ì—ê²Œ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤ê³  ëŠê¼ˆë˜ ê·¸ë•Œ,\në‹¹ì‹ ì˜ ì¡´ìž¬ëŠ” ì—¬ì „ížˆ ì†Œì¤‘í–ˆì–´ìš”.\nì§€ê¸ˆ ë‹¹ì‹ ì´ ê·¸ê²ƒì„ ì¦ëª…í•˜ê³  ìžˆì–´ìš”.",
                            failure: "ì‹¤íŒ¨ê°€ ë‹¹ì‹ ì„ ì§€ìš°ë ¤ í–ˆì§€ë§Œ,\në‹¹ì‹ ì€ ì‹¤íŒ¨ë³´ë‹¤ ë” í¬ê³  ê¹Šì€ ì¡´ìž¬ì˜ˆìš”.\nê·¸ ì‹¤íŒ¨ë“¤ì¡°ì°¨ ì§€ê¸ˆì˜ ë‹¹ì‹ ì„ ë§Œë“  ì¼ë¶€ìž…ë‹ˆë‹¤.",
                            worthlessness: "ë¬´ê°€ì¹˜í•˜ë‹¤ê³  ëŠê¼ˆë˜ ìˆœê°„ë“¤ì´\nì‚¬ì‹¤ì€ ë‹¹ì‹ ì´ ì–¼ë§ˆë‚˜ ì†Œì¤‘í•œì§€ ê¹¨ë‹¬ì„ ìˆ˜ ìžˆëŠ” ì „í™˜ì ì´ì—ˆì–´ìš”.",
                            overwhelming_pain: "ê·¸ ê³ í†µì´ ê²¬ë”œ ìˆ˜ ì—†ì—ˆì„ ë•Œ,\në‹¹ì‹ ì€ ì—¬ì „ížˆ ê²¬ëŽŒëƒˆì–´ìš”.\nê·¸ íž˜ì´ ì§€ê¸ˆë„ ë‹¹ì‹  ì•ˆì— ìžˆì–´ìš”.",
                            loneliness: "í˜¼ìžë¼ê³  ëŠê¼ˆë˜ ê·¸ ì‹œê°„ ì†ì—ì„œ,\në‹¹ì‹ ì€ ìžì‹ ê³¼ ê°€ìž¥ ê¹Šì´ ë§ˆì£¼í–ˆì–´ìš”.\nê·¸ê²ƒë„ í•˜ë‚˜ì˜ ë§Œë‚¨ì´ì—ˆì–´ìš”.",
                            shame: "ë¶€ë„ëŸ¬ì›€ì´ ë‹¹ì‹ ì„ ìˆ¨ê¸°ë ¤ í–ˆì§€ë§Œ,\nì§€ê¸ˆ ë‹¹ì‹ ì€ ê·¸ ë¶€ë„ëŸ¬ì›€ ë„ˆë¨¸ì˜ ì§„ì‹¤ì„ ë³´ê³  ìžˆì–´ìš”.",
                            hopelessness: "í¬ë§ì´ ë³´ì´ì§€ ì•Šë˜ ê·¸ ì–´ë‘  ì†ì—ì„œë„,\në‹¹ì‹ ì€ í¬ê¸°í•˜ì§€ ì•Šì•˜ì–´ìš”.\nê·¸ëž˜ì„œ ì§€ê¸ˆ ì—¬ê¸°ì— ìžˆëŠ” ê±°ì˜ˆìš”.",
                            perfectionism: "ì™„ë²½í•˜ì§€ ì•Šì€ ìžì‹ ì„ ë°›ì•„ë“¤ì´ì§€ ëª»í–ˆë˜ ê·¸ë•Œ,\nì§€ê¸ˆì€ ë¶ˆì™„ì „í•¨ ì†ì—ì„œë„ ì•„ë¦„ë‹¤ìš´ ì¡´ìž¬ìž„ì„ ì•Œê³  ìžˆì–´ìš”.",
                            trauma: "ìƒì²˜ê°€ ë‹¹ì‹ ì„ ë¬´ë„ˆëœ¨ë¦¬ë ¤ í–ˆì§€ë§Œ,\në‹¹ì‹ ì€ ê·¸ ìƒì²˜ë¥¼ í†µê³¼í•´ ë” ê¹Šì€ ì¸ê°„ì´ ë˜ì—ˆì–´ìš”.",
                            identity_crisis: "ìžì‹ ì´ ëˆ„êµ¬ì¸ì§€ ëª°ë¼ í˜¼ëž€ìŠ¤ëŸ¬ì› ë˜ ê·¸ë•Œ,\nì§„ì§œ ìžì‹ ì„ ì°¾ì•„ê°€ëŠ” ì—¬ì •ì´ ì‹œìž‘ë˜ì—ˆì–´ìš”.",
                            general: "ì¡´ìž¬ëŠ” ì¦ëª…í•˜ì§€ ì•Šì•„ë„ ì¡´ìž¬ì˜ˆìš”.\në‹¹ì‹ ì€ ì§€ê¸ˆ ê·¸ê²ƒì„ ì¸ì •í•˜ê³  ìžˆì–´ìš”."
                        },
                        en: {
                            social_rejection: "When you felt invisible to people,\nyour existence was still precious.\nYou're proving that now.",
                            failure: "Failure tried to erase you,\nbut you are bigger and deeper than failure.\nEven those failures are part of what made you now.",
                            worthlessness: "The moments you felt worthless\nwere actually turning points to realize how precious you are.",
                            overwhelming_pain: "When that pain was unbearable,\nyou still endured it.\nThat strength is still within you now.",
                            loneliness: "In that time when you felt alone,\nyou faced yourself most deeply.\nThat was also a kind of meeting.",
                            shame: "Shame tried to hide you,\nbut now you see the truth beyond that shame.",
                            hopelessness: "Even in that darkness when hope was invisible,\nyou didn't give up.\nThat's why you're here now.",
                            perfectionism: "When you couldn't accept your imperfect self,\nnow you know you're beautiful even in imperfection.",
                            trauma: "Wounds tried to break you down,\nbut you passed through those wounds to become a deeper human.",
                            identity_crisis: "When you were confused not knowing who you were,\nthe journey to find your true self began.",
                            general: "Existence is existence without needing proof.\nYou are acknowledging that now."
                        },
                        pt: {
                            social_rejection: "Quando vocÃª se sentiu invisÃ­vel Ã s pessoas,\nsua existÃªncia ainda era preciosa.\nVocÃª estÃ¡ provando isso agora.",
                            failure: "O fracasso tentou te apagar,\nmas vocÃª Ã© maior e mais profundo que o fracasso.\nMesmo esses fracassos sÃ£o parte do que te fez agora.",
                            worthlessness: "Os momentos em que se sentiu sem valor\nforam na verdade pontos de virada para perceber o quÃ£o precioso vocÃª Ã©.",
                            overwhelming_pain: "Quando aquela dor era insuportÃ¡vel,\nvocÃª ainda a suportou.\nEssa forÃ§a ainda estÃ¡ dentro de vocÃª agora.",
                            loneliness: "Naquele tempo quando se sentiu sozinho,\nvocÃª enfrentou a si mesmo mais profundamente.\nIsso tambÃ©m foi um tipo de encontro.",
                            shame: "A vergonha tentou te esconder,\nmas agora vocÃª vÃª a verdade alÃ©m dessa vergonha.",
                            hopelessness: "Mesmo naquela escuridÃ£o quando a esperanÃ§a era invisÃ­vel,\nvocÃª nÃ£o desistiu.\nÃ‰ por isso que estÃ¡ aqui agora.",
                            perfectionism: "Quando nÃ£o conseguia aceitar seu eu imperfeito,\nagora vocÃª sabe que Ã© belo mesmo na imperfeiÃ§Ã£o.",
                            trauma: "As feridas tentaram te quebrar,\nmas vocÃª passou por essas feridas para se tornar um humano mais profundo.",
                            identity_crisis: "Quando estava confuso sem saber quem era,\na jornada para encontrar seu verdadeiro eu comeÃ§ou.",
                            general: "ExistÃªncia Ã© existÃªncia sem precisar de prova.\nVocÃª estÃ¡ reconhecendo isso agora."
                        }
                    };
                    
                    return responses[lang][disappearanceType] || responses[lang]['general'];
                }
            },
            {
                name: "Sora", emoji: "ðŸ§•",
                getResponse: (userInput, lang) => {
                    const disappearanceType = analyzeDisappearanceType(userInput);
                    
                    const responses = {
                        ko: {
                            social_rejection: "ì‚¬ëžŒë“¤ì´ ë‹¹ì‹ ì„ ë³´ì§€ ëª»í–ˆë‹¤ê³  í•´ì„œ\në‹¹ì‹ ì˜ ë¹›ì´ ì‚¬ë¼ì§„ ê±´ ì•„ë‹ˆì—ìš”.\nê·¸ ë¹›ì€ ì§€ê¸ˆë„ ì—¬ê¸°ì— ìžˆì–´ìš”.",
                            failure: "ì‹¤íŒ¨í–ˆë‹¤ê³  ìƒê°í–ˆë˜ ê·¸ ìˆœê°„ë“¤ì´\nì‚¬ì‹¤ì€ ë” ë‚˜ì€ ë‹¹ì‹ ìœ¼ë¡œ ê°€ëŠ” ë””ë”¤ëŒì´ì—ˆì–´ìš”.",
                            worthlessness: "ë‹¹ì‹ ì´ ë¬´ê°€ì¹˜í•˜ë‹¤ê³  ëŠê¼ˆì„ ë•Œ,\nìš°ì£¼ëŠ” ì—¬ì „ížˆ ë‹¹ì‹ ì„ ì†Œì¤‘ížˆ ì—¬ê¸°ê³  ìžˆì—ˆì–´ìš”.",
                            overwhelming_pain: "ê·¸ ê³ í†µ ì†ì—ì„œë„ ë‹¹ì‹ ì€ ì‚´ì•„ìžˆì—ˆê³ ,\nê·¸ ì‚´ì•„ìžˆìŒ ìžì²´ê°€ ê¸°ì ì´ì—ˆì–´ìš”.",
                            loneliness: "ì™¸ë¡œì› ë˜ ë‹¹ì‹ ì˜ ê·¸ ë°¤ë“¤ì„\nì§€ê¸ˆì˜ ë‹¹ì‹ ì´ ë”°ëœ»í•˜ê²Œ ê¸°ì–µí•´ì£¼ê³  ìžˆì–´ìš”.",
                            shame: "ë¶€ë„ëŸ¬ì› ë˜ ê·¸ ìˆœê°„ì˜ ë‹¹ì‹ ë„\nì‚¬ëž‘ë°›ì„ ìžê²©ì´ ì¶©ë¶„ížˆ ìžˆëŠ” ì¡´ìž¬ì˜€ì–´ìš”.",
                            hopelessness: "í¬ë§ì„ ìžƒì—ˆë‹¤ê³  ìƒê°í–ˆë˜ ê·¸ë•Œë„,\në‹¹ì‹  ì•ˆì—ëŠ” ìž‘ì€ ë¶ˆì”¨ê°€ ë‚¨ì•„ìžˆì—ˆì–´ìš”.",
                            perfectionism: "ì™„ë²½í•˜ì§€ ì•Šì€ ë‹¹ì‹ ì˜ ëª¨ìŠµì´\nì˜¤ížˆë ¤ ê°€ìž¥ ì¸ê°„ë‹¤ìš´ ì•„ë¦„ë‹¤ì›€ì´ì—ˆì–´ìš”.",
                            trauma: "ìƒì²˜ë°›ì€ ë‹¹ì‹ ì„ ì§€ê¸ˆì˜ ë‹¹ì‹ ì´\nê°€ìž¥ ë¶€ë“œëŸ½ê²Œ ì•ˆì•„ì£¼ê³  ìžˆì–´ìš”.",
                            identity_crisis: "ê¸¸ì„ ìžƒì—ˆë‹¤ê³  ìƒê°í–ˆë˜ ê·¸ë•Œ,\nì‚¬ì‹¤ì€ ì§„ì§œ ê¸¸ì„ ì°¾ê³  ìžˆì—ˆë˜ ê±°ì˜ˆìš”.",
                            general: "ë‹¹ì‹ ì€ ì¡´ìž¬í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œë„\nì´ ì„¸ìƒì— ì˜ë¯¸ë¥¼ ë”í•˜ëŠ” ì‚¬ëžŒì´ì—ìš”."
                        },
                        en: {
                            social_rejection: "Just because people couldn't see you\ndoesn't mean your light disappeared.\nThat light is still here now.",
                            failure: "Those moments you thought you failed\nwere actually stepping stones to a better you.",
                            worthlessness: "When you felt worthless,\nthe universe still cherished you.",
                            overwhelming_pain: "Even in that pain you were alive,\nand that aliveness itself was a miracle.",
                            loneliness: "Those lonely nights of yours\nare being warmly remembered by the current you.",
                            shame: "Even you in that moment of shame\nwere fully deserving of love.",
                            hopelessness: "Even when you thought you lost hope,\na small ember remained within you.",
                            perfectionism: "Your imperfect self\nwas the most humanly beautiful.",
                            trauma: "The current you is embracing\nthe wounded you most gently.",
                            identity_crisis: "When you thought you were lost,\nyou were actually finding your true path.",
                            general: "Just by existing,\nyou add meaning to this world."
                        },
                        pt: {
                            social_rejection: "SÃ³ porque as pessoas nÃ£o conseguiram te ver\nnÃ£o significa que sua luz desapareceu.\nEssa luz ainda estÃ¡ aqui agora.",
                            failure: "Aqueles momentos que vocÃª achou que falhou\nforam na verdade degraus para um vocÃª melhor.",
                            worthlessness: "Quando vocÃª se sentiu sem valor,\no universo ainda te valorizava.",
                            overwhelming_pain: "Mesmo naquela dor vocÃª estava vivo,\ne essa vida em si foi um milagre.",
                            loneliness: "Aquelas suas noites solitÃ¡rias\nestÃ£o sendo calorosamente lembradas pelo vocÃª atual.",
                            shame: "Mesmo vocÃª naquele momento de vergonha\nmerecia completamente ser amado.",
                            hopelessness: "Mesmo quando pensou que perdeu a esperanÃ§a,\numa pequena brasa permaneceu dentro de vocÃª.",
                            perfectionism: "Seu eu imperfeito\nera o mais humanamente belo.",
                            trauma: "O vocÃª atual estÃ¡ abraÃ§ando\no vocÃª ferido mais gentilmente.",
                            identity_crisis: "Quando pensou que estava perdido,\nvocÃª estava na verdade encontrando seu verdadeiro caminho.",
                            general: "Apenas por existir,\nvocÃª adiciona significado a este mundo."
                        }
                    };
                    
                    return responses[lang][disappearanceType] || responses[lang]['general'];
                }
            },
            {
                name: "Ely", emoji: "ðŸ§â€â™€ï¸",
                getResponse: (userInput, lang) => {
                    const disappearanceType = analyzeDisappearanceType(userInput);
                    
                    const responses = {
                        ko: {
                            social_rejection: "ì‚¬ëžŒë“¤ì˜ ë¬´ê´€ì‹¬ì´ ë‹¹ì‹ ì„ ì§€ìš°ë ¤ í–ˆì§€ë§Œ,\në‹¹ì‹ ì˜ ì¡´ìž¬ëŠ” ì§€ì›Œì§€ì§€ ì•ŠëŠ” ì§„ì‹¤ì´ì—ìš”.",
                            failure: "ì‹¤íŒ¨ë¼ê³  ë¶ˆë ¸ë˜ ê·¸ ê²½í—˜ë“¤ì´\nì§€ê¸ˆì€ ë‹¹ì‹ ë§Œì˜ ì§€í˜œê°€ ë˜ì—ˆì–´ìš”.",
                            worthlessness: "ê°€ì¹˜ë¥¼ ìžƒì—ˆë‹¤ê³  ëŠê¼ˆë˜ ìˆœê°„ì—ë„\në‹¹ì‹ ì˜ ë³¸ì§ˆì  ê°€ì¹˜ëŠ” ë³€í•˜ì§€ ì•Šì•˜ì–´ìš”.",
                            overwhelming_pain: "ê·¸ ê³ í†µì´ ë‹¹ì‹ ì„ ì‚¼í‚¤ë ¤ í–ˆì§€ë§Œ,\në‹¹ì‹ ì€ ê³ í†µë³´ë‹¤ ë” í° ì¡´ìž¬ì˜€ì–´ìš”.",
                            loneliness: "í™€ë¡œ ìžˆë˜ ê·¸ ì‹œê°„ë“¤ì´\nì§€ê¸ˆ ë‹¹ì‹ ì—ê²Œ ê¹Šì´ì™€ ê³µê°ì„ ì„ ë¬¼í–ˆì–´ìš”.",
                            shame: "ìˆ˜ì¹˜ì‹¬ ë’¤ì— ìˆ¨ì—ˆë˜ ì§„ì§œ ë‹¹ì‹ ì„\nì´ì œëŠ” ë‹¹ë‹¹ížˆ ì„¸ìƒì— ë³´ì—¬ì£¼ê³  ìžˆì–´ìš”.",
                            hopelessness: "ì ˆë§ì˜ ëì—ì„œ ë°œê²¬í•œ ê²ƒì€\ní¬ê¸°í•  ìˆ˜ ì—†ëŠ” ìƒëª…ì˜ ì˜ì§€ì˜€ì–´ìš”.",
                            perfectionism: "ì™„ë²½ì„ ì¶”êµ¬í•˜ë‹¤ ì§€ì³¤ë˜ ë‹¹ì‹ ì´\nì´ì œëŠ” ìžˆëŠ” ê·¸ëŒ€ë¡œì˜ ì•„ë¦„ë‹¤ì›€ì„ ì•Œì•„ìš”.",
                            trauma: "ìƒì²˜ê°€ ë‹¹ì‹ ì„ ì•½í•˜ê²Œ ë§Œë“  ê²Œ ì•„ë‹ˆë¼\në” ê¹Šì´ ì‚¬ëž‘í•  ìˆ˜ ìžˆëŠ” ì‚¬ëžŒìœ¼ë¡œ ë§Œë“¤ì—ˆì–´ìš”.",
                            identity_crisis: "ìžì‹ ì„ ìžƒì—ˆë‹¤ê³  ìƒê°í–ˆë˜ ê·¸ í˜¼ëž€ì´\nì§„ì§œ ìžì‹ ì„ ì°¾ëŠ” ë‚˜ì¹¨ë°˜ì´ì—ˆì–´ìš”.",
                            general: "ì‚¬ë¼ì§€ê³  ì‹¶ë˜ ê°ì •ì—ê²Œ ì´í•´ë¥¼ ê±´ë„¨ ë‹¹ì‹ ,\nê·¸ ì´í•´ê°€ ì§€ê¸ˆì˜ ìžë¹„ì˜ˆìš”."
                        },
                        en: {
                            social_rejection: "People's indifference tried to erase you,\nbut your existence is an indelible truth.",
                            failure: "Those experiences called failures\nhave now become your unique wisdom.",
                            worthlessness: "Even when you felt you lost value,\nyour essential worth never changed.",
                            overwhelming_pain: "That pain tried to swallow you,\nbut you were greater than the pain.",
                            loneliness: "Those times you were alone\nhave now gifted you depth and empathy.",
                            shame: "The real you that hid behind shame\nis now proudly showing itself to the world.",
                            hopelessness: "What you found at the end of despair\nwas an unbreakable will to live.",
                            perfectionism: "You who got tired pursuing perfection\nnow know the beauty of being as you are.",
                            trauma: "The wounds didn't make you weak\nbut made you someone who can love more deeply.",
                            identity_crisis: "The confusion when you thought you lost yourself\nwas the compass to find your true self.",
                            general: "You who offered understanding to the feeling of wanting to disappear,\nthat understanding is your compassion now."
                        },
                        pt: {
                            social_rejection: "A indiferenÃ§a das pessoas tentou te apagar,\nmas sua existÃªncia Ã© uma verdade indelÃ©vel.",
                            failure: "Aquelas experiÃªncias chamadas fracassos\nagora se tornaram sua sabedoria Ãºnica.",
                            worthlessness: "Mesmo quando sentiu que perdeu valor,\nseu valor essencial nunca mudou.",
                            overwhelming_pain: "Aquela dor tentou te engolir,\nmas vocÃª era maior que a dor.",
                            loneliness: "Aqueles momentos que esteve sozinho\nagora te presentearam com profundidade e empatia.",
                            shame: "O verdadeiro vocÃª que se escondeu atrÃ¡s da vergonha\nagora estÃ¡ orgulhosamente se mostrando ao mundo.",
                            hopelessness: "O que vocÃª encontrou no fim do desespero\nfoi uma vontade inquebrÃ¡vel de viver.",
                            perfectionism: "VocÃª que se cansou perseguindo a perfeiÃ§Ã£o\nagora conhece a beleza de ser como vocÃª Ã©.",
                            trauma: "As feridas nÃ£o te fizeram fraco\nmas te fizeram alguÃ©m que pode amar mais profundamente.",
                            identity_crisis: "A confusÃ£o quando pensou que se perdeu\nfoi a bÃºssola para encontrar seu verdadeiro eu.",
                            general: "VocÃª que ofereceu compreensÃ£o ao sentimento de querer desaparecer,\nessa compreensÃ£o Ã© sua compaixÃ£o agora."
                        }
                    };
                    
                    return responses[lang][disappearanceType] || responses[lang]['general'];
                }
            }
        ];
        
        // Typewriter effect
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (state.currentTypingElement) {
                    state.currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                state.currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                state.typingIntervals.push(typingInterval);
            });
        }
        
        // Clear all typing effects
        function clearAllTypingEffects() {
            state.typingIntervals.forEach(interval => clearInterval(interval));
            state.typingIntervals = [];
            
            if (state.currentTypingElement) {
                state.currentTypingElement.classList.remove('typing-cursor');
                state.currentTypingElement = null;
            }
        }
        
        // Scroll functions
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        // Language management
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            const t = translations[lang];
            document.title = t.title;
            document.getElementById('logoSubtitle').textContent = t.logoSubtitle;
            document.getElementById('portalMainTitle').textContent = t.portalMainTitle;
            document.getElementById('portalSubtitle').textContent = t.portalSubtitle;
            document.getElementById('lightTitle').textContent = t.lightTitle;
            document.getElementById('navigationTitle').textContent = t.navigationTitle;
            document.getElementById('nextPortalBtn').textContent = t.nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = t.stayPortalBtn;
            document.getElementById('userTextarea').placeholder = t.inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || state.currentLanguage === lang) return;
            
            state.currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (state.journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        // Journey management
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            state.userResponse = '';
            state.currentTypingElement = null;
            state.awaitingSecondResponse = false;
        }
        
        // Save response to database or memory
        async function saveResponse(inputText, step) {
            const responseData = {
                portal: portalConfig.currentPortal,
                resposta: inputText,
                step: step,
                data: new Date().toISOString(),
                idioma: state.currentLanguage,
                userId: state.currentUser ? state.currentUser.uid : 'anonymous',
                userEmail: state.currentUser ? state.currentUser.email : 'anonymous@temarix.com'
            };
            
            if (state.firebaseInitialized && state.db) {
                try {
                    await state.db.collection("temarix_v5_respostas").add({
                        ...responseData,
                        timestamp: firebase.firestore.Timestamp.now()
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                    state.userResponses.push(responseData);
                    showConnectionStatus(false);
                }
            } else {
                state.userResponses.push(responseData);
                console.log('Response stored in memory:', responseData);
            }
        }
        
        // User input processing
        async function processUserInput(inputText) {
            state.userResponse = inputText;
            
            await saveResponse(inputText, state.awaitingSecondResponse ? "second" : "first");
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!state.awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[state.currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        // Show character reactions
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[state.currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                state.awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, state.currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[state.currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[state.currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        // Portal sequence
        async function startPortalSequence() {
            console.log('Starting portal sequence...');
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            console.log('Showing intro...');
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            if (!introSection || !introElement) {
                console.error('Intro elements not found!');
                return;
            }
            
            introSection.classList.add('show');
            
            const introText = translations[state.currentLanguage].portalIntro;
            console.log('Intro text:', introText);
            
            await typewriterEffect(introElement, introText, 60);
            
            setTimeout(async () => {
                await showEmotionalBridge();
            }, 2000);
        }
        
        async function showEmotionalBridge() {
            const introElement = document.getElementById('portalIntro');
            const bridgeText = '\n\n' + translations[state.currentLanguage].emotionalBridge;
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const bridgeP = document.createElement('p');
            bridgeP.style.cssText = `
                margin-top: 30px;
                font-style: italic;
                color: #ff9999;
                font-size: 18px;
                line-height: 1.8;
            `;
            introElement.appendChild(bridgeP);
            
            await typewriterEffect(bridgeP, bridgeText.trim(), 50);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        // Custom confirm dialog
        function showConfirmDialog(message, callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                font-family: 'Courier New', monospace;
            `;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: #222;
                border: 2px solid #ff6b6b;
                padding: 30px;
                max-width: 400px;
                text-align: center;
                color: white;
            `;
            
            const messageP = document.createElement('p');
            messageP.textContent = message;
            messageP.style.cssText = `
                margin-bottom: 20px;
                line-height: 1.6;
                font-size: 16px;
            `;
            
            const buttonContainer = document.createElement('div');
            buttonContainer.style.cssText = `
                display: flex;
                gap: 15px;
                justify-content: center;
            `;
            
            const yesBtn = document.createElement('button');
            const noBtn = document.createElement('button');
            
            const buttonStyle = `
                background: #444;
                color: white;
                border: 1px solid #ff6b6b;
                padding: 10px 20px;
                cursor: pointer;
                font-family: 'Courier New', monospace;
                font-size: 14px;
            `;
            
            yesBtn.style.cssText = buttonStyle + 'background: #ff6b6b;';
            noBtn.style.cssText = buttonStyle;
            
            yesBtn.textContent = state.currentLanguage === 'ko' ? 'ì˜ˆ' : 
                                state.currentLanguage === 'pt' ? 'Sim' : 'Yes';
            noBtn.textContent = state.currentLanguage === 'ko' ? 'ì•„ë‹ˆì˜¤' : 
                               state.currentLanguage === 'pt' ? 'NÃ£o' : 'No';
            
            yesBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(true);
            };
            
            noBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(false);
            };
            
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                    callback(false);
                }
            };
            
            buttonContainer.appendChild(yesBtn);
            buttonContainer.appendChild(noBtn);
            modal.appendChild(messageP);
            modal.appendChild(buttonContainer);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            yesBtn.focus();
        }
        
        // Event setup
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function createPortalTransition(callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, #000 0%, #111 50%, #000 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 20000;
                opacity: 0;
                transition: opacity 1s ease-in-out;
                font-family: 'Courier New', monospace;
            `;
            
            const message = document.createElement('div');
            message.style.cssText = `
                color: #ff6b6b;
                font-size: 24px;
                text-align: center;
                margin-bottom: 30px;
                opacity: 0;
                transform: translateY(20px);
                transition: all 0.8s ease-out;
            `;
            message.textContent = translations[state.currentLanguage].transitionMessage;
            
            const loader = document.createElement('div');
            loader.style.cssText = `
                width: 60px;
                height: 60px;
                border: 3px solid #333;
                border-top: 3px solid #ff6b6b;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                opacity: 0;
                transition: opacity 0.8s ease-out 0.3s;
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            overlay.appendChild(message);
            overlay.appendChild(loader);
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                overlay.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                message.style.opacity = '1';
                message.style.transform = 'translateY(0)';
                loader.style.opacity = '1';
            }, 300);
            
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(overlay);
                    document.head.removeChild(style);
                    callback();
                }, 1000);
            }, 2500);
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmNextPortal, (confirmed) => {
                    if (confirmed) {
                        if (state.firebaseInitialized && state.db) {
                            state.db.collection("temarix_v5_progress").add({
                                userId: state.currentUser.uid,
                                portal: portalConfig.currentPortal,
                                status: "complete",
                                timestamp: firebase.firestore.Timestamp.now()
                            }).catch(error => console.error('Error saving progress:', error));
                        }
                        
                        createPortalTransition(() => {
                            window.location.href = `${portalConfig.nextPortalFile}?lang=${state.currentLanguage}`;
                        });
                    }
                });
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmStay, (confirmed) => {
                    if (confirmed) {
                        resetJourney();
                        setTimeout(() => {
                            startPortalSequence();
                        }, 1000);
                    }
                });
            });
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        function initializeTemarix() {
            console.log('Initializing Temarix V5 Portal 09...');
            console.log('Current state:', state);
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            state.journeyStarted = true;
            console.log('Journey started:', state.journeyStarted);
            
            console.log('Starting portal sequence in 1 second...');
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Temarix V5 Portal 09 DOM loaded');
            
            state.currentLanguage = getLanguageFromURL();
            
            updateStaticTranslations(state.currentLanguage);
            updateLanguageButtons(state.currentLanguage);
            
            await initializeFirebase();
            
            initializeTemarix();
        });
    </script>
</body>
</html>