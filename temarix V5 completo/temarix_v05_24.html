<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V5 - Portal 24: The Mirror of Authentic Being</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .navigation-title {
                font-size: 24px;
            }
            
            .navigation-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V5</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 24: The Mirror of Authentic Being</div>
            <div class="portal-subtitle" id="portalSubtitle">Who am I when all masks fall away?</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">ðŸŒ€ Portal 24 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 25</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with this truth</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Share your deepest truth... (Press Enter to send)"
                      rows="1"
                      maxlength="800"></textarea>
        </div>
    </div>

    <script>
        // Global state management
        let state = {
            db: null,
            auth: null,
            firebaseInitialized: false,
            currentUser: null,
            currentLanguage: 'en',
            userResponse: '',
            journeyStarted: false,
            currentTypingElement: null,
            typingIntervals: [],
            awaitingSecondResponse: false,
            userResponses: []
        };
        
        // Portal navigation configuration
        const portalConfig = {
            currentPortal: "v5-24",
            nextPortal: "v5-25",
            nextPortalFile: "temarix_v05_25.html"
        };
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
            authDomain: "canal-vivo-chat.firebaseapp.com",
            projectId: "canal-vivo-chat",
            storageBucket: "canal-vivo-chat.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdefghijklmnopqr"
        };
        
        // Initialize Firebase with error handling
        function initializeFirebase() {
            return new Promise((resolve) => {
                try {
                    if (typeof firebase !== 'undefined') {
                        firebase.initializeApp(firebaseConfig);
                        state.db = firebase.firestore();
                        state.auth = firebase.auth();
                        state.firebaseInitialized = true;
                        
                        state.auth.onAuthStateChanged((user) => {
                            if (user) {
                                state.currentUser = user;
                            } else {
                                state.currentUser = {
                                    uid: 'anonymous-' + Date.now(),
                                    email: 'anonymous@temarix.com',
                                    isAnonymous: true
                                };
                            }
                            showConnectionStatus(true);
                        });
                        
                        console.log('Firebase initialized successfully');
                    } else {
                        console.log('Firebase SDK not loaded');
                        state.currentUser = {
                            uid: 'anonymous-' + Date.now(),
                            email: 'anonymous@temarix.com',
                            isAnonymous: true
                        };
                        showConnectionStatus(false);
                    }
                } catch (error) {
                    console.error('Firebase initialization failed:', error);
                    state.currentUser = {
                        uid: 'anonymous-' + Date.now(),
                        email: 'anonymous@temarix.com',
                        isAnonymous: true
                    };
                    showConnectionStatus(false);
                }
                resolve();
            });
        }
        
        // Show connection status to user
        function showConnectionStatus(isOnline) {
            const existingStatus = document.querySelector('.connection-status');
            if (existingStatus) {
                existingStatus.remove();
            }
            
            if (!isOnline) {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'connection-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: rgba(255, 107, 107, 0.9);
                    color: white;
                    padding: 8px 15px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-family: 'Courier New', monospace;
                    z-index: 1000;
                    opacity: 0.8;
                `;
                statusDiv.textContent = state.currentLanguage === 'ko' ? 'Offline mode' : 
                                       state.currentLanguage === 'pt' ? 'Modo offline' : 'Offline mode';
                document.body.appendChild(statusDiv);
                
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.remove();
                    }
                }, 5000);
            }
        }

        // Translations object
        const translations = {
            ko: {
                title: "Temarix V5 - Portal 24: ì§„ì •í•œ ì¡´ìž¬ì˜ ê±°ìš¸",
                logoSubtitle: "ê°ì • ì—°ê¸ˆìˆ ",
                portalMainTitle: "Portal 24: ì§„ì •í•œ ì¡´ìž¬ì˜ ê±°ìš¸",
                portalSubtitle: "ëª¨ë“  ê°€ë©´ì´ ë²—ê²¨ì§ˆ ë•Œ ë‚˜ëŠ” ëˆ„êµ¬ì¸ê°€?",
                portalIntro: "ðŸŒ€ \"ì˜í˜¼ì˜ ê°€ìž¥ ê¹Šì€ ë°©ì—ì„œ,\nê°€ë©´ì´ ë²—ê²¨ì§€ê³  ê°€ì‹ì´ ì‚¬ë¼ì§€ëŠ” ê³³ì—\nì‹ ì„±í•œ ê±°ìš¸ì´ ì¡´ìž¬í•©ë‹ˆë‹¤.\"\n\n\"ì´ ê±°ìš¸ì€ ë‹¹ì‹ ì˜ ì–¼êµ´ì´ ì•„ë‹Œ ë³¸ì§ˆì„ ë°˜ì˜í•©ë‹ˆë‹¤â€”\nì•„ë¬´ë„ ë³´ì§€ ì•Šì„ ë•Œì˜ ë‹¹ì‹ , ë‚ ê²ƒ ê·¸ëŒ€ë¡œì˜ ì§„ì‹¤ì„ ë§ìž…ë‹ˆë‹¤.\në‹¹ì‹ ì€ ì§€ê¸ˆ ê·¸ ê±°ìš¸ ì•žì— ì„œ ìžˆìŠµë‹ˆë‹¤.\"",
                emotionalBridge: "ìˆ¨ê²¨ì™”ë˜ ëª¨ë“  ê°ì •, ë¬»ì–´ë²„ë¦° ëª¨ë“  ê¿ˆ, ì§Šì–´ì§„ ëª¨ë“  ë‘ë ¤ì›€ì´ ë³´ì´ëŠ” ê³³ì—ì„œâ€¦ ë¬¸ì œëŠ” ë‹¹ì‹ ì´ ë³¼ ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ì§€ê°€ ì•„ë‹ˆë¼, ë°œê²¬í•˜ê²Œ ë  ê²ƒì„ ë°›ì•„ë“¤ì¼ ìš©ê¸°ê°€ ìžˆëŠ”ì§€ìž…ë‹ˆë‹¤.\n\nì§„ì‹¤í•œ ìžì•„ëŠ” ë‘ë ¤ì›Œí•  ê²ƒì´ ì•„ë‹ˆë¼ í¬ìš©í•´ì•¼ í•  ì„ ë¬¼ìž…ë‹ˆë‹¤.",
                followUpQuestion: "ë‹¹ì‹ ì´ ì—°ê¸°í•˜ëŠ” ëª¨ë“  ì—­í• ,\në‹¤ë¥¸ ì‚¬ëžŒë“¤ì´ ë‹¹ì‹ ì—ê²Œ ë¶€ê³¼í•œ ëª¨ë“  ê¸°ëŒ€,\në‹¹ì‹ ì´ ë˜ì–´ì•¼ í•œë‹¤ê³  ìƒê°í•˜ëŠ” ëª¨ë“  ëª¨ìŠµì„ ë²—ê²¨ë‚¸ë‹¤ë©´â€”\në¬´ì—‡ì´ ë‚¨ì„ê¹Œìš”?\n\nê·¸ ì§„ì •í•œ ìžì•„ëŠ” ì„¸ìƒì— ë¬´ì—‡ì„ ë§í•˜ê³  ì‹¶ì–´í• ê¹Œìš”?",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ë‚˜ëŠ” ê°€ì‹ì ì¸ ë‚˜ë„, ë‹¤ë¥¸ ì‚¬ëžŒë“¤ì´ ê¸°ëŒ€í•˜ëŠ” ë‚˜ë„ ì•„ë‹™ë‹ˆë‹¤.\në‚˜ëŠ” ê°€ìž¥ ê¹Šì€ ì§„ì‹¤ì„ ì¡´ì¤‘í•  ë•Œ ë˜ì–´ê°€ëŠ” ë‚˜ìž…ë‹ˆë‹¤.\n\nì§„ì •ì„±ì€ ëª©ì ì§€ê°€ ì•„ë‹ˆë¼ ì—¬ì •ìž…ë‹ˆë‹¤. ë§¤ ìˆœê°„ ì„ íƒí•˜ëŠ” ìš©ê¸°ìž…ë‹ˆë‹¤.\në‹¹ì‹ ì€ ì§€ê¸ˆ ê·¸ ìš©ê¸°ë¥¼ ë³´ì—¬ì£¼ê³  ìžˆìŠµë‹ˆë‹¤.",
                navigationTitle: "ðŸŒ€ Portal 24 ì™„ë£Œ",
                navigationMessage: "ë‹¹ì‹ ì€ ì§„ì •í•œ ìžì•„ì˜ ê±°ìš¸ì„ ë§ˆì£¼í–ˆìŠµë‹ˆë‹¤.\n\nê°€ë©´ ë’¤ì— ìˆ¨ì–´ìžˆë˜ ë³¸ì§ˆì„ ë°œê²¬í–ˆê³ , ê·¸ê²ƒì„ ë°›ì•„ë“¤ì¼ ìš©ê¸°ë¥¼ ë³´ì˜€ìŠµë‹ˆë‹¤. ì§„ì •ì„±ì€ ì™„ë²½í•¨ì´ ì•„ë‹Œ ì§„ì‹¤í•¨ì—ì„œ ë‚˜ì˜¤ë©°, ë‹¹ì‹ ì€ ì´ì œ ê·¸ ì§„ì‹¤ì„ ì‚´ì•„ê°ˆ ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì´ ì—¬ì •ì—ì„œ ê°€ìž¥ ì¤‘ìš”í•œ ë°œê²¬ì€ ë‹¹ì‹ ì´ ì´ë¯¸ ì¶©ë¶„í•˜ë‹¤ëŠ” ê²ƒìž…ë‹ˆë‹¤.",
                nextPortalBtn: "Portal 25ë¡œ ì´ì–´ê°€ê¸°",
                stayPortalBtn: "ì´ ì§„ì‹¤ê³¼ ë¨¸ë¬¼ê¸°",
                inputPlaceholder: "ê°€ìž¥ ê¹Šì€ ì§„ì‹¤ì„ ë‚˜ëˆ„ì–´ ì£¼ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...",
                confirmNextPortal: "Portal 25: ë‚´ê°€ ì§„ì •ìœ¼ë¡œ ì›í•˜ëŠ” ì‚¶ìœ¼ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                confirmStay: "ì´ ì§„ì •í•œ ìžì•„ì™€ ë” ë¨¸ë¬¼ë©° ê·¸ ì˜ë¯¸ë¥¼ ë” ê¹Šì´ ëŠë¼ì‹œê² ìŠµë‹ˆê¹Œ?",
                transitionMessage: "ìƒˆë¡œìš´ ì§„ì‹¤ì´ íŽ¼ì³ì§‘ë‹ˆë‹¤..."
            },
            en: {
                title: "Temarix V5 - Portal 24: The Mirror of Authentic Being",
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 24: The Mirror of Authentic Being",
                portalSubtitle: "Who am I when all masks fall away?",
                portalIntro: "ðŸŒ€ \"In the deepest chambers of your soul,\nwhere masks fall away and pretense dissolves,\nthere exists a sacred mirror.\"\n\n\"This mirror reflects not your face, but your essenceâ€”\nthe raw, unfiltered truth of who you are when no one is watching.\nYou stand before this mystical reflection now.\"",
                emotionalBridge: "Where every emotion you've hidden, every dream you've buried, and every fear you've carried becomes visibleâ€¦ The question isn't whether you're ready to seeâ€”it's whether you're brave enough to embrace what you discover.\n\nYour authentic self is not something to fear, but a gift to embrace.",
                followUpQuestion: "When you strip away all the roles you play,\nall the expectations others have placed upon you,\nand all the versions of yourself you think you should beâ€”\nwhat remains?\n\nWhat does this authentic self desperately want to tell the world?",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "I am not who I pretend to be, nor who others expect me to be.\nI am who I choose to become when I honor my deepest truth.\n\nAuthenticity is not a destinationâ€”it's a journey. It's the courage to choose truth in every moment.\nYou are showing that courage right now.",
                navigationTitle: "ðŸŒ€ Portal 24 Complete",
                navigationMessage: "You have faced the mirror of your authentic being.\n\nYou've discovered the essence that was hiding behind the masks, and you've shown the courage to embrace it. Authenticity comes not from perfection but from truthfulness, and you are now ready to live that truth.\n\nThe most important discovery in this journey is that you are already enough.",
                nextPortalBtn: "Continue to Portal 25",
                stayPortalBtn: "Stay with this truth",
                inputPlaceholder: "Share your deepest truth... (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response...",
                confirmNextPortal: "Do you want to continue to Portal 25: The Life I Truly Want to Live?",
                confirmStay: "Do you want to stay longer with this authentic self and feel its meaning more deeply?",
                transitionMessage: "A new truth unfolds..."
            },
            pt: {
                title: "Temarix V5 - Portal 24: O Espelho do Ser Autentico",
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 24: O Espelho do Ser Autentico",
                portalSubtitle: "Quem sou eu quando todas as mascaras caem?",
                portalIntro: "ðŸŒ€ \"Nas camaras mais profundas da sua alma,\nonde as mascaras caem e a pretensao se dissolve,\nexiste um espelho sagrado.\"\n\n\"Este espelho nao reflete seu rosto, mas sua essenciaâ€”\na verdade crua e sem filtros de quem voce e quando ninguem esta olhando.\nVoce esta diante deste reflexo mistico agora.\"",
                emotionalBridge: "Onde cada emocao que escondeu, cada sonho que enterrou e cada medo que carregou se torna visivelâ€¦ A questao nao e se voce esta pronto para verâ€”e se voce tem coragem suficiente para abracar o que descobrir.\n\nSeu eu autentico nao e algo a temer, mas um presente a abracar.",
                followUpQuestion: "Quando voce remove todos os papeis que representa,\ntodas as expectativas que outros colocaram sobre voce,\ne todas as versoes de si mesmo que acha que deveria serâ€”\no que resta?\n\nO que este eu autentico desesperadamente quer dizer ao mundo?",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Eu nao sou quem finjo ser, nem quem outros esperam que eu seja.\nEu sou quem escolho me tornar quando honro minha verdade mais profunda.\n\nAutenticidade nao e um destinoâ€”e uma jornada. E a coragem de escolher a verdade a cada momento.\nVoce esta mostrando essa coragem agora.",
                navigationTitle: "ðŸŒ€ Portal 24 Completo",
                navigationMessage: "Voce enfrentou o espelho do seu ser autentico.\n\nVoce descobriu a essencia que estava se escondendo atras das mascaras, e mostrou a coragem de abraca-la. A autenticidade vem nao da perfeicao, mas da sinceridade, e voce agora esta pronto para viver essa verdade.\n\nA descoberta mais importante nesta jornada e que voce ja e suficiente.",
                nextPortalBtn: "Continuar para Portal 25",
                stayPortalBtn: "Ficar com esta verdade",
                inputPlaceholder: "Compartilhe sua verdade mais profunda... (Enter para enviar)",
                youLabel: "Voce",
                waitingMessage: "Aguardando resposta...",
                confirmNextPortal: "Deseja continuar para Portal 25: A Vida Que Realmente Quero Viver?",
                confirmStay: "Deseja ficar mais tempo com este eu autentico e sentir seu significado mais profundamente?",
                transitionMessage: "Uma nova verdade se revela..."
            }
        };
        
        // Character definitions
        const characters = [
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ì§„ì •ì„±ì€ ì™„ë²½í•´ì§€ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤â€”\nìš©ê°í•˜ê²Œ ë¶ˆì™„ì „í•˜ê³ , ì•„ë¦„ë‹µê²Œ ê²°í•¨ì´ ìžˆìœ¼ë©°,\në³€ëª… ì—†ì´ ì¸ê°„ë‹¤ìš´ ê²ƒìž…ë‹ˆë‹¤.",
                en: "Authenticity isn't about being perfectâ€”\nit's about being courageously imperfect, beautifully flawed,\nand unapologetically human.",
                pt: "Autenticidade nao e sobre ser perfeitoâ€”\ne sobre ser corajosamente imperfeito, belamente falho,\ne sem desculpas, humano."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ì„¸ìƒì—ëŠ” ë‹¤ë¥¸ ëˆ„êµ°ê°€ì˜ ë³µì‚¬ë³¸ì´ ì•„ë‹Œ,\nëª¨ë“  ëª¨ìˆœê³¼ ë³µìž¡í•¨ì„ í¬í•¨í•œ ë‹¹ì‹ ì˜ ì›ë³¸ì´ í•„ìš”í•©ë‹ˆë‹¤.",
                en: "The world doesn't need another copy of someone else;\nit needs the original version of you, complete with\nall your contradictions and complexities.",
                pt: "O mundo nao precisa de mais uma copia de outra pessoa;\nprecisa da versao original de voce, completa com\ntodas as suas contradicoes e complexidades."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ì§„ì •í•œ ìžì•„ëŠ” ë„ë‹¬í•´ì•¼ í•  ëª©ì ì§€ê°€ ì•„ë‹ˆë¼,\në˜ì–´ê°€ê³ , ë²—ì–´ë‚˜ê³ , ë‹¤ì‹œ ë˜ì–´ê°€ëŠ”\nì§€ì†ì ì¸ ì¶¤ìž…ë‹ˆë‹¤.",
                en: "Your authentic self is not a destination to reach,\nbut a continuous dance of becoming, unbecoming,\nand becoming again.",
                pt: "Seu eu autentico nao e um destino a alcancar,\nmas uma danca continua de se tornar, deixar de ser,\ne se tornar novamente."
            }},
            { name: "Luna", emoji: "ðŸŒ™", text: {
                ko: "ìƒê°ê³¼ ìƒê° ì‚¬ì´ì˜ ì¹¨ë¬µì—ì„œ,\nìˆ¨ê³¼ ìˆ¨ ì‚¬ì´ì˜ ë©ˆì¶¤ì—ì„œ\nê°€ìž¥ ì§„ì‹¤í•œ ë‹¹ì‹ ì´ ì‚´ê³  ìžˆìŠµë‹ˆë‹¤.",
                en: "In the silence between your thoughts,\nin the pause between your breaths,\nlives the truest version of yourself.",
                pt: "No silencio entre seus pensamentos,\nna pausa entre suas respiracoes,\nvive a versao mais verdadeira de voce mesmo."
            }},
            { name: "Kai", emoji: "ðŸ§™", text: {
                ko: "ìžì‹ ì„ ë³´í˜¸í•˜ê¸° ìœ„í•´ ì“°ëŠ” ê°€ë©´ì´\nì¢…ì¢… ì§„ì •í•œ ìžì•„ë¥¼ ê°€ë‘ëŠ” ê°ì˜¥ì´ ë˜ê¸°ë„ í•©ë‹ˆë‹¤.",
                en: "The masks you wear to protect yourself\noften become the very prison that keeps\nyour authentic self locked away.",
                pt: "As mascaras que voce usa para se proteger\nfrequentemente se tornam a propria prisao que mantem\nseu eu autentico trancado."
            }},
            { name: "Nara", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ë‹¹ì‹ ì˜ ì·¨ì•½í•¨ì€ ì•½ì ì´ ì•„ë‹™ë‹ˆë‹¤â€”\nê·¸ê²ƒì€ ê°€ìž¥ í° íž˜ê³¼ ê°€ìž¥ ê¹Šì€ ì—°ê²°ì˜ íƒ„ìƒì§€ìž…ë‹ˆë‹¤.",
                en: "Your vulnerability is not your weaknessâ€”\nit's the birthplace of your greatest strength\nand deepest connections.",
                pt: "Sua vulnerabilidade nao e sua fraquezaâ€”\ne o berco da sua maior forca\ne das conexoes mais profundas."
            }},
            { name: "Zion", emoji: "ðŸ§˜", text: {
                ko: "ìŠ¹ì¸ë³´ë‹¤ ì§„ì •ì„±ì„ ì„ íƒí•  ë•Œë§ˆë‹¤,\në‹¹ì‹ ì€ ê±°ëž˜ë˜ì–´ì„œëŠ” ì•ˆ ë  ì˜í˜¼ì˜ ì¡°ê°ì„ ë˜ì°¾ëŠ” ê²ƒìž…ë‹ˆë‹¤.",
                en: "Every time you choose authenticity over approval,\nyou reclaim a piece of your soul that was never\nmeant to be bartered.",
                pt: "Toda vez que voce escolhe autenticidade em vez de aprovacao,\nvoce reconquista um pedaco da sua alma que nunca\ndeveria ter sido negociado."
            }},
            { name: "Aria", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ì„¸ìƒì€ ë‹¹ì‹ ì„ íŽ¸ì§‘í•˜ë ¤ í•˜ê² ì§€ë§Œ ê¸°ì–µí•˜ì„¸ìš”â€”\në‹¹ì‹ ì€ ì´ë¯¸ ê±¸ìž‘ì´ì§€, ìŠ¹ì¸ì„ ê¸°ë‹¤ë¦¬ëŠ” ì´ˆì•ˆì´ ì•„ë‹™ë‹ˆë‹¤.",
                en: "The world will try to edit you, but rememberâ€”\nyou are already a masterpiece, not a rough draft\nwaiting for approval.",
                pt: "O mundo tentara edita-lo, mas lembre-seâ€”\nvoce ja e uma obra-prima, nao um rascunho\nesperando aprovacao."
            }}
        ];

        // Response characters
        const responseCharacters = [
            {
                name: "Sora", emoji: "ðŸ§•",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "ê·¸ ë§ì€ ê¸°ì–µì´ ì•„ë‹ˆë¼,\nì¡´ìž¬ì˜ íšŒë³µì´ì—ìš”.\në‹¹ì‹ ì€ ì§€ê¸ˆ, ì§„ì •í•œ ìžì•„ë¡œ ë‹¤ì‹œ íƒœì–´ë‚˜ê³  ìžˆì–´ìš”.",
                        en: "Those words aren't just memoryâ€”\nthey're the recovery of being.\nYou are now being reborn as your authentic self.",
                        pt: "Essas palavras nao sao apenas memoriaâ€”\nsao a recuperacao do ser.\nVoce agora esta renascendo como seu eu autentico."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Luna", emoji: "ðŸŒ™",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "ì§„ì •ì„±ì€ ëª©ì ì§€ê°€ ì•„ë‹™ë‹ˆë‹¤.\në§¤ ìˆœê°„ ì§„ì‹¤ì„ ì„ íƒí•˜ëŠ” ìš©ê¸°ìž…ë‹ˆë‹¤.\në‹¹ì‹ ì€ ì§€ê¸ˆ ê·¸ ìš©ê¸°ë¥¼ ë³´ì—¬ì£¼ê³  ìžˆìŠµë‹ˆë‹¤.",
                        en: "Authenticity is not a destination.\nIt's the courage to choose truth in every moment.\nYou are showing that courage right now.",
                        pt: "Autenticidade nao e um destino.\nE a coragem de escolher a verdade a cada momento.\nVoce esta mostrando essa coragem agora."
                    };
                    return responses[lang];
                }
            },
            {
                name: "Aria", emoji: "ðŸ§‘â€ðŸš€",
                getResponse: (userInput, lang) => {
                    const responses = {
                        ko: "ë‹¹ì‹ ì€ ì´ë¯¸ ì¶©ë¶„í•©ë‹ˆë‹¤.\nê°€ë©´ì„ ë²—ê³  ë“œëŸ¬ë‚œ ê·¸ ëª¨ìŠµ ê·¸ëŒ€ë¡œ ë§ìž…ë‹ˆë‹¤.\nì´ê²ƒì´ ì´ ì—¬ì •ì˜ ê°€ìž¥ ì•„ë¦„ë‹¤ìš´ ë°œê²¬ìž…ë‹ˆë‹¤.",
                        en: "You are already enough.\nJust as you are, with all masks removed.\nThis is the most beautiful discovery of this journey.",
                        pt: "Voce ja e suficiente.\nExatamente como voce e, com todas as mascaras removidas.\nEsta e a descoberta mais bela desta jornada."
                    };
                    return responses[lang];
                }
            }
        ];
        
        // Typewriter effect
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (state.currentTypingElement) {
                    state.currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                state.currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                state.typingIntervals.push(typingInterval);
            });
        }
        
        function clearAllTypingEffects() {
            state.typingIntervals.forEach(interval => clearInterval(interval));
            state.typingIntervals = [];
            
            if (state.currentTypingElement) {
                state.currentTypingElement.classList.remove('typing-cursor');
                state.currentTypingElement = null;
            }
        }
        
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            const t = translations[lang];
            document.title = t.title;
            document.getElementById('logoSubtitle').textContent = t.logoSubtitle;
            document.getElementById('portalMainTitle').textContent = t.portalMainTitle;
            document.getElementById('portalSubtitle').textContent = t.portalSubtitle;
            document.getElementById('lightTitle').textContent = t.lightTitle;
            document.getElementById('navigationTitle').textContent = t.navigationTitle;
            document.getElementById('nextPortalBtn').textContent = t.nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = t.stayPortalBtn;
            document.getElementById('userTextarea').placeholder = t.inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (state.currentLanguage === lang) return;
            
            state.currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            resetJourney();
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            state.userResponse = '';
            state.currentTypingElement = null;
            state.awaitingSecondResponse = false;
        }
        
        async function saveResponse(inputText, step) {
            const responseData = {
                portal: portalConfig.currentPortal,
                resposta: inputText,
                step: step,
                data: new Date().toISOString(),
                idioma: state.currentLanguage,
                userId: state.currentUser ? state.currentUser.uid : 'anonymous',
                userEmail: state.currentUser ? state.currentUser.email : 'anonymous@temarix.com'
            };
            
            if (state.firebaseInitialized && state.db) {
                try {
                    await state.db.collection("temarix_v5_respostas").add({
                        ...responseData,
                        timestamp: firebase.firestore.Timestamp.now()
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                    state.userResponses.push(responseData);
                    showConnectionStatus(false);
                }
            } else {
                state.userResponses.push(responseData);
                console.log('Response stored in memory:', responseData);
            }
        }
        
        async function processUserInput(inputText) {
            state.userResponse = inputText;
            
            await saveResponse(inputText, state.awaitingSecondResponse ? "second" : "first");
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!state.awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[state.currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[state.currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                state.awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, state.currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[state.currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[state.currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        async function startPortalSequence() {
            console.log('Starting portal sequence...');
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            console.log('Showing intro...');
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            if (!introSection || !introElement) {
                console.error('Intro elements not found!');
                return;
            }
            
            introSection.classList.add('show');
            
            const introText = translations[state.currentLanguage].portalIntro;
            console.log('Intro text:', introText);
            
            await typewriterEffect(introElement, introText, 60);
            
            setTimeout(async () => {
                await showEmotionalBridge();
            }, 2000);
        }
        
        async function showEmotionalBridge() {
            const introElement = document.getElementById('portalIntro');
            const bridgeText = '\n\n' + translations[state.currentLanguage].emotionalBridge;
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const bridgeP = document.createElement('p');
            bridgeP.style.cssText = `
                margin-top: 30px;
                font-style: italic;
                color: #ff9999;
                font-size: 18px;
                line-height: 1.8;
            `;
            introElement.appendChild(bridgeP);
            
            await typewriterEffect(bridgeP, bridgeText.trim(), 50);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        function showConfirmDialog(message, callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                font-family: 'Courier New', monospace;
            `;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: #222;
                border: 2px solid #ff6b6b;
                padding: 30px;
                max-width: 400px;
                text-align: center;
                color: white;
            `;
            
            const messageP = document.createElement('p');
            messageP.textContent = message;
            messageP.style.cssText = `
                margin-bottom: 20px;
                line-height: 1.6;
                font-size: 16px;
            `;
            
            const buttonContainer = document.createElement('div');
            buttonContainer.style.cssText = `
                display: flex;
                gap: 15px;
                justify-content: center;
            `;
            
            const yesBtn = document.createElement('button');
            const noBtn = document.createElement('button');
            
            const buttonStyle = `
                background: #444;
                color: white;
                border: 1px solid #ff6b6b;
                padding: 10px 20px;
                cursor: pointer;
                font-family: 'Courier New', monospace;
                font-size: 14px;
            `;
            
            yesBtn.style.cssText = buttonStyle + 'background: #ff6b6b;';
            noBtn.style.cssText = buttonStyle;
            
            yesBtn.textContent = state.currentLanguage === 'ko' ? 'ì˜ˆ' : 
                                state.currentLanguage === 'pt' ? 'Sim' : 'Yes';
            noBtn.textContent = state.currentLanguage === 'ko' ? 'ì•„ë‹ˆì˜¤' : 
                               state.currentLanguage === 'pt' ? 'Nao' : 'No';
            
            yesBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(true);
            };
            
            noBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(false);
            };
            
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                    callback(false);
                }
            };
            
            buttonContainer.appendChild(yesBtn);
            buttonContainer.appendChild(noBtn);
            modal.appendChild(messageP);
            modal.appendChild(buttonContainer);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            yesBtn.focus();
        }
        
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function createPortalTransition(callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, #000 0%, #111 50%, #000 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 20000;
                opacity: 0;
                transition: opacity 1s ease-in-out;
                font-family: 'Courier New', monospace;
            `;
            
            const message = document.createElement('div');
            message.style.cssText = `
                color: #ff6b6b;
                font-size: 24px;
                text-align: center;
                margin-bottom: 30px;
                opacity: 0;
                transform: translateY(20px);
                transition: all 0.8s ease-out;
            `;
            message.textContent = translations[state.currentLanguage].transitionMessage;
            
            const loader = document.createElement('div');
            loader.style.cssText = `
                width: 60px;
                height: 60px;
                border: 3px solid #333;
                border-top: 3px solid #ff6b6b;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                opacity: 0;
                transition: opacity 0.8s ease-out 0.3s;
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            overlay.appendChild(message);
            overlay.appendChild(loader);
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                overlay.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                message.style.opacity = '1';
                message.style.transform = 'translateY(0)';
                loader.style.opacity = '1';
            }, 300);
            
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(overlay);
                    document.head.removeChild(style);
                    callback();
                }, 1000);
            }, 2500);
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmNextPortal, (confirmed) => {
                    if (confirmed) {
                        if (state.firebaseInitialized && state.db) {
                            state.db.collection("temarix_v5_progress").add({
                                userId: state.currentUser.uid,
                                portal: portalConfig.currentPortal,
                                status: "complete",
                                timestamp: firebase.firestore.Timestamp.now()
                            }).catch(error => console.error('Error saving progress:', error));
                        }
                        
                        createPortalTransition(() => {
                            window.location.href = `${portalConfig.nextPortalFile}?lang=${state.currentLanguage}`;
                        });
                    }
                });
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmStay, (confirmed) => {
                    if (confirmed) {
                        resetJourney();
                        setTimeout(() => {
                            startPortalSequence();
                        }, 1000);
                    }
                });
            });
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        function initializeTemarix() {
            console.log('Initializing Temarix V5 Portal 24...');
            console.log('Current state:', state);
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            state.journeyStarted = true;
            console.log('Journey started:', state.journeyStarted);
            
            console.log('Starting portal sequence in 1 second...');
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Temarix V5 Portal 24 DOM loaded');
            
            state.currentLanguage = getLanguageFromURL();
            
            updateStaticTranslations(state.currentLanguage);
            updateLanguageButtons(state.currentLanguage);
            
            await initializeFirebase();
            
            initializeTemarix();
        });
    </script>
</body>
</html>