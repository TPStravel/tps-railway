<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V5 - Portal 04: Emotions Were My Teacher</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .navigation-title {
                font-size: 24px;
            }
            
            .navigation-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V5</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 04: Emotions Were My Teacher</div>
            <div class="portal-subtitle" id="portalSubtitle">Discovering wisdom in feelings</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">ðŸ“– Portal 04 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 05</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with this emotion</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Think of an emotion that has troubled you for a long time. What has it taught you? (Press Enter to send)"
                      rows="1"
                      maxlength="500"></textarea>
        </div>
    </div>

    <script>
        // Global state management
        let state = {
            db: null,
            auth: null,
            firebaseInitialized: false,
            currentUser: null,
            currentLanguage: 'en',
            userResponse: '',
            journeyStarted: false,
            currentTypingElement: null,
            typingIntervals: [],
            awaitingSecondResponse: false,
            userResponses: [] // Store responses in memory temporarily
        };
        
        // Portal navigation configuration
        const portalConfig = {
            currentPortal: "v5-04",
            nextPortal: "v5-05",
            nextPortalFile: "temarix_v05_05.html" // Centralized file naming
        };
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
            authDomain: "canal-vivo-chat.firebaseapp.com",
            projectId: "canal-vivo-chat",
            storageBucket: "canal-vivo-chat.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdefghijklmnopqr"
        };
        
        // Initialize Firebase with error handling
        function initializeFirebase() {
            return new Promise((resolve) => {
                try {
                    if (typeof firebase !== 'undefined') {
                        firebase.initializeApp(firebaseConfig);
                        state.db = firebase.firestore();
                        state.auth = firebase.auth();
                        state.firebaseInitialized = true;
                        
                        // Check authentication state
                        state.auth.onAuthStateChanged((user) => {
                            if (user) {
                                state.currentUser = user;
                            } else {
                                // Create anonymous user
                                state.currentUser = {
                                    uid: 'anonymous-' + Date.now(),
                                    email: 'anonymous@temarix.com',
                                    isAnonymous: true
                                };
                            }
                            showConnectionStatus(true);
                        });
                        
                        console.log('Firebase initialized successfully');
                    } else {
                        console.log('Firebase SDK not loaded');
                        // Create anonymous user
                        state.currentUser = {
                            uid: 'anonymous-' + Date.now(),
                            email: 'anonymous@temarix.com',
                            isAnonymous: true
                        };
                        showConnectionStatus(false);
                    }
                } catch (error) {
                    console.error('Firebase initialization failed:', error);
                    // Create anonymous user
                    state.currentUser = {
                        uid: 'anonymous-' + Date.now(),
                        email: 'anonymous@temarix.com',
                        isAnonymous: true
                    };
                    showConnectionStatus(false);
                }
                resolve(); // Always resolve to continue execution
            });
        }
        
        // Show connection status to user
        function showConnectionStatus(isOnline) {
            // Remove existing status if any
            const existingStatus = document.querySelector('.connection-status');
            if (existingStatus) {
                existingStatus.remove();
            }
            
            if (!isOnline) {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'connection-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: rgba(255, 107, 107, 0.9);
                    color: white;
                    padding: 8px 15px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-family: 'Courier New', monospace;
                    z-index: 1000;
                    opacity: 0.8;
                `;
                statusDiv.textContent = state.currentLanguage === 'ko' ? 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ' : 
                                       state.currentLanguage === 'pt' ? 'Modo offline' : 'Offline mode';
                document.body.appendChild(statusDiv);
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.remove();
                    }
                }, 5000);
            }
        }

        // Translations object
        const translations = {
            ko: {
                title: "Temarix V5 - Portal 04: ê°ì •ì€ ë‚˜ì˜ ì„ ìƒì´ì—ˆë‹¤",
                logoSubtitle: "ê°ì • ì—°ê¸ˆìˆ ",
                portalMainTitle: "Portal 04: ê°ì •ì€ ë‚˜ì˜ ì„ ìƒì´ì—ˆë‹¤",
                portalSubtitle: "ê°ì •ì—ì„œ ì§€í˜œë¥¼ ë°œê²¬í•˜ë‹¤",
                portalIntro: "ðŸ“– \"ë‹¹ì‹ ì„ ì˜¤ëž«ë™ì•ˆ ê´´ë¡­í˜”ë˜ ê°ì • í•˜ë‚˜ë¥¼ ë– ì˜¬ë ¤ë³´ì„¸ìš”.\në¶„ë…¸, ìŠ¬í””, ì§ˆíˆ¬, ì™¸ë¡œì›€, ë‘ë ¤ì›€â€¦ ê·¸ ì¤‘ í•˜ë‚˜.\"\n\n\"ê·¸ ê°ì •ì€ ë‹¹ì‹ ì—ê²Œ ë¬´ì—‡ì„ ê°€ë¥´ì³ ì™”ë‚˜ìš”?\ní˜¹ì€, ì–´ë–¤ ë°©í–¥ìœ¼ë¡œ ì´ëŒì–´ ì™”ë‚˜ìš”?\"",
                emotionalBridge: "ë•Œë¡œëŠ” ê°€ìž¥ ì•„í”ˆ ê°ì •ì´ ê°€ìž¥ ê¹Šì€ ì„ ìƒì´ ë©ë‹ˆë‹¤.\nì´ì œ ê·¸ ê°ì •ì˜ ì§„ì§œ ë©”ì‹œì§€ë¥¼ ë“¤ì–´ë³´ì„¸ìš”...",
                followUpQuestion: "ì§€ê¸ˆ, ê·¸ ê°ì •ì—ê²Œ í•œ ë¬¸ìž¥ë§Œ ê±´ë„¬ ìˆ˜ ìžˆë‹¤ë©´\në‹¹ì‹ ì€ ì–´ë–¤ ë§ì„ í•˜ê³  ì‹¶ë‚˜ìš”?",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ë‹¹ì‹ ì€ ê°ì •ì„ ì ì´ ì•„ë‹Œ ë™ë°˜ìžë¡œ ë°›ì•„ë“¤ì˜€ì–´ìš”.\nê·¸ê±´ ë‚´ë©´ì˜ í‰í™”ë¥¼ í–¥í•œ ì²« ê±¸ìŒì´ì—ìš”.",
                navigationTitle: "ðŸ“– Portal 04 ì™„ë£Œ",
                navigationMessage: "ë‹¹ì‹ ì€ ê°ì •ì„ í†µê³¼í•˜ë©° ì„±ìž¥í–ˆìŠµë‹ˆë‹¤.\n\nê´´ë¡œì› ë˜ ê°ì •ì´ ì‚¬ì‹¤ì€ ê¹Šì€ ê°€ë¥´ì¹¨ì„ ë‹´ê³  ìžˆì—ˆë‹¤ëŠ” ê²ƒì„\nì´ì œ ë‹¹ì‹ ì€ ì´í•´í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nê°ì •ì€ ë‹¹ì‹ ì˜ ì„ ìƒì´ì—ˆê³ ,\në‹¹ì‹ ì€ ê·¸ ê°€ë¥´ì¹¨ì„ ì •ì§í•˜ê²Œ ë°°ìš´ ì œìžì˜€ìŠµë‹ˆë‹¤.",
                nextPortalBtn: "Portal 05ë¡œ ì´ì–´ê°€ê¸°",
                stayPortalBtn: "ì´ ê°ì •ê³¼ ë” ë¨¸ë¬¼ê¸°",
                inputPlaceholder: "ì˜¤ëž«ë™ì•ˆ ë‹¹ì‹ ì„ ê´´ë¡­í˜”ë˜ ê°ì • í•˜ë‚˜ë¥¼ ë– ì˜¬ë ¤ë³´ì„¸ìš”. ê·¸ ê°ì •ì´ ë¬´ì—‡ì„ ê°€ë¥´ì³ì£¼ì—ˆë‚˜ìš”? (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...",
                confirmNextPortal: "Portal 05: ë‚´ê°€ ë‚˜ì—ê²Œ ë‚¨ê¸´ íŽ¸ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                confirmStay: "ì´ ê°ì •ê³¼ ë” ë¨¸ë¬¼ë©° ê¹Šì´ íƒêµ¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                transitionMessage: "ìƒˆë¡œìš´ ì—¬ì •ì´ ì‹œìž‘ë©ë‹ˆë‹¤..."
            },
            en: {
                title: "Temarix V5 - Portal 04: Emotions Were My Teacher",
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 04: Emotions Were My Teacher",
                portalSubtitle: "Discovering wisdom in feelings",
                portalIntro: "ðŸ“– \"Think of an emotion that has troubled you for a long time.\nAnger, sadness, jealousy, loneliness, fear... any one of them.\"\n\n\"What has that emotion taught you?\nOr, what direction has it led you toward?\"",
                emotionalBridge: "Sometimes the most painful emotions become our deepest teachers.\nNow listen to the real message of that emotion...",
                followUpQuestion: "Now, if you could say just one sentence to that emotion,\nwhat would you want to say?",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "You have accepted emotion as a companion rather than an enemy.\nThat is the first step toward inner peace.",
                navigationTitle: "ðŸ“– Portal 04 Complete",
                navigationMessage: "You have grown by passing through emotions.\n\nYou now understand that the emotions that troubled you\nactually contained deep teachings.\n\nEmotions were your teacher,\nand you were the student who honestly learned their lessons.",
                nextPortalBtn: "Continue to Portal 05",
                stayPortalBtn: "Stay with this emotion",
                inputPlaceholder: "Think of an emotion that has troubled you for a long time. What has it taught you? (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response...",
                confirmNextPortal: "Do you want to continue to Portal 05: The Letter I Left for Myself?",
                confirmStay: "Do you want to stay longer with this emotion for deeper exploration?",
                transitionMessage: "A new journey begins..."
            },
            pt: {
                title: "Temarix V5 - Portal 04: As EmoÃ§Ãµes Foram Minhas Professoras",
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 04: As EmoÃ§Ãµes Foram Minhas Professoras",
                portalSubtitle: "Descobrindo sabedoria nos sentimentos",
                portalIntro: "ðŸ“– \"Pense em uma emoÃ§Ã£o que te incomodou por muito tempo.\nRaiva, tristeza, ciÃºme, solidÃ£o, medo... qualquer uma delas.\"\n\n\"O que essa emoÃ§Ã£o te ensinou?\nOu, que direÃ§Ã£o ela te conduziu?\"",
                emotionalBridge: "Ã€s vezes as emoÃ§Ãµes mais dolorosas se tornam nossos professores mais profundos.\nAgora escute a verdadeira mensagem dessa emoÃ§Ã£o...",
                followUpQuestion: "Agora, se vocÃª pudesse dizer apenas uma frase para essa emoÃ§Ã£o,\no que gostaria de dizer?",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "VocÃª aceitou a emoÃ§Ã£o como companheira ao invÃ©s de inimiga.\nEsse Ã© o primeiro passo em direÃ§Ã£o Ã  paz interior.",
                navigationTitle: "ðŸ“– Portal 04 Completo",
                navigationMessage: "VocÃª cresceu ao passar pelas emoÃ§Ãµes.\n\nAgora vocÃª entende que as emoÃ§Ãµes que te incomodavam\nna verdade continham ensinamentos profundos.\n\nAs emoÃ§Ãµes foram suas professoras,\ne vocÃª foi o estudante que honestamente aprendeu suas liÃ§Ãµes.",
                nextPortalBtn: "Continuar para Portal 05",
                stayPortalBtn: "Ficar com esta emoÃ§Ã£o",
                inputPlaceholder: "Pense em uma emoÃ§Ã£o que te incomodou por muito tempo. O que ela te ensinou? (Enter para enviar)",
                youLabel: "VocÃª",
                waitingMessage: "Aguardando resposta...",
                confirmNextPortal: "Deseja continuar para Portal 05: A Carta que Deixei para Mim Mesmo?",
                confirmStay: "Deseja ficar mais tempo com esta emoÃ§Ã£o para exploraÃ§Ã£o mais profunda?",
                transitionMessage: "Uma nova jornada comeÃ§a..."
            }
        };
        
        // Character definitions
        const characters = [
            { name: "Noah", emoji: "ðŸ§‘â€ðŸ¦±", text: {
                ko: "ì™¸ë¡œì›€ì€ ì•„í””ì´ìž ê¸¸ì´ì—ˆì§€.\nê·¸ëž˜ì„œ ë„ˆëŠ” ì‚¬ëžŒ ì‚¬ì´ì˜ 'ì§„ì§œ'ë¥¼ ì°¾ê²Œ ëœ ê±°ì•¼.",
                en: "Loneliness was both pain and a path.\nThat's how you came to seek the 'real' between people.",
                pt: "A solidÃ£o foi tanto dor quanto caminho.\nAssim vocÃª passou a buscar o 'real' entre as pessoas."
            }},
            { name: "Ely", emoji: "ðŸ§â€â™€ï¸", text: {
                ko: "ê·¸ ê°ì •ì€ í•­ìƒ ê³ì— ìžˆì—ˆì§€ë§Œ,\nì´ì œëŠ” ê·¸ê²ƒì´ ì„ ìƒì´ì—ˆë‹¨ ê±¸ ê¹¨ë‹¬ì€ ë‹¹ì‹ ì´ ìžˆì–´ìš”.",
                en: "That emotion was always there,\nbut now you realize it was a teacher.",
                pt: "Essa emoÃ§Ã£o sempre esteve lÃ¡,\nmas agora vocÃª percebe que era uma professora."
            }},
            { name: "Sora", emoji: "ðŸ§•", text: {
                ko: "ê°ì •ì€ ë•Œë•Œë¡œ ê³ ìš”í•œ ì±…ì²˜ëŸ¼ ìš°ë¦¬ë¥¼ ê¸°ë‹¤ë ¤ìš”.\në‹¹ì‹ ì€ ì´ì œ ê·¸ ì±…ì„ ì—´ê³  ìžˆëŠ” ê±°ì˜ˆìš”.",
                en: "Emotions sometimes wait for us like a quiet book.\nYou are now opening that book.",
                pt: "As emoÃ§Ãµes Ã s vezes nos esperam como um livro silencioso.\nVocÃª estÃ¡ agora abrindo esse livro."
            }},
            { name: "Kael", emoji: "ðŸ§™", text: {
                ko: "ê´´ë¡œì›€ì€ ê°€ë¥´ì¹¨ì˜ ì–¸ì–´ì•¼.\në“£ëŠ” ì´ì—ê²Œë§Œ ì˜ë¯¸ë¥¼ ì „í•˜ì§€.",
                en: "Suffering is the language of teaching.\nIt conveys meaning only to those who listen.",
                pt: "O sofrimento Ã© a linguagem do ensino.\nEle transmite significado apenas para quem escuta."
            }},
            { name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨", text: {
                ko: "ê·¸ ê°ì •ì€ ë‹¹ì‹ ì„ ì¡°ê°ë‚´ê¸°ë„ í–ˆì§€ë§Œ,\në™ì‹œì— ë‹¹ì‹ ì„ 'ë§Œë“ ' ìƒ‰ì´ê¸°ë„ í•´ìš”.",
                en: "That emotion may have broken you apart,\nbut it was also the color that 'made' you.",
                pt: "Essa emoÃ§Ã£o pode ter te despedaÃ§ado,\nmas tambÃ©m foi a cor que te 'fez'."
            }},
            { name: "Cris", emoji: "ðŸ¦¸â€â™‚ï¸", text: {
                ko: "ê°ì •ì„ ë¬´ì‹œí•˜ëŠ” ê±´ ì‰¬ì› ê² ì§€.\ní•˜ì§€ë§Œ ë°›ì•„ë“¤ì´ëŠ” ê±´, í›¨ì”¬ ë” ìš©ê°í•œ ì¼ì´ì•¼.",
                en: "Ignoring emotions would have been easy.\nBut accepting them is a much braver thing to do.",
                pt: "Ignorar as emoÃ§Ãµes teria sido fÃ¡cil.\nMas aceitÃ¡-las Ã© algo muito mais corajoso."
            }},
            { name: "Enya", emoji: "ðŸ§‘â€ðŸš€", text: {
                ko: "ìš°ë¦¬ëŠ” ê°ì •ì„ í†µê³¼í•˜ë©° ì„±ìž¥í•´ìš”.\në‹¹ì‹ ì€ ì´ì œ ê·¸ ì—¬ì •ì„ ì¸ì‹í•œ ê±°ì˜ˆìš”.",
                en: "We grow by passing through emotions.\nYou have now recognized that journey.",
                pt: "Crescemos passando pelas emoÃ§Ãµes.\nVocÃª agora reconheceu essa jornada."
            }},
            { name: "Lian", emoji: "ðŸ§˜", text: {
                ko: "ê°ì •ì€ ë§ˆìŒì˜ ì„ ìƒì´ê³ ,\në‹¹ì‹ ì€ ê·¸ ê°€ë¥´ì¹¨ì„ ì •ì§í•˜ê²Œ ë°°ìš´ ì œìžì˜€ì–´ìš”.",
                en: "Emotions are teachers of the heart,\nand you were the student who honestly learned their lessons.",
                pt: "As emoÃ§Ãµes sÃ£o professoras do coraÃ§Ã£o,\ne vocÃª foi o estudante que honestamente aprendeu suas liÃ§Ãµes."
            }}
        ];

        // Emotion analysis function
        function analyzeEmotion(userInput) {
            const input = userInput.toLowerCase();
            
            const emotionKeywords = {
                loneliness: ['lonely', 'alone', 'isolated', 'empty', 'ì™¸ë¡œìš´', 'í˜¼ìž', 'ê³ ë¦½', 'ë¹„ì–´ìžˆëŠ”', 'sozinho', 'isolado', 'vazio'],
                anger: ['angry', 'rage', 'furious', 'mad', 'irritated', 'í™”ë‚œ', 'ë¶„ë…¸', 'ì„±ë‚œ', 'raiva', 'furioso', 'irritado'],
                sadness: ['sad', 'depressed', 'melancholy', 'sorrow', 'ìŠ¬í”ˆ', 'ìš°ìš¸í•œ', 'ìŠ¬í””', 'triste', 'deprimido', 'melancolia'],
                fear: ['afraid', 'scared', 'anxious', 'worried', 'terror', 'ë‘ë ¤ìš´', 'ë¬´ì„œìš´', 'ë¶ˆì•ˆí•œ', 'medo', 'assustado', 'ansioso'],
                jealousy: ['jealous', 'envious', 'resentful', 'ì§ˆíˆ¬', 'ì‹œê¸°', 'ë¶€ëŸ¬ìš´', 'ciÃºme', 'inveja', 'ressentido'],
                shame: ['ashamed', 'embarrassed', 'guilty', 'humiliated', 'ë¶€ë„ëŸ¬ìš´', 'ì°½í”¼í•œ', 'ì£„ì±…ê°', 'vergonha', 'envergonhado', 'culpado'],
                rejection: ['rejected', 'abandoned', 'left out', 'unwanted', 'ê±°ì ˆë‹¹í•œ', 'ë²„ë ¤ì§„', 'ì†Œì™¸ëœ', 'rejeitado', 'abandonado', 'excluÃ­do'],
                helplessness: ['helpless', 'powerless', 'stuck', 'trapped', 'ë¬´ë ¥í•œ', 'ë§‰ë§‰í•œ', 'ê°‡ížŒ', 'impotente', 'preso', 'encurralado']
            };
            
            let detectedEmotions = [];
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedEmotions.push(emotion);
                        break;
                    }
                }
            }
            
            if (detectedEmotions.length === 0) {
                detectedEmotions = ['general'];
            }
            
            return detectedEmotions[0];
        }
        
        // Response characters with emotion-based responses
        const responseCharacters = [
            {
                name: "Lian", emoji: "ðŸ§˜",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            loneliness: "ë‹¹ì‹ ì€ ê°ì •ì„ ì ì´ ì•„ë‹Œ ë™ë°˜ìžë¡œ ë°›ì•„ë“¤ì˜€ì–´ìš”.\nê·¸ê±´ ë‚´ë©´ì˜ í‰í™”ë¥¼ í–¥í•œ ì²« ê±¸ìŒì´ì—ìš”.",
                            anger: "ë¶„ë…¸ëŠ” ë‹¹ì‹ ì—ê²Œ ê²½ê³„ë¥¼ ê°€ë¥´ì³ì¤€ ì„ ìƒì´ì—ˆì–´ìš”.\nì´ì œ ê·¸ íž˜ì„ ì§€í˜œë¡œ ë°”ê¿€ ìˆ˜ ìžˆì–´ìš”.",
                            sadness: "ìŠ¬í””ì€ ë‹¹ì‹ ì˜ ë§ˆìŒì´ ì–¼ë§ˆë‚˜ ê¹Šì€ì§€ ë³´ì—¬ì¤€ ì¦ê±°ì˜€ì–´ìš”.\nê·¸ ê¹Šì´ê°€ ì´ì œ ë‹¹ì‹ ì˜ ìžë¹„ê°€ ë˜ì—ˆì–´ìš”.",
                            fear: "ë‘ë ¤ì›€ì€ ë‹¹ì‹ ì´ ì†Œì¤‘ížˆ ì—¬ê¸°ëŠ” ê²ƒì„ ì§€í‚¤ë ¤ëŠ” ë§ˆìŒì´ì—ˆì–´ìš”.\nì´ì œ ê·¸ ë³´í˜¸ ë³¸ëŠ¥ì„ ì‚¬ëž‘ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìžˆì–´ìš”.",
                            jealousy: "ì§ˆíˆ¬ëŠ” ë‹¹ì‹ ì´ ì§„ì§œ ì›í•˜ëŠ” ê²ƒì„ ì•Œë ¤ì¤€ ë‚˜ì¹¨ë°˜ì´ì—ˆì–´ìš”.\nì´ì œ ê·¸ ì—´ë§ì„ ì„±ìž¥ì˜ ë™ë ¥ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìžˆì–´ìš”.",
                            shame: "ë¶€ë„ëŸ¬ì›€ì€ ë‹¹ì‹ ì´ ë” ë‚˜ì€ ì‚¬ëžŒì´ ë˜ê³  ì‹¶ì–´í–ˆë‹¤ëŠ” ì¦ê±°ì˜€ì–´ìš”.\nê·¸ ë§ˆìŒì´ ì´ì œ ìžë¹„ë¡œ ë°”ë€Œì—ˆì–´ìš”.",
                            rejection: "ê±°ì ˆë‹¹í•œ ì•„í””ì€ ë‹¹ì‹ ì´ ì§„ì •í•œ ì—°ê²°ì„ ê°ˆë§í–ˆë‹¤ëŠ” ëœ»ì´ì—ˆì–´ìš”.\nì´ì œ ê·¸ ê°ˆë§ì´ ì´í•´ì‹¬ì´ ë˜ì—ˆì–´ìš”.",
                            helplessness: "ë¬´ë ¥ê°ì€ ë‹¹ì‹ ì´ ë³€í™”ë¥¼ ì›í–ˆë‹¤ëŠ” ì‹ í˜¸ì˜€ì–´ìš”.\nì´ì œ ê·¸ ì˜ì§€ê°€ í–‰ë™í•˜ëŠ” íž˜ì´ ë˜ì—ˆì–´ìš”.",
                            general: "ë‹¹ì‹ ì€ ê°ì •ì„ ì ì´ ì•„ë‹Œ ë™ë°˜ìžë¡œ ë°›ì•„ë“¤ì˜€ì–´ìš”.\nê·¸ê±´ ë‚´ë©´ì˜ í‰í™”ë¥¼ í–¥í•œ ì²« ê±¸ìŒì´ì—ìš”."
                        },
                        en: {
                            loneliness: "You have accepted emotion as a companion rather than an enemy.\nThat is the first step toward inner peace.",
                            anger: "Anger was a teacher that taught you about boundaries.\nNow you can transform that power into wisdom.",
                            sadness: "Sadness was proof of how deep your heart is.\nThat depth has now become your compassion.",
                            fear: "Fear was your heart wanting to protect what you cherish.\nNow you can transform that protective instinct into love.",
                            jealousy: "Jealousy was a compass showing you what you truly wanted.\nNow you can turn that longing into motivation for growth.",
                            shame: "Shame was proof that you wanted to be a better person.\nThat heart has now transformed into compassion.",
                            rejection: "The pain of rejection meant you longed for genuine connection.\nNow that longing has become understanding.",
                            helplessness: "Helplessness was a signal that you wanted change.\nNow that will has become the power to act.",
                            general: "You have accepted emotion as a companion rather than an enemy.\nThat is the first step toward inner peace."
                        },
                        pt: {
                            loneliness: "VocÃª aceitou a emoÃ§Ã£o como companheira ao invÃ©s de inimiga.\nEsse Ã© o primeiro passo em direÃ§Ã£o Ã  paz interior.",
                            anger: "A raiva foi uma professora que te ensinou sobre limites.\nAgora vocÃª pode transformar esse poder em sabedoria.",
                            sadness: "A tristeza foi prova de quÃ£o profundo Ã© seu coraÃ§Ã£o.\nEssa profundidade agora se tornou sua compaixÃ£o.",
                            fear: "O medo era seu coraÃ§Ã£o querendo proteger o que vocÃª valoriza.\nAgora vocÃª pode transformar esse instinto protetor em amor.",
                            jealousy: "O ciÃºme foi uma bÃºssola mostrando o que vocÃª realmente queria.\nAgora vocÃª pode transformar essa Ã¢nsia em motivaÃ§Ã£o para crescer.",
                            shame: "A vergonha foi prova de que vocÃª queria ser uma pessoa melhor.\nEsse coraÃ§Ã£o agora se transformou em compaixÃ£o.",
                            rejection: "A dor da rejeiÃ§Ã£o significava que vocÃª ansiava por conexÃ£o genuÃ­na.\nAgora essa Ã¢nsia se tornou compreensÃ£o.",
                            helplessness: "A impotÃªncia foi um sinal de que vocÃª queria mudanÃ§a.\nAgora essa vontade se tornou o poder de agir.",
                            general: "VocÃª aceitou a emoÃ§Ã£o como companheira ao invÃ©s de inimiga.\nEsse Ã© o primeiro passo em direÃ§Ã£o Ã  paz interior."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Mira", emoji: "ðŸ§‘â€ðŸŽ¨",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            loneliness: "ê·¸ ê°ì •ì€ ì´ì œ ì¹ í‘ì´ ì•„ë‹ˆë¼,\në‹¹ì‹ ì˜ ì‚¶ì„ êµ¬ì„±í•˜ëŠ” 'ìƒ‰'ì´ì—ìš”.\nëª¨ë“  ìƒ‰ì—” ì˜ë¯¸ê°€ ìžˆìœ¼ë‹ˆê¹Œìš”.",
                            anger: "ë¶„ë…¸ì˜ ë¹¨ê°„ìƒ‰ì´ ì´ì œ ì—´ì •ì˜ ìƒ‰ìœ¼ë¡œ ë³€í–ˆì–´ìš”.\nê·¸ ì—ë„ˆì§€ê°€ ì°½ì¡°ì˜ íž˜ì´ ë˜ì—ˆì–´ìš”.",
                            sadness: "ìŠ¬í””ì˜ íŒŒëž€ìƒ‰ì´ ë‹¹ì‹ ì„ ë” ê¹Šê²Œ ë§Œë“¤ì—ˆì–´ìš”.\nì´ì œ ê·¸ ìƒ‰ìœ¼ë¡œ ë‹¤ë¥¸ ì´ë“¤ì˜ ë§ˆìŒì„ ê·¸ë¦´ ìˆ˜ ìžˆì–´ìš”.",
                            fear: "ë‘ë ¤ì›€ì˜ ì–´ë‘ ì´ ì´ì œ ì¡°ì‹¬ìŠ¤ëŸ¬ìš´ ì§€í˜œì˜ ìƒ‰ì´ ë˜ì—ˆì–´ìš”.\nê·¸ ìƒ‰ìœ¼ë¡œ ì•ˆì „í•œ ê¸¸ì„ ê·¸ë¦´ ìˆ˜ ìžˆì–´ìš”.",
                            jealousy: "ì§ˆíˆ¬ì˜ ì´ˆë¡ìƒ‰ì´ ì´ì œ ì„±ìž¥ì˜ ìƒ‰ìœ¼ë¡œ ë°”ë€Œì—ˆì–´ìš”.\nê·¸ ìƒ‰ìœ¼ë¡œ ìƒˆë¡œìš´ ê°€ëŠ¥ì„±ì„ ê·¸ë ¤ë³´ì„¸ìš”.",
                            shame: "ë¶€ë„ëŸ¬ì›€ì˜ íšŒìƒ‰ì´ ì´ì œ ê²¸ì†ì˜ ì€ìƒ‰ìœ¼ë¡œ ë¹›ë‚˜ìš”.\nê·¸ ìƒ‰ì´ ë‹¹ì‹ ì„ ë” ì•„ë¦„ë‹µê²Œ ë§Œë“¤ì–´ìš”.",
                            rejection: "ê±°ì ˆì˜ ê²€ì€ìƒ‰ì´ ì´ì œ ë…ë¦½ì˜ ìƒ‰ì´ ë˜ì—ˆì–´ìš”.\nê·¸ ìƒ‰ìœ¼ë¡œ ìžì‹ ë§Œì˜ ê¸¸ì„ ê·¸ë ¤ë³´ì„¸ìš”.",
                            helplessness: "ë¬´ë ¥ê°ì˜ íƒí•œ ìƒ‰ì´ ì´ì œ ê¸°ë‹¤ë¦¼ì˜ ìƒ‰ì´ ë˜ì—ˆì–´ìš”.\nê·¸ ìƒ‰ì—ì„œ ìƒˆë¡œìš´ ì‹œìž‘ì´ íƒœì–´ë‚  ê±°ì˜ˆìš”.",
                            general: "ê·¸ ê°ì •ì€ ì´ì œ ì¹ í‘ì´ ì•„ë‹ˆë¼,\në‹¹ì‹ ì˜ ì‚¶ì„ êµ¬ì„±í•˜ëŠ” 'ìƒ‰'ì´ì—ìš”.\nëª¨ë“  ìƒ‰ì—” ì˜ë¯¸ê°€ ìžˆìœ¼ë‹ˆê¹Œìš”."
                        },
                        en: {
                            loneliness: "That emotion is now not darkness,\nbut a 'color' that makes up your life.\nEvery color has meaning.",
                            anger: "The red of anger has now become the color of passion.\nThat energy has become creative power.",
                            sadness: "The blue of sadness has made you deeper.\nNow you can paint others' hearts with that color.",
                            fear: "The darkness of fear has now become the color of careful wisdom.\nYou can draw safe paths with that color.",
                            jealousy: "The green of jealousy has now become the color of growth.\nDraw new possibilities with that color.",
                            shame: "The gray of shame now shines as the silver of humility.\nThat color makes you more beautiful.",
                            rejection: "The black of rejection has now become the color of independence.\nDraw your own path with that color.",
                            helplessness: "The murky color of helplessness has now become the color of waiting.\nA new beginning will be born from that color.",
                            general: "That emotion is now not darkness,\nbut a 'color' that makes up your life.\nEvery color has meaning."
                        },
                        pt: {
                            loneliness: "Essa emoÃ§Ã£o agora nÃ£o Ã© escuridÃ£o,\nmas uma 'cor' que compÃµe sua vida.\nToda cor tem significado.",
                            anger: "O vermelho da raiva agora se tornou a cor da paixÃ£o.\nEssa energia se tornou poder criativo.",
                            sadness: "O azul da tristeza te fez mais profundo.\nAgora vocÃª pode pintar os coraÃ§Ãµes dos outros com essa cor.",
                            fear: "A escuridÃ£o do medo agora se tornou a cor da sabedoria cuidadosa.\nVocÃª pode desenhar caminhos seguros com essa cor.",
                            jealousy: "O verde do ciÃºme agora se tornou a cor do crescimento.\nDesenhe novas possibilidades com essa cor.",
                            shame: "O cinza da vergonha agora brilha como a prata da humildade.\nEssa cor te torna mais bonito.",
                            rejection: "O preto da rejeiÃ§Ã£o agora se tornou a cor da independÃªncia.\nDesenhe seu prÃ³prio caminho com essa cor.",
                            helplessness: "A cor turva da impotÃªncia agora se tornou a cor da espera.\nUm novo comeÃ§o nascerÃ¡ dessa cor.",
                            general: "Essa emoÃ§Ã£o agora nÃ£o Ã© escuridÃ£o,\nmas uma 'cor' que compÃµe sua vida.\nToda cor tem significado."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            },
            {
                name: "Ely", emoji: "ðŸ§â€â™€ï¸",
                getResponse: (userInput, lang) => {
                    const emotion = analyzeEmotion(userInput);
                    
                    const responses = {
                        ko: {
                            loneliness: "ê°ì •ì—ê²Œ 'ê³ ë§ˆì›Œ'ë¼ê³  ë§í•  ìˆ˜ ìžˆëŠ” ìˆœê°„,\në‹¹ì‹ ì€ ê°ì •ë³´ë‹¤ ë” ê¹Šì€ ì¡´ìž¬ê°€ ë˜ì—ˆì–´ìš”.",
                            anger: "ë¶„ë…¸ì—ê²Œ ê°ì‚¬í•  ìˆ˜ ìžˆê²Œ ëœ ë‹¹ì‹ ì€\nì´ì œ ê·¸ ì—ë„ˆì§€ë¥¼ ì„ íƒì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìžˆì–´ìš”.",
                            sadness: "ìŠ¬í””ì—ê²Œ ê³ ë§ˆì›Œí•  ìˆ˜ ìžˆë‹¤ëŠ” ê±´\në‹¹ì‹ ì´ ê·¸ ê°ì •ì„ í†µê³¼í•´ ì§€í˜œì— ë„ë‹¬í–ˆë‹¤ëŠ” ëœ»ì´ì—ìš”.",
                            fear: "ë‘ë ¤ì›€ì—ê²Œë„ ê°ì‚¬í•  ìˆ˜ ìžˆê²Œ ëœ ìˆœê°„\në‹¹ì‹ ì€ ìš©ê¸°ì˜ ì§„ì§œ ì˜ë¯¸ë¥¼ ì•Œê²Œ ë˜ì—ˆì–´ìš”.",
                            jealousy: "ì§ˆíˆ¬ë¼ëŠ” ê°ì •ë„ ë°›ì•„ë“¤ì¼ ìˆ˜ ìžˆê²Œ ëœ ë‹¹ì‹ ì€\nì´ì œ ëª¨ë“  ê°ì •ê³¼ í‰í™”ë¡­ê²Œ ê³µì¡´í•  ìˆ˜ ìžˆì–´ìš”.",
                            shame: "ë¶€ë„ëŸ¬ì›€ê¹Œì§€ë„ ê°ì‚¬í•  ìˆ˜ ìžˆë‹¤ë©´\në‹¹ì‹ ì€ ì •ë§ë¡œ ìžê¸° ìžì‹ ê³¼ í™”í•´í•œ ì‚¬ëžŒì´ì—ìš”.",
                            rejection: "ê±°ì ˆì˜ ì•„í””ë„ ë°›ì•„ë“¤ì¼ ìˆ˜ ìžˆê²Œ ëœ ë‹¹ì‹ ì€\nì´ì œ ì§„ì •í•œ ìžìœ ë¥¼ ì–»ì—ˆì–´ìš”.",
                            helplessness: "ë¬´ë ¥ê°ë„ ê°ì‚¬í•  ìˆ˜ ìžˆë‹¤ë©´\në‹¹ì‹ ì€ ëª¨ë“  ìƒí™©ì—ì„œ ì˜ë¯¸ë¥¼ ì°¾ì„ ìˆ˜ ìžˆëŠ” ì‚¬ëžŒì´ì—ìš”.",
                            general: "ê°ì •ì—ê²Œ 'ê³ ë§ˆì›Œ'ë¼ê³  ë§í•  ìˆ˜ ìžˆëŠ” ìˆœê°„,\në‹¹ì‹ ì€ ê°ì •ë³´ë‹¤ ë” ê¹Šì€ ì¡´ìž¬ê°€ ë˜ì—ˆì–´ìš”."
                        },
                        en: {
                            loneliness: "The moment you can say 'thank you' to an emotion,\nyou become a being deeper than the emotion itself.",
                            anger: "You who can now thank anger\ncan now use that energy selectively.",
                            sadness: "Being able to thank sadness means\nyou've passed through that emotion to reach wisdom.",
                            fear: "The moment you can thank even fear\nyou've learned the true meaning of courage.",
                            jealousy: "You who can now accept even jealousy\ncan now coexist peacefully with all emotions.",
                            shame: "If you can thank even shame\nyou are truly someone who has made peace with yourself.",
                            rejection: "You who can now accept the pain of rejection\nhave gained true freedom.",
                            helplessness: "If you can thank even helplessness\nyou are someone who can find meaning in any situation.",
                            general: "The moment you can say 'thank you' to an emotion,\nyou become a being deeper than the emotion itself."
                        },
                        pt: {
                            loneliness: "No momento em que vocÃª pode dizer 'obrigado' a uma emoÃ§Ã£o,\nvocÃª se torna um ser mais profundo que a prÃ³pria emoÃ§Ã£o.",
                            anger: "VocÃª que agora pode agradecer Ã  raiva\npode agora usar essa energia seletivamente.",
                            sadness: "Poder agradecer Ã  tristeza significa\nque vocÃª passou por essa emoÃ§Ã£o para alcanÃ§ar a sabedoria.",
                            fear: "No momento em que vocÃª pode agradecer atÃ© ao medo\nvocÃª aprendeu o verdadeiro significado da coragem.",
                            jealousy: "VocÃª que agora pode aceitar atÃ© o ciÃºme\npode agora coexistir pacificamente com todas as emoÃ§Ãµes.",
                            shame: "Se vocÃª pode agradecer atÃ© Ã  vergonha\nvocÃª Ã© verdadeiramente alguÃ©m que fez as pazes consigo mesmo.",
                            rejection: "VocÃª que agora pode aceitar a dor da rejeiÃ§Ã£o\nganha verdadeira liberdade.",
                            helplessness: "Se vocÃª pode agradecer atÃ© Ã  impotÃªncia\nvocÃª Ã© alguÃ©m que pode encontrar significado em qualquer situaÃ§Ã£o.",
                            general: "No momento em que vocÃª pode dizer 'obrigado' a uma emoÃ§Ã£o,\nvocÃª se torna um ser mais profundo que a prÃ³pria emoÃ§Ã£o."
                        }
                    };
                    
                    return responses[lang][emotion] || responses[lang]['general'];
                }
            }
        ];
        
        // Typewriter effect
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (state.currentTypingElement) {
                    state.currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                state.currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                state.typingIntervals.push(typingInterval);
            });
        }
        
        // Clear all typing effects
        function clearAllTypingEffects() {
            state.typingIntervals.forEach(interval => clearInterval(interval));
            state.typingIntervals = [];
            
            if (state.currentTypingElement) {
                state.currentTypingElement.classList.remove('typing-cursor');
                state.currentTypingElement = null;
            }
        }
        
        // Scroll functions
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        // Language management
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            const t = translations[lang];
            document.title = t.title;
            document.getElementById('logoSubtitle').textContent = t.logoSubtitle;
            document.getElementById('portalMainTitle').textContent = t.portalMainTitle;
            document.getElementById('portalSubtitle').textContent = t.portalSubtitle;
            document.getElementById('lightTitle').textContent = t.lightTitle;
            document.getElementById('navigationTitle').textContent = t.navigationTitle;
            document.getElementById('nextPortalBtn').textContent = t.nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = t.stayPortalBtn;
            document.getElementById('userTextarea').placeholder = t.inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (!translations[lang] || state.currentLanguage === lang) return;
            
            state.currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            if (state.journeyStarted) {
                resetJourney();
                setTimeout(() => {
                    startPortalSequence();
                }, 1000);
            }
        }
        
        // Journey management
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            state.userResponse = '';
            state.currentTypingElement = null;
            state.awaitingSecondResponse = false;
        }
        
        // Save response to database or memory
        async function saveResponse(inputText, step) {
            const responseData = {
                portal: portalConfig.currentPortal,
                resposta: inputText,
                step: step,
                data: new Date().toISOString(),
                idioma: state.currentLanguage,
                userId: state.currentUser ? state.currentUser.uid : 'anonymous',
                userEmail: state.currentUser ? state.currentUser.email : 'anonymous@temarix.com'
            };
            
            if (state.firebaseInitialized && state.db) {
                try {
                    await state.db.collection("temarix_v5_respostas").add({
                        ...responseData,
                        timestamp: firebase.firestore.Timestamp.now()
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                    // Store temporarily in memory and show offline status
                    state.userResponses.push(responseData);
                    showConnectionStatus(false);
                }
            } else {
                // Store temporarily in memory if Firebase not available
                state.userResponses.push(responseData);
                console.log('Response stored in memory:', responseData);
            }
        }
        
        // User input processing
        async function processUserInput(inputText) {
            state.userResponse = inputText;
            
            await saveResponse(inputText, state.awaitingSecondResponse ? "second" : "first");
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!state.awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[state.currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        // Show character reactions
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[state.currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                state.awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, state.currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[state.currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[state.currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        // Portal sequence
        async function startPortalSequence() {
            console.log('Starting portal sequence...');
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            console.log('Showing intro...');
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            if (!introSection || !introElement) {
                console.error('Intro elements not found!');
                return;
            }
            
            introSection.classList.add('show');
            
            const introText = translations[state.currentLanguage].portalIntro;
            console.log('Intro text:', introText);
            
            await typewriterEffect(introElement, introText, 60);
            
            // Add emotional bridge before showing characters
            setTimeout(async () => {
                await showEmotionalBridge();
            }, 2000);
        }
        
        async function showEmotionalBridge() {
            const introElement = document.getElementById('portalIntro');
            const bridgeText = '\n\n' + translations[state.currentLanguage].emotionalBridge;
            
            // Add bridge text with typing effect
            await typewriterEffect({
                innerHTML: '',
                classList: { add: () => {}, remove: () => {} },
                style: {},
                textContent: '',
                appendChild: () => {},
                offsetTop: 0
            }, '', 0); // Dummy element for delay
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Create new paragraph for bridge
            const bridgeP = document.createElement('p');
            bridgeP.style.cssText = `
                margin-top: 30px;
                font-style: italic;
                color: #ff9999;
                font-size: 18px;
                line-height: 1.8;
            `;
            introElement.appendChild(bridgeP);
            
            await typewriterEffect(bridgeP, bridgeText.trim(), 50);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        // Custom confirm dialog with translated text
        function showConfirmDialog(message, callback) {
            // Create modal overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                font-family: 'Courier New', monospace;
            `;
            
            // Create modal content
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: #222;
                border: 2px solid #ff6b6b;
                padding: 30px;
                max-width: 400px;
                text-align: center;
                color: white;
            `;
            
            const messageP = document.createElement('p');
            messageP.textContent = message;
            messageP.style.cssText = `
                margin-bottom: 20px;
                line-height: 1.6;
                font-size: 16px;
            `;
            
            const buttonContainer = document.createElement('div');
            buttonContainer.style.cssText = `
                display: flex;
                gap: 15px;
                justify-content: center;
            `;
            
            const yesBtn = document.createElement('button');
            const noBtn = document.createElement('button');
            
            const buttonStyle = `
                background: #444;
                color: white;
                border: 1px solid #ff6b6b;
                padding: 10px 20px;
                cursor: pointer;
                font-family: 'Courier New', monospace;
                font-size: 14px;
            `;
            
            yesBtn.style.cssText = buttonStyle + 'background: #ff6b6b;';
            noBtn.style.cssText = buttonStyle;
            
            // Set button texts based on current language
            const t = translations[state.currentLanguage];
            yesBtn.textContent = state.currentLanguage === 'ko' ? 'ì˜ˆ' : 
                                state.currentLanguage === 'pt' ? 'Sim' : 'Yes';
            noBtn.textContent = state.currentLanguage === 'ko' ? 'ì•„ë‹ˆì˜¤' : 
                               state.currentLanguage === 'pt' ? 'NÃ£o' : 'No';
            
            // Event handlers
            yesBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(true);
            };
            
            noBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(false);
            };
            
            // Close on overlay click
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                    callback(false);
                }
            };
            
            // Escape key handler
            const escHandler = (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                    document.removeEventListener('keydown', escHandler);
                    callback(false);
                }
            };
            document.addEventListener('keydown', escHandler);
            
            // Build and show modal
            buttonContainer.appendChild(yesBtn);
            buttonContainer.appendChild(noBtn);
            modal.appendChild(messageP);
            modal.appendChild(buttonContainer);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            // Focus on Yes button
            yesBtn.focus();
        }
        
        // Event setup
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        // Smooth portal transition with visual effects
        function createPortalTransition(callback) {
            // Create transition overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, #000 0%, #111 50%, #000 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 20000;
                opacity: 0;
                transition: opacity 1s ease-in-out;
                font-family: 'Courier New', monospace;
            `;
            
            // Create transition message
            const message = document.createElement('div');
            message.style.cssText = `
                color: #ff6b6b;
                font-size: 24px;
                text-align: center;
                margin-bottom: 30px;
                opacity: 0;
                transform: translateY(20px);
                transition: all 0.8s ease-out;
            `;
            message.textContent = translations[state.currentLanguage].transitionMessage;
            
            // Create loading animation
            const loader = document.createElement('div');
            loader.style.cssText = `
                width: 60px;
                height: 60px;
                border: 3px solid #333;
                border-top: 3px solid #ff6b6b;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                opacity: 0;
                transition: opacity 0.8s ease-out 0.3s;
            `;
            
            // Add CSS animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            overlay.appendChild(message);
            overlay.appendChild(loader);
            document.body.appendChild(overlay);
            
            // Start transition animation
            setTimeout(() => {
                overlay.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                message.style.opacity = '1';
                message.style.transform = 'translateY(0)';
                loader.style.opacity = '1';
            }, 300);
            
            // Complete transition and redirect
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(overlay);
                    document.head.removeChild(style);
                    callback();
                }, 1000);
            }, 2500);
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            // Next portal button with transition
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmNextPortal, (confirmed) => {
                    if (confirmed) {
                        // Save completion status if Firebase available
                        if (state.firebaseInitialized && state.db) {
                            state.db.collection("temarix_v5_progress").add({
                                userId: state.currentUser.uid,
                                portal: portalConfig.currentPortal,
                                status: "complete",
                                timestamp: firebase.firestore.Timestamp.now()
                            }).catch(error => console.error('Error saving progress:', error));
                        }
                        
                        // Start transition animation
                        createPortalTransition(() => {
                            window.location.href = `${portalConfig.nextPortalFile}?lang=${state.currentLanguage}`;
                        });
                    }
                });
            });
            
            // Stay button
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmStay, (confirmed) => {
                    if (confirmed) {
                        resetJourney();
                        setTimeout(() => {
                            startPortalSequence();
                        }, 1000);
                    }
                });
            });
        }
        
        // Get language from URL
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        // Initialize Temarix
        function initializeTemarix() {
            console.log('Initializing Temarix V5 Portal 04...');
            console.log('Current state:', state);
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            state.journeyStarted = true;
            console.log('Journey started:', state.journeyStarted);
            
            // Start portal sequence immediately
            console.log('Starting portal sequence in 1 second...');
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        // Main initialization
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Temarix V5 Portal 04 DOM loaded');
            
            // Get initial language from URL
            state.currentLanguage = getLanguageFromURL();
            
            // Update UI with selected language immediately
            updateStaticTranslations(state.currentLanguage);
            updateLanguageButtons(state.currentLanguage);
            
            // Initialize Firebase
            await initializeFirebase();
            
            // Start the journey immediately
            initializeTemarix();
        });
    </script>
</body>
</html>
        