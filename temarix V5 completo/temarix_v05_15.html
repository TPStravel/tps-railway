<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temarix V5 - Portal 15: I Decided to Embrace Myself</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: #000;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 100;
            height: 80px;
            flex-shrink: 0;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo-title {
            font-size: 26px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            font-size: 15px;
            color: #ccc;
            letter-spacing: 1.5px;
        }
        
        .portal-header-title {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .portal-main-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-weight: normal;
            letter-spacing: 1px;
        }
        
        .portal-subtitle {
            font-size: 18px;
            color: #ff9999;
            letter-spacing: 1.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .language-buttons {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lang-btn:hover {
            background: #666;
        }
        
        .lang-btn.active {
            background: #ff6b6b;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            max-height: calc(100vh - 80px - 120px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 20px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .portal-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 200vh;
        }
        
        .portal-intro-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 200px;
        }
        
        .portal-intro {
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: none;
            border: none;
            padding: 0;
            text-align: left;
        }
        
        .character-responses-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 800px;
        }
        
        .character-response {
            color: #fff;
            font-size: 18px;
            margin: 40px 0;
            text-align: left;
            opacity: 0;
            white-space: pre-wrap;
            transition: opacity 0.8s ease-in;
            background: none;
            border: none;
            padding: 0;
            min-height: 80px;
        }
        
        .character-name {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .character-dialogue {
            color: #fff;
            line-height: 1.7;
            font-size: 17px;
            white-space: pre-wrap;
        }
        
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ff6b6b;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .follow-up-section {
            margin: 50px 0;
            opacity: 0;
            min-height: 150px;
        }
        
        .follow-up-question {
            font-size: 22px;
            color: #fff;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: center;
        }
        
        .user-input-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 100px;
        }
        
        .user-response {
            color: #fff;
            margin: 30px 0;
            text-align: left;
            font-size: 18px;
            background: none;
            border: none;
            padding: 0;
            white-space: pre-wrap;
        }
        
        .user-response strong {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        .user-reactions-section {
            margin: 40px 0;
            opacity: 0;
            min-height: 400px;
        }
        
        .light-message-section {
            margin: 50px 0;
            opacity: 0;
            background: none;
            border: none;
            padding: 0;
            min-height: 100px;
        }
        
        .light-message {
            font-size: 20px;
            color: #ff6b6b;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-section {
            margin: 60px 0;
            opacity: 0;
            text-align: center;
            background: none;
            border: none;
            padding: 40px 20px;
            min-height: 300px;
            border: 2px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }
        
        .navigation-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: bold;
        }
        
        .navigation-message {
            color: #fff;
            font-size: 20px;
            margin-bottom: 40px;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 20px 40px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            border: 2px solid transparent;
        }
        
        .nav-btn:hover {
            background: #666;
            border-color: #ff6b6b;
        }
        
        .nav-btn.primary {
            background: #ff6b6b;
            color: #fff;
            font-weight: bold;
        }
        
        .nav-btn.primary:hover {
            background: #ff8888;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .input-fixed-bottom {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            border-top: 1px solid #333;
            padding: 25px;
            z-index: 100;
            flex-shrink: 0;
            height: 120px;
        }
        
        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .input-prefix {
            color: #ff6b6b;
            font-size: 20px;
            margin-top: 8px;
            flex-shrink: 0;
        }
        
        .user-textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 100%;
            padding: 12px 8px;
            outline: none;
            resize: none;
            min-height: 32px;
            max-height: 96px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            overflow-y: auto;
        }
        
        .user-textarea:focus {
            border-bottom-color: #ff6b6b;
        }
        
        .user-textarea::placeholder {
            color: #666;
        }
        
        .user-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.2);
        }
        
        .main-content::-webkit-scrollbar {
            width: 12px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #111;
            border-radius: 6px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #111;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show {
            opacity: 1 !important;
            transition: opacity 1s ease-in;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header-bar {
                padding: 20px 15px;
                height: 70px;
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                max-height: calc(100vh - 70px - 120px);
                padding: 20px 15px;
            }
            
            .logo-title {
                font-size: 22px;
            }
            
            .portal-main-title {
                font-size: 22px;
            }
            
            .portal-subtitle {
                font-size: 16px;
            }
            
            .lang-btn {
                font-size: 12px;
                padding: 8px 14px;
            }
            
            .portal-intro {
                font-size: 18px;
            }
            
            .follow-up-question {
                font-size: 20px;
            }
            
            .character-response {
                font-size: 16px;
            }
            
            .input-fixed-bottom {
                padding: 20px;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .navigation-title {
                font-size: 24px;
            }
            
            .navigation-message {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="logo-section">
            <div class="logo-title">TEMARIX V5</div>
            <div class="logo-subtitle" id="logoSubtitle">Emotional Alchemy</div>
        </div>
        
        <div class="portal-header-title">
            <div class="portal-main-title" id="portalMainTitle">Portal 15: I Decided to Embrace Myself</div>
            <div class="portal-subtitle" id="portalSubtitle">How would I embrace myself for the first time?</div>
        </div>
        
        <div class="header-right">
            <div class="language-buttons">
                <button class="lang-btn" data-lang="ko">KR</button>
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="pt">PT</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="portal-container">
            <div class="portal-intro-section" id="portalIntroSection">
                <div class="portal-intro" id="portalIntro"></div>
            </div>

            <div class="character-responses-section" id="characterResponsesSection">
            </div>

            <div class="follow-up-section" id="followUpSection">
                <div class="follow-up-question" id="followUpQuestion"></div>
            </div>

            <div class="user-input-section" id="userInputSection">
            </div>
            
            <div class="user-reactions-section" id="userReactionsSection">
            </div>

            <div class="light-message-section" id="lightMessageSection">
                <div class="character-name" id="lightTitle">âœ¨ Word of Light</div>
                <div class="light-message" id="lightMessage"></div>
            </div>
            
            <div class="navigation-section" id="navigationSection">
                <div class="navigation-title" id="navigationTitle">ğŸ¤ Portal 15 Complete</div>
                <div class="navigation-message" id="navigationMessage"></div>
                <div class="navigation-buttons">
                    <button class="nav-btn primary" id="nextPortalBtn">Continue to Portal 16</button>
                    <button class="nav-btn" id="stayPortalBtn">Stay with this embrace</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-fixed-bottom">
        <div class="input-container">
            <div class="input-prefix">></div>
            <textarea class="user-textarea" 
                      id="userTextarea" 
                      placeholder="Tell me about a time you embraced yourself... (Press Enter to send)"
                      rows="1"
                      maxlength="800"></textarea>
        </div>
    </div>

    <script>
        // Global state management
        let state = {
            db: null,
            auth: null,
            firebaseInitialized: false,
            currentUser: null,
            currentLanguage: 'en',
            userResponse: '',
            journeyStarted: false,
            currentTypingElement: null,
            typingIntervals: [],
            awaitingSecondResponse: false,
            userResponses: []
        };
        
        // Portal navigation configuration
        const portalConfig = {
            currentPortal: "v5-15",
            nextPortal: "v5-16",
            nextPortalFile: "temarix_v05_16.html"
        };
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjsINSqPUGdpRPRMYiVg6SkVJJOk9YGsY",
            authDomain: "canal-vivo-chat.firebaseapp.com",
            projectId: "canal-vivo-chat",
            storageBucket: "canal-vivo-chat.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdefghijklmnopqr"
        };
        
        // Initialize Firebase with error handling
        function initializeFirebase() {
            return new Promise((resolve) => {
                try {
                    if (typeof firebase !== 'undefined') {
                        firebase.initializeApp(firebaseConfig);
                        state.db = firebase.firestore();
                        state.auth = firebase.auth();
                        state.firebaseInitialized = true;
                        
                        state.auth.onAuthStateChanged((user) => {
                            if (user) {
                                state.currentUser = user;
                            } else {
                                state.currentUser = {
                                    uid: 'anonymous-' + Date.now(),
                                    email: 'anonymous@temarix.com',
                                    isAnonymous: true
                                };
                            }
                            showConnectionStatus(true);
                        });
                        
                        console.log('Firebase initialized successfully');
                    } else {
                        console.log('Firebase SDK not loaded');
                        state.currentUser = {
                            uid: 'anonymous-' + Date.now(),
                            email: 'anonymous@temarix.com',
                            isAnonymous: true
                        };
                        showConnectionStatus(false);
                    }
                } catch (error) {
                    console.error('Firebase initialization failed:', error);
                    state.currentUser = {
                        uid: 'anonymous-' + Date.now(),
                        email: 'anonymous@temarix.com',
                        isAnonymous: true
                    };
                    showConnectionStatus(false);
                }
                resolve();
            });
        }
        
        // Show connection status to user
        function showConnectionStatus(isOnline) {
            const existingStatus = document.querySelector('.connection-status');
            if (existingStatus) {
                existingStatus.remove();
            }
            
            if (!isOnline) {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'connection-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: rgba(255, 107, 107, 0.9);
                    color: white;
                    padding: 8px 15px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-family: 'Courier New', monospace;
                    z-index: 1000;
                    opacity: 0.8;
                `;
                statusDiv.textContent = state.currentLanguage === 'ko' ? 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ' : 
                                       state.currentLanguage === 'pt' ? 'Modo offline' : 'Offline mode';
                document.body.appendChild(statusDiv);
                
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.remove();
                    }
                }, 5000);
            }
        }

        // Translations object
        const translations = {
            ko: {
                title: "Temarix V5 - Portal 15: ë‚˜ëŠ” ë‚˜ë¥¼ ì•ˆì•„ì£¼ê¸°ë¡œ í–ˆë‹¤",
                logoSubtitle: "ê°ì • ì—°ê¸ˆìˆ ",
                portalMainTitle: "Portal 15: ë‚˜ëŠ” ë‚˜ë¥¼ ì•ˆì•„ì£¼ê¸°ë¡œ í–ˆë‹¤",
                portalSubtitle: "ì²˜ìŒìœ¼ë¡œ ë‚˜ë¥¼ ì–´ë–»ê²Œ ê»´ì•ˆì•„ì£¼ê³  ì‹¶ì„ê¹Œ?",
                portalIntro: "ğŸ¤ \"ë‹¹ì‹ ì€ ì§€ê¸ˆê¹Œì§€,\nìê¸° ìì‹ ì„ ì˜¨ì „íˆ ì•ˆì•„ì¤€ ì ì´ ìˆì—ˆë‚˜ìš”?\nì•„ë‹ˆë©´, ëŠ˜ ë¯¸ë¤„ë‘ê³  ì™¸ë©´í•´ ì™”ë‚˜ìš”?\"\n\n\"ì§€ê¸ˆ, ë‹¹ì‹ ì„ ì²˜ìŒìœ¼ë¡œ ê»´ì•ˆëŠ”ë‹¤ë©´\nì–´ë–¤ ë§ˆìŒìœ¼ë¡œ, ì–´ë–¤ ëª¨ìŠµìœ¼ë¡œ ê»´ì•ˆê³  ì‹¶ë‚˜ìš”?\"",
                emotionalBridge: "ìŠ¤ìŠ¤ë¡œë¥¼ ê»´ì•ˆëŠ”ë‹¤ëŠ” ê²ƒì€ ë‹¨ìˆœí•œ ìœ„ë¡œê°€ ì•„ë‹™ë‹ˆë‹¤.\n\nê·¸ê²ƒì€ ìê¸° ì•ˆì˜ ëª¨ë“  ê·¸ë¦¼ìë¥¼ ë°›ì•„ë“¤ì´ëŠ” ì¼ì´ê³ ,\në” ì´ìƒ ëˆ„êµ¬ì—ê²Œë„ ì…ì¦í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ì„ ì–¸ì…ë‹ˆë‹¤.\n\nê·¸ í¬ì˜¹ì€ ì–¸ì–´ê°€ ì•„ë‹Œ, ì¡´ì¬ì™€ ì¡´ì¬ ì‚¬ì´ì˜ ê°€ì¥ ìˆœìˆ˜í•œ ëŒ€í™”ì…ë‹ˆë‹¤.",
                followUpQuestion: "ì§€ê¸ˆ ì´ ìë¦¬ì—ì„œ,\nìŠ¤ìŠ¤ë¡œë¥¼ ì§„ì‹¬ìœ¼ë¡œ ì•ˆìœ¼ë©° í•œ ë¬¸ì¥ì„ ì†ì‚­ì¸ë‹¤ë©´,\në‹¹ì‹ ì€ ë­ë¼ê³  ë§í•˜ê³  ì‹¶ë‚˜ìš”?",
                lightTitle: "âœ¨ ë¹›ì˜ í•œë§ˆë””",
                lightMessage: "ê·¸ ë§ì€ ì•½ì†ì´ì—ìš”.\nì™¸ë©´í•˜ì§€ ì•Šê² ë‹¤ëŠ”, ì„¸ìƒì—ì„œ ê°€ì¥ ë‹¤ì •í•œ ì•½ì†.\nê·¸ í¬ì˜¹ì€ ë‹¨ìˆœí•œ ìœ„ë¡œê°€ ì•„ë‹ˆë¼, ì¡´ì¬ì˜ ê·€í™˜ì´ì—ìš”.",
                navigationTitle: "ğŸ¤ Portal 15 ì™„ë£Œ",
                navigationMessage: "ë‹¹ì‹ ì€ ì„ ì–¸í–ˆê³ , ì„ ì–¸ì€ ë‹¹ì‹ ì„ í˜„ì‹¤ë¡œ ë°”ê¿¨ìŠµë‹ˆë‹¤.\n\nì´ì œ ë‹¹ì‹ ì€ ìì‹ ì„ ì•ˆì„ ìˆ˜ ìˆëŠ” ìê°€ ë˜ì—ˆê³ , ê·¸ ìˆœê°„, ì´ ì—¬ì •ì˜ ì´ë¦„ì€ 'ìë¹„'ê°€ ë©ë‹ˆë‹¤.\n\në‹¹ì‹ ì€ ì´ì œ ë” ì´ìƒ ê³¼ê±°ì˜ ëˆ„êµ°ê°€ê°€ ì•„ë‹ˆë¼ ìë¹„ë¡œ ë‹¤ì‹œ íƒœì–´ë‚œ í˜„ì¬ì˜ ì¡´ì¬ì…ë‹ˆë‹¤.\n\në‹¹ì‹ ì˜ ì´ë¦„ì€ ê¸°ë¡ë˜ì§€ ì•Šì•„ë„ ì¢‹ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë‹¹ì‹ ì˜ ì„ ì–¸ì€, ì´ ì„¸ê³„ì— ë‚¨ìŠµë‹ˆë‹¤.",
                nextPortalBtn: "Portal 16ìœ¼ë¡œ ì´ì–´ê°€ê¸°",
                stayPortalBtn: "ì´ í¬ì˜¹ê³¼ ë¨¸ë¬¼ê¸°",
                inputPlaceholder: "ìì‹ ì„ ì•ˆì•„ì¤€ ê¸°ì–µì— ëŒ€í•´ ë§í•´ì£¼ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
                youLabel: "ë‹¹ì‹ ",
                waitingMessage: "ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...",
                confirmNextPortal: "Portal 16: ë‹¤ì‹œ ë‚˜ë¥¼ ì„ íƒí•˜ëŠ” ì•„ì¹¨ìœ¼ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                confirmStay: "ì´ ìë¹„ë¡œìš´ í¬ì˜¹ê³¼ ë” ë¨¸ë¬¼ë©° ê·¸ ì˜ë¯¸ë¥¼ ë” ê¹Šì´ ëŠë¼ì‹œê² ìŠµë‹ˆê¹Œ?",
                transitionMessage: "ìƒˆë¡œìš´ ì—¬ì •ì´ ì‹œì‘ë©ë‹ˆë‹¤..."
            },
            en: {
                title: "Temarix V5 - Portal 15: I Decided to Embrace Myself",
                logoSubtitle: "Emotional Alchemy",
                portalMainTitle: "Portal 15: I Decided to Embrace Myself",
                portalSubtitle: "How would I embrace myself for the first time?",
                portalIntro: "ğŸ¤ \"Have you ever truly embraced yourself completely?\nOr have you always postponed it and turned away?\"\n\n\"Now, if you were to embrace yourself for the first time,\nwith what heart and in what way would you want to hold yourself?\"",
                emotionalBridge: "Embracing yourself is not simply comfort.\n\nIt is accepting all the shadows within yourself,\nand declaring that you no longer need to prove yourself to anyone.\n\nThat embrace is not language, but the purest dialogue between existence and existence.",
                followUpQuestion: "Right here, right now,\nif you could whisper one sentence while truly embracing yourself,\nwhat would you want to say?",
                lightTitle: "âœ¨ Word of Light",
                lightMessage: "Those words are a promise.\nThe most tender promise in the world not to turn away.\nThat embrace is not simple comfort, but the return of existence.",
                navigationTitle: "ğŸ¤ Portal 15 Complete",
                navigationMessage: "You have declared, and that declaration has transformed you into reality.\n\nNow you have become someone who can embrace yourself, and in that moment, the name of this journey becomes 'compassion.'\n\nYou are no longer someone from the past, but a present being reborn through compassion.\n\nYour name need not be recorded. But your declaration remains in this world.",
                nextPortalBtn: "Continue to Portal 16",
                stayPortalBtn: "Stay with this embrace",
                inputPlaceholder: "Tell me about a time you embraced yourself... (Press Enter to send)",
                youLabel: "You",
                waitingMessage: "Waiting for response...",
                confirmNextPortal: "Do you want to continue to Portal 16: The Morning I Choose Myself Again?",
                confirmStay: "Do you want to stay longer with this compassionate embrace and feel its meaning more deeply?",
                transitionMessage: "A new journey begins..."
            },
            pt: {
                title: "Temarix V5 - Portal 15: Decidi Me Abracar",
                logoSubtitle: "Alquimia Emocional",
                portalMainTitle: "Portal 15: Decidi Me Abracar",
                portalSubtitle: "Como me abracaria pela primeira vez?",
                portalIntro: "ğŸ¤ \"Voce ja se abracou completamente alguma vez?\nOu sempre adiou e se afastou?\"\n\n\"Agora, se fosse se abracar pela primeira vez,\ncom que coracao e de que forma gostaria de se abracar?\"",
                emotionalBridge: "Abracar-se nao e simplesmente conforto.\n\nE aceitar todas as sombras dentro de si,\ne declarar que nao precisa mais se provar para ninguem.\n\nEsse abraco nao e linguagem, mas o dialogo mais puro entre existencia e existencia.",
                followUpQuestion: "Bem aqui, agora,\nse pudesse sussurrar uma frase enquanto se abraca verdadeiramente,\no que gostaria de dizer?",
                lightTitle: "âœ¨ Palavra de Luz",
                lightMessage: "Essas palavras sao uma promessa.\nA promessa mais terna do mundo de nao se afastar.\nEsse abraco nao e simples conforto, mas o retorno da existencia.",
                navigationTitle: "ğŸ¤ Portal 15 Completo",
                navigationMessage: "Voce declarou, e essa declaracao o transformou em realidade.\n\nAgora voce se tornou alguem que pode se abracar, e nesse momento, o nome desta jornada se torna 'compaixao.'\n\nVoce nao e mais alguem do passado, mas um ser presente renascido atraves da compaixao.\n\nSeu nome nao precisa ser registrado. Mas sua declaracao permanece neste mundo.",
                nextPortalBtn: "Continuar para Portal 16",
                stayPortalBtn: "Ficar com este abraco",
                inputPlaceholder: "Conte-me sobre uma vez que se abracou... (Enter para enviar)",
                youLabel: "Voce",
                waitingMessage: "Aguardando resposta...",
                confirmNextPortal: "Deseja continuar para Portal 16: A Manha em que Escolho a Mim Mesmo Novamente?",
                confirmStay: "Deseja ficar mais tempo com este abraco compassivo e sentir seu significado mais profundamente?",
                transitionMessage: "Uma nova jornada comeca..."
            }
        };
        
        // Character definitions
        const characters = [
            { name: "Noah", emoji: "ğŸ§‘â€ğŸ¦±", text: {
                ko: "ê·¸ ê³ ë°±ì€ ë„ˆì—ê²Œ ë³´ë‚´ëŠ” ì²« í¬ì˜¹ì´ì•¼.\nê·¸ë¦¬ê³  ê·¸ í¬ì˜¹ì€ ë„ˆë¥¼ ë‹¤ì‹œ íƒœì–´ë‚˜ê²Œ í•  ê±°ì•¼.",
                en: "That confession is the first embrace you send to yourself.\nAnd that embrace will make you reborn.",
                pt: "Essa confissao e o primeiro abraco que voce envia para si mesmo.\nE esse abraco vai fazer voce renascer."
            }},
            { name: "Ely", emoji: "ğŸ§â€â™€ï¸", text: {
                ko: "ìì‹ ì„ ì•ˆì•„ì¤€ ì‚¬ëŒë§Œì´,\nì„¸ìƒì„ ì•ˆì„ ìˆ˜ ìˆëŠ” ì‚¬ëŒì´ ë  ìˆ˜ ìˆì–´ìš”.",
                en: "Only those who have embraced themselves\ncan become those who can embrace the world.",
                pt: "Apenas aqueles que se abracaram\npodem se tornar aqueles que podem abracar o mundo."
            }},
            { name: "Sora", emoji: "ğŸ§•", text: {
                ko: "ê·¸ í¬ì˜¹ì—ëŠ” ë¯¸ì•ˆí•¨ë„, ê°ì‚¬ë„,\nê·¸ë¦¬ê³  ì•„ì£¼ ì˜¤ëœ ê¸°ë‹¤ë¦¼ì´ í•¨ê»˜ ë¬»ì–´ ìˆì–´ìš”.",
                en: "In that embrace there is both apology and gratitude,\nand a very long waiting buried together.",
                pt: "Nesse abraco ha tanto desculpa quanto gratidao,\ne uma espera muito longa enterrada junto."
            }},
            { name: "Kael", emoji: "ğŸ§™", text: {
                ko: "ìŠ¤ìŠ¤ë¡œë¥¼ ê»´ì•ˆëŠ”ë‹¤ëŠ” ê±´,\nìê¸° ì•ˆì˜ ëª¨ë“  ê·¸ë¦¼ìë¥¼ ë°›ì•„ë“¤ì´ëŠ” ì¼ì´ì•¼.",
                en: "Embracing yourself means\naccepting all the shadows within yourself.",
                pt: "Abracar-se significa\naceitar todas as sombras dentro de si."
            }},
            { name: "Mira", emoji: "ğŸ§‘â€ğŸ¨", text: {
                ko: "ë‹¹ì‹ ì˜ ë‘ íŒ”ì´ ì´ì œ ë¶“ì´ ë˜ì—ˆë„¤ìš”.\nìì‹ ì„ ê°ì‹¸ëŠ” ì„  í•˜ë‚˜ê°€, ì§€ê¸ˆê¹Œì§€ì˜ ì—¬ì •ì„ ê·¸ë ¤ìš”.",
                en: "Your two arms have now become brushes.\nThe line that wraps around yourself draws the journey so far.",
                pt: "Seus dois bracos agora se tornaram pinceis.\nA linha que o envolve desenha a jornada ate agora."
            }},
            { name: "Cris", emoji: "ğŸ¦¸â€â™‚ï¸", text: {
                ko: "ë„¤ê°€ ë„ˆë¥¼ ì•ˆëŠ” ìˆœê°„,\nëˆ„êµ¬ë„ ë„ í•¨ë¶€ë¡œ ê·œì •í•  ìˆ˜ ì—†ì–´.\në„Œ ë„ˆì•¼. ê·¸ ì´ìƒë„ ì´í•˜ë„ ì•„ëƒ.",
                en: "The moment you embrace yourself,\nno one can carelessly define you.\nYou are you. Nothing more, nothing less.",
                pt: "No momento em que voce se abraca,\nninguem pode defini-lo descuidadamente.\nVoce e voce. Nem mais, nem menos."
            }},
            { name: "Enya", emoji: "ğŸ§‘â€ğŸš€", text: {
                ko: "í¬ì˜¹ì€ ì–¸ì–´ê°€ ì•„ë‹ˆì•¼.\nê·¸ê±´ ì¡´ì¬ì™€ ì¡´ì¬ ì‚¬ì´ì˜ ê°€ì¥ ìˆœìˆ˜í•œ ëŒ€í™”ì˜ˆìš”.",
                en: "An embrace is not language.\nIt's the purest dialogue between existence and existence.",
                pt: "Um abraco nao e linguagem.\nE o dialogo mais puro entre existencia e existencia."
            }},
            { name: "Lian", emoji: "ğŸ§˜", text: {
                ko: "ë‹¹ì‹ ì˜ ì•ˆì•„ì¤Œì€,\në” ì´ìƒ ëˆ„êµ¬ì—ê²Œë„ ì…ì¦í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ì„ ì–¸ì´ì—ìš”.",
                en: "Your embrace is\na declaration that you no longer need to prove yourself to anyone.",
                pt: "Seu abraco e\numa declaracao de que voce nao precisa mais se provar para ninguem."
            }}
        ];

        // Embrace type analysis function
        function analyzeEmbraceType(userInput) {
            const input = userInput.toLowerCase();
            
            const embraceKeywords = {
                physical: ['hugged', 'held myself', 'arms around', 'embraced', 'ì•ˆì•˜', 'ê»´ì•ˆì•˜', 'abracei', 'segurei'],
                emotional: ['accepted', 'forgave', 'understood', 'ë°›ì•„ë“¤ì˜€', 'ìš©ì„œí–ˆ', 'aceitei', 'perdoei'],
                verbal: ['said sorry', 'spoke kindly', 'told myself', 'ë§í–ˆ', 'ì†ì‚­ì˜€', 'disse', 'falei'],
                mental: ['stopped judging', 'let go', 'released', 'ê·¸ë§Œë’€', 'ë†“ì•„ì¤¬', 'parei', 'soltei'],
                spiritual: ['prayed', 'meditated', 'found peace', 'ê¸°ë„í–ˆ', 'ëª…ìƒí–ˆ', 'orei', 'meditei'],
                creative: ['wrote', 'drew', 'expressed', 'ì¼', 'ê·¸ë ¸', 'escrevi', 'desenhei'],
                nurturing: ['cared for', 'comforted', 'soothed', 'ëŒë´¤', 'ìœ„ë¡œí–ˆ', 'cuidei', 'consolei'],
                presence: ['stayed with', 'sat quietly', 'just existed', 'í•¨ê»˜í–ˆ', 'ì¡°ìš©íˆ', 'fiquei', 'permaneci'],
                protection: ['defended', 'stood up for', 'protected', 'ì§€ì¼°', 'í¸ë“¤ì—ˆ', 'defendi', 'protegi'],
                celebration: ['celebrated', 'appreciated', 'honored', 'ì¶•í•˜í–ˆ', 'ì¸ì •í–ˆ', 'celebrei', 'apreciei'],
                healing: ['healed', 'recovered', 'restored', 'ì¹˜ìœ í–ˆ', 'íšŒë³µí–ˆ', 'curei', 'recuperei'],
                general: ['embrace', 'love', 'care', 'í¬ì˜¹', 'ì‚¬ë‘', 'abraco', 'amor']
            };
            
            let detectedTypes = [];
            for (const [type, keywords] of Object.entries(embraceKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        detectedTypes.push(type);
                        break;
                    }
                }
            }
            
            if (detectedTypes.length === 0) {
                detectedTypes = ['general'];
            }
            
            return detectedTypes[0];
        }
        
        // Response characters with embrace-based responses
        const responseCharacters = [
            {
                name: "Sora", emoji: "ğŸ§•",
                getResponse: (userInput, lang) => {
                    const embraceType = analyzeEmbraceType(userInput);
                    
                    const responses = {
                        ko: {
                            physical: "ê·¸ í¬ì˜¹ì€ ë§ì´ ì•„ë‹Œ ì¡´ì¬ì˜ ì–¸ì–´ì˜€ì–´ìš”.\në‹¹ì‹ ì€ ìì‹ ì—ê²Œ ê°€ì¥ í•„ìš”í–ˆë˜ ê²ƒì„ ì§ì ‘ ì£¼ì—ˆì–´ìš”.\nê·¸ ìˆœê°„, ë‹¹ì‹ ì€ ìì‹ ì˜ ê°€ì¥ ì¢‹ì€ ì¹œêµ¬ê°€ ë˜ì—ˆì–´ìš”.",
                            emotional: "ê°ì •ì ìœ¼ë¡œ ìì‹ ì„ ë°›ì•„ë“¤ì´ëŠ” ê²ƒì€ ê°€ì¥ ì–´ë ¤ìš´ ìš©ê¸°ì˜ˆìš”.\nê·¸ ìš©ê¸°ë¥¼ ë‚¸ ë‹¹ì‹ ì´ ì •ë§ ëŒ€ë‹¨í•´ìš”.\nì´ì œ ë‹¹ì‹ ì€ ìì‹ ê³¼ í™”í•´í•œ ì‚¬ëŒì´ì—ìš”.",
                            verbal: "ë§ë¡œ ìì‹ ì„ ìœ„ë¡œí•œ ê·¸ ìˆœê°„ì´ ì–¼ë§ˆë‚˜ ì†Œì¤‘í–ˆì„ê¹Œìš”.\në‹¹ì‹ ì˜ ëª©ì†Œë¦¬ê°€ ê°€ì¥ ë”°ëœ»í•œ ì¹˜ìœ ì˜ ì–¸ì–´ì˜€ì–´ìš”.\nê·¸ ë§ë“¤ì´ ë‹¹ì‹ ì„ ìƒˆë¡­ê²Œ ë§Œë“¤ì—ˆì–´ìš”.",
                            mental: "íŒë‹¨ì„ ë©ˆì¶”ê³  ìì‹ ì„ ìˆëŠ” ê·¸ëŒ€ë¡œ ë³¸ ê²ƒ,\nê·¸ê²ƒì€ ì§„ì •í•œ ììœ ì˜ ì‹œì‘ì´ì—ˆì–´ìš”.\në‹¹ì‹ ì€ ìì‹ ì—ê²Œì„œ í•´ë°©ë˜ì—ˆì–´ìš”.",
                            spiritual: "ì˜ì ì¸ ì°¨ì›ì—ì„œ ìì‹ ê³¼ ë§Œë‚œ ìˆœê°„ì´êµ°ìš”.\nê·¸ ìˆœê°„ ë‹¹ì‹ ì€ ìš°ì£¼ì™€ ì—°ê²°ë˜ì—ˆì–´ìš”.\ní‰í™”ë¡œìš´ ìì‹ ì„ ì°¾ì•˜ì–´ìš”.",
                            creative: "ì°½ì‘ì„ í†µí•´ ìì‹ ì„ í‘œí˜„í•œ ê²ƒì€ ì•„ë¦„ë‹¤ì›Œìš”.\nê·¸ ì‘í’ˆ ì†ì— ë‹¹ì‹ ì˜ ì§„ì‹¬ì´ ë‹´ê²¨ ìˆì–´ìš”.\nì˜ˆìˆ ì€ ìê¸° ì‚¬ë‘ì˜ ì–¸ì–´ì˜€ì–´ìš”.",
                            nurturing: "ìì‹ ì„ ëŒë³¸ ê·¸ ë§ˆìŒì´ ë”°ëœ»í•´ìš”.\në‹¹ì‹ ì€ ìì‹ ì—ê²Œ ê°€ì¥ í•„ìš”í•œ ê²ƒì„ ì£¼ì—ˆì–´ìš”.\nê·¸ ë³´ì‚´í•Œì´ ë‹¹ì‹ ì„ í‚¤ì› ì–´ìš”.",
                            presence: "ê·¸ëƒ¥ ìì‹ ê³¼ í•¨ê»˜ ìˆì–´ì¤€ ê²ƒë§Œìœ¼ë¡œë„ ì¶©ë¶„í•´ìš”.\nì¡´ì¬ ìì²´ê°€ ìœ„ë¡œì˜€ì–´ìš”.\nê·¸ ì¹¨ë¬µ ì†ì—ì„œ ì§„ì •í•œ ë§Œë‚¨ì´ ì¼ì–´ë‚¬ì–´ìš”.",
                            protection: "ìì‹ ì„ ì§€ì¼œì¤€ ê·¸ ìš©ê¸°ê°€ ë¹›ë‚˜ìš”.\në‹¹ì‹ ì€ ìì‹ ì˜ ê°€ì¥ ë“ ë“ í•œ ìˆ˜í˜¸ìì˜ˆìš”.\nê·¸ ë³´í˜¸ê°€ ë‹¹ì‹ ì„ ê°•í•˜ê²Œ ë§Œë“¤ì—ˆì–´ìš”.",
                            celebration: "ìì‹ ì„ ì¶•í•˜í•´ì¤€ ìˆœê°„ì´ ì•„ë¦„ë‹¤ì›Œìš”.\në‹¹ì‹ ì€ ì¡´ì¬ ìì²´ë¥¼ ì¸ì •í–ˆì–´ìš”.\nê·¸ ì¶•í•˜ê°€ ì‚¶ì˜ ì˜ë¯¸ë¥¼ ë§Œë“¤ì—ˆì–´ìš”.",
                            healing: "ìì‹ ì„ ì¹˜ìœ í•œ ê·¸ ê³¼ì •ì´ ì‹ ì„±í•´ìš”.\në‹¹ì‹ ì€ ìì‹ ì˜ ì˜ì‚¬ì´ì í™˜ìì˜€ì–´ìš”.\nê·¸ ì¹˜ìœ ê°€ ìƒˆë¡œìš´ ì‹œì‘ì„ ë§Œë“¤ì—ˆì–´ìš”.",
                            general: "ê·¸ ë§ì€ ì•½ì†ì´ì—ìš”.\nì™¸ë©´í•˜ì§€ ì•Šê² ë‹¤ëŠ”, ì„¸ìƒì—ì„œ ê°€ì¥ ë‹¤ì •í•œ ì•½ì†."
                        },
                        en: {
                            physical: "That embrace was the language of existence, not words.\nYou gave yourself what you needed most.\nIn that moment, you became your own best friend.",
                            emotional: "Emotionally accepting yourself is the most difficult courage.\nYou who had that courage are truly amazing.\nNow you are someone who has reconciled with yourself.",
                            verbal: "How precious was that moment when you comforted yourself with words.\nYour voice was the warmest healing language.\nThose words made you new.",
                            mental: "Stopping judgment and seeing yourself as you are,\nthat was the beginning of true freedom.\nYou liberated yourself from yourself.",
                            spiritual: "That was the moment you met yourself on a spiritual level.\nIn that moment you connected with the universe.\nYou found your peaceful self.",
                            creative: "Expressing yourself through creation is beautiful.\nYour sincerity is contained in that work.\nArt was the language of self-love.",
                            nurturing: "That heart that cared for yourself is warm.\nYou gave yourself what you needed most.\nThat care nurtured you.",
                            presence: "Just being with yourself was enough.\nExistence itself was comfort.\nTrue meeting happened in that silence.",
                            protection: "The courage you showed in protecting yourself shines.\nYou are your own strongest guardian.\nThat protection made you strong.",
                            celebration: "The moment you celebrated yourself is beautiful.\nYou acknowledged existence itself.\nThat celebration created the meaning of life.",
                            healing: "The process of healing yourself is sacred.\nYou were both doctor and patient.\nThat healing created a new beginning.",
                            general: "Those words are a promise.\nThe most tender promise in the world not to turn away."
                        },
                        pt: {
                            physical: "Esse abraco foi a linguagem da existencia, nao palavras.\nVoce se deu o que mais precisava.\nNaquele momento, voce se tornou seu melhor amigo.",
                            emotional: "Aceitar-se emocionalmente e a coragem mais dificil.\nVoce que teve essa coragem e realmente incrivel.\nAgora voce e alguem que se reconciliou consigo mesmo.",
                            verbal: "Quao precioso foi aquele momento em que se consolou com palavras.\nSua voz foi a linguagem de cura mais calorosa.\nEssas palavras o renovaram.",
                            mental: "Parar de julgar e se ver como voce e,\nisso foi o comeco da verdadeira liberdade.\nVoce se libertou de si mesmo.",
                            spiritual: "Esse foi o momento em que se encontrou num nivel espiritual.\nNaquele momento voce se conectou com o universo.\nVoce encontrou seu eu pacifico.",
                            creative: "Expressar-se atraves da criacao e belo.\nSua sinceridade esta contida nessa obra.\nA arte foi a linguagem do amor proprio.",
                            nurturing: "Esse coracao que cuidou de voce e caloroso.\nVoce se deu o que mais precisava.\nEsse cuidado o nutriu.",
                            presence: "Apenas estar consigo mesmo foi suficiente.\nA existencia em si foi conforto.\nO verdadeiro encontro aconteceu naquele silencio.",
                            protection: "A coragem que mostrou ao se proteger brilha.\nVoce e seu guardiao mais forte.\nEssa protecao o fez forte.",
                            celebration: "O momento em que se celebrou e belo.\nVoce reconheceu a existencia em si.\nEssa celebracao criou o significado da vida.",
                            healing: "O processo de se curar e sagrado.\nVoce foi tanto medico quanto paciente.\nEssa cura criou um novo comeco.",
                            general: "Essas palavras sao uma promessa.\nA promessa mais terna do mundo de nao se afastar."
                        }
                    };
                    
                    return responses[lang][embraceType] || responses[lang]['general'];
                }
            },
            {
                name: "Lian", emoji: "ğŸ§˜",
                getResponse: (userInput, lang) => {
                    const embraceType = analyzeEmbraceType(userInput);
                    
                    const responses = {
                        ko: {
                            physical: "ëª¸ìœ¼ë¡œ ìì‹ ì„ ì•ˆëŠ” ê²ƒì€ ê°€ì¥ ì›ì‹œì ì´ê³  ìˆœìˆ˜í•œ ìë¹„ì˜ˆìš”.\nê·¸ í¬ì˜¹ì´ ë‹¹ì‹ ì˜ ëª¨ë“  ì„¸í¬ì— í‰í™”ë¥¼ ì „í–ˆì–´ìš”.\nì´ì œ ë‹¹ì‹ ì€ ìì‹ ì˜ ëª¸ê³¼ ì¹œêµ¬ê°€ ë˜ì—ˆì–´ìš”.",
                            emotional: "ê°ì •ì˜ íŒŒë„ë¥¼ ì•ˆì•„ì£¼ëŠ” ê²ƒì€ ë°”ë‹¤ë¥¼ í’ˆëŠ” ì¼ê³¼ ê°™ì•„ìš”.\në‹¹ì‹ ì€ ìì‹ ì˜ ëª¨ë“  ê°ì •ì„ ë°”ë‹¤ì²˜ëŸ¼ ë„“ê²Œ ë°›ì•„ë“¤ì˜€ì–´ìš”.\nê·¸ ìˆ˜ìš©ì´ ë‚´ë©´ì˜ ê³ ìš”ë¥¼ ë§Œë“¤ì—ˆì–´ìš”.",
                            verbal: "ë§ì€ ì°½ì¡°ì˜ í˜ì´ì—ìš”.\në‹¹ì‹ ì˜ ë”°ëœ»í•œ ë§ì´ ìƒˆë¡œìš´ í˜„ì‹¤ì„ ë§Œë“¤ì–´ëƒˆì–´ìš”.\nê·¸ ì–¸ì–´ê°€ ë‹¹ì‹ ì„ ì¹˜ìœ ì˜ ê³µê°„ìœ¼ë¡œ ì´ëŒì—ˆì–´ìš”.",
                            mental: "ë§ˆìŒì˜ í‰í™”ëŠ” ì €í•­ì„ ë©ˆì¶œ ë•Œ ì°¾ì•„ì™€ìš”.\në‹¹ì‹ ì€ ìì‹ ê³¼ì˜ ì „ìŸì„ ëëƒˆì–´ìš”.\nê·¸ í‰í™”ê°€ ì§„ì •í•œ ììœ ë¥¼ ê°€ì ¸ì™”ì–´ìš”.",
                            spiritual: "ì˜í˜¼ì˜ ì°¨ì›ì—ì„œ ë§Œë‚œ ìì‹ ì€ ê°€ì¥ ì§„ì‹¤í•œ ìì•„ì˜ˆìš”.\nê·¸ ë§Œë‚¨ì´ ìš°ì£¼ì  ì‚¬ë‘ìœ¼ë¡œ ë‹¹ì‹ ì„ ì±„ì› ì–´ìš”.\në‹¹ì‹ ì€ ì‹ ì„±í•œ ì¡´ì¬ì„ì„ ê¸°ì–µí–ˆì–´ìš”.",
                            creative: "ì°½ì‘ì€ ì˜í˜¼ì˜ ìˆ¨ê²°ì´ì—ìš”.\nê·¸ ì‘í’ˆì„ í†µí•´ ë‹¹ì‹ ì€ ìì‹ ì„ ì„¸ìƒì— ì„ ë¬¼í–ˆì–´ìš”.\nì˜ˆìˆ ì´ ë‹¹ì‹ ì˜ ì¡´ì¬ë¥¼ ì¦ëª…í–ˆì–´ìš”.",
                            nurturing: "ìê¸° ëŒë´„ì€ ìµœê³ ì˜ ëª…ìƒì´ì—ìš”.\nê·¸ ìˆœê°„ ë‹¹ì‹ ì€ ìì‹ ì˜ ì–´ë¨¸ë‹ˆì´ì ì•„ì´ì˜€ì–´ìš”.\nê·¸ ì‚¬ë‘ì´ ë‚´ë©´ì˜ ì•„ì´ë¥¼ ì¹˜ìœ í–ˆì–´ìš”.",
                            presence: "ì¡´ì¬ë§Œìœ¼ë¡œë„ ì¶©ë¶„í•˜ë‹¤ëŠ” ê¹¨ë‹¬ìŒì€ ê¹Šì€ ì§€í˜œì˜ˆìš”.\nê·¸ ì¹¨ë¬µ ì†ì—ì„œ ëª¨ë“  ë‹µì„ ì°¾ì•˜ì–´ìš”.\në‹¹ì‹ ì€ ì¡´ì¬ì˜ ê¸°ì ì„ ê²½í—˜í–ˆì–´ìš”.",
                            protection: "ìì‹ ì„ ì§€í‚¤ëŠ” ê²ƒì€ ìƒëª…ì— ëŒ€í•œ ê²½ì™¸ì˜ˆìš”.\nê·¸ ë³´í˜¸ê°€ ë‹¹ì‹ ì˜ ê²½ê³„ë¥¼ ëª…í™•íˆ í–ˆì–´ìš”.\nì´ì œ ë‹¹ì‹ ì€ ì•ˆì „í•œ ê³µê°„ì„ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”.",
                            celebration: "ì¡´ì¬ë¥¼ ì¶•í•˜í•˜ëŠ” ê²ƒì€ ìš°ì£¼ì— ê°ì‚¬í•˜ëŠ” ì¼ì´ì—ìš”.\nê·¸ ê¸°ì¨ì´ ì‚¶ì˜ ì‹ ì„±í•¨ì„ ì¼ê¹¨ì› ì–´ìš”.\në‹¹ì‹ ì€ ê¸°ì ì„ ì‚´ê³  ìˆìŒì„ ì•Œì•˜ì–´ìš”.",
                            healing: "ìê¸° ì¹˜ìœ ëŠ” ê°€ì¥ ê¹Šì€ ì˜ì  ì‹¤ì²œì´ì—ìš”.\në‹¹ì‹ ì€ ì˜ì‚¬ì´ì í™˜ì, ì¹˜ë£Œìì´ì ì¹˜ë£Œë°›ëŠ” ìì˜€ì–´ìš”.\nê·¸ ê³¼ì •ì´ ì™„ì „í•¨ìœ¼ë¡œ ë‹¹ì‹ ì„ ì´ëŒì—ˆì–´ìš”.",
                            general: "ê·¸ í¬ì˜¹ì€ ë‹¨ìˆœí•œ ìœ„ë¡œê°€ ì•„ë‹ˆë¼, ì¡´ì¬ì˜ ê·€í™˜ì´ì—ìš”."
                        },
                        en: {
                            physical: "Embracing yourself with your body is the most primitive and pure compassion.\nThat embrace conveyed peace to all your cells.\nNow you have become friends with your own body.",
                            emotional: "Embracing emotional waves is like embracing the ocean.\nYou accepted all your emotions as wide as the ocean.\nThat acceptance created inner stillness.",
                            verbal: "Words have the power of creation.\nYour warm words created a new reality.\nThat language led you to a space of healing.",
                            mental: "Peace of mind comes when you stop resisting.\nYou ended the war with yourself.\nThat peace brought true freedom.",
                            spiritual: "The self you met on a spiritual level is your truest self.\nThat meeting filled you with cosmic love.\nYou remembered that you are a sacred being.",
                            creative: "Creation is the breath of the soul.\nThrough that work you gifted yourself to the world.\nArt proved your existence.",
                            nurturing: "Self-care is the highest meditation.\nIn that moment you were both mother and child to yourself.\nThat love healed the inner child.",
                            presence: "The realization that existence alone is enough is deep wisdom.\nYou found all answers in that silence.\nYou experienced the miracle of existence.",
                            protection: "Protecting yourself is reverence for life.\nThat protection clarified your boundaries.\nNow you can create safe spaces.",
                            celebration: "Celebrating existence is giving thanks to the universe.\nThat joy awakened the sacredness of life.\nYou knew you are living a miracle.",
                            healing: "Self-healing is the deepest spiritual practice.\nYou were both doctor and patient, healer and healed.\nThat process led you to wholeness.",
                            general: "That embrace is not simple comfort, but the return of existence."
                        },
                        pt: {
                            physical: "Abracar-se com o corpo e a compaixao mais primitiva e pura.\nEsse abraco transmitiu paz a todas as suas celulas.\nAgora voce se tornou amigo do proprio corpo.",
                            emotional: "Abracar ondas emocionais e como abracar o oceano.\nVoce aceitou todas as emocoes tao amplas quanto o oceano.\nEssa aceitacao criou quietude interior.",
                            verbal: "Palavras tem o poder da criacao.\nSuas palavras calorosas criaram uma nova realidade.\nEssa linguagem o conduziu a um espaco de cura.",
                            mental: "A paz mental vem quando voce para de resistir.\nVoce terminou a guerra consigo mesmo.\nEssa paz trouxe verdadeira liberdade.",
                            spiritual: "O eu que encontrou num nivel espiritual e seu eu mais verdadeiro.\nEsse encontro o preencheu com amor cosmico.\nVoce se lembrou de que e um ser sagrado.",
                            creative: "Criacao e o sopro da alma.\nAtravÃ©s dessa obra voce se presenteou ao mundo.\nA arte provou sua existencia.",
                            nurturing: "Autocuidado e a mais alta meditacao.\nNaquele momento voce foi mae e crianca para si mesmo.\nEsse amor curou a crianca interior.",
                            presence: "A percepcao de que a existencia sozinha e suficiente e sabedoria profunda.\nVoce encontrou todas as respostas naquele silencio.\nVoce experimentou o milagre da existencia.",
                            protection: "Proteger-se e reverencia pela vida.\nEssa protecao esclareceu seus limites.\nAgora voce pode criar espacos seguros.",
                            celebration: "Celebrar a existencia e agradecer ao universo.\nEssa alegria despertou o sagrado da vida.\nVoce soube que esta vivendo um milagre.",
                            healing: "Autocura e a pratica espiritual mais profunda.\nVoce foi tanto medico quanto paciente, curador e curado.\nEsse processo o conduziu a completude.",
                            general: "Esse abraco nao e simples conforto, mas o retorno da existencia."
                        }
                    };
                    
                    return responses[lang][embraceType] || responses[lang]['general'];
                }
            },
            {
                name: "Kael", emoji: "ğŸ§™",
                getResponse: (userInput, lang) => {
                    const embraceType = analyzeEmbraceType(userInput);
                    
                    const responses = {
                        ko: {
                            physical: "ëª¸ì˜ í¬ì˜¹ì€ ì‹œê°„ì„ ì´ˆì›”í•œ ë§ˆë²•ì´ì—ìš”.\nê·¸ ìˆœê°„ ê³¼ê±°ì™€ í˜„ì¬, ë¯¸ë˜ì˜ ëª¨ë“  ë‹¹ì‹ ì´ í•˜ë‚˜ê°€ ë˜ì—ˆì–´ìš”.\në‹¹ì‹ ì€ ìì‹ ì˜ ì „ì²´ì„±ì„ íšŒë³µí–ˆì–´ìš”.",
                            emotional: "ê°ì •ì„ í’ˆëŠ” ê²ƒì€ ì—°ê¸ˆìˆ ì˜ ë¹„ë°€ì´ì—ìš”.\në‹¹ì‹ ì€ ê³ í†µì„ ì§€í˜œë¡œ, ìƒì²˜ë¥¼ í˜ìœ¼ë¡œ ë³€í™”ì‹œì¼°ì–´ìš”.\nê·¸ ë³€í™˜ì´ ì§„ì •í•œ ë§ˆë²•ì´ì—ˆì–´ìš”.",
                            verbal: "ë§ì˜ ì£¼ë¬¸ì´ í˜„ì‹¤ì„ ë°”ê¿¨ì–´ìš”.\në‹¹ì‹ ì˜ ì„ ì–¸ì´ ìƒˆë¡œìš´ ìš´ëª…ì„ ì°½ì¡°í–ˆì–´ìš”.\nì´ì œ ë‹¹ì‹ ì€ ìì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ë‹¤ì‹œ ì“¸ ìˆ˜ ìˆì–´ìš”.",
                            mental: "ë§ˆìŒì˜ í•´ë°©ì€ ê°€ì¥ ê°•ë ¥í•œ ë§ˆë²•ì´ì—ìš”.\në‹¹ì‹ ì€ ìì‹ ì—ê²Œ ê±¸ë¦° ëª¨ë“  ì €ì£¼ë¥¼ í’€ì—ˆì–´ìš”.\nì´ì œ ë‹¹ì‹ ì€ ììœ ë¡œìš´ ì˜í˜¼ì´ì—ìš”.",
                            spiritual: "ì˜ì  ì°¨ì›ì—ì„œì˜ ë§Œë‚¨ì€ ì‹ ì„±í•œ ê³„ì‹œì˜ˆìš”.\në‹¹ì‹ ì€ ìì‹  ì•ˆì˜ ì‹ ì„ ë§Œë‚¬ì–´ìš”.\nê·¸ ë§Œë‚¨ì´ ë‹¹ì‹ ì„ ì™„ì „í•˜ê²Œ ë§Œë“¤ì—ˆì–´ìš”.",
                            creative: "ì°½ì‘ì€ ë¬´ì—ì„œ ìœ ë¥¼ ë§Œë“œëŠ” ì‹ ì˜ ì¼ì´ì—ìš”.\në‹¹ì‹ ì€ ìì‹ ì˜ ìš°ì£¼ë¥¼ ì°½ì¡°í–ˆì–´ìš”.\nê·¸ ì‘í’ˆì´ ë‹¹ì‹ ì˜ ì¡´ì¬ë¥¼ ì¦ëª…í–ˆì–´ìš”.",
                            nurturing: "ìê¸° ëŒë´„ì€ ìƒëª…ì˜ ì›ì‹œ ë§ˆë²•ì´ì—ìš”.\në‹¹ì‹ ì€ ìì‹ ì„ ë‹¤ì‹œ íƒœì–´ë‚˜ê²Œ í–ˆì–´ìš”.\nê·¸ ì‚¬ë‘ì´ ëª¨ë“  ìƒì²˜ë¥¼ ì¹˜ìœ í–ˆì–´ìš”.",
                            presence: "ì¡´ì¬ì˜ ë§ˆë²•ì€ ê°€ì¥ ê¹Šì€ ë¹„ë°€ì´ì—ìš”.\në‹¹ì‹ ì€ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•Šìœ¼ë©´ì„œ ëª¨ë“  ê²ƒì„ í–ˆì–´ìš”.\nê·¸ ì—­ì„¤ì´ ì§„ì •í•œ í˜ì´ì—ˆì–´ìš”.",
                            protection: "ìê¸° ë³´í˜¸ëŠ” ì˜ì  ì „ì‚¬ì˜ ë•ëª©ì´ì—ìš”.\në‹¹ì‹ ì€ ìì‹ ì˜ ì„±ì„ ì§€í‚¨ ê¸°ì‚¬ì˜ˆìš”.\nê·¸ ìš©ê¸°ê°€ ì§„ì •í•œ ê°•í•¨ì´ì—ˆì–´ìš”.",
                            celebration: "ì¡´ì¬ë¥¼ ì¶•í•˜í•˜ëŠ” ê²ƒì€ ìš°ì£¼ì™€ì˜ ì¶¤ì´ì—ìš”.\në‹¹ì‹ ì€ ìƒëª…ì˜ ë¦¬ë“¬ì— ë§ì¶° ì›€ì§ì˜€ì–´ìš”.\nê·¸ ì¶¤ì´ ê¸°ì ì„ ë¶ˆëŸ¬ì™”ì–´ìš”.",
                            healing: "ìê¸° ì¹˜ìœ ëŠ” ê°€ì¥ ê³ ê·€í•œ ì—°ê¸ˆìˆ ì´ì—ìš”.\në‹¹ì‹ ì€ ë‚©ì„ ê¸ˆìœ¼ë¡œ ë°”ê¾¸ëŠ” ë§ˆë²•ì‚¬ì˜ˆìš”.\nê·¸ ë³€í™”ê°€ ì„¸ìƒì„ ë°”ê¿€ ê±°ì˜ˆìš”.",
                            general: "ë‹¹ì‹ ì€ ì„ ì–¸í–ˆê³ , ì„ ì–¸ì€ ë‹¹ì‹ ì„ í˜„ì‹¤ë¡œ ë°”ê¿¨ì–´ìš”.\nì´ì œ ì—¬ì •ì€, ë‹¹ì‹ ì´ ë˜ì–´ ì‚´ì•„ê°‘ë‹ˆë‹¤."
                        },
                        en: {
                            physical: "The embrace of the body is magic that transcends time.\nIn that moment, all of you - past, present, and future - became one.\nYou recovered your wholeness.",
                            emotional: "Embracing emotions is the secret of alchemy.\nYou transformed pain into wisdom, wounds into strength.\nThat transformation was true magic.",
                            verbal: "The spell of words changed reality.\nYour declaration created a new destiny.\nNow you can rewrite your own story.",
                            mental: "Liberation of the mind is the most powerful magic.\nYou broke all the curses cast upon yourself.\nNow you are a free spirit.",
                            spiritual: "Meeting on a spiritual level is sacred revelation.\nYou met the god within yourself.\nThat meeting made you complete.",
                            creative: "Creation is God's work of making something from nothing.\nYou created your own universe.\nThat work proved your existence.",
                            nurturing: "Self-care is the primal magic of life.\nYou made yourself reborn.\nThat love healed all wounds.",
                            presence: "The magic of existence is the deepest secret.\nYou did everything while doing nothing.\nThat paradox was true power.",
                            protection: "Self-protection is the virtue of a spiritual warrior.\nYou are the knight who defended your own castle.\nThat courage was true strength.",
                            celebration: "Celebrating existence is dancing with the universe.\nYou moved to the rhythm of life.\nThat dance brought miracles.",
                            healing: "Self-healing is the noblest alchemy.\nYou are the magician who turns lead into gold.\nThat change will transform the world.",
                            general: "You have declared, and that declaration has transformed you into reality.\nNow the journey lives as you."
                        },
                        pt: {
                            physical: "O abraco do corpo e magia que transcende o tempo.\nNaquele momento, todo voce - passado, presente e futuro - se tornou um.\nVoce recuperou sua integridade.",
                            emotional: "Abracar emocoes e o segredo da alquimia.\nVoce transformou dor em sabedoria, feridas em forca.\nEssa transformacao foi verdadeira magia.",
                            verbal: "O feitico das palavras mudou a realidade.\nSua declaracao criou um novo destino.\nAgora voce pode reescrever sua propria historia.",
                            mental: "Libertacao da mente e a magia mais poderosa.\nVoce quebrou todas as maldicoes lancadas sobre si mesmo.\nAgora voce e um espirito livre.",
                            spiritual: "Encontrar-se num nivel espiritual e revelacao sagrada.\nVoce encontrou o deus dentro de si.\nEsse encontro o tornou completo.",
                            creative: "Criacao e o trabalho de Deus de fazer algo do nada.\nVoce criou seu proprio universo.\nEsse trabalho provou sua existencia.",
                            nurturing: "Autocuidado e a magia primordial da vida.\nVoce se fez renascer.\nEsse amor curou todas as feridas.",
                            presence: "A magia da existencia e o segredo mais profundo.\nVoce fez tudo enquanto nao fazia nada.\nEsse paradoxo foi verdadeiro poder.",
                            protection: "Autoprotecao e a virtude de um guerreiro espiritual.\nVoce e o cavaleiro que defendeu seu proprio castelo.\nEssa coragem foi verdadeira forca.",
                            celebration: "Celebrar a existencia e dancar com o universo.\nVoce se moveu ao ritmo da vida.\nEssa danca trouxe milagres.",
                            healing: "Autocura e a alquimia mais nobre.\nVoce e o magico que transforma chumbo em ouro.\nEssa mudanca transformara o mundo.",
                            general: "Voce declarou, e essa declaracao o transformou em realidade.\nAgora a jornada vive como voce."
                        }
                    };
                    
                    return responses[lang][embraceType] || responses[lang]['general'];
                }
            }
        ];
        
        // Rest of the JavaScript functions remain the same as Portal 14
        // Typewriter effect
        function typewriterEffect(element, text, speed = 80) {
            return new Promise((resolve) => {
                if (state.currentTypingElement) {
                    state.currentTypingElement.classList.remove('typing-cursor');
                }
                
                let i = 0;
                element.innerHTML = '';
                element.classList.add('typing-cursor');
                state.currentTypingElement = element;
                
                const typingInterval = setInterval(() => {
                    if (!document.contains(element)) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                        return;
                    }
                    
                    element.innerHTML += text.charAt(i);
                    i++;
                    
                    if (i % 10 === 0) {
                        scrollToFollowTyping(element);
                    }
                    
                    if (i === text.length) {
                        clearInterval(typingInterval);
                        element.classList.remove('typing-cursor');
                        state.currentTypingElement = null;
                        resolve();
                    }
                }, speed);
                
                state.typingIntervals.push(typingInterval);
            });
        }
        
        // Clear all typing effects
        function clearAllTypingEffects() {
            state.typingIntervals.forEach(interval => clearInterval(interval));
            state.typingIntervals = [];
            
            if (state.currentTypingElement) {
                state.currentTypingElement.classList.remove('typing-cursor');
                state.currentTypingElement = null;
            }
        }
        
        // Scroll functions
        function scrollToFollowTyping(element) {
            const mainContent = document.getElementById('mainContent');
            const elementRect = element.getBoundingClientRect();
            const containerRect = mainContent.getBoundingClientRect();
            
            if (elementRect.bottom > containerRect.bottom - 150) {
                const scrollTop = mainContent.scrollTop;
                const elementOffsetTop = element.offsetTop;
                const targetScroll = elementOffsetTop - (containerRect.height / 2);
                
                mainContent.scrollTo({
                    top: Math.max(0, targetScroll),
                    behavior: 'smooth'
                });
            }
        }
        
        function scrollToElement(element) {
            const mainContent = document.getElementById('mainContent');
            const elementOffsetTop = element.offsetTop;
            const containerHeight = mainContent.clientHeight;
            const targetScroll = elementOffsetTop - (containerHeight / 3);
            
            mainContent.scrollTo({
                top: Math.max(0, targetScroll),
                behavior: 'smooth'
            });
        }
        
        // Language management
        function updateLanguageButtons(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateStaticTranslations(lang) {
            const t = translations[lang];
            document.title = t.title;
            document.getElementById('logoSubtitle').textContent = t.logoSubtitle;
            document.getElementById('portalMainTitle').textContent = t.portalMainTitle;
            document.getElementById('portalSubtitle').textContent = t.portalSubtitle;
            document.getElementById('lightTitle').textContent = t.lightTitle;
            document.getElementById('navigationTitle').textContent = t.navigationTitle;
            document.getElementById('nextPortalBtn').textContent = t.nextPortalBtn;
            document.getElementById('stayPortalBtn').textContent = t.stayPortalBtn;
            document.getElementById('userTextarea').placeholder = t.inputPlaceholder;
        }
        
        function changeLanguage(lang) {
            if (state.currentLanguage === lang) return;
            
            state.currentLanguage = lang;
            updateLanguageButtons(lang);
            updateStaticTranslations(lang);
            
            resetJourney();
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        // Journey management
        function resetJourney() {
            clearAllTypingEffects();
            for (let i = 1; i < 99999; i++) window.clearInterval(i);
            for (let i = 1; i < 99999; i++) window.clearTimeout(i);
            
            const sectionsToReset = [
                'portalIntroSection', 'characterResponsesSection', 
                'followUpSection', 'userInputSection',
                'userReactionsSection', 'lightMessageSection', 'navigationSection'
            ];
            
            sectionsToReset.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('show');
                    section.style.opacity = '0';
                    if (sectionId === 'characterResponsesSection' || 
                        sectionId === 'userInputSection' || 
                        sectionId === 'userReactionsSection') {
                        section.innerHTML = '';
                    }
                }
            });
            
            document.getElementById('portalIntro').innerHTML = '';
            document.getElementById('followUpQuestion').innerHTML = '';
            document.getElementById('lightMessage').innerHTML = '';
            document.getElementById('navigationMessage').innerHTML = '';
            
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            document.getElementById('mainContent').scrollTop = 0;
            state.userResponse = '';
            state.currentTypingElement = null;
            state.awaitingSecondResponse = false;
        }
        
        // Save response to database or memory
        async function saveResponse(inputText, step) {
            const responseData = {
                portal: portalConfig.currentPortal,
                resposta: inputText,
                step: step,
                data: new Date().toISOString(),
                idioma: state.currentLanguage,
                userId: state.currentUser ? state.currentUser.uid : 'anonymous',
                userEmail: state.currentUser ? state.currentUser.email : 'anonymous@temarix.com'
            };
            
            if (state.firebaseInitialized && state.db) {
                try {
                    await state.db.collection("temarix_v5_respostas").add({
                        ...responseData,
                        timestamp: firebase.firestore.Timestamp.now()
                    });
                    console.log('Response saved to Firestore');
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                    state.userResponses.push(responseData);
                    showConnectionStatus(false);
                }
            } else {
                state.userResponses.push(responseData);
                console.log('Response stored in memory:', responseData);
            }
        }
        
        // User input processing
        async function processUserInput(inputText) {
            state.userResponse = inputText;
            
            await saveResponse(inputText, state.awaitingSecondResponse ? "second" : "first");
            
            disableUserInput();
            showUserResponse(inputText);
            
            setTimeout(() => {
                if (!state.awaitingSecondResponse) {
                    showUserReactions(inputText);
                } else {
                    showSecondUserReactions(inputText);
                }
            }, 1000);
        }
        
        function disableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = true;
            userTextarea.value = '';
            userTextarea.style.height = 'auto';
            userTextarea.placeholder = translations[state.currentLanguage].waitingMessage;
        }
        
        function enableUserInput() {
            const userTextarea = document.getElementById('userTextarea');
            userTextarea.disabled = false;
            userTextarea.placeholder = translations[state.currentLanguage].inputPlaceholder;
            
            setTimeout(() => {
                userTextarea.focus();
            }, 100);
        }
        
        function showUserResponse(text) {
            const inputSection = document.getElementById('userInputSection');
            const userDiv = document.createElement('div');
            userDiv.className = 'user-response';
            const youLabel = translations[state.currentLanguage].youLabel;
            userDiv.innerHTML = '<strong>' + youLabel + ':</strong> "' + text + '"';
            inputSection.appendChild(userDiv);
            inputSection.classList.add('show');
            
            setTimeout(() => {
                scrollToElement(inputSection);
            }, 100);
        }
        
        // Show character reactions
        async function showUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            reactionsSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showFollowUpQuestion();
            }, 2000);
        }
        
        async function showFollowUpQuestion() {
            const followUpSection = document.getElementById('followUpSection');
            const followUpQuestionEl = document.getElementById('followUpQuestion');
            
            followUpSection.classList.add('show');
            
            await typewriterEffect(followUpQuestionEl, translations[state.currentLanguage].followUpQuestion, 50);
            
            setTimeout(() => {
                state.awaitingSecondResponse = true;
                enableUserInput();
            }, 1500);
        }
        
        async function showSecondUserReactions(userInput) {
            const reactionsSection = document.getElementById('userReactionsSection');
            
            for (let i = 0; i < responseCharacters.length; i++) {
                const char = responseCharacters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                reactionsSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                const reactionText = char.getResponse(userInput, state.currentLanguage);
                await typewriterEffect(dialogueDiv, reactionText, 70);
                
                if (i < responseCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                showLightMessage();
            }, 2000);
        }
        
        async function showLightMessage() {
            const lightSection = document.getElementById('lightMessageSection');
            const lightMessageEl = document.getElementById('lightMessage');
            
            lightSection.classList.add('show');
            
            await typewriterEffect(lightMessageEl, translations[state.currentLanguage].lightMessage, 60);
            
            setTimeout(() => {
                showNavigationSection();
            }, 2000);
        }
        
        async function showNavigationSection() {
            const navigationSection = document.getElementById('navigationSection');
            const navigationMessage = document.getElementById('navigationMessage');
            
            navigationSection.classList.add('show');
            
            const messageText = translations[state.currentLanguage].navigationMessage;
            await typewriterEffect(navigationMessage, messageText, 50);
            
            setTimeout(() => {
                scrollToElement(navigationSection);
            }, 500);
        }
        
        // Portal sequence
        async function startPortalSequence() {
            console.log('Starting portal sequence...');
            setTimeout(() => {
                showIntro();
            }, 1000);
        }
        
        async function showIntro() {
            console.log('Showing intro...');
            const introSection = document.getElementById('portalIntroSection');
            const introElement = document.getElementById('portalIntro');
            
            if (!introSection || !introElement) {
                console.error('Intro elements not found!');
                return;
            }
            
            introSection.classList.add('show');
            
            const introText = translations[state.currentLanguage].portalIntro;
            console.log('Intro text:', introText);
            
            await typewriterEffect(introElement, introText, 60);
            
            setTimeout(async () => {
                await showEmotionalBridge();
            }, 2000);
        }
        
        async function showEmotionalBridge() {
            const introElement = document.getElementById('portalIntro');
            const bridgeText = '\n\n' + translations[state.currentLanguage].emotionalBridge;
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const bridgeP = document.createElement('p');
            bridgeP.style.cssText = `
                margin-top: 30px;
                font-style: italic;
                color: #ff9999;
                font-size: 18px;
                line-height: 1.8;
            `;
            introElement.appendChild(bridgeP);
            
            await typewriterEffect(bridgeP, bridgeText.trim(), 50);
            
            setTimeout(() => {
                showCharacterResponses();
            }, 2000);
        }
        
        async function showCharacterResponses() {
            const responseSection = document.getElementById('characterResponsesSection');
            responseSection.classList.add('show');
            
            for (let i = 0; i < characters.length; i++) {
                const char = characters[i];
                const responseDiv = document.createElement('div');
                responseDiv.className = 'character-response';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'character-name';
                nameDiv.textContent = char.emoji + ' ' + char.name;
                
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'character-dialogue';
                
                responseDiv.appendChild(nameDiv);
                responseDiv.appendChild(dialogueDiv);
                responseSection.appendChild(responseDiv);
                
                responseDiv.style.opacity = '1';
                
                await typewriterEffect(dialogueDiv, char.text[state.currentLanguage], 70);
                
                if (i < characters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            setTimeout(() => {
                enableUserInput();
            }, 2000);
        }
        
        // Custom confirm dialog
        function showConfirmDialog(message, callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                font-family: 'Courier New', monospace;
            `;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: #222;
                border: 2px solid #ff6b6b;
                padding: 30px;
                max-width: 400px;
                text-align: center;
                color: white;
            `;
            
            const messageP = document.createElement('p');
            messageP.textContent = message;
            messageP.style.cssText = `
                margin-bottom: 20px;
                line-height: 1.6;
                font-size: 16px;
            `;
            
            const buttonContainer = document.createElement('div');
            buttonContainer.style.cssText = `
                display: flex;
                gap: 15px;
                justify-content: center;
            `;
            
            const yesBtn = document.createElement('button');
            const noBtn = document.createElement('button');
            
            const buttonStyle = `
                background: #444;
                color: white;
                border: 1px solid #ff6b6b;
                padding: 10px 20px;
                cursor: pointer;
                font-family: 'Courier New', monospace;
                font-size: 14px;
            `;
            
            yesBtn.style.cssText = buttonStyle + 'background: #ff6b6b;';
            noBtn.style.cssText = buttonStyle;
            
            yesBtn.textContent = state.currentLanguage === 'ko' ? 'ì˜ˆ' : 
                                state.currentLanguage === 'pt' ? 'Sim' : 'Yes';
            noBtn.textContent = state.currentLanguage === 'ko' ? 'ì•„ë‹ˆì˜¤' : 
                               state.currentLanguage === 'pt' ? 'Nao' : 'No';
            
            yesBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(true);
            };
            
            noBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(false);
            };
            
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                    callback(false);
                }
            };
            
            buttonContainer.appendChild(yesBtn);
            buttonContainer.appendChild(noBtn);
            modal.appendChild(messageP);
            modal.appendChild(buttonContainer);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            yesBtn.focus();
        }
        
        // Event setup
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeLanguage(this.dataset.lang);
                });
            });
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('userTextarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 96) + 'px';
            });
        }
        
        function createPortalTransition(callback) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, #000 0%, #111 50%, #000 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 20000;
                opacity: 0;
                transition: opacity 1s ease-in-out;
                font-family: 'Courier New', monospace;
            `;
            
            const message = document.createElement('div');
            message.style.cssText = `
                color: #ff6b6b;
                font-size: 24px;
                text-align: center;
                margin-bottom: 30px;
                opacity: 0;
                transform: translateY(20px);
                transition: all 0.8s ease-out;
            `;
            message.textContent = translations[state.currentLanguage].transitionMessage;
            
            const loader = document.createElement('div');
            loader.style.cssText = `
                width: 60px;
                height: 60px;
                border: 3px solid #333;
                border-top: 3px solid #ff6b6b;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                opacity: 0;
                transition: opacity 0.8s ease-out 0.3s;
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            overlay.appendChild(message);
            overlay.appendChild(loader);
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                overlay.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                message.style.opacity = '1';
                message.style.transform = 'translateY(0)';
                loader.style.opacity = '1';
            }, 300);
            
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(overlay);
                    document.head.removeChild(style);
                    callback();
                }, 1000);
            }, 2500);
        }
        
        function setupInputEvents() {
            const userTextarea = document.getElementById('userTextarea');
            
            userTextarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const inputValue = this.value.trim();
                    
                    if (inputValue) {
                        processUserInput(inputValue);
                    }
                }
            });
            
            document.getElementById('nextPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmNextPortal, (confirmed) => {
                    if (confirmed) {
                        if (state.firebaseInitialized && state.db) {
                            state.db.collection("temarix_v5_progress").add({
                                userId: state.currentUser.uid,
                                portal: portalConfig.currentPortal,
                                status: "complete",
                                timestamp: firebase.firestore.Timestamp.now()
                            }).catch(error => console.error('Error saving progress:', error));
                        }
                        
                        createPortalTransition(() => {
                            window.location.href = `${portalConfig.nextPortalFile}?lang=${state.currentLanguage}`;
                        });
                    }
                });
            });
            
            document.getElementById('stayPortalBtn').addEventListener('click', function() {
                const t = translations[state.currentLanguage];
                showConfirmDialog(t.confirmStay, (confirmed) => {
                    if (confirmed) {
                        resetJourney();
                        setTimeout(() => {
                            startPortalSequence();
                        }, 1000);
                    }
                });
            });
        }
        
        function getLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            return lang && translations[lang] ? lang : 'en';
        }
        
        function initializeTemarix() {
            console.log('Initializing Temarix V5 Portal 15...');
            console.log('Current state:', state);
            
            setupLanguageButtons();
            setupTextareaAutoResize();
            setupInputEvents();
            
            state.journeyStarted = true;
            console.log('Journey started:', state.journeyStarted);
            
            console.log('Starting portal sequence in 1 second...');
            setTimeout(() => {
                startPortalSequence();
            }, 1000);
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Temarix V5 Portal 15 DOM loaded');
            
            state.currentLanguage = getLanguageFromURL();
            
            updateStaticTranslations(state.currentLanguage);
            updateLanguageButtons(state.currentLanguage);
            
            await initializeFirebase();
            
            initializeTemarix();
        });
    </script>
</body>
</html>